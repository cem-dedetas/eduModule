function _mergeNamespaces(h,i){for(var g=0;g<i.length;g++){const _=i[g];if(typeof _!="string"&&!Array.isArray(_)){for(const j in _)if(j!=="default"&&!(j in h)){const $=Object.getOwnPropertyDescriptor(_,j);$&&Object.defineProperty(h,j,$.get?$:{enumerable:!0,get:()=>_[j]})}}}return Object.freeze(Object.defineProperty(h,Symbol.toStringTag,{value:"Module"}))}(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const j of document.querySelectorAll('link[rel="modulepreload"]'))_(j);new MutationObserver(j=>{for(const $ of j)if($.type==="childList")for(const _n of $.addedNodes)_n.tagName==="LINK"&&_n.rel==="modulepreload"&&_(_n)}).observe(document,{childList:!0,subtree:!0});function g(j){const $={};return j.integrity&&($.integrity=j.integrity),j.referrerPolicy&&($.referrerPolicy=j.referrerPolicy),j.crossOrigin==="use-credentials"?$.credentials="include":j.crossOrigin==="anonymous"?$.credentials="omit":$.credentials="same-origin",$}function _(j){if(j.ep)return;j.ep=!0;const $=g(j);fetch(j.href,$)}})();var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs$1(h){return h&&h.__esModule&&Object.prototype.hasOwnProperty.call(h,"default")?h.default:h}var jsxRuntimeExports={},jsxRuntime={get exports(){return jsxRuntimeExports},set exports(h){jsxRuntimeExports=h}},reactJsxRuntime_production_min={},reactExports={},react={get exports(){return reactExports},set exports(h){reactExports=h}},react_production_min={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var l$1=Symbol.for("react.element"),n$2=Symbol.for("react.portal"),p$2=Symbol.for("react.fragment"),q$1=Symbol.for("react.strict_mode"),r$1=Symbol.for("react.profiler"),t$1=Symbol.for("react.provider"),u=Symbol.for("react.context"),v$1=Symbol.for("react.forward_ref"),w=Symbol.for("react.suspense"),x$1=Symbol.for("react.memo"),y$1=Symbol.for("react.lazy"),z$1=Symbol.iterator;function A$1(h){return h===null||typeof h!="object"?null:(h=z$1&&h[z$1]||h["@@iterator"],typeof h=="function"?h:null)}var B$1={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},C$1=Object.assign,D$1={};function E$1(h,i,g){this.props=h,this.context=i,this.refs=D$1,this.updater=g||B$1}E$1.prototype.isReactComponent={};E$1.prototype.setState=function(h,i){if(typeof h!="object"&&typeof h!="function"&&h!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,h,i,"setState")};E$1.prototype.forceUpdate=function(h){this.updater.enqueueForceUpdate(this,h,"forceUpdate")};function F(){}F.prototype=E$1.prototype;function G$1(h,i,g){this.props=h,this.context=i,this.refs=D$1,this.updater=g||B$1}var H$1=G$1.prototype=new F;H$1.constructor=G$1;C$1(H$1,E$1.prototype);H$1.isPureReactComponent=!0;var I$1=Array.isArray,J=Object.prototype.hasOwnProperty,K$1={current:null},L$1={key:!0,ref:!0,__self:!0,__source:!0};function M$1(h,i,g){var _,j={},$=null,_n=null;if(i!=null)for(_ in i.ref!==void 0&&(_n=i.ref),i.key!==void 0&&($=""+i.key),i)J.call(i,_)&&!L$1.hasOwnProperty(_)&&(j[_]=i[_]);var _i=arguments.length-2;if(_i===1)j.children=g;else if(1<_i){for(var _s=Array(_i),ga=0;ga<_i;ga++)_s[ga]=arguments[ga+2];j.children=_s}if(h&&h.defaultProps)for(_ in _i=h.defaultProps,_i)j[_]===void 0&&(j[_]=_i[_]);return{$$typeof:l$1,type:h,key:$,ref:_n,props:j,_owner:K$1.current}}function N$1(h,i){return{$$typeof:l$1,type:h.type,key:i,ref:h.ref,props:h.props,_owner:h._owner}}function O$1(h){return typeof h=="object"&&h!==null&&h.$$typeof===l$1}function escape$1(h){var i={"=":"=0",":":"=2"};return"$"+h.replace(/[=:]/g,function(g){return i[g]})}var P$1=/\/+/g;function Q$1(h,i){return typeof h=="object"&&h!==null&&h.key!=null?escape$1(""+h.key):i.toString(36)}function R$1(h,i,g,_,j){var $=typeof h;($==="undefined"||$==="boolean")&&(h=null);var _n=!1;if(h===null)_n=!0;else switch($){case"string":case"number":_n=!0;break;case"object":switch(h.$$typeof){case l$1:case n$2:_n=!0}}if(_n)return _n=h,j=j(_n),h=_===""?"."+Q$1(_n,0):_,I$1(j)?(g="",h!=null&&(g=h.replace(P$1,"$&/")+"/"),R$1(j,i,g,"",function(ga){return ga})):j!=null&&(O$1(j)&&(j=N$1(j,g+(!j.key||_n&&_n.key===j.key?"":(""+j.key).replace(P$1,"$&/")+"/")+h)),i.push(j)),1;if(_n=0,_=_===""?".":_+":",I$1(h))for(var _i=0;_i<h.length;_i++){$=h[_i];var _s=_+Q$1($,_i);_n+=R$1($,i,g,_s,j)}else if(_s=A$1(h),typeof _s=="function")for(h=_s.call(h),_i=0;!($=h.next()).done;)$=$.value,_s=_+Q$1($,_i++),_n+=R$1($,i,g,_s,j);else if($==="object")throw i=String(h),Error("Objects are not valid as a React child (found: "+(i==="[object Object]"?"object with keys {"+Object.keys(h).join(", ")+"}":i)+"). If you meant to render a collection of children, use an array instead.");return _n}function S$1(h,i,g){if(h==null)return h;var _=[],j=0;return R$1(h,_,"","",function($){return i.call(g,$,j++)}),_}function T$1(h){if(h._status===-1){var i=h._result;i=i(),i.then(function(g){(h._status===0||h._status===-1)&&(h._status=1,h._result=g)},function(g){(h._status===0||h._status===-1)&&(h._status=2,h._result=g)}),h._status===-1&&(h._status=0,h._result=i)}if(h._status===1)return h._result.default;throw h._result}var U$1={current:null},V$1={transition:null},W$1={ReactCurrentDispatcher:U$1,ReactCurrentBatchConfig:V$1,ReactCurrentOwner:K$1};react_production_min.Children={map:S$1,forEach:function(h,i,g){S$1(h,function(){i.apply(this,arguments)},g)},count:function(h){var i=0;return S$1(h,function(){i++}),i},toArray:function(h){return S$1(h,function(i){return i})||[]},only:function(h){if(!O$1(h))throw Error("React.Children.only expected to receive a single React element child.");return h}};react_production_min.Component=E$1;react_production_min.Fragment=p$2;react_production_min.Profiler=r$1;react_production_min.PureComponent=G$1;react_production_min.StrictMode=q$1;react_production_min.Suspense=w;react_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=W$1;react_production_min.cloneElement=function(h,i,g){if(h==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+h+".");var _=C$1({},h.props),j=h.key,$=h.ref,_n=h._owner;if(i!=null){if(i.ref!==void 0&&($=i.ref,_n=K$1.current),i.key!==void 0&&(j=""+i.key),h.type&&h.type.defaultProps)var _i=h.type.defaultProps;for(_s in i)J.call(i,_s)&&!L$1.hasOwnProperty(_s)&&(_[_s]=i[_s]===void 0&&_i!==void 0?_i[_s]:i[_s])}var _s=arguments.length-2;if(_s===1)_.children=g;else if(1<_s){_i=Array(_s);for(var ga=0;ga<_s;ga++)_i[ga]=arguments[ga+2];_.children=_i}return{$$typeof:l$1,type:h.type,key:j,ref:$,props:_,_owner:_n}};react_production_min.createContext=function(h){return h={$$typeof:u,_currentValue:h,_currentValue2:h,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},h.Provider={$$typeof:t$1,_context:h},h.Consumer=h};react_production_min.createElement=M$1;react_production_min.createFactory=function(h){var i=M$1.bind(null,h);return i.type=h,i};react_production_min.createRef=function(){return{current:null}};react_production_min.forwardRef=function(h){return{$$typeof:v$1,render:h}};react_production_min.isValidElement=O$1;react_production_min.lazy=function(h){return{$$typeof:y$1,_payload:{_status:-1,_result:h},_init:T$1}};react_production_min.memo=function(h,i){return{$$typeof:x$1,type:h,compare:i===void 0?null:i}};react_production_min.startTransition=function(h){var i=V$1.transition;V$1.transition={};try{h()}finally{V$1.transition=i}};react_production_min.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};react_production_min.useCallback=function(h,i){return U$1.current.useCallback(h,i)};react_production_min.useContext=function(h){return U$1.current.useContext(h)};react_production_min.useDebugValue=function(){};react_production_min.useDeferredValue=function(h){return U$1.current.useDeferredValue(h)};react_production_min.useEffect=function(h,i){return U$1.current.useEffect(h,i)};react_production_min.useId=function(){return U$1.current.useId()};react_production_min.useImperativeHandle=function(h,i,g){return U$1.current.useImperativeHandle(h,i,g)};react_production_min.useInsertionEffect=function(h,i){return U$1.current.useInsertionEffect(h,i)};react_production_min.useLayoutEffect=function(h,i){return U$1.current.useLayoutEffect(h,i)};react_production_min.useMemo=function(h,i){return U$1.current.useMemo(h,i)};react_production_min.useReducer=function(h,i,g){return U$1.current.useReducer(h,i,g)};react_production_min.useRef=function(h){return U$1.current.useRef(h)};react_production_min.useState=function(h){return U$1.current.useState(h)};react_production_min.useSyncExternalStore=function(h,i,g){return U$1.current.useSyncExternalStore(h,i,g)};react_production_min.useTransition=function(){return U$1.current.useTransition()};react_production_min.version="18.2.0";(function(h){h.exports=react_production_min})(react);const React=getDefaultExportFromCjs$1(reactExports),React$1=_mergeNamespaces({__proto__:null,default:React},[reactExports]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var f=reactExports,k$1=Symbol.for("react.element"),l=Symbol.for("react.fragment"),m$1=Object.prototype.hasOwnProperty,n$1=f.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,p$1={key:!0,ref:!0,__self:!0,__source:!0};function q(h,i,g){var _,j={},$=null,_n=null;g!==void 0&&($=""+g),i.key!==void 0&&($=""+i.key),i.ref!==void 0&&(_n=i.ref);for(_ in i)m$1.call(i,_)&&!p$1.hasOwnProperty(_)&&(j[_]=i[_]);if(h&&h.defaultProps)for(_ in i=h.defaultProps,i)j[_]===void 0&&(j[_]=i[_]);return{$$typeof:k$1,type:h,key:$,ref:_n,props:j,_owner:n$1.current}}reactJsxRuntime_production_min.Fragment=l;reactJsxRuntime_production_min.jsx=q;reactJsxRuntime_production_min.jsxs=q;(function(h){h.exports=reactJsxRuntime_production_min})(jsxRuntime);const Fragment$1=jsxRuntimeExports.Fragment,jsx=jsxRuntimeExports.jsx,jsxs=jsxRuntimeExports.jsxs;var client={},reactDomExports={},reactDom={get exports(){return reactDomExports},set exports(h){reactDomExports=h}},reactDom_production_min={},schedulerExports={},scheduler={get exports(){return schedulerExports},set exports(h){schedulerExports=h}},scheduler_production_min={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(h){function i(xp,Gp){var $p=xp.length;xp.push(Gp);e:for(;0<$p;){var c0=$p-1>>>1,n0=xp[c0];if(0<j(n0,Gp))xp[c0]=Gp,xp[$p]=n0,$p=c0;else break e}}function g(xp){return xp.length===0?null:xp[0]}function _(xp){if(xp.length===0)return null;var Gp=xp[0],$p=xp.pop();if($p!==Gp){xp[0]=$p;e:for(var c0=0,n0=xp.length,C0=n0>>>1;c0<C0;){var Op=2*(c0+1)-1,Q0=xp[Op],dy=Op+1,Yy=xp[dy];if(0>j(Q0,$p))dy<n0&&0>j(Yy,Q0)?(xp[c0]=Yy,xp[dy]=$p,c0=dy):(xp[c0]=Q0,xp[Op]=$p,c0=Op);else if(dy<n0&&0>j(Yy,$p))xp[c0]=Yy,xp[dy]=$p,c0=dy;else break e}}return Gp}function j(xp,Gp){var $p=xp.sortIndex-Gp.sortIndex;return $p!==0?$p:xp.id-Gp.id}if(typeof performance=="object"&&typeof performance.now=="function"){var $=performance;h.unstable_now=function(){return $.now()}}else{var _n=Date,_i=_n.now();h.unstable_now=function(){return _n.now()-_i}}var _s=[],ga=[],ba=1,xa=null,El=3,Tl=!1,Sl=!1,Il=!1,Cl=typeof setTimeout=="function"?setTimeout:null,Nl=typeof clearTimeout=="function"?clearTimeout:null,Dl=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function Ul(xp){for(var Gp=g(ga);Gp!==null;){if(Gp.callback===null)_(ga);else if(Gp.startTime<=xp)_(ga),Gp.sortIndex=Gp.expirationTime,i(_s,Gp);else break;Gp=g(ga)}}function Kl(xp){if(Il=!1,Ul(xp),!Sl)if(g(_s)!==null)Sl=!0,Fp(Jl);else{var Gp=g(ga);Gp!==null&&Hp(Kl,Gp.startTime-xp)}}function Jl(xp,Gp){Sl=!1,Il&&(Il=!1,Nl(Ip),Ip=-1),Tl=!0;var $p=El;try{for(Ul(Gp),xa=g(_s);xa!==null&&(!(xa.expirationTime>Gp)||xp&&!Ap());){var c0=xa.callback;if(typeof c0=="function"){xa.callback=null,El=xa.priorityLevel;var n0=c0(xa.expirationTime<=Gp);Gp=h.unstable_now(),typeof n0=="function"?xa.callback=n0:xa===g(_s)&&_(_s),Ul(Gp)}else _(_s);xa=g(_s)}if(xa!==null)var C0=!0;else{var Op=g(ga);Op!==null&&Hp(Kl,Op.startTime-Gp),C0=!1}return C0}finally{xa=null,El=$p,Tl=!1}}var Ep=!1,_p=null,Ip=-1,Up=5,yp=-1;function Ap(){return!(h.unstable_now()-yp<Up)}function Cp(){if(_p!==null){var xp=h.unstable_now();yp=xp;var Gp=!0;try{Gp=_p(!0,xp)}finally{Gp?Mp():(Ep=!1,_p=null)}}else Ep=!1}var Mp;if(typeof Dl=="function")Mp=function(){Dl(Cp)};else if(typeof MessageChannel<"u"){var wp=new MessageChannel,Np=wp.port2;wp.port1.onmessage=Cp,Mp=function(){Np.postMessage(null)}}else Mp=function(){Cl(Cp,0)};function Fp(xp){_p=xp,Ep||(Ep=!0,Mp())}function Hp(xp,Gp){Ip=Cl(function(){xp(h.unstable_now())},Gp)}h.unstable_IdlePriority=5,h.unstable_ImmediatePriority=1,h.unstable_LowPriority=4,h.unstable_NormalPriority=3,h.unstable_Profiling=null,h.unstable_UserBlockingPriority=2,h.unstable_cancelCallback=function(xp){xp.callback=null},h.unstable_continueExecution=function(){Sl||Tl||(Sl=!0,Fp(Jl))},h.unstable_forceFrameRate=function(xp){0>xp||125<xp?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Up=0<xp?Math.floor(1e3/xp):5},h.unstable_getCurrentPriorityLevel=function(){return El},h.unstable_getFirstCallbackNode=function(){return g(_s)},h.unstable_next=function(xp){switch(El){case 1:case 2:case 3:var Gp=3;break;default:Gp=El}var $p=El;El=Gp;try{return xp()}finally{El=$p}},h.unstable_pauseExecution=function(){},h.unstable_requestPaint=function(){},h.unstable_runWithPriority=function(xp,Gp){switch(xp){case 1:case 2:case 3:case 4:case 5:break;default:xp=3}var $p=El;El=xp;try{return Gp()}finally{El=$p}},h.unstable_scheduleCallback=function(xp,Gp,$p){var c0=h.unstable_now();switch(typeof $p=="object"&&$p!==null?($p=$p.delay,$p=typeof $p=="number"&&0<$p?c0+$p:c0):$p=c0,xp){case 1:var n0=-1;break;case 2:n0=250;break;case 5:n0=1073741823;break;case 4:n0=1e4;break;default:n0=5e3}return n0=$p+n0,xp={id:ba++,callback:Gp,priorityLevel:xp,startTime:$p,expirationTime:n0,sortIndex:-1},$p>c0?(xp.sortIndex=$p,i(ga,xp),g(_s)===null&&xp===g(ga)&&(Il?(Nl(Ip),Ip=-1):Il=!0,Hp(Kl,$p-c0))):(xp.sortIndex=n0,i(_s,xp),Sl||Tl||(Sl=!0,Fp(Jl))),xp},h.unstable_shouldYield=Ap,h.unstable_wrapCallback=function(xp){var Gp=El;return function(){var $p=El;El=Gp;try{return xp.apply(this,arguments)}finally{El=$p}}}})(scheduler_production_min);(function(h){h.exports=scheduler_production_min})(scheduler);/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var aa=reactExports,ca=schedulerExports;function p(h){for(var i="https://reactjs.org/docs/error-decoder.html?invariant="+h,g=1;g<arguments.length;g++)i+="&args[]="+encodeURIComponent(arguments[g]);return"Minified React error #"+h+"; visit "+i+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var da=new Set,ea={};function fa(h,i){ha(h,i),ha(h+"Capture",i)}function ha(h,i){for(ea[h]=i,h=0;h<i.length;h++)da.add(i[h])}var ia=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ja=Object.prototype.hasOwnProperty,ka$1=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,la={},ma={};function oa(h){return ja.call(ma,h)?!0:ja.call(la,h)?!1:ka$1.test(h)?ma[h]=!0:(la[h]=!0,!1)}function pa(h,i,g,_){if(g!==null&&g.type===0)return!1;switch(typeof i){case"function":case"symbol":return!0;case"boolean":return _?!1:g!==null?!g.acceptsBooleans:(h=h.toLowerCase().slice(0,5),h!=="data-"&&h!=="aria-");default:return!1}}function qa(h,i,g,_){if(i===null||typeof i>"u"||pa(h,i,g,_))return!0;if(_)return!1;if(g!==null)switch(g.type){case 3:return!i;case 4:return i===!1;case 5:return isNaN(i);case 6:return isNaN(i)||1>i}return!1}function v(h,i,g,_,j,$,_n){this.acceptsBooleans=i===2||i===3||i===4,this.attributeName=_,this.attributeNamespace=j,this.mustUseProperty=g,this.propertyName=h,this.type=i,this.sanitizeURL=$,this.removeEmptyString=_n}var z={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(h){z[h]=new v(h,0,!1,h,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(h){var i=h[0];z[i]=new v(i,1,!1,h[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(h){z[h]=new v(h,2,!1,h.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(h){z[h]=new v(h,2,!1,h,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(h){z[h]=new v(h,3,!1,h.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(h){z[h]=new v(h,3,!0,h,null,!1,!1)});["capture","download"].forEach(function(h){z[h]=new v(h,4,!1,h,null,!1,!1)});["cols","rows","size","span"].forEach(function(h){z[h]=new v(h,6,!1,h,null,!1,!1)});["rowSpan","start"].forEach(function(h){z[h]=new v(h,5,!1,h.toLowerCase(),null,!1,!1)});var ra=/[\-:]([a-z])/g;function sa(h){return h[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(h){var i=h.replace(ra,sa);z[i]=new v(i,1,!1,h,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(h){var i=h.replace(ra,sa);z[i]=new v(i,1,!1,h,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(h){var i=h.replace(ra,sa);z[i]=new v(i,1,!1,h,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(h){z[h]=new v(h,1,!1,h.toLowerCase(),null,!1,!1)});z.xlinkHref=new v("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(h){z[h]=new v(h,1,!1,h.toLowerCase(),null,!0,!0)});function ta(h,i,g,_){var j=z.hasOwnProperty(i)?z[i]:null;(j!==null?j.type!==0:_||!(2<i.length)||i[0]!=="o"&&i[0]!=="O"||i[1]!=="n"&&i[1]!=="N")&&(qa(i,g,j,_)&&(g=null),_||j===null?oa(i)&&(g===null?h.removeAttribute(i):h.setAttribute(i,""+g)):j.mustUseProperty?h[j.propertyName]=g===null?j.type===3?!1:"":g:(i=j.attributeName,_=j.attributeNamespace,g===null?h.removeAttribute(i):(j=j.type,g=j===3||j===4&&g===!0?"":""+g,_?h.setAttributeNS(_,i,g):h.setAttribute(i,g))))}var ua=aa.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,va=Symbol.for("react.element"),wa=Symbol.for("react.portal"),ya=Symbol.for("react.fragment"),za=Symbol.for("react.strict_mode"),Aa=Symbol.for("react.profiler"),Ba=Symbol.for("react.provider"),Ca=Symbol.for("react.context"),Da=Symbol.for("react.forward_ref"),Ea=Symbol.for("react.suspense"),Fa=Symbol.for("react.suspense_list"),Ga=Symbol.for("react.memo"),Ha=Symbol.for("react.lazy"),Ia=Symbol.for("react.offscreen"),Ja=Symbol.iterator;function Ka(h){return h===null||typeof h!="object"?null:(h=Ja&&h[Ja]||h["@@iterator"],typeof h=="function"?h:null)}var A=Object.assign,La;function Ma(h){if(La===void 0)try{throw Error()}catch(g){var i=g.stack.trim().match(/\n( *(at )?)/);La=i&&i[1]||""}return`
`+La+h}var Na=!1;function Oa(h,i){if(!h||Na)return"";Na=!0;var g=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(i)if(i=function(){throw Error()},Object.defineProperty(i.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(i,[])}catch(ga){var _=ga}Reflect.construct(h,[],i)}else{try{i.call()}catch(ga){_=ga}h.call(i.prototype)}else{try{throw Error()}catch(ga){_=ga}h()}}catch(ga){if(ga&&_&&typeof ga.stack=="string"){for(var j=ga.stack.split(`
`),$=_.stack.split(`
`),_n=j.length-1,_i=$.length-1;1<=_n&&0<=_i&&j[_n]!==$[_i];)_i--;for(;1<=_n&&0<=_i;_n--,_i--)if(j[_n]!==$[_i]){if(_n!==1||_i!==1)do if(_n--,_i--,0>_i||j[_n]!==$[_i]){var _s=`
`+j[_n].replace(" at new "," at ");return h.displayName&&_s.includes("<anonymous>")&&(_s=_s.replace("<anonymous>",h.displayName)),_s}while(1<=_n&&0<=_i);break}}}finally{Na=!1,Error.prepareStackTrace=g}return(h=h?h.displayName||h.name:"")?Ma(h):""}function Pa(h){switch(h.tag){case 5:return Ma(h.type);case 16:return Ma("Lazy");case 13:return Ma("Suspense");case 19:return Ma("SuspenseList");case 0:case 2:case 15:return h=Oa(h.type,!1),h;case 11:return h=Oa(h.type.render,!1),h;case 1:return h=Oa(h.type,!0),h;default:return""}}function Qa(h){if(h==null)return null;if(typeof h=="function")return h.displayName||h.name||null;if(typeof h=="string")return h;switch(h){case ya:return"Fragment";case wa:return"Portal";case Aa:return"Profiler";case za:return"StrictMode";case Ea:return"Suspense";case Fa:return"SuspenseList"}if(typeof h=="object")switch(h.$$typeof){case Ca:return(h.displayName||"Context")+".Consumer";case Ba:return(h._context.displayName||"Context")+".Provider";case Da:var i=h.render;return h=h.displayName,h||(h=i.displayName||i.name||"",h=h!==""?"ForwardRef("+h+")":"ForwardRef"),h;case Ga:return i=h.displayName||null,i!==null?i:Qa(h.type)||"Memo";case Ha:i=h._payload,h=h._init;try{return Qa(h(i))}catch{}}return null}function Ra(h){var i=h.type;switch(h.tag){case 24:return"Cache";case 9:return(i.displayName||"Context")+".Consumer";case 10:return(i._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return h=i.render,h=h.displayName||h.name||"",i.displayName||(h!==""?"ForwardRef("+h+")":"ForwardRef");case 7:return"Fragment";case 5:return i;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Qa(i);case 8:return i===za?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof i=="function")return i.displayName||i.name||null;if(typeof i=="string")return i}return null}function Sa(h){switch(typeof h){case"boolean":case"number":case"string":case"undefined":return h;case"object":return h;default:return""}}function Ta(h){var i=h.type;return(h=h.nodeName)&&h.toLowerCase()==="input"&&(i==="checkbox"||i==="radio")}function Ua(h){var i=Ta(h)?"checked":"value",g=Object.getOwnPropertyDescriptor(h.constructor.prototype,i),_=""+h[i];if(!h.hasOwnProperty(i)&&typeof g<"u"&&typeof g.get=="function"&&typeof g.set=="function"){var j=g.get,$=g.set;return Object.defineProperty(h,i,{configurable:!0,get:function(){return j.call(this)},set:function(_n){_=""+_n,$.call(this,_n)}}),Object.defineProperty(h,i,{enumerable:g.enumerable}),{getValue:function(){return _},setValue:function(_n){_=""+_n},stopTracking:function(){h._valueTracker=null,delete h[i]}}}}function Va(h){h._valueTracker||(h._valueTracker=Ua(h))}function Wa(h){if(!h)return!1;var i=h._valueTracker;if(!i)return!0;var g=i.getValue(),_="";return h&&(_=Ta(h)?h.checked?"true":"false":h.value),h=_,h!==g?(i.setValue(h),!0):!1}function Xa(h){if(h=h||(typeof document<"u"?document:void 0),typeof h>"u")return null;try{return h.activeElement||h.body}catch{return h.body}}function Ya(h,i){var g=i.checked;return A({},i,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:g??h._wrapperState.initialChecked})}function Za(h,i){var g=i.defaultValue==null?"":i.defaultValue,_=i.checked!=null?i.checked:i.defaultChecked;g=Sa(i.value!=null?i.value:g),h._wrapperState={initialChecked:_,initialValue:g,controlled:i.type==="checkbox"||i.type==="radio"?i.checked!=null:i.value!=null}}function ab(h,i){i=i.checked,i!=null&&ta(h,"checked",i,!1)}function bb(h,i){ab(h,i);var g=Sa(i.value),_=i.type;if(g!=null)_==="number"?(g===0&&h.value===""||h.value!=g)&&(h.value=""+g):h.value!==""+g&&(h.value=""+g);else if(_==="submit"||_==="reset"){h.removeAttribute("value");return}i.hasOwnProperty("value")?cb(h,i.type,g):i.hasOwnProperty("defaultValue")&&cb(h,i.type,Sa(i.defaultValue)),i.checked==null&&i.defaultChecked!=null&&(h.defaultChecked=!!i.defaultChecked)}function db(h,i,g){if(i.hasOwnProperty("value")||i.hasOwnProperty("defaultValue")){var _=i.type;if(!(_!=="submit"&&_!=="reset"||i.value!==void 0&&i.value!==null))return;i=""+h._wrapperState.initialValue,g||i===h.value||(h.value=i),h.defaultValue=i}g=h.name,g!==""&&(h.name=""),h.defaultChecked=!!h._wrapperState.initialChecked,g!==""&&(h.name=g)}function cb(h,i,g){(i!=="number"||Xa(h.ownerDocument)!==h)&&(g==null?h.defaultValue=""+h._wrapperState.initialValue:h.defaultValue!==""+g&&(h.defaultValue=""+g))}var eb=Array.isArray;function fb(h,i,g,_){if(h=h.options,i){i={};for(var j=0;j<g.length;j++)i["$"+g[j]]=!0;for(g=0;g<h.length;g++)j=i.hasOwnProperty("$"+h[g].value),h[g].selected!==j&&(h[g].selected=j),j&&_&&(h[g].defaultSelected=!0)}else{for(g=""+Sa(g),i=null,j=0;j<h.length;j++){if(h[j].value===g){h[j].selected=!0,_&&(h[j].defaultSelected=!0);return}i!==null||h[j].disabled||(i=h[j])}i!==null&&(i.selected=!0)}}function gb(h,i){if(i.dangerouslySetInnerHTML!=null)throw Error(p(91));return A({},i,{value:void 0,defaultValue:void 0,children:""+h._wrapperState.initialValue})}function hb(h,i){var g=i.value;if(g==null){if(g=i.children,i=i.defaultValue,g!=null){if(i!=null)throw Error(p(92));if(eb(g)){if(1<g.length)throw Error(p(93));g=g[0]}i=g}i==null&&(i=""),g=i}h._wrapperState={initialValue:Sa(g)}}function ib(h,i){var g=Sa(i.value),_=Sa(i.defaultValue);g!=null&&(g=""+g,g!==h.value&&(h.value=g),i.defaultValue==null&&h.defaultValue!==g&&(h.defaultValue=g)),_!=null&&(h.defaultValue=""+_)}function jb(h){var i=h.textContent;i===h._wrapperState.initialValue&&i!==""&&i!==null&&(h.value=i)}function kb(h){switch(h){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function lb(h,i){return h==null||h==="http://www.w3.org/1999/xhtml"?kb(i):h==="http://www.w3.org/2000/svg"&&i==="foreignObject"?"http://www.w3.org/1999/xhtml":h}var mb,nb=function(h){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(i,g,_,j){MSApp.execUnsafeLocalFunction(function(){return h(i,g,_,j)})}:h}(function(h,i){if(h.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in h)h.innerHTML=i;else{for(mb=mb||document.createElement("div"),mb.innerHTML="<svg>"+i.valueOf().toString()+"</svg>",i=mb.firstChild;h.firstChild;)h.removeChild(h.firstChild);for(;i.firstChild;)h.appendChild(i.firstChild)}});function ob(h,i){if(i){var g=h.firstChild;if(g&&g===h.lastChild&&g.nodeType===3){g.nodeValue=i;return}}h.textContent=i}var pb={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},qb=["Webkit","ms","Moz","O"];Object.keys(pb).forEach(function(h){qb.forEach(function(i){i=i+h.charAt(0).toUpperCase()+h.substring(1),pb[i]=pb[h]})});function rb(h,i,g){return i==null||typeof i=="boolean"||i===""?"":g||typeof i!="number"||i===0||pb.hasOwnProperty(h)&&pb[h]?(""+i).trim():i+"px"}function sb(h,i){h=h.style;for(var g in i)if(i.hasOwnProperty(g)){var _=g.indexOf("--")===0,j=rb(g,i[g],_);g==="float"&&(g="cssFloat"),_?h.setProperty(g,j):h[g]=j}}var tb=A({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ub(h,i){if(i){if(tb[h]&&(i.children!=null||i.dangerouslySetInnerHTML!=null))throw Error(p(137,h));if(i.dangerouslySetInnerHTML!=null){if(i.children!=null)throw Error(p(60));if(typeof i.dangerouslySetInnerHTML!="object"||!("__html"in i.dangerouslySetInnerHTML))throw Error(p(61))}if(i.style!=null&&typeof i.style!="object")throw Error(p(62))}}function vb(h,i){if(h.indexOf("-")===-1)return typeof i.is=="string";switch(h){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var wb=null;function xb(h){return h=h.target||h.srcElement||window,h.correspondingUseElement&&(h=h.correspondingUseElement),h.nodeType===3?h.parentNode:h}var yb=null,zb=null,Ab=null;function Bb(h){if(h=Cb(h)){if(typeof yb!="function")throw Error(p(280));var i=h.stateNode;i&&(i=Db(i),yb(h.stateNode,h.type,i))}}function Eb(h){zb?Ab?Ab.push(h):Ab=[h]:zb=h}function Fb(){if(zb){var h=zb,i=Ab;if(Ab=zb=null,Bb(h),i)for(h=0;h<i.length;h++)Bb(i[h])}}function Gb(h,i){return h(i)}function Hb(){}var Ib=!1;function Jb(h,i,g){if(Ib)return h(i,g);Ib=!0;try{return Gb(h,i,g)}finally{Ib=!1,(zb!==null||Ab!==null)&&(Hb(),Fb())}}function Kb(h,i){var g=h.stateNode;if(g===null)return null;var _=Db(g);if(_===null)return null;g=_[i];e:switch(i){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(_=!_.disabled)||(h=h.type,_=!(h==="button"||h==="input"||h==="select"||h==="textarea")),h=!_;break e;default:h=!1}if(h)return null;if(g&&typeof g!="function")throw Error(p(231,i,typeof g));return g}var Lb=!1;if(ia)try{var Mb={};Object.defineProperty(Mb,"passive",{get:function(){Lb=!0}}),window.addEventListener("test",Mb,Mb),window.removeEventListener("test",Mb,Mb)}catch{Lb=!1}function Nb(h,i,g,_,j,$,_n,_i,_s){var ga=Array.prototype.slice.call(arguments,3);try{i.apply(g,ga)}catch(ba){this.onError(ba)}}var Ob=!1,Pb=null,Qb=!1,Rb=null,Sb={onError:function(h){Ob=!0,Pb=h}};function Tb(h,i,g,_,j,$,_n,_i,_s){Ob=!1,Pb=null,Nb.apply(Sb,arguments)}function Ub(h,i,g,_,j,$,_n,_i,_s){if(Tb.apply(this,arguments),Ob){if(Ob){var ga=Pb;Ob=!1,Pb=null}else throw Error(p(198));Qb||(Qb=!0,Rb=ga)}}function Vb(h){var i=h,g=h;if(h.alternate)for(;i.return;)i=i.return;else{h=i;do i=h,i.flags&4098&&(g=i.return),h=i.return;while(h)}return i.tag===3?g:null}function Wb(h){if(h.tag===13){var i=h.memoizedState;if(i===null&&(h=h.alternate,h!==null&&(i=h.memoizedState)),i!==null)return i.dehydrated}return null}function Xb(h){if(Vb(h)!==h)throw Error(p(188))}function Yb(h){var i=h.alternate;if(!i){if(i=Vb(h),i===null)throw Error(p(188));return i!==h?null:h}for(var g=h,_=i;;){var j=g.return;if(j===null)break;var $=j.alternate;if($===null){if(_=j.return,_!==null){g=_;continue}break}if(j.child===$.child){for($=j.child;$;){if($===g)return Xb(j),h;if($===_)return Xb(j),i;$=$.sibling}throw Error(p(188))}if(g.return!==_.return)g=j,_=$;else{for(var _n=!1,_i=j.child;_i;){if(_i===g){_n=!0,g=j,_=$;break}if(_i===_){_n=!0,_=j,g=$;break}_i=_i.sibling}if(!_n){for(_i=$.child;_i;){if(_i===g){_n=!0,g=$,_=j;break}if(_i===_){_n=!0,_=$,g=j;break}_i=_i.sibling}if(!_n)throw Error(p(189))}}if(g.alternate!==_)throw Error(p(190))}if(g.tag!==3)throw Error(p(188));return g.stateNode.current===g?h:i}function Zb(h){return h=Yb(h),h!==null?$b(h):null}function $b(h){if(h.tag===5||h.tag===6)return h;for(h=h.child;h!==null;){var i=$b(h);if(i!==null)return i;h=h.sibling}return null}var ac=ca.unstable_scheduleCallback,bc=ca.unstable_cancelCallback,cc=ca.unstable_shouldYield,dc=ca.unstable_requestPaint,B=ca.unstable_now,ec=ca.unstable_getCurrentPriorityLevel,fc=ca.unstable_ImmediatePriority,gc=ca.unstable_UserBlockingPriority,hc=ca.unstable_NormalPriority,ic=ca.unstable_LowPriority,jc=ca.unstable_IdlePriority,kc=null,lc=null;function mc(h){if(lc&&typeof lc.onCommitFiberRoot=="function")try{lc.onCommitFiberRoot(kc,h,void 0,(h.current.flags&128)===128)}catch{}}var oc=Math.clz32?Math.clz32:nc,pc=Math.log,qc=Math.LN2;function nc(h){return h>>>=0,h===0?32:31-(pc(h)/qc|0)|0}var rc=64,sc=4194304;function tc(h){switch(h&-h){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return h&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return h&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return h}}function uc(h,i){var g=h.pendingLanes;if(g===0)return 0;var _=0,j=h.suspendedLanes,$=h.pingedLanes,_n=g&268435455;if(_n!==0){var _i=_n&~j;_i!==0?_=tc(_i):($&=_n,$!==0&&(_=tc($)))}else _n=g&~j,_n!==0?_=tc(_n):$!==0&&(_=tc($));if(_===0)return 0;if(i!==0&&i!==_&&!(i&j)&&(j=_&-_,$=i&-i,j>=$||j===16&&($&4194240)!==0))return i;if(_&4&&(_|=g&16),i=h.entangledLanes,i!==0)for(h=h.entanglements,i&=_;0<i;)g=31-oc(i),j=1<<g,_|=h[g],i&=~j;return _}function vc(h,i){switch(h){case 1:case 2:case 4:return i+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function wc(h,i){for(var g=h.suspendedLanes,_=h.pingedLanes,j=h.expirationTimes,$=h.pendingLanes;0<$;){var _n=31-oc($),_i=1<<_n,_s=j[_n];_s===-1?(!(_i&g)||_i&_)&&(j[_n]=vc(_i,i)):_s<=i&&(h.expiredLanes|=_i),$&=~_i}}function xc(h){return h=h.pendingLanes&-1073741825,h!==0?h:h&1073741824?1073741824:0}function yc(){var h=rc;return rc<<=1,!(rc&4194240)&&(rc=64),h}function zc(h){for(var i=[],g=0;31>g;g++)i.push(h);return i}function Ac(h,i,g){h.pendingLanes|=i,i!==536870912&&(h.suspendedLanes=0,h.pingedLanes=0),h=h.eventTimes,i=31-oc(i),h[i]=g}function Bc(h,i){var g=h.pendingLanes&~i;h.pendingLanes=i,h.suspendedLanes=0,h.pingedLanes=0,h.expiredLanes&=i,h.mutableReadLanes&=i,h.entangledLanes&=i,i=h.entanglements;var _=h.eventTimes;for(h=h.expirationTimes;0<g;){var j=31-oc(g),$=1<<j;i[j]=0,_[j]=-1,h[j]=-1,g&=~$}}function Cc(h,i){var g=h.entangledLanes|=i;for(h=h.entanglements;g;){var _=31-oc(g),j=1<<_;j&i|h[_]&i&&(h[_]|=i),g&=~j}}var C=0;function Dc(h){return h&=-h,1<h?4<h?h&268435455?16:536870912:4:1}var Ec,Fc,Gc,Hc,Ic,Jc=!1,Kc=[],Lc=null,Mc=null,Nc=null,Oc=new Map,Pc=new Map,Qc=[],Rc="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Sc(h,i){switch(h){case"focusin":case"focusout":Lc=null;break;case"dragenter":case"dragleave":Mc=null;break;case"mouseover":case"mouseout":Nc=null;break;case"pointerover":case"pointerout":Oc.delete(i.pointerId);break;case"gotpointercapture":case"lostpointercapture":Pc.delete(i.pointerId)}}function Tc(h,i,g,_,j,$){return h===null||h.nativeEvent!==$?(h={blockedOn:i,domEventName:g,eventSystemFlags:_,nativeEvent:$,targetContainers:[j]},i!==null&&(i=Cb(i),i!==null&&Fc(i)),h):(h.eventSystemFlags|=_,i=h.targetContainers,j!==null&&i.indexOf(j)===-1&&i.push(j),h)}function Uc(h,i,g,_,j){switch(i){case"focusin":return Lc=Tc(Lc,h,i,g,_,j),!0;case"dragenter":return Mc=Tc(Mc,h,i,g,_,j),!0;case"mouseover":return Nc=Tc(Nc,h,i,g,_,j),!0;case"pointerover":var $=j.pointerId;return Oc.set($,Tc(Oc.get($)||null,h,i,g,_,j)),!0;case"gotpointercapture":return $=j.pointerId,Pc.set($,Tc(Pc.get($)||null,h,i,g,_,j)),!0}return!1}function Vc(h){var i=Wc(h.target);if(i!==null){var g=Vb(i);if(g!==null){if(i=g.tag,i===13){if(i=Wb(g),i!==null){h.blockedOn=i,Ic(h.priority,function(){Gc(g)});return}}else if(i===3&&g.stateNode.current.memoizedState.isDehydrated){h.blockedOn=g.tag===3?g.stateNode.containerInfo:null;return}}}h.blockedOn=null}function Xc(h){if(h.blockedOn!==null)return!1;for(var i=h.targetContainers;0<i.length;){var g=Yc(h.domEventName,h.eventSystemFlags,i[0],h.nativeEvent);if(g===null){g=h.nativeEvent;var _=new g.constructor(g.type,g);wb=_,g.target.dispatchEvent(_),wb=null}else return i=Cb(g),i!==null&&Fc(i),h.blockedOn=g,!1;i.shift()}return!0}function Zc(h,i,g){Xc(h)&&g.delete(i)}function $c(){Jc=!1,Lc!==null&&Xc(Lc)&&(Lc=null),Mc!==null&&Xc(Mc)&&(Mc=null),Nc!==null&&Xc(Nc)&&(Nc=null),Oc.forEach(Zc),Pc.forEach(Zc)}function ad(h,i){h.blockedOn===i&&(h.blockedOn=null,Jc||(Jc=!0,ca.unstable_scheduleCallback(ca.unstable_NormalPriority,$c)))}function bd(h){function i(j){return ad(j,h)}if(0<Kc.length){ad(Kc[0],h);for(var g=1;g<Kc.length;g++){var _=Kc[g];_.blockedOn===h&&(_.blockedOn=null)}}for(Lc!==null&&ad(Lc,h),Mc!==null&&ad(Mc,h),Nc!==null&&ad(Nc,h),Oc.forEach(i),Pc.forEach(i),g=0;g<Qc.length;g++)_=Qc[g],_.blockedOn===h&&(_.blockedOn=null);for(;0<Qc.length&&(g=Qc[0],g.blockedOn===null);)Vc(g),g.blockedOn===null&&Qc.shift()}var cd=ua.ReactCurrentBatchConfig,dd=!0;function ed(h,i,g,_){var j=C,$=cd.transition;cd.transition=null;try{C=1,fd(h,i,g,_)}finally{C=j,cd.transition=$}}function gd(h,i,g,_){var j=C,$=cd.transition;cd.transition=null;try{C=4,fd(h,i,g,_)}finally{C=j,cd.transition=$}}function fd(h,i,g,_){if(dd){var j=Yc(h,i,g,_);if(j===null)hd(h,i,_,id,g),Sc(h,_);else if(Uc(j,h,i,g,_))_.stopPropagation();else if(Sc(h,_),i&4&&-1<Rc.indexOf(h)){for(;j!==null;){var $=Cb(j);if($!==null&&Ec($),$=Yc(h,i,g,_),$===null&&hd(h,i,_,id,g),$===j)break;j=$}j!==null&&_.stopPropagation()}else hd(h,i,_,null,g)}}var id=null;function Yc(h,i,g,_){if(id=null,h=xb(_),h=Wc(h),h!==null)if(i=Vb(h),i===null)h=null;else if(g=i.tag,g===13){if(h=Wb(i),h!==null)return h;h=null}else if(g===3){if(i.stateNode.current.memoizedState.isDehydrated)return i.tag===3?i.stateNode.containerInfo:null;h=null}else i!==h&&(h=null);return id=h,null}function jd(h){switch(h){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(ec()){case fc:return 1;case gc:return 4;case hc:case ic:return 16;case jc:return 536870912;default:return 16}default:return 16}}var kd=null,ld=null,md=null;function nd(){if(md)return md;var h,i=ld,g=i.length,_,j="value"in kd?kd.value:kd.textContent,$=j.length;for(h=0;h<g&&i[h]===j[h];h++);var _n=g-h;for(_=1;_<=_n&&i[g-_]===j[$-_];_++);return md=j.slice(h,1<_?1-_:void 0)}function od(h){var i=h.keyCode;return"charCode"in h?(h=h.charCode,h===0&&i===13&&(h=13)):h=i,h===10&&(h=13),32<=h||h===13?h:0}function pd(){return!0}function qd(){return!1}function rd(h){function i(g,_,j,$,_n){this._reactName=g,this._targetInst=j,this.type=_,this.nativeEvent=$,this.target=_n,this.currentTarget=null;for(var _i in h)h.hasOwnProperty(_i)&&(g=h[_i],this[_i]=g?g($):$[_i]);return this.isDefaultPrevented=($.defaultPrevented!=null?$.defaultPrevented:$.returnValue===!1)?pd:qd,this.isPropagationStopped=qd,this}return A(i.prototype,{preventDefault:function(){this.defaultPrevented=!0;var g=this.nativeEvent;g&&(g.preventDefault?g.preventDefault():typeof g.returnValue!="unknown"&&(g.returnValue=!1),this.isDefaultPrevented=pd)},stopPropagation:function(){var g=this.nativeEvent;g&&(g.stopPropagation?g.stopPropagation():typeof g.cancelBubble!="unknown"&&(g.cancelBubble=!0),this.isPropagationStopped=pd)},persist:function(){},isPersistent:pd}),i}var sd={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(h){return h.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},td=rd(sd),ud=A({},sd,{view:0,detail:0}),vd=rd(ud),wd,xd,yd,Ad=A({},ud,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:zd,button:0,buttons:0,relatedTarget:function(h){return h.relatedTarget===void 0?h.fromElement===h.srcElement?h.toElement:h.fromElement:h.relatedTarget},movementX:function(h){return"movementX"in h?h.movementX:(h!==yd&&(yd&&h.type==="mousemove"?(wd=h.screenX-yd.screenX,xd=h.screenY-yd.screenY):xd=wd=0,yd=h),wd)},movementY:function(h){return"movementY"in h?h.movementY:xd}}),Bd=rd(Ad),Cd=A({},Ad,{dataTransfer:0}),Dd=rd(Cd),Ed=A({},ud,{relatedTarget:0}),Fd=rd(Ed),Gd=A({},sd,{animationName:0,elapsedTime:0,pseudoElement:0}),Hd=rd(Gd),Id=A({},sd,{clipboardData:function(h){return"clipboardData"in h?h.clipboardData:window.clipboardData}}),Jd=rd(Id),Kd=A({},sd,{data:0}),Ld=rd(Kd),Md={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Nd={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Od={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Pd(h){var i=this.nativeEvent;return i.getModifierState?i.getModifierState(h):(h=Od[h])?!!i[h]:!1}function zd(){return Pd}var Qd=A({},ud,{key:function(h){if(h.key){var i=Md[h.key]||h.key;if(i!=="Unidentified")return i}return h.type==="keypress"?(h=od(h),h===13?"Enter":String.fromCharCode(h)):h.type==="keydown"||h.type==="keyup"?Nd[h.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:zd,charCode:function(h){return h.type==="keypress"?od(h):0},keyCode:function(h){return h.type==="keydown"||h.type==="keyup"?h.keyCode:0},which:function(h){return h.type==="keypress"?od(h):h.type==="keydown"||h.type==="keyup"?h.keyCode:0}}),Rd=rd(Qd),Sd=A({},Ad,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Td=rd(Sd),Ud=A({},ud,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:zd}),Vd=rd(Ud),Wd=A({},sd,{propertyName:0,elapsedTime:0,pseudoElement:0}),Xd=rd(Wd),Yd=A({},Ad,{deltaX:function(h){return"deltaX"in h?h.deltaX:"wheelDeltaX"in h?-h.wheelDeltaX:0},deltaY:function(h){return"deltaY"in h?h.deltaY:"wheelDeltaY"in h?-h.wheelDeltaY:"wheelDelta"in h?-h.wheelDelta:0},deltaZ:0,deltaMode:0}),Zd=rd(Yd),$d=[9,13,27,32],ae=ia&&"CompositionEvent"in window,be=null;ia&&"documentMode"in document&&(be=document.documentMode);var ce=ia&&"TextEvent"in window&&!be,de=ia&&(!ae||be&&8<be&&11>=be),ee=String.fromCharCode(32),fe=!1;function ge(h,i){switch(h){case"keyup":return $d.indexOf(i.keyCode)!==-1;case"keydown":return i.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function he(h){return h=h.detail,typeof h=="object"&&"data"in h?h.data:null}var ie=!1;function je(h,i){switch(h){case"compositionend":return he(i);case"keypress":return i.which!==32?null:(fe=!0,ee);case"textInput":return h=i.data,h===ee&&fe?null:h;default:return null}}function ke(h,i){if(ie)return h==="compositionend"||!ae&&ge(h,i)?(h=nd(),md=ld=kd=null,ie=!1,h):null;switch(h){case"paste":return null;case"keypress":if(!(i.ctrlKey||i.altKey||i.metaKey)||i.ctrlKey&&i.altKey){if(i.char&&1<i.char.length)return i.char;if(i.which)return String.fromCharCode(i.which)}return null;case"compositionend":return de&&i.locale!=="ko"?null:i.data;default:return null}}var le={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function me(h){var i=h&&h.nodeName&&h.nodeName.toLowerCase();return i==="input"?!!le[h.type]:i==="textarea"}function ne(h,i,g,_){Eb(_),i=oe(i,"onChange"),0<i.length&&(g=new td("onChange","change",null,g,_),h.push({event:g,listeners:i}))}var pe=null,qe=null;function re$1(h){se(h,0)}function te(h){var i=ue(h);if(Wa(i))return h}function ve(h,i){if(h==="change")return i}var we=!1;if(ia){var xe;if(ia){var ye="oninput"in document;if(!ye){var ze=document.createElement("div");ze.setAttribute("oninput","return;"),ye=typeof ze.oninput=="function"}xe=ye}else xe=!1;we=xe&&(!document.documentMode||9<document.documentMode)}function Ae(){pe&&(pe.detachEvent("onpropertychange",Be),qe=pe=null)}function Be(h){if(h.propertyName==="value"&&te(qe)){var i=[];ne(i,qe,h,xb(h)),Jb(re$1,i)}}function Ce(h,i,g){h==="focusin"?(Ae(),pe=i,qe=g,pe.attachEvent("onpropertychange",Be)):h==="focusout"&&Ae()}function De(h){if(h==="selectionchange"||h==="keyup"||h==="keydown")return te(qe)}function Ee(h,i){if(h==="click")return te(i)}function Fe(h,i){if(h==="input"||h==="change")return te(i)}function Ge(h,i){return h===i&&(h!==0||1/h===1/i)||h!==h&&i!==i}var He=typeof Object.is=="function"?Object.is:Ge;function Ie(h,i){if(He(h,i))return!0;if(typeof h!="object"||h===null||typeof i!="object"||i===null)return!1;var g=Object.keys(h),_=Object.keys(i);if(g.length!==_.length)return!1;for(_=0;_<g.length;_++){var j=g[_];if(!ja.call(i,j)||!He(h[j],i[j]))return!1}return!0}function Je(h){for(;h&&h.firstChild;)h=h.firstChild;return h}function Ke(h,i){var g=Je(h);h=0;for(var _;g;){if(g.nodeType===3){if(_=h+g.textContent.length,h<=i&&_>=i)return{node:g,offset:i-h};h=_}e:{for(;g;){if(g.nextSibling){g=g.nextSibling;break e}g=g.parentNode}g=void 0}g=Je(g)}}function Le(h,i){return h&&i?h===i?!0:h&&h.nodeType===3?!1:i&&i.nodeType===3?Le(h,i.parentNode):"contains"in h?h.contains(i):h.compareDocumentPosition?!!(h.compareDocumentPosition(i)&16):!1:!1}function Me(){for(var h=window,i=Xa();i instanceof h.HTMLIFrameElement;){try{var g=typeof i.contentWindow.location.href=="string"}catch{g=!1}if(g)h=i.contentWindow;else break;i=Xa(h.document)}return i}function Ne(h){var i=h&&h.nodeName&&h.nodeName.toLowerCase();return i&&(i==="input"&&(h.type==="text"||h.type==="search"||h.type==="tel"||h.type==="url"||h.type==="password")||i==="textarea"||h.contentEditable==="true")}function Oe(h){var i=Me(),g=h.focusedElem,_=h.selectionRange;if(i!==g&&g&&g.ownerDocument&&Le(g.ownerDocument.documentElement,g)){if(_!==null&&Ne(g)){if(i=_.start,h=_.end,h===void 0&&(h=i),"selectionStart"in g)g.selectionStart=i,g.selectionEnd=Math.min(h,g.value.length);else if(h=(i=g.ownerDocument||document)&&i.defaultView||window,h.getSelection){h=h.getSelection();var j=g.textContent.length,$=Math.min(_.start,j);_=_.end===void 0?$:Math.min(_.end,j),!h.extend&&$>_&&(j=_,_=$,$=j),j=Ke(g,$);var _n=Ke(g,_);j&&_n&&(h.rangeCount!==1||h.anchorNode!==j.node||h.anchorOffset!==j.offset||h.focusNode!==_n.node||h.focusOffset!==_n.offset)&&(i=i.createRange(),i.setStart(j.node,j.offset),h.removeAllRanges(),$>_?(h.addRange(i),h.extend(_n.node,_n.offset)):(i.setEnd(_n.node,_n.offset),h.addRange(i)))}}for(i=[],h=g;h=h.parentNode;)h.nodeType===1&&i.push({element:h,left:h.scrollLeft,top:h.scrollTop});for(typeof g.focus=="function"&&g.focus(),g=0;g<i.length;g++)h=i[g],h.element.scrollLeft=h.left,h.element.scrollTop=h.top}}var Pe=ia&&"documentMode"in document&&11>=document.documentMode,Qe=null,Re=null,Se=null,Te=!1;function Ue(h,i,g){var _=g.window===g?g.document:g.nodeType===9?g:g.ownerDocument;Te||Qe==null||Qe!==Xa(_)||(_=Qe,"selectionStart"in _&&Ne(_)?_={start:_.selectionStart,end:_.selectionEnd}:(_=(_.ownerDocument&&_.ownerDocument.defaultView||window).getSelection(),_={anchorNode:_.anchorNode,anchorOffset:_.anchorOffset,focusNode:_.focusNode,focusOffset:_.focusOffset}),Se&&Ie(Se,_)||(Se=_,_=oe(Re,"onSelect"),0<_.length&&(i=new td("onSelect","select",null,i,g),h.push({event:i,listeners:_}),i.target=Qe)))}function Ve(h,i){var g={};return g[h.toLowerCase()]=i.toLowerCase(),g["Webkit"+h]="webkit"+i,g["Moz"+h]="moz"+i,g}var We={animationend:Ve("Animation","AnimationEnd"),animationiteration:Ve("Animation","AnimationIteration"),animationstart:Ve("Animation","AnimationStart"),transitionend:Ve("Transition","TransitionEnd")},Xe={},Ye={};ia&&(Ye=document.createElement("div").style,"AnimationEvent"in window||(delete We.animationend.animation,delete We.animationiteration.animation,delete We.animationstart.animation),"TransitionEvent"in window||delete We.transitionend.transition);function Ze(h){if(Xe[h])return Xe[h];if(!We[h])return h;var i=We[h],g;for(g in i)if(i.hasOwnProperty(g)&&g in Ye)return Xe[h]=i[g];return h}var $e=Ze("animationend"),af=Ze("animationiteration"),bf=Ze("animationstart"),cf=Ze("transitionend"),df=new Map,ef="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ff(h,i){df.set(h,i),fa(i,[h])}for(var gf=0;gf<ef.length;gf++){var hf=ef[gf],jf=hf.toLowerCase(),kf=hf[0].toUpperCase()+hf.slice(1);ff(jf,"on"+kf)}ff($e,"onAnimationEnd");ff(af,"onAnimationIteration");ff(bf,"onAnimationStart");ff("dblclick","onDoubleClick");ff("focusin","onFocus");ff("focusout","onBlur");ff(cf,"onTransitionEnd");ha("onMouseEnter",["mouseout","mouseover"]);ha("onMouseLeave",["mouseout","mouseover"]);ha("onPointerEnter",["pointerout","pointerover"]);ha("onPointerLeave",["pointerout","pointerover"]);fa("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));fa("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));fa("onBeforeInput",["compositionend","keypress","textInput","paste"]);fa("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));fa("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));fa("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var lf="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),mf=new Set("cancel close invalid load scroll toggle".split(" ").concat(lf));function nf(h,i,g){var _=h.type||"unknown-event";h.currentTarget=g,Ub(_,i,void 0,h),h.currentTarget=null}function se(h,i){i=(i&4)!==0;for(var g=0;g<h.length;g++){var _=h[g],j=_.event;_=_.listeners;e:{var $=void 0;if(i)for(var _n=_.length-1;0<=_n;_n--){var _i=_[_n],_s=_i.instance,ga=_i.currentTarget;if(_i=_i.listener,_s!==$&&j.isPropagationStopped())break e;nf(j,_i,ga),$=_s}else for(_n=0;_n<_.length;_n++){if(_i=_[_n],_s=_i.instance,ga=_i.currentTarget,_i=_i.listener,_s!==$&&j.isPropagationStopped())break e;nf(j,_i,ga),$=_s}}}if(Qb)throw h=Rb,Qb=!1,Rb=null,h}function D(h,i){var g=i[of];g===void 0&&(g=i[of]=new Set);var _=h+"__bubble";g.has(_)||(pf(i,h,2,!1),g.add(_))}function qf(h,i,g){var _=0;i&&(_|=4),pf(g,h,_,i)}var rf="_reactListening"+Math.random().toString(36).slice(2);function sf(h){if(!h[rf]){h[rf]=!0,da.forEach(function(g){g!=="selectionchange"&&(mf.has(g)||qf(g,!1,h),qf(g,!0,h))});var i=h.nodeType===9?h:h.ownerDocument;i===null||i[rf]||(i[rf]=!0,qf("selectionchange",!1,i))}}function pf(h,i,g,_){switch(jd(i)){case 1:var j=ed;break;case 4:j=gd;break;default:j=fd}g=j.bind(null,i,g,h),j=void 0,!Lb||i!=="touchstart"&&i!=="touchmove"&&i!=="wheel"||(j=!0),_?j!==void 0?h.addEventListener(i,g,{capture:!0,passive:j}):h.addEventListener(i,g,!0):j!==void 0?h.addEventListener(i,g,{passive:j}):h.addEventListener(i,g,!1)}function hd(h,i,g,_,j){var $=_;if(!(i&1)&&!(i&2)&&_!==null)e:for(;;){if(_===null)return;var _n=_.tag;if(_n===3||_n===4){var _i=_.stateNode.containerInfo;if(_i===j||_i.nodeType===8&&_i.parentNode===j)break;if(_n===4)for(_n=_.return;_n!==null;){var _s=_n.tag;if((_s===3||_s===4)&&(_s=_n.stateNode.containerInfo,_s===j||_s.nodeType===8&&_s.parentNode===j))return;_n=_n.return}for(;_i!==null;){if(_n=Wc(_i),_n===null)return;if(_s=_n.tag,_s===5||_s===6){_=$=_n;continue e}_i=_i.parentNode}}_=_.return}Jb(function(){var ga=$,ba=xb(g),xa=[];e:{var El=df.get(h);if(El!==void 0){var Tl=td,Sl=h;switch(h){case"keypress":if(od(g)===0)break e;case"keydown":case"keyup":Tl=Rd;break;case"focusin":Sl="focus",Tl=Fd;break;case"focusout":Sl="blur",Tl=Fd;break;case"beforeblur":case"afterblur":Tl=Fd;break;case"click":if(g.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Tl=Bd;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Tl=Dd;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Tl=Vd;break;case $e:case af:case bf:Tl=Hd;break;case cf:Tl=Xd;break;case"scroll":Tl=vd;break;case"wheel":Tl=Zd;break;case"copy":case"cut":case"paste":Tl=Jd;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Tl=Td}var Il=(i&4)!==0,Cl=!Il&&h==="scroll",Nl=Il?El!==null?El+"Capture":null:El;Il=[];for(var Dl=ga,Ul;Dl!==null;){Ul=Dl;var Kl=Ul.stateNode;if(Ul.tag===5&&Kl!==null&&(Ul=Kl,Nl!==null&&(Kl=Kb(Dl,Nl),Kl!=null&&Il.push(tf(Dl,Kl,Ul)))),Cl)break;Dl=Dl.return}0<Il.length&&(El=new Tl(El,Sl,null,g,ba),xa.push({event:El,listeners:Il}))}}if(!(i&7)){e:{if(El=h==="mouseover"||h==="pointerover",Tl=h==="mouseout"||h==="pointerout",El&&g!==wb&&(Sl=g.relatedTarget||g.fromElement)&&(Wc(Sl)||Sl[uf]))break e;if((Tl||El)&&(El=ba.window===ba?ba:(El=ba.ownerDocument)?El.defaultView||El.parentWindow:window,Tl?(Sl=g.relatedTarget||g.toElement,Tl=ga,Sl=Sl?Wc(Sl):null,Sl!==null&&(Cl=Vb(Sl),Sl!==Cl||Sl.tag!==5&&Sl.tag!==6)&&(Sl=null)):(Tl=null,Sl=ga),Tl!==Sl)){if(Il=Bd,Kl="onMouseLeave",Nl="onMouseEnter",Dl="mouse",(h==="pointerout"||h==="pointerover")&&(Il=Td,Kl="onPointerLeave",Nl="onPointerEnter",Dl="pointer"),Cl=Tl==null?El:ue(Tl),Ul=Sl==null?El:ue(Sl),El=new Il(Kl,Dl+"leave",Tl,g,ba),El.target=Cl,El.relatedTarget=Ul,Kl=null,Wc(ba)===ga&&(Il=new Il(Nl,Dl+"enter",Sl,g,ba),Il.target=Ul,Il.relatedTarget=Cl,Kl=Il),Cl=Kl,Tl&&Sl)t:{for(Il=Tl,Nl=Sl,Dl=0,Ul=Il;Ul;Ul=vf(Ul))Dl++;for(Ul=0,Kl=Nl;Kl;Kl=vf(Kl))Ul++;for(;0<Dl-Ul;)Il=vf(Il),Dl--;for(;0<Ul-Dl;)Nl=vf(Nl),Ul--;for(;Dl--;){if(Il===Nl||Nl!==null&&Il===Nl.alternate)break t;Il=vf(Il),Nl=vf(Nl)}Il=null}else Il=null;Tl!==null&&wf(xa,El,Tl,Il,!1),Sl!==null&&Cl!==null&&wf(xa,Cl,Sl,Il,!0)}}e:{if(El=ga?ue(ga):window,Tl=El.nodeName&&El.nodeName.toLowerCase(),Tl==="select"||Tl==="input"&&El.type==="file")var Jl=ve;else if(me(El))if(we)Jl=Fe;else{Jl=De;var Ep=Ce}else(Tl=El.nodeName)&&Tl.toLowerCase()==="input"&&(El.type==="checkbox"||El.type==="radio")&&(Jl=Ee);if(Jl&&(Jl=Jl(h,ga))){ne(xa,Jl,g,ba);break e}Ep&&Ep(h,El,ga),h==="focusout"&&(Ep=El._wrapperState)&&Ep.controlled&&El.type==="number"&&cb(El,"number",El.value)}switch(Ep=ga?ue(ga):window,h){case"focusin":(me(Ep)||Ep.contentEditable==="true")&&(Qe=Ep,Re=ga,Se=null);break;case"focusout":Se=Re=Qe=null;break;case"mousedown":Te=!0;break;case"contextmenu":case"mouseup":case"dragend":Te=!1,Ue(xa,g,ba);break;case"selectionchange":if(Pe)break;case"keydown":case"keyup":Ue(xa,g,ba)}var _p;if(ae)e:{switch(h){case"compositionstart":var Ip="onCompositionStart";break e;case"compositionend":Ip="onCompositionEnd";break e;case"compositionupdate":Ip="onCompositionUpdate";break e}Ip=void 0}else ie?ge(h,g)&&(Ip="onCompositionEnd"):h==="keydown"&&g.keyCode===229&&(Ip="onCompositionStart");Ip&&(de&&g.locale!=="ko"&&(ie||Ip!=="onCompositionStart"?Ip==="onCompositionEnd"&&ie&&(_p=nd()):(kd=ba,ld="value"in kd?kd.value:kd.textContent,ie=!0)),Ep=oe(ga,Ip),0<Ep.length&&(Ip=new Ld(Ip,h,null,g,ba),xa.push({event:Ip,listeners:Ep}),_p?Ip.data=_p:(_p=he(g),_p!==null&&(Ip.data=_p)))),(_p=ce?je(h,g):ke(h,g))&&(ga=oe(ga,"onBeforeInput"),0<ga.length&&(ba=new Ld("onBeforeInput","beforeinput",null,g,ba),xa.push({event:ba,listeners:ga}),ba.data=_p))}se(xa,i)})}function tf(h,i,g){return{instance:h,listener:i,currentTarget:g}}function oe(h,i){for(var g=i+"Capture",_=[];h!==null;){var j=h,$=j.stateNode;j.tag===5&&$!==null&&(j=$,$=Kb(h,g),$!=null&&_.unshift(tf(h,$,j)),$=Kb(h,i),$!=null&&_.push(tf(h,$,j))),h=h.return}return _}function vf(h){if(h===null)return null;do h=h.return;while(h&&h.tag!==5);return h||null}function wf(h,i,g,_,j){for(var $=i._reactName,_n=[];g!==null&&g!==_;){var _i=g,_s=_i.alternate,ga=_i.stateNode;if(_s!==null&&_s===_)break;_i.tag===5&&ga!==null&&(_i=ga,j?(_s=Kb(g,$),_s!=null&&_n.unshift(tf(g,_s,_i))):j||(_s=Kb(g,$),_s!=null&&_n.push(tf(g,_s,_i)))),g=g.return}_n.length!==0&&h.push({event:i,listeners:_n})}var xf=/\r\n?/g,yf=/\u0000|\uFFFD/g;function zf(h){return(typeof h=="string"?h:""+h).replace(xf,`
`).replace(yf,"")}function Af(h,i,g){if(i=zf(i),zf(h)!==i&&g)throw Error(p(425))}function Bf(){}var Cf=null,Df=null;function Ef(h,i){return h==="textarea"||h==="noscript"||typeof i.children=="string"||typeof i.children=="number"||typeof i.dangerouslySetInnerHTML=="object"&&i.dangerouslySetInnerHTML!==null&&i.dangerouslySetInnerHTML.__html!=null}var Ff=typeof setTimeout=="function"?setTimeout:void 0,Gf=typeof clearTimeout=="function"?clearTimeout:void 0,Hf=typeof Promise=="function"?Promise:void 0,Jf=typeof queueMicrotask=="function"?queueMicrotask:typeof Hf<"u"?function(h){return Hf.resolve(null).then(h).catch(If)}:Ff;function If(h){setTimeout(function(){throw h})}function Kf(h,i){var g=i,_=0;do{var j=g.nextSibling;if(h.removeChild(g),j&&j.nodeType===8)if(g=j.data,g==="/$"){if(_===0){h.removeChild(j),bd(i);return}_--}else g!=="$"&&g!=="$?"&&g!=="$!"||_++;g=j}while(g);bd(i)}function Lf(h){for(;h!=null;h=h.nextSibling){var i=h.nodeType;if(i===1||i===3)break;if(i===8){if(i=h.data,i==="$"||i==="$!"||i==="$?")break;if(i==="/$")return null}}return h}function Mf(h){h=h.previousSibling;for(var i=0;h;){if(h.nodeType===8){var g=h.data;if(g==="$"||g==="$!"||g==="$?"){if(i===0)return h;i--}else g==="/$"&&i++}h=h.previousSibling}return null}var Nf=Math.random().toString(36).slice(2),Of="__reactFiber$"+Nf,Pf="__reactProps$"+Nf,uf="__reactContainer$"+Nf,of="__reactEvents$"+Nf,Qf="__reactListeners$"+Nf,Rf="__reactHandles$"+Nf;function Wc(h){var i=h[Of];if(i)return i;for(var g=h.parentNode;g;){if(i=g[uf]||g[Of]){if(g=i.alternate,i.child!==null||g!==null&&g.child!==null)for(h=Mf(h);h!==null;){if(g=h[Of])return g;h=Mf(h)}return i}h=g,g=h.parentNode}return null}function Cb(h){return h=h[Of]||h[uf],!h||h.tag!==5&&h.tag!==6&&h.tag!==13&&h.tag!==3?null:h}function ue(h){if(h.tag===5||h.tag===6)return h.stateNode;throw Error(p(33))}function Db(h){return h[Pf]||null}var Sf=[],Tf=-1;function Uf(h){return{current:h}}function E(h){0>Tf||(h.current=Sf[Tf],Sf[Tf]=null,Tf--)}function G(h,i){Tf++,Sf[Tf]=h.current,h.current=i}var Vf={},H=Uf(Vf),Wf=Uf(!1),Xf=Vf;function Yf(h,i){var g=h.type.contextTypes;if(!g)return Vf;var _=h.stateNode;if(_&&_.__reactInternalMemoizedUnmaskedChildContext===i)return _.__reactInternalMemoizedMaskedChildContext;var j={},$;for($ in g)j[$]=i[$];return _&&(h=h.stateNode,h.__reactInternalMemoizedUnmaskedChildContext=i,h.__reactInternalMemoizedMaskedChildContext=j),j}function Zf(h){return h=h.childContextTypes,h!=null}function $f(){E(Wf),E(H)}function ag(h,i,g){if(H.current!==Vf)throw Error(p(168));G(H,i),G(Wf,g)}function bg(h,i,g){var _=h.stateNode;if(i=i.childContextTypes,typeof _.getChildContext!="function")return g;_=_.getChildContext();for(var j in _)if(!(j in i))throw Error(p(108,Ra(h)||"Unknown",j));return A({},g,_)}function cg(h){return h=(h=h.stateNode)&&h.__reactInternalMemoizedMergedChildContext||Vf,Xf=H.current,G(H,h),G(Wf,Wf.current),!0}function dg(h,i,g){var _=h.stateNode;if(!_)throw Error(p(169));g?(h=bg(h,i,Xf),_.__reactInternalMemoizedMergedChildContext=h,E(Wf),E(H),G(H,h)):E(Wf),G(Wf,g)}var eg=null,fg=!1,gg=!1;function hg(h){eg===null?eg=[h]:eg.push(h)}function ig(h){fg=!0,hg(h)}function jg(){if(!gg&&eg!==null){gg=!0;var h=0,i=C;try{var g=eg;for(C=1;h<g.length;h++){var _=g[h];do _=_(!0);while(_!==null)}eg=null,fg=!1}catch(j){throw eg!==null&&(eg=eg.slice(h+1)),ac(fc,jg),j}finally{C=i,gg=!1}}return null}var kg=[],lg=0,mg=null,ng=0,og=[],pg=0,qg=null,rg=1,sg="";function tg(h,i){kg[lg++]=ng,kg[lg++]=mg,mg=h,ng=i}function ug(h,i,g){og[pg++]=rg,og[pg++]=sg,og[pg++]=qg,qg=h;var _=rg;h=sg;var j=32-oc(_)-1;_&=~(1<<j),g+=1;var $=32-oc(i)+j;if(30<$){var _n=j-j%5;$=(_&(1<<_n)-1).toString(32),_>>=_n,j-=_n,rg=1<<32-oc(i)+j|g<<j|_,sg=$+h}else rg=1<<$|g<<j|_,sg=h}function vg(h){h.return!==null&&(tg(h,1),ug(h,1,0))}function wg(h){for(;h===mg;)mg=kg[--lg],kg[lg]=null,ng=kg[--lg],kg[lg]=null;for(;h===qg;)qg=og[--pg],og[pg]=null,sg=og[--pg],og[pg]=null,rg=og[--pg],og[pg]=null}var xg=null,yg=null,I=!1,zg=null;function Ag(h,i){var g=Bg(5,null,null,0);g.elementType="DELETED",g.stateNode=i,g.return=h,i=h.deletions,i===null?(h.deletions=[g],h.flags|=16):i.push(g)}function Cg(h,i){switch(h.tag){case 5:var g=h.type;return i=i.nodeType!==1||g.toLowerCase()!==i.nodeName.toLowerCase()?null:i,i!==null?(h.stateNode=i,xg=h,yg=Lf(i.firstChild),!0):!1;case 6:return i=h.pendingProps===""||i.nodeType!==3?null:i,i!==null?(h.stateNode=i,xg=h,yg=null,!0):!1;case 13:return i=i.nodeType!==8?null:i,i!==null?(g=qg!==null?{id:rg,overflow:sg}:null,h.memoizedState={dehydrated:i,treeContext:g,retryLane:1073741824},g=Bg(18,null,null,0),g.stateNode=i,g.return=h,h.child=g,xg=h,yg=null,!0):!1;default:return!1}}function Dg(h){return(h.mode&1)!==0&&(h.flags&128)===0}function Eg(h){if(I){var i=yg;if(i){var g=i;if(!Cg(h,i)){if(Dg(h))throw Error(p(418));i=Lf(g.nextSibling);var _=xg;i&&Cg(h,i)?Ag(_,g):(h.flags=h.flags&-4097|2,I=!1,xg=h)}}else{if(Dg(h))throw Error(p(418));h.flags=h.flags&-4097|2,I=!1,xg=h}}}function Fg(h){for(h=h.return;h!==null&&h.tag!==5&&h.tag!==3&&h.tag!==13;)h=h.return;xg=h}function Gg(h){if(h!==xg)return!1;if(!I)return Fg(h),I=!0,!1;var i;if((i=h.tag!==3)&&!(i=h.tag!==5)&&(i=h.type,i=i!=="head"&&i!=="body"&&!Ef(h.type,h.memoizedProps)),i&&(i=yg)){if(Dg(h))throw Hg(),Error(p(418));for(;i;)Ag(h,i),i=Lf(i.nextSibling)}if(Fg(h),h.tag===13){if(h=h.memoizedState,h=h!==null?h.dehydrated:null,!h)throw Error(p(317));e:{for(h=h.nextSibling,i=0;h;){if(h.nodeType===8){var g=h.data;if(g==="/$"){if(i===0){yg=Lf(h.nextSibling);break e}i--}else g!=="$"&&g!=="$!"&&g!=="$?"||i++}h=h.nextSibling}yg=null}}else yg=xg?Lf(h.stateNode.nextSibling):null;return!0}function Hg(){for(var h=yg;h;)h=Lf(h.nextSibling)}function Ig(){yg=xg=null,I=!1}function Jg(h){zg===null?zg=[h]:zg.push(h)}var Kg=ua.ReactCurrentBatchConfig;function Lg(h,i){if(h&&h.defaultProps){i=A({},i),h=h.defaultProps;for(var g in h)i[g]===void 0&&(i[g]=h[g]);return i}return i}var Mg=Uf(null),Ng=null,Og=null,Pg=null;function Qg(){Pg=Og=Ng=null}function Rg(h){var i=Mg.current;E(Mg),h._currentValue=i}function Sg(h,i,g){for(;h!==null;){var _=h.alternate;if((h.childLanes&i)!==i?(h.childLanes|=i,_!==null&&(_.childLanes|=i)):_!==null&&(_.childLanes&i)!==i&&(_.childLanes|=i),h===g)break;h=h.return}}function Tg(h,i){Ng=h,Pg=Og=null,h=h.dependencies,h!==null&&h.firstContext!==null&&(h.lanes&i&&(Ug=!0),h.firstContext=null)}function Vg(h){var i=h._currentValue;if(Pg!==h)if(h={context:h,memoizedValue:i,next:null},Og===null){if(Ng===null)throw Error(p(308));Og=h,Ng.dependencies={lanes:0,firstContext:h}}else Og=Og.next=h;return i}var Wg=null;function Xg(h){Wg===null?Wg=[h]:Wg.push(h)}function Yg(h,i,g,_){var j=i.interleaved;return j===null?(g.next=g,Xg(i)):(g.next=j.next,j.next=g),i.interleaved=g,Zg(h,_)}function Zg(h,i){h.lanes|=i;var g=h.alternate;for(g!==null&&(g.lanes|=i),g=h,h=h.return;h!==null;)h.childLanes|=i,g=h.alternate,g!==null&&(g.childLanes|=i),g=h,h=h.return;return g.tag===3?g.stateNode:null}var $g=!1;function ah(h){h.updateQueue={baseState:h.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function bh(h,i){h=h.updateQueue,i.updateQueue===h&&(i.updateQueue={baseState:h.baseState,firstBaseUpdate:h.firstBaseUpdate,lastBaseUpdate:h.lastBaseUpdate,shared:h.shared,effects:h.effects})}function ch(h,i){return{eventTime:h,lane:i,tag:0,payload:null,callback:null,next:null}}function dh(h,i,g){var _=h.updateQueue;if(_===null)return null;if(_=_.shared,K&2){var j=_.pending;return j===null?i.next=i:(i.next=j.next,j.next=i),_.pending=i,Zg(h,g)}return j=_.interleaved,j===null?(i.next=i,Xg(_)):(i.next=j.next,j.next=i),_.interleaved=i,Zg(h,g)}function eh(h,i,g){if(i=i.updateQueue,i!==null&&(i=i.shared,(g&4194240)!==0)){var _=i.lanes;_&=h.pendingLanes,g|=_,i.lanes=g,Cc(h,g)}}function fh(h,i){var g=h.updateQueue,_=h.alternate;if(_!==null&&(_=_.updateQueue,g===_)){var j=null,$=null;if(g=g.firstBaseUpdate,g!==null){do{var _n={eventTime:g.eventTime,lane:g.lane,tag:g.tag,payload:g.payload,callback:g.callback,next:null};$===null?j=$=_n:$=$.next=_n,g=g.next}while(g!==null);$===null?j=$=i:$=$.next=i}else j=$=i;g={baseState:_.baseState,firstBaseUpdate:j,lastBaseUpdate:$,shared:_.shared,effects:_.effects},h.updateQueue=g;return}h=g.lastBaseUpdate,h===null?g.firstBaseUpdate=i:h.next=i,g.lastBaseUpdate=i}function gh(h,i,g,_){var j=h.updateQueue;$g=!1;var $=j.firstBaseUpdate,_n=j.lastBaseUpdate,_i=j.shared.pending;if(_i!==null){j.shared.pending=null;var _s=_i,ga=_s.next;_s.next=null,_n===null?$=ga:_n.next=ga,_n=_s;var ba=h.alternate;ba!==null&&(ba=ba.updateQueue,_i=ba.lastBaseUpdate,_i!==_n&&(_i===null?ba.firstBaseUpdate=ga:_i.next=ga,ba.lastBaseUpdate=_s))}if($!==null){var xa=j.baseState;_n=0,ba=ga=_s=null,_i=$;do{var El=_i.lane,Tl=_i.eventTime;if((_&El)===El){ba!==null&&(ba=ba.next={eventTime:Tl,lane:0,tag:_i.tag,payload:_i.payload,callback:_i.callback,next:null});e:{var Sl=h,Il=_i;switch(El=i,Tl=g,Il.tag){case 1:if(Sl=Il.payload,typeof Sl=="function"){xa=Sl.call(Tl,xa,El);break e}xa=Sl;break e;case 3:Sl.flags=Sl.flags&-65537|128;case 0:if(Sl=Il.payload,El=typeof Sl=="function"?Sl.call(Tl,xa,El):Sl,El==null)break e;xa=A({},xa,El);break e;case 2:$g=!0}}_i.callback!==null&&_i.lane!==0&&(h.flags|=64,El=j.effects,El===null?j.effects=[_i]:El.push(_i))}else Tl={eventTime:Tl,lane:El,tag:_i.tag,payload:_i.payload,callback:_i.callback,next:null},ba===null?(ga=ba=Tl,_s=xa):ba=ba.next=Tl,_n|=El;if(_i=_i.next,_i===null){if(_i=j.shared.pending,_i===null)break;El=_i,_i=El.next,El.next=null,j.lastBaseUpdate=El,j.shared.pending=null}}while(1);if(ba===null&&(_s=xa),j.baseState=_s,j.firstBaseUpdate=ga,j.lastBaseUpdate=ba,i=j.shared.interleaved,i!==null){j=i;do _n|=j.lane,j=j.next;while(j!==i)}else $===null&&(j.shared.lanes=0);hh|=_n,h.lanes=_n,h.memoizedState=xa}}function ih(h,i,g){if(h=i.effects,i.effects=null,h!==null)for(i=0;i<h.length;i++){var _=h[i],j=_.callback;if(j!==null){if(_.callback=null,_=g,typeof j!="function")throw Error(p(191,j));j.call(_)}}}var jh=new aa.Component().refs;function kh(h,i,g,_){i=h.memoizedState,g=g(_,i),g=g==null?i:A({},i,g),h.memoizedState=g,h.lanes===0&&(h.updateQueue.baseState=g)}var nh={isMounted:function(h){return(h=h._reactInternals)?Vb(h)===h:!1},enqueueSetState:function(h,i,g){h=h._reactInternals;var _=L(),j=lh(h),$=ch(_,j);$.payload=i,g!=null&&($.callback=g),i=dh(h,$,j),i!==null&&(mh(i,h,j,_),eh(i,h,j))},enqueueReplaceState:function(h,i,g){h=h._reactInternals;var _=L(),j=lh(h),$=ch(_,j);$.tag=1,$.payload=i,g!=null&&($.callback=g),i=dh(h,$,j),i!==null&&(mh(i,h,j,_),eh(i,h,j))},enqueueForceUpdate:function(h,i){h=h._reactInternals;var g=L(),_=lh(h),j=ch(g,_);j.tag=2,i!=null&&(j.callback=i),i=dh(h,j,_),i!==null&&(mh(i,h,_,g),eh(i,h,_))}};function oh(h,i,g,_,j,$,_n){return h=h.stateNode,typeof h.shouldComponentUpdate=="function"?h.shouldComponentUpdate(_,$,_n):i.prototype&&i.prototype.isPureReactComponent?!Ie(g,_)||!Ie(j,$):!0}function ph(h,i,g){var _=!1,j=Vf,$=i.contextType;return typeof $=="object"&&$!==null?$=Vg($):(j=Zf(i)?Xf:H.current,_=i.contextTypes,$=(_=_!=null)?Yf(h,j):Vf),i=new i(g,$),h.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,i.updater=nh,h.stateNode=i,i._reactInternals=h,_&&(h=h.stateNode,h.__reactInternalMemoizedUnmaskedChildContext=j,h.__reactInternalMemoizedMaskedChildContext=$),i}function qh(h,i,g,_){h=i.state,typeof i.componentWillReceiveProps=="function"&&i.componentWillReceiveProps(g,_),typeof i.UNSAFE_componentWillReceiveProps=="function"&&i.UNSAFE_componentWillReceiveProps(g,_),i.state!==h&&nh.enqueueReplaceState(i,i.state,null)}function rh(h,i,g,_){var j=h.stateNode;j.props=g,j.state=h.memoizedState,j.refs=jh,ah(h);var $=i.contextType;typeof $=="object"&&$!==null?j.context=Vg($):($=Zf(i)?Xf:H.current,j.context=Yf(h,$)),j.state=h.memoizedState,$=i.getDerivedStateFromProps,typeof $=="function"&&(kh(h,i,$,g),j.state=h.memoizedState),typeof i.getDerivedStateFromProps=="function"||typeof j.getSnapshotBeforeUpdate=="function"||typeof j.UNSAFE_componentWillMount!="function"&&typeof j.componentWillMount!="function"||(i=j.state,typeof j.componentWillMount=="function"&&j.componentWillMount(),typeof j.UNSAFE_componentWillMount=="function"&&j.UNSAFE_componentWillMount(),i!==j.state&&nh.enqueueReplaceState(j,j.state,null),gh(h,g,j,_),j.state=h.memoizedState),typeof j.componentDidMount=="function"&&(h.flags|=4194308)}function sh(h,i,g){if(h=g.ref,h!==null&&typeof h!="function"&&typeof h!="object"){if(g._owner){if(g=g._owner,g){if(g.tag!==1)throw Error(p(309));var _=g.stateNode}if(!_)throw Error(p(147,h));var j=_,$=""+h;return i!==null&&i.ref!==null&&typeof i.ref=="function"&&i.ref._stringRef===$?i.ref:(i=function(_n){var _i=j.refs;_i===jh&&(_i=j.refs={}),_n===null?delete _i[$]:_i[$]=_n},i._stringRef=$,i)}if(typeof h!="string")throw Error(p(284));if(!g._owner)throw Error(p(290,h))}return h}function th(h,i){throw h=Object.prototype.toString.call(i),Error(p(31,h==="[object Object]"?"object with keys {"+Object.keys(i).join(", ")+"}":h))}function uh(h){var i=h._init;return i(h._payload)}function vh(h){function i(Nl,Dl){if(h){var Ul=Nl.deletions;Ul===null?(Nl.deletions=[Dl],Nl.flags|=16):Ul.push(Dl)}}function g(Nl,Dl){if(!h)return null;for(;Dl!==null;)i(Nl,Dl),Dl=Dl.sibling;return null}function _(Nl,Dl){for(Nl=new Map;Dl!==null;)Dl.key!==null?Nl.set(Dl.key,Dl):Nl.set(Dl.index,Dl),Dl=Dl.sibling;return Nl}function j(Nl,Dl){return Nl=wh(Nl,Dl),Nl.index=0,Nl.sibling=null,Nl}function $(Nl,Dl,Ul){return Nl.index=Ul,h?(Ul=Nl.alternate,Ul!==null?(Ul=Ul.index,Ul<Dl?(Nl.flags|=2,Dl):Ul):(Nl.flags|=2,Dl)):(Nl.flags|=1048576,Dl)}function _n(Nl){return h&&Nl.alternate===null&&(Nl.flags|=2),Nl}function _i(Nl,Dl,Ul,Kl){return Dl===null||Dl.tag!==6?(Dl=xh(Ul,Nl.mode,Kl),Dl.return=Nl,Dl):(Dl=j(Dl,Ul),Dl.return=Nl,Dl)}function _s(Nl,Dl,Ul,Kl){var Jl=Ul.type;return Jl===ya?ba(Nl,Dl,Ul.props.children,Kl,Ul.key):Dl!==null&&(Dl.elementType===Jl||typeof Jl=="object"&&Jl!==null&&Jl.$$typeof===Ha&&uh(Jl)===Dl.type)?(Kl=j(Dl,Ul.props),Kl.ref=sh(Nl,Dl,Ul),Kl.return=Nl,Kl):(Kl=yh(Ul.type,Ul.key,Ul.props,null,Nl.mode,Kl),Kl.ref=sh(Nl,Dl,Ul),Kl.return=Nl,Kl)}function ga(Nl,Dl,Ul,Kl){return Dl===null||Dl.tag!==4||Dl.stateNode.containerInfo!==Ul.containerInfo||Dl.stateNode.implementation!==Ul.implementation?(Dl=zh(Ul,Nl.mode,Kl),Dl.return=Nl,Dl):(Dl=j(Dl,Ul.children||[]),Dl.return=Nl,Dl)}function ba(Nl,Dl,Ul,Kl,Jl){return Dl===null||Dl.tag!==7?(Dl=Ah(Ul,Nl.mode,Kl,Jl),Dl.return=Nl,Dl):(Dl=j(Dl,Ul),Dl.return=Nl,Dl)}function xa(Nl,Dl,Ul){if(typeof Dl=="string"&&Dl!==""||typeof Dl=="number")return Dl=xh(""+Dl,Nl.mode,Ul),Dl.return=Nl,Dl;if(typeof Dl=="object"&&Dl!==null){switch(Dl.$$typeof){case va:return Ul=yh(Dl.type,Dl.key,Dl.props,null,Nl.mode,Ul),Ul.ref=sh(Nl,null,Dl),Ul.return=Nl,Ul;case wa:return Dl=zh(Dl,Nl.mode,Ul),Dl.return=Nl,Dl;case Ha:var Kl=Dl._init;return xa(Nl,Kl(Dl._payload),Ul)}if(eb(Dl)||Ka(Dl))return Dl=Ah(Dl,Nl.mode,Ul,null),Dl.return=Nl,Dl;th(Nl,Dl)}return null}function El(Nl,Dl,Ul,Kl){var Jl=Dl!==null?Dl.key:null;if(typeof Ul=="string"&&Ul!==""||typeof Ul=="number")return Jl!==null?null:_i(Nl,Dl,""+Ul,Kl);if(typeof Ul=="object"&&Ul!==null){switch(Ul.$$typeof){case va:return Ul.key===Jl?_s(Nl,Dl,Ul,Kl):null;case wa:return Ul.key===Jl?ga(Nl,Dl,Ul,Kl):null;case Ha:return Jl=Ul._init,El(Nl,Dl,Jl(Ul._payload),Kl)}if(eb(Ul)||Ka(Ul))return Jl!==null?null:ba(Nl,Dl,Ul,Kl,null);th(Nl,Ul)}return null}function Tl(Nl,Dl,Ul,Kl,Jl){if(typeof Kl=="string"&&Kl!==""||typeof Kl=="number")return Nl=Nl.get(Ul)||null,_i(Dl,Nl,""+Kl,Jl);if(typeof Kl=="object"&&Kl!==null){switch(Kl.$$typeof){case va:return Nl=Nl.get(Kl.key===null?Ul:Kl.key)||null,_s(Dl,Nl,Kl,Jl);case wa:return Nl=Nl.get(Kl.key===null?Ul:Kl.key)||null,ga(Dl,Nl,Kl,Jl);case Ha:var Ep=Kl._init;return Tl(Nl,Dl,Ul,Ep(Kl._payload),Jl)}if(eb(Kl)||Ka(Kl))return Nl=Nl.get(Ul)||null,ba(Dl,Nl,Kl,Jl,null);th(Dl,Kl)}return null}function Sl(Nl,Dl,Ul,Kl){for(var Jl=null,Ep=null,_p=Dl,Ip=Dl=0,Up=null;_p!==null&&Ip<Ul.length;Ip++){_p.index>Ip?(Up=_p,_p=null):Up=_p.sibling;var yp=El(Nl,_p,Ul[Ip],Kl);if(yp===null){_p===null&&(_p=Up);break}h&&_p&&yp.alternate===null&&i(Nl,_p),Dl=$(yp,Dl,Ip),Ep===null?Jl=yp:Ep.sibling=yp,Ep=yp,_p=Up}if(Ip===Ul.length)return g(Nl,_p),I&&tg(Nl,Ip),Jl;if(_p===null){for(;Ip<Ul.length;Ip++)_p=xa(Nl,Ul[Ip],Kl),_p!==null&&(Dl=$(_p,Dl,Ip),Ep===null?Jl=_p:Ep.sibling=_p,Ep=_p);return I&&tg(Nl,Ip),Jl}for(_p=_(Nl,_p);Ip<Ul.length;Ip++)Up=Tl(_p,Nl,Ip,Ul[Ip],Kl),Up!==null&&(h&&Up.alternate!==null&&_p.delete(Up.key===null?Ip:Up.key),Dl=$(Up,Dl,Ip),Ep===null?Jl=Up:Ep.sibling=Up,Ep=Up);return h&&_p.forEach(function(Ap){return i(Nl,Ap)}),I&&tg(Nl,Ip),Jl}function Il(Nl,Dl,Ul,Kl){var Jl=Ka(Ul);if(typeof Jl!="function")throw Error(p(150));if(Ul=Jl.call(Ul),Ul==null)throw Error(p(151));for(var Ep=Jl=null,_p=Dl,Ip=Dl=0,Up=null,yp=Ul.next();_p!==null&&!yp.done;Ip++,yp=Ul.next()){_p.index>Ip?(Up=_p,_p=null):Up=_p.sibling;var Ap=El(Nl,_p,yp.value,Kl);if(Ap===null){_p===null&&(_p=Up);break}h&&_p&&Ap.alternate===null&&i(Nl,_p),Dl=$(Ap,Dl,Ip),Ep===null?Jl=Ap:Ep.sibling=Ap,Ep=Ap,_p=Up}if(yp.done)return g(Nl,_p),I&&tg(Nl,Ip),Jl;if(_p===null){for(;!yp.done;Ip++,yp=Ul.next())yp=xa(Nl,yp.value,Kl),yp!==null&&(Dl=$(yp,Dl,Ip),Ep===null?Jl=yp:Ep.sibling=yp,Ep=yp);return I&&tg(Nl,Ip),Jl}for(_p=_(Nl,_p);!yp.done;Ip++,yp=Ul.next())yp=Tl(_p,Nl,Ip,yp.value,Kl),yp!==null&&(h&&yp.alternate!==null&&_p.delete(yp.key===null?Ip:yp.key),Dl=$(yp,Dl,Ip),Ep===null?Jl=yp:Ep.sibling=yp,Ep=yp);return h&&_p.forEach(function(Cp){return i(Nl,Cp)}),I&&tg(Nl,Ip),Jl}function Cl(Nl,Dl,Ul,Kl){if(typeof Ul=="object"&&Ul!==null&&Ul.type===ya&&Ul.key===null&&(Ul=Ul.props.children),typeof Ul=="object"&&Ul!==null){switch(Ul.$$typeof){case va:e:{for(var Jl=Ul.key,Ep=Dl;Ep!==null;){if(Ep.key===Jl){if(Jl=Ul.type,Jl===ya){if(Ep.tag===7){g(Nl,Ep.sibling),Dl=j(Ep,Ul.props.children),Dl.return=Nl,Nl=Dl;break e}}else if(Ep.elementType===Jl||typeof Jl=="object"&&Jl!==null&&Jl.$$typeof===Ha&&uh(Jl)===Ep.type){g(Nl,Ep.sibling),Dl=j(Ep,Ul.props),Dl.ref=sh(Nl,Ep,Ul),Dl.return=Nl,Nl=Dl;break e}g(Nl,Ep);break}else i(Nl,Ep);Ep=Ep.sibling}Ul.type===ya?(Dl=Ah(Ul.props.children,Nl.mode,Kl,Ul.key),Dl.return=Nl,Nl=Dl):(Kl=yh(Ul.type,Ul.key,Ul.props,null,Nl.mode,Kl),Kl.ref=sh(Nl,Dl,Ul),Kl.return=Nl,Nl=Kl)}return _n(Nl);case wa:e:{for(Ep=Ul.key;Dl!==null;){if(Dl.key===Ep)if(Dl.tag===4&&Dl.stateNode.containerInfo===Ul.containerInfo&&Dl.stateNode.implementation===Ul.implementation){g(Nl,Dl.sibling),Dl=j(Dl,Ul.children||[]),Dl.return=Nl,Nl=Dl;break e}else{g(Nl,Dl);break}else i(Nl,Dl);Dl=Dl.sibling}Dl=zh(Ul,Nl.mode,Kl),Dl.return=Nl,Nl=Dl}return _n(Nl);case Ha:return Ep=Ul._init,Cl(Nl,Dl,Ep(Ul._payload),Kl)}if(eb(Ul))return Sl(Nl,Dl,Ul,Kl);if(Ka(Ul))return Il(Nl,Dl,Ul,Kl);th(Nl,Ul)}return typeof Ul=="string"&&Ul!==""||typeof Ul=="number"?(Ul=""+Ul,Dl!==null&&Dl.tag===6?(g(Nl,Dl.sibling),Dl=j(Dl,Ul),Dl.return=Nl,Nl=Dl):(g(Nl,Dl),Dl=xh(Ul,Nl.mode,Kl),Dl.return=Nl,Nl=Dl),_n(Nl)):g(Nl,Dl)}return Cl}var Bh=vh(!0),Ch=vh(!1),Dh={},Eh=Uf(Dh),Fh=Uf(Dh),Gh=Uf(Dh);function Hh(h){if(h===Dh)throw Error(p(174));return h}function Ih(h,i){switch(G(Gh,i),G(Fh,h),G(Eh,Dh),h=i.nodeType,h){case 9:case 11:i=(i=i.documentElement)?i.namespaceURI:lb(null,"");break;default:h=h===8?i.parentNode:i,i=h.namespaceURI||null,h=h.tagName,i=lb(i,h)}E(Eh),G(Eh,i)}function Jh(){E(Eh),E(Fh),E(Gh)}function Kh(h){Hh(Gh.current);var i=Hh(Eh.current),g=lb(i,h.type);i!==g&&(G(Fh,h),G(Eh,g))}function Lh(h){Fh.current===h&&(E(Eh),E(Fh))}var M=Uf(0);function Mh(h){for(var i=h;i!==null;){if(i.tag===13){var g=i.memoizedState;if(g!==null&&(g=g.dehydrated,g===null||g.data==="$?"||g.data==="$!"))return i}else if(i.tag===19&&i.memoizedProps.revealOrder!==void 0){if(i.flags&128)return i}else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===h)break;for(;i.sibling===null;){if(i.return===null||i.return===h)return null;i=i.return}i.sibling.return=i.return,i=i.sibling}return null}var Nh=[];function Oh(){for(var h=0;h<Nh.length;h++)Nh[h]._workInProgressVersionPrimary=null;Nh.length=0}var Ph=ua.ReactCurrentDispatcher,Qh=ua.ReactCurrentBatchConfig,Rh=0,N=null,O=null,P=null,Sh=!1,Th=!1,Uh=0,Vh=0;function Q(){throw Error(p(321))}function Wh(h,i){if(i===null)return!1;for(var g=0;g<i.length&&g<h.length;g++)if(!He(h[g],i[g]))return!1;return!0}function Xh(h,i,g,_,j,$){if(Rh=$,N=i,i.memoizedState=null,i.updateQueue=null,i.lanes=0,Ph.current=h===null||h.memoizedState===null?Yh:Zh,h=g(_,j),Th){$=0;do{if(Th=!1,Uh=0,25<=$)throw Error(p(301));$+=1,P=O=null,i.updateQueue=null,Ph.current=$h,h=g(_,j)}while(Th)}if(Ph.current=ai,i=O!==null&&O.next!==null,Rh=0,P=O=N=null,Sh=!1,i)throw Error(p(300));return h}function bi(){var h=Uh!==0;return Uh=0,h}function ci(){var h={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return P===null?N.memoizedState=P=h:P=P.next=h,P}function di(){if(O===null){var h=N.alternate;h=h!==null?h.memoizedState:null}else h=O.next;var i=P===null?N.memoizedState:P.next;if(i!==null)P=i,O=h;else{if(h===null)throw Error(p(310));O=h,h={memoizedState:O.memoizedState,baseState:O.baseState,baseQueue:O.baseQueue,queue:O.queue,next:null},P===null?N.memoizedState=P=h:P=P.next=h}return P}function ei(h,i){return typeof i=="function"?i(h):i}function fi(h){var i=di(),g=i.queue;if(g===null)throw Error(p(311));g.lastRenderedReducer=h;var _=O,j=_.baseQueue,$=g.pending;if($!==null){if(j!==null){var _n=j.next;j.next=$.next,$.next=_n}_.baseQueue=j=$,g.pending=null}if(j!==null){$=j.next,_=_.baseState;var _i=_n=null,_s=null,ga=$;do{var ba=ga.lane;if((Rh&ba)===ba)_s!==null&&(_s=_s.next={lane:0,action:ga.action,hasEagerState:ga.hasEagerState,eagerState:ga.eagerState,next:null}),_=ga.hasEagerState?ga.eagerState:h(_,ga.action);else{var xa={lane:ba,action:ga.action,hasEagerState:ga.hasEagerState,eagerState:ga.eagerState,next:null};_s===null?(_i=_s=xa,_n=_):_s=_s.next=xa,N.lanes|=ba,hh|=ba}ga=ga.next}while(ga!==null&&ga!==$);_s===null?_n=_:_s.next=_i,He(_,i.memoizedState)||(Ug=!0),i.memoizedState=_,i.baseState=_n,i.baseQueue=_s,g.lastRenderedState=_}if(h=g.interleaved,h!==null){j=h;do $=j.lane,N.lanes|=$,hh|=$,j=j.next;while(j!==h)}else j===null&&(g.lanes=0);return[i.memoizedState,g.dispatch]}function gi(h){var i=di(),g=i.queue;if(g===null)throw Error(p(311));g.lastRenderedReducer=h;var _=g.dispatch,j=g.pending,$=i.memoizedState;if(j!==null){g.pending=null;var _n=j=j.next;do $=h($,_n.action),_n=_n.next;while(_n!==j);He($,i.memoizedState)||(Ug=!0),i.memoizedState=$,i.baseQueue===null&&(i.baseState=$),g.lastRenderedState=$}return[$,_]}function hi(){}function ii(h,i){var g=N,_=di(),j=i(),$=!He(_.memoizedState,j);if($&&(_.memoizedState=j,Ug=!0),_=_.queue,ji(ki.bind(null,g,_,h),[h]),_.getSnapshot!==i||$||P!==null&&P.memoizedState.tag&1){if(g.flags|=2048,li(9,mi.bind(null,g,_,j,i),void 0,null),R===null)throw Error(p(349));Rh&30||ni(g,i,j)}return j}function ni(h,i,g){h.flags|=16384,h={getSnapshot:i,value:g},i=N.updateQueue,i===null?(i={lastEffect:null,stores:null},N.updateQueue=i,i.stores=[h]):(g=i.stores,g===null?i.stores=[h]:g.push(h))}function mi(h,i,g,_){i.value=g,i.getSnapshot=_,oi(i)&&pi$3(h)}function ki(h,i,g){return g(function(){oi(i)&&pi$3(h)})}function oi(h){var i=h.getSnapshot;h=h.value;try{var g=i();return!He(h,g)}catch{return!0}}function pi$3(h){var i=Zg(h,1);i!==null&&mh(i,h,1,-1)}function qi(h){var i=ci();return typeof h=="function"&&(h=h()),i.memoizedState=i.baseState=h,h={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ei,lastRenderedState:h},i.queue=h,h=h.dispatch=ri.bind(null,N,h),[i.memoizedState,h]}function li(h,i,g,_){return h={tag:h,create:i,destroy:g,deps:_,next:null},i=N.updateQueue,i===null?(i={lastEffect:null,stores:null},N.updateQueue=i,i.lastEffect=h.next=h):(g=i.lastEffect,g===null?i.lastEffect=h.next=h:(_=g.next,g.next=h,h.next=_,i.lastEffect=h)),h}function si(){return di().memoizedState}function ti(h,i,g,_){var j=ci();N.flags|=h,j.memoizedState=li(1|i,g,void 0,_===void 0?null:_)}function ui(h,i,g,_){var j=di();_=_===void 0?null:_;var $=void 0;if(O!==null){var _n=O.memoizedState;if($=_n.destroy,_!==null&&Wh(_,_n.deps)){j.memoizedState=li(i,g,$,_);return}}N.flags|=h,j.memoizedState=li(1|i,g,$,_)}function vi(h,i){return ti(8390656,8,h,i)}function ji(h,i){return ui(2048,8,h,i)}function wi(h,i){return ui(4,2,h,i)}function xi(h,i){return ui(4,4,h,i)}function yi(h,i){if(typeof i=="function")return h=h(),i(h),function(){i(null)};if(i!=null)return h=h(),i.current=h,function(){i.current=null}}function zi(h,i,g){return g=g!=null?g.concat([h]):null,ui(4,4,yi.bind(null,i,h),g)}function Ai(){}function Bi(h,i){var g=di();i=i===void 0?null:i;var _=g.memoizedState;return _!==null&&i!==null&&Wh(i,_[1])?_[0]:(g.memoizedState=[h,i],h)}function Ci(h,i){var g=di();i=i===void 0?null:i;var _=g.memoizedState;return _!==null&&i!==null&&Wh(i,_[1])?_[0]:(h=h(),g.memoizedState=[h,i],h)}function Di(h,i,g){return Rh&21?(He(g,i)||(g=yc(),N.lanes|=g,hh|=g,h.baseState=!0),i):(h.baseState&&(h.baseState=!1,Ug=!0),h.memoizedState=g)}function Ei(h,i){var g=C;C=g!==0&&4>g?g:4,h(!0);var _=Qh.transition;Qh.transition={};try{h(!1),i()}finally{C=g,Qh.transition=_}}function Fi(){return di().memoizedState}function Gi(h,i,g){var _=lh(h);if(g={lane:_,action:g,hasEagerState:!1,eagerState:null,next:null},Hi(h))Ii(i,g);else if(g=Yg(h,i,g,_),g!==null){var j=L();mh(g,h,_,j),Ji(g,i,_)}}function ri(h,i,g){var _=lh(h),j={lane:_,action:g,hasEagerState:!1,eagerState:null,next:null};if(Hi(h))Ii(i,j);else{var $=h.alternate;if(h.lanes===0&&($===null||$.lanes===0)&&($=i.lastRenderedReducer,$!==null))try{var _n=i.lastRenderedState,_i=$(_n,g);if(j.hasEagerState=!0,j.eagerState=_i,He(_i,_n)){var _s=i.interleaved;_s===null?(j.next=j,Xg(i)):(j.next=_s.next,_s.next=j),i.interleaved=j;return}}catch{}finally{}g=Yg(h,i,j,_),g!==null&&(j=L(),mh(g,h,_,j),Ji(g,i,_))}}function Hi(h){var i=h.alternate;return h===N||i!==null&&i===N}function Ii(h,i){Th=Sh=!0;var g=h.pending;g===null?i.next=i:(i.next=g.next,g.next=i),h.pending=i}function Ji(h,i,g){if(g&4194240){var _=i.lanes;_&=h.pendingLanes,g|=_,i.lanes=g,Cc(h,g)}}var ai={readContext:Vg,useCallback:Q,useContext:Q,useEffect:Q,useImperativeHandle:Q,useInsertionEffect:Q,useLayoutEffect:Q,useMemo:Q,useReducer:Q,useRef:Q,useState:Q,useDebugValue:Q,useDeferredValue:Q,useTransition:Q,useMutableSource:Q,useSyncExternalStore:Q,useId:Q,unstable_isNewReconciler:!1},Yh={readContext:Vg,useCallback:function(h,i){return ci().memoizedState=[h,i===void 0?null:i],h},useContext:Vg,useEffect:vi,useImperativeHandle:function(h,i,g){return g=g!=null?g.concat([h]):null,ti(4194308,4,yi.bind(null,i,h),g)},useLayoutEffect:function(h,i){return ti(4194308,4,h,i)},useInsertionEffect:function(h,i){return ti(4,2,h,i)},useMemo:function(h,i){var g=ci();return i=i===void 0?null:i,h=h(),g.memoizedState=[h,i],h},useReducer:function(h,i,g){var _=ci();return i=g!==void 0?g(i):i,_.memoizedState=_.baseState=i,h={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:h,lastRenderedState:i},_.queue=h,h=h.dispatch=Gi.bind(null,N,h),[_.memoizedState,h]},useRef:function(h){var i=ci();return h={current:h},i.memoizedState=h},useState:qi,useDebugValue:Ai,useDeferredValue:function(h){return ci().memoizedState=h},useTransition:function(){var h=qi(!1),i=h[0];return h=Ei.bind(null,h[1]),ci().memoizedState=h,[i,h]},useMutableSource:function(){},useSyncExternalStore:function(h,i,g){var _=N,j=ci();if(I){if(g===void 0)throw Error(p(407));g=g()}else{if(g=i(),R===null)throw Error(p(349));Rh&30||ni(_,i,g)}j.memoizedState=g;var $={value:g,getSnapshot:i};return j.queue=$,vi(ki.bind(null,_,$,h),[h]),_.flags|=2048,li(9,mi.bind(null,_,$,g,i),void 0,null),g},useId:function(){var h=ci(),i=R.identifierPrefix;if(I){var g=sg,_=rg;g=(_&~(1<<32-oc(_)-1)).toString(32)+g,i=":"+i+"R"+g,g=Uh++,0<g&&(i+="H"+g.toString(32)),i+=":"}else g=Vh++,i=":"+i+"r"+g.toString(32)+":";return h.memoizedState=i},unstable_isNewReconciler:!1},Zh={readContext:Vg,useCallback:Bi,useContext:Vg,useEffect:ji,useImperativeHandle:zi,useInsertionEffect:wi,useLayoutEffect:xi,useMemo:Ci,useReducer:fi,useRef:si,useState:function(){return fi(ei)},useDebugValue:Ai,useDeferredValue:function(h){var i=di();return Di(i,O.memoizedState,h)},useTransition:function(){var h=fi(ei)[0],i=di().memoizedState;return[h,i]},useMutableSource:hi,useSyncExternalStore:ii,useId:Fi,unstable_isNewReconciler:!1},$h={readContext:Vg,useCallback:Bi,useContext:Vg,useEffect:ji,useImperativeHandle:zi,useInsertionEffect:wi,useLayoutEffect:xi,useMemo:Ci,useReducer:gi,useRef:si,useState:function(){return gi(ei)},useDebugValue:Ai,useDeferredValue:function(h){var i=di();return O===null?i.memoizedState=h:Di(i,O.memoizedState,h)},useTransition:function(){var h=gi(ei)[0],i=di().memoizedState;return[h,i]},useMutableSource:hi,useSyncExternalStore:ii,useId:Fi,unstable_isNewReconciler:!1};function Ki(h,i){try{var g="",_=i;do g+=Pa(_),_=_.return;while(_);var j=g}catch($){j=`
Error generating stack: `+$.message+`
`+$.stack}return{value:h,source:i,stack:j,digest:null}}function Li(h,i,g){return{value:h,source:null,stack:g??null,digest:i??null}}function Mi(h,i){try{console.error(i.value)}catch(g){setTimeout(function(){throw g})}}var Ni=typeof WeakMap=="function"?WeakMap:Map;function Oi(h,i,g){g=ch(-1,g),g.tag=3,g.payload={element:null};var _=i.value;return g.callback=function(){Pi||(Pi=!0,Qi=_),Mi(h,i)},g}function Ri(h,i,g){g=ch(-1,g),g.tag=3;var _=h.type.getDerivedStateFromError;if(typeof _=="function"){var j=i.value;g.payload=function(){return _(j)},g.callback=function(){Mi(h,i)}}var $=h.stateNode;return $!==null&&typeof $.componentDidCatch=="function"&&(g.callback=function(){Mi(h,i),typeof _!="function"&&(Si===null?Si=new Set([this]):Si.add(this));var _n=i.stack;this.componentDidCatch(i.value,{componentStack:_n!==null?_n:""})}),g}function Ti(h,i,g){var _=h.pingCache;if(_===null){_=h.pingCache=new Ni;var j=new Set;_.set(i,j)}else j=_.get(i),j===void 0&&(j=new Set,_.set(i,j));j.has(g)||(j.add(g),h=Ui.bind(null,h,i,g),i.then(h,h))}function Vi(h){do{var i;if((i=h.tag===13)&&(i=h.memoizedState,i=i!==null?i.dehydrated!==null:!0),i)return h;h=h.return}while(h!==null);return null}function Wi(h,i,g,_,j){return h.mode&1?(h.flags|=65536,h.lanes=j,h):(h===i?h.flags|=65536:(h.flags|=128,g.flags|=131072,g.flags&=-52805,g.tag===1&&(g.alternate===null?g.tag=17:(i=ch(-1,1),i.tag=2,dh(g,i,1))),g.lanes|=1),h)}var Xi=ua.ReactCurrentOwner,Ug=!1;function Yi(h,i,g,_){i.child=h===null?Ch(i,null,g,_):Bh(i,h.child,g,_)}function Zi(h,i,g,_,j){g=g.render;var $=i.ref;return Tg(i,j),_=Xh(h,i,g,_,$,j),g=bi(),h!==null&&!Ug?(i.updateQueue=h.updateQueue,i.flags&=-2053,h.lanes&=~j,$i(h,i,j)):(I&&g&&vg(i),i.flags|=1,Yi(h,i,_,j),i.child)}function aj(h,i,g,_,j){if(h===null){var $=g.type;return typeof $=="function"&&!bj($)&&$.defaultProps===void 0&&g.compare===null&&g.defaultProps===void 0?(i.tag=15,i.type=$,cj(h,i,$,_,j)):(h=yh(g.type,null,_,i,i.mode,j),h.ref=i.ref,h.return=i,i.child=h)}if($=h.child,!(h.lanes&j)){var _n=$.memoizedProps;if(g=g.compare,g=g!==null?g:Ie,g(_n,_)&&h.ref===i.ref)return $i(h,i,j)}return i.flags|=1,h=wh($,_),h.ref=i.ref,h.return=i,i.child=h}function cj(h,i,g,_,j){if(h!==null){var $=h.memoizedProps;if(Ie($,_)&&h.ref===i.ref)if(Ug=!1,i.pendingProps=_=$,(h.lanes&j)!==0)h.flags&131072&&(Ug=!0);else return i.lanes=h.lanes,$i(h,i,j)}return dj(h,i,g,_,j)}function ej(h,i,g){var _=i.pendingProps,j=_.children,$=h!==null?h.memoizedState:null;if(_.mode==="hidden")if(!(i.mode&1))i.memoizedState={baseLanes:0,cachePool:null,transitions:null},G(fj,gj),gj|=g;else{if(!(g&1073741824))return h=$!==null?$.baseLanes|g:g,i.lanes=i.childLanes=1073741824,i.memoizedState={baseLanes:h,cachePool:null,transitions:null},i.updateQueue=null,G(fj,gj),gj|=h,null;i.memoizedState={baseLanes:0,cachePool:null,transitions:null},_=$!==null?$.baseLanes:g,G(fj,gj),gj|=_}else $!==null?(_=$.baseLanes|g,i.memoizedState=null):_=g,G(fj,gj),gj|=_;return Yi(h,i,j,g),i.child}function hj(h,i){var g=i.ref;(h===null&&g!==null||h!==null&&h.ref!==g)&&(i.flags|=512,i.flags|=2097152)}function dj(h,i,g,_,j){var $=Zf(g)?Xf:H.current;return $=Yf(i,$),Tg(i,j),g=Xh(h,i,g,_,$,j),_=bi(),h!==null&&!Ug?(i.updateQueue=h.updateQueue,i.flags&=-2053,h.lanes&=~j,$i(h,i,j)):(I&&_&&vg(i),i.flags|=1,Yi(h,i,g,j),i.child)}function ij(h,i,g,_,j){if(Zf(g)){var $=!0;cg(i)}else $=!1;if(Tg(i,j),i.stateNode===null)jj(h,i),ph(i,g,_),rh(i,g,_,j),_=!0;else if(h===null){var _n=i.stateNode,_i=i.memoizedProps;_n.props=_i;var _s=_n.context,ga=g.contextType;typeof ga=="object"&&ga!==null?ga=Vg(ga):(ga=Zf(g)?Xf:H.current,ga=Yf(i,ga));var ba=g.getDerivedStateFromProps,xa=typeof ba=="function"||typeof _n.getSnapshotBeforeUpdate=="function";xa||typeof _n.UNSAFE_componentWillReceiveProps!="function"&&typeof _n.componentWillReceiveProps!="function"||(_i!==_||_s!==ga)&&qh(i,_n,_,ga),$g=!1;var El=i.memoizedState;_n.state=El,gh(i,_,_n,j),_s=i.memoizedState,_i!==_||El!==_s||Wf.current||$g?(typeof ba=="function"&&(kh(i,g,ba,_),_s=i.memoizedState),(_i=$g||oh(i,g,_i,_,El,_s,ga))?(xa||typeof _n.UNSAFE_componentWillMount!="function"&&typeof _n.componentWillMount!="function"||(typeof _n.componentWillMount=="function"&&_n.componentWillMount(),typeof _n.UNSAFE_componentWillMount=="function"&&_n.UNSAFE_componentWillMount()),typeof _n.componentDidMount=="function"&&(i.flags|=4194308)):(typeof _n.componentDidMount=="function"&&(i.flags|=4194308),i.memoizedProps=_,i.memoizedState=_s),_n.props=_,_n.state=_s,_n.context=ga,_=_i):(typeof _n.componentDidMount=="function"&&(i.flags|=4194308),_=!1)}else{_n=i.stateNode,bh(h,i),_i=i.memoizedProps,ga=i.type===i.elementType?_i:Lg(i.type,_i),_n.props=ga,xa=i.pendingProps,El=_n.context,_s=g.contextType,typeof _s=="object"&&_s!==null?_s=Vg(_s):(_s=Zf(g)?Xf:H.current,_s=Yf(i,_s));var Tl=g.getDerivedStateFromProps;(ba=typeof Tl=="function"||typeof _n.getSnapshotBeforeUpdate=="function")||typeof _n.UNSAFE_componentWillReceiveProps!="function"&&typeof _n.componentWillReceiveProps!="function"||(_i!==xa||El!==_s)&&qh(i,_n,_,_s),$g=!1,El=i.memoizedState,_n.state=El,gh(i,_,_n,j);var Sl=i.memoizedState;_i!==xa||El!==Sl||Wf.current||$g?(typeof Tl=="function"&&(kh(i,g,Tl,_),Sl=i.memoizedState),(ga=$g||oh(i,g,ga,_,El,Sl,_s)||!1)?(ba||typeof _n.UNSAFE_componentWillUpdate!="function"&&typeof _n.componentWillUpdate!="function"||(typeof _n.componentWillUpdate=="function"&&_n.componentWillUpdate(_,Sl,_s),typeof _n.UNSAFE_componentWillUpdate=="function"&&_n.UNSAFE_componentWillUpdate(_,Sl,_s)),typeof _n.componentDidUpdate=="function"&&(i.flags|=4),typeof _n.getSnapshotBeforeUpdate=="function"&&(i.flags|=1024)):(typeof _n.componentDidUpdate!="function"||_i===h.memoizedProps&&El===h.memoizedState||(i.flags|=4),typeof _n.getSnapshotBeforeUpdate!="function"||_i===h.memoizedProps&&El===h.memoizedState||(i.flags|=1024),i.memoizedProps=_,i.memoizedState=Sl),_n.props=_,_n.state=Sl,_n.context=_s,_=ga):(typeof _n.componentDidUpdate!="function"||_i===h.memoizedProps&&El===h.memoizedState||(i.flags|=4),typeof _n.getSnapshotBeforeUpdate!="function"||_i===h.memoizedProps&&El===h.memoizedState||(i.flags|=1024),_=!1)}return kj(h,i,g,_,$,j)}function kj(h,i,g,_,j,$){hj(h,i);var _n=(i.flags&128)!==0;if(!_&&!_n)return j&&dg(i,g,!1),$i(h,i,$);_=i.stateNode,Xi.current=i;var _i=_n&&typeof g.getDerivedStateFromError!="function"?null:_.render();return i.flags|=1,h!==null&&_n?(i.child=Bh(i,h.child,null,$),i.child=Bh(i,null,_i,$)):Yi(h,i,_i,$),i.memoizedState=_.state,j&&dg(i,g,!0),i.child}function lj(h){var i=h.stateNode;i.pendingContext?ag(h,i.pendingContext,i.pendingContext!==i.context):i.context&&ag(h,i.context,!1),Ih(h,i.containerInfo)}function mj(h,i,g,_,j){return Ig(),Jg(j),i.flags|=256,Yi(h,i,g,_),i.child}var nj={dehydrated:null,treeContext:null,retryLane:0};function oj(h){return{baseLanes:h,cachePool:null,transitions:null}}function pj(h,i,g){var _=i.pendingProps,j=M.current,$=!1,_n=(i.flags&128)!==0,_i;if((_i=_n)||(_i=h!==null&&h.memoizedState===null?!1:(j&2)!==0),_i?($=!0,i.flags&=-129):(h===null||h.memoizedState!==null)&&(j|=1),G(M,j&1),h===null)return Eg(i),h=i.memoizedState,h!==null&&(h=h.dehydrated,h!==null)?(i.mode&1?h.data==="$!"?i.lanes=8:i.lanes=1073741824:i.lanes=1,null):(_n=_.children,h=_.fallback,$?(_=i.mode,$=i.child,_n={mode:"hidden",children:_n},!(_&1)&&$!==null?($.childLanes=0,$.pendingProps=_n):$=qj(_n,_,0,null),h=Ah(h,_,g,null),$.return=i,h.return=i,$.sibling=h,i.child=$,i.child.memoizedState=oj(g),i.memoizedState=nj,h):rj(i,_n));if(j=h.memoizedState,j!==null&&(_i=j.dehydrated,_i!==null))return sj(h,i,_n,_,_i,j,g);if($){$=_.fallback,_n=i.mode,j=h.child,_i=j.sibling;var _s={mode:"hidden",children:_.children};return!(_n&1)&&i.child!==j?(_=i.child,_.childLanes=0,_.pendingProps=_s,i.deletions=null):(_=wh(j,_s),_.subtreeFlags=j.subtreeFlags&14680064),_i!==null?$=wh(_i,$):($=Ah($,_n,g,null),$.flags|=2),$.return=i,_.return=i,_.sibling=$,i.child=_,_=$,$=i.child,_n=h.child.memoizedState,_n=_n===null?oj(g):{baseLanes:_n.baseLanes|g,cachePool:null,transitions:_n.transitions},$.memoizedState=_n,$.childLanes=h.childLanes&~g,i.memoizedState=nj,_}return $=h.child,h=$.sibling,_=wh($,{mode:"visible",children:_.children}),!(i.mode&1)&&(_.lanes=g),_.return=i,_.sibling=null,h!==null&&(g=i.deletions,g===null?(i.deletions=[h],i.flags|=16):g.push(h)),i.child=_,i.memoizedState=null,_}function rj(h,i){return i=qj({mode:"visible",children:i},h.mode,0,null),i.return=h,h.child=i}function tj(h,i,g,_){return _!==null&&Jg(_),Bh(i,h.child,null,g),h=rj(i,i.pendingProps.children),h.flags|=2,i.memoizedState=null,h}function sj(h,i,g,_,j,$,_n){if(g)return i.flags&256?(i.flags&=-257,_=Li(Error(p(422))),tj(h,i,_n,_)):i.memoizedState!==null?(i.child=h.child,i.flags|=128,null):($=_.fallback,j=i.mode,_=qj({mode:"visible",children:_.children},j,0,null),$=Ah($,j,_n,null),$.flags|=2,_.return=i,$.return=i,_.sibling=$,i.child=_,i.mode&1&&Bh(i,h.child,null,_n),i.child.memoizedState=oj(_n),i.memoizedState=nj,$);if(!(i.mode&1))return tj(h,i,_n,null);if(j.data==="$!"){if(_=j.nextSibling&&j.nextSibling.dataset,_)var _i=_.dgst;return _=_i,$=Error(p(419)),_=Li($,_,void 0),tj(h,i,_n,_)}if(_i=(_n&h.childLanes)!==0,Ug||_i){if(_=R,_!==null){switch(_n&-_n){case 4:j=2;break;case 16:j=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:j=32;break;case 536870912:j=268435456;break;default:j=0}j=j&(_.suspendedLanes|_n)?0:j,j!==0&&j!==$.retryLane&&($.retryLane=j,Zg(h,j),mh(_,h,j,-1))}return uj(),_=Li(Error(p(421))),tj(h,i,_n,_)}return j.data==="$?"?(i.flags|=128,i.child=h.child,i=vj.bind(null,h),j._reactRetry=i,null):(h=$.treeContext,yg=Lf(j.nextSibling),xg=i,I=!0,zg=null,h!==null&&(og[pg++]=rg,og[pg++]=sg,og[pg++]=qg,rg=h.id,sg=h.overflow,qg=i),i=rj(i,_.children),i.flags|=4096,i)}function wj(h,i,g){h.lanes|=i;var _=h.alternate;_!==null&&(_.lanes|=i),Sg(h.return,i,g)}function xj(h,i,g,_,j){var $=h.memoizedState;$===null?h.memoizedState={isBackwards:i,rendering:null,renderingStartTime:0,last:_,tail:g,tailMode:j}:($.isBackwards=i,$.rendering=null,$.renderingStartTime=0,$.last=_,$.tail=g,$.tailMode=j)}function yj(h,i,g){var _=i.pendingProps,j=_.revealOrder,$=_.tail;if(Yi(h,i,_.children,g),_=M.current,_&2)_=_&1|2,i.flags|=128;else{if(h!==null&&h.flags&128)e:for(h=i.child;h!==null;){if(h.tag===13)h.memoizedState!==null&&wj(h,g,i);else if(h.tag===19)wj(h,g,i);else if(h.child!==null){h.child.return=h,h=h.child;continue}if(h===i)break e;for(;h.sibling===null;){if(h.return===null||h.return===i)break e;h=h.return}h.sibling.return=h.return,h=h.sibling}_&=1}if(G(M,_),!(i.mode&1))i.memoizedState=null;else switch(j){case"forwards":for(g=i.child,j=null;g!==null;)h=g.alternate,h!==null&&Mh(h)===null&&(j=g),g=g.sibling;g=j,g===null?(j=i.child,i.child=null):(j=g.sibling,g.sibling=null),xj(i,!1,j,g,$);break;case"backwards":for(g=null,j=i.child,i.child=null;j!==null;){if(h=j.alternate,h!==null&&Mh(h)===null){i.child=j;break}h=j.sibling,j.sibling=g,g=j,j=h}xj(i,!0,g,null,$);break;case"together":xj(i,!1,null,null,void 0);break;default:i.memoizedState=null}return i.child}function jj(h,i){!(i.mode&1)&&h!==null&&(h.alternate=null,i.alternate=null,i.flags|=2)}function $i(h,i,g){if(h!==null&&(i.dependencies=h.dependencies),hh|=i.lanes,!(g&i.childLanes))return null;if(h!==null&&i.child!==h.child)throw Error(p(153));if(i.child!==null){for(h=i.child,g=wh(h,h.pendingProps),i.child=g,g.return=i;h.sibling!==null;)h=h.sibling,g=g.sibling=wh(h,h.pendingProps),g.return=i;g.sibling=null}return i.child}function zj(h,i,g){switch(i.tag){case 3:lj(i),Ig();break;case 5:Kh(i);break;case 1:Zf(i.type)&&cg(i);break;case 4:Ih(i,i.stateNode.containerInfo);break;case 10:var _=i.type._context,j=i.memoizedProps.value;G(Mg,_._currentValue),_._currentValue=j;break;case 13:if(_=i.memoizedState,_!==null)return _.dehydrated!==null?(G(M,M.current&1),i.flags|=128,null):g&i.child.childLanes?pj(h,i,g):(G(M,M.current&1),h=$i(h,i,g),h!==null?h.sibling:null);G(M,M.current&1);break;case 19:if(_=(g&i.childLanes)!==0,h.flags&128){if(_)return yj(h,i,g);i.flags|=128}if(j=i.memoizedState,j!==null&&(j.rendering=null,j.tail=null,j.lastEffect=null),G(M,M.current),_)break;return null;case 22:case 23:return i.lanes=0,ej(h,i,g)}return $i(h,i,g)}var Aj,Bj,Cj,Dj;Aj=function(h,i){for(var g=i.child;g!==null;){if(g.tag===5||g.tag===6)h.appendChild(g.stateNode);else if(g.tag!==4&&g.child!==null){g.child.return=g,g=g.child;continue}if(g===i)break;for(;g.sibling===null;){if(g.return===null||g.return===i)return;g=g.return}g.sibling.return=g.return,g=g.sibling}};Bj=function(){};Cj=function(h,i,g,_){var j=h.memoizedProps;if(j!==_){h=i.stateNode,Hh(Eh.current);var $=null;switch(g){case"input":j=Ya(h,j),_=Ya(h,_),$=[];break;case"select":j=A({},j,{value:void 0}),_=A({},_,{value:void 0}),$=[];break;case"textarea":j=gb(h,j),_=gb(h,_),$=[];break;default:typeof j.onClick!="function"&&typeof _.onClick=="function"&&(h.onclick=Bf)}ub(g,_);var _n;g=null;for(ga in j)if(!_.hasOwnProperty(ga)&&j.hasOwnProperty(ga)&&j[ga]!=null)if(ga==="style"){var _i=j[ga];for(_n in _i)_i.hasOwnProperty(_n)&&(g||(g={}),g[_n]="")}else ga!=="dangerouslySetInnerHTML"&&ga!=="children"&&ga!=="suppressContentEditableWarning"&&ga!=="suppressHydrationWarning"&&ga!=="autoFocus"&&(ea.hasOwnProperty(ga)?$||($=[]):($=$||[]).push(ga,null));for(ga in _){var _s=_[ga];if(_i=j!=null?j[ga]:void 0,_.hasOwnProperty(ga)&&_s!==_i&&(_s!=null||_i!=null))if(ga==="style")if(_i){for(_n in _i)!_i.hasOwnProperty(_n)||_s&&_s.hasOwnProperty(_n)||(g||(g={}),g[_n]="");for(_n in _s)_s.hasOwnProperty(_n)&&_i[_n]!==_s[_n]&&(g||(g={}),g[_n]=_s[_n])}else g||($||($=[]),$.push(ga,g)),g=_s;else ga==="dangerouslySetInnerHTML"?(_s=_s?_s.__html:void 0,_i=_i?_i.__html:void 0,_s!=null&&_i!==_s&&($=$||[]).push(ga,_s)):ga==="children"?typeof _s!="string"&&typeof _s!="number"||($=$||[]).push(ga,""+_s):ga!=="suppressContentEditableWarning"&&ga!=="suppressHydrationWarning"&&(ea.hasOwnProperty(ga)?(_s!=null&&ga==="onScroll"&&D("scroll",h),$||_i===_s||($=[])):($=$||[]).push(ga,_s))}g&&($=$||[]).push("style",g);var ga=$;(i.updateQueue=ga)&&(i.flags|=4)}};Dj=function(h,i,g,_){g!==_&&(i.flags|=4)};function Ej(h,i){if(!I)switch(h.tailMode){case"hidden":i=h.tail;for(var g=null;i!==null;)i.alternate!==null&&(g=i),i=i.sibling;g===null?h.tail=null:g.sibling=null;break;case"collapsed":g=h.tail;for(var _=null;g!==null;)g.alternate!==null&&(_=g),g=g.sibling;_===null?i||h.tail===null?h.tail=null:h.tail.sibling=null:_.sibling=null}}function S(h){var i=h.alternate!==null&&h.alternate.child===h.child,g=0,_=0;if(i)for(var j=h.child;j!==null;)g|=j.lanes|j.childLanes,_|=j.subtreeFlags&14680064,_|=j.flags&14680064,j.return=h,j=j.sibling;else for(j=h.child;j!==null;)g|=j.lanes|j.childLanes,_|=j.subtreeFlags,_|=j.flags,j.return=h,j=j.sibling;return h.subtreeFlags|=_,h.childLanes=g,i}function Fj(h,i,g){var _=i.pendingProps;switch(wg(i),i.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return S(i),null;case 1:return Zf(i.type)&&$f(),S(i),null;case 3:return _=i.stateNode,Jh(),E(Wf),E(H),Oh(),_.pendingContext&&(_.context=_.pendingContext,_.pendingContext=null),(h===null||h.child===null)&&(Gg(i)?i.flags|=4:h===null||h.memoizedState.isDehydrated&&!(i.flags&256)||(i.flags|=1024,zg!==null&&(Gj(zg),zg=null))),Bj(h,i),S(i),null;case 5:Lh(i);var j=Hh(Gh.current);if(g=i.type,h!==null&&i.stateNode!=null)Cj(h,i,g,_,j),h.ref!==i.ref&&(i.flags|=512,i.flags|=2097152);else{if(!_){if(i.stateNode===null)throw Error(p(166));return S(i),null}if(h=Hh(Eh.current),Gg(i)){_=i.stateNode,g=i.type;var $=i.memoizedProps;switch(_[Of]=i,_[Pf]=$,h=(i.mode&1)!==0,g){case"dialog":D("cancel",_),D("close",_);break;case"iframe":case"object":case"embed":D("load",_);break;case"video":case"audio":for(j=0;j<lf.length;j++)D(lf[j],_);break;case"source":D("error",_);break;case"img":case"image":case"link":D("error",_),D("load",_);break;case"details":D("toggle",_);break;case"input":Za(_,$),D("invalid",_);break;case"select":_._wrapperState={wasMultiple:!!$.multiple},D("invalid",_);break;case"textarea":hb(_,$),D("invalid",_)}ub(g,$),j=null;for(var _n in $)if($.hasOwnProperty(_n)){var _i=$[_n];_n==="children"?typeof _i=="string"?_.textContent!==_i&&($.suppressHydrationWarning!==!0&&Af(_.textContent,_i,h),j=["children",_i]):typeof _i=="number"&&_.textContent!==""+_i&&($.suppressHydrationWarning!==!0&&Af(_.textContent,_i,h),j=["children",""+_i]):ea.hasOwnProperty(_n)&&_i!=null&&_n==="onScroll"&&D("scroll",_)}switch(g){case"input":Va(_),db(_,$,!0);break;case"textarea":Va(_),jb(_);break;case"select":case"option":break;default:typeof $.onClick=="function"&&(_.onclick=Bf)}_=j,i.updateQueue=_,_!==null&&(i.flags|=4)}else{_n=j.nodeType===9?j:j.ownerDocument,h==="http://www.w3.org/1999/xhtml"&&(h=kb(g)),h==="http://www.w3.org/1999/xhtml"?g==="script"?(h=_n.createElement("div"),h.innerHTML="<script><\/script>",h=h.removeChild(h.firstChild)):typeof _.is=="string"?h=_n.createElement(g,{is:_.is}):(h=_n.createElement(g),g==="select"&&(_n=h,_.multiple?_n.multiple=!0:_.size&&(_n.size=_.size))):h=_n.createElementNS(h,g),h[Of]=i,h[Pf]=_,Aj(h,i,!1,!1),i.stateNode=h;e:{switch(_n=vb(g,_),g){case"dialog":D("cancel",h),D("close",h),j=_;break;case"iframe":case"object":case"embed":D("load",h),j=_;break;case"video":case"audio":for(j=0;j<lf.length;j++)D(lf[j],h);j=_;break;case"source":D("error",h),j=_;break;case"img":case"image":case"link":D("error",h),D("load",h),j=_;break;case"details":D("toggle",h),j=_;break;case"input":Za(h,_),j=Ya(h,_),D("invalid",h);break;case"option":j=_;break;case"select":h._wrapperState={wasMultiple:!!_.multiple},j=A({},_,{value:void 0}),D("invalid",h);break;case"textarea":hb(h,_),j=gb(h,_),D("invalid",h);break;default:j=_}ub(g,j),_i=j;for($ in _i)if(_i.hasOwnProperty($)){var _s=_i[$];$==="style"?sb(h,_s):$==="dangerouslySetInnerHTML"?(_s=_s?_s.__html:void 0,_s!=null&&nb(h,_s)):$==="children"?typeof _s=="string"?(g!=="textarea"||_s!=="")&&ob(h,_s):typeof _s=="number"&&ob(h,""+_s):$!=="suppressContentEditableWarning"&&$!=="suppressHydrationWarning"&&$!=="autoFocus"&&(ea.hasOwnProperty($)?_s!=null&&$==="onScroll"&&D("scroll",h):_s!=null&&ta(h,$,_s,_n))}switch(g){case"input":Va(h),db(h,_,!1);break;case"textarea":Va(h),jb(h);break;case"option":_.value!=null&&h.setAttribute("value",""+Sa(_.value));break;case"select":h.multiple=!!_.multiple,$=_.value,$!=null?fb(h,!!_.multiple,$,!1):_.defaultValue!=null&&fb(h,!!_.multiple,_.defaultValue,!0);break;default:typeof j.onClick=="function"&&(h.onclick=Bf)}switch(g){case"button":case"input":case"select":case"textarea":_=!!_.autoFocus;break e;case"img":_=!0;break e;default:_=!1}}_&&(i.flags|=4)}i.ref!==null&&(i.flags|=512,i.flags|=2097152)}return S(i),null;case 6:if(h&&i.stateNode!=null)Dj(h,i,h.memoizedProps,_);else{if(typeof _!="string"&&i.stateNode===null)throw Error(p(166));if(g=Hh(Gh.current),Hh(Eh.current),Gg(i)){if(_=i.stateNode,g=i.memoizedProps,_[Of]=i,($=_.nodeValue!==g)&&(h=xg,h!==null))switch(h.tag){case 3:Af(_.nodeValue,g,(h.mode&1)!==0);break;case 5:h.memoizedProps.suppressHydrationWarning!==!0&&Af(_.nodeValue,g,(h.mode&1)!==0)}$&&(i.flags|=4)}else _=(g.nodeType===9?g:g.ownerDocument).createTextNode(_),_[Of]=i,i.stateNode=_}return S(i),null;case 13:if(E(M),_=i.memoizedState,h===null||h.memoizedState!==null&&h.memoizedState.dehydrated!==null){if(I&&yg!==null&&i.mode&1&&!(i.flags&128))Hg(),Ig(),i.flags|=98560,$=!1;else if($=Gg(i),_!==null&&_.dehydrated!==null){if(h===null){if(!$)throw Error(p(318));if($=i.memoizedState,$=$!==null?$.dehydrated:null,!$)throw Error(p(317));$[Of]=i}else Ig(),!(i.flags&128)&&(i.memoizedState=null),i.flags|=4;S(i),$=!1}else zg!==null&&(Gj(zg),zg=null),$=!0;if(!$)return i.flags&65536?i:null}return i.flags&128?(i.lanes=g,i):(_=_!==null,_!==(h!==null&&h.memoizedState!==null)&&_&&(i.child.flags|=8192,i.mode&1&&(h===null||M.current&1?T===0&&(T=3):uj())),i.updateQueue!==null&&(i.flags|=4),S(i),null);case 4:return Jh(),Bj(h,i),h===null&&sf(i.stateNode.containerInfo),S(i),null;case 10:return Rg(i.type._context),S(i),null;case 17:return Zf(i.type)&&$f(),S(i),null;case 19:if(E(M),$=i.memoizedState,$===null)return S(i),null;if(_=(i.flags&128)!==0,_n=$.rendering,_n===null)if(_)Ej($,!1);else{if(T!==0||h!==null&&h.flags&128)for(h=i.child;h!==null;){if(_n=Mh(h),_n!==null){for(i.flags|=128,Ej($,!1),_=_n.updateQueue,_!==null&&(i.updateQueue=_,i.flags|=4),i.subtreeFlags=0,_=g,g=i.child;g!==null;)$=g,h=_,$.flags&=14680066,_n=$.alternate,_n===null?($.childLanes=0,$.lanes=h,$.child=null,$.subtreeFlags=0,$.memoizedProps=null,$.memoizedState=null,$.updateQueue=null,$.dependencies=null,$.stateNode=null):($.childLanes=_n.childLanes,$.lanes=_n.lanes,$.child=_n.child,$.subtreeFlags=0,$.deletions=null,$.memoizedProps=_n.memoizedProps,$.memoizedState=_n.memoizedState,$.updateQueue=_n.updateQueue,$.type=_n.type,h=_n.dependencies,$.dependencies=h===null?null:{lanes:h.lanes,firstContext:h.firstContext}),g=g.sibling;return G(M,M.current&1|2),i.child}h=h.sibling}$.tail!==null&&B()>Hj&&(i.flags|=128,_=!0,Ej($,!1),i.lanes=4194304)}else{if(!_)if(h=Mh(_n),h!==null){if(i.flags|=128,_=!0,g=h.updateQueue,g!==null&&(i.updateQueue=g,i.flags|=4),Ej($,!0),$.tail===null&&$.tailMode==="hidden"&&!_n.alternate&&!I)return S(i),null}else 2*B()-$.renderingStartTime>Hj&&g!==1073741824&&(i.flags|=128,_=!0,Ej($,!1),i.lanes=4194304);$.isBackwards?(_n.sibling=i.child,i.child=_n):(g=$.last,g!==null?g.sibling=_n:i.child=_n,$.last=_n)}return $.tail!==null?(i=$.tail,$.rendering=i,$.tail=i.sibling,$.renderingStartTime=B(),i.sibling=null,g=M.current,G(M,_?g&1|2:g&1),i):(S(i),null);case 22:case 23:return Ij(),_=i.memoizedState!==null,h!==null&&h.memoizedState!==null!==_&&(i.flags|=8192),_&&i.mode&1?gj&1073741824&&(S(i),i.subtreeFlags&6&&(i.flags|=8192)):S(i),null;case 24:return null;case 25:return null}throw Error(p(156,i.tag))}function Jj(h,i){switch(wg(i),i.tag){case 1:return Zf(i.type)&&$f(),h=i.flags,h&65536?(i.flags=h&-65537|128,i):null;case 3:return Jh(),E(Wf),E(H),Oh(),h=i.flags,h&65536&&!(h&128)?(i.flags=h&-65537|128,i):null;case 5:return Lh(i),null;case 13:if(E(M),h=i.memoizedState,h!==null&&h.dehydrated!==null){if(i.alternate===null)throw Error(p(340));Ig()}return h=i.flags,h&65536?(i.flags=h&-65537|128,i):null;case 19:return E(M),null;case 4:return Jh(),null;case 10:return Rg(i.type._context),null;case 22:case 23:return Ij(),null;case 24:return null;default:return null}}var Kj=!1,U=!1,Lj=typeof WeakSet=="function"?WeakSet:Set,V=null;function Mj(h,i){var g=h.ref;if(g!==null)if(typeof g=="function")try{g(null)}catch(_){W(h,i,_)}else g.current=null}function Nj(h,i,g){try{g()}catch(_){W(h,i,_)}}var Oj=!1;function Pj(h,i){if(Cf=dd,h=Me(),Ne(h)){if("selectionStart"in h)var g={start:h.selectionStart,end:h.selectionEnd};else e:{g=(g=h.ownerDocument)&&g.defaultView||window;var _=g.getSelection&&g.getSelection();if(_&&_.rangeCount!==0){g=_.anchorNode;var j=_.anchorOffset,$=_.focusNode;_=_.focusOffset;try{g.nodeType,$.nodeType}catch{g=null;break e}var _n=0,_i=-1,_s=-1,ga=0,ba=0,xa=h,El=null;t:for(;;){for(var Tl;xa!==g||j!==0&&xa.nodeType!==3||(_i=_n+j),xa!==$||_!==0&&xa.nodeType!==3||(_s=_n+_),xa.nodeType===3&&(_n+=xa.nodeValue.length),(Tl=xa.firstChild)!==null;)El=xa,xa=Tl;for(;;){if(xa===h)break t;if(El===g&&++ga===j&&(_i=_n),El===$&&++ba===_&&(_s=_n),(Tl=xa.nextSibling)!==null)break;xa=El,El=xa.parentNode}xa=Tl}g=_i===-1||_s===-1?null:{start:_i,end:_s}}else g=null}g=g||{start:0,end:0}}else g=null;for(Df={focusedElem:h,selectionRange:g},dd=!1,V=i;V!==null;)if(i=V,h=i.child,(i.subtreeFlags&1028)!==0&&h!==null)h.return=i,V=h;else for(;V!==null;){i=V;try{var Sl=i.alternate;if(i.flags&1024)switch(i.tag){case 0:case 11:case 15:break;case 1:if(Sl!==null){var Il=Sl.memoizedProps,Cl=Sl.memoizedState,Nl=i.stateNode,Dl=Nl.getSnapshotBeforeUpdate(i.elementType===i.type?Il:Lg(i.type,Il),Cl);Nl.__reactInternalSnapshotBeforeUpdate=Dl}break;case 3:var Ul=i.stateNode.containerInfo;Ul.nodeType===1?Ul.textContent="":Ul.nodeType===9&&Ul.documentElement&&Ul.removeChild(Ul.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(p(163))}}catch(Kl){W(i,i.return,Kl)}if(h=i.sibling,h!==null){h.return=i.return,V=h;break}V=i.return}return Sl=Oj,Oj=!1,Sl}function Qj(h,i,g){var _=i.updateQueue;if(_=_!==null?_.lastEffect:null,_!==null){var j=_=_.next;do{if((j.tag&h)===h){var $=j.destroy;j.destroy=void 0,$!==void 0&&Nj(i,g,$)}j=j.next}while(j!==_)}}function Rj(h,i){if(i=i.updateQueue,i=i!==null?i.lastEffect:null,i!==null){var g=i=i.next;do{if((g.tag&h)===h){var _=g.create;g.destroy=_()}g=g.next}while(g!==i)}}function Sj(h){var i=h.ref;if(i!==null){var g=h.stateNode;switch(h.tag){case 5:h=g;break;default:h=g}typeof i=="function"?i(h):i.current=h}}function Tj(h){var i=h.alternate;i!==null&&(h.alternate=null,Tj(i)),h.child=null,h.deletions=null,h.sibling=null,h.tag===5&&(i=h.stateNode,i!==null&&(delete i[Of],delete i[Pf],delete i[of],delete i[Qf],delete i[Rf])),h.stateNode=null,h.return=null,h.dependencies=null,h.memoizedProps=null,h.memoizedState=null,h.pendingProps=null,h.stateNode=null,h.updateQueue=null}function Uj(h){return h.tag===5||h.tag===3||h.tag===4}function Vj(h){e:for(;;){for(;h.sibling===null;){if(h.return===null||Uj(h.return))return null;h=h.return}for(h.sibling.return=h.return,h=h.sibling;h.tag!==5&&h.tag!==6&&h.tag!==18;){if(h.flags&2||h.child===null||h.tag===4)continue e;h.child.return=h,h=h.child}if(!(h.flags&2))return h.stateNode}}function Wj(h,i,g){var _=h.tag;if(_===5||_===6)h=h.stateNode,i?g.nodeType===8?g.parentNode.insertBefore(h,i):g.insertBefore(h,i):(g.nodeType===8?(i=g.parentNode,i.insertBefore(h,g)):(i=g,i.appendChild(h)),g=g._reactRootContainer,g!=null||i.onclick!==null||(i.onclick=Bf));else if(_!==4&&(h=h.child,h!==null))for(Wj(h,i,g),h=h.sibling;h!==null;)Wj(h,i,g),h=h.sibling}function Xj(h,i,g){var _=h.tag;if(_===5||_===6)h=h.stateNode,i?g.insertBefore(h,i):g.appendChild(h);else if(_!==4&&(h=h.child,h!==null))for(Xj(h,i,g),h=h.sibling;h!==null;)Xj(h,i,g),h=h.sibling}var X=null,Yj=!1;function Zj(h,i,g){for(g=g.child;g!==null;)ak(h,i,g),g=g.sibling}function ak(h,i,g){if(lc&&typeof lc.onCommitFiberUnmount=="function")try{lc.onCommitFiberUnmount(kc,g)}catch{}switch(g.tag){case 5:U||Mj(g,i);case 6:var _=X,j=Yj;X=null,Zj(h,i,g),X=_,Yj=j,X!==null&&(Yj?(h=X,g=g.stateNode,h.nodeType===8?h.parentNode.removeChild(g):h.removeChild(g)):X.removeChild(g.stateNode));break;case 18:X!==null&&(Yj?(h=X,g=g.stateNode,h.nodeType===8?Kf(h.parentNode,g):h.nodeType===1&&Kf(h,g),bd(h)):Kf(X,g.stateNode));break;case 4:_=X,j=Yj,X=g.stateNode.containerInfo,Yj=!0,Zj(h,i,g),X=_,Yj=j;break;case 0:case 11:case 14:case 15:if(!U&&(_=g.updateQueue,_!==null&&(_=_.lastEffect,_!==null))){j=_=_.next;do{var $=j,_n=$.destroy;$=$.tag,_n!==void 0&&($&2||$&4)&&Nj(g,i,_n),j=j.next}while(j!==_)}Zj(h,i,g);break;case 1:if(!U&&(Mj(g,i),_=g.stateNode,typeof _.componentWillUnmount=="function"))try{_.props=g.memoizedProps,_.state=g.memoizedState,_.componentWillUnmount()}catch(_i){W(g,i,_i)}Zj(h,i,g);break;case 21:Zj(h,i,g);break;case 22:g.mode&1?(U=(_=U)||g.memoizedState!==null,Zj(h,i,g),U=_):Zj(h,i,g);break;default:Zj(h,i,g)}}function bk(h){var i=h.updateQueue;if(i!==null){h.updateQueue=null;var g=h.stateNode;g===null&&(g=h.stateNode=new Lj),i.forEach(function(_){var j=ck.bind(null,h,_);g.has(_)||(g.add(_),_.then(j,j))})}}function dk(h,i){var g=i.deletions;if(g!==null)for(var _=0;_<g.length;_++){var j=g[_];try{var $=h,_n=i,_i=_n;e:for(;_i!==null;){switch(_i.tag){case 5:X=_i.stateNode,Yj=!1;break e;case 3:X=_i.stateNode.containerInfo,Yj=!0;break e;case 4:X=_i.stateNode.containerInfo,Yj=!0;break e}_i=_i.return}if(X===null)throw Error(p(160));ak($,_n,j),X=null,Yj=!1;var _s=j.alternate;_s!==null&&(_s.return=null),j.return=null}catch(ga){W(j,i,ga)}}if(i.subtreeFlags&12854)for(i=i.child;i!==null;)ek(i,h),i=i.sibling}function ek(h,i){var g=h.alternate,_=h.flags;switch(h.tag){case 0:case 11:case 14:case 15:if(dk(i,h),fk(h),_&4){try{Qj(3,h,h.return),Rj(3,h)}catch(Il){W(h,h.return,Il)}try{Qj(5,h,h.return)}catch(Il){W(h,h.return,Il)}}break;case 1:dk(i,h),fk(h),_&512&&g!==null&&Mj(g,g.return);break;case 5:if(dk(i,h),fk(h),_&512&&g!==null&&Mj(g,g.return),h.flags&32){var j=h.stateNode;try{ob(j,"")}catch(Il){W(h,h.return,Il)}}if(_&4&&(j=h.stateNode,j!=null)){var $=h.memoizedProps,_n=g!==null?g.memoizedProps:$,_i=h.type,_s=h.updateQueue;if(h.updateQueue=null,_s!==null)try{_i==="input"&&$.type==="radio"&&$.name!=null&&ab(j,$),vb(_i,_n);var ga=vb(_i,$);for(_n=0;_n<_s.length;_n+=2){var ba=_s[_n],xa=_s[_n+1];ba==="style"?sb(j,xa):ba==="dangerouslySetInnerHTML"?nb(j,xa):ba==="children"?ob(j,xa):ta(j,ba,xa,ga)}switch(_i){case"input":bb(j,$);break;case"textarea":ib(j,$);break;case"select":var El=j._wrapperState.wasMultiple;j._wrapperState.wasMultiple=!!$.multiple;var Tl=$.value;Tl!=null?fb(j,!!$.multiple,Tl,!1):El!==!!$.multiple&&($.defaultValue!=null?fb(j,!!$.multiple,$.defaultValue,!0):fb(j,!!$.multiple,$.multiple?[]:"",!1))}j[Pf]=$}catch(Il){W(h,h.return,Il)}}break;case 6:if(dk(i,h),fk(h),_&4){if(h.stateNode===null)throw Error(p(162));j=h.stateNode,$=h.memoizedProps;try{j.nodeValue=$}catch(Il){W(h,h.return,Il)}}break;case 3:if(dk(i,h),fk(h),_&4&&g!==null&&g.memoizedState.isDehydrated)try{bd(i.containerInfo)}catch(Il){W(h,h.return,Il)}break;case 4:dk(i,h),fk(h);break;case 13:dk(i,h),fk(h),j=h.child,j.flags&8192&&($=j.memoizedState!==null,j.stateNode.isHidden=$,!$||j.alternate!==null&&j.alternate.memoizedState!==null||(gk=B())),_&4&&bk(h);break;case 22:if(ba=g!==null&&g.memoizedState!==null,h.mode&1?(U=(ga=U)||ba,dk(i,h),U=ga):dk(i,h),fk(h),_&8192){if(ga=h.memoizedState!==null,(h.stateNode.isHidden=ga)&&!ba&&h.mode&1)for(V=h,ba=h.child;ba!==null;){for(xa=V=ba;V!==null;){switch(El=V,Tl=El.child,El.tag){case 0:case 11:case 14:case 15:Qj(4,El,El.return);break;case 1:Mj(El,El.return);var Sl=El.stateNode;if(typeof Sl.componentWillUnmount=="function"){_=El,g=El.return;try{i=_,Sl.props=i.memoizedProps,Sl.state=i.memoizedState,Sl.componentWillUnmount()}catch(Il){W(_,g,Il)}}break;case 5:Mj(El,El.return);break;case 22:if(El.memoizedState!==null){hk(xa);continue}}Tl!==null?(Tl.return=El,V=Tl):hk(xa)}ba=ba.sibling}e:for(ba=null,xa=h;;){if(xa.tag===5){if(ba===null){ba=xa;try{j=xa.stateNode,ga?($=j.style,typeof $.setProperty=="function"?$.setProperty("display","none","important"):$.display="none"):(_i=xa.stateNode,_s=xa.memoizedProps.style,_n=_s!=null&&_s.hasOwnProperty("display")?_s.display:null,_i.style.display=rb("display",_n))}catch(Il){W(h,h.return,Il)}}}else if(xa.tag===6){if(ba===null)try{xa.stateNode.nodeValue=ga?"":xa.memoizedProps}catch(Il){W(h,h.return,Il)}}else if((xa.tag!==22&&xa.tag!==23||xa.memoizedState===null||xa===h)&&xa.child!==null){xa.child.return=xa,xa=xa.child;continue}if(xa===h)break e;for(;xa.sibling===null;){if(xa.return===null||xa.return===h)break e;ba===xa&&(ba=null),xa=xa.return}ba===xa&&(ba=null),xa.sibling.return=xa.return,xa=xa.sibling}}break;case 19:dk(i,h),fk(h),_&4&&bk(h);break;case 21:break;default:dk(i,h),fk(h)}}function fk(h){var i=h.flags;if(i&2){try{e:{for(var g=h.return;g!==null;){if(Uj(g)){var _=g;break e}g=g.return}throw Error(p(160))}switch(_.tag){case 5:var j=_.stateNode;_.flags&32&&(ob(j,""),_.flags&=-33);var $=Vj(h);Xj(h,$,j);break;case 3:case 4:var _n=_.stateNode.containerInfo,_i=Vj(h);Wj(h,_i,_n);break;default:throw Error(p(161))}}catch(_s){W(h,h.return,_s)}h.flags&=-3}i&4096&&(h.flags&=-4097)}function ik(h,i,g){V=h,jk(h)}function jk(h,i,g){for(var _=(h.mode&1)!==0;V!==null;){var j=V,$=j.child;if(j.tag===22&&_){var _n=j.memoizedState!==null||Kj;if(!_n){var _i=j.alternate,_s=_i!==null&&_i.memoizedState!==null||U;_i=Kj;var ga=U;if(Kj=_n,(U=_s)&&!ga)for(V=j;V!==null;)_n=V,_s=_n.child,_n.tag===22&&_n.memoizedState!==null?kk(j):_s!==null?(_s.return=_n,V=_s):kk(j);for(;$!==null;)V=$,jk($),$=$.sibling;V=j,Kj=_i,U=ga}lk(h)}else j.subtreeFlags&8772&&$!==null?($.return=j,V=$):lk(h)}}function lk(h){for(;V!==null;){var i=V;if(i.flags&8772){var g=i.alternate;try{if(i.flags&8772)switch(i.tag){case 0:case 11:case 15:U||Rj(5,i);break;case 1:var _=i.stateNode;if(i.flags&4&&!U)if(g===null)_.componentDidMount();else{var j=i.elementType===i.type?g.memoizedProps:Lg(i.type,g.memoizedProps);_.componentDidUpdate(j,g.memoizedState,_.__reactInternalSnapshotBeforeUpdate)}var $=i.updateQueue;$!==null&&ih(i,$,_);break;case 3:var _n=i.updateQueue;if(_n!==null){if(g=null,i.child!==null)switch(i.child.tag){case 5:g=i.child.stateNode;break;case 1:g=i.child.stateNode}ih(i,_n,g)}break;case 5:var _i=i.stateNode;if(g===null&&i.flags&4){g=_i;var _s=i.memoizedProps;switch(i.type){case"button":case"input":case"select":case"textarea":_s.autoFocus&&g.focus();break;case"img":_s.src&&(g.src=_s.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(i.memoizedState===null){var ga=i.alternate;if(ga!==null){var ba=ga.memoizedState;if(ba!==null){var xa=ba.dehydrated;xa!==null&&bd(xa)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(p(163))}U||i.flags&512&&Sj(i)}catch(El){W(i,i.return,El)}}if(i===h){V=null;break}if(g=i.sibling,g!==null){g.return=i.return,V=g;break}V=i.return}}function hk(h){for(;V!==null;){var i=V;if(i===h){V=null;break}var g=i.sibling;if(g!==null){g.return=i.return,V=g;break}V=i.return}}function kk(h){for(;V!==null;){var i=V;try{switch(i.tag){case 0:case 11:case 15:var g=i.return;try{Rj(4,i)}catch(_s){W(i,g,_s)}break;case 1:var _=i.stateNode;if(typeof _.componentDidMount=="function"){var j=i.return;try{_.componentDidMount()}catch(_s){W(i,j,_s)}}var $=i.return;try{Sj(i)}catch(_s){W(i,$,_s)}break;case 5:var _n=i.return;try{Sj(i)}catch(_s){W(i,_n,_s)}}}catch(_s){W(i,i.return,_s)}if(i===h){V=null;break}var _i=i.sibling;if(_i!==null){_i.return=i.return,V=_i;break}V=i.return}}var mk=Math.ceil,nk=ua.ReactCurrentDispatcher,ok=ua.ReactCurrentOwner,pk=ua.ReactCurrentBatchConfig,K=0,R=null,Y=null,Z=0,gj=0,fj=Uf(0),T=0,qk=null,hh=0,rk=0,sk=0,tk=null,uk=null,gk=0,Hj=1/0,vk=null,Pi=!1,Qi=null,Si=null,wk=!1,xk=null,yk=0,zk=0,Ak=null,Bk=-1,Ck=0;function L(){return K&6?B():Bk!==-1?Bk:Bk=B()}function lh(h){return h.mode&1?K&2&&Z!==0?Z&-Z:Kg.transition!==null?(Ck===0&&(Ck=yc()),Ck):(h=C,h!==0||(h=window.event,h=h===void 0?16:jd(h.type)),h):1}function mh(h,i,g,_){if(50<zk)throw zk=0,Ak=null,Error(p(185));Ac(h,g,_),(!(K&2)||h!==R)&&(h===R&&(!(K&2)&&(rk|=g),T===4&&Dk(h,Z)),Ek(h,_),g===1&&K===0&&!(i.mode&1)&&(Hj=B()+500,fg&&jg()))}function Ek(h,i){var g=h.callbackNode;wc(h,i);var _=uc(h,h===R?Z:0);if(_===0)g!==null&&bc(g),h.callbackNode=null,h.callbackPriority=0;else if(i=_&-_,h.callbackPriority!==i){if(g!=null&&bc(g),i===1)h.tag===0?ig(Fk.bind(null,h)):hg(Fk.bind(null,h)),Jf(function(){!(K&6)&&jg()}),g=null;else{switch(Dc(_)){case 1:g=fc;break;case 4:g=gc;break;case 16:g=hc;break;case 536870912:g=jc;break;default:g=hc}g=Gk(g,Hk.bind(null,h))}h.callbackPriority=i,h.callbackNode=g}}function Hk(h,i){if(Bk=-1,Ck=0,K&6)throw Error(p(327));var g=h.callbackNode;if(Ik()&&h.callbackNode!==g)return null;var _=uc(h,h===R?Z:0);if(_===0)return null;if(_&30||_&h.expiredLanes||i)i=Jk(h,_);else{i=_;var j=K;K|=2;var $=Kk();(R!==h||Z!==i)&&(vk=null,Hj=B()+500,Lk(h,i));do try{Mk();break}catch(_i){Nk(h,_i)}while(1);Qg(),nk.current=$,K=j,Y!==null?i=0:(R=null,Z=0,i=T)}if(i!==0){if(i===2&&(j=xc(h),j!==0&&(_=j,i=Ok(h,j))),i===1)throw g=qk,Lk(h,0),Dk(h,_),Ek(h,B()),g;if(i===6)Dk(h,_);else{if(j=h.current.alternate,!(_&30)&&!Pk(j)&&(i=Jk(h,_),i===2&&($=xc(h),$!==0&&(_=$,i=Ok(h,$))),i===1))throw g=qk,Lk(h,0),Dk(h,_),Ek(h,B()),g;switch(h.finishedWork=j,h.finishedLanes=_,i){case 0:case 1:throw Error(p(345));case 2:Qk(h,uk,vk);break;case 3:if(Dk(h,_),(_&130023424)===_&&(i=gk+500-B(),10<i)){if(uc(h,0)!==0)break;if(j=h.suspendedLanes,(j&_)!==_){L(),h.pingedLanes|=h.suspendedLanes&j;break}h.timeoutHandle=Ff(Qk.bind(null,h,uk,vk),i);break}Qk(h,uk,vk);break;case 4:if(Dk(h,_),(_&4194240)===_)break;for(i=h.eventTimes,j=-1;0<_;){var _n=31-oc(_);$=1<<_n,_n=i[_n],_n>j&&(j=_n),_&=~$}if(_=j,_=B()-_,_=(120>_?120:480>_?480:1080>_?1080:1920>_?1920:3e3>_?3e3:4320>_?4320:1960*mk(_/1960))-_,10<_){h.timeoutHandle=Ff(Qk.bind(null,h,uk,vk),_);break}Qk(h,uk,vk);break;case 5:Qk(h,uk,vk);break;default:throw Error(p(329))}}}return Ek(h,B()),h.callbackNode===g?Hk.bind(null,h):null}function Ok(h,i){var g=tk;return h.current.memoizedState.isDehydrated&&(Lk(h,i).flags|=256),h=Jk(h,i),h!==2&&(i=uk,uk=g,i!==null&&Gj(i)),h}function Gj(h){uk===null?uk=h:uk.push.apply(uk,h)}function Pk(h){for(var i=h;;){if(i.flags&16384){var g=i.updateQueue;if(g!==null&&(g=g.stores,g!==null))for(var _=0;_<g.length;_++){var j=g[_],$=j.getSnapshot;j=j.value;try{if(!He($(),j))return!1}catch{return!1}}}if(g=i.child,i.subtreeFlags&16384&&g!==null)g.return=i,i=g;else{if(i===h)break;for(;i.sibling===null;){if(i.return===null||i.return===h)return!0;i=i.return}i.sibling.return=i.return,i=i.sibling}}return!0}function Dk(h,i){for(i&=~sk,i&=~rk,h.suspendedLanes|=i,h.pingedLanes&=~i,h=h.expirationTimes;0<i;){var g=31-oc(i),_=1<<g;h[g]=-1,i&=~_}}function Fk(h){if(K&6)throw Error(p(327));Ik();var i=uc(h,0);if(!(i&1))return Ek(h,B()),null;var g=Jk(h,i);if(h.tag!==0&&g===2){var _=xc(h);_!==0&&(i=_,g=Ok(h,_))}if(g===1)throw g=qk,Lk(h,0),Dk(h,i),Ek(h,B()),g;if(g===6)throw Error(p(345));return h.finishedWork=h.current.alternate,h.finishedLanes=i,Qk(h,uk,vk),Ek(h,B()),null}function Rk(h,i){var g=K;K|=1;try{return h(i)}finally{K=g,K===0&&(Hj=B()+500,fg&&jg())}}function Sk(h){xk!==null&&xk.tag===0&&!(K&6)&&Ik();var i=K;K|=1;var g=pk.transition,_=C;try{if(pk.transition=null,C=1,h)return h()}finally{C=_,pk.transition=g,K=i,!(K&6)&&jg()}}function Ij(){gj=fj.current,E(fj)}function Lk(h,i){h.finishedWork=null,h.finishedLanes=0;var g=h.timeoutHandle;if(g!==-1&&(h.timeoutHandle=-1,Gf(g)),Y!==null)for(g=Y.return;g!==null;){var _=g;switch(wg(_),_.tag){case 1:_=_.type.childContextTypes,_!=null&&$f();break;case 3:Jh(),E(Wf),E(H),Oh();break;case 5:Lh(_);break;case 4:Jh();break;case 13:E(M);break;case 19:E(M);break;case 10:Rg(_.type._context);break;case 22:case 23:Ij()}g=g.return}if(R=h,Y=h=wh(h.current,null),Z=gj=i,T=0,qk=null,sk=rk=hh=0,uk=tk=null,Wg!==null){for(i=0;i<Wg.length;i++)if(g=Wg[i],_=g.interleaved,_!==null){g.interleaved=null;var j=_.next,$=g.pending;if($!==null){var _n=$.next;$.next=j,_.next=_n}g.pending=_}Wg=null}return h}function Nk(h,i){do{var g=Y;try{if(Qg(),Ph.current=ai,Sh){for(var _=N.memoizedState;_!==null;){var j=_.queue;j!==null&&(j.pending=null),_=_.next}Sh=!1}if(Rh=0,P=O=N=null,Th=!1,Uh=0,ok.current=null,g===null||g.return===null){T=1,qk=i,Y=null;break}e:{var $=h,_n=g.return,_i=g,_s=i;if(i=Z,_i.flags|=32768,_s!==null&&typeof _s=="object"&&typeof _s.then=="function"){var ga=_s,ba=_i,xa=ba.tag;if(!(ba.mode&1)&&(xa===0||xa===11||xa===15)){var El=ba.alternate;El?(ba.updateQueue=El.updateQueue,ba.memoizedState=El.memoizedState,ba.lanes=El.lanes):(ba.updateQueue=null,ba.memoizedState=null)}var Tl=Vi(_n);if(Tl!==null){Tl.flags&=-257,Wi(Tl,_n,_i,$,i),Tl.mode&1&&Ti($,ga,i),i=Tl,_s=ga;var Sl=i.updateQueue;if(Sl===null){var Il=new Set;Il.add(_s),i.updateQueue=Il}else Sl.add(_s);break e}else{if(!(i&1)){Ti($,ga,i),uj();break e}_s=Error(p(426))}}else if(I&&_i.mode&1){var Cl=Vi(_n);if(Cl!==null){!(Cl.flags&65536)&&(Cl.flags|=256),Wi(Cl,_n,_i,$,i),Jg(Ki(_s,_i));break e}}$=_s=Ki(_s,_i),T!==4&&(T=2),tk===null?tk=[$]:tk.push($),$=_n;do{switch($.tag){case 3:$.flags|=65536,i&=-i,$.lanes|=i;var Nl=Oi($,_s,i);fh($,Nl);break e;case 1:_i=_s;var Dl=$.type,Ul=$.stateNode;if(!($.flags&128)&&(typeof Dl.getDerivedStateFromError=="function"||Ul!==null&&typeof Ul.componentDidCatch=="function"&&(Si===null||!Si.has(Ul)))){$.flags|=65536,i&=-i,$.lanes|=i;var Kl=Ri($,_i,i);fh($,Kl);break e}}$=$.return}while($!==null)}Tk(g)}catch(Jl){i=Jl,Y===g&&g!==null&&(Y=g=g.return);continue}break}while(1)}function Kk(){var h=nk.current;return nk.current=ai,h===null?ai:h}function uj(){(T===0||T===3||T===2)&&(T=4),R===null||!(hh&268435455)&&!(rk&268435455)||Dk(R,Z)}function Jk(h,i){var g=K;K|=2;var _=Kk();(R!==h||Z!==i)&&(vk=null,Lk(h,i));do try{Uk();break}catch(j){Nk(h,j)}while(1);if(Qg(),K=g,nk.current=_,Y!==null)throw Error(p(261));return R=null,Z=0,T}function Uk(){for(;Y!==null;)Vk(Y)}function Mk(){for(;Y!==null&&!cc();)Vk(Y)}function Vk(h){var i=Wk(h.alternate,h,gj);h.memoizedProps=h.pendingProps,i===null?Tk(h):Y=i,ok.current=null}function Tk(h){var i=h;do{var g=i.alternate;if(h=i.return,i.flags&32768){if(g=Jj(g,i),g!==null){g.flags&=32767,Y=g;return}if(h!==null)h.flags|=32768,h.subtreeFlags=0,h.deletions=null;else{T=6,Y=null;return}}else if(g=Fj(g,i,gj),g!==null){Y=g;return}if(i=i.sibling,i!==null){Y=i;return}Y=i=h}while(i!==null);T===0&&(T=5)}function Qk(h,i,g){var _=C,j=pk.transition;try{pk.transition=null,C=1,Xk(h,i,g,_)}finally{pk.transition=j,C=_}return null}function Xk(h,i,g,_){do Ik();while(xk!==null);if(K&6)throw Error(p(327));g=h.finishedWork;var j=h.finishedLanes;if(g===null)return null;if(h.finishedWork=null,h.finishedLanes=0,g===h.current)throw Error(p(177));h.callbackNode=null,h.callbackPriority=0;var $=g.lanes|g.childLanes;if(Bc(h,$),h===R&&(Y=R=null,Z=0),!(g.subtreeFlags&2064)&&!(g.flags&2064)||wk||(wk=!0,Gk(hc,function(){return Ik(),null})),$=(g.flags&15990)!==0,g.subtreeFlags&15990||$){$=pk.transition,pk.transition=null;var _n=C;C=1;var _i=K;K|=4,ok.current=null,Pj(h,g),ek(g,h),Oe(Df),dd=!!Cf,Df=Cf=null,h.current=g,ik(g),dc(),K=_i,C=_n,pk.transition=$}else h.current=g;if(wk&&(wk=!1,xk=h,yk=j),$=h.pendingLanes,$===0&&(Si=null),mc(g.stateNode),Ek(h,B()),i!==null)for(_=h.onRecoverableError,g=0;g<i.length;g++)j=i[g],_(j.value,{componentStack:j.stack,digest:j.digest});if(Pi)throw Pi=!1,h=Qi,Qi=null,h;return yk&1&&h.tag!==0&&Ik(),$=h.pendingLanes,$&1?h===Ak?zk++:(zk=0,Ak=h):zk=0,jg(),null}function Ik(){if(xk!==null){var h=Dc(yk),i=pk.transition,g=C;try{if(pk.transition=null,C=16>h?16:h,xk===null)var _=!1;else{if(h=xk,xk=null,yk=0,K&6)throw Error(p(331));var j=K;for(K|=4,V=h.current;V!==null;){var $=V,_n=$.child;if(V.flags&16){var _i=$.deletions;if(_i!==null){for(var _s=0;_s<_i.length;_s++){var ga=_i[_s];for(V=ga;V!==null;){var ba=V;switch(ba.tag){case 0:case 11:case 15:Qj(8,ba,$)}var xa=ba.child;if(xa!==null)xa.return=ba,V=xa;else for(;V!==null;){ba=V;var El=ba.sibling,Tl=ba.return;if(Tj(ba),ba===ga){V=null;break}if(El!==null){El.return=Tl,V=El;break}V=Tl}}}var Sl=$.alternate;if(Sl!==null){var Il=Sl.child;if(Il!==null){Sl.child=null;do{var Cl=Il.sibling;Il.sibling=null,Il=Cl}while(Il!==null)}}V=$}}if($.subtreeFlags&2064&&_n!==null)_n.return=$,V=_n;else e:for(;V!==null;){if($=V,$.flags&2048)switch($.tag){case 0:case 11:case 15:Qj(9,$,$.return)}var Nl=$.sibling;if(Nl!==null){Nl.return=$.return,V=Nl;break e}V=$.return}}var Dl=h.current;for(V=Dl;V!==null;){_n=V;var Ul=_n.child;if(_n.subtreeFlags&2064&&Ul!==null)Ul.return=_n,V=Ul;else e:for(_n=Dl;V!==null;){if(_i=V,_i.flags&2048)try{switch(_i.tag){case 0:case 11:case 15:Rj(9,_i)}}catch(Jl){W(_i,_i.return,Jl)}if(_i===_n){V=null;break e}var Kl=_i.sibling;if(Kl!==null){Kl.return=_i.return,V=Kl;break e}V=_i.return}}if(K=j,jg(),lc&&typeof lc.onPostCommitFiberRoot=="function")try{lc.onPostCommitFiberRoot(kc,h)}catch{}_=!0}return _}finally{C=g,pk.transition=i}}return!1}function Yk(h,i,g){i=Ki(g,i),i=Oi(h,i,1),h=dh(h,i,1),i=L(),h!==null&&(Ac(h,1,i),Ek(h,i))}function W(h,i,g){if(h.tag===3)Yk(h,h,g);else for(;i!==null;){if(i.tag===3){Yk(i,h,g);break}else if(i.tag===1){var _=i.stateNode;if(typeof i.type.getDerivedStateFromError=="function"||typeof _.componentDidCatch=="function"&&(Si===null||!Si.has(_))){h=Ki(g,h),h=Ri(i,h,1),i=dh(i,h,1),h=L(),i!==null&&(Ac(i,1,h),Ek(i,h));break}}i=i.return}}function Ui(h,i,g){var _=h.pingCache;_!==null&&_.delete(i),i=L(),h.pingedLanes|=h.suspendedLanes&g,R===h&&(Z&g)===g&&(T===4||T===3&&(Z&130023424)===Z&&500>B()-gk?Lk(h,0):sk|=g),Ek(h,i)}function Zk(h,i){i===0&&(h.mode&1?(i=sc,sc<<=1,!(sc&130023424)&&(sc=4194304)):i=1);var g=L();h=Zg(h,i),h!==null&&(Ac(h,i,g),Ek(h,g))}function vj(h){var i=h.memoizedState,g=0;i!==null&&(g=i.retryLane),Zk(h,g)}function ck(h,i){var g=0;switch(h.tag){case 13:var _=h.stateNode,j=h.memoizedState;j!==null&&(g=j.retryLane);break;case 19:_=h.stateNode;break;default:throw Error(p(314))}_!==null&&_.delete(i),Zk(h,g)}var Wk;Wk=function(h,i,g){if(h!==null)if(h.memoizedProps!==i.pendingProps||Wf.current)Ug=!0;else{if(!(h.lanes&g)&&!(i.flags&128))return Ug=!1,zj(h,i,g);Ug=!!(h.flags&131072)}else Ug=!1,I&&i.flags&1048576&&ug(i,ng,i.index);switch(i.lanes=0,i.tag){case 2:var _=i.type;jj(h,i),h=i.pendingProps;var j=Yf(i,H.current);Tg(i,g),j=Xh(null,i,_,h,j,g);var $=bi();return i.flags|=1,typeof j=="object"&&j!==null&&typeof j.render=="function"&&j.$$typeof===void 0?(i.tag=1,i.memoizedState=null,i.updateQueue=null,Zf(_)?($=!0,cg(i)):$=!1,i.memoizedState=j.state!==null&&j.state!==void 0?j.state:null,ah(i),j.updater=nh,i.stateNode=j,j._reactInternals=i,rh(i,_,h,g),i=kj(null,i,_,!0,$,g)):(i.tag=0,I&&$&&vg(i),Yi(null,i,j,g),i=i.child),i;case 16:_=i.elementType;e:{switch(jj(h,i),h=i.pendingProps,j=_._init,_=j(_._payload),i.type=_,j=i.tag=$k(_),h=Lg(_,h),j){case 0:i=dj(null,i,_,h,g);break e;case 1:i=ij(null,i,_,h,g);break e;case 11:i=Zi(null,i,_,h,g);break e;case 14:i=aj(null,i,_,Lg(_.type,h),g);break e}throw Error(p(306,_,""))}return i;case 0:return _=i.type,j=i.pendingProps,j=i.elementType===_?j:Lg(_,j),dj(h,i,_,j,g);case 1:return _=i.type,j=i.pendingProps,j=i.elementType===_?j:Lg(_,j),ij(h,i,_,j,g);case 3:e:{if(lj(i),h===null)throw Error(p(387));_=i.pendingProps,$=i.memoizedState,j=$.element,bh(h,i),gh(i,_,null,g);var _n=i.memoizedState;if(_=_n.element,$.isDehydrated)if($={element:_,isDehydrated:!1,cache:_n.cache,pendingSuspenseBoundaries:_n.pendingSuspenseBoundaries,transitions:_n.transitions},i.updateQueue.baseState=$,i.memoizedState=$,i.flags&256){j=Ki(Error(p(423)),i),i=mj(h,i,_,g,j);break e}else if(_!==j){j=Ki(Error(p(424)),i),i=mj(h,i,_,g,j);break e}else for(yg=Lf(i.stateNode.containerInfo.firstChild),xg=i,I=!0,zg=null,g=Ch(i,null,_,g),i.child=g;g;)g.flags=g.flags&-3|4096,g=g.sibling;else{if(Ig(),_===j){i=$i(h,i,g);break e}Yi(h,i,_,g)}i=i.child}return i;case 5:return Kh(i),h===null&&Eg(i),_=i.type,j=i.pendingProps,$=h!==null?h.memoizedProps:null,_n=j.children,Ef(_,j)?_n=null:$!==null&&Ef(_,$)&&(i.flags|=32),hj(h,i),Yi(h,i,_n,g),i.child;case 6:return h===null&&Eg(i),null;case 13:return pj(h,i,g);case 4:return Ih(i,i.stateNode.containerInfo),_=i.pendingProps,h===null?i.child=Bh(i,null,_,g):Yi(h,i,_,g),i.child;case 11:return _=i.type,j=i.pendingProps,j=i.elementType===_?j:Lg(_,j),Zi(h,i,_,j,g);case 7:return Yi(h,i,i.pendingProps,g),i.child;case 8:return Yi(h,i,i.pendingProps.children,g),i.child;case 12:return Yi(h,i,i.pendingProps.children,g),i.child;case 10:e:{if(_=i.type._context,j=i.pendingProps,$=i.memoizedProps,_n=j.value,G(Mg,_._currentValue),_._currentValue=_n,$!==null)if(He($.value,_n)){if($.children===j.children&&!Wf.current){i=$i(h,i,g);break e}}else for($=i.child,$!==null&&($.return=i);$!==null;){var _i=$.dependencies;if(_i!==null){_n=$.child;for(var _s=_i.firstContext;_s!==null;){if(_s.context===_){if($.tag===1){_s=ch(-1,g&-g),_s.tag=2;var ga=$.updateQueue;if(ga!==null){ga=ga.shared;var ba=ga.pending;ba===null?_s.next=_s:(_s.next=ba.next,ba.next=_s),ga.pending=_s}}$.lanes|=g,_s=$.alternate,_s!==null&&(_s.lanes|=g),Sg($.return,g,i),_i.lanes|=g;break}_s=_s.next}}else if($.tag===10)_n=$.type===i.type?null:$.child;else if($.tag===18){if(_n=$.return,_n===null)throw Error(p(341));_n.lanes|=g,_i=_n.alternate,_i!==null&&(_i.lanes|=g),Sg(_n,g,i),_n=$.sibling}else _n=$.child;if(_n!==null)_n.return=$;else for(_n=$;_n!==null;){if(_n===i){_n=null;break}if($=_n.sibling,$!==null){$.return=_n.return,_n=$;break}_n=_n.return}$=_n}Yi(h,i,j.children,g),i=i.child}return i;case 9:return j=i.type,_=i.pendingProps.children,Tg(i,g),j=Vg(j),_=_(j),i.flags|=1,Yi(h,i,_,g),i.child;case 14:return _=i.type,j=Lg(_,i.pendingProps),j=Lg(_.type,j),aj(h,i,_,j,g);case 15:return cj(h,i,i.type,i.pendingProps,g);case 17:return _=i.type,j=i.pendingProps,j=i.elementType===_?j:Lg(_,j),jj(h,i),i.tag=1,Zf(_)?(h=!0,cg(i)):h=!1,Tg(i,g),ph(i,_,j),rh(i,_,j,g),kj(null,i,_,!0,h,g);case 19:return yj(h,i,g);case 22:return ej(h,i,g)}throw Error(p(156,i.tag))};function Gk(h,i){return ac(h,i)}function al(h,i,g,_){this.tag=h,this.key=g,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=i,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=_,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Bg(h,i,g,_){return new al(h,i,g,_)}function bj(h){return h=h.prototype,!(!h||!h.isReactComponent)}function $k(h){if(typeof h=="function")return bj(h)?1:0;if(h!=null){if(h=h.$$typeof,h===Da)return 11;if(h===Ga)return 14}return 2}function wh(h,i){var g=h.alternate;return g===null?(g=Bg(h.tag,i,h.key,h.mode),g.elementType=h.elementType,g.type=h.type,g.stateNode=h.stateNode,g.alternate=h,h.alternate=g):(g.pendingProps=i,g.type=h.type,g.flags=0,g.subtreeFlags=0,g.deletions=null),g.flags=h.flags&14680064,g.childLanes=h.childLanes,g.lanes=h.lanes,g.child=h.child,g.memoizedProps=h.memoizedProps,g.memoizedState=h.memoizedState,g.updateQueue=h.updateQueue,i=h.dependencies,g.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext},g.sibling=h.sibling,g.index=h.index,g.ref=h.ref,g}function yh(h,i,g,_,j,$){var _n=2;if(_=h,typeof h=="function")bj(h)&&(_n=1);else if(typeof h=="string")_n=5;else e:switch(h){case ya:return Ah(g.children,j,$,i);case za:_n=8,j|=8;break;case Aa:return h=Bg(12,g,i,j|2),h.elementType=Aa,h.lanes=$,h;case Ea:return h=Bg(13,g,i,j),h.elementType=Ea,h.lanes=$,h;case Fa:return h=Bg(19,g,i,j),h.elementType=Fa,h.lanes=$,h;case Ia:return qj(g,j,$,i);default:if(typeof h=="object"&&h!==null)switch(h.$$typeof){case Ba:_n=10;break e;case Ca:_n=9;break e;case Da:_n=11;break e;case Ga:_n=14;break e;case Ha:_n=16,_=null;break e}throw Error(p(130,h==null?h:typeof h,""))}return i=Bg(_n,g,i,j),i.elementType=h,i.type=_,i.lanes=$,i}function Ah(h,i,g,_){return h=Bg(7,h,_,i),h.lanes=g,h}function qj(h,i,g,_){return h=Bg(22,h,_,i),h.elementType=Ia,h.lanes=g,h.stateNode={isHidden:!1},h}function xh(h,i,g){return h=Bg(6,h,null,i),h.lanes=g,h}function zh(h,i,g){return i=Bg(4,h.children!==null?h.children:[],h.key,i),i.lanes=g,i.stateNode={containerInfo:h.containerInfo,pendingChildren:null,implementation:h.implementation},i}function bl(h,i,g,_,j){this.tag=i,this.containerInfo=h,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=zc(0),this.expirationTimes=zc(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=zc(0),this.identifierPrefix=_,this.onRecoverableError=j,this.mutableSourceEagerHydrationData=null}function cl(h,i,g,_,j,$,_n,_i,_s){return h=new bl(h,i,g,_i,_s),i===1?(i=1,$===!0&&(i|=8)):i=0,$=Bg(3,null,null,i),h.current=$,$.stateNode=h,$.memoizedState={element:_,isDehydrated:g,cache:null,transitions:null,pendingSuspenseBoundaries:null},ah($),h}function dl(h,i,g){var _=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:wa,key:_==null?null:""+_,children:h,containerInfo:i,implementation:g}}function el(h){if(!h)return Vf;h=h._reactInternals;e:{if(Vb(h)!==h||h.tag!==1)throw Error(p(170));var i=h;do{switch(i.tag){case 3:i=i.stateNode.context;break e;case 1:if(Zf(i.type)){i=i.stateNode.__reactInternalMemoizedMergedChildContext;break e}}i=i.return}while(i!==null);throw Error(p(171))}if(h.tag===1){var g=h.type;if(Zf(g))return bg(h,g,i)}return i}function fl(h,i,g,_,j,$,_n,_i,_s){return h=cl(g,_,!0,h,j,$,_n,_i,_s),h.context=el(null),g=h.current,_=L(),j=lh(g),$=ch(_,j),$.callback=i??null,dh(g,$,j),h.current.lanes=j,Ac(h,j,_),Ek(h,_),h}function gl(h,i,g,_){var j=i.current,$=L(),_n=lh(j);return g=el(g),i.context===null?i.context=g:i.pendingContext=g,i=ch($,_n),i.payload={element:h},_=_===void 0?null:_,_!==null&&(i.callback=_),h=dh(j,i,_n),h!==null&&(mh(h,j,_n,$),eh(h,j,_n)),_n}function hl(h){if(h=h.current,!h.child)return null;switch(h.child.tag){case 5:return h.child.stateNode;default:return h.child.stateNode}}function il(h,i){if(h=h.memoizedState,h!==null&&h.dehydrated!==null){var g=h.retryLane;h.retryLane=g!==0&&g<i?g:i}}function jl(h,i){il(h,i),(h=h.alternate)&&il(h,i)}function kl(){return null}var ll=typeof reportError=="function"?reportError:function(h){console.error(h)};function ml(h){this._internalRoot=h}nl.prototype.render=ml.prototype.render=function(h){var i=this._internalRoot;if(i===null)throw Error(p(409));gl(h,i,null,null)};nl.prototype.unmount=ml.prototype.unmount=function(){var h=this._internalRoot;if(h!==null){this._internalRoot=null;var i=h.containerInfo;Sk(function(){gl(null,h,null,null)}),i[uf]=null}};function nl(h){this._internalRoot=h}nl.prototype.unstable_scheduleHydration=function(h){if(h){var i=Hc();h={blockedOn:null,target:h,priority:i};for(var g=0;g<Qc.length&&i!==0&&i<Qc[g].priority;g++);Qc.splice(g,0,h),g===0&&Vc(h)}};function ol(h){return!(!h||h.nodeType!==1&&h.nodeType!==9&&h.nodeType!==11)}function pl(h){return!(!h||h.nodeType!==1&&h.nodeType!==9&&h.nodeType!==11&&(h.nodeType!==8||h.nodeValue!==" react-mount-point-unstable "))}function ql(){}function rl(h,i,g,_,j){if(j){if(typeof _=="function"){var $=_;_=function(){var ga=hl(_n);$.call(ga)}}var _n=fl(i,_,h,0,null,!1,!1,"",ql);return h._reactRootContainer=_n,h[uf]=_n.current,sf(h.nodeType===8?h.parentNode:h),Sk(),_n}for(;j=h.lastChild;)h.removeChild(j);if(typeof _=="function"){var _i=_;_=function(){var ga=hl(_s);_i.call(ga)}}var _s=cl(h,0,!1,null,null,!1,!1,"",ql);return h._reactRootContainer=_s,h[uf]=_s.current,sf(h.nodeType===8?h.parentNode:h),Sk(function(){gl(i,_s,g,_)}),_s}function sl(h,i,g,_,j){var $=g._reactRootContainer;if($){var _n=$;if(typeof j=="function"){var _i=j;j=function(){var _s=hl(_n);_i.call(_s)}}gl(i,_n,h,j)}else _n=rl(g,i,h,j,_);return hl(_n)}Ec=function(h){switch(h.tag){case 3:var i=h.stateNode;if(i.current.memoizedState.isDehydrated){var g=tc(i.pendingLanes);g!==0&&(Cc(i,g|1),Ek(i,B()),!(K&6)&&(Hj=B()+500,jg()))}break;case 13:Sk(function(){var _=Zg(h,1);if(_!==null){var j=L();mh(_,h,1,j)}}),jl(h,1)}};Fc=function(h){if(h.tag===13){var i=Zg(h,134217728);if(i!==null){var g=L();mh(i,h,134217728,g)}jl(h,134217728)}};Gc=function(h){if(h.tag===13){var i=lh(h),g=Zg(h,i);if(g!==null){var _=L();mh(g,h,i,_)}jl(h,i)}};Hc=function(){return C};Ic=function(h,i){var g=C;try{return C=h,i()}finally{C=g}};yb=function(h,i,g){switch(i){case"input":if(bb(h,g),i=g.name,g.type==="radio"&&i!=null){for(g=h;g.parentNode;)g=g.parentNode;for(g=g.querySelectorAll("input[name="+JSON.stringify(""+i)+'][type="radio"]'),i=0;i<g.length;i++){var _=g[i];if(_!==h&&_.form===h.form){var j=Db(_);if(!j)throw Error(p(90));Wa(_),bb(_,j)}}}break;case"textarea":ib(h,g);break;case"select":i=g.value,i!=null&&fb(h,!!g.multiple,i,!1)}};Gb=Rk;Hb=Sk;var tl={usingClientEntryPoint:!1,Events:[Cb,ue,Db,Eb,Fb,Rk]},ul={findFiberByHostInstance:Wc,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},vl={bundleType:ul.bundleType,version:ul.version,rendererPackageName:ul.rendererPackageName,rendererConfig:ul.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ua.ReactCurrentDispatcher,findHostInstanceByFiber:function(h){return h=Zb(h),h===null?null:h.stateNode},findFiberByHostInstance:ul.findFiberByHostInstance||kl,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var wl=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!wl.isDisabled&&wl.supportsFiber)try{kc=wl.inject(vl),lc=wl}catch{}}reactDom_production_min.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=tl;reactDom_production_min.createPortal=function(h,i){var g=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!ol(i))throw Error(p(200));return dl(h,i,null,g)};reactDom_production_min.createRoot=function(h,i){if(!ol(h))throw Error(p(299));var g=!1,_="",j=ll;return i!=null&&(i.unstable_strictMode===!0&&(g=!0),i.identifierPrefix!==void 0&&(_=i.identifierPrefix),i.onRecoverableError!==void 0&&(j=i.onRecoverableError)),i=cl(h,1,!1,null,null,g,!1,_,j),h[uf]=i.current,sf(h.nodeType===8?h.parentNode:h),new ml(i)};reactDom_production_min.findDOMNode=function(h){if(h==null)return null;if(h.nodeType===1)return h;var i=h._reactInternals;if(i===void 0)throw typeof h.render=="function"?Error(p(188)):(h=Object.keys(h).join(","),Error(p(268,h)));return h=Zb(i),h=h===null?null:h.stateNode,h};reactDom_production_min.flushSync=function(h){return Sk(h)};reactDom_production_min.hydrate=function(h,i,g){if(!pl(i))throw Error(p(200));return sl(null,h,i,!0,g)};reactDom_production_min.hydrateRoot=function(h,i,g){if(!ol(h))throw Error(p(405));var _=g!=null&&g.hydratedSources||null,j=!1,$="",_n=ll;if(g!=null&&(g.unstable_strictMode===!0&&(j=!0),g.identifierPrefix!==void 0&&($=g.identifierPrefix),g.onRecoverableError!==void 0&&(_n=g.onRecoverableError)),i=fl(i,null,h,1,g??null,j,!1,$,_n),h[uf]=i.current,sf(h),_)for(h=0;h<_.length;h++)g=_[h],j=g._getVersion,j=j(g._source),i.mutableSourceEagerHydrationData==null?i.mutableSourceEagerHydrationData=[g,j]:i.mutableSourceEagerHydrationData.push(g,j);return new nl(i)};reactDom_production_min.render=function(h,i,g){if(!pl(i))throw Error(p(200));return sl(null,h,i,!1,g)};reactDom_production_min.unmountComponentAtNode=function(h){if(!pl(h))throw Error(p(40));return h._reactRootContainer?(Sk(function(){sl(null,null,h,!1,function(){h._reactRootContainer=null,h[uf]=null})}),!0):!1};reactDom_production_min.unstable_batchedUpdates=Rk;reactDom_production_min.unstable_renderSubtreeIntoContainer=function(h,i,g,_){if(!pl(g))throw Error(p(200));if(h==null||h._reactInternals===void 0)throw Error(p(38));return sl(h,i,g,!1,_)};reactDom_production_min.version="18.2.0-next-9e3b772b8-20220608";(function(h){function i(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(i)}catch(g){console.error(g)}}i(),h.exports=reactDom_production_min})(reactDom);var m=reactDomExports;client.createRoot=m.createRoot,client.hydrateRoot=m.hydrateRoot;const App$1="";/**
 * @remix-run/router v1.5.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function _extends$7(){return _extends$7=Object.assign?Object.assign.bind():function(h){for(var i=1;i<arguments.length;i++){var g=arguments[i];for(var _ in g)Object.prototype.hasOwnProperty.call(g,_)&&(h[_]=g[_])}return h},_extends$7.apply(this,arguments)}var Action;(function(h){h.Pop="POP",h.Push="PUSH",h.Replace="REPLACE"})(Action||(Action={}));const PopStateEventType="popstate";function createBrowserHistory(h){h===void 0&&(h={});function i(_,j){let{pathname:$,search:_n,hash:_i}=_.location;return createLocation("",{pathname:$,search:_n,hash:_i},j.state&&j.state.usr||null,j.state&&j.state.key||"default")}function g(_,j){return typeof j=="string"?j:createPath(j)}return getUrlBasedHistory(i,g,null,h)}function invariant(h,i){if(h===!1||h===null||typeof h>"u")throw new Error(i)}function warning(h,i){if(!h){typeof console<"u"&&console.warn(i);try{throw new Error(i)}catch{}}}function createKey(){return Math.random().toString(36).substr(2,8)}function getHistoryState(h,i){return{usr:h.state,key:h.key,idx:i}}function createLocation(h,i,g,_){return g===void 0&&(g=null),_extends$7({pathname:typeof h=="string"?h:h.pathname,search:"",hash:""},typeof i=="string"?parsePath(i):i,{state:g,key:i&&i.key||_||createKey()})}function createPath(h){let{pathname:i="/",search:g="",hash:_=""}=h;return g&&g!=="?"&&(i+=g.charAt(0)==="?"?g:"?"+g),_&&_!=="#"&&(i+=_.charAt(0)==="#"?_:"#"+_),i}function parsePath(h){let i={};if(h){let g=h.indexOf("#");g>=0&&(i.hash=h.substr(g),h=h.substr(0,g));let _=h.indexOf("?");_>=0&&(i.search=h.substr(_),h=h.substr(0,_)),h&&(i.pathname=h)}return i}function getUrlBasedHistory(h,i,g,_){_===void 0&&(_={});let{window:j=document.defaultView,v5Compat:$=!1}=_,_n=j.history,_i=Action.Pop,_s=null,ga=ba();ga==null&&(ga=0,_n.replaceState(_extends$7({},_n.state,{idx:ga}),""));function ba(){return(_n.state||{idx:null}).idx}function xa(){_i=Action.Pop;let Cl=ba(),Nl=Cl==null?null:Cl-ga;ga=Cl,_s&&_s({action:_i,location:Il.location,delta:Nl})}function El(Cl,Nl){_i=Action.Push;let Dl=createLocation(Il.location,Cl,Nl);g&&g(Dl,Cl),ga=ba()+1;let Ul=getHistoryState(Dl,ga),Kl=Il.createHref(Dl);try{_n.pushState(Ul,"",Kl)}catch{j.location.assign(Kl)}$&&_s&&_s({action:_i,location:Il.location,delta:1})}function Tl(Cl,Nl){_i=Action.Replace;let Dl=createLocation(Il.location,Cl,Nl);g&&g(Dl,Cl),ga=ba();let Ul=getHistoryState(Dl,ga),Kl=Il.createHref(Dl);_n.replaceState(Ul,"",Kl),$&&_s&&_s({action:_i,location:Il.location,delta:0})}function Sl(Cl){let Nl=j.location.origin!=="null"?j.location.origin:j.location.href,Dl=typeof Cl=="string"?Cl:createPath(Cl);return invariant(Nl,"No window.location.(origin|href) available to create URL for href: "+Dl),new URL(Dl,Nl)}let Il={get action(){return _i},get location(){return h(j,_n)},listen(Cl){if(_s)throw new Error("A history only accepts one active listener");return j.addEventListener(PopStateEventType,xa),_s=Cl,()=>{j.removeEventListener(PopStateEventType,xa),_s=null}},createHref(Cl){return i(j,Cl)},createURL:Sl,encodeLocation(Cl){let Nl=Sl(Cl);return{pathname:Nl.pathname,search:Nl.search,hash:Nl.hash}},push:El,replace:Tl,go(Cl){return _n.go(Cl)}};return Il}var ResultType;(function(h){h.data="data",h.deferred="deferred",h.redirect="redirect",h.error="error"})(ResultType||(ResultType={}));function matchRoutes(h,i,g){g===void 0&&(g="/");let _=typeof i=="string"?parsePath(i):i,j=stripBasename(_.pathname||"/",g);if(j==null)return null;let $=flattenRoutes(h);rankRouteBranches($);let _n=null;for(let _i=0;_n==null&&_i<$.length;++_i)_n=matchRouteBranch($[_i],safelyDecodeURI(j));return _n}function flattenRoutes(h,i,g,_){i===void 0&&(i=[]),g===void 0&&(g=[]),_===void 0&&(_="");let j=($,_n,_i)=>{let _s={relativePath:_i===void 0?$.path||"":_i,caseSensitive:$.caseSensitive===!0,childrenIndex:_n,route:$};_s.relativePath.startsWith("/")&&(invariant(_s.relativePath.startsWith(_),'Absolute route path "'+_s.relativePath+'" nested under path '+('"'+_+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),_s.relativePath=_s.relativePath.slice(_.length));let ga=joinPaths([_,_s.relativePath]),ba=g.concat(_s);$.children&&$.children.length>0&&(invariant($.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+ga+'".')),flattenRoutes($.children,i,ba,ga)),!($.path==null&&!$.index)&&i.push({path:ga,score:computeScore(ga,$.index),routesMeta:ba})};return h.forEach(($,_n)=>{var _i;if($.path===""||!((_i=$.path)!=null&&_i.includes("?")))j($,_n);else for(let _s of explodeOptionalSegments($.path))j($,_n,_s)}),i}function explodeOptionalSegments(h){let i=h.split("/");if(i.length===0)return[];let[g,..._]=i,j=g.endsWith("?"),$=g.replace(/\?$/,"");if(_.length===0)return j?[$,""]:[$];let _n=explodeOptionalSegments(_.join("/")),_i=[];return _i.push(..._n.map(_s=>_s===""?$:[$,_s].join("/"))),j&&_i.push(..._n),_i.map(_s=>h.startsWith("/")&&_s===""?"/":_s)}function rankRouteBranches(h){h.sort((i,g)=>i.score!==g.score?g.score-i.score:compareIndexes(i.routesMeta.map(_=>_.childrenIndex),g.routesMeta.map(_=>_.childrenIndex)))}const paramRe=/^:\w+$/,dynamicSegmentValue=3,indexRouteValue=2,emptySegmentValue=1,staticSegmentValue=10,splatPenalty=-2,isSplat=h=>h==="*";function computeScore(h,i){let g=h.split("/"),_=g.length;return g.some(isSplat)&&(_+=splatPenalty),i&&(_+=indexRouteValue),g.filter(j=>!isSplat(j)).reduce((j,$)=>j+(paramRe.test($)?dynamicSegmentValue:$===""?emptySegmentValue:staticSegmentValue),_)}function compareIndexes(h,i){return h.length===i.length&&h.slice(0,-1).every((_,j)=>_===i[j])?h[h.length-1]-i[i.length-1]:0}function matchRouteBranch(h,i){let{routesMeta:g}=h,_={},j="/",$=[];for(let _n=0;_n<g.length;++_n){let _i=g[_n],_s=_n===g.length-1,ga=j==="/"?i:i.slice(j.length)||"/",ba=matchPath({path:_i.relativePath,caseSensitive:_i.caseSensitive,end:_s},ga);if(!ba)return null;Object.assign(_,ba.params);let xa=_i.route;$.push({params:_,pathname:joinPaths([j,ba.pathname]),pathnameBase:normalizePathname(joinPaths([j,ba.pathnameBase])),route:xa}),ba.pathnameBase!=="/"&&(j=joinPaths([j,ba.pathnameBase]))}return $}function matchPath(h,i){typeof h=="string"&&(h={path:h,caseSensitive:!1,end:!0});let[g,_]=compilePath(h.path,h.caseSensitive,h.end),j=i.match(g);if(!j)return null;let $=j[0],_n=$.replace(/(.)\/+$/,"$1"),_i=j.slice(1);return{params:_.reduce((ga,ba,xa)=>{if(ba==="*"){let El=_i[xa]||"";_n=$.slice(0,$.length-El.length).replace(/(.)\/+$/,"$1")}return ga[ba]=safelyDecodeURIComponent(_i[xa]||"",ba),ga},{}),pathname:$,pathnameBase:_n,pattern:h}}function compilePath(h,i,g){i===void 0&&(i=!1),g===void 0&&(g=!0),warning(h==="*"||!h.endsWith("*")||h.endsWith("/*"),'Route path "'+h+'" will be treated as if it were '+('"'+h.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+h.replace(/\*$/,"/*")+'".'));let _=[],j="^"+h.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^$?{}|()[\]]/g,"\\$&").replace(/\/:(\w+)/g,(_n,_i)=>(_.push(_i),"/([^\\/]+)"));return h.endsWith("*")?(_.push("*"),j+=h==="*"||h==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):g?j+="\\/*$":h!==""&&h!=="/"&&(j+="(?:(?=\\/|$))"),[new RegExp(j,i?void 0:"i"),_]}function safelyDecodeURI(h){try{return decodeURI(h)}catch(i){return warning(!1,'The URL path "'+h+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+i+").")),h}}function safelyDecodeURIComponent(h,i){try{return decodeURIComponent(h)}catch(g){return warning(!1,'The value for the URL param "'+i+'" will not be decoded because'+(' the string "'+h+'" is a malformed URL segment. This is probably')+(" due to a bad percent encoding ("+g+").")),h}}function stripBasename(h,i){if(i==="/")return h;if(!h.toLowerCase().startsWith(i.toLowerCase()))return null;let g=i.endsWith("/")?i.length-1:i.length,_=h.charAt(g);return _&&_!=="/"?null:h.slice(g)||"/"}function resolvePath(h,i){i===void 0&&(i="/");let{pathname:g,search:_="",hash:j=""}=typeof h=="string"?parsePath(h):h;return{pathname:g?g.startsWith("/")?g:resolvePathname(g,i):i,search:normalizeSearch(_),hash:normalizeHash(j)}}function resolvePathname(h,i){let g=i.replace(/\/+$/,"").split("/");return h.split("/").forEach(j=>{j===".."?g.length>1&&g.pop():j!=="."&&g.push(j)}),g.length>1?g.join("/"):"/"}function getInvalidPathError(h,i,g,_){return"Cannot include a '"+h+"' character in a manually specified "+("`to."+i+"` field ["+JSON.stringify(_)+"].  Please separate it out to the ")+("`to."+g+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function getPathContributingMatches(h){return h.filter((i,g)=>g===0||i.route.path&&i.route.path.length>0)}function resolveTo(h,i,g,_){_===void 0&&(_=!1);let j;typeof h=="string"?j=parsePath(h):(j=_extends$7({},h),invariant(!j.pathname||!j.pathname.includes("?"),getInvalidPathError("?","pathname","search",j)),invariant(!j.pathname||!j.pathname.includes("#"),getInvalidPathError("#","pathname","hash",j)),invariant(!j.search||!j.search.includes("#"),getInvalidPathError("#","search","hash",j)));let $=h===""||j.pathname==="",_n=$?"/":j.pathname,_i;if(_||_n==null)_i=g;else{let xa=i.length-1;if(_n.startsWith("..")){let El=_n.split("/");for(;El[0]==="..";)El.shift(),xa-=1;j.pathname=El.join("/")}_i=xa>=0?i[xa]:"/"}let _s=resolvePath(j,_i),ga=_n&&_n!=="/"&&_n.endsWith("/"),ba=($||_n===".")&&g.endsWith("/");return!_s.pathname.endsWith("/")&&(ga||ba)&&(_s.pathname+="/"),_s}const joinPaths=h=>h.join("/").replace(/\/\/+/g,"/"),normalizePathname=h=>h.replace(/\/+$/,"").replace(/^\/*/,"/"),normalizeSearch=h=>!h||h==="?"?"":h.startsWith("?")?h:"?"+h,normalizeHash=h=>!h||h==="#"?"":h.startsWith("#")?h:"#"+h;function isRouteErrorResponse(h){return h!=null&&typeof h.status=="number"&&typeof h.statusText=="string"&&typeof h.internal=="boolean"&&"data"in h}/**
 * React Router v6.10.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function isPolyfill(h,i){return h===i&&(h!==0||1/h===1/i)||h!==h&&i!==i}const is=typeof Object.is=="function"?Object.is:isPolyfill,{useState,useEffect,useLayoutEffect,useDebugValue}=React$1;function useSyncExternalStore$2(h,i,g){const _=i(),[{inst:j},$]=useState({inst:{value:_,getSnapshot:i}});return useLayoutEffect(()=>{j.value=_,j.getSnapshot=i,checkIfSnapshotChanged(j)&&$({inst:j})},[h,_,i]),useEffect(()=>(checkIfSnapshotChanged(j)&&$({inst:j}),h(()=>{checkIfSnapshotChanged(j)&&$({inst:j})})),[h]),useDebugValue(_),_}function checkIfSnapshotChanged(h){const i=h.getSnapshot,g=h.value;try{const _=i();return!is(g,_)}catch{return!0}}function useSyncExternalStore$1(h,i,g){return i()}const canUseDOM=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",isServerEnvironment=!canUseDOM,shim=isServerEnvironment?useSyncExternalStore$1:useSyncExternalStore$2;"useSyncExternalStore"in React$1&&(h=>h.useSyncExternalStore)(React$1);const DataRouterContext=reactExports.createContext(null),DataRouterStateContext=reactExports.createContext(null),NavigationContext=reactExports.createContext(null),LocationContext=reactExports.createContext(null),RouteContext=reactExports.createContext({outlet:null,matches:[]}),RouteErrorContext=reactExports.createContext(null);function _extends$6(){return _extends$6=Object.assign?Object.assign.bind():function(h){for(var i=1;i<arguments.length;i++){var g=arguments[i];for(var _ in g)Object.prototype.hasOwnProperty.call(g,_)&&(h[_]=g[_])}return h},_extends$6.apply(this,arguments)}function useInRouterContext(){return reactExports.useContext(LocationContext)!=null}function useLocation(){return useInRouterContext()||invariant(!1),reactExports.useContext(LocationContext).location}function useNavigate(){useInRouterContext()||invariant(!1);let{basename:h,navigator:i}=reactExports.useContext(NavigationContext),{matches:g}=reactExports.useContext(RouteContext),{pathname:_}=useLocation(),j=JSON.stringify(getPathContributingMatches(g).map(_i=>_i.pathnameBase)),$=reactExports.useRef(!1);return reactExports.useEffect(()=>{$.current=!0}),reactExports.useCallback(function(_i,_s){if(_s===void 0&&(_s={}),!$.current)return;if(typeof _i=="number"){i.go(_i);return}let ga=resolveTo(_i,JSON.parse(j),_,_s.relative==="path");h!=="/"&&(ga.pathname=ga.pathname==="/"?h:joinPaths([h,ga.pathname])),(_s.replace?i.replace:i.push)(ga,_s.state,_s)},[h,i,j,_])}const OutletContext=reactExports.createContext(null);function useOutlet(h){let i=reactExports.useContext(RouteContext).outlet;return i&&reactExports.createElement(OutletContext.Provider,{value:h},i)}function useParams(){let{matches:h}=reactExports.useContext(RouteContext),i=h[h.length-1];return i?i.params:{}}function useRoutes(h,i){useInRouterContext()||invariant(!1);let{navigator:g}=reactExports.useContext(NavigationContext),_=reactExports.useContext(DataRouterStateContext),{matches:j}=reactExports.useContext(RouteContext),$=j[j.length-1],_n=$?$.params:{};$&&$.pathname;let _i=$?$.pathnameBase:"/";$&&$.route;let _s=useLocation(),ga;if(i){var ba;let Il=typeof i=="string"?parsePath(i):i;_i==="/"||(ba=Il.pathname)!=null&&ba.startsWith(_i)||invariant(!1),ga=Il}else ga=_s;let xa=ga.pathname||"/",El=_i==="/"?xa:xa.slice(_i.length)||"/",Tl=matchRoutes(h,{pathname:El}),Sl=_renderMatches(Tl&&Tl.map(Il=>Object.assign({},Il,{params:Object.assign({},_n,Il.params),pathname:joinPaths([_i,g.encodeLocation?g.encodeLocation(Il.pathname).pathname:Il.pathname]),pathnameBase:Il.pathnameBase==="/"?_i:joinPaths([_i,g.encodeLocation?g.encodeLocation(Il.pathnameBase).pathname:Il.pathnameBase])})),j,_||void 0);return i&&Sl?reactExports.createElement(LocationContext.Provider,{value:{location:_extends$6({pathname:"/",search:"",hash:"",state:null,key:"default"},ga),navigationType:Action.Pop}},Sl):Sl}function DefaultErrorComponent(){let h=useRouteError(),i=isRouteErrorResponse(h)?h.status+" "+h.statusText:h instanceof Error?h.message:JSON.stringify(h),g=h instanceof Error?h.stack:null,j={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"},$=null;return reactExports.createElement(reactExports.Fragment,null,reactExports.createElement("h2",null,"Unexpected Application Error!"),reactExports.createElement("h3",{style:{fontStyle:"italic"}},i),g?reactExports.createElement("pre",{style:j},g):null,$)}class RenderErrorBoundary extends reactExports.Component{constructor(i){super(i),this.state={location:i.location,error:i.error}}static getDerivedStateFromError(i){return{error:i}}static getDerivedStateFromProps(i,g){return g.location!==i.location?{error:i.error,location:i.location}:{error:i.error||g.error,location:g.location}}componentDidCatch(i,g){console.error("React Router caught the following error during render",i,g)}render(){return this.state.error?reactExports.createElement(RouteContext.Provider,{value:this.props.routeContext},reactExports.createElement(RouteErrorContext.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function RenderedRoute(h){let{routeContext:i,match:g,children:_}=h,j=reactExports.useContext(DataRouterContext);return j&&j.static&&j.staticContext&&(g.route.errorElement||g.route.ErrorBoundary)&&(j.staticContext._deepestRenderedBoundaryId=g.route.id),reactExports.createElement(RouteContext.Provider,{value:i},_)}function _renderMatches(h,i,g){if(i===void 0&&(i=[]),h==null)if(g!=null&&g.errors)h=g.matches;else return null;let _=h,j=g==null?void 0:g.errors;if(j!=null){let $=_.findIndex(_n=>_n.route.id&&(j==null?void 0:j[_n.route.id]));$>=0||invariant(!1),_=_.slice(0,Math.min(_.length,$+1))}return _.reduceRight(($,_n,_i)=>{let _s=_n.route.id?j==null?void 0:j[_n.route.id]:null,ga=null;g&&(_n.route.ErrorBoundary?ga=reactExports.createElement(_n.route.ErrorBoundary,null):_n.route.errorElement?ga=_n.route.errorElement:ga=reactExports.createElement(DefaultErrorComponent,null));let ba=i.concat(_.slice(0,_i+1)),xa=()=>{let El=$;return _s?El=ga:_n.route.Component?El=reactExports.createElement(_n.route.Component,null):_n.route.element&&(El=_n.route.element),reactExports.createElement(RenderedRoute,{match:_n,routeContext:{outlet:$,matches:ba},children:El})};return g&&(_n.route.ErrorBoundary||_n.route.errorElement||_i===0)?reactExports.createElement(RenderErrorBoundary,{location:g.location,component:ga,error:_s,children:xa(),routeContext:{outlet:null,matches:ba}}):xa()},null)}var DataRouterHook$1;(function(h){h.UseBlocker="useBlocker",h.UseRevalidator="useRevalidator"})(DataRouterHook$1||(DataRouterHook$1={}));var DataRouterStateHook$1;(function(h){h.UseBlocker="useBlocker",h.UseLoaderData="useLoaderData",h.UseActionData="useActionData",h.UseRouteError="useRouteError",h.UseNavigation="useNavigation",h.UseRouteLoaderData="useRouteLoaderData",h.UseMatches="useMatches",h.UseRevalidator="useRevalidator"})(DataRouterStateHook$1||(DataRouterStateHook$1={}));function useDataRouterState(h){let i=reactExports.useContext(DataRouterStateContext);return i||invariant(!1),i}function useRouteContext(h){let i=reactExports.useContext(RouteContext);return i||invariant(!1),i}function useCurrentRouteId(h){let i=useRouteContext(),g=i.matches[i.matches.length-1];return g.route.id||invariant(!1),g.route.id}function useRouteError(){var h;let i=reactExports.useContext(RouteErrorContext),g=useDataRouterState(DataRouterStateHook$1.UseRouteError),_=useCurrentRouteId(DataRouterStateHook$1.UseRouteError);return i||((h=g.errors)==null?void 0:h[_])}function Navigate(h){let{to:i,replace:g,state:_,relative:j}=h;useInRouterContext()||invariant(!1);let $=reactExports.useContext(DataRouterStateContext),_n=useNavigate();return reactExports.useEffect(()=>{$&&$.navigation.state!=="idle"||_n(i,{replace:g,state:_,relative:j})}),null}function Outlet(h){return useOutlet(h.context)}function Route(h){invariant(!1)}function Router(h){let{basename:i="/",children:g=null,location:_,navigationType:j=Action.Pop,navigator:$,static:_n=!1}=h;useInRouterContext()&&invariant(!1);let _i=i.replace(/^\/*/,"/"),_s=reactExports.useMemo(()=>({basename:_i,navigator:$,static:_n}),[_i,$,_n]);typeof _=="string"&&(_=parsePath(_));let{pathname:ga="/",search:ba="",hash:xa="",state:El=null,key:Tl="default"}=_,Sl=reactExports.useMemo(()=>{let Il=stripBasename(ga,_i);return Il==null?null:{location:{pathname:Il,search:ba,hash:xa,state:El,key:Tl},navigationType:j}},[_i,ga,ba,xa,El,Tl,j]);return Sl==null?null:reactExports.createElement(NavigationContext.Provider,{value:_s},reactExports.createElement(LocationContext.Provider,{children:g,value:Sl}))}function Routes(h){let{children:i,location:g}=h,_=reactExports.useContext(DataRouterContext),j=_&&!i?_.router.routes:createRoutesFromChildren(i);return useRoutes(j,g)}var AwaitRenderStatus;(function(h){h[h.pending=0]="pending",h[h.success=1]="success",h[h.error=2]="error"})(AwaitRenderStatus||(AwaitRenderStatus={}));new Promise(()=>{});function createRoutesFromChildren(h,i){i===void 0&&(i=[]);let g=[];return reactExports.Children.forEach(h,(_,j)=>{if(!reactExports.isValidElement(_))return;let $=[...i,j];if(_.type===reactExports.Fragment){g.push.apply(g,createRoutesFromChildren(_.props.children,$));return}_.type!==Route&&invariant(!1),!_.props.index||!_.props.children||invariant(!1);let _n={id:_.props.id||$.join("-"),caseSensitive:_.props.caseSensitive,element:_.props.element,Component:_.props.Component,index:_.props.index,path:_.props.path,loader:_.props.loader,action:_.props.action,errorElement:_.props.errorElement,ErrorBoundary:_.props.ErrorBoundary,hasErrorBoundary:_.props.ErrorBoundary!=null||_.props.errorElement!=null,shouldRevalidate:_.props.shouldRevalidate,handle:_.props.handle,lazy:_.props.lazy};_.props.children&&(_n.children=createRoutesFromChildren(_.props.children,$)),g.push(_n)}),g}/**
 * React Router DOM v6.10.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function BrowserRouter(h){let{basename:i,children:g,window:_}=h,j=reactExports.useRef();j.current==null&&(j.current=createBrowserHistory({window:_,v5Compat:!0}));let $=j.current,[_n,_i]=reactExports.useState({action:$.action,location:$.location});return reactExports.useLayoutEffect(()=>$.listen(_i),[$]),reactExports.createElement(Router,{basename:i,children:g,location:_n.location,navigationType:_n.action,navigator:$})}var DataRouterHook;(function(h){h.UseScrollRestoration="useScrollRestoration",h.UseSubmitImpl="useSubmitImpl",h.UseFetcher="useFetcher"})(DataRouterHook||(DataRouterHook={}));var DataRouterStateHook;(function(h){h.UseFetchers="useFetchers",h.UseScrollRestoration="useScrollRestoration"})(DataRouterStateHook||(DataRouterStateHook={}));const BASEURL$2="http://localhost:5000",sendRequest=async(h,i,g)=>{const _=localStorage.getItem("token");return await(await fetch(`${BASEURL$2}${h}`,{method:i,headers:{"Content-Type":"application/json",Authorization:`Bearer ${_}`},body:g?JSON.stringify(g):null})).json()},BASEURL$1="http://localhost:5000",fetchToken=async(h,i)=>await sendRequest(`/token/generate/${h}/${i}`,"GET"),fetchRTMToken=async h=>await sendRequest(`/token/generateRTM/${h}`,"GET"),signUp=async(h,i,g,_)=>await(await fetch(`${BASEURL$1}/auth/signup`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:h,password:i,id_number:g,username:_})})).json(),signIn=async(h,i)=>{const _=await(await fetch(`${BASEURL$1}/auth/signin`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:h,password:i})})).json();return localStorage.setItem("token",_),_},AuthPage=()=>{const[h,i]=React.useState(""),[g,_]=React.useState(""),[j,$]=React.useState(""),[_n,_i]=React.useState(""),[_s,ga]=React.useState(!0),[ba,xa]=React.useState(!1),El=useNavigate(),Tl=Cl=>{Cl.preventDefault(),xa(!0),signIn(_n,g).then(Nl=>{console.log(Nl),El("/join")}).catch(Nl=>{console.log(Nl),xa(!1),Il(),alert("Login failed")})},Sl=Cl=>{Cl.preventDefault(),xa(!0),signUp(_n,g,j,h).then(Nl=>{alert("User created successfully"),ga(!0),Il(),xa(!1)}).catch(Nl=>{console.log(Nl),alert("User creation failed"),xa(!1)})},Il=()=>{i(""),_(""),$(""),_i("")};return jsx("div",{className:"w3-container",style:{display:"block",justifyContent:"center",alignItems:"center",minWidth:"400px"},children:jsxs("div",{className:"w3-row",children:[jsxs("div",{className:"w3-col m6 w3-center",children:[jsx("h1",{children:"Gebze Technical University Education Portal"}),jsx("div",{className:"w3-padding w3-margin",children:jsx("img",{src:"https://abl.gtu.edu.tr/html/mobil/gtu_logo_tr_500.png",style:{width:"100%"}})})]}),_s?jsx("div",{className:"w3-col m6 w3-center",children:jsxs("form",{className:"w3-container w3-card w3-padding w3-margin w3-round-large",style:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},children:[jsx("h2",{children:"Login"}),jsx("label",{children:"Email"}),jsx("input",{className:"w3-input w3-padding w3-margin",type:"text",value:_n,onChange:Cl=>_i(Cl.target.value)}),jsx("label",{children:"Password"}),jsx("input",{className:"w3-input w3-padding w3-margin",type:"password",value:g,onChange:Cl=>_(Cl.target.value)}),jsx("button",{type:"submit",className:`w3-button ${ba?"w3-grey":"w3-blue"} w3-padding w3-margin`,disabled:ba,onClick:Cl=>Tl(Cl),children:"Login"}),jsx("button",{type:"button",className:"w3-button w3-white w3-padding w3-margin w3-red w3-text-blue",style:{display:"block"},onClick:()=>{ga(!_s),Il()},children:"Create account instead"})]})}):jsx("div",{className:"w3-col m6 w3-center",children:jsxs("form",{className:"w3-container w3-card w3-padding w3-margin w3-round-large",style:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},children:[jsx("h2",{children:"Register"}),jsx("label",{children:"Username"}),jsx("input",{className:"w3-input w3-padding w3-margin",type:"text",value:h,onChange:Cl=>i(Cl.target.value)}),jsx("label",{children:"Password"}),jsx("input",{className:"w3-input w3-padding w3-margin",type:"password",value:g,onChange:Cl=>_(Cl.target.value)}),jsx("label",{children:"ID Number"}),jsx("input",{className:"w3-input w3-padding w3-margin",type:"text",value:j,onChange:Cl=>$(Cl.target.value)}),jsx("label",{children:"Email"}),jsx("input",{className:"w3-input w3-padding w3-margin",type:"email",value:_n,onChange:Cl=>_i(Cl.target.value)}),jsx("button",{type:"submit",className:`w3-button ${ba?"w3-grey":"w3-teal"} w3-padding w3-margin`,disabled:ba,onClick:Sl,children:"Register"}),jsx("button",{type:"button",className:"w3-button w3-white w3-padding w3-margin w3-red w3-text-blue",style:{display:"block"},onClick:()=>{ga(!_s),Il()},children:"Login instead"})]})})]})})};function getDefaultExportFromCjs(h){return h&&h.__esModule&&Object.prototype.hasOwnProperty.call(h,"default")?h.default:h}var urlToolkit={exports:{}};(function(h,i){(function(g){var _=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,j=/^(?=([^\/?#]*))\1([^]*)$/,$=/(?:\/|^)\.(?=\/)/g,_n=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,_i={buildAbsoluteURL:function(_s,ga,ba){if(ba=ba||{},_s=_s.trim(),ga=ga.trim(),!ga){if(!ba.alwaysNormalize)return _s;var xa=_i.parseURL(_s);if(!xa)throw new Error("Error trying to parse base URL.");return xa.path=_i.normalizePath(xa.path),_i.buildURLFromParts(xa)}var El=_i.parseURL(ga);if(!El)throw new Error("Error trying to parse relative URL.");if(El.scheme)return ba.alwaysNormalize?(El.path=_i.normalizePath(El.path),_i.buildURLFromParts(El)):ga;var Tl=_i.parseURL(_s);if(!Tl)throw new Error("Error trying to parse base URL.");if(!Tl.netLoc&&Tl.path&&Tl.path[0]!=="/"){var Sl=j.exec(Tl.path);Tl.netLoc=Sl[1],Tl.path=Sl[2]}Tl.netLoc&&!Tl.path&&(Tl.path="/");var Il={scheme:Tl.scheme,netLoc:El.netLoc,path:null,params:El.params,query:El.query,fragment:El.fragment};if(!El.netLoc&&(Il.netLoc=Tl.netLoc,El.path[0]!=="/"))if(!El.path)Il.path=Tl.path,El.params||(Il.params=Tl.params,El.query||(Il.query=Tl.query));else{var Cl=Tl.path,Nl=Cl.substring(0,Cl.lastIndexOf("/")+1)+El.path;Il.path=_i.normalizePath(Nl)}return Il.path===null&&(Il.path=ba.alwaysNormalize?_i.normalizePath(El.path):El.path),_i.buildURLFromParts(Il)},parseURL:function(_s){var ga=_.exec(_s);return ga?{scheme:ga[1]||"",netLoc:ga[2]||"",path:ga[3]||"",params:ga[4]||"",query:ga[5]||"",fragment:ga[6]||""}:null},normalizePath:function(_s){for(_s=_s.split("").reverse().join("").replace($,"");_s.length!==(_s=_s.replace(_n,"")).length;);return _s.split("").reverse().join("")},buildURLFromParts:function(_s){return _s.scheme+_s.netLoc+_s.path+_s.params+_s.query+_s.fragment}};h.exports=_i})()})(urlToolkit);var urlToolkitExports=urlToolkit.exports;function ownKeys$j(h,i){var g=Object.keys(h);if(Object.getOwnPropertySymbols){var _=Object.getOwnPropertySymbols(h);i&&(_=_.filter(function(j){return Object.getOwnPropertyDescriptor(h,j).enumerable})),g.push.apply(g,_)}return g}function _objectSpread2(h){for(var i=1;i<arguments.length;i++){var g=arguments[i]!=null?arguments[i]:{};i%2?ownKeys$j(Object(g),!0).forEach(function(_){_defineProperty$n(h,_,g[_])}):Object.getOwnPropertyDescriptors?Object.defineProperties(h,Object.getOwnPropertyDescriptors(g)):ownKeys$j(Object(g)).forEach(function(_){Object.defineProperty(h,_,Object.getOwnPropertyDescriptor(g,_))})}return h}function _defineProperty$n(h,i,g){return i=_toPropertyKey(i),i in h?Object.defineProperty(h,i,{value:g,enumerable:!0,configurable:!0,writable:!0}):h[i]=g,h}function _extends$5(){return _extends$5=Object.assign?Object.assign.bind():function(h){for(var i=1;i<arguments.length;i++){var g=arguments[i];for(var _ in g)Object.prototype.hasOwnProperty.call(g,_)&&(h[_]=g[_])}return h},_extends$5.apply(this,arguments)}function _toPrimitive(h,i){if(typeof h!="object"||h===null)return h;var g=h[Symbol.toPrimitive];if(g!==void 0){var _=g.call(h,i||"default");if(typeof _!="object")return _;throw new TypeError("@@toPrimitive must return a primitive value.")}return(i==="string"?String:Number)(h)}function _toPropertyKey(h){var i=_toPrimitive(h,"string");return typeof i=="symbol"?i:String(i)}const isFiniteNumber=Number.isFinite||function(h){return typeof h=="number"&&isFinite(h)};let Events=function(h){return h.MEDIA_ATTACHING="hlsMediaAttaching",h.MEDIA_ATTACHED="hlsMediaAttached",h.MEDIA_DETACHING="hlsMediaDetaching",h.MEDIA_DETACHED="hlsMediaDetached",h.BUFFER_RESET="hlsBufferReset",h.BUFFER_CODECS="hlsBufferCodecs",h.BUFFER_CREATED="hlsBufferCreated",h.BUFFER_APPENDING="hlsBufferAppending",h.BUFFER_APPENDED="hlsBufferAppended",h.BUFFER_EOS="hlsBufferEos",h.BUFFER_FLUSHING="hlsBufferFlushing",h.BUFFER_FLUSHED="hlsBufferFlushed",h.MANIFEST_LOADING="hlsManifestLoading",h.MANIFEST_LOADED="hlsManifestLoaded",h.MANIFEST_PARSED="hlsManifestParsed",h.LEVEL_SWITCHING="hlsLevelSwitching",h.LEVEL_SWITCHED="hlsLevelSwitched",h.LEVEL_LOADING="hlsLevelLoading",h.LEVEL_LOADED="hlsLevelLoaded",h.LEVEL_UPDATED="hlsLevelUpdated",h.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",h.LEVELS_UPDATED="hlsLevelsUpdated",h.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",h.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",h.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",h.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",h.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",h.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",h.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",h.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",h.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",h.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",h.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",h.CUES_PARSED="hlsCuesParsed",h.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",h.INIT_PTS_FOUND="hlsInitPtsFound",h.FRAG_LOADING="hlsFragLoading",h.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",h.FRAG_LOADED="hlsFragLoaded",h.FRAG_DECRYPTED="hlsFragDecrypted",h.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",h.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",h.FRAG_PARSING_METADATA="hlsFragParsingMetadata",h.FRAG_PARSED="hlsFragParsed",h.FRAG_BUFFERED="hlsFragBuffered",h.FRAG_CHANGED="hlsFragChanged",h.FPS_DROP="hlsFpsDrop",h.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",h.ERROR="hlsError",h.DESTROYING="hlsDestroying",h.KEY_LOADING="hlsKeyLoading",h.KEY_LOADED="hlsKeyLoaded",h.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",h.BACK_BUFFER_REACHED="hlsBackBufferReached",h}({}),ErrorTypes=function(h){return h.NETWORK_ERROR="networkError",h.MEDIA_ERROR="mediaError",h.KEY_SYSTEM_ERROR="keySystemError",h.MUX_ERROR="muxError",h.OTHER_ERROR="otherError",h}({}),ErrorDetails=function(h){return h.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",h.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",h.KEY_SYSTEM_NO_SESSION="keySystemNoSession",h.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",h.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",h.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",h.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",h.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",h.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",h.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",h.MANIFEST_LOAD_ERROR="manifestLoadError",h.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",h.MANIFEST_PARSING_ERROR="manifestParsingError",h.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",h.LEVEL_EMPTY_ERROR="levelEmptyError",h.LEVEL_LOAD_ERROR="levelLoadError",h.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",h.LEVEL_PARSING_ERROR="levelParsingError",h.LEVEL_SWITCH_ERROR="levelSwitchError",h.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",h.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",h.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",h.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",h.FRAG_LOAD_ERROR="fragLoadError",h.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",h.FRAG_DECRYPT_ERROR="fragDecryptError",h.FRAG_PARSING_ERROR="fragParsingError",h.FRAG_GAP="fragGap",h.REMUX_ALLOC_ERROR="remuxAllocError",h.KEY_LOAD_ERROR="keyLoadError",h.KEY_LOAD_TIMEOUT="keyLoadTimeOut",h.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",h.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",h.BUFFER_APPEND_ERROR="bufferAppendError",h.BUFFER_APPENDING_ERROR="bufferAppendingError",h.BUFFER_STALLED_ERROR="bufferStalledError",h.BUFFER_FULL_ERROR="bufferFullError",h.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",h.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",h.INTERNAL_EXCEPTION="internalException",h.INTERNAL_ABORTED="aborted",h.UNKNOWN="unknown",h}({});const noop$3=function(){},fakeLogger={trace:noop$3,debug:noop$3,log:noop$3,warn:noop$3,info:noop$3,error:noop$3};let exportedLogger=fakeLogger;function consolePrintFn(h){const i=self.console[h];return i?i.bind(self.console,`[${h}] >`):noop$3}function exportLoggerFunctions(h,...i){i.forEach(function(g){exportedLogger[g]=h[g]?h[g].bind(h):consolePrintFn(g)})}function enableLogs(h,i){if(self.console&&h===!0||typeof h=="object"){exportLoggerFunctions(h,"debug","log","info","warn","error");try{exportedLogger.log(`Debug logs enabled for "${i}" in hls.js version 1.4.6`)}catch{exportedLogger=fakeLogger}}else exportedLogger=fakeLogger}const logger=exportedLogger,DECIMAL_RESOLUTION_REGEX=/^(\d+)x(\d+)$/,ATTR_LIST_REGEX=/(.+?)=(".*?"|.*?)(?:,|$)/g;class AttrList{constructor(i){typeof i=="string"&&(i=AttrList.parseAttrList(i));for(const g in i)i.hasOwnProperty(g)&&(g.substring(0,2)==="X-"&&(this.clientAttrs=this.clientAttrs||[],this.clientAttrs.push(g)),this[g]=i[g])}decimalInteger(i){const g=parseInt(this[i],10);return g>Number.MAX_SAFE_INTEGER?1/0:g}hexadecimalInteger(i){if(this[i]){let g=(this[i]||"0x").slice(2);g=(g.length&1?"0":"")+g;const _=new Uint8Array(g.length/2);for(let j=0;j<g.length/2;j++)_[j]=parseInt(g.slice(j*2,j*2+2),16);return _}else return null}hexadecimalIntegerAsNumber(i){const g=parseInt(this[i],16);return g>Number.MAX_SAFE_INTEGER?1/0:g}decimalFloatingPoint(i){return parseFloat(this[i])}optionalFloat(i,g){const _=this[i];return _?parseFloat(_):g}enumeratedString(i){return this[i]}bool(i){return this[i]==="YES"}decimalResolution(i){const g=DECIMAL_RESOLUTION_REGEX.exec(this[i]);if(g!==null)return{width:parseInt(g[1],10),height:parseInt(g[2],10)}}static parseAttrList(i){let g;const _={},j='"';for(ATTR_LIST_REGEX.lastIndex=0;(g=ATTR_LIST_REGEX.exec(i))!==null;){let $=g[2];$.indexOf(j)===0&&$.lastIndexOf(j)===$.length-1&&($=$.slice(1,-1));const _n=g[1].trim();_[_n]=$}return _}}function isDateRangeCueAttribute(h){return h!=="ID"&&h!=="CLASS"&&h!=="START-DATE"&&h!=="DURATION"&&h!=="END-DATE"&&h!=="END-ON-NEXT"}function isSCTE35Attribute(h){return h==="SCTE35-OUT"||h==="SCTE35-IN"}class DateRange{constructor(i,g){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,g){const _=g.attr;for(const j in _)if(Object.prototype.hasOwnProperty.call(i,j)&&i[j]!==_[j]){logger.warn(`DATERANGE tag attribute: "${j}" does not match for tags with ID: "${i.ID}"`),this._badValueForSameId=j;break}i=_extends$5(new AttrList({}),_,i)}if(this.attr=i,this._startDate=new Date(i["START-DATE"]),"END-DATE"in this.attr){const _=new Date(this.attr["END-DATE"]);isFiniteNumber(_.getTime())&&(this._endDate=_)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get startDate(){return this._startDate}get endDate(){if(this._endDate)return this._endDate;const i=this.duration;return i!==null?new Date(this._startDate.getTime()+i*1e3):null}get duration(){if("DURATION"in this.attr){const i=this.attr.decimalFloatingPoint("DURATION");if(isFiniteNumber(i))return i}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isValid(){return!!this.id&&!this._badValueForSameId&&isFiniteNumber(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)}}class LoadStats{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var ElementaryStreamTypes={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class BaseSegment{constructor(i){this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams={[ElementaryStreamTypes.AUDIO]:null,[ElementaryStreamTypes.VIDEO]:null,[ElementaryStreamTypes.AUDIOVIDEO]:null},this.baseurl=i}setByteRange(i,g){const _=i.split("@",2),j=[];_.length===1?j[0]=g?g.byteRangeEndOffset:0:j[0]=parseInt(_[1]),j[1]=parseInt(_[0])+j[0],this._byteRange=j}get byteRange(){return this._byteRange?this._byteRange:[]}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=urlToolkitExports.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(i){this._url=i}}class Fragment extends BaseSegment{constructor(i,g){super(g),this._decryptdata=null,this.rawProgramDateTime=null,this.programDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.stats=new LoadStats,this.urlId=0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.type=i}get decryptdata(){const{levelkeys:i}=this;if(!i&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){const g=this.levelkeys.identity;if(g)this._decryptdata=g.getDecryptData(this.sn);else{const _=Object.keys(this.levelkeys);if(_.length===1)return this._decryptdata=this.levelkeys[_[0]].getDecryptData(this.sn)}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null||!isFiniteNumber(this.programDateTime))return null;const i=isFiniteNumber(this.duration)?this.duration:0;return this.programDateTime+i*1e3}get encrypted(){var i;if((i=this._decryptdata)!=null&&i.encrypted)return!0;if(this.levelkeys){const g=Object.keys(this.levelkeys),_=g.length;if(_>1||_===1&&this.levelkeys[g[0]].encrypted)return!0}return!1}setKeyFormat(i){if(this.levelkeys){const g=this.levelkeys[i];g&&!this._decryptdata&&(this._decryptdata=g.getDecryptData(this.sn))}}abortRequests(){var i,g;(i=this.loader)==null||i.abort(),(g=this.keyLoader)==null||g.abort()}setElementaryStreamInfo(i,g,_,j,$,_n=!1){const{elementaryStreams:_i}=this,_s=_i[i];if(!_s){_i[i]={startPTS:g,endPTS:_,startDTS:j,endDTS:$,partial:_n};return}_s.startPTS=Math.min(_s.startPTS,g),_s.endPTS=Math.max(_s.endPTS,_),_s.startDTS=Math.min(_s.startDTS,j),_s.endDTS=Math.max(_s.endDTS,$)}clearElementaryStreamInfo(){const{elementaryStreams:i}=this;i[ElementaryStreamTypes.AUDIO]=null,i[ElementaryStreamTypes.VIDEO]=null,i[ElementaryStreamTypes.AUDIOVIDEO]=null}}class Part extends BaseSegment{constructor(i,g,_,j,$){super(_),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.stats=new LoadStats,this.duration=i.decimalFloatingPoint("DURATION"),this.gap=i.bool("GAP"),this.independent=i.bool("INDEPENDENT"),this.relurl=i.enumeratedString("URI"),this.fragment=g,this.index=j;const _n=i.enumeratedString("BYTERANGE");_n&&this.setByteRange(_n,$),$&&(this.fragOffset=$.fragOffset+$.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:i}=this;return!!(i.audio||i.video||i.audiovideo)}}const DEFAULT_TARGET_DURATION=10;class LevelDetails{constructor(i){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=i}reloaded(i){if(!i){this.advanced=!0,this.updated=!0;return}const g=this.lastPartSn-i.lastPartSn,_=this.lastPartIndex-i.lastPartIndex;this.updated=this.endSN!==i.endSN||!!_||!!g,this.advanced=this.endSN>i.endSN||g>0||g===0&&_>0,this.updated||this.advanced?this.misses=Math.floor(i.misses*.6):this.misses=i.misses+1,this.availabilityDelay=i.availabilityDelay}get hasProgramDateTime(){return this.fragments.length?isFiniteNumber(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||DEFAULT_TARGET_DURATION}get drift(){const i=this.driftEndTime-this.driftStartTime;return i>0?(this.driftEnd-this.driftStart)*1e3/i:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var i;return(i=this.partList)!=null&&i.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){var i;return(i=this.fragments)!=null&&i.length?this.fragments[this.fragments.length-1].end:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var i;return(i=this.partList)!=null&&i.length?this.partList[this.partList.length-1].index:-1}get lastPartSn(){var i;return(i=this.partList)!=null&&i.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}function base64Decode(h){return Uint8Array.from(atob(h),i=>i.charCodeAt(0))}function getKeyIdBytes(h){const i=strToUtf8array(h).subarray(0,16),g=new Uint8Array(16);return g.set(i,16-i.length),g}function changeEndianness(h){const i=function(_,j,$){const _n=_[j];_[j]=_[$],_[$]=_n};i(h,0,3),i(h,1,2),i(h,4,5),i(h,6,7)}function convertDataUriToArrayBytes(h){const i=h.split(":");let g=null;if(i[0]==="data"&&i.length===2){const _=i[1].split(";"),j=_[_.length-1].split(",");if(j.length===2){const $=j[0]==="base64",_n=j[1];$?(_.splice(-1,1),g=base64Decode(_n)):g=getKeyIdBytes(_n)}}return g}function strToUtf8array(h){return Uint8Array.from(unescape(encodeURIComponent(h)),i=>i.charCodeAt(0))}var KeySystems={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},KeySystemFormats={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function keySystemFormatToKeySystemDomain(h){switch(h){case KeySystemFormats.FAIRPLAY:return KeySystems.FAIRPLAY;case KeySystemFormats.PLAYREADY:return KeySystems.PLAYREADY;case KeySystemFormats.WIDEVINE:return KeySystems.WIDEVINE;case KeySystemFormats.CLEARKEY:return KeySystems.CLEARKEY}}var KeySystemIds={WIDEVINE:"edef8ba979d64acea3c827dcd51d21ed"};function keySystemIdToKeySystemDomain(h){if(h===KeySystemIds.WIDEVINE)return KeySystems.WIDEVINE}function keySystemDomainToKeySystemFormat(h){switch(h){case KeySystems.FAIRPLAY:return KeySystemFormats.FAIRPLAY;case KeySystems.PLAYREADY:return KeySystemFormats.PLAYREADY;case KeySystems.WIDEVINE:return KeySystemFormats.WIDEVINE;case KeySystems.CLEARKEY:return KeySystemFormats.CLEARKEY}}function getKeySystemsForConfig(h){const{drmSystems:i,widevineLicenseUrl:g}=h,_=i?[KeySystems.FAIRPLAY,KeySystems.WIDEVINE,KeySystems.PLAYREADY,KeySystems.CLEARKEY].filter(j=>!!i[j]):[];return!_[KeySystems.WIDEVINE]&&g&&_.push(KeySystems.WIDEVINE),_}const requestMediaKeySystemAccess=function(){return typeof self<"u"&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}();function getSupportedMediaKeySystemConfigurations(h,i,g,_){let j;switch(h){case KeySystems.FAIRPLAY:j=["cenc","sinf"];break;case KeySystems.WIDEVINE:case KeySystems.PLAYREADY:j=["cenc"];break;case KeySystems.CLEARKEY:j=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${h}`)}return createMediaKeySystemConfigurations(j,i,g,_)}function createMediaKeySystemConfigurations(h,i,g,_){return[{initDataTypes:h,persistentState:_.persistentState||"not-allowed",distinctiveIdentifier:_.distinctiveIdentifier||"not-allowed",sessionTypes:_.sessionTypes||[_.sessionType||"temporary"],audioCapabilities:i.map($=>({contentType:`audio/mp4; codecs="${$}"`,robustness:_.audioRobustness||"",encryptionScheme:_.audioEncryptionScheme||null})),videoCapabilities:g.map($=>({contentType:`video/mp4; codecs="${$}"`,robustness:_.videoRobustness||"",encryptionScheme:_.videoEncryptionScheme||null}))}]}function sliceUint8(h,i,g){return Uint8Array.prototype.slice?h.slice(i,g):new Uint8Array(Array.prototype.slice.call(h,i,g))}const isHeader$2=(h,i)=>i+10<=h.length&&h[i]===73&&h[i+1]===68&&h[i+2]===51&&h[i+3]<255&&h[i+4]<255&&h[i+6]<128&&h[i+7]<128&&h[i+8]<128&&h[i+9]<128,isFooter=(h,i)=>i+10<=h.length&&h[i]===51&&h[i+1]===68&&h[i+2]===73&&h[i+3]<255&&h[i+4]<255&&h[i+6]<128&&h[i+7]<128&&h[i+8]<128&&h[i+9]<128,getID3Data=(h,i)=>{const g=i;let _=0;for(;isHeader$2(h,i);){_+=10;const j=readSize(h,i+6);_+=j,isFooter(h,i+10)&&(_+=10),i+=_}if(_>0)return h.subarray(g,g+_)},readSize=(h,i)=>{let g=0;return g=(h[i]&127)<<21,g|=(h[i+1]&127)<<14,g|=(h[i+2]&127)<<7,g|=h[i+3]&127,g},canParse$2=(h,i)=>isHeader$2(h,i)&&readSize(h,i+6)+10<=h.length-i,getTimeStamp=h=>{const i=getID3Frames(h);for(let g=0;g<i.length;g++){const _=i[g];if(isTimeStampFrame(_))return readTimeStamp(_)}},isTimeStampFrame=h=>h&&h.key==="PRIV"&&h.info==="com.apple.streaming.transportStreamTimestamp",getFrameData=h=>{const i=String.fromCharCode(h[0],h[1],h[2],h[3]),g=readSize(h,4),_=10;return{type:i,size:g,data:h.subarray(_,_+g)}},getID3Frames=h=>{let i=0;const g=[];for(;isHeader$2(h,i);){const _=readSize(h,i+6);i+=10;const j=i+_;for(;i+8<j;){const $=getFrameData(h.subarray(i)),_n=decodeFrame($);_n&&g.push(_n),i+=$.size+10}isFooter(h,i)&&(i+=10)}return g},decodeFrame=h=>h.type==="PRIV"?decodePrivFrame(h):h.type[0]==="W"?decodeURLFrame(h):decodeTextFrame(h),decodePrivFrame=h=>{if(h.size<2)return;const i=utf8ArrayToStr(h.data,!0),g=new Uint8Array(h.data.subarray(i.length+1));return{key:h.type,info:i,data:g.buffer}},decodeTextFrame=h=>{if(h.size<2)return;if(h.type==="TXXX"){let g=1;const _=utf8ArrayToStr(h.data.subarray(g),!0);g+=_.length+1;const j=utf8ArrayToStr(h.data.subarray(g));return{key:h.type,info:_,data:j}}const i=utf8ArrayToStr(h.data.subarray(1));return{key:h.type,data:i}},decodeURLFrame=h=>{if(h.type==="WXXX"){if(h.size<2)return;let g=1;const _=utf8ArrayToStr(h.data.subarray(g),!0);g+=_.length+1;const j=utf8ArrayToStr(h.data.subarray(g));return{key:h.type,info:_,data:j}}const i=utf8ArrayToStr(h.data);return{key:h.type,data:i}},readTimeStamp=h=>{if(h.data.byteLength===8){const i=new Uint8Array(h.data),g=i[3]&1;let _=(i[4]<<23)+(i[5]<<15)+(i[6]<<7)+i[7];return _/=45,g&&(_+=4772185884e-2),Math.round(_)}},utf8ArrayToStr=(h,i=!1)=>{const g=getTextDecoder();if(g){const ga=g.decode(h);if(i){const ba=ga.indexOf("\0");return ba!==-1?ga.substring(0,ba):ga}return ga.replace(/\0/g,"")}const _=h.length;let j,$,_n,_i="",_s=0;for(;_s<_;){if(j=h[_s++],j===0&&i)return _i;if(j===0||j===3)continue;switch(j>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:_i+=String.fromCharCode(j);break;case 12:case 13:$=h[_s++],_i+=String.fromCharCode((j&31)<<6|$&63);break;case 14:$=h[_s++],_n=h[_s++],_i+=String.fromCharCode((j&15)<<12|($&63)<<6|(_n&63)<<0);break}}return _i};let decoder;function getTextDecoder(){return!decoder&&typeof self.TextDecoder<"u"&&(decoder=new self.TextDecoder("utf-8")),decoder}const Hex={hexDump:function(h){let i="";for(let g=0;g<h.length;g++){let _=h[g].toString(16);_.length<2&&(_="0"+_),i+=_}return i}},UINT32_MAX$1=Math.pow(2,32)-1,push=[].push,RemuxerTrackIdConfig={video:1,audio:2,id3:3,text:4};function bin2str(h){return String.fromCharCode.apply(null,h)}function readUint16(h,i){const g=h[i]<<8|h[i+1];return g<0?65536+g:g}function readUint32(h,i){const g=readSint32(h,i);return g<0?4294967296+g:g}function readSint32(h,i){return h[i]<<24|h[i+1]<<16|h[i+2]<<8|h[i+3]}function writeUint32(h,i,g){h[i]=g>>24,h[i+1]=g>>16&255,h[i+2]=g>>8&255,h[i+3]=g&255}function findBox(h,i){const g=[];if(!i.length)return g;const _=h.byteLength;for(let j=0;j<_;){const $=readUint32(h,j),_n=bin2str(h.subarray(j+4,j+8)),_i=$>1?j+$:_;if(_n===i[0])if(i.length===1)g.push(h.subarray(j+8,_i));else{const _s=findBox(h.subarray(j+8,_i),i.slice(1));_s.length&&push.apply(g,_s)}j=_i}return g}function parseSegmentIndex(h){const i=[],g=h[0];let _=8;const j=readUint32(h,_);_+=4;const $=0,_n=0;g===0?_+=8:_+=16,_+=2;let _i=h.length+_n;const _s=readUint16(h,_);_+=2;for(let ga=0;ga<_s;ga++){let ba=_;const xa=readUint32(h,ba);ba+=4;const El=xa&2147483647;if((xa&2147483648)>>>31===1)return logger.warn("SIDX has hierarchical references (not supported)"),null;const Sl=readUint32(h,ba);ba+=4,i.push({referenceSize:El,subsegmentDuration:Sl,info:{duration:Sl/j,start:_i,end:_i+El-1}}),_i+=El,ba+=4,_=ba}return{earliestPresentationTime:$,timescale:j,version:g,referencesCount:_s,references:i}}function parseInitSegment(h){const i=[],g=findBox(h,["moov","trak"]);for(let j=0;j<g.length;j++){const $=g[j],_n=findBox($,["tkhd"])[0];if(_n){let _i=_n[0],_s=_i===0?12:20;const ga=readUint32(_n,_s),ba=findBox($,["mdia","mdhd"])[0];if(ba){_i=ba[0],_s=_i===0?12:20;const xa=readUint32(ba,_s),El=findBox($,["mdia","hdlr"])[0];if(El){const Tl=bin2str(El.subarray(8,12)),Sl={soun:ElementaryStreamTypes.AUDIO,vide:ElementaryStreamTypes.VIDEO}[Tl];if(Sl){const Il=findBox($,["mdia","minf","stbl","stsd"])[0];let Cl;Il&&(Cl=bin2str(Il.subarray(12,16))),i[ga]={timescale:xa,type:Sl},i[Sl]={timescale:xa,id:ga,codec:Cl}}}}}}return findBox(h,["moov","mvex","trex"]).forEach(j=>{const $=readUint32(j,4),_n=i[$];_n&&(_n.default={duration:readUint32(j,12),flags:readUint32(j,20)})}),i}function patchEncyptionData(h,i){if(!h||!i)return h;const g=i.keyId;return g&&i.isCommonEncryption&&findBox(h,["moov","trak"]).forEach(j=>{const _n=findBox(j,["mdia","minf","stbl","stsd"])[0].subarray(8);let _i=findBox(_n,["enca"]);const _s=_i.length>0;_s||(_i=findBox(_n,["encv"])),_i.forEach(ga=>{const ba=_s?ga.subarray(28):ga.subarray(78);findBox(ba,["sinf"]).forEach(El=>{const Tl=parseSinf(El);if(Tl){const Sl=Tl.subarray(8,24);Sl.some(Il=>Il!==0)||(logger.log(`[eme] Patching keyId in 'enc${_s?"a":"v"}>sinf>>tenc' box: ${Hex.hexDump(Sl)} -> ${Hex.hexDump(g)}`),Tl.set(g,8))}})})}),h}function parseSinf(h){const i=findBox(h,["schm"])[0];if(i){const g=bin2str(i.subarray(4,8));if(g==="cbcs"||g==="cenc")return findBox(h,["schi","tenc"])[0]}return logger.error("[eme] missing 'schm' box"),null}function getStartDTS(h,i){return findBox(i,["moof","traf"]).reduce((g,_)=>{const j=findBox(_,["tfdt"])[0],$=j[0],_n=findBox(_,["tfhd"]).reduce((_i,_s)=>{const ga=readUint32(_s,4),ba=h[ga];if(ba){let xa=readUint32(j,4);if($===1){if(xa===UINT32_MAX$1)return logger.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"),_i;xa*=UINT32_MAX$1+1,xa+=readUint32(j,8)}const El=ba.timescale||9e4,Tl=xa/El;if(isFinite(Tl)&&(_i===null||Tl<_i))return Tl}return _i},null);return _n!==null&&isFinite(_n)&&(g===null||_n<g)?_n:g},null)}function getDuration(h,i){let g=0,_=0,j=0;const $=findBox(h,["moof","traf"]);for(let _n=0;_n<$.length;_n++){const _i=$[_n],_s=findBox(_i,["tfhd"])[0],ga=readUint32(_s,4),ba=i[ga];if(!ba)continue;const xa=ba.default,El=readUint32(_s,0)|(xa==null?void 0:xa.flags);let Tl=xa==null?void 0:xa.duration;El&8&&(El&2?Tl=readUint32(_s,12):Tl=readUint32(_s,8));const Sl=ba.timescale||9e4,Il=findBox(_i,["trun"]);for(let Cl=0;Cl<Il.length;Cl++){if(g=computeRawDurationFromSamples(Il[Cl]),!g&&Tl){const Nl=readUint32(Il[Cl],4);g=Tl*Nl}ba.type===ElementaryStreamTypes.VIDEO?_+=g/Sl:ba.type===ElementaryStreamTypes.AUDIO&&(j+=g/Sl)}}if(_===0&&j===0){let _n=0;const _i=findBox(h,["sidx"]);for(let _s=0;_s<_i.length;_s++){const ga=parseSegmentIndex(_i[_s]);ga!=null&&ga.references&&(_n+=ga.references.reduce((ba,xa)=>ba+xa.info.duration||0,0))}return _n}return _||j}function computeRawDurationFromSamples(h){const i=readUint32(h,0);let g=8;i&1&&(g+=4),i&4&&(g+=4);let _=0;const j=readUint32(h,4);for(let $=0;$<j;$++){if(i&256){const _n=readUint32(h,g);_+=_n,g+=4}i&512&&(g+=4),i&1024&&(g+=4),i&2048&&(g+=4)}return _}function offsetStartDTS(h,i,g){findBox(i,["moof","traf"]).forEach(_=>{findBox(_,["tfhd"]).forEach(j=>{const $=readUint32(j,4),_n=h[$];if(!_n)return;const _i=_n.timescale||9e4;findBox(_,["tfdt"]).forEach(_s=>{const ga=_s[0];let ba=readUint32(_s,4);if(ga===0)ba-=g*_i,ba=Math.max(ba,0),writeUint32(_s,4,ba);else{ba*=Math.pow(2,32),ba+=readUint32(_s,8),ba-=g*_i,ba=Math.max(ba,0);const xa=Math.floor(ba/(UINT32_MAX$1+1)),El=Math.floor(ba%(UINT32_MAX$1+1));writeUint32(_s,4,xa),writeUint32(_s,8,El)}})})})}function segmentValidRange(h){const i={valid:null,remainder:null},g=findBox(h,["moof"]);if(g){if(g.length<2)return i.remainder=h,i}else return i;const _=g[g.length-1];return i.valid=sliceUint8(h,0,_.byteOffset-8),i.remainder=sliceUint8(h,_.byteOffset-8),i}function appendUint8Array(h,i){const g=new Uint8Array(h.length+i.length);return g.set(h),g.set(i,h.length),g}function parseSamples(h,i){const g=[],_=i.samples,j=i.timescale,$=i.id;let _n=!1;return findBox(_,["moof"]).map(_s=>{const ga=_s.byteOffset-8;findBox(_s,["traf"]).map(xa=>{const El=findBox(xa,["tfdt"]).map(Tl=>{const Sl=Tl[0];let Il=readUint32(Tl,4);return Sl===1&&(Il*=Math.pow(2,32),Il+=readUint32(Tl,8)),Il/j})[0];return El!==void 0&&(h=El),findBox(xa,["tfhd"]).map(Tl=>{const Sl=readUint32(Tl,4),Il=readUint32(Tl,0)&16777215,Cl=(Il&1)!==0,Nl=(Il&2)!==0,Dl=(Il&8)!==0;let Ul=0;const Kl=(Il&16)!==0;let Jl=0;const Ep=(Il&32)!==0;let _p=8;Sl===$&&(Cl&&(_p+=8),Nl&&(_p+=4),Dl&&(Ul=readUint32(Tl,_p),_p+=4),Kl&&(Jl=readUint32(Tl,_p),_p+=4),Ep&&(_p+=4),i.type==="video"&&(_n=isHEVC(i.codec)),findBox(xa,["trun"]).map(Ip=>{const Up=Ip[0],yp=readUint32(Ip,0)&16777215,Ap=(yp&1)!==0;let Cp=0;const Mp=(yp&4)!==0,wp=(yp&256)!==0;let Np=0;const Fp=(yp&512)!==0;let Hp=0;const xp=(yp&1024)!==0,Gp=(yp&2048)!==0;let $p=0;const c0=readUint32(Ip,4);let n0=8;Ap&&(Cp=readUint32(Ip,n0),n0+=4),Mp&&(n0+=4);let C0=Cp+ga;for(let Op=0;Op<c0;Op++){if(wp?(Np=readUint32(Ip,n0),n0+=4):Np=Ul,Fp?(Hp=readUint32(Ip,n0),n0+=4):Hp=Jl,xp&&(n0+=4),Gp&&(Up===0?$p=readUint32(Ip,n0):$p=readSint32(Ip,n0),n0+=4),i.type===ElementaryStreamTypes.VIDEO){let Q0=0;for(;Q0<Hp;){const dy=readUint32(_,C0);if(C0+=4,isSEIMessage(_n,_[C0])){const Yy=_.subarray(C0,C0+dy);parseSEIMessageFromNALu(Yy,_n?2:1,h+$p/j,g)}C0+=dy,Q0+=dy+4}}h+=Np/j}}))})})}),g}function isHEVC(h){if(!h)return!1;const i=h.indexOf("."),g=i<0?h:h.substring(0,i);return g==="hvc1"||g==="hev1"||g==="dvh1"||g==="dvhe"}function isSEIMessage(h,i){if(h){const g=i>>1&63;return g===39||g===40}else return(i&31)===6}function parseSEIMessageFromNALu(h,i,g,_){const j=discardEPB(h);let $=0;$+=i;let _n=0,_i=0,_s=!1,ga=0;for(;$<j.length;){_n=0;do{if($>=j.length)break;ga=j[$++],_n+=ga}while(ga===255);_i=0;do{if($>=j.length)break;ga=j[$++],_i+=ga}while(ga===255);const ba=j.length-$;if(!_s&&_n===4&&$<j.length){if(_s=!0,j[$++]===181){const El=readUint16(j,$);if($+=2,El===49){const Tl=readUint32(j,$);if($+=4,Tl===1195456820){const Sl=j[$++];if(Sl===3){const Il=j[$++],Cl=31&Il,Nl=64&Il,Dl=Nl?2+Cl*3:0,Ul=new Uint8Array(Dl);if(Nl){Ul[0]=Il;for(let Kl=1;Kl<Dl;Kl++)Ul[Kl]=j[$++]}_.push({type:Sl,payloadType:_n,pts:g,bytes:Ul})}}}}}else if(_n===5&&_i<ba){if(_s=!0,_i>16){const xa=[];for(let Sl=0;Sl<16;Sl++){const Il=j[$++].toString(16);xa.push(Il.length==1?"0"+Il:Il),(Sl===3||Sl===5||Sl===7||Sl===9)&&xa.push("-")}const El=_i-16,Tl=new Uint8Array(El);for(let Sl=0;Sl<El;Sl++)Tl[Sl]=j[$++];_.push({payloadType:_n,pts:g,uuid:xa.join(""),userData:utf8ArrayToStr(Tl),userDataBytes:Tl})}}else if(_i<ba)$+=_i;else if(_i>ba)break}}function discardEPB(h){const i=h.byteLength,g=[];let _=1;for(;_<i-2;)h[_]===0&&h[_+1]===0&&h[_+2]===3?(g.push(_+2),_+=2):_++;if(g.length===0)return h;const j=i-g.length,$=new Uint8Array(j);let _n=0;for(_=0;_<j;_n++,_++)_n===g[0]&&(_n++,g.shift()),$[_]=h[_n];return $}function parseEmsg(h){const i=h[0];let g="",_="",j=0,$=0,_n=0,_i=0,_s=0,ga=0;if(i===0){for(;bin2str(h.subarray(ga,ga+1))!=="\0";)g+=bin2str(h.subarray(ga,ga+1)),ga+=1;for(g+=bin2str(h.subarray(ga,ga+1)),ga+=1;bin2str(h.subarray(ga,ga+1))!=="\0";)_+=bin2str(h.subarray(ga,ga+1)),ga+=1;_+=bin2str(h.subarray(ga,ga+1)),ga+=1,j=readUint32(h,12),$=readUint32(h,16),_i=readUint32(h,20),_s=readUint32(h,24),ga=28}else if(i===1){ga+=4,j=readUint32(h,ga),ga+=4;const xa=readUint32(h,ga);ga+=4;const El=readUint32(h,ga);for(ga+=4,_n=2**32*xa+El,Number.isSafeInteger(_n)||(_n=Number.MAX_SAFE_INTEGER,logger.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),_i=readUint32(h,ga),ga+=4,_s=readUint32(h,ga),ga+=4;bin2str(h.subarray(ga,ga+1))!=="\0";)g+=bin2str(h.subarray(ga,ga+1)),ga+=1;for(g+=bin2str(h.subarray(ga,ga+1)),ga+=1;bin2str(h.subarray(ga,ga+1))!=="\0";)_+=bin2str(h.subarray(ga,ga+1)),ga+=1;_+=bin2str(h.subarray(ga,ga+1)),ga+=1}const ba=h.subarray(ga,h.byteLength);return{schemeIdUri:g,value:_,timeScale:j,presentationTime:_n,presentationTimeDelta:$,eventDuration:_i,id:_s,payload:ba}}function mp4Box(h,...i){const g=i.length;let _=8,j=g;for(;j--;)_+=i[j].byteLength;const $=new Uint8Array(_);for($[0]=_>>24&255,$[1]=_>>16&255,$[2]=_>>8&255,$[3]=_&255,$.set(h,4),j=0,_=8;j<g;j++)$.set(i[j],_),_+=i[j].byteLength;return $}function mp4pssh(h,i,g){if(h.byteLength!==16)throw new RangeError("Invalid system id");let _,j;if(i){_=1,j=new Uint8Array(i.length*16);for(let _i=0;_i<i.length;_i++){const _s=i[_i];if(_s.byteLength!==16)throw new RangeError("Invalid key");j.set(_s,_i*16)}}else _=0,j=new Uint8Array;let $;_>0?($=new Uint8Array(4),i.length>0&&new DataView($.buffer).setUint32(0,i.length,!1)):$=new Uint8Array;const _n=new Uint8Array(4);return g&&g.byteLength>0&&new DataView(_n.buffer).setUint32(0,g.byteLength,!1),mp4Box([112,115,115,104],new Uint8Array([_,0,0,0]),h,$,j,_n,g||new Uint8Array)}function parsePssh(h){if(!(h instanceof ArrayBuffer)||h.byteLength<32)return null;const i={version:0,systemId:"",kids:null,data:null},g=new DataView(h),_=g.getUint32(0);if(h.byteLength!==_&&_>44||g.getUint32(4)!==1886614376||(i.version=g.getUint32(8)>>>24,i.version>1))return null;i.systemId=Hex.hexDump(new Uint8Array(h,12,16));const $=g.getUint32(28);if(i.version===0){if(_-32<$)return null;i.data=new Uint8Array(h,32,$)}else if(i.version===1){i.kids=[];for(let _n=0;_n<$;_n++)i.kids.push(new Uint8Array(h,32+_n*16,16))}return i}let keyUriToKeyIdMap={};class LevelKey{static clearKeyUriToKeyIdMap(){keyUriToKeyIdMap={}}constructor(i,g,_,j=[1],$=null){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=i,this.uri=g,this.keyFormat=_,this.keyFormatVersions=j,this.iv=$,this.encrypted=i?i!=="NONE":!1,this.isCommonEncryption=this.encrypted&&i!=="AES-128"}isSupported(){if(this.method){if(this.method==="AES-128"||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case KeySystemFormats.FAIRPLAY:case KeySystemFormats.WIDEVINE:case KeySystemFormats.PLAYREADY:case KeySystemFormats.CLEARKEY:return["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(i){if(!this.encrypted||!this.uri)return null;if(this.method==="AES-128"&&this.uri&&!this.iv){typeof i!="number"&&(this.method==="AES-128"&&!this.iv&&logger.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),i=0);const _=createInitializationVector(i);return new LevelKey(this.method,this.uri,"identity",this.keyFormatVersions,_)}const g=convertDataUriToArrayBytes(this.uri);if(g)switch(this.keyFormat){case KeySystemFormats.WIDEVINE:this.pssh=g,g.length>=22&&(this.keyId=g.subarray(g.length-22,g.length-6));break;case KeySystemFormats.PLAYREADY:{const _=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=mp4pssh(_,null,g);const j=new Uint16Array(g.buffer,g.byteOffset,g.byteLength/2),$=String.fromCharCode.apply(null,Array.from(j)),_n=$.substring($.indexOf("<"),$.length),ga=new DOMParser().parseFromString(_n,"text/xml").getElementsByTagName("KID")[0];if(ga){const ba=ga.childNodes[0]?ga.childNodes[0].nodeValue:ga.getAttribute("VALUE");if(ba){const xa=base64Decode(ba).subarray(0,16);changeEndianness(xa),this.keyId=xa}}break}default:{let _=g.subarray(0,16);if(_.length!==16){const j=new Uint8Array(16);j.set(_,16-_.length),_=j}this.keyId=_;break}}if(!this.keyId||this.keyId.byteLength!==16){let _=keyUriToKeyIdMap[this.uri];if(!_){const j=Object.keys(keyUriToKeyIdMap).length%Number.MAX_SAFE_INTEGER;_=new Uint8Array(16),new DataView(_.buffer,12,4).setUint32(0,j),keyUriToKeyIdMap[this.uri]=_}this.keyId=_}return this}}function createInitializationVector(h){const i=new Uint8Array(16);for(let g=12;g<16;g++)i[g]=h>>8*(15-g)&255;return i}const VARIABLE_REPLACEMENT_REGEX=/\{\$([a-zA-Z0-9-_]+)\}/g;function hasVariableReferences(h){return VARIABLE_REPLACEMENT_REGEX.test(h)}function substituteVariablesInAttributes(h,i,g){if(h.variableList!==null||h.hasVariableRefs)for(let _=g.length;_--;){const j=g[_],$=i[j];$&&(i[j]=substituteVariables(h,$))}}function substituteVariables(h,i){if(h.variableList!==null||h.hasVariableRefs){const g=h.variableList;return i.replace(VARIABLE_REPLACEMENT_REGEX,_=>{const j=_.substring(2,_.length-1),$=g==null?void 0:g[j];return $===void 0?(h.playlistParsingError||(h.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${j}"`)),_):$})}return i}function addVariableDefinition(h,i,g){let _=h.variableList;_||(h.variableList=_={});let j,$;if("QUERYPARAM"in i){j=i.QUERYPARAM;try{const _n=new self.URL(g).searchParams;if(_n.has(j))$=_n.get(j);else throw new Error(`"${j}" does not match any query parameter in URI: "${g}"`)}catch(_n){h.playlistParsingError||(h.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${_n.message}`))}}else j=i.NAME,$=i.VALUE;j in _?h.playlistParsingError||(h.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${j}"`)):_[j]=$||""}function importVariableDefinition(h,i,g){const _=i.IMPORT;if(g&&_ in g){let j=h.variableList;j||(h.variableList=j={}),j[_]=g[_]}else h.playlistParsingError||(h.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${_}"`))}function getMediaSource(){if(!(typeof self>"u"))return self.MediaSource||self.WebKitMediaSource}const sampleEntryCodesISO={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dva1:!0,dvav:!0,dvh1:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}},MediaSource$2=getMediaSource();function isCodecType(h,i){const g=sampleEntryCodesISO[i];return!!g&&g[h.slice(0,4)]===!0}function isCodecSupportedInMp4(h,i){var g;return(g=MediaSource$2==null?void 0:MediaSource$2.isTypeSupported(`${i||"video"}/mp4;codecs="${h}"`))!=null?g:!1}const MASTER_PLAYLIST_REGEX=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,MASTER_PLAYLIST_MEDIA_REGEX=/#EXT-X-MEDIA:(.*)/g,IS_MEDIA_PLAYLIST=/^#EXT(?:INF|-X-TARGETDURATION):/m,LEVEL_PLAYLIST_REGEX_FAST=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),LEVEL_PLAYLIST_REGEX_SLOW=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class M3U8Parser{static findGroup(i,g){for(let _=0;_<i.length;_++){const j=i[_];if(j.id===g)return j}}static convertAVC1ToAVCOTI(i){const g=i.split(".");if(g.length>2){let _=g.shift()+".";return _+=parseInt(g.shift()).toString(16),_+=("000"+parseInt(g.shift()).toString(16)).slice(-4),_}return i}static resolve(i,g){return urlToolkitExports.buildAbsoluteURL(g,i,{alwaysNormalize:!0})}static isMediaPlaylist(i){return IS_MEDIA_PLAYLIST.test(i)}static parseMasterPlaylist(i,g){const _=hasVariableReferences(i),j={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:_},$=[];MASTER_PLAYLIST_REGEX.lastIndex=0;let _n;for(;(_n=MASTER_PLAYLIST_REGEX.exec(i))!=null;)if(_n[1]){var _i;const ga=new AttrList(_n[1]);substituteVariablesInAttributes(j,ga,["CODECS","SUPPLEMENTAL-CODECS","ALLOWED-CPC","PATHWAY-ID","STABLE-VARIANT-ID","AUDIO","VIDEO","SUBTITLES","CLOSED-CAPTIONS","NAME"]);const ba=substituteVariables(j,_n[2]),xa={attrs:ga,bitrate:ga.decimalInteger("AVERAGE-BANDWIDTH")||ga.decimalInteger("BANDWIDTH"),name:ga.NAME,url:M3U8Parser.resolve(ba,g)},El=ga.decimalResolution("RESOLUTION");El&&(xa.width=El.width,xa.height=El.height),setCodecs((ga.CODECS||"").split(/[ ,]+/).filter(Tl=>Tl),xa),xa.videoCodec&&xa.videoCodec.indexOf("avc1")!==-1&&(xa.videoCodec=M3U8Parser.convertAVC1ToAVCOTI(xa.videoCodec)),(_i=xa.unknownCodecs)!=null&&_i.length||$.push(xa),j.levels.push(xa)}else if(_n[3]){const ga=_n[3],ba=_n[4];switch(ga){case"SESSION-DATA":{const xa=new AttrList(ba);substituteVariablesInAttributes(j,xa,["DATA-ID","LANGUAGE","VALUE","URI"]);const El=xa["DATA-ID"];El&&(j.sessionData===null&&(j.sessionData={}),j.sessionData[El]=xa);break}case"SESSION-KEY":{const xa=parseKey(ba,g,j);xa.encrypted&&xa.isSupported()?(j.sessionKeys===null&&(j.sessionKeys=[]),j.sessionKeys.push(xa)):logger.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${ba}"`);break}case"DEFINE":{{const xa=new AttrList(ba);substituteVariablesInAttributes(j,xa,["NAME","VALUE","QUERYPARAM"]),addVariableDefinition(j,xa,g)}break}case"CONTENT-STEERING":{const xa=new AttrList(ba);substituteVariablesInAttributes(j,xa,["SERVER-URI","PATHWAY-ID"]),j.contentSteering={uri:M3U8Parser.resolve(xa["SERVER-URI"],g),pathwayId:xa["PATHWAY-ID"]||"."};break}case"START":{j.startTimeOffset=parseStartTimeOffset(ba);break}}}const _s=$.length>0&&$.length<j.levels.length;return j.levels=_s?$:j.levels,j.levels.length===0&&(j.playlistParsingError=new Error("no levels found in manifest")),j}static parseMasterPlaylistMedia(i,g,_){let j;const $={},_n=_.levels,_i={AUDIO:_n.map(ga=>({id:ga.attrs.AUDIO,audioCodec:ga.audioCodec})),SUBTITLES:_n.map(ga=>({id:ga.attrs.SUBTITLES,textCodec:ga.textCodec})),"CLOSED-CAPTIONS":[]};let _s=0;for(MASTER_PLAYLIST_MEDIA_REGEX.lastIndex=0;(j=MASTER_PLAYLIST_MEDIA_REGEX.exec(i))!==null;){const ga=new AttrList(j[1]),ba=ga.TYPE;if(ba){const xa=_i[ba],El=$[ba]||[];$[ba]=El,substituteVariablesInAttributes(_,ga,["URI","GROUP-ID","LANGUAGE","ASSOC-LANGUAGE","STABLE-RENDITION-ID","NAME","INSTREAM-ID","CHARACTERISTICS","CHANNELS"]);const Tl={attrs:ga,bitrate:0,id:_s++,groupId:ga["GROUP-ID"]||"",instreamId:ga["INSTREAM-ID"],name:ga.NAME||ga.LANGUAGE||"",type:ba,default:ga.bool("DEFAULT"),autoselect:ga.bool("AUTOSELECT"),forced:ga.bool("FORCED"),lang:ga.LANGUAGE,url:ga.URI?M3U8Parser.resolve(ga.URI,g):""};if(xa!=null&&xa.length){const Sl=M3U8Parser.findGroup(xa,Tl.groupId)||xa[0];assignCodec(Tl,Sl,"audioCodec"),assignCodec(Tl,Sl,"textCodec")}El.push(Tl)}}return $}static parseLevelPlaylist(i,g,_,j,$,_n){const _i=new LevelDetails(g),_s=_i.fragments;let ga=null,ba=0,xa=0,El=0,Tl=0,Sl=null,Il=new Fragment(j,g),Cl,Nl,Dl,Ul=-1,Kl=!1;for(LEVEL_PLAYLIST_REGEX_FAST.lastIndex=0,_i.m3u8=i,_i.hasVariableRefs=hasVariableReferences(i);(Cl=LEVEL_PLAYLIST_REGEX_FAST.exec(i))!==null;){Kl&&(Kl=!1,Il=new Fragment(j,g),Il.start=El,Il.sn=ba,Il.cc=Tl,Il.level=_,ga&&(Il.initSegment=ga,Il.rawProgramDateTime=ga.rawProgramDateTime,ga.rawProgramDateTime=null));const Ip=Cl[1];if(Ip){Il.duration=parseFloat(Ip);const Up=(" "+Cl[2]).slice(1);Il.title=Up||null,Il.tagList.push(Up?["INF",Ip,Up]:["INF",Ip])}else if(Cl[3]){if(isFiniteNumber(Il.duration)){Il.start=El,Dl&&setFragLevelKeys(Il,Dl,_i),Il.sn=ba,Il.level=_,Il.cc=Tl,Il.urlId=$,_s.push(Il);const Up=(" "+Cl[3]).slice(1);Il.relurl=substituteVariables(_i,Up),assignProgramDateTime(Il,Sl),Sl=Il,El+=Il.duration,ba++,xa=0,Kl=!0}}else if(Cl[4]){const Up=(" "+Cl[4]).slice(1);Sl?Il.setByteRange(Up,Sl):Il.setByteRange(Up)}else if(Cl[5])Il.rawProgramDateTime=(" "+Cl[5]).slice(1),Il.tagList.push(["PROGRAM-DATE-TIME",Il.rawProgramDateTime]),Ul===-1&&(Ul=_s.length);else{if(Cl=Cl[0].match(LEVEL_PLAYLIST_REGEX_SLOW),!Cl){logger.warn("No matches on slow regex match for level playlist!");continue}for(Nl=1;Nl<Cl.length&&!(typeof Cl[Nl]<"u");Nl++);const Up=(" "+Cl[Nl]).slice(1),yp=(" "+Cl[Nl+1]).slice(1),Ap=Cl[Nl+2]?(" "+Cl[Nl+2]).slice(1):"";switch(Up){case"PLAYLIST-TYPE":_i.type=yp.toUpperCase();break;case"MEDIA-SEQUENCE":ba=_i.startSN=parseInt(yp);break;case"SKIP":{const Cp=new AttrList(yp);substituteVariablesInAttributes(_i,Cp,["RECENTLY-REMOVED-DATERANGES"]);const Mp=Cp.decimalInteger("SKIPPED-SEGMENTS");if(isFiniteNumber(Mp)){_i.skippedSegments=Mp;for(let Np=Mp;Np--;)_s.unshift(null);ba+=Mp}const wp=Cp.enumeratedString("RECENTLY-REMOVED-DATERANGES");wp&&(_i.recentlyRemovedDateranges=wp.split("	"));break}case"TARGETDURATION":_i.targetduration=Math.max(parseInt(yp),1);break;case"VERSION":_i.version=parseInt(yp);break;case"EXTM3U":break;case"ENDLIST":_i.live=!1;break;case"#":(yp||Ap)&&Il.tagList.push(Ap?[yp,Ap]:[yp]);break;case"DISCONTINUITY":Tl++,Il.tagList.push(["DIS"]);break;case"GAP":Il.gap=!0,Il.tagList.push([Up]);break;case"BITRATE":Il.tagList.push([Up,yp]);break;case"DATERANGE":{const Cp=new AttrList(yp);substituteVariablesInAttributes(_i,Cp,["ID","CLASS","START-DATE","END-DATE","SCTE35-CMD","SCTE35-OUT","SCTE35-IN"]),substituteVariablesInAttributes(_i,Cp,Cp.clientAttrs);const Mp=new DateRange(Cp,_i.dateRanges[Cp.ID]);Mp.isValid||_i.skippedSegments?_i.dateRanges[Mp.id]=Mp:logger.warn(`Ignoring invalid DATERANGE tag: "${yp}"`),Il.tagList.push(["EXT-X-DATERANGE",yp]);break}case"DEFINE":{{const Cp=new AttrList(yp);substituteVariablesInAttributes(_i,Cp,["NAME","VALUE","IMPORT","QUERYPARAM"]),"IMPORT"in Cp?importVariableDefinition(_i,Cp,_n):addVariableDefinition(_i,Cp,g)}break}case"DISCONTINUITY-SEQUENCE":Tl=parseInt(yp);break;case"KEY":{const Cp=parseKey(yp,g,_i);if(Cp.isSupported()){if(Cp.method==="NONE"){Dl=void 0;break}Dl||(Dl={}),Dl[Cp.keyFormat]&&(Dl=_extends$5({},Dl)),Dl[Cp.keyFormat]=Cp}else logger.warn(`[Keys] Ignoring invalid EXT-X-KEY tag: "${yp}"`);break}case"START":_i.startTimeOffset=parseStartTimeOffset(yp);break;case"MAP":{const Cp=new AttrList(yp);if(substituteVariablesInAttributes(_i,Cp,["BYTERANGE","URI"]),Il.duration){const Mp=new Fragment(j,g);setInitSegment(Mp,Cp,_,Dl),ga=Mp,Il.initSegment=ga,ga.rawProgramDateTime&&!Il.rawProgramDateTime&&(Il.rawProgramDateTime=ga.rawProgramDateTime)}else setInitSegment(Il,Cp,_,Dl),ga=Il,Kl=!0;break}case"SERVER-CONTROL":{const Cp=new AttrList(yp);_i.canBlockReload=Cp.bool("CAN-BLOCK-RELOAD"),_i.canSkipUntil=Cp.optionalFloat("CAN-SKIP-UNTIL",0),_i.canSkipDateRanges=_i.canSkipUntil>0&&Cp.bool("CAN-SKIP-DATERANGES"),_i.partHoldBack=Cp.optionalFloat("PART-HOLD-BACK",0),_i.holdBack=Cp.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{const Cp=new AttrList(yp);_i.partTarget=Cp.decimalFloatingPoint("PART-TARGET");break}case"PART":{let Cp=_i.partList;Cp||(Cp=_i.partList=[]);const Mp=xa>0?Cp[Cp.length-1]:void 0,wp=xa++,Np=new AttrList(yp);substituteVariablesInAttributes(_i,Np,["BYTERANGE","URI"]);const Fp=new Part(Np,Il,g,wp,Mp);Cp.push(Fp),Il.duration+=Fp.duration;break}case"PRELOAD-HINT":{const Cp=new AttrList(yp);substituteVariablesInAttributes(_i,Cp,["URI"]),_i.preloadHint=Cp;break}case"RENDITION-REPORT":{const Cp=new AttrList(yp);substituteVariablesInAttributes(_i,Cp,["URI"]),_i.renditionReports=_i.renditionReports||[],_i.renditionReports.push(Cp);break}default:logger.warn(`line parsed but not handled: ${Cl}`);break}}}Sl&&!Sl.relurl?(_s.pop(),El-=Sl.duration,_i.partList&&(_i.fragmentHint=Sl)):_i.partList&&(assignProgramDateTime(Il,Sl),Il.cc=Tl,_i.fragmentHint=Il,Dl&&setFragLevelKeys(Il,Dl,_i));const Jl=_s.length,Ep=_s[0],_p=_s[Jl-1];if(El+=_i.skippedSegments*_i.targetduration,El>0&&Jl&&_p){_i.averagetargetduration=El/Jl;const Ip=_p.sn;_i.endSN=Ip!=="initSegment"?Ip:0,_i.live||(_p.endList=!0),Ep&&(_i.startCC=Ep.cc)}else _i.endSN=0,_i.startCC=0;return _i.fragmentHint&&(El+=_i.fragmentHint.duration),_i.totalduration=El,_i.endCC=Tl,Ul>0&&backfillProgramDateTimes(_s,Ul),_i}}function parseKey(h,i,g){var _,j;const $=new AttrList(h);substituteVariablesInAttributes(g,$,["KEYFORMAT","KEYFORMATVERSIONS","URI","IV","URI"]);const _n=(_=$.METHOD)!=null?_:"",_i=$.URI,_s=$.hexadecimalInteger("IV"),ga=$.KEYFORMATVERSIONS,ba=(j=$.KEYFORMAT)!=null?j:"identity";_i&&$.IV&&!_s&&logger.error(`Invalid IV: ${$.IV}`);const xa=_i?M3U8Parser.resolve(_i,i):"",El=(ga||"1").split("/").map(Number).filter(Number.isFinite);return new LevelKey(_n,xa,ba,El,_s)}function parseStartTimeOffset(h){const g=new AttrList(h).decimalFloatingPoint("TIME-OFFSET");return isFiniteNumber(g)?g:null}function setCodecs(h,i){["video","audio","text"].forEach(g=>{const _=h.filter(j=>isCodecType(j,g));if(_.length){const j=_.filter($=>$.lastIndexOf("avc1",0)===0||$.lastIndexOf("mp4a",0)===0);i[`${g}Codec`]=j.length>0?j[0]:_[0],h=h.filter($=>_.indexOf($)===-1)}}),i.unknownCodecs=h}function assignCodec(h,i,g){const _=i[g];_&&(h[g]=_)}function backfillProgramDateTimes(h,i){let g=h[i];for(let _=i;_--;){const j=h[_];if(!j)return;j.programDateTime=g.programDateTime-j.duration*1e3,g=j}}function assignProgramDateTime(h,i){h.rawProgramDateTime?h.programDateTime=Date.parse(h.rawProgramDateTime):i!=null&&i.programDateTime&&(h.programDateTime=i.endProgramDateTime),isFiniteNumber(h.programDateTime)||(h.programDateTime=null,h.rawProgramDateTime=null)}function setInitSegment(h,i,g,_){h.relurl=i.URI,i.BYTERANGE&&h.setByteRange(i.BYTERANGE),h.level=g,h.sn="initSegment",_&&(h.levelkeys=_),h.initSegment=null}function setFragLevelKeys(h,i,g){h.levelkeys=i;const{encryptedFragments:_}=g;(!_.length||_[_.length-1].levelkeys!==i)&&Object.keys(i).some(j=>i[j].isCommonEncryption)&&_.push(h)}var PlaylistContextType={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},PlaylistLevelType={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};function mapContextToLevelType(h){const{type:i}=h;switch(i){case PlaylistContextType.AUDIO_TRACK:return PlaylistLevelType.AUDIO;case PlaylistContextType.SUBTITLE_TRACK:return PlaylistLevelType.SUBTITLE;default:return PlaylistLevelType.MAIN}}function getResponseUrl(h,i){let g=h.url;return(g===void 0||g.indexOf("data:")===0)&&(g=i.url),g}class PlaylistLoader{constructor(i){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.hls=i,this.registerListeners()}startLoad(i){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:i}=this;i.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),i.on(Events.LEVEL_LOADING,this.onLevelLoading,this),i.on(Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),i.on(Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}unregisterListeners(){const{hls:i}=this;i.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),i.off(Events.LEVEL_LOADING,this.onLevelLoading,this),i.off(Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),i.off(Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)}createInternalLoader(i){const g=this.hls.config,_=g.pLoader,j=g.loader,$=_||j,_n=new $(g);return this.loaders[i.type]=_n,_n}getInternalLoader(i){return this.loaders[i.type]}resetInternalLoader(i){this.loaders[i]&&delete this.loaders[i]}destroyInternalLoaders(){for(const i in this.loaders){const g=this.loaders[i];g&&g.destroy(),this.resetInternalLoader(i)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(i,g){const{url:_}=g;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:PlaylistContextType.MANIFEST,url:_,deliveryDirectives:null})}onLevelLoading(i,g){const{id:_,level:j,url:$,deliveryDirectives:_n}=g;this.load({id:_,level:j,responseType:"text",type:PlaylistContextType.LEVEL,url:$,deliveryDirectives:_n})}onAudioTrackLoading(i,g){const{id:_,groupId:j,url:$,deliveryDirectives:_n}=g;this.load({id:_,groupId:j,level:null,responseType:"text",type:PlaylistContextType.AUDIO_TRACK,url:$,deliveryDirectives:_n})}onSubtitleTrackLoading(i,g){const{id:_,groupId:j,url:$,deliveryDirectives:_n}=g;this.load({id:_,groupId:j,level:null,responseType:"text",type:PlaylistContextType.SUBTITLE_TRACK,url:$,deliveryDirectives:_n})}load(i){var g;const _=this.hls.config;let j=this.getInternalLoader(i);if(j){const ga=j.context;if(ga&&ga.url===i.url){logger.trace("[playlist-loader]: playlist request ongoing");return}logger.log(`[playlist-loader]: aborting previous loader for type: ${i.type}`),j.abort()}let $;if(i.type===PlaylistContextType.MANIFEST?$=_.manifestLoadPolicy.default:$=_extends$5({},_.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),j=this.createInternalLoader(i),(g=i.deliveryDirectives)!=null&&g.part){let ga;if(i.type===PlaylistContextType.LEVEL&&i.level!==null?ga=this.hls.levels[i.level].details:i.type===PlaylistContextType.AUDIO_TRACK&&i.id!==null?ga=this.hls.audioTracks[i.id].details:i.type===PlaylistContextType.SUBTITLE_TRACK&&i.id!==null&&(ga=this.hls.subtitleTracks[i.id].details),ga){const ba=ga.partTarget,xa=ga.targetduration;if(ba&&xa){const El=Math.max(ba*3,xa*.8)*1e3;$=_extends$5({},$,{maxTimeToFirstByteMs:Math.min(El,$.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(El,$.maxTimeToFirstByteMs)})}}}const _n=$.errorRetry||$.timeoutRetry||{},_i={loadPolicy:$,timeout:$.maxLoadTimeMs,maxRetry:_n.maxNumRetry||0,retryDelay:_n.retryDelayMs||0,maxRetryDelay:_n.maxRetryDelayMs||0},_s={onSuccess:(ga,ba,xa,El)=>{const Tl=this.getInternalLoader(xa);this.resetInternalLoader(xa.type);const Sl=ga.data;if(Sl.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(ga,xa,new Error("no EXTM3U delimiter"),El||null,ba);return}ba.parsing.start=performance.now(),M3U8Parser.isMediaPlaylist(Sl)?this.handleTrackOrLevelPlaylist(ga,ba,xa,El||null,Tl):this.handleMasterPlaylist(ga,ba,xa,El)},onError:(ga,ba,xa,El)=>{this.handleNetworkError(ba,xa,!1,ga,El)},onTimeout:(ga,ba,xa)=>{this.handleNetworkError(ba,xa,!0,void 0,ga)}};j.load(i,_i,_s)}handleMasterPlaylist(i,g,_,j){const $=this.hls,_n=i.data,_i=getResponseUrl(i,_),_s=M3U8Parser.parseMasterPlaylist(_n,_i);if(_s.playlistParsingError){this.handleManifestParsingError(i,_,_s.playlistParsingError,j,g);return}const{contentSteering:ga,levels:ba,sessionData:xa,sessionKeys:El,startTimeOffset:Tl,variableList:Sl}=_s;this.variableList=Sl;const{AUDIO:Il=[],SUBTITLES:Cl,"CLOSED-CAPTIONS":Nl}=M3U8Parser.parseMasterPlaylistMedia(_n,_i,_s);Il.length&&!Il.some(Ul=>!Ul.url)&&ba[0].audioCodec&&!ba[0].attrs.AUDIO&&(logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),Il.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new AttrList({}),bitrate:0,url:""})),$.trigger(Events.MANIFEST_LOADED,{levels:ba,audioTracks:Il,subtitles:Cl,captions:Nl,contentSteering:ga,url:_i,stats:g,networkDetails:j,sessionData:xa,sessionKeys:El,startTimeOffset:Tl,variableList:Sl})}handleTrackOrLevelPlaylist(i,g,_,j,$){const _n=this.hls,{id:_i,level:_s,type:ga}=_,ba=getResponseUrl(i,_),xa=isFiniteNumber(_i)?_i:0,El=isFiniteNumber(_s)?_s:xa,Tl=mapContextToLevelType(_),Sl=M3U8Parser.parseLevelPlaylist(i.data,ba,El,Tl,xa,this.variableList);if(ga===PlaylistContextType.MANIFEST){const Il={attrs:new AttrList({}),bitrate:0,details:Sl,name:"",url:ba};_n.trigger(Events.MANIFEST_LOADED,{levels:[Il],audioTracks:[],url:ba,stats:g,networkDetails:j,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}g.parsing.end=performance.now(),_.levelDetails=Sl,this.handlePlaylistLoaded(Sl,i,g,_,j,$)}handleManifestParsingError(i,g,_,j,$){this.hls.trigger(Events.ERROR,{type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.MANIFEST_PARSING_ERROR,fatal:g.type===PlaylistContextType.MANIFEST,url:i.url,err:_,error:_,reason:_.message,response:i,context:g,networkDetails:j,stats:$})}handleNetworkError(i,g,_=!1,j,$){let _n=`A network ${_?"timeout":"error"+(j?" (status "+j.code+")":"")} occurred while loading ${i.type}`;i.type===PlaylistContextType.LEVEL?_n+=`: ${i.level} id: ${i.id}`:(i.type===PlaylistContextType.AUDIO_TRACK||i.type===PlaylistContextType.SUBTITLE_TRACK)&&(_n+=` id: ${i.id} group-id: "${i.groupId}"`);const _i=new Error(_n);logger.warn(`[playlist-loader]: ${_n}`);let _s=ErrorDetails.UNKNOWN,ga=!1;const ba=this.getInternalLoader(i);switch(i.type){case PlaylistContextType.MANIFEST:_s=_?ErrorDetails.MANIFEST_LOAD_TIMEOUT:ErrorDetails.MANIFEST_LOAD_ERROR,ga=!0;break;case PlaylistContextType.LEVEL:_s=_?ErrorDetails.LEVEL_LOAD_TIMEOUT:ErrorDetails.LEVEL_LOAD_ERROR,ga=!1;break;case PlaylistContextType.AUDIO_TRACK:_s=_?ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:ErrorDetails.AUDIO_TRACK_LOAD_ERROR,ga=!1;break;case PlaylistContextType.SUBTITLE_TRACK:_s=_?ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:ErrorDetails.SUBTITLE_LOAD_ERROR,ga=!1;break}ba&&this.resetInternalLoader(i.type);const xa={type:ErrorTypes.NETWORK_ERROR,details:_s,fatal:ga,url:i.url,loader:ba,context:i,error:_i,networkDetails:g,stats:$};if(j){const El=(g==null?void 0:g.url)||i.url;xa.response=_objectSpread2({url:El,data:void 0},j)}this.hls.trigger(Events.ERROR,xa)}handlePlaylistLoaded(i,g,_,j,$,_n){const _i=this.hls,{type:_s,level:ga,id:ba,groupId:xa,deliveryDirectives:El}=j,Tl=getResponseUrl(g,j),Sl=mapContextToLevelType(j),Il=typeof j.level=="number"&&Sl===PlaylistLevelType.MAIN?ga:void 0;if(!i.fragments.length){const Nl=new Error("No Segments found in Playlist");_i.trigger(Events.ERROR,{type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:Tl,error:Nl,reason:Nl.message,response:g,context:j,level:Il,parent:Sl,networkDetails:$,stats:_});return}i.targetduration||(i.playlistParsingError=new Error("Missing Target Duration"));const Cl=i.playlistParsingError;if(Cl){_i.trigger(Events.ERROR,{type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.LEVEL_PARSING_ERROR,fatal:!1,url:Tl,error:Cl,reason:Cl.message,response:g,context:j,level:Il,parent:Sl,networkDetails:$,stats:_});return}switch(i.live&&_n&&(_n.getCacheAge&&(i.ageHeader=_n.getCacheAge()||0),(!_n.getCacheAge||isNaN(i.ageHeader))&&(i.ageHeader=0)),_s){case PlaylistContextType.MANIFEST:case PlaylistContextType.LEVEL:_i.trigger(Events.LEVEL_LOADED,{details:i,level:Il||0,id:ba||0,stats:_,networkDetails:$,deliveryDirectives:El});break;case PlaylistContextType.AUDIO_TRACK:_i.trigger(Events.AUDIO_TRACK_LOADED,{details:i,id:ba||0,groupId:xa||"",stats:_,networkDetails:$,deliveryDirectives:El});break;case PlaylistContextType.SUBTITLE_TRACK:_i.trigger(Events.SUBTITLE_TRACK_LOADED,{details:i,id:ba||0,groupId:xa||"",stats:_,networkDetails:$,deliveryDirectives:El});break}}}function sendAddTrackEvent(h,i){let g;try{g=new Event("addtrack")}catch{g=document.createEvent("Event"),g.initEvent("addtrack",!1,!1)}g.track=h,i.dispatchEvent(g)}function addCueToTrack(h,i){const g=h.mode;if(g==="disabled"&&(h.mode="hidden"),h.cues&&!h.cues.getCueById(i.id))try{if(h.addCue(i),!h.cues.getCueById(i.id))throw new Error(`addCue is failed for: ${i}`)}catch(_){logger.debug(`[texttrack-utils]: ${_}`);const j=new self.TextTrackCue(i.startTime,i.endTime,i.text);j.id=i.id,h.addCue(j)}g==="disabled"&&(h.mode=g)}function clearCurrentCues(h){const i=h.mode;if(i==="disabled"&&(h.mode="hidden"),h.cues)for(let g=h.cues.length;g--;)h.removeCue(h.cues[g]);i==="disabled"&&(h.mode=i)}function removeCuesInRange(h,i,g,_){const j=h.mode;if(j==="disabled"&&(h.mode="hidden"),h.cues&&h.cues.length>0){const $=getCuesInRange(h.cues,i,g);for(let _n=0;_n<$.length;_n++)(!_||_($[_n]))&&h.removeCue($[_n])}j==="disabled"&&(h.mode=j)}function getFirstCueIndexAfterTime(h,i){if(i<h[0].startTime)return 0;const g=h.length-1;if(i>h[g].endTime)return-1;let _=0,j=g;for(;_<=j;){const $=Math.floor((j+_)/2);if(i<h[$].startTime)j=$-1;else if(i>h[$].startTime&&_<g)_=$+1;else return $}return h[_].startTime-i<i-h[j].startTime?_:j}function getCuesInRange(h,i,g){const _=[],j=getFirstCueIndexAfterTime(h,i);if(j>-1)for(let $=j,_n=h.length;$<_n;$++){const _i=h[$];if(_i.startTime>=i&&_i.endTime<=g)_.push(_i);else if(_i.startTime>g)return _}return _}var MetadataSchema={audioId3:"org.id3",dateRange:"com.apple.quicktime.HLS",emsg:"https://aomedia.org/emsg/ID3"};const MIN_CUE_DURATION=.25;function getCueClass(){if(!(typeof self>"u"))return self.WebKitDataCue||self.VTTCue||self.TextTrackCue}const MAX_CUE_ENDTIME=(()=>{const h=getCueClass();try{new h(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();function dateRangeDateToTimelineSeconds(h,i){return h.getTime()/1e3-i}function hexToArrayBuffer(h){return Uint8Array.from(h.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}class ID3TrackController{constructor(i){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=i,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null}_registerListeners(){const{hls:i}=this;i.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),i.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),i.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),i.on(Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),i.on(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),i.on(Events.LEVEL_UPDATED,this.onLevelUpdated,this)}_unregisterListeners(){const{hls:i}=this;i.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),i.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),i.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),i.off(Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),i.off(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),i.off(Events.LEVEL_UPDATED,this.onLevelUpdated,this)}onMediaAttached(i,g){this.media=g.media}onMediaDetaching(){this.id3Track&&(clearCurrentCues(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(i){const g=this.getID3Track(i.textTracks);return g.mode="hidden",g}getID3Track(i){if(this.media){for(let g=0;g<i.length;g++){const _=i[g];if(_.kind==="metadata"&&_.label==="id3")return sendAddTrackEvent(_,this.media),_}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(i,g){if(!this.media)return;const{hls:{config:{enableEmsgMetadataCues:_,enableID3MetadataCues:j}}}=this;if(!_&&!j)return;const{samples:$}=g;this.id3Track||(this.id3Track=this.createTrack(this.media));const _n=getCueClass();for(let _i=0;_i<$.length;_i++){const _s=$[_i].type;if(_s===MetadataSchema.emsg&&!_||!j)continue;const ga=getID3Frames($[_i].data);if(ga){const ba=$[_i].pts;let xa=ba+$[_i].duration;xa>MAX_CUE_ENDTIME&&(xa=MAX_CUE_ENDTIME),xa-ba<=0&&(xa=ba+MIN_CUE_DURATION);for(let Tl=0;Tl<ga.length;Tl++){const Sl=ga[Tl];if(!isTimeStampFrame(Sl)){this.updateId3CueEnds(ba,_s);const Il=new _n(ba,xa,"");Il.value=Sl,_s&&(Il.type=_s),this.id3Track.addCue(Il)}}}}}updateId3CueEnds(i,g){var _;const j=(_=this.id3Track)==null?void 0:_.cues;if(j)for(let $=j.length;$--;){const _n=j[$];_n.type===g&&_n.startTime<i&&_n.endTime===MAX_CUE_ENDTIME&&(_n.endTime=i)}}onBufferFlushing(i,{startOffset:g,endOffset:_,type:j}){const{id3Track:$,hls:_n}=this;if(!_n)return;const{config:{enableEmsgMetadataCues:_i,enableID3MetadataCues:_s}}=_n;if($&&(_i||_s)){let ga;j==="audio"?ga=ba=>ba.type===MetadataSchema.audioId3&&_s:j==="video"?ga=ba=>ba.type===MetadataSchema.emsg&&_i:ga=ba=>ba.type===MetadataSchema.audioId3&&_s||ba.type===MetadataSchema.emsg&&_i,removeCuesInRange($,g,_,ga)}}onLevelUpdated(i,{details:g}){if(!this.media||!g.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)return;const{dateRangeCuesAppended:_,id3Track:j}=this,{dateRanges:$}=g,_n=Object.keys($);if(j){const ba=Object.keys(_).filter(xa=>!_n.includes(xa));for(let xa=ba.length;xa--;){const El=ba[xa];Object.keys(_[El].cues).forEach(Tl=>{j.removeCue(_[El].cues[Tl])}),delete _[El]}}const _i=g.fragments[g.fragments.length-1];if(_n.length===0||!isFiniteNumber(_i==null?void 0:_i.programDateTime))return;this.id3Track||(this.id3Track=this.createTrack(this.media));const _s=_i.programDateTime/1e3-_i.start,ga=getCueClass();for(let ba=0;ba<_n.length;ba++){const xa=_n[ba],El=$[xa],Tl=_[xa],Sl=(Tl==null?void 0:Tl.cues)||{};let Il=(Tl==null?void 0:Tl.durationKnown)||!1;const Cl=dateRangeDateToTimelineSeconds(El.startDate,_s);let Nl=MAX_CUE_ENDTIME;const Dl=El.endDate;if(Dl)Nl=dateRangeDateToTimelineSeconds(Dl,_s),Il=!0;else if(El.endOnNext&&!Il){const Kl=_n.reduce((Jl,Ep)=>{const _p=$[Ep];return _p.class===El.class&&_p.id!==Ep&&_p.startDate>El.startDate&&Jl.push(_p),Jl},[]).sort((Jl,Ep)=>Jl.startDate.getTime()-Ep.startDate.getTime())[0];Kl&&(Nl=dateRangeDateToTimelineSeconds(Kl.startDate,_s),Il=!0)}const Ul=Object.keys(El.attr);for(let Kl=0;Kl<Ul.length;Kl++){const Jl=Ul[Kl];if(!isDateRangeCueAttribute(Jl))continue;let Ep=Sl[Jl];if(Ep)Il&&!Tl.durationKnown&&(Ep.endTime=Nl);else{let _p=El.attr[Jl];Ep=new ga(Cl,Nl,""),isSCTE35Attribute(Jl)&&(_p=hexToArrayBuffer(_p)),Ep.value={key:Jl,data:_p},Ep.type=MetadataSchema.dateRange,Ep.id=xa,this.id3Track.addCue(Ep),Sl[Jl]=Ep}}_[xa]={cues:Sl,dateRange:El,durationKnown:Il}}}}class LatencyController{constructor(i){this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=()=>this.timeupdate(),this.hls=i,this.config=i.config,this.registerListeners()}get latency(){return this._latency||0}get maxLatency(){const{config:i,levelDetails:g}=this;return i.liveMaxLatencyDuration!==void 0?i.liveMaxLatencyDuration:g?i.liveMaxLatencyDurationCount*g.targetduration:0}get targetLatency(){const{levelDetails:i}=this;if(i===null)return null;const{holdBack:g,partHoldBack:_,targetduration:j}=i,{liveSyncDuration:$,liveSyncDurationCount:_n,lowLatencyMode:_i}=this.config,_s=this.hls.userConfig;let ga=_i&&_||g;(_s.liveSyncDuration||_s.liveSyncDurationCount||ga===0)&&(ga=$!==void 0?$:_n*j);const ba=j,xa=1;return ga+Math.min(this.stallCount*xa,ba)}get liveSyncPosition(){const i=this.estimateLiveEdge(),g=this.targetLatency,_=this.levelDetails;if(i===null||g===null||_===null)return null;const j=_.edge,$=i-g-this.edgeStalled,_n=j-_.totalduration,_i=j-(this.config.lowLatencyMode&&_.partTarget||_.targetduration);return Math.min(Math.max(_n,$),_i)}get drift(){const{levelDetails:i}=this;return i===null?1:i.drift}get edgeStalled(){const{levelDetails:i}=this;if(i===null)return 0;const g=(this.config.lowLatencyMode&&i.partTarget||i.targetduration)*3;return Math.max(i.age-g,0)}get forwardBufferLength(){const{media:i,levelDetails:g}=this;if(!i||!g)return 0;const _=i.buffered.length;return(_?i.buffered.end(_-1):g.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null}registerListeners(){this.hls.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(Events.ERROR,this.onError,this)}unregisterListeners(){this.hls.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.off(Events.ERROR,this.onError,this)}onMediaAttached(i,g){this.media=g.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)}onManifestLoading(){this.levelDetails=null,this._latency=null,this.stallCount=0}onLevelUpdated(i,{details:g}){this.levelDetails=g,g.advanced&&this.timeupdate(),!g.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)}onError(i,g){var _;g.details===ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,(_=this.levelDetails)!=null&&_.live&&logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))}timeupdate(){const{media:i,levelDetails:g}=this;if(!i||!g)return;this.currentTime=i.currentTime;const _=this.computeLatency();if(_===null)return;this._latency=_;const{lowLatencyMode:j,maxLiveSyncPlaybackRate:$}=this.config;if(!j||$===1)return;const _n=this.targetLatency;if(_n===null)return;const _i=_-_n,_s=Math.min(this.maxLatency,_n+g.targetduration),ga=_i<_s;if(g.live&&ga&&_i>.05&&this.forwardBufferLength>1){const ba=Math.min(2,Math.max(1,$)),xa=Math.round(2/(1+Math.exp(-.75*_i-this.edgeStalled))*20)/20;i.playbackRate=Math.min(ba,Math.max(1,xa))}else i.playbackRate!==1&&i.playbackRate!==0&&(i.playbackRate=1)}estimateLiveEdge(){const{levelDetails:i}=this;return i===null?null:i.edge+i.age}computeLatency(){const i=this.estimateLiveEdge();return i===null?null:i-this.currentTime}}const HdcpLevels=["NONE","TYPE-0","TYPE-1",null];var HlsSkip={No:"",Yes:"YES",v2:"v2"};function getSkipValue(h,i){const{canSkipUntil:g,canSkipDateRanges:_,endSN:j}=h,$=i!==void 0?i-j:0;return g&&$<g?_?HlsSkip.v2:HlsSkip.Yes:HlsSkip.No}class HlsUrlParameters{constructor(i,g,_){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=i,this.part=g,this.skip=_}addDirectives(i){const g=new self.URL(i);return this.msn!==void 0&&g.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&g.searchParams.set("_HLS_part",this.part.toString()),this.skip&&g.searchParams.set("_HLS_skip",this.skip),g.href}}class Level{constructor(i){this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[i.url],this._attrs=[i.attrs],this.bitrate=i.bitrate,i.details&&(this.details=i.details),this.id=i.id||0,this.name=i.name,this.width=i.width||0,this.height=i.height||0,this.audioCodec=i.audioCodec,this.videoCodec=i.videoCodec,this.unknownCodecs=i.unknownCodecs,this.codecSet=[i.videoCodec,i.audioCodec].filter(g=>g).join(",").replace(/\.[^.,]+/g,"")}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get attrs(){return this._attrs[this._urlId]}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get uri(){return this.url[this._urlId]||""}get urlId(){return this._urlId}set urlId(i){const g=i%this.url.length;this._urlId!==g&&(this.fragmentError=0,this.loadError=0,this.details=void 0,this._urlId=g)}get audioGroupId(){var i;return(i=this.audioGroupIds)==null?void 0:i[this.urlId]}get textGroupId(){var i;return(i=this.textGroupIds)==null?void 0:i[this.urlId]}addFallback(i){this.url.push(i.url),this._attrs.push(i.attrs)}}function updateFromToPTS(h,i){const g=i.startPTS;if(isFiniteNumber(g)){let _=0,j;i.sn>h.sn?(_=g-h.start,j=h):(_=h.start-g,j=i),j.duration!==_&&(j.duration=_)}else i.sn>h.sn?h.cc===i.cc&&h.minEndPTS?i.start=h.start+(h.minEndPTS-h.start):i.start=h.start+h.duration:i.start=Math.max(h.start-i.duration,0)}function updateFragPTSDTS(h,i,g,_,j,$){_-g<=0&&(logger.warn("Fragment should have a positive duration",i),_=g+i.duration,$=j+i.duration);let _i=g,_s=_;const ga=i.startPTS,ba=i.endPTS;if(isFiniteNumber(ga)){const Cl=Math.abs(ga-g);isFiniteNumber(i.deltaPTS)?i.deltaPTS=Math.max(Cl,i.deltaPTS):i.deltaPTS=Cl,_i=Math.max(g,ga),g=Math.min(g,ga),j=Math.min(j,i.startDTS),_s=Math.min(_,ba),_=Math.max(_,ba),$=Math.max($,i.endDTS)}const xa=g-i.start;i.start!==0&&(i.start=g),i.duration=_-i.start,i.startPTS=g,i.maxStartPTS=_i,i.startDTS=j,i.endPTS=_,i.minEndPTS=_s,i.endDTS=$;const El=i.sn;if(!h||El<h.startSN||El>h.endSN)return 0;let Tl;const Sl=El-h.startSN,Il=h.fragments;for(Il[Sl]=i,Tl=Sl;Tl>0;Tl--)updateFromToPTS(Il[Tl],Il[Tl-1]);for(Tl=Sl;Tl<Il.length-1;Tl++)updateFromToPTS(Il[Tl],Il[Tl+1]);return h.fragmentHint&&updateFromToPTS(Il[Il.length-1],h.fragmentHint),h.PTSKnown=h.alignedSliding=!0,xa}function mergeDetails(h,i){let g=null;const _=h.fragments;for(let _s=_.length-1;_s>=0;_s--){const ga=_[_s].initSegment;if(ga){g=ga;break}}h.fragmentHint&&delete h.fragmentHint.endPTS;let j=0,$;if(mapFragmentIntersection(h,i,(_s,ga)=>{_s.relurl&&(j=_s.cc-ga.cc),isFiniteNumber(_s.startPTS)&&isFiniteNumber(_s.endPTS)&&(ga.start=ga.startPTS=_s.startPTS,ga.startDTS=_s.startDTS,ga.maxStartPTS=_s.maxStartPTS,ga.endPTS=_s.endPTS,ga.endDTS=_s.endDTS,ga.minEndPTS=_s.minEndPTS,ga.duration=_s.endPTS-_s.startPTS,ga.duration&&($=ga),i.PTSKnown=i.alignedSliding=!0),ga.elementaryStreams=_s.elementaryStreams,ga.loader=_s.loader,ga.stats=_s.stats,ga.urlId=_s.urlId,_s.initSegment&&(ga.initSegment=_s.initSegment,g=_s.initSegment)}),g&&(i.fragmentHint?i.fragments.concat(i.fragmentHint):i.fragments).forEach(ga=>{var ba;(!ga.initSegment||ga.initSegment.relurl===((ba=g)==null?void 0:ba.relurl))&&(ga.initSegment=g)}),i.skippedSegments)if(i.deltaUpdateFailed=i.fragments.some(_s=>!_s),i.deltaUpdateFailed){logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let _s=i.skippedSegments;_s--;)i.fragments.shift();i.startSN=i.fragments[0].sn,i.startCC=i.fragments[0].cc}else i.canSkipDateRanges&&(i.dateRanges=mergeDateRanges(h.dateRanges,i.dateRanges,i.recentlyRemovedDateranges));const _n=i.fragments;if(j){logger.warn("discontinuity sliding from playlist, take drift into account");for(let _s=0;_s<_n.length;_s++)_n[_s].cc+=j}i.skippedSegments&&(i.startCC=i.fragments[0].cc),mapPartIntersection(h.partList,i.partList,(_s,ga)=>{ga.elementaryStreams=_s.elementaryStreams,ga.stats=_s.stats}),$?updateFragPTSDTS(i,$,$.startPTS,$.endPTS,$.startDTS,$.endDTS):adjustSliding(h,i),_n.length&&(i.totalduration=i.edge-_n[0].start),i.driftStartTime=h.driftStartTime,i.driftStart=h.driftStart;const _i=i.advancedDateTime;if(i.advanced&&_i){const _s=i.edge;i.driftStart||(i.driftStartTime=_i,i.driftStart=_s),i.driftEndTime=_i,i.driftEnd=_s}else i.driftEndTime=h.driftEndTime,i.driftEnd=h.driftEnd,i.advancedDateTime=h.advancedDateTime}function mergeDateRanges(h,i,g){const _=_extends$5({},h);return g&&g.forEach(j=>{delete _[j]}),Object.keys(i).forEach(j=>{const $=new DateRange(i[j].attr,_[j]);$.isValid?_[j]=$:logger.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${JSON.stringify(i[j].attr)}"`)}),_}function mapPartIntersection(h,i,g){if(h&&i){let _=0;for(let j=0,$=h.length;j<=$;j++){const _n=h[j],_i=i[j+_];_n&&_i&&_n.index===_i.index&&_n.fragment.sn===_i.fragment.sn?g(_n,_i):_--}}}function mapFragmentIntersection(h,i,g){const _=i.skippedSegments,j=Math.max(h.startSN,i.startSN)-i.startSN,$=(h.fragmentHint?1:0)+(_?i.endSN:Math.min(h.endSN,i.endSN))-i.startSN,_n=i.startSN-h.startSN,_i=i.fragmentHint?i.fragments.concat(i.fragmentHint):i.fragments,_s=h.fragmentHint?h.fragments.concat(h.fragmentHint):h.fragments;for(let ga=j;ga<=$;ga++){const ba=_s[_n+ga];let xa=_i[ga];_&&!xa&&ga<_&&(xa=i.fragments[ga]=ba),ba&&xa&&g(ba,xa)}}function adjustSliding(h,i){const g=i.startSN+i.skippedSegments-h.startSN,_=h.fragments;g<0||g>=_.length||addSliding(i,_[g].start)}function addSliding(h,i){if(i){const g=h.fragments;for(let _=h.skippedSegments;_<g.length;_++)g[_].start+=i;h.fragmentHint&&(h.fragmentHint.start+=i)}}function computeReloadInterval(h,i=1/0){let g=1e3*h.targetduration;if(h.updated){const _=h.fragments,j=4;if(_.length&&g*j>i){const $=_[_.length-1].duration*1e3;$<g&&(g=$)}}else g/=2;return Math.round(g)}function getFragmentWithSN(h,i,g){if(!(h!=null&&h.details))return null;const _=h.details;let j=_.fragments[i-_.startSN];return j||(j=_.fragmentHint,j&&j.sn===i)?j:i<_.startSN&&g&&g.sn===i?g:null}function getPartWith(h,i,g){var _;return h!=null&&h.details?findPart((_=h.details)==null?void 0:_.partList,i,g):null}function findPart(h,i,g){if(h)for(let _=h.length;_--;){const j=h[_];if(j.index===g&&j.fragment.sn===i)return j}return null}function isTimeoutError(h){switch(h.details){case ErrorDetails.FRAG_LOAD_TIMEOUT:case ErrorDetails.KEY_LOAD_TIMEOUT:case ErrorDetails.LEVEL_LOAD_TIMEOUT:case ErrorDetails.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function getRetryConfig(h,i){const g=isTimeoutError(i);return h.default[`${g?"timeout":"error"}Retry`]}function getRetryDelay(h,i){const g=h.backoff==="linear"?1:Math.pow(2,i);return Math.min(g*h.retryDelayMs,h.maxRetryDelayMs)}function getLoaderConfigWithoutReties(h){return _objectSpread2(_objectSpread2({},h),{errorRetry:null,timeoutRetry:null})}function shouldRetry(h,i,g,_){return!!h&&i<h.maxNumRetry&&(retryForHttpStatus(_)||!!g)}function retryForHttpStatus(h){return h===0&&navigator.onLine===!1||!!h&&(h<400||h>499)}const BinarySearch={search:function(h,i){let g=0,_=h.length-1,j=null,$=null;for(;g<=_;){j=(g+_)/2|0,$=h[j];const _n=i($);if(_n>0)g=j+1;else if(_n<0)_=j-1;else return $}return null}};function findFragmentByPDT(h,i,g){if(i===null||!Array.isArray(h)||!h.length||!isFiniteNumber(i))return null;const _=h[0].programDateTime;if(i<(_||0))return null;const j=h[h.length-1].endProgramDateTime;if(i>=(j||0))return null;g=g||0;for(let $=0;$<h.length;++$){const _n=h[$];if(pdtWithinToleranceTest(i,g,_n))return _n}return null}function findFragmentByPTS(h,i,g=0,_=0){let j=null;if(h?j=i[h.sn-i[0].sn+1]||null:g===0&&i[0].start===0&&(j=i[0]),j&&fragmentWithinToleranceTest(g,_,j)===0)return j;const $=BinarySearch.search(i,fragmentWithinToleranceTest.bind(null,g,_));return $&&($!==h||!j)?$:j}function fragmentWithinToleranceTest(h=0,i=0,g){if(g.start<=h&&g.start+g.duration>h)return 0;const _=Math.min(i,g.duration+(g.deltaPTS?g.deltaPTS:0));return g.start+g.duration-_<=h?1:g.start-_>h&&g.start?-1:0}function pdtWithinToleranceTest(h,i,g){const _=Math.min(i,g.duration+(g.deltaPTS?g.deltaPTS:0))*1e3;return(g.endProgramDateTime||0)-_>h}function findFragWithCC(h,i){return BinarySearch.search(h,g=>g.cc<i?1:g.cc>i?-1:0)}const RENDITION_PENALTY_DURATION_MS=3e5;var NetworkErrorAction={DoNothing:0,SendEndCallback:1,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,InsertDiscontinuity:4,RetryRequest:5},ErrorActionFlags={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,SwitchToSDR:4};class ErrorController{constructor(i){this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.log=void 0,this.warn=void 0,this.error=void 0,this.hls=i,this.log=logger.log.bind(logger,"[info]:"),this.warn=logger.warn.bind(logger,"[warning]:"),this.error=logger.error.bind(logger,"[error]:"),this.registerListeners()}registerListeners(){const i=this.hls;i.on(Events.ERROR,this.onError,this),i.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),i.on(Events.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const i=this.hls;i&&(i.off(Events.ERROR,this.onError,this),i.off(Events.ERROR,this.onErrorOut,this),i.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),i.off(Events.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}}startLoad(i){this.playlistError=0}stopLoad(){}getVariantLevelIndex(i){return(i==null?void 0:i.type)===PlaylistLevelType.MAIN?i.level:this.hls.loadLevel}onManifestLoading(){this.playlistError=0,this.penalizedRenditions={}}onLevelUpdated(){this.playlistError=0}onError(i,g){var _;if(g.fatal)return;const j=this.hls,$=g.context;switch(g.details){case ErrorDetails.FRAG_LOAD_ERROR:case ErrorDetails.FRAG_LOAD_TIMEOUT:case ErrorDetails.KEY_LOAD_ERROR:case ErrorDetails.KEY_LOAD_TIMEOUT:g.errorAction=this.getFragRetryOrSwitchAction(g);return;case ErrorDetails.FRAG_GAP:case ErrorDetails.FRAG_PARSING_ERROR:case ErrorDetails.FRAG_DECRYPT_ERROR:{g.errorAction=this.getFragRetryOrSwitchAction(g),g.errorAction.action=NetworkErrorAction.SendAlternateToPenaltyBox;return}case ErrorDetails.LEVEL_EMPTY_ERROR:case ErrorDetails.LEVEL_PARSING_ERROR:{var _n,_i;const _s=g.parent===PlaylistLevelType.MAIN?g.level:j.loadLevel;g.details===ErrorDetails.LEVEL_EMPTY_ERROR&&((_n=g.context)!=null&&(_i=_n.levelDetails)!=null&&_i.live)?g.errorAction=this.getPlaylistRetryOrSwitchAction(g,_s):(g.levelRetry=!1,g.errorAction=this.getLevelSwitchAction(g,_s))}return;case ErrorDetails.LEVEL_LOAD_ERROR:case ErrorDetails.LEVEL_LOAD_TIMEOUT:typeof($==null?void 0:$.level)=="number"&&(g.errorAction=this.getPlaylistRetryOrSwitchAction(g,$.level));return;case ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:case ErrorDetails.SUBTITLE_LOAD_ERROR:case ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:if($){const _s=j.levels[j.loadLevel];if(_s&&($.type===PlaylistContextType.AUDIO_TRACK&&$.groupId===_s.audioGroupId||$.type===PlaylistContextType.SUBTITLE_TRACK&&$.groupId===_s.textGroupId)){g.errorAction=this.getPlaylistRetryOrSwitchAction(g,j.loadLevel),g.errorAction.action=NetworkErrorAction.SendAlternateToPenaltyBox,g.errorAction.flags=ErrorActionFlags.MoveAllAlternatesMatchingHost;return}}return;case ErrorDetails.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:{const _s=j.levels[j.loadLevel],ga=_s==null?void 0:_s.attrs["HDCP-LEVEL"];ga&&(g.errorAction={action:NetworkErrorAction.SendAlternateToPenaltyBox,flags:ErrorActionFlags.MoveAllAlternatesMatchingHDCP,hdcpLevel:ga})}return;case ErrorDetails.BUFFER_ADD_CODEC_ERROR:case ErrorDetails.REMUX_ALLOC_ERROR:g.errorAction=this.getLevelSwitchAction(g,(_=g.level)!=null?_:j.loadLevel);return;case ErrorDetails.INTERNAL_EXCEPTION:case ErrorDetails.BUFFER_APPENDING_ERROR:case ErrorDetails.BUFFER_APPEND_ERROR:case ErrorDetails.BUFFER_FULL_ERROR:case ErrorDetails.LEVEL_SWITCH_ERROR:case ErrorDetails.BUFFER_STALLED_ERROR:case ErrorDetails.BUFFER_SEEK_OVER_HOLE:case ErrorDetails.BUFFER_NUDGE_ON_STALL:g.errorAction={action:NetworkErrorAction.DoNothing,flags:ErrorActionFlags.None};return}if(g.type===ErrorTypes.KEY_SYSTEM_ERROR){const _s=this.getVariantLevelIndex(g.frag);g.levelRetry=!1,g.errorAction=this.getLevelSwitchAction(g,_s);return}}getPlaylistRetryOrSwitchAction(i,g){var _;const j=this.hls,$=getRetryConfig(j.config.playlistLoadPolicy,i),_n=this.playlistError++,_i=(_=i.response)==null?void 0:_.code;if(shouldRetry($,_n,isTimeoutError(i),_i))return{action:NetworkErrorAction.RetryRequest,flags:ErrorActionFlags.None,retryConfig:$,retryCount:_n};const ga=this.getLevelSwitchAction(i,g);return $&&(ga.retryConfig=$,ga.retryCount=_n),ga}getFragRetryOrSwitchAction(i){const g=this.hls,_=this.getVariantLevelIndex(i.frag),j=g.levels[_],{fragLoadPolicy:$,keyLoadPolicy:_n}=g.config,_i=getRetryConfig(i.details.startsWith("key")?_n:$,i),_s=g.levels.reduce((xa,El)=>xa+El.fragmentError,0);if(j){var ga;i.details!==ErrorDetails.FRAG_GAP&&j.fragmentError++;const xa=(ga=i.response)==null?void 0:ga.code;if(shouldRetry(_i,_s,isTimeoutError(i),xa))return{action:NetworkErrorAction.RetryRequest,flags:ErrorActionFlags.None,retryConfig:_i,retryCount:_s}}const ba=this.getLevelSwitchAction(i,_);return _i&&(ba.retryConfig=_i,ba.retryCount=_s),ba}getLevelSwitchAction(i,g){const _=this.hls;g==null&&(g=_.loadLevel);const j=this.hls.levels[g];if(j&&(j.loadError++,_.autoLevelEnabled)){var $,_n;let _i=-1;const{levels:_s,loadLevel:ga,minAutoLevel:ba,maxAutoLevel:xa}=_,El=($=i.frag)==null?void 0:$.type,{type:Tl,groupId:Sl}=(_n=i.context)!=null?_n:{};for(let Il=_s.length;Il--;){const Cl=(Il+ga)%_s.length;if(Cl!==ga&&Cl>=ba&&Cl<=xa&&_s[Cl].loadError===0){const Nl=_s[Cl];if(i.details===ErrorDetails.FRAG_GAP&&i.frag){const Dl=_s[Cl].details;if(Dl){const Ul=findFragmentByPTS(i.frag,Dl.fragments,i.frag.start);if(Ul!=null&&Ul.gap)continue}}else{if(Tl===PlaylistContextType.AUDIO_TRACK&&Sl===Nl.audioGroupId||Tl===PlaylistContextType.SUBTITLE_TRACK&&Sl===Nl.textGroupId)continue;if(El===PlaylistLevelType.AUDIO&&j.audioGroupId===Nl.audioGroupId||El===PlaylistLevelType.SUBTITLE&&j.textGroupId===Nl.textGroupId)continue}_i=Cl;break}}if(_i>-1&&_.loadLevel!==_i)return i.levelRetry=!0,this.playlistError=0,{action:NetworkErrorAction.SendAlternateToPenaltyBox,flags:ErrorActionFlags.None,nextAutoLevel:_i}}return{action:NetworkErrorAction.SendAlternateToPenaltyBox,flags:ErrorActionFlags.MoveAllAlternatesMatchingHost}}onErrorOut(i,g){var _;switch((_=g.errorAction)==null?void 0:_.action){case NetworkErrorAction.DoNothing:break;case NetworkErrorAction.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(g),!g.errorAction.resolved&&g.details!==ErrorDetails.FRAG_GAP&&(g.fatal=!0);break}if(g.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(i){const g=this.hls,_=i.errorAction;if(!_)return;const{flags:j,hdcpLevel:$,nextAutoLevel:_n}=_;switch(j){case ErrorActionFlags.None:this.switchLevel(i,_n);break;case ErrorActionFlags.MoveAllAlternatesMatchingHost:_.resolved||(_.resolved=this.redundantFailover(i));break;case ErrorActionFlags.MoveAllAlternatesMatchingHDCP:$&&(g.maxHdcpLevel=HdcpLevels[HdcpLevels.indexOf($)-1],_.resolved=!0),this.warn(`Restricting playback to HDCP-LEVEL of "${g.maxHdcpLevel}" or lower`);break}_.resolved||this.switchLevel(i,_n)}switchLevel(i,g){g!==void 0&&i.errorAction&&(this.warn(`switching to level ${g} after ${i.details}`),this.hls.nextAutoLevel=g,i.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel)}redundantFailover(i){const{hls:g,penalizedRenditions:_}=this,j=i.parent===PlaylistLevelType.MAIN?i.level:g.loadLevel,$=g.levels[j],_n=$.url.length,_i=i.frag?i.frag.urlId:$.urlId;$.urlId===_i&&(!i.frag||$.details)&&this.penalizeRendition($,i);for(let _s=1;_s<_n;_s++){const ga=(_i+_s)%_n,ba=_[ga];if(!ba||checkExpired(ba,i,_[_i]))return this.warn(`Switching to Redundant Stream ${ga+1}/${_n}: "${$.url[ga]}" after ${i.details}`),this.playlistError=0,g.levels.forEach(xa=>{xa.urlId=ga}),g.nextLoadLevel=j,!0}return!1}penalizeRendition(i,g){const{penalizedRenditions:_}=this,j=_[i.urlId]||{lastErrorPerfMs:0,errors:[],details:void 0};j.lastErrorPerfMs=performance.now(),j.errors.push(g),j.details=i.details,_[i.urlId]=j}}function checkExpired(h,i,g){if(performance.now()-h.lastErrorPerfMs>RENDITION_PENALTY_DURATION_MS)return!0;const _=h.details;if(i.details===ErrorDetails.FRAG_GAP&&_&&i.frag){const j=i.frag.start,$=findFragmentByPTS(null,_.fragments,j);if($&&!$.gap)return!0}if(g&&h.errors.length<g.errors.length){const j=h.errors[h.errors.length-1];if(_&&j.frag&&i.frag&&Math.abs(j.frag.start-i.frag.start)>_.targetduration*3)return!0}return!1}class BasePlaylistController{constructor(i,g){this.hls=void 0,this.timer=-1,this.requestScheduled=-1,this.canLoad=!1,this.log=void 0,this.warn=void 0,this.log=logger.log.bind(logger,`${g}:`),this.warn=logger.warn.bind(logger,`${g}:`),this.hls=i}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){clearTimeout(this.timer),this.timer=-1}startLoad(){this.canLoad=!0,this.requestScheduled=-1,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(i,g){const _=g==null?void 0:g.renditionReports;if(_){let j=-1;for(let $=0;$<_.length;$++){const _n=_[$];let _i;try{_i=new self.URL(_n.URI,g.url).href}catch(_s){logger.warn(`Could not construct new URL for Rendition Report: ${_s}`),_i=_n.URI||""}if(_i===i){j=$;break}else _i===i.substring(0,_i.length)&&(j=$)}if(j!==-1){const $=_[j],_n=parseInt($["LAST-MSN"])||(g==null?void 0:g.lastPartSn);let _i=parseInt($["LAST-PART"])||(g==null?void 0:g.lastPartIndex);if(this.hls.config.lowLatencyMode){const _s=Math.min(g.age-g.partTarget,g.targetduration);_i>=0&&_s>g.partTarget&&(_i+=1)}return new HlsUrlParameters(_n,_i>=0?_i:void 0,HlsSkip.No)}}}loadPlaylist(i){this.requestScheduled===-1&&(this.requestScheduled=self.performance.now())}shouldLoadPlaylist(i){return this.canLoad&&!!i&&!!i.url&&(!i.details||i.details.live)}shouldReloadPlaylist(i){return this.timer===-1&&this.requestScheduled===-1&&this.shouldLoadPlaylist(i)}playlistLoaded(i,g,_){const{details:j,stats:$}=g,_n=self.performance.now(),_i=$.loading.first?Math.max(0,_n-$.loading.first):0;if(j.advancedDateTime=Date.now()-_i,j.live||_!=null&&_.live){if(j.reloaded(_),_&&this.log(`live playlist ${i} ${j.advanced?"REFRESHED "+j.lastPartSn+"-"+j.lastPartIndex:"MISSED"}`),_&&j.fragments.length>0&&mergeDetails(_,j),!this.canLoad||!j.live)return;let _s,ga,ba;if(j.canBlockReload&&j.endSN&&j.advanced){const Cl=this.hls.config.lowLatencyMode,Nl=j.lastPartSn,Dl=j.endSN,Ul=j.lastPartIndex,Kl=Ul!==-1,Jl=Nl===Dl,Ep=Cl?0:Ul;Kl?(ga=Jl?Dl+1:Nl,ba=Jl?Ep:Ul+1):ga=Dl+1;const _p=j.age,Ip=_p+j.ageHeader;let Up=Math.min(Ip-j.partTarget,j.targetduration*1.5);if(Up>0){if(_&&Up>_.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${_.tuneInGoal} to: ${Up} with playlist age: ${j.age}`),Up=0;else{const yp=Math.floor(Up/j.targetduration);if(ga+=yp,ba!==void 0){const Ap=Math.round(Up%j.targetduration/j.partTarget);ba+=Ap}this.log(`CDN Tune-in age: ${j.ageHeader}s last advanced ${_p.toFixed(2)}s goal: ${Up} skip sn ${yp} to part ${ba}`)}j.tuneInGoal=Up}if(_s=this.getDeliveryDirectives(j,g.deliveryDirectives,ga,ba),Cl||!Jl){this.loadPlaylist(_s);return}}else j.canBlockReload&&(_s=this.getDeliveryDirectives(j,g.deliveryDirectives,ga,ba));const xa=this.hls.mainForwardBufferInfo,El=xa?xa.end-xa.len:0,Tl=(j.edge-El)*1e3,Sl=computeReloadInterval(j,Tl);j.updated&&_n>this.requestScheduled+Sl&&(this.requestScheduled=$.loading.start),ga!==void 0&&j.canBlockReload?this.requestScheduled=$.loading.first+Sl-(j.partTarget*1e3||1e3):this.requestScheduled===-1||this.requestScheduled+Sl<_n?this.requestScheduled=_n:this.requestScheduled-_n<=0&&(this.requestScheduled+=Sl);let Il=this.requestScheduled-_n;Il=Math.max(0,Il),this.log(`reload live playlist ${i} in ${Math.round(Il)} ms`),this.timer=self.setTimeout(()=>this.loadPlaylist(_s),Il)}else this.clearTimer()}getDeliveryDirectives(i,g,_,j){let $=getSkipValue(i,_);return g!=null&&g.skip&&i.deltaUpdateFailed&&(_=g.msn,j=g.part,$=HlsSkip.No),new HlsUrlParameters(_,j,$)}checkRetry(i){const g=i.details,_=isTimeoutError(i),j=i.errorAction,{action:$,retryCount:_n=0,retryConfig:_i}=j||{},_s=!!j&&!!_i&&($===NetworkErrorAction.RetryRequest||!j.resolved&&$===NetworkErrorAction.SendAlternateToPenaltyBox);if(_s){var ga;if(this.requestScheduled=-1,_n>=_i.maxNumRetry)return!1;if(_&&(ga=i.context)!=null&&ga.deliveryDirectives)this.warn(`Retrying playlist loading ${_n+1}/${_i.maxNumRetry} after "${g}" without delivery-directives`),this.loadPlaylist();else{const ba=getRetryDelay(_i,_n);this.timer=self.setTimeout(()=>this.loadPlaylist(),ba),this.warn(`Retrying playlist loading ${_n+1}/${_i.maxNumRetry} after "${g}" in ${ba}ms`)}i.levelRetry=!0,j.resolved=!0}return _s}}let chromeOrFirefox;class LevelController extends BasePlaylistController{constructor(i,g){super(i,"[level-controller]"),this._levels=[],this._firstLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=g,this._registerListeners()}_registerListeners(){const{hls:i}=this;i.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),i.on(Events.MANIFEST_LOADED,this.onManifestLoaded,this),i.on(Events.LEVEL_LOADED,this.onLevelLoaded,this),i.on(Events.LEVELS_UPDATED,this.onLevelsUpdated,this),i.on(Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),i.on(Events.FRAG_LOADED,this.onFragLoaded,this),i.on(Events.ERROR,this.onError,this)}_unregisterListeners(){const{hls:i}=this;i.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),i.off(Events.MANIFEST_LOADED,this.onManifestLoaded,this),i.off(Events.LEVEL_LOADED,this.onLevelLoaded,this),i.off(Events.LEVELS_UPDATED,this.onLevelsUpdated,this),i.off(Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),i.off(Events.FRAG_LOADED,this.onFragLoaded,this),i.off(Events.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}startLoad(){this._levels.forEach(g=>{g.loadError=0,g.fragmentError=0}),super.startLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[]}onManifestLoading(i,g){this.resetLevels()}onManifestLoaded(i,g){const _=[],j={};let $;g.levels.forEach(_n=>{var _i;const _s=_n.attrs;((_i=_n.audioCodec)==null?void 0:_i.indexOf("mp4a.40.34"))!==-1&&(chromeOrFirefox||(chromeOrFirefox=/chrome|firefox/i.test(navigator.userAgent)),chromeOrFirefox&&(_n.audioCodec=void 0));const{AUDIO:ga,CODECS:ba,"FRAME-RATE":xa,"PATHWAY-ID":El,RESOLUTION:Tl,SUBTITLES:Sl}=_s,Cl=`${`${El||"."}-`}${_n.bitrate}-${Tl}-${xa}-${ba}`;$=j[Cl],$?$.addFallback(_n):($=new Level(_n),j[Cl]=$,_.push($)),addGroupId($,"audio",ga),addGroupId($,"text",Sl)}),this.filterAndSortMediaOptions(_,g)}filterAndSortMediaOptions(i,g){let _=[],j=[],$=!1,_n=!1,_i=!1,_s=i.filter(({audioCodec:Tl,videoCodec:Sl,width:Il,height:Cl,unknownCodecs:Nl})=>($||($=!!(Il&&Cl)),_n||(_n=!!Sl),_i||(_i=!!Tl),!(Nl!=null&&Nl.length)&&(!Tl||isCodecSupportedInMp4(Tl,"audio"))&&(!Sl||isCodecSupportedInMp4(Sl,"video"))));if(($||_n)&&_i&&(_s=_s.filter(({videoCodec:Tl,width:Sl,height:Il})=>!!Tl||!!(Sl&&Il))),_s.length===0){Promise.resolve().then(()=>{if(this.hls){const Tl=new Error("no level with compatible codecs found in manifest");this.hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:g.url,error:Tl,reason:Tl.message})}});return}g.audioTracks&&(_=g.audioTracks.filter(Tl=>!Tl.audioCodec||isCodecSupportedInMp4(Tl.audioCodec,"audio")),assignTrackIdsByGroup(_)),g.subtitles&&(j=g.subtitles,assignTrackIdsByGroup(j));const ga=_s.slice(0);_s.sort((Tl,Sl)=>Tl.attrs["HDCP-LEVEL"]!==Sl.attrs["HDCP-LEVEL"]?(Tl.attrs["HDCP-LEVEL"]||"")>(Sl.attrs["HDCP-LEVEL"]||"")?1:-1:Tl.bitrate!==Sl.bitrate?Tl.bitrate-Sl.bitrate:Tl.attrs["FRAME-RATE"]!==Sl.attrs["FRAME-RATE"]?Tl.attrs.decimalFloatingPoint("FRAME-RATE")-Sl.attrs.decimalFloatingPoint("FRAME-RATE"):Tl.attrs.SCORE!==Sl.attrs.SCORE?Tl.attrs.decimalFloatingPoint("SCORE")-Sl.attrs.decimalFloatingPoint("SCORE"):$&&Tl.height!==Sl.height?Tl.height-Sl.height:0);let ba=ga[0];if(this.steering&&(_s=this.steering.filterParsedLevels(_s),_s.length!==ga.length)){for(let Tl=0;Tl<ga.length;Tl++)if(ga[Tl].pathwayId===_s[0].pathwayId){ba=ga[Tl];break}}this._levels=_s;for(let Tl=0;Tl<_s.length;Tl++)if(_s[Tl]===ba){this._firstLevel=Tl,this.log(`manifest loaded, ${_s.length} level(s) found, first bitrate: ${ba.bitrate}`);break}const xa=_i&&!_n,El={levels:_s,audioTracks:_,subtitleTracks:j,sessionData:g.sessionData,sessionKeys:g.sessionKeys,firstLevel:this._firstLevel,stats:g.stats,audio:_i,video:_n,altAudio:!xa&&_.some(Tl=>!!Tl.url)};this.hls.trigger(Events.MANIFEST_PARSED,El),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}get levels(){return this._levels.length===0?null:this._levels}get level(){return this.currentLevelIndex}set level(i){const g=this._levels;if(g.length===0)return;if(i<0||i>=g.length){const ba=new Error("invalid level idx"),xa=i<0;if(this.hls.trigger(Events.ERROR,{type:ErrorTypes.OTHER_ERROR,details:ErrorDetails.LEVEL_SWITCH_ERROR,level:i,fatal:xa,error:ba,reason:ba.message}),xa)return;i=Math.min(i,g.length-1)}const _=this.currentLevelIndex,j=this.currentLevel,$=j?j.attrs["PATHWAY-ID"]:void 0,_n=g[i],_i=_n.attrs["PATHWAY-ID"];if(this.currentLevelIndex=i,this.currentLevel=_n,_===i&&_n.details&&j&&$===_i)return;this.log(`Switching to level ${i}${_i?" with Pathway "+_i:""} from level ${_}${$?" with Pathway "+$:""}`);const _s=_extends$5({},_n,{level:i,maxBitrate:_n.maxBitrate,attrs:_n.attrs,uri:_n.uri,urlId:_n.urlId});delete _s._attrs,delete _s._urlId,this.hls.trigger(Events.LEVEL_SWITCHING,_s);const ga=_n.details;if(!ga||ga.live){const ba=this.switchParams(_n.uri,j==null?void 0:j.details);this.loadPlaylist(ba)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(i){this.manualLevelIndex=i,this._startLevel===void 0&&(this._startLevel=i),i!==-1&&(this.level=i)}get firstLevel(){return this._firstLevel}set firstLevel(i){this._firstLevel=i}get startLevel(){if(this._startLevel===void 0){const i=this.hls.config.startLevel;return i!==void 0?i:this._firstLevel}else return this._startLevel}set startLevel(i){this._startLevel=i}onError(i,g){g.fatal||!g.context||g.context.type===PlaylistContextType.LEVEL&&g.context.level===this.level&&this.checkRetry(g)}onFragLoaded(i,{frag:g}){if(g!==void 0&&g.type===PlaylistLevelType.MAIN){const _=this._levels[g.level];_!==void 0&&(_.loadError=0)}}onLevelLoaded(i,g){var _;const{level:j,details:$}=g,_n=this._levels[j];if(!_n){var _i;this.warn(`Invalid level index ${j}`),(_i=g.deliveryDirectives)!=null&&_i.skip&&($.deltaUpdateFailed=!0);return}j===this.currentLevelIndex?(_n.fragmentError===0&&(_n.loadError=0),this.playlistLoaded(j,g,_n.details)):(_=g.deliveryDirectives)!=null&&_.skip&&($.deltaUpdateFailed=!0)}onAudioTrackSwitched(i,g){const _=this.currentLevel;if(!_)return;const j=this.hls.audioTracks[g.id].groupId;if(_.audioGroupIds&&_.audioGroupId!==j){let $=-1;for(let _n=0;_n<_.audioGroupIds.length;_n++)if(_.audioGroupIds[_n]===j){$=_n;break}$!==-1&&$!==_.urlId&&(_.urlId=$,this.canLoad&&this.startLoad())}}loadPlaylist(i){super.loadPlaylist();const g=this.currentLevelIndex,_=this.currentLevel;if(_&&this.shouldLoadPlaylist(_)){const j=_.urlId;let $=_.uri;if(i)try{$=i.addDirectives($)}catch(_i){this.warn(`Could not construct new URL with HLS Delivery Directives: ${_i}`)}const _n=_.attrs["PATHWAY-ID"];this.log(`Loading level index ${g}${(i==null?void 0:i.msn)!==void 0?" at sn "+i.msn+" part "+i.part:""} with${_n?" Pathway "+_n:""} URI ${j+1}/${_.url.length} ${$}`),this.clearTimer(),this.hls.trigger(Events.LEVEL_LOADING,{url:$,level:g,id:j,deliveryDirectives:i||null})}}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(i){this.level=i,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=i)}removeLevel(i,g){const _=($,_n)=>_n!==g,j=this._levels.filter(($,_n)=>_n!==i?!0:$.url.length>1&&g!==void 0?($.url=$.url.filter(_),$.audioGroupIds&&($.audioGroupIds=$.audioGroupIds.filter(_)),$.textGroupIds&&($.textGroupIds=$.textGroupIds.filter(_)),$.urlId=0,!0):(this.steering&&this.steering.removeLevel($),!1));this.hls.trigger(Events.LEVELS_UPDATED,{levels:j})}onLevelsUpdated(i,{levels:g}){g.forEach((_,j)=>{const{details:$}=_;$!=null&&$.fragments&&$.fragments.forEach(_n=>{_n.level=j})}),this._levels=g}}function addGroupId(h,i,g){g&&(i==="audio"?(h.audioGroupIds||(h.audioGroupIds=[]),h.audioGroupIds[h.url.length-1]=g):i==="text"&&(h.textGroupIds||(h.textGroupIds=[]),h.textGroupIds[h.url.length-1]=g))}function assignTrackIdsByGroup(h){const i={};h.forEach(g=>{const _=g.groupId||"";g.id=i[_]=i[_]||0,i[_]++})}var FragmentState={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class FragmentTracker{constructor(i){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=i,this._registerListeners()}_registerListeners(){const{hls:i}=this;i.on(Events.BUFFER_APPENDED,this.onBufferAppended,this),i.on(Events.FRAG_BUFFERED,this.onFragBuffered,this),i.on(Events.FRAG_LOADED,this.onFragLoaded,this)}_unregisterListeners(){const{hls:i}=this;i.off(Events.BUFFER_APPENDED,this.onBufferAppended,this),i.off(Events.FRAG_BUFFERED,this.onFragBuffered,this),i.off(Events.FRAG_LOADED,this.onFragLoaded,this)}destroy(){this._unregisterListeners(),this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(i,g){const _=this.activePartLists[g];if(_)for(let j=_.length;j--;){const $=_[j];if(!$)break;const _n=$.end;if($.start<=i&&_n!==null&&i<=_n)return $}return this.getBufferedFrag(i,g)}getBufferedFrag(i,g){const{fragments:_}=this,j=Object.keys(_);for(let $=j.length;$--;){const _n=_[j[$]];if((_n==null?void 0:_n.body.type)===g&&_n.buffered){const _i=_n.body;if(_i.start<=i&&i<=_i.end)return _i}}return null}detectEvictedFragments(i,g,_,j){this.timeRanges&&(this.timeRanges[i]=g);const $=(j==null?void 0:j.fragment.sn)||-1;Object.keys(this.fragments).forEach(_n=>{const _i=this.fragments[_n];if(!_i||$>=_i.body.sn)return;if(!_i.buffered&&!_i.loaded){_i.body.type===_&&this.removeFragment(_i.body);return}const _s=_i.range[i];_s&&_s.time.some(ga=>{const ba=!this.isTimeBuffered(ga.startPTS,ga.endPTS,g);return ba&&this.removeFragment(_i.body),ba})})}detectPartialFragments(i){const g=this.timeRanges,{frag:_,part:j}=i;if(!g||_.sn==="initSegment")return;const $=getFragmentKey(_),_n=this.fragments[$];if(!_n)return;const _i=!_.relurl;Object.keys(g).forEach(_s=>{const ga=_.elementaryStreams[_s];if(!ga)return;const ba=g[_s],xa=_i||ga.partial===!0;_n.range[_s]=this.getBufferedTimes(_,j,xa,ba)}),_n.loaded=null,Object.keys(_n.range).length?(_n.buffered=!0,_n.body.endList&&(this.endListFragments[_n.body.type]=_n),isPartial(_n)||this.removeParts(_.sn-1,_.type)):this.removeFragment(_n.body)}removeParts(i,g){const _=this.activePartLists[g];_&&(this.activePartLists[g]=_.filter(j=>j.fragment.sn>=i))}fragBuffered(i,g){const _=getFragmentKey(i);let j=this.fragments[_];!j&&g&&(j=this.fragments[_]={body:i,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},i.gap&&(this.hasGaps=!0)),j&&(j.loaded=null,j.buffered=!0)}getBufferedTimes(i,g,_,j){const $={time:[],partial:_},_n=i.start,_i=i.end,_s=i.minEndPTS||_i,ga=i.maxStartPTS||_n;for(let ba=0;ba<j.length;ba++){const xa=j.start(ba)-this.bufferPadding,El=j.end(ba)+this.bufferPadding;if(ga>=xa&&_s<=El){$.time.push({startPTS:Math.max(_n,j.start(ba)),endPTS:Math.min(_i,j.end(ba))});break}else if(_n<El&&_i>xa)$.partial=!0,$.time.push({startPTS:Math.max(_n,j.start(ba)),endPTS:Math.min(_i,j.end(ba))});else if(_i<=xa)break}return $}getPartialFragment(i){let g=null,_,j,$,_n=0;const{bufferPadding:_i,fragments:_s}=this;return Object.keys(_s).forEach(ga=>{const ba=_s[ga];ba&&isPartial(ba)&&(j=ba.body.start-_i,$=ba.body.end+_i,i>=j&&i<=$&&(_=Math.min(i-j,$-i),_n<=_&&(g=ba.body,_n=_)))}),g}isEndListAppended(i){const g=this.endListFragments[i];return g!==void 0&&(g.buffered||isPartial(g))}getState(i){const g=getFragmentKey(i),_=this.fragments[g];return _?_.buffered?isPartial(_)?FragmentState.PARTIAL:FragmentState.OK:FragmentState.APPENDING:FragmentState.NOT_LOADED}isTimeBuffered(i,g,_){let j,$;for(let _n=0;_n<_.length;_n++){if(j=_.start(_n)-this.bufferPadding,$=_.end(_n)+this.bufferPadding,i>=j&&g<=$)return!0;if(g<=j)return!1}return!1}onFragLoaded(i,g){const{frag:_,part:j}=g;if(_.sn==="initSegment"||_.bitrateTest)return;const $=j?null:g,_n=getFragmentKey(_);this.fragments[_n]={body:_,appendedPTS:null,loaded:$,buffered:!1,range:Object.create(null)}}onBufferAppended(i,g){const{frag:_,part:j,timeRanges:$}=g;if(_.sn==="initSegment")return;const _n=_.type;if(j){let _i=this.activePartLists[_n];_i||(this.activePartLists[_n]=_i=[]),_i.push(j)}this.timeRanges=$,Object.keys($).forEach(_i=>{const _s=$[_i];this.detectEvictedFragments(_i,_s,_n,j)})}onFragBuffered(i,g){this.detectPartialFragments(g)}hasFragment(i){const g=getFragmentKey(i);return!!this.fragments[g]}hasParts(i){var g;return!!((g=this.activePartLists[i])!=null&&g.length)}removeFragmentsInRange(i,g,_,j,$){j&&!this.hasGaps||Object.keys(this.fragments).forEach(_n=>{const _i=this.fragments[_n];if(!_i)return;const _s=_i.body;_s.type!==_||j&&!_s.gap||_s.start<g&&_s.end>i&&(_i.buffered||$)&&this.removeFragment(_s)})}removeFragment(i){const g=getFragmentKey(i);i.stats.loaded=0,i.clearElementaryStreamInfo();const _=this.activePartLists[i.type];if(_){const j=i.sn;this.activePartLists[i.type]=_.filter($=>$.fragment.sn!==j)}delete this.fragments[g],i.endList&&delete this.endListFragments[i.type]}removeAllFragments(){this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1}}function isPartial(h){var i,g,_;return h.buffered&&(h.body.gap||((i=h.range.video)==null?void 0:i.partial)||((g=h.range.audio)==null?void 0:g.partial)||((_=h.range.audiovideo)==null?void 0:_.partial))}function getFragmentKey(h){return`${h.type}_${h.level}_${h.urlId}_${h.sn}`}const MIN_CHUNK_SIZE=Math.pow(2,17);class FragmentLoader{constructor(i){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=i}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(i,g){const _=i.url;if(!_)return Promise.reject(new LoadError({type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:i,error:new Error(`Fragment does not have a ${_?"part list":"url"}`),networkDetails:null}));this.abort();const j=this.config,$=j.fLoader,_n=j.loader;return new Promise((_i,_s)=>{if(this.loader&&this.loader.destroy(),i.gap){_s(createGapLoadError(i));return}const ga=this.loader=i.loader=$?new $(j):new _n(j),ba=createLoaderContext(i),xa=getLoaderConfigWithoutReties(j.fragLoadPolicy.default),El={loadPolicy:xa,timeout:xa.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:i.sn==="initSegment"?1/0:MIN_CHUNK_SIZE};i.stats=ga.stats,ga.load(ba,El,{onSuccess:(Tl,Sl,Il,Cl)=>{this.resetLoader(i,ga);let Nl=Tl.data;Il.resetIV&&i.decryptdata&&(i.decryptdata.iv=new Uint8Array(Nl.slice(0,16)),Nl=Nl.slice(16)),_i({frag:i,part:null,payload:Nl,networkDetails:Cl})},onError:(Tl,Sl,Il,Cl)=>{this.resetLoader(i,ga),_s(new LoadError({type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:i,response:_objectSpread2({url:_,data:void 0},Tl),error:new Error(`HTTP Error ${Tl.code} ${Tl.text}`),networkDetails:Il,stats:Cl}))},onAbort:(Tl,Sl,Il)=>{this.resetLoader(i,ga),_s(new LoadError({type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:i,error:new Error("Aborted"),networkDetails:Il,stats:Tl}))},onTimeout:(Tl,Sl,Il)=>{this.resetLoader(i,ga),_s(new LoadError({type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:i,error:new Error(`Timeout after ${El.timeout}ms`),networkDetails:Il,stats:Tl}))},onProgress:(Tl,Sl,Il,Cl)=>{g&&g({frag:i,part:null,payload:Il,networkDetails:Cl})}})})}loadPart(i,g,_){this.abort();const j=this.config,$=j.fLoader,_n=j.loader;return new Promise((_i,_s)=>{if(this.loader&&this.loader.destroy(),i.gap||g.gap){_s(createGapLoadError(i,g));return}const ga=this.loader=i.loader=$?new $(j):new _n(j),ba=createLoaderContext(i,g),xa=getLoaderConfigWithoutReties(j.fragLoadPolicy.default),El={loadPolicy:xa,timeout:xa.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:MIN_CHUNK_SIZE};g.stats=ga.stats,ga.load(ba,El,{onSuccess:(Tl,Sl,Il,Cl)=>{this.resetLoader(i,ga),this.updateStatsFromPart(i,g);const Nl={frag:i,part:g,payload:Tl.data,networkDetails:Cl};_(Nl),_i(Nl)},onError:(Tl,Sl,Il,Cl)=>{this.resetLoader(i,ga),_s(new LoadError({type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:i,part:g,response:_objectSpread2({url:ba.url,data:void 0},Tl),error:new Error(`HTTP Error ${Tl.code} ${Tl.text}`),networkDetails:Il,stats:Cl}))},onAbort:(Tl,Sl,Il)=>{i.stats.aborted=g.stats.aborted,this.resetLoader(i,ga),_s(new LoadError({type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:i,part:g,error:new Error("Aborted"),networkDetails:Il,stats:Tl}))},onTimeout:(Tl,Sl,Il)=>{this.resetLoader(i,ga),_s(new LoadError({type:ErrorTypes.NETWORK_ERROR,details:ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:i,part:g,error:new Error(`Timeout after ${El.timeout}ms`),networkDetails:Il,stats:Tl}))}})})}updateStatsFromPart(i,g){const _=i.stats,j=g.stats,$=j.total;if(_.loaded+=j.loaded,$){const _s=Math.round(i.duration/g.duration),ga=Math.min(Math.round(_.loaded/$),_s),xa=(_s-ga)*Math.round(_.loaded/ga);_.total=_.loaded+xa}else _.total=Math.max(_.loaded,_.total);const _n=_.loading,_i=j.loading;_n.start?_n.first+=_i.first-_i.start:(_n.start=_i.start,_n.first=_i.first),_n.end=_i.end}resetLoader(i,g){i.loader=null,this.loader===g&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),g.destroy()}}function createLoaderContext(h,i=null){const g=i||h,_={frag:h,part:i,responseType:"arraybuffer",url:g.url,headers:{},rangeStart:0,rangeEnd:0},j=g.byteRangeStartOffset,$=g.byteRangeEndOffset;if(isFiniteNumber(j)&&isFiniteNumber($)){var _n;let _i=j,_s=$;if(h.sn==="initSegment"&&((_n=h.decryptdata)==null?void 0:_n.method)==="AES-128"){const ga=$-j;ga%16&&(_s=$+(16-ga%16)),j!==0&&(_.resetIV=!0,_i=j-16)}_.rangeStart=_i,_.rangeEnd=_s}return _}function createGapLoadError(h,i){const g=new Error(`GAP ${h.gap?"tag":"attribute"} found`),_={type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_GAP,fatal:!1,frag:h,error:g,networkDetails:null};return i&&(_.part=i),(i||h).stats.aborted=!0,new LoadError(_)}class LoadError extends Error{constructor(i){super(i.error.message),this.data=void 0,this.data=i}}class KeyLoader{constructor(i){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=i}abort(i){for(const g in this.keyUriToKeyInfo){const _=this.keyUriToKeyInfo[g].loader;if(_){if(i&&i!==_.context.frag.type)return;_.abort()}}}detach(){for(const i in this.keyUriToKeyInfo){const g=this.keyUriToKeyInfo[i];(g.mediaKeySessionContext||g.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[i]}}destroy(){this.detach();for(const i in this.keyUriToKeyInfo){const g=this.keyUriToKeyInfo[i].loader;g&&g.destroy()}this.keyUriToKeyInfo={}}createKeyLoadError(i,g=ErrorDetails.KEY_LOAD_ERROR,_,j,$){return new LoadError({type:ErrorTypes.NETWORK_ERROR,details:g,fatal:!1,frag:i,response:$,error:_,networkDetails:j})}loadClear(i,g){if(this.emeController&&this.config.emeEnabled){const{sn:_,cc:j}=i;for(let $=0;$<g.length;$++){const _n=g[$];if(j<=_n.cc&&(_==="initSegment"||_n.sn==="initSegment"||_<_n.sn)){this.emeController.selectKeySystemFormat(_n).then(_i=>{_n.setKeyFormat(_i)});break}}}}load(i){return!i.decryptdata&&i.encrypted&&this.emeController?this.emeController.selectKeySystemFormat(i).then(g=>this.loadInternal(i,g)):this.loadInternal(i)}loadInternal(i,g){var _,j;g&&i.setKeyFormat(g);const $=i.decryptdata;if(!$){const ga=new Error(g?`Expected frag.decryptdata to be defined after setting format ${g}`:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(i,ErrorDetails.KEY_LOAD_ERROR,ga))}const _n=$.uri;if(!_n)return Promise.reject(this.createKeyLoadError(i,ErrorDetails.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${_n}"`)));let _i=this.keyUriToKeyInfo[_n];if((_=_i)!=null&&_.decryptdata.key)return $.key=_i.decryptdata.key,Promise.resolve({frag:i,keyInfo:_i});if((j=_i)!=null&&j.keyLoadPromise){var _s;switch((_s=_i.mediaKeySessionContext)==null?void 0:_s.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return _i.keyLoadPromise.then(ga=>($.key=ga.keyInfo.decryptdata.key,{frag:i,keyInfo:_i}))}}switch(_i=this.keyUriToKeyInfo[_n]={decryptdata:$,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},$.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return $.keyFormat==="identity"?this.loadKeyHTTP(_i,i):this.loadKeyEME(_i,i);case"AES-128":return this.loadKeyHTTP(_i,i);default:return Promise.reject(this.createKeyLoadError(i,ErrorDetails.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${$.method}"`)))}}loadKeyEME(i,g){const _={frag:g,keyInfo:i};if(this.emeController&&this.config.emeEnabled){const j=this.emeController.loadKey(_);if(j)return(i.keyLoadPromise=j.then($=>(i.mediaKeySessionContext=$,_))).catch($=>{throw i.keyLoadPromise=null,$})}return Promise.resolve(_)}loadKeyHTTP(i,g){const _=this.config,j=_.loader,$=new j(_);return g.keyLoader=i.loader=$,i.keyLoadPromise=new Promise((_n,_i)=>{const _s={keyInfo:i,frag:g,responseType:"arraybuffer",url:i.decryptdata.uri},ga=_.keyLoadPolicy.default,ba={loadPolicy:ga,timeout:ga.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},xa={onSuccess:(El,Tl,Sl,Il)=>{const{frag:Cl,keyInfo:Nl,url:Dl}=Sl;if(!Cl.decryptdata||Nl!==this.keyUriToKeyInfo[Dl])return _i(this.createKeyLoadError(Cl,ErrorDetails.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),Il));Nl.decryptdata.key=Cl.decryptdata.key=new Uint8Array(El.data),Cl.keyLoader=null,Nl.loader=null,_n({frag:Cl,keyInfo:Nl})},onError:(El,Tl,Sl,Il)=>{this.resetLoader(Tl),_i(this.createKeyLoadError(g,ErrorDetails.KEY_LOAD_ERROR,new Error(`HTTP Error ${El.code} loading key ${El.text}`),Sl,_objectSpread2({url:_s.url,data:void 0},El)))},onTimeout:(El,Tl,Sl)=>{this.resetLoader(Tl),_i(this.createKeyLoadError(g,ErrorDetails.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),Sl))},onAbort:(El,Tl,Sl)=>{this.resetLoader(Tl),_i(this.createKeyLoadError(g,ErrorDetails.INTERNAL_ABORTED,new Error("key loading aborted"),Sl))}};$.load(_s,ba,xa)})}resetLoader(i){const{frag:g,keyInfo:_,url:j}=i,$=_.loader;g.keyLoader===$&&(g.keyLoader=null,_.loader=null),delete this.keyUriToKeyInfo[j],$&&$.destroy()}}class TaskLoop{constructor(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(i){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,i),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}const noopBuffered={length:0,start:()=>0,end:()=>0};class BufferHelper{static isBuffered(i,g){try{if(i){const _=BufferHelper.getBuffered(i);for(let j=0;j<_.length;j++)if(g>=_.start(j)&&g<=_.end(j))return!0}}catch{}return!1}static bufferInfo(i,g,_){try{if(i){const j=BufferHelper.getBuffered(i),$=[];let _n;for(_n=0;_n<j.length;_n++)$.push({start:j.start(_n),end:j.end(_n)});return this.bufferedInfo($,g,_)}}catch{}return{len:0,start:g,end:g,nextStart:void 0}}static bufferedInfo(i,g,_){g=Math.max(0,g),i.sort(function(ga,ba){const xa=ga.start-ba.start;return xa||ba.end-ga.end});let j=[];if(_)for(let ga=0;ga<i.length;ga++){const ba=j.length;if(ba){const xa=j[ba-1].end;i[ga].start-xa<_?i[ga].end>xa&&(j[ba-1].end=i[ga].end):j.push(i[ga])}else j.push(i[ga])}else j=i;let $=0,_n,_i=g,_s=g;for(let ga=0;ga<j.length;ga++){const ba=j[ga].start,xa=j[ga].end;if(g+_>=ba&&g<xa)_i=ba,_s=xa,$=_s-g;else if(g+_<ba){_n=ba;break}}return{len:$,start:_i||0,end:_s||0,nextStart:_n}}static getBuffered(i){try{return i.buffered}catch(g){return logger.log("failed to get media.buffered",g),noopBuffered}}}class ChunkMetadata{constructor(i,g,_,j=0,$=-1,_n=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=getNewPerformanceTiming(),this.buffering={audio:getNewPerformanceTiming(),video:getNewPerformanceTiming(),audiovideo:getNewPerformanceTiming()},this.level=i,this.sn=g,this.id=_,this.size=j,this.part=$,this.partial=_n}}function getNewPerformanceTiming(){return{start:0,executeStart:0,executeEnd:0,end:0}}function findFirstFragWithCC(h,i){let g=null;for(let _=0,j=h.length;_<j;_++){const $=h[_];if($&&$.cc===i){g=$;break}}return g}function shouldAlignOnDiscontinuities(h,i,g){return!!(i.details&&(g.endCC>g.startCC||h&&h.cc<g.startCC))}function findDiscontinuousReferenceFrag(h,i,g=0){const _=h.fragments,j=i.fragments;if(!j.length||!_.length){logger.log("No fragments to align");return}const $=findFirstFragWithCC(_,j[0].cc);if(!$||$&&!$.startPTS){logger.log("No frag in previous level to align on");return}return $}function adjustFragmentStart(h,i){if(h){const g=h.start+i;h.start=h.startPTS=g,h.endPTS=g+h.duration}}function adjustSlidingStart(h,i){const g=i.fragments;for(let _=0,j=g.length;_<j;_++)adjustFragmentStart(g[_],h);i.fragmentHint&&adjustFragmentStart(i.fragmentHint,h),i.alignedSliding=!0}function alignStream(h,i,g){i&&(alignDiscontinuities(h,g,i),!g.alignedSliding&&i.details&&alignPDT(g,i.details),!g.alignedSliding&&i.details&&!g.skippedSegments&&adjustSliding(i.details,g))}function alignDiscontinuities(h,i,g){if(shouldAlignOnDiscontinuities(h,g,i)){const _=findDiscontinuousReferenceFrag(g.details,i);_&&isFiniteNumber(_.start)&&(logger.log(`Adjusting PTS using last level due to CC increase within current level ${i.url}`),adjustSlidingStart(_.start,i))}}function alignPDT(h,i){if(!i.fragments.length||!h.hasProgramDateTime||!i.hasProgramDateTime)return;const g=i.fragments[0].programDateTime,_=h.fragments[0].programDateTime,j=(_-g)/1e3+i.fragments[0].start;j&&isFiniteNumber(j)&&(logger.log(`Adjusting PTS using programDateTime delta ${_-g}ms, sliding:${j.toFixed(3)} ${h.url} `),adjustSlidingStart(j,h))}function alignMediaPlaylistByPDT(h,i){if(!h.hasProgramDateTime||!i.hasProgramDateTime)return;const g=h.fragments,_=i.fragments;if(!g.length||!_.length)return;const j=Math.round(_.length/2)-1,$=_[j],_n=findFirstFragWithCC(g,$.cc)||g[Math.round(g.length/2)-1],_i=$.programDateTime,_s=_n.programDateTime;if(_i===null||_s===null)return;const ga=(_s-_i)/1e3-(_n.start-$.start);adjustSlidingStart(ga,h)}class AESCrypto{constructor(i,g){this.subtle=void 0,this.aesIV=void 0,this.subtle=i,this.aesIV=g}decrypt(i,g){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},g,i)}}class FastAESKey{constructor(i,g){this.subtle=void 0,this.key=void 0,this.subtle=i,this.key=g}expandKey(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])}}function removePadding(h){const i=h.byteLength,g=i&&new DataView(h.buffer).getUint8(i-1);return g?sliceUint8(h,0,i-g):h}class AESDecryptor{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(i){const g=new DataView(i),_=new Uint32Array(4);for(let j=0;j<4;j++)_[j]=g.getUint32(j*4);return _}initTable(){const i=this.sBox,g=this.invSBox,_=this.subMix,j=_[0],$=_[1],_n=_[2],_i=_[3],_s=this.invSubMix,ga=_s[0],ba=_s[1],xa=_s[2],El=_s[3],Tl=new Uint32Array(256);let Sl=0,Il=0,Cl=0;for(Cl=0;Cl<256;Cl++)Cl<128?Tl[Cl]=Cl<<1:Tl[Cl]=Cl<<1^283;for(Cl=0;Cl<256;Cl++){let Nl=Il^Il<<1^Il<<2^Il<<3^Il<<4;Nl=Nl>>>8^Nl&255^99,i[Sl]=Nl,g[Nl]=Sl;const Dl=Tl[Sl],Ul=Tl[Dl],Kl=Tl[Ul];let Jl=Tl[Nl]*257^Nl*16843008;j[Sl]=Jl<<24|Jl>>>8,$[Sl]=Jl<<16|Jl>>>16,_n[Sl]=Jl<<8|Jl>>>24,_i[Sl]=Jl,Jl=Kl*16843009^Ul*65537^Dl*257^Sl*16843008,ga[Nl]=Jl<<24|Jl>>>8,ba[Nl]=Jl<<16|Jl>>>16,xa[Nl]=Jl<<8|Jl>>>24,El[Nl]=Jl,Sl?(Sl=Dl^Tl[Tl[Tl[Kl^Dl]]],Il^=Tl[Tl[Il]]):Sl=Il=1}}expandKey(i){const g=this.uint8ArrayToUint32Array_(i);let _=!0,j=0;for(;j<g.length&&_;)_=g[j]===this.key[j],j++;if(_)return;this.key=g;const $=this.keySize=g.length;if($!==4&&$!==6&&$!==8)throw new Error("Invalid aes key size="+$);const _n=this.ksRows=($+6+1)*4;let _i,_s;const ga=this.keySchedule=new Uint32Array(_n),ba=this.invKeySchedule=new Uint32Array(_n),xa=this.sBox,El=this.rcon,Tl=this.invSubMix,Sl=Tl[0],Il=Tl[1],Cl=Tl[2],Nl=Tl[3];let Dl,Ul;for(_i=0;_i<_n;_i++){if(_i<$){Dl=ga[_i]=g[_i];continue}Ul=Dl,_i%$===0?(Ul=Ul<<8|Ul>>>24,Ul=xa[Ul>>>24]<<24|xa[Ul>>>16&255]<<16|xa[Ul>>>8&255]<<8|xa[Ul&255],Ul^=El[_i/$|0]<<24):$>6&&_i%$===4&&(Ul=xa[Ul>>>24]<<24|xa[Ul>>>16&255]<<16|xa[Ul>>>8&255]<<8|xa[Ul&255]),ga[_i]=Dl=(ga[_i-$]^Ul)>>>0}for(_s=0;_s<_n;_s++)_i=_n-_s,_s&3?Ul=ga[_i]:Ul=ga[_i-4],_s<4||_i<=4?ba[_s]=Ul:ba[_s]=Sl[xa[Ul>>>24]]^Il[xa[Ul>>>16&255]]^Cl[xa[Ul>>>8&255]]^Nl[xa[Ul&255]],ba[_s]=ba[_s]>>>0}networkToHostOrderSwap(i){return i<<24|(i&65280)<<8|(i&16711680)>>8|i>>>24}decrypt(i,g,_){const j=this.keySize+6,$=this.invKeySchedule,_n=this.invSBox,_i=this.invSubMix,_s=_i[0],ga=_i[1],ba=_i[2],xa=_i[3],El=this.uint8ArrayToUint32Array_(_);let Tl=El[0],Sl=El[1],Il=El[2],Cl=El[3];const Nl=new Int32Array(i),Dl=new Int32Array(Nl.length);let Ul,Kl,Jl,Ep,_p,Ip,Up,yp,Ap,Cp,Mp,wp,Np,Fp;const Hp=this.networkToHostOrderSwap;for(;g<Nl.length;){for(Ap=Hp(Nl[g]),Cp=Hp(Nl[g+1]),Mp=Hp(Nl[g+2]),wp=Hp(Nl[g+3]),_p=Ap^$[0],Ip=wp^$[1],Up=Mp^$[2],yp=Cp^$[3],Np=4,Fp=1;Fp<j;Fp++)Ul=_s[_p>>>24]^ga[Ip>>16&255]^ba[Up>>8&255]^xa[yp&255]^$[Np],Kl=_s[Ip>>>24]^ga[Up>>16&255]^ba[yp>>8&255]^xa[_p&255]^$[Np+1],Jl=_s[Up>>>24]^ga[yp>>16&255]^ba[_p>>8&255]^xa[Ip&255]^$[Np+2],Ep=_s[yp>>>24]^ga[_p>>16&255]^ba[Ip>>8&255]^xa[Up&255]^$[Np+3],_p=Ul,Ip=Kl,Up=Jl,yp=Ep,Np=Np+4;Ul=_n[_p>>>24]<<24^_n[Ip>>16&255]<<16^_n[Up>>8&255]<<8^_n[yp&255]^$[Np],Kl=_n[Ip>>>24]<<24^_n[Up>>16&255]<<16^_n[yp>>8&255]<<8^_n[_p&255]^$[Np+1],Jl=_n[Up>>>24]<<24^_n[yp>>16&255]<<16^_n[_p>>8&255]<<8^_n[Ip&255]^$[Np+2],Ep=_n[yp>>>24]<<24^_n[_p>>16&255]<<16^_n[Ip>>8&255]<<8^_n[Up&255]^$[Np+3],Dl[g]=Hp(Ul^Tl),Dl[g+1]=Hp(Ep^Sl),Dl[g+2]=Hp(Jl^Il),Dl[g+3]=Hp(Kl^Cl),Tl=Ap,Sl=Cp,Il=Mp,Cl=wp,g=g+4}return Dl.buffer}}const CHUNK_SIZE=16;class Decrypter{constructor(i,{removePKCS7Padding:g=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.useSoftware=i.enableSoftwareAES,this.removePKCS7Padding=g,g)try{const _=self.crypto;_&&(this.subtle=_.subtle||_.webkitSubtle)}catch{}this.subtle===null&&(this.useSoftware=!0)}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:i,remainderData:g}=this;if(!i||g)return this.reset(),null;const _=new Uint8Array(i);return this.reset(),this.removePKCS7Padding?removePadding(_):_}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(i,g,_){return this.useSoftware?new Promise((j,$)=>{this.softwareDecrypt(new Uint8Array(i),g,_);const _n=this.flush();_n?j(_n.buffer):$(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(i),g,_)}softwareDecrypt(i,g,_){const{currentIV:j,currentResult:$,remainderData:_n}=this;this.logOnce("JS AES decrypt"),_n&&(i=appendUint8Array(_n,i),this.remainderData=null);const _i=this.getValidChunk(i);if(!_i.length)return null;j&&(_=j);let _s=this.softwareDecrypter;_s||(_s=this.softwareDecrypter=new AESDecryptor),_s.expandKey(g);const ga=$;return this.currentResult=_s.decrypt(_i.buffer,0,_),this.currentIV=sliceUint8(_i,-16).buffer,ga||null}webCryptoDecrypt(i,g,_){const j=this.subtle;return(this.key!==g||!this.fastAesKey)&&(this.key=g,this.fastAesKey=new FastAESKey(j,g)),this.fastAesKey.expandKey().then($=>j?(this.logOnce("WebCrypto AES decrypt"),new AESCrypto(j,new Uint8Array(_)).decrypt(i.buffer,$)):Promise.reject(new Error("web crypto not initialized"))).catch($=>(logger.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${$.name}: ${$.message}`),this.onWebCryptoError(i,g,_)))}onWebCryptoError(i,g,_){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(i,g,_);const j=this.flush();if(j)return j.buffer;throw new Error("WebCrypto and softwareDecrypt: failed to decrypt data")}getValidChunk(i){let g=i;const _=i.length-i.length%CHUNK_SIZE;return _!==i.length&&(g=sliceUint8(i,0,_),this.remainderData=sliceUint8(i,_)),g}logOnce(i){this.logEnabled&&(logger.log(`[decrypter]: ${i}`),this.logEnabled=!1)}}const TimeRanges={toString:function(h){let i="";const g=h.length;for(let _=0;_<g;_++)i+=`[${h.start(_).toFixed(3)}-${h.end(_).toFixed(3)}]`;return i}},State={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class BaseStreamController extends TaskLoop{constructor(i,g,_,j,$){super(),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=State.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.loadedmetadata=!1,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.onvseeking=null,this.onvended=null,this.logPrefix="",this.log=void 0,this.warn=void 0,this.playlistType=$,this.logPrefix=j,this.log=logger.log.bind(logger,`${j}:`),this.warn=logger.warn.bind(logger,`${j}:`),this.hls=i,this.fragmentLoader=new FragmentLoader(i.config),this.keyLoader=_,this.fragmentTracker=g,this.config=i.config,this.decrypter=new Decrypter(i.config),i.on(Events.MANIFEST_LOADED,this.onManifestLoaded,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(i){}stopLoad(){this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const i=this.fragCurrent;i!=null&&i.loader&&(i.abortRequests(),this.fragmentTracker.removeFragment(i)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=State.STOPPED}_streamEnded(i,g){if(g.live||i.nextStart||!i.end||!this.media)return!1;const _=g.partList;if(_!=null&&_.length){const $=_[_.length-1];return BufferHelper.isBuffered(this.media,$.start+$.duration/2)}const j=g.fragments[g.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(j)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null){var i;return(i=this.levels[this.levelLastLoaded])==null?void 0:i.details}}onMediaAttached(i,g){const _=this.media=this.mediaBuffer=g.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),_.addEventListener("seeking",this.onvseeking),_.addEventListener("ended",this.onvended);const j=this.config;this.levels&&j.autoStartLoad&&this.state===State.STOPPED&&this.startLoad(j.startPosition)}onMediaDetaching(){const i=this.media;i!=null&&i.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),i&&this.onvseeking&&this.onvended&&(i.removeEventListener("seeking",this.onvseeking),i.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.keyLoader&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}onMediaSeeking(){const{config:i,fragCurrent:g,media:_,mediaBuffer:j,state:$}=this,_n=_?_.currentTime:0,_i=BufferHelper.bufferInfo(j||_,_n,i.maxBufferHole);if(this.log(`media seeking to ${isFiniteNumber(_n)?_n.toFixed(3):_n}, state: ${$}`),this.state===State.ENDED)this.resetLoadingState();else if(g){const _s=i.maxFragLookUpTolerance,ga=g.start-_s,ba=g.start+g.duration+_s;if(!_i.len||ba<_i.start||ga>_i.end){const xa=_n>ba;(_n<ga||xa)&&(xa&&g.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),g.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}_&&(this.fragmentTracker.removeFragmentsInRange(_n,1/0,this.playlistType,!0),this.lastCurrentTime=_n),!this.loadedmetadata&&!_i.len&&(this.nextLoadPosition=this.startPosition=_n),this.tickImmediate()}onMediaEnded(){this.startPosition=this.lastCurrentTime=0}onManifestLoaded(i,g){this.startTimeOffset=g.startTimeOffset,this.initPTS=[]}onHandlerDestroying(){this.stopLoad(),super.onHandlerDestroying()}onHandlerDestroyed(){this.state=State.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(i,g,_){this._loadFragForPlayback(i,g,_)}_loadFragForPlayback(i,g,_){const j=$=>{if(this.fragContextChanged(i)){this.warn(`Fragment ${i.sn}${$.part?" p: "+$.part.index:""} of level ${i.level} was dropped during download.`),this.fragmentTracker.removeFragment(i);return}i.stats.chunkCount++,this._handleFragmentLoadProgress($)};this._doFragLoad(i,g,_,j).then($=>{if(!$)return;const _n=this.state;if(this.fragContextChanged(i)){(_n===State.FRAG_LOADING||!this.fragCurrent&&_n===State.PARSING)&&(this.fragmentTracker.removeFragment(i),this.state=State.IDLE);return}"payload"in $&&(this.log(`Loaded fragment ${i.sn} of level ${i.level}`),this.hls.trigger(Events.FRAG_LOADED,$)),this._handleFragmentLoadComplete($)}).catch($=>{this.state===State.STOPPED||this.state===State.ERROR||(this.warn($),this.resetFragmentLoading(i))})}clearTrackerIfNeeded(i){var g;const{fragmentTracker:_}=this;if(_.getState(i)===FragmentState.APPENDING){const $=i.type,_n=this.getFwdBufferInfo(this.mediaBuffer,$),_i=Math.max(i.duration,_n?_n.len:this.config.maxBufferLength);this.reduceMaxBufferLength(_i)&&_.removeFragment(i)}else((g=this.mediaBuffer)==null?void 0:g.buffered.length)===0?_.removeAllFragments():_.hasParts(i.type)&&(_.detectPartialFragments({frag:i,part:null,stats:i.stats,id:i.type}),_.getState(i)===FragmentState.PARTIAL&&_.removeFragment(i))}flushMainBuffer(i,g,_=null){if(!(i-g))return;const j={startOffset:i,endOffset:g,type:_};this.hls.trigger(Events.BUFFER_FLUSHING,j)}_loadInitSegment(i,g){this._doFragLoad(i,g).then(_=>{if(!_||this.fragContextChanged(i)||!this.levels)throw new Error("init load aborted");return _}).then(_=>{const{hls:j}=this,{payload:$}=_,_n=i.decryptdata;if($&&$.byteLength>0&&_n&&_n.key&&_n.iv&&_n.method==="AES-128"){const _i=self.performance.now();return this.decrypter.decrypt(new Uint8Array($),_n.key.buffer,_n.iv.buffer).catch(_s=>{throw j.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_DECRYPT_ERROR,fatal:!1,error:_s,reason:_s.message,frag:i}),_s}).then(_s=>{const ga=self.performance.now();return j.trigger(Events.FRAG_DECRYPTED,{frag:i,payload:_s,stats:{tstart:_i,tdecrypt:ga}}),_.payload=_s,_})}return _}).then(_=>{const{fragCurrent:j,hls:$,levels:_n}=this;if(!_n)throw new Error("init load aborted, missing levels");const _i=i.stats;this.state=State.IDLE,g.fragmentError=0,i.data=new Uint8Array(_.payload),_i.parsing.start=_i.buffering.start=self.performance.now(),_i.parsing.end=_i.buffering.end=self.performance.now(),_.frag===j&&$.trigger(Events.FRAG_BUFFERED,{stats:_i,frag:j,part:null,id:i.type}),this.tick()}).catch(_=>{this.state===State.STOPPED||this.state===State.ERROR||(this.warn(_),this.resetFragmentLoading(i))})}fragContextChanged(i){const{fragCurrent:g}=this;return!i||!g||i.level!==g.level||i.sn!==g.sn||i.urlId!==g.urlId}fragBufferedComplete(i,g){var _,j,$,_n;const _i=this.mediaBuffer?this.mediaBuffer:this.media;this.log(`Buffered ${i.type} sn: ${i.sn}${g?" part: "+g.index:""} of ${this.playlistType===PlaylistLevelType.MAIN?"level":"track"} ${i.level} (frag:[${((_=i.startPTS)!=null?_:NaN).toFixed(3)}-${((j=i.endPTS)!=null?j:NaN).toFixed(3)}] > buffer:${_i?TimeRanges.toString(BufferHelper.getBuffered(_i)):"(detached)"})`),this.state=State.IDLE,_i&&(!this.loadedmetadata&&i.type==PlaylistLevelType.MAIN&&_i.buffered.length&&(($=this.fragCurrent)==null?void 0:$.sn)===((_n=this.fragPrevious)==null?void 0:_n.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())}seekToStartPos(){}_handleFragmentLoadComplete(i){const{transmuxer:g}=this;if(!g)return;const{frag:_,part:j,partsLoaded:$}=i,_n=!$||$.length===0||$.some(_s=>!_s),_i=new ChunkMetadata(_.level,_.sn,_.stats.chunkCount+1,0,j?j.index:-1,!_n);g.flush(_i)}_handleFragmentLoadProgress(i){}_doFragLoad(i,g,_=null,j){var $;const _n=g==null?void 0:g.details;if(!this.levels||!_n)throw new Error(`frag load aborted, missing level${_n?"":" detail"}s`);let _i=null;if(i.encrypted&&!(($=i.decryptdata)!=null&&$.key)?(this.log(`Loading key for ${i.sn} of [${_n.startSN}-${_n.endSN}], ${this.logPrefix==="[stream-controller]"?"level":"track"} ${i.level}`),this.state=State.KEY_LOADING,this.fragCurrent=i,_i=this.keyLoader.load(i).then(ba=>{if(!this.fragContextChanged(ba.frag))return this.hls.trigger(Events.KEY_LOADED,ba),this.state===State.KEY_LOADING&&(this.state=State.IDLE),ba}),this.hls.trigger(Events.KEY_LOADING,{frag:i}),this.fragCurrent===null&&(_i=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING")))):!i.encrypted&&_n.encryptedFragments.length&&this.keyLoader.loadClear(i,_n.encryptedFragments),_=Math.max(i.start,_||0),this.config.lowLatencyMode&&i.sn!=="initSegment"){const ba=_n.partList;if(ba&&j){_>i.end&&_n.fragmentHint&&(i=_n.fragmentHint);const xa=this.getNextPart(ba,i,_);if(xa>-1){const El=ba[xa];this.log(`Loading part sn: ${i.sn} p: ${El.index} cc: ${i.cc} of playlist [${_n.startSN}-${_n.endSN}] parts [0-${xa}-${ba.length-1}] ${this.logPrefix==="[stream-controller]"?"level":"track"}: ${i.level}, target: ${parseFloat(_.toFixed(3))}`),this.nextLoadPosition=El.start+El.duration,this.state=State.FRAG_LOADING;let Tl;return _i?Tl=_i.then(Sl=>!Sl||this.fragContextChanged(Sl.frag)?null:this.doFragPartsLoad(i,El,g,j)).catch(Sl=>this.handleFragLoadError(Sl)):Tl=this.doFragPartsLoad(i,El,g,j).catch(Sl=>this.handleFragLoadError(Sl)),this.hls.trigger(Events.FRAG_LOADING,{frag:i,part:El,targetBufferTime:_}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):Tl}else if(!i.url||this.loadedEndOfParts(ba,_))return Promise.resolve(null)}}this.log(`Loading fragment ${i.sn} cc: ${i.cc} ${_n?"of ["+_n.startSN+"-"+_n.endSN+"] ":""}${this.logPrefix==="[stream-controller]"?"level":"track"}: ${i.level}, target: ${parseFloat(_.toFixed(3))}`),isFiniteNumber(i.sn)&&!this.bitrateTest&&(this.nextLoadPosition=i.start+i.duration),this.state=State.FRAG_LOADING;const _s=this.config.progressive;let ga;return _s&&_i?ga=_i.then(ba=>!ba||this.fragContextChanged(ba==null?void 0:ba.frag)?null:this.fragmentLoader.load(i,j)).catch(ba=>this.handleFragLoadError(ba)):ga=Promise.all([this.fragmentLoader.load(i,_s?j:void 0),_i]).then(([ba])=>(!_s&&ba&&j&&j(ba),ba)).catch(ba=>this.handleFragLoadError(ba)),this.hls.trigger(Events.FRAG_LOADING,{frag:i,targetBufferTime:_}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):ga}doFragPartsLoad(i,g,_,j){return new Promise(($,_n)=>{var _i;const _s=[],ga=(_i=_.details)==null?void 0:_i.partList,ba=xa=>{this.fragmentLoader.loadPart(i,xa,j).then(El=>{_s[xa.index]=El;const Tl=El.part;this.hls.trigger(Events.FRAG_LOADED,El);const Sl=getPartWith(_,i.sn,xa.index+1)||findPart(ga,i.sn,xa.index+1);if(Sl)ba(Sl);else return $({frag:i,part:Tl,partsLoaded:_s})}).catch(_n)};ba(g)})}handleFragLoadError(i){if("data"in i){const g=i.data;i.data&&g.details===ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(g.frag,g.part):this.hls.trigger(Events.ERROR,g)}else this.hls.trigger(Events.ERROR,{type:ErrorTypes.OTHER_ERROR,details:ErrorDetails.INTERNAL_EXCEPTION,err:i,error:i,fatal:!0});return null}_handleTransmuxerFlush(i){const g=this.getCurrentContext(i);if(!g||this.state!==State.PARSING){!this.fragCurrent&&this.state!==State.STOPPED&&this.state!==State.ERROR&&(this.state=State.IDLE);return}const{frag:_,part:j,level:$}=g,_n=self.performance.now();_.stats.parsing.end=_n,j&&(j.stats.parsing.end=_n),this.updateLevelTiming(_,j,$,i.partial)}getCurrentContext(i){const{levels:g,fragCurrent:_}=this,{level:j,sn:$,part:_n}=i;if(!(g!=null&&g[j]))return this.warn(`Levels object was unset while buffering fragment ${$} of level ${j}. The current chunk will not be buffered.`),null;const _i=g[j],_s=_n>-1?getPartWith(_i,$,_n):null,ga=_s?_s.fragment:getFragmentWithSN(_i,$,_);return ga?(_&&_!==ga&&(ga.stats=_.stats),{frag:ga,part:_s,level:_i}):null}bufferFragmentData(i,g,_,j){var $;if(!i||this.state!==State.PARSING)return;const{data1:_n,data2:_i}=i;let _s=_n;if(_n&&_i&&(_s=appendUint8Array(_n,_i)),!(($=_s)!=null&&$.length))return;const ga={type:i.type,frag:g,part:_,chunkMeta:j,parent:g.type,data:_s};this.hls.trigger(Events.BUFFER_APPENDING,ga),i.dropped&&i.independent&&!_&&this.flushBufferGap(g)}flushBufferGap(i){const g=this.media;if(!g)return;if(!BufferHelper.isBuffered(g,g.currentTime)){this.flushMainBuffer(0,i.start);return}const _=g.currentTime,j=BufferHelper.bufferInfo(g,_,0),$=i.duration,_n=Math.min(this.config.maxFragLookUpTolerance*2,$*.25),_i=Math.max(Math.min(i.start-_n,j.end-_n),_+_n);i.start-_i>_n&&this.flushMainBuffer(_i,i.start)}getFwdBufferInfo(i,g){const _=this.getLoadPosition();return isFiniteNumber(_)?this.getFwdBufferInfoAtPos(i,_,g):null}getFwdBufferInfoAtPos(i,g,_){const{config:{maxBufferHole:j}}=this,$=BufferHelper.bufferInfo(i,g,j);if($.len===0&&$.nextStart!==void 0){const _n=this.fragmentTracker.getBufferedFrag(g,_);if(_n&&$.nextStart<_n.end)return BufferHelper.bufferInfo(i,g,Math.max($.nextStart,j))}return $}getMaxBufferLength(i){const{config:g}=this;let _;return i?_=Math.max(8*g.maxBufferSize/i,g.maxBufferLength):_=g.maxBufferLength,Math.min(_,g.maxMaxBufferLength)}reduceMaxBufferLength(i){const g=this.config,_=i||g.maxBufferLength;return g.maxMaxBufferLength>=_?(g.maxMaxBufferLength/=2,this.warn(`Reduce max buffer length to ${g.maxMaxBufferLength}s`),!0):!1}getAppendedFrag(i,g=PlaylistLevelType.MAIN){const _=this.fragmentTracker.getAppendedFrag(i,PlaylistLevelType.MAIN);return _&&"fragment"in _?_.fragment:_}getNextFragment(i,g){const _=g.fragments,j=_.length;if(!j)return null;const{config:$}=this,_n=_[0].start;let _i;if(g.live){const _s=$.initialLiveManifestSize;if(j<_s)return this.warn(`Not enough fragments to start playback (have: ${j}, need: ${_s})`),null;!g.PTSKnown&&!this.startFragRequested&&this.startPosition===-1&&(_i=this.getInitialLiveFragment(g,_),this.startPosition=_i?this.hls.liveSyncPosition||_i.start:i)}else i<=_n&&(_i=_[0]);if(!_i){const _s=$.lowLatencyMode?g.partEnd:g.fragmentEnd;_i=this.getFragmentAtPosition(i,_s,g)}return this.mapToInitFragWhenRequired(_i)}isLoopLoading(i,g){const _=this.fragmentTracker.getState(i);return(_===FragmentState.OK||_===FragmentState.PARTIAL&&!!i.gap)&&this.nextLoadPosition>g}getNextFragmentLoopLoading(i,g,_,j,$){const _n=i.gap,_i=this.getNextFragment(this.nextLoadPosition,g);if(_i===null)return _i;if(i=_i,_n&&i&&!i.gap&&_.nextStart){const _s=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,_.nextStart,j);if(_s!==null&&_.len+_s.len>=$)return this.log(`buffer full after gaps in "${j}" playlist starting at sn: ${i.sn}`),null}return i}mapToInitFragWhenRequired(i){return i!=null&&i.initSegment&&!(i!=null&&i.initSegment.data)&&!this.bitrateTest?i.initSegment:i}getNextPart(i,g,_){let j=-1,$=!1,_n=!0;for(let _i=0,_s=i.length;_i<_s;_i++){const ga=i[_i];if(_n=_n&&!ga.independent,j>-1&&_<ga.start)break;const ba=ga.loaded;ba?j=-1:($||ga.independent||_n)&&ga.fragment===g&&(j=_i),$=ba}return j}loadedEndOfParts(i,g){const _=i[i.length-1];return _&&g>_.start&&_.loaded}getInitialLiveFragment(i,g){const _=this.fragPrevious;let j=null;if(_){if(i.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${_.programDateTime}`),j=findFragmentByPDT(g,_.endProgramDateTime,this.config.maxFragLookUpTolerance)),!j){const $=_.sn+1;if($>=i.startSN&&$<=i.endSN){const _n=g[$-i.startSN];_.cc===_n.cc&&(j=_n,this.log(`Live playlist, switching playlist, load frag with next SN: ${j.sn}`))}j||(j=findFragWithCC(g,_.cc),j&&this.log(`Live playlist, switching playlist, load frag with same CC: ${j.sn}`))}}else{const $=this.hls.liveSyncPosition;$!==null&&(j=this.getFragmentAtPosition($,this.bitrateTest?i.fragmentEnd:i.edge,i))}return j}getFragmentAtPosition(i,g,_){const{config:j}=this;let{fragPrevious:$}=this,{fragments:_n,endSN:_i}=_;const{fragmentHint:_s}=_,ga=j.maxFragLookUpTolerance,ba=_.partList,xa=!!(j.lowLatencyMode&&ba!=null&&ba.length&&_s);xa&&_s&&!this.bitrateTest&&(_n=_n.concat(_s),_i=_s.sn);let El;if(i<g){const Tl=i>g-ga?0:ga;El=findFragmentByPTS($,_n,i,Tl)}else El=_n[_n.length-1];if(El){const Tl=El.sn-_.startSN,Sl=this.fragmentTracker.getState(El);if((Sl===FragmentState.OK||Sl===FragmentState.PARTIAL&&El.gap)&&($=El),$&&El.sn===$.sn&&(!xa||ba[0].fragment.sn>El.sn)&&$&&El.level===$.level){const Cl=_n[Tl+1];El.sn<_i&&this.fragmentTracker.getState(Cl)!==FragmentState.OK?El=Cl:El=null}}return El}synchronizeToLiveEdge(i){const{config:g,media:_}=this;if(!_)return;const j=this.hls.liveSyncPosition,$=_.currentTime,_n=i.fragments[0].start,_i=i.edge,_s=$>=_n-g.maxFragLookUpTolerance&&$<=_i;if(j!==null&&_.duration>j&&($<j||!_s)){const ga=g.liveMaxLatencyDuration!==void 0?g.liveMaxLatencyDuration:g.liveMaxLatencyDurationCount*i.targetduration;(!_s&&_.readyState<4||$<_i-ga)&&(this.loadedmetadata||(this.nextLoadPosition=j),_.readyState&&(this.warn(`Playback: ${$.toFixed(3)} is located too far from the end of live sliding playlist: ${_i}, reset currentTime to : ${j.toFixed(3)}`),_.currentTime=j))}}alignPlaylists(i,g){const{levels:_,levelLastLoaded:j,fragPrevious:$}=this,_n=j!==null?_[j]:null,_i=i.fragments.length;if(!_i)return this.warn("No fragments in live playlist"),0;const _s=i.fragments[0].start,ga=!g,ba=i.alignedSliding&&isFiniteNumber(_s);if(ga||!ba&&!_s){alignStream($,_n,i);const xa=i.fragments[0].start;return this.log(`Live playlist sliding: ${xa.toFixed(2)} start-sn: ${g?g.startSN:"na"}->${i.startSN} prev-sn: ${$?$.sn:"na"} fragments: ${_i}`),xa}return _s}waitForCdnTuneIn(i){return i.live&&i.canBlockReload&&i.partTarget&&i.tuneInGoal>Math.max(i.partHoldBack,i.partTarget*3)}setStartPosition(i,g){let _=this.startPosition;if(_<g&&(_=-1),_===-1||this.lastCurrentTime===-1){const j=this.startTimeOffset!==null,$=j?this.startTimeOffset:i.startTimeOffset;$!==null&&isFiniteNumber($)?(_=g+$,$<0&&(_+=i.totalduration),_=Math.min(Math.max(g,_),g+i.totalduration),this.log(`Start time offset ${$} found in ${j?"multivariant":"media"} playlist, adjust startPosition to ${_}`),this.startPosition=_):i.live?_=this.hls.liveSyncPosition||g:this.startPosition=_=0,this.lastCurrentTime=_}this.nextLoadPosition=_}getLoadPosition(){const{media:i}=this;let g=0;return this.loadedmetadata&&i?g=i.currentTime:this.nextLoadPosition&&(g=this.nextLoadPosition),g}handleFragLoadAborted(i,g){this.transmuxer&&i.sn!=="initSegment"&&i.stats.aborted&&(this.warn(`Fragment ${i.sn}${g?" part "+g.index:""} of level ${i.level} was aborted`),this.resetFragmentLoading(i))}resetFragmentLoading(i){(!this.fragCurrent||!this.fragContextChanged(i)&&this.state!==State.FRAG_LOADING_WAITING_RETRY)&&(this.state=State.IDLE)}onFragmentOrKeyLoadError(i,g){if(g.chunkMeta&&!g.frag){const ba=this.getCurrentContext(g.chunkMeta);ba&&(g.frag=ba.frag)}const _=g.frag;if(!_||_.type!==i||!this.levels)return;if(this.fragContextChanged(_)){var j;this.warn(`Frag load error must match current frag to retry ${_.url} > ${(j=this.fragCurrent)==null?void 0:j.url}`);return}const $=g.details===ErrorDetails.FRAG_GAP;$&&this.fragmentTracker.fragBuffered(_,!0);const _n=g.errorAction,{action:_i,retryCount:_s=0,retryConfig:ga}=_n||{};if(_n&&_i===NetworkErrorAction.RetryRequest&&ga){this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition);const ba=getRetryDelay(ga,_s);this.warn(`Fragment ${_.sn} of ${i} ${_.level} errored with ${g.details}, retrying loading ${_s+1}/${ga.maxNumRetry} in ${ba}ms`),_n.resolved=!0,this.retryDate=self.performance.now()+ba,this.state=State.FRAG_LOADING_WAITING_RETRY}else ga&&_n?(this.resetFragmentErrors(i),_s<ga.maxNumRetry?$||(_n.resolved=!0):logger.warn(`${g.details} reached or exceeded max retry (${_s})`)):this.state=State.ERROR;this.tickImmediate()}reduceLengthAndFlushBuffer(i){if(this.state===State.PARSING||this.state===State.PARSED){const g=i.parent,_=this.getFwdBufferInfo(this.mediaBuffer,g),j=_&&_.len>.5;j&&this.reduceMaxBufferLength(_.len);const $=!j;return $&&this.warn(`Buffer full error while media.currentTime is not buffered, flush ${g} buffer`),i.frag&&(this.fragmentTracker.removeFragment(i.frag),this.nextLoadPosition=i.frag.start),this.resetLoadingState(),$}return!1}resetFragmentErrors(i){i===PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.loadedmetadata||(this.startFragRequested=!1),this.state!==State.STOPPED&&(this.state=State.IDLE)}afterBufferFlushed(i,g,_){if(!i)return;const j=BufferHelper.getBuffered(i);this.fragmentTracker.detectEvictedFragments(g,j,_),this.state===State.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state=State.IDLE}resetStartWhenNotLoaded(i){if(!this.loadedmetadata){this.startFragRequested=!1;const g=this.levels?this.levels[i].details:null;g!=null&&g.live?(this.startPosition=-1,this.setStartPosition(g,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(i){this.warn(`The loading context changed while buffering fragment ${i.sn} of level ${i.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(i.level),this.resetLoadingState()}removeUnbufferedFrags(i=0){this.fragmentTracker.removeFragmentsInRange(i,1/0,this.playlistType,!1,!0)}updateLevelTiming(i,g,_,j){var $;const _n=_.details;if(!_n){this.warn("level.details undefined");return}if(Object.keys(i.elementaryStreams).reduce((_s,ga)=>{const ba=i.elementaryStreams[ga];if(ba){const xa=ba.endPTS-ba.startPTS;if(xa<=0)return this.warn(`Could not parse fragment ${i.sn} ${ga} duration reliably (${xa})`),_s||!1;const El=j?0:updateFragPTSDTS(_n,i,ba.startPTS,ba.endPTS,ba.startDTS,ba.endDTS);return this.hls.trigger(Events.LEVEL_PTS_UPDATED,{details:_n,level:_,drift:El,type:ga,frag:i,start:ba.startPTS,end:ba.endPTS}),!0}return _s},!1))_.fragmentError=0;else if((($=this.transmuxer)==null?void 0:$.error)===null){const _s=new Error(`Found no media in fragment ${i.sn} of level ${_.id} resetting transmuxer to fallback to playlist timing`);if(this.warn(_s.message),this.hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,error:_s,frag:i,reason:`Found no media in msn ${i.sn} of level "${_.url}"`}),!this.hls)return;this.resetTransmuxer()}this.state=State.PARSED,this.hls.trigger(Events.FRAG_PARSED,{frag:i,part:g})}resetTransmuxer(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)}recoverWorkerError(i){i.event==="demuxerWorker"&&(this.resetTransmuxer(),this.resetLoadingState())}set state(i){const g=this._state;g!==i&&(this._state=i,this.log(`${g}->${i}`))}get state(){return this._state}}function getSourceBuffer(){return self.SourceBuffer||self.WebKitSourceBuffer}function isSupported(){const h=getMediaSource();if(!h)return!1;const i=getSourceBuffer(),g=h&&typeof h.isTypeSupported=="function"&&h.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),_=!i||i.prototype&&typeof i.prototype.appendBuffer=="function"&&typeof i.prototype.remove=="function";return!!g&&!!_}function changeTypeSupported(){var h;const i=getSourceBuffer();return typeof(i==null||(h=i.prototype)==null?void 0:h.changeType)=="function"}function hasUMDWorker(){return typeof __HLS_WORKER_BUNDLE__=="function"}function injectWorker(){const h=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),i=self.URL.createObjectURL(h);return{worker:new self.Worker(i),objectURL:i}}function loadWorker(h){const i=new self.URL(h,self.location.href).href;return{worker:new self.Worker(i),scriptURL:i}}function dummyTrack(h="",i=9e4){return{type:h,id:-1,pid:-1,inputTimeScale:i,sequenceNumber:-1,samples:[],dropped:0}}class BaseAudioDemuxer{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(i,g,_,j){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(i){this.initPTS=i,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(i,g){return!1}appendFrame(i,g,_){}demux(i,g){this.cachedData&&(i=appendUint8Array(this.cachedData,i),this.cachedData=null);let _=getID3Data(i,0),j=_?_.length:0,$;const _n=this._audioTrack,_i=this._id3Track,_s=_?getTimeStamp(_):void 0,ga=i.length;for((this.basePTS===null||this.frameIndex===0&&isFiniteNumber(_s))&&(this.basePTS=initPTSFn(_s,g,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),_&&_.length>0&&_i.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:_,type:MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY});j<ga;){if(this.canParse(i,j)){const ba=this.appendFrame(_n,i,j);ba?(this.frameIndex++,this.lastPTS=ba.sample.pts,j+=ba.length,$=j):j=ga}else canParse$2(i,j)?(_=getID3Data(i,j),_i.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:_,type:MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY}),j+=_.length,$=j):j++;if(j===ga&&$!==ga){const ba=sliceUint8(i,$);this.cachedData?this.cachedData=appendUint8Array(this.cachedData,ba):this.cachedData=ba}}return{audioTrack:_n,videoTrack:dummyTrack(),id3Track:_i,textTrack:dummyTrack()}}demuxSampleAes(i,g,_){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(i){const g=this.cachedData;return g&&(this.cachedData=null,this.demux(g,0)),{audioTrack:this._audioTrack,videoTrack:dummyTrack(),id3Track:this._id3Track,textTrack:dummyTrack()}}destroy(){}}const initPTSFn=(h,i,g)=>{if(isFiniteNumber(h))return h*90;const _=g?g.baseTime*9e4/g.timescale:0;return i*9e4+_};function getAudioConfig(h,i,g,_){let j,$,_n,_i;const _s=navigator.userAgent.toLowerCase(),ga=_,ba=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];j=((i[g+2]&192)>>>6)+1;const xa=(i[g+2]&60)>>>2;if(xa>ba.length-1){h.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:`invalid ADTS sampling index:${xa}`});return}return _n=(i[g+2]&1)<<2,_n|=(i[g+3]&192)>>>6,logger.log(`manifest codec:${_}, ADTS type:${j}, samplingIndex:${xa}`),/firefox/i.test(_s)?xa>=6?(j=5,_i=new Array(4),$=xa-3):(j=2,_i=new Array(2),$=xa):_s.indexOf("android")!==-1?(j=2,_i=new Array(2),$=xa):(j=5,_i=new Array(4),_&&(_.indexOf("mp4a.40.29")!==-1||_.indexOf("mp4a.40.5")!==-1)||!_&&xa>=6?$=xa-3:((_&&_.indexOf("mp4a.40.2")!==-1&&(xa>=6&&_n===1||/vivaldi/i.test(_s))||!_&&_n===1)&&(j=2,_i=new Array(2)),$=xa)),_i[0]=j<<3,_i[0]|=(xa&14)>>1,_i[1]|=(xa&1)<<7,_i[1]|=_n<<3,j===5&&(_i[1]|=($&14)>>1,_i[2]=($&1)<<7,_i[2]|=2<<2,_i[3]=0),{config:_i,samplerate:ba[xa],channelCount:_n,codec:"mp4a.40."+j,manifestCodec:ga}}function isHeaderPattern$1(h,i){return h[i]===255&&(h[i+1]&246)===240}function getHeaderLength(h,i){return h[i+1]&1?7:9}function getFullFrameLength(h,i){return(h[i+3]&3)<<11|h[i+4]<<3|(h[i+5]&224)>>>5}function canGetFrameLength(h,i){return i+5<h.length}function isHeader$1(h,i){return i+1<h.length&&isHeaderPattern$1(h,i)}function canParse$1(h,i){return canGetFrameLength(h,i)&&isHeaderPattern$1(h,i)&&getFullFrameLength(h,i)<=h.length-i}function probe$1(h,i){if(isHeader$1(h,i)){const g=getHeaderLength(h,i);if(i+g>=h.length)return!1;const _=getFullFrameLength(h,i);if(_<=g)return!1;const j=i+_;return j===h.length||isHeader$1(h,j)}return!1}function initTrackConfig(h,i,g,_,j){if(!h.samplerate){const $=getAudioConfig(i,g,_,j);if(!$)return;h.config=$.config,h.samplerate=$.samplerate,h.channelCount=$.channelCount,h.codec=$.codec,h.manifestCodec=$.manifestCodec,logger.log(`parsed codec:${h.codec}, rate:${$.samplerate}, channels:${$.channelCount}`)}}function getFrameDuration(h){return 1024*9e4/h}function parseFrameHeader(h,i){const g=getHeaderLength(h,i);if(i+g<=h.length){const _=getFullFrameLength(h,i)-g;if(_>0)return{headerLength:g,frameLength:_}}}function appendFrame$1(h,i,g,_,j){const $=getFrameDuration(h.samplerate),_n=_+j*$,_i=parseFrameHeader(i,g);let _s;if(_i){const{frameLength:xa,headerLength:El}=_i,Tl=El+xa,Sl=Math.max(0,g+Tl-i.length);Sl?(_s=new Uint8Array(Tl-El),_s.set(i.subarray(g+El,i.length),0)):_s=i.subarray(g+El,g+Tl);const Il={unit:_s,pts:_n};return Sl||h.samples.push(Il),{sample:Il,length:Tl,missing:Sl}}const ga=i.length-g;return _s=new Uint8Array(ga),_s.set(i.subarray(g,i.length),0),{sample:{unit:_s,pts:_n},length:ga,missing:-1}}class AACDemuxer extends BaseAudioDemuxer{constructor(i,g){super(),this.observer=void 0,this.config=void 0,this.observer=i,this.config=g}resetInitSegment(i,g,_,j){super.resetInitSegment(i,g,_,j),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:g,duration:j,inputTimeScale:9e4,dropped:0}}static probe(i){if(!i)return!1;let _=(getID3Data(i,0)||[]).length;for(let j=i.length;_<j;_++)if(probe$1(i,_))return logger.log("ADTS sync word found !"),!0;return!1}canParse(i,g){return canParse$1(i,g)}appendFrame(i,g,_){initTrackConfig(i,this.observer,g,_,i.manifestCodec);const j=appendFrame$1(i,g,_,this.basePTS,this.frameIndex);if(j&&j.missing===0)return j}}const emsgSchemePattern=/\/emsg[-/]ID3/i;class MP4Demuxer{constructor(i,g){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=g}resetTimeStamp(){}resetInitSegment(i,g,_,j){const $=this.videoTrack=dummyTrack("video",1),_n=this.audioTrack=dummyTrack("audio",1),_i=this.txtTrack=dummyTrack("text",1);if(this.id3Track=dummyTrack("id3",1),this.timeOffset=0,!(i!=null&&i.byteLength))return;const _s=parseInitSegment(i);if(_s.video){const{id:ga,timescale:ba,codec:xa}=_s.video;$.id=ga,$.timescale=_i.timescale=ba,$.codec=xa}if(_s.audio){const{id:ga,timescale:ba,codec:xa}=_s.audio;_n.id=ga,_n.timescale=ba,_n.codec=xa}_i.id=RemuxerTrackIdConfig.text,$.sampleDuration=0,$.duration=_n.duration=j}resetContiguity(){this.remainderData=null}static probe(i){return i=i.length>16384?i.subarray(0,16384):i,findBox(i,["moof"]).length>0}demux(i,g){this.timeOffset=g;let _=i;const j=this.videoTrack,$=this.txtTrack;if(this.config.progressive){this.remainderData&&(_=appendUint8Array(this.remainderData,i));const _i=segmentValidRange(_);this.remainderData=_i.remainder,j.samples=_i.valid||new Uint8Array}else j.samples=_;const _n=this.extractID3Track(j,g);return $.samples=parseSamples(g,j),{videoTrack:j,audioTrack:this.audioTrack,id3Track:_n,textTrack:this.txtTrack}}flush(){const i=this.timeOffset,g=this.videoTrack,_=this.txtTrack;g.samples=this.remainderData||new Uint8Array,this.remainderData=null;const j=this.extractID3Track(g,this.timeOffset);return _.samples=parseSamples(i,g),{videoTrack:g,audioTrack:dummyTrack(),id3Track:j,textTrack:dummyTrack()}}extractID3Track(i,g){const _=this.id3Track;if(i.samples.length){const j=findBox(i.samples,["emsg"]);j&&j.forEach($=>{const _n=parseEmsg($);if(emsgSchemePattern.test(_n.schemeIdUri)){const _i=isFiniteNumber(_n.presentationTime)?_n.presentationTime/_n.timeScale:g+_n.presentationTimeDelta/_n.timeScale;let _s=_n.eventDuration===4294967295?Number.POSITIVE_INFINITY:_n.eventDuration/_n.timeScale;_s<=.001&&(_s=Number.POSITIVE_INFINITY);const ga=_n.payload;_.samples.push({data:ga,len:ga.byteLength,dts:_i,pts:_i,type:MetadataSchema.emsg,duration:_s})}})}return _}demuxSampleAes(i,g,_){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){}}let chromeVersion$1=null;const BitratesMap=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],SamplingRateMap=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],SamplesCoefficients=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],BytesInSlot=[0,1,1,4];function appendFrame(h,i,g,_,j){if(g+24>i.length)return;const $=parseHeader(i,g);if($&&g+$.frameLength<=i.length){const _n=$.samplesPerFrame*9e4/$.sampleRate,_i=_+j*_n,_s={unit:i.subarray(g,g+$.frameLength),pts:_i,dts:_i};return h.config=[],h.channelCount=$.channelCount,h.samplerate=$.sampleRate,h.samples.push(_s),{sample:_s,length:$.frameLength,missing:0}}}function parseHeader(h,i){const g=h[i+1]>>3&3,_=h[i+1]>>1&3,j=h[i+2]>>4&15,$=h[i+2]>>2&3;if(g!==1&&j!==0&&j!==15&&$!==3){const _n=h[i+2]>>1&1,_i=h[i+3]>>6,_s=g===3?3-_:_===3?3:4,ga=BitratesMap[_s*14+j-1]*1e3,xa=SamplingRateMap[(g===3?0:g===2?1:2)*3+$],El=_i===3?1:2,Tl=SamplesCoefficients[g][_],Sl=BytesInSlot[_],Il=Tl*8*Sl,Cl=Math.floor(Tl*ga/xa+_n)*Sl;if(chromeVersion$1===null){const Ul=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);chromeVersion$1=Ul?parseInt(Ul[1]):0}return!!chromeVersion$1&&chromeVersion$1<=87&&_===2&&ga>=224e3&&_i===0&&(h[i+3]=h[i+3]|128),{sampleRate:xa,channelCount:El,frameLength:Cl,samplesPerFrame:Il}}}function isHeaderPattern(h,i){return h[i]===255&&(h[i+1]&224)===224&&(h[i+1]&6)!==0}function isHeader(h,i){return i+1<h.length&&isHeaderPattern(h,i)}function canParse(h,i){return isHeaderPattern(h,i)&&4<=h.length-i}function probe(h,i){if(i+1<h.length&&isHeaderPattern(h,i)){const _=parseHeader(h,i);let j=4;_!=null&&_.frameLength&&(j=_.frameLength);const $=i+j;return $===h.length||isHeader(h,$)}return!1}class ExpGolomb{constructor(i){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=i,this.bytesAvailable=i.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const i=this.data,g=this.bytesAvailable,_=i.byteLength-g,j=new Uint8Array(4),$=Math.min(4,g);if($===0)throw new Error("no bytes available");j.set(i.subarray(_,_+$)),this.word=new DataView(j.buffer).getUint32(0),this.bitsAvailable=$*8,this.bytesAvailable-=$}skipBits(i){let g;i=Math.min(i,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>i?(this.word<<=i,this.bitsAvailable-=i):(i-=this.bitsAvailable,g=i>>3,i-=g<<3,this.bytesAvailable-=g,this.loadWord(),this.word<<=i,this.bitsAvailable-=i)}readBits(i){let g=Math.min(this.bitsAvailable,i);const _=this.word>>>32-g;if(i>32&&logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=g,this.bitsAvailable>0)this.word<<=g;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return g=i-g,g>0&&this.bitsAvailable?_<<g|this.readBits(g):_}skipLZ(){let i;for(i=0;i<this.bitsAvailable;++i)if(this.word&2147483648>>>i)return this.word<<=i,this.bitsAvailable-=i,i;return this.loadWord(),i+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const i=this.skipLZ();return this.readBits(i+1)-1}readEG(){const i=this.readUEG();return 1&i?1+i>>>1:-1*(i>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}skipScalingList(i){let g=8,_=8,j;for(let $=0;$<i;$++)_!==0&&(j=this.readEG(),_=(g+j+256)%256),g=_===0?g:_}readSPS(){let i=0,g=0,_=0,j=0,$,_n,_i;const _s=this.readUByte.bind(this),ga=this.readBits.bind(this),ba=this.readUEG.bind(this),xa=this.readBoolean.bind(this),El=this.skipBits.bind(this),Tl=this.skipEG.bind(this),Sl=this.skipUEG.bind(this),Il=this.skipScalingList.bind(this);_s();const Cl=_s();if(ga(5),El(3),_s(),Sl(),Cl===100||Cl===110||Cl===122||Cl===244||Cl===44||Cl===83||Cl===86||Cl===118||Cl===128){const Ep=ba();if(Ep===3&&El(1),Sl(),Sl(),El(1),xa())for(_n=Ep!==3?8:12,_i=0;_i<_n;_i++)xa()&&(_i<6?Il(16):Il(64))}Sl();const Nl=ba();if(Nl===0)ba();else if(Nl===1)for(El(1),Tl(),Tl(),$=ba(),_i=0;_i<$;_i++)Tl();Sl(),El(1);const Dl=ba(),Ul=ba(),Kl=ga(1);Kl===0&&El(1),El(1),xa()&&(i=ba(),g=ba(),_=ba(),j=ba());let Jl=[1,1];if(xa()&&xa())switch(_s()){case 1:Jl=[1,1];break;case 2:Jl=[12,11];break;case 3:Jl=[10,11];break;case 4:Jl=[16,11];break;case 5:Jl=[40,33];break;case 6:Jl=[24,11];break;case 7:Jl=[20,11];break;case 8:Jl=[32,11];break;case 9:Jl=[80,33];break;case 10:Jl=[18,11];break;case 11:Jl=[15,11];break;case 12:Jl=[64,33];break;case 13:Jl=[160,99];break;case 14:Jl=[4,3];break;case 15:Jl=[3,2];break;case 16:Jl=[2,1];break;case 255:{Jl=[_s()<<8|_s(),_s()<<8|_s()];break}}return{width:Math.ceil((Dl+1)*16-i*2-g*2),height:(2-Kl)*(Ul+1)*16-(Kl?2:4)*(_+j),pixelRatio:Jl}}readSliceType(){return this.readUByte(),this.readUEG(),this.readUEG()}}class SampleAesDecrypter{constructor(i,g,_){this.keyData=void 0,this.decrypter=void 0,this.keyData=_,this.decrypter=new Decrypter(g,{removePKCS7Padding:!1})}decryptBuffer(i){return this.decrypter.decrypt(i,this.keyData.key.buffer,this.keyData.iv.buffer)}decryptAacSample(i,g,_){const j=i[g].unit;if(j.length<=16)return;const $=j.subarray(16,j.length-j.length%16),_n=$.buffer.slice($.byteOffset,$.byteOffset+$.length);this.decryptBuffer(_n).then(_i=>{const _s=new Uint8Array(_i);j.set(_s,16),this.decrypter.isSync()||this.decryptAacSamples(i,g+1,_)})}decryptAacSamples(i,g,_){for(;;g++){if(g>=i.length){_();return}if(!(i[g].unit.length<32)&&(this.decryptAacSample(i,g,_),!this.decrypter.isSync()))return}}getAvcEncryptedData(i){const g=Math.floor((i.length-48)/160)*16+16,_=new Int8Array(g);let j=0;for(let $=32;$<i.length-16;$+=160,j+=16)_.set(i.subarray($,$+16),j);return _}getAvcDecryptedUnit(i,g){const _=new Uint8Array(g);let j=0;for(let $=32;$<i.length-16;$+=160,j+=16)i.set(_.subarray(j,j+16),$);return i}decryptAvcSample(i,g,_,j,$){const _n=discardEPB($.data),_i=this.getAvcEncryptedData(_n);this.decryptBuffer(_i.buffer).then(_s=>{$.data=this.getAvcDecryptedUnit(_n,_s),this.decrypter.isSync()||this.decryptAvcSamples(i,g,_+1,j)})}decryptAvcSamples(i,g,_,j){if(i instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;g++,_=0){if(g>=i.length){j();return}const $=i[g].units;for(;!(_>=$.length);_++){const _n=$[_];if(!(_n.data.length<=48||_n.type!==1&&_n.type!==5)&&(this.decryptAvcSample(i,g,_,j,_n),!this.decrypter.isSync()))return}}}}const PACKET_LENGTH=188;class TSDemuxer{constructor(i,g,_){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=i,this.config=g,this.typeSupported=_}static probe(i){const g=TSDemuxer.syncOffset(i);return g>0&&logger.warn(`MPEG2-TS detected but first sync word found @ offset ${g}`),g!==-1}static syncOffset(i){const g=i.length;let _=Math.min(PACKET_LENGTH*5,i.length-PACKET_LENGTH)+1,j=0;for(;j<_;){let $=!1,_n=-1,_i=0;for(let _s=j;_s<g;_s+=PACKET_LENGTH)if(i[_s]===71){if(_i++,_n===-1&&(_n=_s,_n!==0&&(_=Math.min(_n+PACKET_LENGTH*99,i.length-PACKET_LENGTH)+1)),$||($=parsePID(i,_s)===0),$&&_i>1&&(_n===0&&_i>2||_s+PACKET_LENGTH>_))return _n}else{if(_i)return-1;break}j++}return-1}static createTrack(i,g){return{container:i==="video"||i==="audio"?"video/mp2t":void 0,type:i,id:RemuxerTrackIdConfig[i],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:i==="audio"?g:void 0}}resetInitSegment(i,g,_,j){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=TSDemuxer.createTrack("video"),this._audioTrack=TSDemuxer.createTrack("audio",j),this._id3Track=TSDemuxer.createTrack("id3"),this._txtTrack=TSDemuxer.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.audioCodec=g,this.videoCodec=_,this._duration=j}resetTimeStamp(){}resetContiguity(){const{_audioTrack:i,_avcTrack:g,_id3Track:_}=this;i&&(i.pesData=null),g&&(g.pesData=null),_&&(_.pesData=null),this.aacOverFlow=null,this.avcSample=null,this.remainderData=null}demux(i,g,_=!1,j=!1){_||(this.sampleAes=null);let $;const _n=this._avcTrack,_i=this._audioTrack,_s=this._id3Track,ga=this._txtTrack;let ba=_n.pid,xa=_n.pesData,El=_i.pid,Tl=_s.pid,Sl=_i.pesData,Il=_s.pesData,Cl=null,Nl=this.pmtParsed,Dl=this._pmtId,Ul=i.length;if(this.remainderData&&(i=appendUint8Array(this.remainderData,i),Ul=i.length,this.remainderData=null),Ul<PACKET_LENGTH&&!j)return this.remainderData=i,{audioTrack:_i,videoTrack:_n,id3Track:_s,textTrack:ga};const Kl=Math.max(0,TSDemuxer.syncOffset(i));Ul-=(Ul-Kl)%PACKET_LENGTH,Ul<i.byteLength&&!j&&(this.remainderData=new Uint8Array(i.buffer,Ul,i.buffer.byteLength-Ul));let Jl=0;for(let _p=Kl;_p<Ul;_p+=PACKET_LENGTH)if(i[_p]===71){const Ip=!!(i[_p+1]&64),Up=parsePID(i,_p),yp=(i[_p+3]&48)>>4;let Ap;if(yp>1){if(Ap=_p+5+i[_p+4],Ap===_p+PACKET_LENGTH)continue}else Ap=_p+4;switch(Up){case ba:Ip&&(xa&&($=parsePES(xa))&&this.parseAVCPES(_n,ga,$,!1),xa={data:[],size:0}),xa&&(xa.data.push(i.subarray(Ap,_p+PACKET_LENGTH)),xa.size+=_p+PACKET_LENGTH-Ap);break;case El:if(Ip){if(Sl&&($=parsePES(Sl)))switch(_i.segmentCodec){case"aac":this.parseAACPES(_i,$);break;case"mp3":this.parseMPEGPES(_i,$);break}Sl={data:[],size:0}}Sl&&(Sl.data.push(i.subarray(Ap,_p+PACKET_LENGTH)),Sl.size+=_p+PACKET_LENGTH-Ap);break;case Tl:Ip&&(Il&&($=parsePES(Il))&&this.parseID3PES(_s,$),Il={data:[],size:0}),Il&&(Il.data.push(i.subarray(Ap,_p+PACKET_LENGTH)),Il.size+=_p+PACKET_LENGTH-Ap);break;case 0:Ip&&(Ap+=i[Ap]+1),Dl=this._pmtId=parsePAT(i,Ap);break;case Dl:{Ip&&(Ap+=i[Ap]+1);const Cp=parsePMT(i,Ap,this.typeSupported,_);ba=Cp.avc,ba>0&&(_n.pid=ba),El=Cp.audio,El>0&&(_i.pid=El,_i.segmentCodec=Cp.segmentCodec),Tl=Cp.id3,Tl>0&&(_s.pid=Tl),Cl!==null&&!Nl&&(logger.warn(`MPEG-TS PMT found at ${_p} after unknown PID '${Cl}'. Backtracking to sync byte @${Kl} to parse all TS packets.`),Cl=null,_p=Kl-188),Nl=this.pmtParsed=!0;break}case 17:case 8191:break;default:Cl=Up;break}}else Jl++;if(Jl>0){const _p=new Error(`Found ${Jl} TS packet/s that do not start with 0x47`);this.observer.emit(Events.ERROR,Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,error:_p,reason:_p.message})}_n.pesData=xa,_i.pesData=Sl,_s.pesData=Il;const Ep={audioTrack:_i,videoTrack:_n,id3Track:_s,textTrack:ga};return j&&this.extractRemainingSamples(Ep),Ep}flush(){const{remainderData:i}=this;this.remainderData=null;let g;return i?g=this.demux(i,-1,!1,!0):g={videoTrack:this._avcTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(g),this.sampleAes?this.decrypt(g,this.sampleAes):g}extractRemainingSamples(i){const{audioTrack:g,videoTrack:_,id3Track:j,textTrack:$}=i,_n=_.pesData,_i=g.pesData,_s=j.pesData;let ga;if(_n&&(ga=parsePES(_n))?(this.parseAVCPES(_,$,ga,!0),_.pesData=null):_.pesData=_n,_i&&(ga=parsePES(_i))){switch(g.segmentCodec){case"aac":this.parseAACPES(g,ga);break;case"mp3":this.parseMPEGPES(g,ga);break}g.pesData=null}else _i!=null&&_i.size&&logger.log("last AAC PES packet truncated,might overlap between fragments"),g.pesData=_i;_s&&(ga=parsePES(_s))?(this.parseID3PES(j,ga),j.pesData=null):j.pesData=_s}demuxSampleAes(i,g,_){const j=this.demux(i,_,!0,!this.config.progressive),$=this.sampleAes=new SampleAesDecrypter(this.observer,this.config,g);return this.decrypt(j,$)}decrypt(i,g){return new Promise(_=>{const{audioTrack:j,videoTrack:$}=i;j.samples&&j.segmentCodec==="aac"?g.decryptAacSamples(j.samples,0,()=>{$.samples?g.decryptAvcSamples($.samples,0,0,()=>{_(i)}):_(i)}):$.samples&&g.decryptAvcSamples($.samples,0,0,()=>{_(i)})})}destroy(){this._duration=0}parseAVCPES(i,g,_,j){const $=this.parseAVCNALu(i,_.data);let _n=this.avcSample,_i,_s=!1;_.data=null,_n&&$.length&&!i.audFound&&(pushAccessUnit(_n,i),_n=this.avcSample=createAVCSample(!1,_.pts,_.dts,"")),$.forEach(ga=>{switch(ga.type){case 1:{_i=!0,_n||(_n=this.avcSample=createAVCSample(!0,_.pts,_.dts,"")),_n.frame=!0;const ba=ga.data;if(_s&&ba.length>4){const xa=new ExpGolomb(ba).readSliceType();(xa===2||xa===4||xa===7||xa===9)&&(_n.key=!0)}break}case 5:_i=!0,_n||(_n=this.avcSample=createAVCSample(!0,_.pts,_.dts,"")),_n.key=!0,_n.frame=!0;break;case 6:{_i=!0,parseSEIMessageFromNALu(ga.data,1,_.pts,g.samples);break}case 7:if(_i=!0,_s=!0,!i.sps){const ba=ga.data,El=new ExpGolomb(ba).readSPS();i.width=El.width,i.height=El.height,i.pixelRatio=El.pixelRatio,i.sps=[ba],i.duration=this._duration;const Tl=ba.subarray(1,4);let Sl="avc1.";for(let Il=0;Il<3;Il++){let Cl=Tl[Il].toString(16);Cl.length<2&&(Cl="0"+Cl),Sl+=Cl}i.codec=Sl}break;case 8:_i=!0,i.pps||(i.pps=[ga.data]);break;case 9:_i=!1,i.audFound=!0,_n&&pushAccessUnit(_n,i),_n=this.avcSample=createAVCSample(!1,_.pts,_.dts,"");break;case 12:_i=!0;break;default:_i=!1,_n&&(_n.debug+="unknown NAL "+ga.type+" ");break}_n&&_i&&_n.units.push(ga)}),j&&_n&&(pushAccessUnit(_n,i),this.avcSample=null)}getLastNalUnit(i){var g;let _=this.avcSample,j;if((!_||_.units.length===0)&&(_=i[i.length-1]),(g=_)!=null&&g.units){const $=_.units;j=$[$.length-1]}return j}parseAVCNALu(i,g){const _=g.byteLength;let j=i.naluState||0;const $=j,_n=[];let _i=0,_s,ga,ba,xa=-1,El=0;for(j===-1&&(xa=0,El=g[0]&31,j=0,_i=1);_i<_;){if(_s=g[_i++],!j){j=_s?0:1;continue}if(j===1){j=_s?0:2;continue}if(!_s)j=3;else if(_s===1){if(xa>=0){const Tl={data:g.subarray(xa,_i-j-1),type:El};_n.push(Tl)}else{const Tl=this.getLastNalUnit(i.samples);if(Tl&&($&&_i<=4-$&&Tl.state&&(Tl.data=Tl.data.subarray(0,Tl.data.byteLength-$)),ga=_i-j-1,ga>0)){const Sl=new Uint8Array(Tl.data.byteLength+ga);Sl.set(Tl.data,0),Sl.set(g.subarray(0,ga),Tl.data.byteLength),Tl.data=Sl,Tl.state=0}}_i<_?(ba=g[_i]&31,xa=_i,El=ba,j=0):j=-1}else j=0}if(xa>=0&&j>=0){const Tl={data:g.subarray(xa,_),type:El,state:j};_n.push(Tl)}if(_n.length===0){const Tl=this.getLastNalUnit(i.samples);if(Tl){const Sl=new Uint8Array(Tl.data.byteLength+g.byteLength);Sl.set(Tl.data,0),Sl.set(g,Tl.data.byteLength),Tl.data=Sl}}return i.naluState=j,_n}parseAACPES(i,g){let _=0;const j=this.aacOverFlow;let $=g.data;if(j){this.aacOverFlow=null;const xa=j.missing,El=j.sample.unit.byteLength;if(xa===-1){const Tl=new Uint8Array(El+$.byteLength);Tl.set(j.sample.unit,0),Tl.set($,El),$=Tl}else{const Tl=El-xa;j.sample.unit.set($.subarray(0,xa),Tl),i.samples.push(j.sample),_=j.missing}}let _n,_i;for(_n=_,_i=$.length;_n<_i-1&&!isHeader$1($,_n);_n++);if(_n!==_){let xa;const El=_n<_i-1;El?xa=`AAC PES did not start with ADTS header,offset:${_n}`:xa="No ADTS header found in AAC PES";const Tl=new Error(xa);if(logger.warn(`parsing error: ${xa}`),this.observer.emit(Events.ERROR,Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,levelRetry:El,error:Tl,reason:xa}),!El)return}initTrackConfig(i,this.observer,$,_n,this.audioCodec);let _s;if(g.pts!==void 0)_s=g.pts;else if(j){const xa=getFrameDuration(i.samplerate);_s=j.sample.pts+xa}else{logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let ga=0,ba;for(;_n<_i;)if(ba=appendFrame$1(i,$,_n,_s,ga),_n+=ba.length,ba.missing){this.aacOverFlow=ba;break}else for(ga++;_n<_i-1&&!isHeader$1($,_n);_n++);}parseMPEGPES(i,g){const _=g.data,j=_.length;let $=0,_n=0;const _i=g.pts;if(_i===void 0){logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;_n<j;)if(isHeader(_,_n)){const _s=appendFrame(i,_,_n,_i,$);if(_s)_n+=_s.length,$++;else break}else _n++}parseID3PES(i,g){if(g.pts===void 0){logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const _=_extends$5({},g,{type:this._avcTrack?MetadataSchema.emsg:MetadataSchema.audioId3,duration:Number.POSITIVE_INFINITY});i.samples.push(_)}}function createAVCSample(h,i,g,_){return{key:h,frame:!1,pts:i,dts:g,units:[],debug:_,length:0}}function parsePID(h,i){return((h[i+1]&31)<<8)+h[i+2]}function parsePAT(h,i){return(h[i+10]&31)<<8|h[i+11]}function parsePMT(h,i,g,_){const j={audio:-1,avc:-1,id3:-1,segmentCodec:"aac"},$=(h[i+1]&15)<<8|h[i+2],_n=i+3+$-4,_i=(h[i+10]&15)<<8|h[i+11];for(i+=12+_i;i<_n;){const _s=parsePID(h,i);switch(h[i]){case 207:if(!_){logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:j.audio===-1&&(j.audio=_s);break;case 21:j.id3===-1&&(j.id3=_s);break;case 219:if(!_){logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:j.avc===-1&&(j.avc=_s);break;case 3:case 4:g.mpeg!==!0&&g.mp3!==!0?logger.log("MPEG audio found, not supported in this browser"):j.audio===-1&&(j.audio=_s,j.segmentCodec="mp3");break;case 36:logger.warn("Unsupported HEVC stream type found");break}i+=((h[i+3]&15)<<8|h[i+4])+5}return j}function parsePES(h){let i=0,g,_,j,$,_n;const _i=h.data;if(!h||h.size===0)return null;for(;_i[0].length<19&&_i.length>1;){const ga=new Uint8Array(_i[0].length+_i[1].length);ga.set(_i[0]),ga.set(_i[1],_i[0].length),_i[0]=ga,_i.splice(1,1)}if(g=_i[0],(g[0]<<16)+(g[1]<<8)+g[2]===1){if(_=(g[4]<<8)+g[5],_&&_>h.size-6)return null;const ga=g[7];ga&192&&($=(g[9]&14)*536870912+(g[10]&255)*4194304+(g[11]&254)*16384+(g[12]&255)*128+(g[13]&254)/2,ga&64?(_n=(g[14]&14)*536870912+(g[15]&255)*4194304+(g[16]&254)*16384+(g[17]&255)*128+(g[18]&254)/2,$-_n>60*9e4&&(logger.warn(`${Math.round(($-_n)/9e4)}s delta between PTS and DTS, align them`),$=_n)):_n=$),j=g[8];let ba=j+9;if(h.size<=ba)return null;h.size-=ba;const xa=new Uint8Array(h.size);for(let El=0,Tl=_i.length;El<Tl;El++){g=_i[El];let Sl=g.byteLength;if(ba)if(ba>Sl){ba-=Sl;continue}else g=g.subarray(ba),Sl-=ba,ba=0;xa.set(g,i),i+=Sl}return _&&(_-=j+3),{data:xa,pts:$,dts:_n,len:_}}return null}function pushAccessUnit(h,i){if(h.units.length&&h.frame){if(h.pts===void 0){const g=i.samples,_=g.length;if(_){const j=g[_-1];h.pts=j.pts,h.dts=j.dts}else{i.dropped++;return}}i.samples.push(h)}h.debug.length&&logger.log(h.pts+"/"+h.dts+":"+h.debug)}class MP3Demuxer extends BaseAudioDemuxer{resetInitSegment(i,g,_,j){super.resetInitSegment(i,g,_,j),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:g,duration:j,inputTimeScale:9e4,dropped:0}}static probe(i){if(!i)return!1;let _=(getID3Data(i,0)||[]).length;for(let j=i.length;_<j;_++)if(probe(i,_))return logger.log("MPEG Audio sync word found !"),!0;return!1}canParse(i,g){return canParse(i,g)}appendFrame(i,g,_){if(this.basePTS!==null)return appendFrame(i,g,_,this.basePTS,this.frameIndex)}}class AAC{static getSilentFrame(i,g){switch(i){case"mp4a.40.2":if(g===1)return new Uint8Array([0,200,0,128,35,128]);if(g===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(g===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(g===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(g===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(g===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(g===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(g===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(g===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const UINT32_MAX=Math.pow(2,32)-1;class MP4{static init(){MP4.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let i;for(i in MP4.types)MP4.types.hasOwnProperty(i)&&(MP4.types[i]=[i.charCodeAt(0),i.charCodeAt(1),i.charCodeAt(2),i.charCodeAt(3)]);const g=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),_=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);MP4.HDLR_TYPES={video:g,audio:_};const j=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),$=new Uint8Array([0,0,0,0,0,0,0,0]);MP4.STTS=MP4.STSC=MP4.STCO=$,MP4.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),MP4.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),MP4.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),MP4.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const _n=new Uint8Array([105,115,111,109]),_i=new Uint8Array([97,118,99,49]),_s=new Uint8Array([0,0,0,1]);MP4.FTYP=MP4.box(MP4.types.ftyp,_n,_s,_n,_i),MP4.DINF=MP4.box(MP4.types.dinf,MP4.box(MP4.types.dref,j))}static box(i,...g){let _=8,j=g.length;const $=j;for(;j--;)_+=g[j].byteLength;const _n=new Uint8Array(_);for(_n[0]=_>>24&255,_n[1]=_>>16&255,_n[2]=_>>8&255,_n[3]=_&255,_n.set(i,4),j=0,_=8;j<$;j++)_n.set(g[j],_),_+=g[j].byteLength;return _n}static hdlr(i){return MP4.box(MP4.types.hdlr,MP4.HDLR_TYPES[i])}static mdat(i){return MP4.box(MP4.types.mdat,i)}static mdhd(i,g){g*=i;const _=Math.floor(g/(UINT32_MAX+1)),j=Math.floor(g%(UINT32_MAX+1));return MP4.box(MP4.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,i>>24&255,i>>16&255,i>>8&255,i&255,_>>24,_>>16&255,_>>8&255,_&255,j>>24,j>>16&255,j>>8&255,j&255,85,196,0,0]))}static mdia(i){return MP4.box(MP4.types.mdia,MP4.mdhd(i.timescale,i.duration),MP4.hdlr(i.type),MP4.minf(i))}static mfhd(i){return MP4.box(MP4.types.mfhd,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,i&255]))}static minf(i){return i.type==="audio"?MP4.box(MP4.types.minf,MP4.box(MP4.types.smhd,MP4.SMHD),MP4.DINF,MP4.stbl(i)):MP4.box(MP4.types.minf,MP4.box(MP4.types.vmhd,MP4.VMHD),MP4.DINF,MP4.stbl(i))}static moof(i,g,_){return MP4.box(MP4.types.moof,MP4.mfhd(i),MP4.traf(_,g))}static moov(i){let g=i.length;const _=[];for(;g--;)_[g]=MP4.trak(i[g]);return MP4.box.apply(null,[MP4.types.moov,MP4.mvhd(i[0].timescale,i[0].duration)].concat(_).concat(MP4.mvex(i)))}static mvex(i){let g=i.length;const _=[];for(;g--;)_[g]=MP4.trex(i[g]);return MP4.box.apply(null,[MP4.types.mvex,..._])}static mvhd(i,g){g*=i;const _=Math.floor(g/(UINT32_MAX+1)),j=Math.floor(g%(UINT32_MAX+1)),$=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,i>>24&255,i>>16&255,i>>8&255,i&255,_>>24,_>>16&255,_>>8&255,_&255,j>>24,j>>16&255,j>>8&255,j&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return MP4.box(MP4.types.mvhd,$)}static sdtp(i){const g=i.samples||[],_=new Uint8Array(4+g.length);let j,$;for(j=0;j<g.length;j++)$=g[j].flags,_[j+4]=$.dependsOn<<4|$.isDependedOn<<2|$.hasRedundancy;return MP4.box(MP4.types.sdtp,_)}static stbl(i){return MP4.box(MP4.types.stbl,MP4.stsd(i),MP4.box(MP4.types.stts,MP4.STTS),MP4.box(MP4.types.stsc,MP4.STSC),MP4.box(MP4.types.stsz,MP4.STSZ),MP4.box(MP4.types.stco,MP4.STCO))}static avc1(i){let g=[],_=[],j,$,_n;for(j=0;j<i.sps.length;j++)$=i.sps[j],_n=$.byteLength,g.push(_n>>>8&255),g.push(_n&255),g=g.concat(Array.prototype.slice.call($));for(j=0;j<i.pps.length;j++)$=i.pps[j],_n=$.byteLength,_.push(_n>>>8&255),_.push(_n&255),_=_.concat(Array.prototype.slice.call($));const _i=MP4.box(MP4.types.avcC,new Uint8Array([1,g[3],g[4],g[5],255,224|i.sps.length].concat(g).concat([i.pps.length]).concat(_))),_s=i.width,ga=i.height,ba=i.pixelRatio[0],xa=i.pixelRatio[1];return MP4.box(MP4.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,_s>>8&255,_s&255,ga>>8&255,ga&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),_i,MP4.box(MP4.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),MP4.box(MP4.types.pasp,new Uint8Array([ba>>24,ba>>16&255,ba>>8&255,ba&255,xa>>24,xa>>16&255,xa>>8&255,xa&255])))}static esds(i){const g=i.config.length;return new Uint8Array([0,0,0,0,3,23+g,0,1,0,4,15+g,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([g]).concat(i.config).concat([6,1,2]))}static mp4a(i){const g=i.samplerate;return MP4.box(MP4.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,i.channelCount,0,16,0,0,0,0,g>>8&255,g&255,0,0]),MP4.box(MP4.types.esds,MP4.esds(i)))}static mp3(i){const g=i.samplerate;return MP4.box(MP4.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,i.channelCount,0,16,0,0,0,0,g>>8&255,g&255,0,0]))}static stsd(i){return i.type==="audio"?i.segmentCodec==="mp3"&&i.codec==="mp3"?MP4.box(MP4.types.stsd,MP4.STSD,MP4.mp3(i)):MP4.box(MP4.types.stsd,MP4.STSD,MP4.mp4a(i)):MP4.box(MP4.types.stsd,MP4.STSD,MP4.avc1(i))}static tkhd(i){const g=i.id,_=i.duration*i.timescale,j=i.width,$=i.height,_n=Math.floor(_/(UINT32_MAX+1)),_i=Math.floor(_%(UINT32_MAX+1));return MP4.box(MP4.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,g>>24&255,g>>16&255,g>>8&255,g&255,0,0,0,0,_n>>24,_n>>16&255,_n>>8&255,_n&255,_i>>24,_i>>16&255,_i>>8&255,_i&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,j>>8&255,j&255,0,0,$>>8&255,$&255,0,0]))}static traf(i,g){const _=MP4.sdtp(i),j=i.id,$=Math.floor(g/(UINT32_MAX+1)),_n=Math.floor(g%(UINT32_MAX+1));return MP4.box(MP4.types.traf,MP4.box(MP4.types.tfhd,new Uint8Array([0,0,0,0,j>>24,j>>16&255,j>>8&255,j&255])),MP4.box(MP4.types.tfdt,new Uint8Array([1,0,0,0,$>>24,$>>16&255,$>>8&255,$&255,_n>>24,_n>>16&255,_n>>8&255,_n&255])),MP4.trun(i,_.length+16+20+8+16+8+8),_)}static trak(i){return i.duration=i.duration||4294967295,MP4.box(MP4.types.trak,MP4.tkhd(i),MP4.mdia(i))}static trex(i){const g=i.id;return MP4.box(MP4.types.trex,new Uint8Array([0,0,0,0,g>>24,g>>16&255,g>>8&255,g&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(i,g){const _=i.samples||[],j=_.length,$=12+16*j,_n=new Uint8Array($);let _i,_s,ga,ba,xa,El;for(g+=8+$,_n.set([i.type==="video"?1:0,0,15,1,j>>>24&255,j>>>16&255,j>>>8&255,j&255,g>>>24&255,g>>>16&255,g>>>8&255,g&255],0),_i=0;_i<j;_i++)_s=_[_i],ga=_s.duration,ba=_s.size,xa=_s.flags,El=_s.cts,_n.set([ga>>>24&255,ga>>>16&255,ga>>>8&255,ga&255,ba>>>24&255,ba>>>16&255,ba>>>8&255,ba&255,xa.isLeading<<2|xa.dependsOn,xa.isDependedOn<<6|xa.hasRedundancy<<4|xa.paddingValue<<1|xa.isNonSync,xa.degradPrio&240<<8,xa.degradPrio&15,El>>>24&255,El>>>16&255,El>>>8&255,El&255],12+16*_i);return MP4.box(MP4.types.trun,_n)}static initSegment(i){MP4.types||MP4.init();const g=MP4.moov(i),_=new Uint8Array(MP4.FTYP.byteLength+g.byteLength);return _.set(MP4.FTYP),_.set(g,MP4.FTYP.byteLength),_}}MP4.types=void 0;MP4.HDLR_TYPES=void 0;MP4.STTS=void 0;MP4.STSC=void 0;MP4.STCO=void 0;MP4.STSZ=void 0;MP4.VMHD=void 0;MP4.SMHD=void 0;MP4.STSD=void 0;MP4.FTYP=void 0;MP4.DINF=void 0;const MPEG_TS_CLOCK_FREQ_HZ=9e4;function toTimescaleFromBase(h,i,g=1,_=!1){const j=h*i*g;return _?Math.round(j):j}function toTimescaleFromScale(h,i,g=1,_=!1){return toTimescaleFromBase(h,i,1/g,_)}function toMsFromMpegTsClock(h,i=!1){return toTimescaleFromBase(h,1e3,1/MPEG_TS_CLOCK_FREQ_HZ,i)}function toMpegTsClockFromTimescale(h,i=1){return toTimescaleFromBase(h,MPEG_TS_CLOCK_FREQ_HZ,1/i)}const MAX_SILENT_FRAME_DURATION=10*1e3,AAC_SAMPLES_PER_FRAME=1024,MPEG_AUDIO_SAMPLE_PER_FRAME=1152;let chromeVersion=null,safariWebkitVersion=null;class MP4Remuxer{constructor(i,g,_,j=""){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=i,this.config=g,this.typeSupported=_,this.ISGenerated=!1,chromeVersion===null){const _n=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);chromeVersion=_n?parseInt(_n[1]):0}if(safariWebkitVersion===null){const $=navigator.userAgent.match(/Safari\/(\d+)/i);safariWebkitVersion=$?parseInt($[1]):0}}destroy(){}resetTimeStamp(i){logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=i}resetNextTimestamp(){logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1}getVideoStartPts(i){let g=!1;const _=i.reduce((j,$)=>{const _n=$.pts-j;return _n<-4294967296?(g=!0,normalizePts(j,$.pts)):_n>0?j:$.pts},i[0].pts);return g&&logger.debug("PTS rollover detected"),_}remux(i,g,_,j,$,_n,_i,_s){let ga,ba,xa,El,Tl,Sl,Il=$,Cl=$;const Nl=i.pid>-1,Dl=g.pid>-1,Ul=g.samples.length,Kl=i.samples.length>0,Jl=_i&&Ul>0||Ul>1;if((!Nl||Kl)&&(!Dl||Jl)||this.ISGenerated||_i){this.ISGenerated||(xa=this.generateIS(i,g,$,_n));const _p=this.isVideoContiguous;let Ip=-1,Up;if(Jl&&(Ip=findKeyframeIndex(g.samples),!_p&&this.config.forceKeyFrameOnDiscontinuity))if(Sl=!0,Ip>0){logger.warn(`[mp4-remuxer]: Dropped ${Ip} out of ${Ul} video samples due to a missing keyframe`);const yp=this.getVideoStartPts(g.samples);g.samples=g.samples.slice(Ip),g.dropped+=Ip,Cl+=(g.samples[0].pts-yp)/g.inputTimeScale,Up=Cl}else Ip===-1&&(logger.warn(`[mp4-remuxer]: No keyframe found out of ${Ul} video samples`),Sl=!1);if(this.ISGenerated){if(Kl&&Jl){const yp=this.getVideoStartPts(g.samples),Cp=(normalizePts(i.samples[0].pts,yp)-yp)/g.inputTimeScale;Il+=Math.max(0,Cp),Cl+=Math.max(0,-Cp)}if(Kl){if(i.samplerate||(logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),xa=this.generateIS(i,g,$,_n)),ba=this.remuxAudio(i,Il,this.isAudioContiguous,_n,Dl||Jl||_s===PlaylistLevelType.AUDIO?Cl:void 0),Jl){const yp=ba?ba.endPTS-ba.startPTS:0;g.inputTimeScale||(logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),xa=this.generateIS(i,g,$,_n)),ga=this.remuxVideo(g,Cl,_p,yp)}}else Jl&&(ga=this.remuxVideo(g,Cl,_p,0));ga&&(ga.firstKeyFrame=Ip,ga.independent=Ip!==-1,ga.firstKeyFramePTS=Up)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(_.samples.length&&(Tl=flushTextTrackMetadataCueSamples(_,$,this._initPTS,this._initDTS)),j.samples.length&&(El=flushTextTrackUserdataCueSamples(j,$,this._initPTS))),{audio:ba,video:ga,initSegment:xa,independent:Sl,text:El,id3:Tl}}generateIS(i,g,_,j){const $=i.samples,_n=g.samples,_i=this.typeSupported,_s={},ga=this._initPTS;let ba=!ga||j,xa="audio/mp4",El,Tl,Sl;if(ba&&(El=Tl=1/0),i.config&&$.length){switch(i.timescale=i.samplerate,i.segmentCodec){case"mp3":_i.mpeg?(xa="audio/mpeg",i.codec=""):_i.mp3&&(i.codec="mp3");break}_s.audio={id:"audio",container:xa,codec:i.codec,initSegment:i.segmentCodec==="mp3"&&_i.mpeg?new Uint8Array(0):MP4.initSegment([i]),metadata:{channelCount:i.channelCount}},ba&&(Sl=i.inputTimeScale,!ga||Sl!==ga.timescale?El=Tl=$[0].pts-Math.round(Sl*_):ba=!1)}if(g.sps&&g.pps&&_n.length&&(g.timescale=g.inputTimeScale,_s.video={id:"main",container:"video/mp4",codec:g.codec,initSegment:MP4.initSegment([g]),metadata:{width:g.width,height:g.height}},ba))if(Sl=g.inputTimeScale,!ga||Sl!==ga.timescale){const Il=this.getVideoStartPts(_n),Cl=Math.round(Sl*_);Tl=Math.min(Tl,normalizePts(_n[0].dts,Il)-Cl),El=Math.min(El,Il-Cl)}else ba=!1;if(Object.keys(_s).length)return this.ISGenerated=!0,ba?(this._initPTS={baseTime:El,timescale:Sl},this._initDTS={baseTime:Tl,timescale:Sl}):El=Sl=void 0,{tracks:_s,initPTS:El,timescale:Sl}}remuxVideo(i,g,_,j){const $=i.inputTimeScale,_n=i.samples,_i=[],_s=_n.length,ga=this._initPTS;let ba=this.nextAvcDts,xa=8,El=this.videoSampleDuration,Tl,Sl,Il=Number.POSITIVE_INFINITY,Cl=Number.NEGATIVE_INFINITY,Nl=!1;if(!_||ba===null){const xp=g*$,Gp=_n[0].pts-normalizePts(_n[0].dts,_n[0].pts);ba=xp-Gp}const Dl=ga.baseTime*$/ga.timescale;for(let xp=0;xp<_s;xp++){const Gp=_n[xp];Gp.pts=normalizePts(Gp.pts-Dl,ba),Gp.dts=normalizePts(Gp.dts-Dl,ba),Gp.dts<_n[xp>0?xp-1:xp].dts&&(Nl=!0)}Nl&&_n.sort(function(xp,Gp){const $p=xp.dts-Gp.dts,c0=xp.pts-Gp.pts;return $p||c0}),Tl=_n[0].dts,Sl=_n[_n.length-1].dts;const Ul=Sl-Tl,Kl=Ul?Math.round(Ul/(_s-1)):El||i.inputTimeScale/30;if(_){const xp=Tl-ba,Gp=xp>Kl,$p=xp<-1;if((Gp||$p)&&(Gp?logger.warn(`AVC: ${toMsFromMpegTsClock(xp,!0)} ms (${xp}dts) hole between fragments detected, filling it`):logger.warn(`AVC: ${toMsFromMpegTsClock(-xp,!0)} ms (${xp}dts) overlapping between fragments detected`),!$p||ba>=_n[0].pts)){Tl=ba;const c0=_n[0].pts-xp;_n[0].dts=Tl,_n[0].pts=c0,logger.log(`Video: First PTS/DTS adjusted: ${toMsFromMpegTsClock(c0,!0)}/${toMsFromMpegTsClock(Tl,!0)}, delta: ${toMsFromMpegTsClock(xp,!0)} ms`)}}Tl=Math.max(0,Tl);let Jl=0,Ep=0;for(let xp=0;xp<_s;xp++){const Gp=_n[xp],$p=Gp.units,c0=$p.length;let n0=0;for(let C0=0;C0<c0;C0++)n0+=$p[C0].data.length;Ep+=n0,Jl+=c0,Gp.length=n0,Gp.dts=Math.max(Gp.dts,Tl),Il=Math.min(Gp.pts,Il),Cl=Math.max(Gp.pts,Cl)}Sl=_n[_s-1].dts;const _p=Ep+4*Jl+8;let Ip;try{Ip=new Uint8Array(_p)}catch(xp){this.observer.emit(Events.ERROR,Events.ERROR,{type:ErrorTypes.MUX_ERROR,details:ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,error:xp,bytes:_p,reason:`fail allocating video mdat ${_p}`});return}const Up=new DataView(Ip.buffer);Up.setUint32(0,_p),Ip.set(MP4.types.mdat,4);let yp=!1,Ap=Number.POSITIVE_INFINITY,Cp=Number.POSITIVE_INFINITY,Mp=Number.NEGATIVE_INFINITY,wp=Number.NEGATIVE_INFINITY;for(let xp=0;xp<_s;xp++){const Gp=_n[xp],$p=Gp.units;let c0=0;for(let Op=0,Q0=$p.length;Op<Q0;Op++){const dy=$p[Op],Yy=dy.data,J_=dy.data.byteLength;Up.setUint32(xa,J_),xa+=4,Ip.set(Yy,xa),xa+=J_,c0+=4+J_}let n0;if(xp<_s-1)El=_n[xp+1].dts-Gp.dts,n0=_n[xp+1].pts-Gp.pts;else{const Op=this.config,Q0=xp>0?Gp.dts-_n[xp-1].dts:Kl;if(n0=xp>0?Gp.pts-_n[xp-1].pts:Kl,Op.stretchShortVideoTrack&&this.nextAudioPts!==null){const dy=Math.floor(Op.maxBufferHole*$),Yy=(j?Il+j*$:this.nextAudioPts)-Gp.pts;Yy>dy?(El=Yy-Q0,El<0?El=Q0:yp=!0,logger.log(`[mp4-remuxer]: It is approximately ${Yy/90} ms to the next segment; using duration ${El/90} ms for the last video frame.`)):El=Q0}else El=Q0}const C0=Math.round(Gp.pts-Gp.dts);Ap=Math.min(Ap,El),Mp=Math.max(Mp,El),Cp=Math.min(Cp,n0),wp=Math.max(wp,n0),_i.push(new Mp4Sample(Gp.key,El,c0,C0))}if(_i.length){if(chromeVersion){if(chromeVersion<70){const xp=_i[0].flags;xp.dependsOn=2,xp.isNonSync=0}}else if(safariWebkitVersion&&wp-Cp<Mp-Ap&&Kl/Mp<.025&&_i[0].cts===0){logger.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let xp=Tl;for(let Gp=0,$p=_i.length;Gp<$p;Gp++){const c0=xp+_i[Gp].duration,n0=xp+_i[Gp].cts;if(Gp<$p-1){const C0=c0+_i[Gp+1].cts;_i[Gp].duration=C0-n0}else _i[Gp].duration=Gp?_i[Gp-1].duration:Kl;_i[Gp].cts=0,xp=c0}}}El=yp||!El?Kl:El,this.nextAvcDts=ba=Sl+El,this.videoSampleDuration=El,this.isVideoContiguous=!0;const Np=MP4.moof(i.sequenceNumber++,Tl,_extends$5({},i,{samples:_i})),Fp="video",Hp={data1:Np,data2:Ip,startPTS:Il/$,endPTS:(Cl+El)/$,startDTS:Tl/$,endDTS:ba/$,type:Fp,hasAudio:!1,hasVideo:!0,nb:_i.length,dropped:i.dropped};return i.samples=[],i.dropped=0,Hp}remuxAudio(i,g,_,j,$){const _n=i.inputTimeScale,_i=i.samplerate?i.samplerate:_n,_s=_n/_i,ga=i.segmentCodec==="aac"?AAC_SAMPLES_PER_FRAME:MPEG_AUDIO_SAMPLE_PER_FRAME,ba=ga*_s,xa=this._initPTS,El=i.segmentCodec==="mp3"&&this.typeSupported.mpeg,Tl=[],Sl=$!==void 0;let Il=i.samples,Cl=El?0:8,Nl=this.nextAudioPts||-1;const Dl=g*_n,Ul=xa.baseTime*_n/xa.timescale;if(this.isAudioContiguous=_=_||Il.length&&Nl>0&&(j&&Math.abs(Dl-Nl)<9e3||Math.abs(normalizePts(Il[0].pts-Ul,Dl)-Nl)<20*ba),Il.forEach(function(Fp){Fp.pts=normalizePts(Fp.pts-Ul,Dl)}),!_||Nl<0){if(Il=Il.filter(Fp=>Fp.pts>=0),!Il.length)return;$===0?Nl=0:j&&!Sl?Nl=Math.max(0,Dl):Nl=Il[0].pts}if(i.segmentCodec==="aac"){const Fp=this.config.maxAudioFramesDrift;for(let Hp=0,xp=Nl;Hp<Il.length;Hp++){const Gp=Il[Hp],$p=Gp.pts,c0=$p-xp,n0=Math.abs(1e3*c0/_n);if(c0<=-Fp*ba&&Sl)Hp===0&&(logger.warn(`Audio frame @ ${($p/_n).toFixed(3)}s overlaps nextAudioPts by ${Math.round(1e3*c0/_n)} ms.`),this.nextAudioPts=Nl=xp=$p);else if(c0>=Fp*ba&&n0<MAX_SILENT_FRAME_DURATION&&Sl){let C0=Math.round(c0/ba);xp=$p-C0*ba,xp<0&&(C0--,xp+=ba),Hp===0&&(this.nextAudioPts=Nl=xp),logger.warn(`[mp4-remuxer]: Injecting ${C0} audio frame @ ${(xp/_n).toFixed(3)}s due to ${Math.round(1e3*c0/_n)} ms gap.`);for(let Op=0;Op<C0;Op++){const Q0=Math.max(xp,0);let dy=AAC.getSilentFrame(i.manifestCodec||i.codec,i.channelCount);dy||(logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),dy=Gp.unit.subarray()),Il.splice(Hp,0,{unit:dy,pts:Q0}),xp+=ba,Hp++}}Gp.pts=xp,xp+=ba}}let Kl=null,Jl=null,Ep,_p=0,Ip=Il.length;for(;Ip--;)_p+=Il[Ip].unit.byteLength;for(let Fp=0,Hp=Il.length;Fp<Hp;Fp++){const xp=Il[Fp],Gp=xp.unit;let $p=xp.pts;if(Jl!==null){const n0=Tl[Fp-1];n0.duration=Math.round(($p-Jl)/_s)}else if(_&&i.segmentCodec==="aac"&&($p=Nl),Kl=$p,_p>0){_p+=Cl;try{Ep=new Uint8Array(_p)}catch(n0){this.observer.emit(Events.ERROR,Events.ERROR,{type:ErrorTypes.MUX_ERROR,details:ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,error:n0,bytes:_p,reason:`fail allocating audio mdat ${_p}`});return}El||(new DataView(Ep.buffer).setUint32(0,_p),Ep.set(MP4.types.mdat,4))}else return;Ep.set(Gp,Cl);const c0=Gp.byteLength;Cl+=c0,Tl.push(new Mp4Sample(!0,ga,c0,0)),Jl=$p}const Up=Tl.length;if(!Up)return;const yp=Tl[Tl.length-1];this.nextAudioPts=Nl=Jl+_s*yp.duration;const Ap=El?new Uint8Array(0):MP4.moof(i.sequenceNumber++,Kl/_s,_extends$5({},i,{samples:Tl}));i.samples=[];const Cp=Kl/_n,Mp=Nl/_n,Np={data1:Ap,data2:Ep,startPTS:Cp,endPTS:Mp,startDTS:Cp,endDTS:Mp,type:"audio",hasAudio:!0,hasVideo:!1,nb:Up};return this.isAudioContiguous=!0,Np}remuxEmptyAudio(i,g,_,j){const $=i.inputTimeScale,_n=i.samplerate?i.samplerate:$,_i=$/_n,_s=this.nextAudioPts,ga=this._initDTS,ba=ga.baseTime*9e4/ga.timescale,xa=(_s!==null?_s:j.startDTS*$)+ba,El=j.endDTS*$+ba,Tl=_i*AAC_SAMPLES_PER_FRAME,Sl=Math.ceil((El-xa)/Tl),Il=AAC.getSilentFrame(i.manifestCodec||i.codec,i.channelCount);if(logger.warn("[mp4-remuxer]: remux empty Audio"),!Il){logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");return}const Cl=[];for(let Nl=0;Nl<Sl;Nl++){const Dl=xa+Nl*Tl;Cl.push({unit:Il,pts:Dl,dts:Dl})}return i.samples=Cl,this.remuxAudio(i,g,_,!1)}}function normalizePts(h,i){let g;if(i===null)return h;for(i<h?g=-8589934592:g=8589934592;Math.abs(h-i)>4294967296;)h+=g;return h}function findKeyframeIndex(h){for(let i=0;i<h.length;i++)if(h[i].key)return i;return-1}function flushTextTrackMetadataCueSamples(h,i,g,_){const j=h.samples.length;if(!j)return;const $=h.inputTimeScale;for(let _i=0;_i<j;_i++){const _s=h.samples[_i];_s.pts=normalizePts(_s.pts-g.baseTime*$/g.timescale,i*$)/$,_s.dts=normalizePts(_s.dts-_.baseTime*$/_.timescale,i*$)/$}const _n=h.samples;return h.samples=[],{samples:_n}}function flushTextTrackUserdataCueSamples(h,i,g){const _=h.samples.length;if(!_)return;const j=h.inputTimeScale;for(let _n=0;_n<_;_n++){const _i=h.samples[_n];_i.pts=normalizePts(_i.pts-g.baseTime*9e4/g.timescale,i*j)/j}h.samples.sort((_n,_i)=>_n.pts-_i.pts);const $=h.samples;return h.samples=[],{samples:$}}class Mp4Sample{constructor(i,g,_,j){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=g,this.size=_,this.cts=j,this.flags=new Mp4SampleFlags(i)}}class Mp4SampleFlags{constructor(i){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=i?2:1,this.isNonSync=i?0:1}}class PassThroughRemuxer{constructor(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null}destroy(){}resetTimeStamp(i){this.initPTS=i,this.lastEndTime=null}resetNextTimestamp(){this.lastEndTime=null}resetInitSegment(i,g,_,j){this.audioCodec=g,this.videoCodec=_,this.generateInitSegment(patchEncyptionData(i,j)),this.emitInitSegment=!0}generateInitSegment(i){let{audioCodec:g,videoCodec:_}=this;if(!(i!=null&&i.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const j=this.initData=parseInitSegment(i);g||(g=getParsedTrackCodec(j.audio,ElementaryStreamTypes.AUDIO)),_||(_=getParsedTrackCodec(j.video,ElementaryStreamTypes.VIDEO));const $={};j.audio&&j.video?$.audiovideo={container:"video/mp4",codec:g+","+_,initSegment:i,id:"main"}:j.audio?$.audio={container:"audio/mp4",codec:g,initSegment:i,id:"audio"}:j.video?$.video={container:"video/mp4",codec:_,initSegment:i,id:"main"}:logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=$}remux(i,g,_,j,$,_n){var _i,_s;let{initPTS:ga,lastEndTime:ba}=this;const xa={audio:void 0,video:void 0,text:j,id3:_,initSegment:void 0};isFiniteNumber(ba)||(ba=this.lastEndTime=$||0);const El=g.samples;if(!(El!=null&&El.length))return xa;const Tl={initPTS:void 0,timescale:1};let Sl=this.initData;if((_i=Sl)!=null&&_i.length||(this.generateInitSegment(El),Sl=this.initData),!((_s=Sl)!=null&&_s.length))return logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),xa;this.emitInitSegment&&(Tl.tracks=this.initTracks,this.emitInitSegment=!1);const Il=getDuration(El,Sl),Cl=getStartDTS(Sl,El),Nl=Cl===null?$:Cl;(isInvalidInitPts(ga,Nl,$,Il)||Tl.timescale!==ga.timescale&&_n)&&(Tl.initPTS=Nl-$,ga&&ga.timescale===1&&logger.warn(`Adjusting initPTS by ${Tl.initPTS-ga.baseTime}`),this.initPTS=ga={baseTime:Tl.initPTS,timescale:1});const Dl=i?Nl-ga.baseTime/ga.timescale:ba,Ul=Dl+Il;offsetStartDTS(Sl,El,ga.baseTime/ga.timescale),Il>0?this.lastEndTime=Ul:(logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const Kl=!!Sl.audio,Jl=!!Sl.video;let Ep="";Kl&&(Ep+="audio"),Jl&&(Ep+="video");const _p={data1:El,startPTS:Dl,startDTS:Dl,endPTS:Ul,endDTS:Ul,type:Ep,hasAudio:Kl,hasVideo:Jl,nb:1,dropped:0};return xa.audio=_p.type==="audio"?_p:void 0,xa.video=_p.type!=="audio"?_p:void 0,xa.initSegment=Tl,xa.id3=flushTextTrackMetadataCueSamples(_,$,ga,ga),j.samples.length&&(xa.text=flushTextTrackUserdataCueSamples(j,$,ga)),xa}}function isInvalidInitPts(h,i,g,_){if(h===null)return!0;const j=Math.max(_,1),$=i-h.baseTime/h.timescale;return Math.abs($-g)>j}function getParsedTrackCodec(h,i){const g=h==null?void 0:h.codec;return g&&g.length>4?g:g==="hvc1"||g==="hev1"?"hvc1.1.6.L120.90":g==="av01"?"av01.0.04M.08":g==="avc1"||i===ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}let now$1;try{now$1=self.performance.now.bind(self.performance)}catch{logger.debug("Unable to use Performance API on this environment"),now$1=typeof self<"u"&&self.Date.now}const muxConfig=[{demux:MP4Demuxer,remux:PassThroughRemuxer},{demux:TSDemuxer,remux:MP4Remuxer},{demux:AACDemuxer,remux:MP4Remuxer},{demux:MP3Demuxer,remux:MP4Remuxer}];class Transmuxer{constructor(i,g,_,j,$){this.async=!1,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=i,this.typeSupported=g,this.config=_,this.vendor=j,this.id=$}configure(i){this.transmuxConfig=i,this.decrypter&&this.decrypter.reset()}push(i,g,_,j){const $=_.transmuxing;$.executeStart=now$1();let _n=new Uint8Array(i);const{currentTransmuxState:_i,transmuxConfig:_s}=this;j&&(this.currentTransmuxState=j);const{contiguous:ga,discontinuity:ba,trackSwitch:xa,accurateTimeOffset:El,timeOffset:Tl,initSegmentChange:Sl}=j||_i,{audioCodec:Il,videoCodec:Cl,defaultInitPts:Nl,duration:Dl,initSegmentData:Ul}=_s,Kl=getEncryptionType(_n,g);if(Kl&&Kl.method==="AES-128"){const Ip=this.getDecrypter();if(Ip.isSync()){let Up=Ip.softwareDecrypt(_n,Kl.key.buffer,Kl.iv.buffer);if(_.part>-1&&(Up=Ip.flush()),!Up)return $.executeEnd=now$1(),emptyResult(_);_n=new Uint8Array(Up)}else return this.decryptionPromise=Ip.webCryptoDecrypt(_n,Kl.key.buffer,Kl.iv.buffer).then(Up=>{const yp=this.push(Up,null,_);return this.decryptionPromise=null,yp}),this.decryptionPromise}const Jl=this.needsProbing(ba,xa);if(Jl){const Ip=this.configureTransmuxer(_n);if(Ip)return logger.warn(`[transmuxer] ${Ip.message}`),this.observer.emit(Events.ERROR,Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,error:Ip,reason:Ip.message}),$.executeEnd=now$1(),emptyResult(_)}(ba||xa||Sl||Jl)&&this.resetInitSegment(Ul,Il,Cl,Dl,g),(ba||Sl||Jl)&&this.resetInitialTimestamp(Nl),ga||this.resetContiguity();const Ep=this.transmux(_n,Kl,Tl,El,_),_p=this.currentTransmuxState;return _p.contiguous=!0,_p.discontinuity=!1,_p.trackSwitch=!1,$.executeEnd=now$1(),Ep}flush(i){const g=i.transmuxing;g.executeStart=now$1();const{decrypter:_,currentTransmuxState:j,decryptionPromise:$}=this;if($)return $.then(()=>this.flush(i));const _n=[],{timeOffset:_i}=j;if(_){const xa=_.flush();xa&&_n.push(this.push(xa,null,i))}const{demuxer:_s,remuxer:ga}=this;if(!_s||!ga)return g.executeEnd=now$1(),[emptyResult(i)];const ba=_s.flush(_i);return isPromise(ba)?ba.then(xa=>(this.flushRemux(_n,xa,i),_n)):(this.flushRemux(_n,ba,i),_n)}flushRemux(i,g,_){const{audioTrack:j,videoTrack:$,id3Track:_n,textTrack:_i}=g,{accurateTimeOffset:_s,timeOffset:ga}=this.currentTransmuxState;logger.log(`[transmuxer.ts]: Flushed fragment ${_.sn}${_.part>-1?" p: "+_.part:""} of level ${_.level}`);const ba=this.remuxer.remux(j,$,_n,_i,ga,_s,!0,this.id);i.push({remuxResult:ba,chunkMeta:_}),_.transmuxing.executeEnd=now$1()}resetInitialTimestamp(i){const{demuxer:g,remuxer:_}=this;!g||!_||(g.resetTimeStamp(i),_.resetTimeStamp(i))}resetContiguity(){const{demuxer:i,remuxer:g}=this;!i||!g||(i.resetContiguity(),g.resetNextTimestamp())}resetInitSegment(i,g,_,j,$){const{demuxer:_n,remuxer:_i}=this;!_n||!_i||(_n.resetInitSegment(i,g,_,j),_i.resetInitSegment(i,g,_,$))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(i,g,_,j,$){let _n;return g&&g.method==="SAMPLE-AES"?_n=this.transmuxSampleAes(i,g,_,j,$):_n=this.transmuxUnencrypted(i,_,j,$),_n}transmuxUnencrypted(i,g,_,j){const{audioTrack:$,videoTrack:_n,id3Track:_i,textTrack:_s}=this.demuxer.demux(i,g,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux($,_n,_i,_s,g,_,!1,this.id),chunkMeta:j}}transmuxSampleAes(i,g,_,j,$){return this.demuxer.demuxSampleAes(i,g,_).then(_n=>({remuxResult:this.remuxer.remux(_n.audioTrack,_n.videoTrack,_n.id3Track,_n.textTrack,_,j,!1,this.id),chunkMeta:$}))}configureTransmuxer(i){const{config:g,observer:_,typeSupported:j,vendor:$}=this;let _n;for(let xa=0,El=muxConfig.length;xa<El;xa++)if(muxConfig[xa].demux.probe(i)){_n=muxConfig[xa];break}if(!_n)return new Error("Failed to find demuxer by probing fragment data");const _i=this.demuxer,_s=this.remuxer,ga=_n.remux,ba=_n.demux;(!_s||!(_s instanceof ga))&&(this.remuxer=new ga(_,g,j,$)),(!_i||!(_i instanceof ba))&&(this.demuxer=new ba(_,g,j),this.probe=ba.probe)}needsProbing(i,g){return!this.demuxer||!this.remuxer||i||g}getDecrypter(){let i=this.decrypter;return i||(i=this.decrypter=new Decrypter(this.config)),i}}function getEncryptionType(h,i){let g=null;return h.byteLength>0&&i!=null&&i.key!=null&&i.iv!==null&&i.method!=null&&(g=i),g}const emptyResult=h=>({remuxResult:{},chunkMeta:h});function isPromise(h){return"then"in h&&h.then instanceof Function}class TransmuxConfig{constructor(i,g,_,j,$){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=i,this.videoCodec=g,this.initSegmentData=_,this.duration=j,this.defaultInitPts=$||null}}class TransmuxState{constructor(i,g,_,j,$,_n){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=i,this.contiguous=g,this.accurateTimeOffset=_,this.trackSwitch=j,this.timeOffset=$,this.initSegmentChange=_n}}var eventemitter3={exports:{}};(function(h){var i=Object.prototype.hasOwnProperty,g="~";function _(){}Object.create&&(_.prototype=Object.create(null),new _().__proto__||(g=!1));function j(_s,ga,ba){this.fn=_s,this.context=ga,this.once=ba||!1}function $(_s,ga,ba,xa,El){if(typeof ba!="function")throw new TypeError("The listener must be a function");var Tl=new j(ba,xa||_s,El),Sl=g?g+ga:ga;return _s._events[Sl]?_s._events[Sl].fn?_s._events[Sl]=[_s._events[Sl],Tl]:_s._events[Sl].push(Tl):(_s._events[Sl]=Tl,_s._eventsCount++),_s}function _n(_s,ga){--_s._eventsCount===0?_s._events=new _:delete _s._events[ga]}function _i(){this._events=new _,this._eventsCount=0}_i.prototype.eventNames=function(){var ga=[],ba,xa;if(this._eventsCount===0)return ga;for(xa in ba=this._events)i.call(ba,xa)&&ga.push(g?xa.slice(1):xa);return Object.getOwnPropertySymbols?ga.concat(Object.getOwnPropertySymbols(ba)):ga},_i.prototype.listeners=function(ga){var ba=g?g+ga:ga,xa=this._events[ba];if(!xa)return[];if(xa.fn)return[xa.fn];for(var El=0,Tl=xa.length,Sl=new Array(Tl);El<Tl;El++)Sl[El]=xa[El].fn;return Sl},_i.prototype.listenerCount=function(ga){var ba=g?g+ga:ga,xa=this._events[ba];return xa?xa.fn?1:xa.length:0},_i.prototype.emit=function(ga,ba,xa,El,Tl,Sl){var Il=g?g+ga:ga;if(!this._events[Il])return!1;var Cl=this._events[Il],Nl=arguments.length,Dl,Ul;if(Cl.fn){switch(Cl.once&&this.removeListener(ga,Cl.fn,void 0,!0),Nl){case 1:return Cl.fn.call(Cl.context),!0;case 2:return Cl.fn.call(Cl.context,ba),!0;case 3:return Cl.fn.call(Cl.context,ba,xa),!0;case 4:return Cl.fn.call(Cl.context,ba,xa,El),!0;case 5:return Cl.fn.call(Cl.context,ba,xa,El,Tl),!0;case 6:return Cl.fn.call(Cl.context,ba,xa,El,Tl,Sl),!0}for(Ul=1,Dl=new Array(Nl-1);Ul<Nl;Ul++)Dl[Ul-1]=arguments[Ul];Cl.fn.apply(Cl.context,Dl)}else{var Kl=Cl.length,Jl;for(Ul=0;Ul<Kl;Ul++)switch(Cl[Ul].once&&this.removeListener(ga,Cl[Ul].fn,void 0,!0),Nl){case 1:Cl[Ul].fn.call(Cl[Ul].context);break;case 2:Cl[Ul].fn.call(Cl[Ul].context,ba);break;case 3:Cl[Ul].fn.call(Cl[Ul].context,ba,xa);break;case 4:Cl[Ul].fn.call(Cl[Ul].context,ba,xa,El);break;default:if(!Dl)for(Jl=1,Dl=new Array(Nl-1);Jl<Nl;Jl++)Dl[Jl-1]=arguments[Jl];Cl[Ul].fn.apply(Cl[Ul].context,Dl)}}return!0},_i.prototype.on=function(ga,ba,xa){return $(this,ga,ba,xa,!1)},_i.prototype.once=function(ga,ba,xa){return $(this,ga,ba,xa,!0)},_i.prototype.removeListener=function(ga,ba,xa,El){var Tl=g?g+ga:ga;if(!this._events[Tl])return this;if(!ba)return _n(this,Tl),this;var Sl=this._events[Tl];if(Sl.fn)Sl.fn===ba&&(!El||Sl.once)&&(!xa||Sl.context===xa)&&_n(this,Tl);else{for(var Il=0,Cl=[],Nl=Sl.length;Il<Nl;Il++)(Sl[Il].fn!==ba||El&&!Sl[Il].once||xa&&Sl[Il].context!==xa)&&Cl.push(Sl[Il]);Cl.length?this._events[Tl]=Cl.length===1?Cl[0]:Cl:_n(this,Tl)}return this},_i.prototype.removeAllListeners=function(ga){var ba;return ga?(ba=g?g+ga:ga,this._events[ba]&&_n(this,ba)):(this._events=new _,this._eventsCount=0),this},_i.prototype.off=_i.prototype.removeListener,_i.prototype.addListener=_i.prototype.on,_i.prefixed=g,_i.EventEmitter=_i,h.exports=_i})(eventemitter3);var eventemitter3Exports=eventemitter3.exports,EventEmitter=getDefaultExportFromCjs(eventemitter3Exports);const MediaSource$1=getMediaSource()||{isTypeSupported:()=>!1};class TransmuxerInterface{constructor(i,g,_,j){this.error=null,this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;const $=i.config;this.hls=i,this.id=g,this.useWorker=!!$.enableWorker,this.onTransmuxComplete=_,this.onFlush=j;const _n=(ga,ba)=>{ba=ba||{},ba.frag=this.frag,ba.id=this.id,ga===Events.ERROR&&(this.error=ba.error),this.hls.trigger(ga,ba)};this.observer=new EventEmitter,this.observer.on(Events.FRAG_DECRYPTED,_n),this.observer.on(Events.ERROR,_n);const _i={mp4:MediaSource$1.isTypeSupported("video/mp4"),mpeg:MediaSource$1.isTypeSupported("audio/mpeg"),mp3:MediaSource$1.isTypeSupported('audio/mp4; codecs="mp3"')},_s=navigator.vendor;if(this.useWorker&&typeof Worker<"u"&&($.workerPath||hasUMDWorker())){try{$.workerPath?(logger.log(`loading Web Worker ${$.workerPath} for "${g}"`),this.workerContext=loadWorker($.workerPath)):(logger.log(`injecting Web Worker for "${g}"`),this.workerContext=injectWorker()),this.onwmsg=xa=>this.onWorkerMessage(xa);const{worker:ba}=this.workerContext;ba.addEventListener("message",this.onwmsg),ba.onerror=xa=>{const El=new Error(`${xa.message}  (${xa.filename}:${xa.lineno})`);$.enableWorker=!1,logger.warn(`Error in "${g}" Web Worker, fallback to inline`),this.hls.trigger(Events.ERROR,{type:ErrorTypes.OTHER_ERROR,details:ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:El})},ba.postMessage({cmd:"init",typeSupported:_i,vendor:_s,id:g,config:JSON.stringify($)})}catch(ba){logger.warn(`Error setting up "${g}" Web Worker, fallback to inline`,ba),this.resetWorker(),this.error=null,this.transmuxer=new Transmuxer(this.observer,_i,$,_s,g)}return}this.transmuxer=new Transmuxer(this.observer,_i,$,_s,g)}resetWorker(){if(this.workerContext){const{worker:i,objectURL:g}=this.workerContext;g&&self.URL.revokeObjectURL(g),i.removeEventListener("message",this.onwmsg),i.onerror=null,i.terminate(),this.workerContext=null}}destroy(){if(this.workerContext)this.resetWorker(),this.onwmsg=void 0;else{const g=this.transmuxer;g&&(g.destroy(),this.transmuxer=null)}const i=this.observer;i&&i.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null}push(i,g,_,j,$,_n,_i,_s,ga,ba){var xa,El;ga.transmuxing.start=self.performance.now();const{transmuxer:Tl}=this,Sl=_n?_n.start:$.start,Il=$.decryptdata,Cl=this.frag,Nl=!(Cl&&$.cc===Cl.cc),Dl=!(Cl&&ga.level===Cl.level),Ul=Cl?ga.sn-Cl.sn:-1,Kl=this.part?ga.part-this.part.index:-1,Jl=Ul===0&&ga.id>1&&ga.id===(Cl==null?void 0:Cl.stats.chunkCount),Ep=!Dl&&(Ul===1||Ul===0&&(Kl===1||Jl&&Kl<=0)),_p=self.performance.now();(Dl||Ul||$.stats.parsing.start===0)&&($.stats.parsing.start=_p),_n&&(Kl||!Ep)&&(_n.stats.parsing.start=_p);const Ip=!(Cl&&((xa=$.initSegment)==null?void 0:xa.url)===((El=Cl.initSegment)==null?void 0:El.url)),Up=new TransmuxState(Nl,Ep,_s,Dl,Sl,Ip);if(!Ep||Nl||Ip){logger.log(`[transmuxer-interface, ${$.type}]: Starting new transmux session for sn: ${ga.sn} p: ${ga.part} level: ${ga.level} id: ${ga.id}
        discontinuity: ${Nl}
        trackSwitch: ${Dl}
        contiguous: ${Ep}
        accurateTimeOffset: ${_s}
        timeOffset: ${Sl}
        initSegmentChange: ${Ip}`);const yp=new TransmuxConfig(_,j,g,_i,ba);this.configureTransmuxer(yp)}if(this.frag=$,this.part=_n,this.workerContext)this.workerContext.worker.postMessage({cmd:"demux",data:i,decryptdata:Il,chunkMeta:ga,state:Up},i instanceof ArrayBuffer?[i]:[]);else if(Tl){const yp=Tl.push(i,Il,ga,Up);isPromise(yp)?(Tl.async=!0,yp.then(Ap=>{this.handleTransmuxComplete(Ap)}).catch(Ap=>{this.transmuxerError(Ap,ga,"transmuxer-interface push error")})):(Tl.async=!1,this.handleTransmuxComplete(yp))}}flush(i){i.transmuxing.start=self.performance.now();const{transmuxer:g}=this;if(this.workerContext)this.workerContext.worker.postMessage({cmd:"flush",chunkMeta:i});else if(g){let _=g.flush(i);isPromise(_)||g.async?(isPromise(_)||(_=Promise.resolve(_)),_.then($=>{this.handleFlushResult($,i)}).catch($=>{this.transmuxerError($,i,"transmuxer-interface flush error")})):this.handleFlushResult(_,i)}}transmuxerError(i,g,_){this.hls&&(this.error=i,this.hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_PARSING_ERROR,chunkMeta:g,fatal:!1,error:i,err:i,reason:_}))}handleFlushResult(i,g){i.forEach(_=>{this.handleTransmuxComplete(_)}),this.onFlush(g)}onWorkerMessage(i){const g=i.data,_=this.hls;switch(g.event){case"init":{var j;const $=(j=this.workerContext)==null?void 0:j.objectURL;$&&self.URL.revokeObjectURL($);break}case"transmuxComplete":{this.handleTransmuxComplete(g.data);break}case"flush":{this.onFlush(g.data);break}case"workerLog":logger[g.data.logType]&&logger[g.data.logType](g.data.message);break;default:{g.data=g.data||{},g.data.frag=this.frag,g.data.id=this.id,_.trigger(g.event,g.data);break}}}configureTransmuxer(i){const{transmuxer:g}=this;this.workerContext?this.workerContext.worker.postMessage({cmd:"configure",config:i}):g&&g.configure(i)}handleTransmuxComplete(i){i.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(i)}}const STALL_MINIMUM_DURATION_MS=250,MAX_START_GAP_JUMP=2,SKIP_BUFFER_HOLE_STEP_SECONDS=.1,SKIP_BUFFER_RANGE_START=.05;class GapController{constructor(i,g,_,j){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=i,this.media=g,this.fragmentTracker=_,this.hls=j}destroy(){this.media=null,this.hls=this.fragmentTracker=null}poll(i,g){const{config:_,media:j,stalled:$}=this;if(j===null)return;const{currentTime:_n,seeking:_i}=j,_s=this.seeking&&!_i,ga=!this.seeking&&_i;if(this.seeking=_i,_n!==i){if(this.moved=!0,$!==null){if(this.stallReported){const Nl=self.performance.now()-$;logger.warn(`playback not stuck anymore @${_n}, after ${Math.round(Nl)}ms`),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}return}if(ga||_s){this.stalled=null;return}if(j.paused&&!_i||j.ended||j.playbackRate===0||!BufferHelper.getBuffered(j).length)return;const ba=BufferHelper.bufferInfo(j,_n,0),xa=ba.len>0,El=ba.nextStart||0;if(!xa&&!El)return;if(_i){const Nl=ba.len>MAX_START_GAP_JUMP,Dl=!El||g&&g.start<=_n||El-_n>MAX_START_GAP_JUMP&&!this.fragmentTracker.getPartialFragment(_n);if(Nl||Dl)return;this.moved=!1}if(!this.moved&&this.stalled!==null){var Tl;const Nl=Math.max(El,ba.start||0)-_n,Dl=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,Kl=(Dl==null||(Tl=Dl.details)==null?void 0:Tl.live)?Dl.details.targetduration*2:MAX_START_GAP_JUMP,Jl=this.fragmentTracker.getPartialFragment(_n);if(Nl>0&&(Nl<=Kl||Jl)){this._trySkipBufferHole(Jl);return}}const Sl=self.performance.now();if($===null){this.stalled=Sl;return}const Il=Sl-$;if(!_i&&Il>=STALL_MINIMUM_DURATION_MS&&(this._reportStall(ba),!this.media))return;const Cl=BufferHelper.bufferInfo(j,_n,_.maxBufferHole);this._tryFixBufferStall(Cl,Il)}_tryFixBufferStall(i,g){const{config:_,fragmentTracker:j,media:$}=this;if($===null)return;const _n=$.currentTime,_i=j.getPartialFragment(_n);_i&&(this._trySkipBufferHole(_i)||!this.media)||(i.len>_.maxBufferHole||i.nextStart&&i.nextStart-_n<_.maxBufferHole)&&g>_.highBufferWatchdogPeriod*1e3&&(logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}_reportStall(i){const{hls:g,media:_,stallReported:j}=this;if(!j&&_){this.stallReported=!0;const $=new Error(`Playback stalling at @${_.currentTime} due to low buffer (${JSON.stringify(i)})`);logger.warn($.message),g.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,error:$,buffer:i.len})}}_trySkipBufferHole(i){const{config:g,hls:_,media:j}=this;if(j===null)return 0;const $=j.currentTime,_n=BufferHelper.bufferInfo(j,$,0),_i=$<_n.start?_n.start:_n.nextStart;if(_i){const _s=_n.len<=g.maxBufferHole,ga=_n.len>0&&_n.len<1&&j.readyState<3,ba=_i-$;if(ba>0&&(_s||ga)){if(ba>g.maxBufferHole){const{fragmentTracker:El}=this;let Tl=!1;if($===0){const Sl=El.getAppendedFrag(0,PlaylistLevelType.MAIN);Sl&&_i<Sl.end&&(Tl=!0)}if(!Tl){const Sl=i||El.getAppendedFrag($,PlaylistLevelType.MAIN);if(Sl){let Il=!1,Cl=Sl.end;for(;Cl<_i;){const Nl=El.getPartialFragment(Cl);if(Nl)Cl+=Nl.duration;else{Il=!0;break}}if(Il)return 0}}}const xa=Math.max(_i+SKIP_BUFFER_RANGE_START,$+SKIP_BUFFER_HOLE_STEP_SECONDS);if(logger.warn(`skipping hole, adjusting currentTime from ${$} to ${xa}`),this.moved=!0,this.stalled=null,j.currentTime=xa,i&&!i.gap){const El=new Error(`fragment loaded with buffer holes, seeking from ${$} to ${xa}`);_.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:El,reason:El.message,frag:i})}return xa}}return 0}_tryNudgeBuffer(){const{config:i,hls:g,media:_,nudgeRetry:j}=this;if(_===null)return;const $=_.currentTime;if(this.nudgeRetry++,j<i.nudgeMaxRetry){const _n=$+(j+1)*i.nudgeOffset,_i=new Error(`Nudging 'currentTime' from ${$} to ${_n}`);logger.warn(_i.message),_.currentTime=_n,g.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.BUFFER_NUDGE_ON_STALL,error:_i,fatal:!1})}else{const _n=new Error(`Playhead still not moving while enough data buffered @${$} after ${i.nudgeMaxRetry} nudges`);logger.error(_n.message),g.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.BUFFER_STALLED_ERROR,error:_n,fatal:!0})}}}const TICK_INTERVAL$2=100;class StreamController extends BaseStreamController{constructor(i,g,_){super(i,g,_,"[stream-controller]",PlaylistLevelType.MAIN),this.audioCodecSwap=!1,this.gapController=null,this.level=-1,this._forceStartLoad=!1,this.altAudio=!1,this.audioOnly=!1,this.fragPlaying=null,this.onvplaying=null,this.onvseeked=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this._registerListeners()}_registerListeners(){const{hls:i}=this;i.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),i.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),i.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),i.on(Events.MANIFEST_PARSED,this.onManifestParsed,this),i.on(Events.LEVEL_LOADING,this.onLevelLoading,this),i.on(Events.LEVEL_LOADED,this.onLevelLoaded,this),i.on(Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),i.on(Events.ERROR,this.onError,this),i.on(Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),i.on(Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),i.on(Events.BUFFER_CREATED,this.onBufferCreated,this),i.on(Events.BUFFER_FLUSHED,this.onBufferFlushed,this),i.on(Events.LEVELS_UPDATED,this.onLevelsUpdated,this),i.on(Events.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:i}=this;i.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),i.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),i.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),i.off(Events.MANIFEST_PARSED,this.onManifestParsed,this),i.off(Events.LEVEL_LOADED,this.onLevelLoaded,this),i.off(Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),i.off(Events.ERROR,this.onError,this),i.off(Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),i.off(Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),i.off(Events.BUFFER_CREATED,this.onBufferCreated,this),i.off(Events.BUFFER_FLUSHED,this.onBufferFlushed,this),i.off(Events.LEVELS_UPDATED,this.onLevelsUpdated,this),i.off(Events.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this._unregisterListeners(),this.onMediaDetaching()}startLoad(i){if(this.levels){const{lastCurrentTime:g,hls:_}=this;if(this.stopLoad(),this.setInterval(TICK_INTERVAL$2),this.level=-1,!this.startFragRequested){let j=_.startLevel;j===-1&&(_.config.testBandwidth&&this.levels.length>1?(j=0,this.bitrateTest=!0):j=_.nextAutoLevel),this.level=_.nextLoadLevel=j,this.loadedmetadata=!1}g>0&&i===-1&&(this.log(`Override startPosition with lastCurrentTime @${g.toFixed(3)}`),i=g),this.state=State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=i,this.tick()}else this._forceStartLoad=!0,this.state=State.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case State.WAITING_LEVEL:{var i;const{levels:_,level:j}=this,$=_==null||(i=_[j])==null?void 0:i.details;if($&&(!$.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn($))break;this.state=State.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=State.IDLE;break}break}case State.FRAG_LOADING_WAITING_RETRY:{var g;const _=self.performance.now(),j=this.retryDate;(!j||_>=j||(g=this.media)!=null&&g.seeking)&&(this.resetStartWhenNotLoaded(this.level),this.state=State.IDLE)}break}this.state===State.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){super.onTickEnd(),this.checkBuffer(),this.checkFragmentChanged()}doTickIdle(){const{hls:i,levelLastLoaded:g,levels:_,media:j}=this,{config:$,nextLoadLevel:_n}=i;if(g===null||!j&&(this.startFragRequested||!$.startFragPrefetch)||this.altAudio&&this.audioOnly||!(_!=null&&_[_n]))return;const _i=_[_n],_s=this.getMainFwdBufferInfo();if(_s===null)return;const ga=this.getLevelDetails();if(ga&&this._streamEnded(_s,ga)){const Cl={};this.altAudio&&(Cl.type="video"),this.hls.trigger(Events.BUFFER_EOS,Cl),this.state=State.ENDED;return}i.loadLevel!==_n&&i.manualLevel===-1&&this.log(`Adapting to level ${_n} from level ${this.level}`),this.level=i.nextLoadLevel=_n;const ba=_i.details;if(!ba||this.state===State.WAITING_LEVEL||ba.live&&this.levelLastLoaded!==_n){this.level=_n,this.state=State.WAITING_LEVEL;return}const xa=_s.len,El=this.getMaxBufferLength(_i.maxBitrate);if(xa>=El)return;this.backtrackFragment&&this.backtrackFragment.start>_s.end&&(this.backtrackFragment=null);const Tl=this.backtrackFragment?this.backtrackFragment.start:_s.end;let Sl=this.getNextFragment(Tl,ba);if(this.couldBacktrack&&!this.fragPrevious&&Sl&&Sl.sn!=="initSegment"&&this.fragmentTracker.getState(Sl)!==FragmentState.OK){var Il;const Nl=((Il=this.backtrackFragment)!=null?Il:Sl).sn-ba.startSN,Dl=ba.fragments[Nl-1];Dl&&Sl.cc===Dl.cc&&(Sl=Dl,this.fragmentTracker.removeFragment(Dl))}else this.backtrackFragment&&_s.len&&(this.backtrackFragment=null);if(Sl&&this.isLoopLoading(Sl,Tl)){if(!Sl.gap){const Nl=this.audioOnly&&!this.altAudio?ElementaryStreamTypes.AUDIO:ElementaryStreamTypes.VIDEO,Dl=(Nl===ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;Dl&&this.afterBufferFlushed(Dl,Nl,PlaylistLevelType.MAIN)}Sl=this.getNextFragmentLoopLoading(Sl,ba,_s,PlaylistLevelType.MAIN,El)}Sl&&(Sl.initSegment&&!Sl.initSegment.data&&!this.bitrateTest&&(Sl=Sl.initSegment),this.loadFragment(Sl,_i,Tl))}loadFragment(i,g,_){const j=this.fragmentTracker.getState(i);this.fragCurrent=i,j===FragmentState.NOT_LOADED||j===FragmentState.PARTIAL?i.sn==="initSegment"?this._loadInitSegment(i,g):this.bitrateTest?(this.log(`Fragment ${i.sn} of level ${i.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(i,g)):(this.startFragRequested=!0,super.loadFragment(i,g,_)):this.clearTrackerIfNeeded(i)}getBufferedFrag(i){return this.fragmentTracker.getBufferedFrag(i,PlaylistLevelType.MAIN)}followingBufferedFrag(i){return i?this.getBufferedFrag(i.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:i,media:g}=this;if(g!=null&&g.readyState){let _;const j=this.getAppendedFrag(g.currentTime);j&&j.start>1&&this.flushMainBuffer(0,j.start-1);const $=this.getLevelDetails();if($!=null&&$.live){const _i=this.getMainFwdBufferInfo();if(!_i||_i.len<$.targetduration*2)return}if(!g.paused&&i){const _i=this.hls.nextLoadLevel,_s=i[_i],ga=this.fragLastKbps;ga&&this.fragCurrent?_=this.fragCurrent.duration*_s.maxBitrate/(1e3*ga)+1:_=0}else _=0;const _n=this.getBufferedFrag(g.currentTime+_);if(_n){const _i=this.followingBufferedFrag(_n);if(_i){this.abortCurrentFrag();const _s=_i.maxStartPTS?_i.maxStartPTS:_i.start,ga=_i.duration,ba=Math.max(_n.end,_s+Math.min(Math.max(ga-this.config.maxFragLookUpTolerance,ga*.5),ga*.75));this.flushMainBuffer(ba,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const i=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,i&&(i.abortRequests(),this.fragmentTracker.removeFragment(i)),this.state){case State.KEY_LOADING:case State.FRAG_LOADING:case State.FRAG_LOADING_WAITING_RETRY:case State.PARSING:case State.PARSED:this.state=State.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(i,g){super.flushMainBuffer(i,g,this.altAudio?"video":null)}onMediaAttached(i,g){super.onMediaAttached(i,g);const _=g.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),_.addEventListener("playing",this.onvplaying),_.addEventListener("seeked",this.onvseeked),this.gapController=new GapController(this.config,_,this.fragmentTracker,this.hls)}onMediaDetaching(){const{media:i}=this;i&&this.onvplaying&&this.onvseeked&&(i.removeEventListener("playing",this.onvplaying),i.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),super.onMediaDetaching()}onMediaPlaying(){this.tick()}onMediaSeeked(){const i=this.media,g=i?i.currentTime:null;isFiniteNumber(g)&&this.log(`Media seeked to ${g.toFixed(3)}`);const _=this.getMainFwdBufferInfo();if(_===null||_.len===0){this.warn(`Main forward buffer length on "seeked" event ${_?_.len:"empty"})`);return}this.tick()}onManifestLoading(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=0,this.levels=this.fragPlaying=this.backtrackFragment=null,this.altAudio=this.audioOnly=!1}onManifestParsed(i,g){let _=!1,j=!1,$;g.levels.forEach(_n=>{$=_n.audioCodec,$&&($.indexOf("mp4a.40.2")!==-1&&(_=!0),$.indexOf("mp4a.40.5")!==-1&&(j=!0))}),this.audioCodecSwitch=_&&j&&!changeTypeSupported(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=g.levels,this.startFragRequested=!1}onLevelLoading(i,g){const{levels:_}=this;if(!_||this.state!==State.IDLE)return;const j=_[g.level];(!j.details||j.details.live&&this.levelLastLoaded!==g.level||this.waitForCdnTuneIn(j.details))&&(this.state=State.WAITING_LEVEL)}onLevelLoaded(i,g){var _;const{levels:j}=this,$=g.level,_n=g.details,_i=_n.totalduration;if(!j){this.warn(`Levels were reset while loading level ${$}`);return}this.log(`Level ${$} loaded [${_n.startSN},${_n.endSN}]${_n.lastPartSn?`[part-${_n.lastPartSn}-${_n.lastPartIndex}]`:""}, cc [${_n.startCC}, ${_n.endCC}] duration:${_i}`);const _s=j[$],ga=this.fragCurrent;ga&&(this.state===State.FRAG_LOADING||this.state===State.FRAG_LOADING_WAITING_RETRY)&&(ga.level!==g.level||ga.urlId!==_s.urlId)&&ga.loader&&this.abortCurrentFrag();let ba=0;if(_n.live||(_=_s.details)!=null&&_.live){if(_n.fragments[0]||(_n.deltaUpdateFailed=!0),_n.deltaUpdateFailed)return;ba=this.alignPlaylists(_n,_s.details)}if(_s.details=_n,this.levelLastLoaded=$,this.hls.trigger(Events.LEVEL_UPDATED,{details:_n,level:$}),this.state===State.WAITING_LEVEL){if(this.waitForCdnTuneIn(_n))return;this.state=State.IDLE}this.startFragRequested?_n.live&&this.synchronizeToLiveEdge(_n):this.setStartPosition(_n,ba),this.tick()}_handleFragmentLoadProgress(i){var g;const{frag:_,part:j,payload:$}=i,{levels:_n}=this;if(!_n){this.warn(`Levels were reset while fragment load was in progress. Fragment ${_.sn} of level ${_.level} will not be buffered`);return}const _i=_n[_.level],_s=_i.details;if(!_s){this.warn(`Dropping fragment ${_.sn} of level ${_.level} after level details were reset`),this.fragmentTracker.removeFragment(_);return}const ga=_i.videoCodec,ba=_s.PTSKnown||!_s.live,xa=(g=_.initSegment)==null?void 0:g.data,El=this._getAudioCodec(_i),Tl=this.transmuxer=this.transmuxer||new TransmuxerInterface(this.hls,PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),Sl=j?j.index:-1,Il=Sl!==-1,Cl=new ChunkMetadata(_.level,_.sn,_.stats.chunkCount,$.byteLength,Sl,Il),Nl=this.initPTS[_.cc];Tl.push($,xa,El,ga,_,j,_s.totalduration,ba,Cl,Nl)}onAudioTrackSwitching(i,g){const _=this.altAudio;if(!!!g.url){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const _n=this.fragCurrent;_n&&(this.log("Switching to main audio track, cancel main fragment load"),_n.abortRequests(),this.fragmentTracker.removeFragment(_n)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();const $=this.hls;_&&($.trigger(Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null}),this.fragmentTracker.removeAllFragments()),$.trigger(Events.AUDIO_TRACK_SWITCHED,g)}}onAudioTrackSwitched(i,g){const _=g.id,j=!!this.hls.audioTracks[_].url;if(j){const $=this.videoBuffer;$&&this.mediaBuffer!==$&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=$)}this.altAudio=j,this.tick()}onBufferCreated(i,g){const _=g.tracks;let j,$,_n=!1;for(const _i in _){const _s=_[_i];if(_s.id==="main"){if($=_i,j=_s,_i==="video"){const ga=_[_i];ga&&(this.videoBuffer=ga.buffer)}}else _n=!0}_n&&j?(this.log(`Alternate track found, use ${$}.buffered to schedule main fragment loading`),this.mediaBuffer=j.buffer):this.mediaBuffer=this.media}onFragBuffered(i,g){const{frag:_,part:j}=g;if(_&&_.type!==PlaylistLevelType.MAIN)return;if(this.fragContextChanged(_)){this.warn(`Fragment ${_.sn}${j?" p: "+j.index:""} of level ${_.level} finished buffering, but was aborted. state: ${this.state}`),this.state===State.PARSED&&(this.state=State.IDLE);return}const $=j?j.stats:_.stats;this.fragLastKbps=Math.round(8*$.total/($.buffering.end-$.loading.first)),_.sn!=="initSegment"&&(this.fragPrevious=_),this.fragBufferedComplete(_,j)}onError(i,g){var _;if(g.fatal){this.state=State.ERROR;return}switch(g.details){case ErrorDetails.FRAG_GAP:case ErrorDetails.FRAG_PARSING_ERROR:case ErrorDetails.FRAG_DECRYPT_ERROR:case ErrorDetails.FRAG_LOAD_ERROR:case ErrorDetails.FRAG_LOAD_TIMEOUT:case ErrorDetails.KEY_LOAD_ERROR:case ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(PlaylistLevelType.MAIN,g);break;case ErrorDetails.LEVEL_LOAD_ERROR:case ErrorDetails.LEVEL_LOAD_TIMEOUT:case ErrorDetails.LEVEL_PARSING_ERROR:!g.levelRetry&&this.state===State.WAITING_LEVEL&&((_=g.context)==null?void 0:_.type)===PlaylistContextType.LEVEL&&(this.state=State.IDLE);break;case ErrorDetails.BUFFER_FULL_ERROR:if(!g.parent||g.parent!=="main")return;this.reduceLengthAndFlushBuffer(g)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case ErrorDetails.INTERNAL_EXCEPTION:this.recoverWorkerError(g);break}}checkBuffer(){const{media:i,gapController:g}=this;if(!(!i||!g||!i.readyState)){if(this.loadedmetadata||!BufferHelper.getBuffered(i).length){const _=this.state!==State.IDLE?this.fragCurrent:null;g.poll(this.lastCurrentTime,_)}this.lastCurrentTime=i.currentTime}}onFragLoadEmergencyAborted(){this.state=State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()}onBufferFlushed(i,{type:g}){if(g!==ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){const _=(g===ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(_,g,PlaylistLevelType.MAIN)}}onLevelsUpdated(i,g){this.levels=g.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:i}=this;if(!i)return;const g=i.currentTime;let _=this.startPosition;if(_>=0&&g<_){if(i.seeking){this.log(`could not seek to ${_}, already seeking at ${g}`);return}const j=BufferHelper.getBuffered(i),_n=(j.length?j.start(0):0)-_;_n>0&&(_n<this.config.maxBufferHole||_n<this.config.maxFragLookUpTolerance)&&(this.log(`adjusting start position by ${_n} to match buffer start`),_+=_n,this.startPosition=_),this.log(`seek to target start position ${_} from current time ${g}`),i.currentTime=_}}_getAudioCodec(i){let g=this.config.defaultAudioCodec||i.audioCodec;return this.audioCodecSwap&&g&&(this.log("Swapping audio codec"),g.indexOf("mp4a.40.5")!==-1?g="mp4a.40.2":g="mp4a.40.5"),g}_loadBitrateTestFrag(i,g){i.bitrateTest=!0,this._doFragLoad(i,g).then(_=>{const{hls:j}=this;if(!_||this.fragContextChanged(i))return;g.fragmentError=0,this.state=State.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const $=i.stats;$.parsing.start=$.parsing.end=$.buffering.start=$.buffering.end=self.performance.now(),j.trigger(Events.FRAG_LOADED,_),i.bitrateTest=!1})}_handleTransmuxComplete(i){var g;const _="main",{hls:j}=this,{remuxResult:$,chunkMeta:_n}=i,_i=this.getCurrentContext(_n);if(!_i){this.resetWhenMissingContext(_n);return}const{frag:_s,part:ga,level:ba}=_i,{video:xa,text:El,id3:Tl,initSegment:Sl}=$,{details:Il}=ba,Cl=this.altAudio?void 0:$.audio;if(this.fragContextChanged(_s)){this.fragmentTracker.removeFragment(_s);return}if(this.state=State.PARSING,Sl){if(Sl!=null&&Sl.tracks){const Ul=_s.initSegment||_s;this._bufferInitSegment(ba,Sl.tracks,Ul,_n),j.trigger(Events.FRAG_PARSING_INIT_SEGMENT,{frag:Ul,id:_,tracks:Sl.tracks})}const Nl=Sl.initPTS,Dl=Sl.timescale;isFiniteNumber(Nl)&&(this.initPTS[_s.cc]={baseTime:Nl,timescale:Dl},j.trigger(Events.INIT_PTS_FOUND,{frag:_s,id:_,initPTS:Nl,timescale:Dl}))}if(xa&&$.independent!==!1){if(Il){const{startPTS:Nl,endPTS:Dl,startDTS:Ul,endDTS:Kl}=xa;if(ga)ga.elementaryStreams[xa.type]={startPTS:Nl,endPTS:Dl,startDTS:Ul,endDTS:Kl};else if(xa.firstKeyFrame&&xa.independent&&_n.id===1&&(this.couldBacktrack=!0),xa.dropped&&xa.independent){const Jl=this.getMainFwdBufferInfo(),Ep=(Jl?Jl.end:this.getLoadPosition())+this.config.maxBufferHole,_p=xa.firstKeyFramePTS?xa.firstKeyFramePTS:Nl;if(Ep<_p-this.config.maxBufferHole){this.backtrack(_s);return}_s.setElementaryStreamInfo(xa.type,_s.start,Dl,_s.start,Kl,!0)}_s.setElementaryStreamInfo(xa.type,Nl,Dl,Ul,Kl),this.backtrackFragment&&(this.backtrackFragment=_s),this.bufferFragmentData(xa,_s,ga,_n)}}else if($.independent===!1){this.backtrack(_s);return}if(Cl){const{startPTS:Nl,endPTS:Dl,startDTS:Ul,endDTS:Kl}=Cl;ga&&(ga.elementaryStreams[ElementaryStreamTypes.AUDIO]={startPTS:Nl,endPTS:Dl,startDTS:Ul,endDTS:Kl}),_s.setElementaryStreamInfo(ElementaryStreamTypes.AUDIO,Nl,Dl,Ul,Kl),this.bufferFragmentData(Cl,_s,ga,_n)}if(Il&&Tl!=null&&(g=Tl.samples)!=null&&g.length){const Nl={id:_,frag:_s,details:Il,samples:Tl.samples};j.trigger(Events.FRAG_PARSING_METADATA,Nl)}if(Il&&El){const Nl={id:_,frag:_s,details:Il,samples:El.samples};j.trigger(Events.FRAG_PARSING_USERDATA,Nl)}}_bufferInitSegment(i,g,_,j){if(this.state!==State.PARSING)return;this.audioOnly=!!g.audio&&!g.video,this.altAudio&&!this.audioOnly&&delete g.audio;const{audio:$,video:_n,audiovideo:_i}=g;if($){let _s=i.audioCodec;const ga=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(_s&&(_s.indexOf("mp4a.40.5")!==-1?_s="mp4a.40.2":_s="mp4a.40.5"),$.metadata.channelCount!==1&&ga.indexOf("firefox")===-1&&(_s="mp4a.40.5")),ga.indexOf("android")!==-1&&$.container!=="audio/mpeg"&&(_s="mp4a.40.2",this.log(`Android: force audio codec to ${_s}`)),i.audioCodec&&i.audioCodec!==_s&&this.log(`Swapping manifest audio codec "${i.audioCodec}" for "${_s}"`),$.levelCodec=_s,$.id="main",this.log(`Init audio buffer, container:${$.container}, codecs[selected/level/parsed]=[${_s||""}/${i.audioCodec||""}/${$.codec}]`)}_n&&(_n.levelCodec=i.videoCodec,_n.id="main",this.log(`Init video buffer, container:${_n.container}, codecs[level/parsed]=[${i.videoCodec||""}/${_n.codec}]`)),_i&&this.log(`Init audiovideo buffer, container:${_i.container}, codecs[level/parsed]=[${i.attrs.CODECS||""}/${_i.codec}]`),this.hls.trigger(Events.BUFFER_CODECS,g),Object.keys(g).forEach(_s=>{const ba=g[_s].initSegment;ba!=null&&ba.byteLength&&this.hls.trigger(Events.BUFFER_APPENDING,{type:_s,data:ba,frag:_,part:null,chunkMeta:j,parent:_.type})}),this.tick()}getMainFwdBufferInfo(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,PlaylistLevelType.MAIN)}backtrack(i){this.couldBacktrack=!0,this.backtrackFragment=i,this.resetTransmuxer(),this.flushBufferGap(i),this.fragmentTracker.removeFragment(i),this.fragPrevious=null,this.nextLoadPosition=i.start,this.state=State.IDLE}checkFragmentChanged(){const i=this.media;let g=null;if(i&&i.readyState>1&&i.seeking===!1){const _=i.currentTime;if(BufferHelper.isBuffered(i,_)?g=this.getAppendedFrag(_):BufferHelper.isBuffered(i,_+.1)&&(g=this.getAppendedFrag(_+.1)),g){this.backtrackFragment=null;const j=this.fragPlaying,$=g.level;(!j||g.sn!==j.sn||j.level!==$||g.urlId!==j.urlId)&&(this.fragPlaying=g,this.hls.trigger(Events.FRAG_CHANGED,{frag:g}),(!j||j.level!==$)&&this.hls.trigger(Events.LEVEL_SWITCHED,{level:$}))}}}get nextLevel(){const i=this.nextBufferedFrag;return i?i.level:-1}get currentFrag(){const i=this.media;return i?this.fragPlaying||this.getAppendedFrag(i.currentTime):null}get currentProgramDateTime(){const i=this.media;if(i){const g=i.currentTime,_=this.currentFrag;if(_&&isFiniteNumber(g)&&isFiniteNumber(_.programDateTime)){const j=_.programDateTime+(g-_.start)*1e3;return new Date(j)}}return null}get currentLevel(){const i=this.currentFrag;return i?i.level:-1}get nextBufferedFrag(){const i=this.currentFrag;return i?this.followingBufferedFrag(i):null}get forceStartLoad(){return this._forceStartLoad}}class EWMA{constructor(i,g=0,_=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=i,this.alpha_=i?Math.exp(Math.log(.5)/i):0,this.estimate_=g,this.totalWeight_=_}sample(i,g){const _=Math.pow(this.alpha_,i);this.estimate_=g*(1-_)+_*this.estimate_,this.totalWeight_+=i}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const i=1-Math.pow(this.alpha_,this.totalWeight_);if(i)return this.estimate_/i}return this.estimate_}}class EwmaBandWidthEstimator{constructor(i,g,_,j=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=_,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new EWMA(i),this.fast_=new EWMA(g),this.defaultTTFB_=j,this.ttfb_=new EWMA(i)}update(i,g){const{slow_:_,fast_:j,ttfb_:$}=this;_.halfLife!==i&&(this.slow_=new EWMA(i,_.getEstimate(),_.getTotalWeight())),j.halfLife!==g&&(this.fast_=new EWMA(g,j.getEstimate(),j.getTotalWeight())),$.halfLife!==i&&(this.ttfb_=new EWMA(i,$.getEstimate(),$.getTotalWeight()))}sample(i,g){i=Math.max(i,this.minDelayMs_);const _=8*g,j=i/1e3,$=_/j;this.fast_.sample(j,$),this.slow_.sample(j,$)}sampleTTFB(i){const g=i/1e3,_=Math.sqrt(2)*Math.exp(-Math.pow(g,2)/2);this.ttfb_.sample(_,Math.max(i,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}destroy(){}}class AbrController{constructor(i){this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=-1,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=i;const g=i.config;this.bwEstimator=new EwmaBandWidthEstimator(g.abrEwmaSlowVoD,g.abrEwmaFastVoD,g.abrEwmaDefaultEstimate),this.registerListeners()}registerListeners(){const{hls:i}=this;i.on(Events.FRAG_LOADING,this.onFragLoading,this),i.on(Events.FRAG_LOADED,this.onFragLoaded,this),i.on(Events.FRAG_BUFFERED,this.onFragBuffered,this),i.on(Events.LEVEL_SWITCHING,this.onLevelSwitching,this),i.on(Events.LEVEL_LOADED,this.onLevelLoaded,this)}unregisterListeners(){const{hls:i}=this;i.off(Events.FRAG_LOADING,this.onFragLoading,this),i.off(Events.FRAG_LOADED,this.onFragLoaded,this),i.off(Events.FRAG_BUFFERED,this.onFragBuffered,this),i.off(Events.LEVEL_SWITCHING,this.onLevelSwitching,this),i.off(Events.LEVEL_LOADED,this.onLevelLoaded,this)}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null}onFragLoading(i,g){var _;const j=g.frag;this.ignoreFragment(j)||(this.fragCurrent=j,this.partCurrent=(_=g.part)!=null?_:null,this.clearTimer(),this.timer=self.setInterval(this.onCheck,100))}onLevelSwitching(i,g){this.clearTimer()}getTimeToLoadFrag(i,g,_,j){const $=i+_/g,_n=j?this.lastLevelLoadSec:0;return $+_n}onLevelLoaded(i,g){const _=this.hls.config,{total:j,bwEstimate:$}=g.stats;isFiniteNumber(j)&&isFiniteNumber($)&&(this.lastLevelLoadSec=8*j/$),g.details.live?this.bwEstimator.update(_.abrEwmaSlowLive,_.abrEwmaFastLive):this.bwEstimator.update(_.abrEwmaSlowVoD,_.abrEwmaFastVoD)}_abandonRulesCheck(){const{fragCurrent:i,partCurrent:g,hls:_}=this,{autoLevelEnabled:j,media:$}=_;if(!i||!$)return;const _n=performance.now(),_i=g?g.stats:i.stats,_s=g?g.duration:i.duration,ga=_n-_i.loading.start;if(_i.aborted||_i.loaded&&_i.loaded===_i.total||i.level===0){this.clearTimer(),this._nextAutoLevel=-1;return}if(!j||$.paused||!$.playbackRate||!$.readyState)return;const ba=_.mainForwardBufferInfo;if(ba===null)return;const xa=this.bwEstimator.getEstimateTTFB(),El=Math.abs($.playbackRate);if(ga<=Math.max(xa,1e3*(_s/(El*2))))return;const Tl=ba.len/El;if(Tl>=2*_s/El)return;const Sl=_i.loading.first?_i.loading.first-_i.loading.start:-1,Il=_i.loaded&&Sl>-1,Cl=this.bwEstimator.getEstimate(),{levels:Nl,minAutoLevel:Dl}=_,Ul=Nl[i.level],Kl=_i.total||Math.max(_i.loaded,Math.round(_s*Ul.maxBitrate/8));let Jl=ga-Sl;Jl<1&&Il&&(Jl=Math.min(ga,_i.loaded*8/Cl));const Ep=Il?_i.loaded*1e3/Jl:0,_p=Ep?(Kl-_i.loaded)/Ep:Kl*8/Cl+xa/1e3;if(_p<=Tl)return;const Ip=Ep?Ep*8:Cl;let Up=Number.POSITIVE_INFINITY,yp;for(yp=i.level-1;yp>Dl;yp--){const Ap=Nl[yp].maxBitrate;if(Up=this.getTimeToLoadFrag(xa/1e3,Ip,_s*Ap,!Nl[yp].details),Up<Tl)break}Up>=_p||Up>_s*10||(_.nextLoadLevel=yp,Il?this.bwEstimator.sample(ga-Math.min(xa,Sl),_i.loaded):this.bwEstimator.sampleTTFB(ga),this.clearTimer(),logger.warn(`[abr] Fragment ${i.sn}${g?" part "+g.index:""} of level ${i.level} is loading too slowly;
      Time to underbuffer: ${Tl.toFixed(3)} s
      Estimated load time for current fragment: ${_p.toFixed(3)} s
      Estimated load time for down switch fragment: ${Up.toFixed(3)} s
      TTFB estimate: ${Sl}
      Current BW estimate: ${isFiniteNumber(Cl)?(Cl/1024).toFixed(3):"Unknown"} Kb/s
      New BW estimate: ${(this.bwEstimator.getEstimate()/1024).toFixed(3)} Kb/s
      Aborting and switching to level ${yp}`),i.loader&&(this.fragCurrent=this.partCurrent=null,i.abortRequests()),_.trigger(Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:i,part:g,stats:_i}))}onFragLoaded(i,{frag:g,part:_}){const j=_?_.stats:g.stats;if(g.type===PlaylistLevelType.MAIN&&this.bwEstimator.sampleTTFB(j.loading.first-j.loading.start),!this.ignoreFragment(g)){if(this.clearTimer(),this.lastLoadedFragLevel=g.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){const $=_?_.duration:g.duration,_n=this.hls.levels[g.level],_i=(_n.loaded?_n.loaded.bytes:0)+j.loaded,_s=(_n.loaded?_n.loaded.duration:0)+$;_n.loaded={bytes:_i,duration:_s},_n.realBitrate=Math.round(8*_i/_s)}if(g.bitrateTest){const $={stats:j,frag:g,part:_,id:g.type};this.onFragBuffered(Events.FRAG_BUFFERED,$),g.bitrateTest=!1}}}onFragBuffered(i,g){const{frag:_,part:j}=g,$=j!=null&&j.stats.loaded?j.stats:_.stats;if($.aborted||this.ignoreFragment(_))return;const _n=$.parsing.end-$.loading.start-Math.min($.loading.first-$.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(_n,$.loaded),$.bwEstimate=this.bwEstimator.getEstimate(),_.bitrateTest?this.bitrateTestDelay=_n/1e3:this.bitrateTestDelay=0}ignoreFragment(i){return i.type!==PlaylistLevelType.MAIN||i.sn==="initSegment"}clearTimer(){self.clearInterval(this.timer)}get nextAutoLevel(){const i=this._nextAutoLevel,g=this.bwEstimator;if(i!==-1&&!g.canEstimate())return i;let _=this.getNextABRAutoLevel();if(i!==-1){const j=this.hls.levels;if(j.length>Math.max(i,_)&&j[i].loadError<=j[_].loadError)return i}return i!==-1&&(_=Math.min(i,_)),_}getNextABRAutoLevel(){const{fragCurrent:i,partCurrent:g,hls:_}=this,{maxAutoLevel:j,config:$,minAutoLevel:_n,media:_i}=_,_s=g?g.duration:i?i.duration:0,ga=_i&&_i.playbackRate!==0?Math.abs(_i.playbackRate):1,ba=this.bwEstimator?this.bwEstimator.getEstimate():$.abrEwmaDefaultEstimate,xa=_.mainForwardBufferInfo,El=(xa?xa.len:0)/ga;let Tl=this.findBestLevel(ba,_n,j,El,$.abrBandWidthFactor,$.abrBandWidthUpFactor);if(Tl>=0)return Tl;logger.trace(`[abr] ${El?"rebuffering expected":"buffer is empty"}, finding optimal quality level`);let Sl=_s?Math.min(_s,$.maxStarvationDelay):$.maxStarvationDelay,Il=$.abrBandWidthFactor,Cl=$.abrBandWidthUpFactor;if(!El){const Nl=this.bitrateTestDelay;Nl&&(Sl=(_s?Math.min(_s,$.maxLoadingDelay):$.maxLoadingDelay)-Nl,logger.trace(`[abr] bitrate test took ${Math.round(1e3*Nl)}ms, set first fragment max fetchDuration to ${Math.round(1e3*Sl)} ms`),Il=Cl=1)}return Tl=this.findBestLevel(ba,_n,j,El+Sl,Il,Cl),Math.max(Tl,0)}findBestLevel(i,g,_,j,$,_n){var _i;const{fragCurrent:_s,partCurrent:ga,lastLoadedFragLevel:ba}=this,{levels:xa}=this.hls,El=xa[ba],Tl=!!(El!=null&&(_i=El.details)!=null&&_i.live),Sl=El==null?void 0:El.codecSet,Il=ga?ga.duration:_s?_s.duration:0,Cl=this.bwEstimator.getEstimateTTFB()/1e3;let Nl=g,Dl=-1;for(let Ul=_;Ul>=g;Ul--){const Kl=xa[Ul];if(!Kl||Sl&&Kl.codecSet!==Sl){Kl&&(Nl=Math.min(Ul,Nl),Dl=Math.max(Ul,Dl));continue}Dl!==-1&&logger.trace(`[abr] Skipped level(s) ${Nl}-${Dl} with CODECS:"${xa[Dl].attrs.CODECS}"; not compatible with "${El.attrs.CODECS}"`);const Jl=Kl.details,Ep=(ga?Jl==null?void 0:Jl.partTarget:Jl==null?void 0:Jl.averagetargetduration)||Il;let _p;Ul<=ba?_p=$*i:_p=_n*i;const Ip=xa[Ul].maxBitrate,Up=this.getTimeToLoadFrag(Cl,_p,Ip*Ep,Jl===void 0);if(logger.trace(`[abr] level:${Ul} adjustedbw-bitrate:${Math.round(_p-Ip)} avgDuration:${Ep.toFixed(1)} maxFetchDuration:${j.toFixed(1)} fetchDuration:${Up.toFixed(1)}`),_p>Ip&&(Up===0||!isFiniteNumber(Up)||Tl&&!this.bitrateTestDelay||Up<j))return Ul}return-1}set nextAutoLevel(i){this._nextAutoLevel=i}}class ChunkCache{constructor(){this.chunks=[],this.dataLength=0}push(i){this.chunks.push(i),this.dataLength+=i.length}flush(){const{chunks:i,dataLength:g}=this;let _;if(i.length)i.length===1?_=i[0]:_=concatUint8Arrays(i,g);else return new Uint8Array(0);return this.reset(),_}reset(){this.chunks.length=0,this.dataLength=0}}function concatUint8Arrays(h,i){const g=new Uint8Array(i);let _=0;for(let j=0;j<h.length;j++){const $=h[j];g.set($,_),_+=$.length}return g}const TICK_INTERVAL$1=100;class AudioStreamController extends BaseStreamController{constructor(i,g,_){super(i,g,_,"[audio-stream-controller]",PlaylistLevelType.AUDIO),this.videoBuffer=null,this.videoTrackCC=-1,this.waitingVideoCC=-1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),this.mainDetails=null,this.bufferedTrack=null,this.switchingTrack=null}_registerListeners(){const{hls:i}=this;i.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),i.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),i.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),i.on(Events.LEVEL_LOADED,this.onLevelLoaded,this),i.on(Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),i.on(Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),i.on(Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),i.on(Events.ERROR,this.onError,this),i.on(Events.BUFFER_RESET,this.onBufferReset,this),i.on(Events.BUFFER_CREATED,this.onBufferCreated,this),i.on(Events.BUFFER_FLUSHED,this.onBufferFlushed,this),i.on(Events.INIT_PTS_FOUND,this.onInitPtsFound,this),i.on(Events.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:i}=this;i.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),i.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),i.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),i.off(Events.LEVEL_LOADED,this.onLevelLoaded,this),i.off(Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),i.off(Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),i.off(Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),i.off(Events.ERROR,this.onError,this),i.off(Events.BUFFER_RESET,this.onBufferReset,this),i.off(Events.BUFFER_CREATED,this.onBufferCreated,this),i.off(Events.BUFFER_FLUSHED,this.onBufferFlushed,this),i.off(Events.INIT_PTS_FOUND,this.onInitPtsFound,this),i.off(Events.FRAG_BUFFERED,this.onFragBuffered,this)}onInitPtsFound(i,{frag:g,id:_,initPTS:j,timescale:$}){if(_==="main"){const _n=g.cc;this.initPTS[g.cc]={baseTime:j,timescale:$},this.log(`InitPTS for cc: ${_n} found from main: ${j}`),this.videoTrackCC=_n,this.state===State.WAITING_INIT_PTS&&this.tick()}}startLoad(i){if(!this.levels){this.startPosition=i,this.state=State.STOPPED;return}const g=this.lastCurrentTime;this.stopLoad(),this.setInterval(TICK_INTERVAL$1),g>0&&i===-1?(this.log(`Override startPosition with lastCurrentTime @${g.toFixed(3)}`),i=g,this.state=State.IDLE):(this.loadedmetadata=!1,this.state=State.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=i,this.tick()}doTick(){switch(this.state){case State.IDLE:this.doTickIdle();break;case State.WAITING_TRACK:{var i;const{levels:_,trackId:j}=this,$=_==null||(i=_[j])==null?void 0:i.details;if($){if(this.waitForCdnTuneIn($))break;this.state=State.WAITING_INIT_PTS}break}case State.FRAG_LOADING_WAITING_RETRY:{var g;const _=performance.now(),j=this.retryDate;(!j||_>=j||(g=this.media)!=null&&g.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded(this.trackId),this.state=State.IDLE);break}case State.WAITING_INIT_PTS:{const _=this.waitingData;if(_){const{frag:j,part:$,cache:_n,complete:_i}=_;if(this.initPTS[j.cc]!==void 0){this.waitingData=null,this.waitingVideoCC=-1,this.state=State.FRAG_LOADING;const _s=_n.flush(),ga={frag:j,part:$,payload:_s,networkDetails:null};this._handleFragmentLoadProgress(ga),_i&&super._handleFragmentLoadComplete(ga)}else if(this.videoTrackCC!==this.waitingVideoCC)this.log(`Waiting fragment cc (${j.cc}) cancelled because video is at cc ${this.videoTrackCC}`),this.clearWaitingFragment();else{const _s=this.getLoadPosition(),ga=BufferHelper.bufferInfo(this.mediaBuffer,_s,this.config.maxBufferHole);fragmentWithinToleranceTest(ga.end,this.config.maxFragLookUpTolerance,j)<0&&(this.log(`Waiting fragment cc (${j.cc}) @ ${j.start} cancelled because another fragment at ${ga.end} is needed`),this.clearWaitingFragment())}}else this.state=State.IDLE}}this.onTickEnd()}clearWaitingFragment(){const i=this.waitingData;i&&(this.fragmentTracker.removeFragment(i.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=State.IDLE)}resetLoadingState(){this.clearWaitingFragment(),super.resetLoadingState()}onTickEnd(){const{media:i}=this;i!=null&&i.readyState&&(this.lastCurrentTime=i.currentTime)}doTickIdle(){const{hls:i,levels:g,media:_,trackId:j}=this,$=i.config;if(!(g!=null&&g[j])||!_&&(this.startFragRequested||!$.startFragPrefetch))return;const _n=g[j],_i=_n.details;if(!_i||_i.live&&this.levelLastLoaded!==j||this.waitForCdnTuneIn(_i)){this.state=State.WAITING_TRACK;return}const _s=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&_s&&(this.bufferFlushed=!1,this.afterBufferFlushed(_s,ElementaryStreamTypes.AUDIO,PlaylistLevelType.AUDIO));const ga=this.getFwdBufferInfo(_s,PlaylistLevelType.AUDIO);if(ga===null)return;const{bufferedTrack:ba,switchingTrack:xa}=this;if(!xa&&this._streamEnded(ga,_i)){i.trigger(Events.BUFFER_EOS,{type:"audio"}),this.state=State.ENDED;return}const El=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,PlaylistLevelType.MAIN),Tl=ga.len,Sl=this.getMaxBufferLength(El==null?void 0:El.len);if(Tl>=Sl&&!xa)return;const Cl=_i.fragments[0].start;let Nl=ga.end;if(xa&&_){const Jl=this.getLoadPosition();ba&&xa.attrs!==ba.attrs&&(Nl=Jl),_i.PTSKnown&&Jl<Cl&&(ga.end>Cl||ga.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),_.currentTime=Cl+.05)}let Dl=this.getNextFragment(Nl,_i),Ul=!1;if(Dl&&this.isLoopLoading(Dl,Nl)&&(Ul=!!Dl.gap,Dl=this.getNextFragmentLoopLoading(Dl,_i,ga,PlaylistLevelType.MAIN,Sl)),!Dl){this.bufferFlushed=!0;return}const Kl=El&&Dl.start>El.end+_i.targetduration;if(Kl||!(El!=null&&El.len)&&ga.len){const Jl=this.getAppendedFrag(Dl.start,PlaylistLevelType.MAIN);if(Jl===null||(Ul||(Ul=!!Jl.gap||!!Kl&&El.len===0),Kl&&!Ul||Ul&&ga.nextStart&&ga.nextStart<Jl.end))return}this.loadFragment(Dl,_n,Nl)}getMaxBufferLength(i){const g=super.getMaxBufferLength();return i?Math.min(Math.max(g,i),this.config.maxMaxBufferLength):g}onMediaDetaching(){this.videoBuffer=null,super.onMediaDetaching()}onAudioTracksUpdated(i,{audioTracks:g}){this.resetTransmuxer(),this.levels=g.map(_=>new Level(_))}onAudioTrackSwitching(i,g){const _=!!g.url;this.trackId=g.id;const{fragCurrent:j}=this;j&&(j.abortRequests(),this.removeUnbufferedFrags(j.start)),this.resetLoadingState(),_?this.setInterval(TICK_INTERVAL$1):this.resetTransmuxer(),_?(this.switchingTrack=g,this.state=State.IDLE):(this.switchingTrack=null,this.bufferedTrack=g,this.state=State.STOPPED),this.tick()}onManifestLoading(){this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1,this.levels=this.mainDetails=this.waitingData=this.bufferedTrack=this.cachedTrackLoadedData=this.switchingTrack=null,this.startFragRequested=!1,this.trackId=this.videoTrackCC=this.waitingVideoCC=-1}onLevelLoaded(i,g){this.mainDetails=g.details,this.cachedTrackLoadedData!==null&&(this.hls.trigger(Events.AUDIO_TRACK_LOADED,this.cachedTrackLoadedData),this.cachedTrackLoadedData=null)}onAudioTrackLoaded(i,g){var _;if(this.mainDetails==null){this.cachedTrackLoadedData=g;return}const{levels:j}=this,{details:$,id:_n}=g;if(!j){this.warn(`Audio tracks were reset while loading level ${_n}`);return}this.log(`Track ${_n} loaded [${$.startSN},${$.endSN}]${$.lastPartSn?`[part-${$.lastPartSn}-${$.lastPartIndex}]`:""},duration:${$.totalduration}`);const _i=j[_n];let _s=0;if($.live||(_=_i.details)!=null&&_.live){const ga=this.mainDetails;if($.fragments[0]||($.deltaUpdateFailed=!0),$.deltaUpdateFailed||!ga)return;!_i.details&&$.hasProgramDateTime&&ga.hasProgramDateTime?(alignMediaPlaylistByPDT($,ga),_s=$.fragments[0].start):_s=this.alignPlaylists($,_i.details)}_i.details=$,this.levelLastLoaded=_n,!this.startFragRequested&&(this.mainDetails||!$.live)&&this.setStartPosition(_i.details,_s),this.state===State.WAITING_TRACK&&!this.waitForCdnTuneIn($)&&(this.state=State.IDLE),this.tick()}_handleFragmentLoadProgress(i){var g;const{frag:_,part:j,payload:$}=i,{config:_n,trackId:_i,levels:_s}=this;if(!_s){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${_.sn} of level ${_.level} will not be buffered`);return}const ga=_s[_i];if(!ga){this.warn("Audio track is undefined on fragment load progress");return}const ba=ga.details;if(!ba){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(_.start);return}const xa=_n.defaultAudioCodec||ga.audioCodec||"mp4a.40.2";let El=this.transmuxer;El||(El=this.transmuxer=new TransmuxerInterface(this.hls,PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const Tl=this.initPTS[_.cc],Sl=(g=_.initSegment)==null?void 0:g.data;if(Tl!==void 0){const Cl=j?j.index:-1,Nl=Cl!==-1,Dl=new ChunkMetadata(_.level,_.sn,_.stats.chunkCount,$.byteLength,Cl,Nl);El.push($,Sl,xa,"",_,j,ba.totalduration,!1,Dl,Tl)}else{this.log(`Unknown video PTS for cc ${_.cc}, waiting for video PTS before demuxing audio frag ${_.sn} of [${ba.startSN} ,${ba.endSN}],track ${_i}`);const{cache:Il}=this.waitingData=this.waitingData||{frag:_,part:j,cache:new ChunkCache,complete:!1};Il.push(new Uint8Array($)),this.waitingVideoCC=this.videoTrackCC,this.state=State.WAITING_INIT_PTS}}_handleFragmentLoadComplete(i){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(i)}onBufferReset(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1}onBufferCreated(i,g){const _=g.tracks.audio;_&&(this.mediaBuffer=_.buffer||null),g.tracks.video&&(this.videoBuffer=g.tracks.video.buffer||null)}onFragBuffered(i,g){const{frag:_,part:j}=g;if(_.type!==PlaylistLevelType.AUDIO){if(!this.loadedmetadata&&_.type===PlaylistLevelType.MAIN){const $=this.videoBuffer||this.media;$&&BufferHelper.getBuffered($).length&&(this.loadedmetadata=!0)}return}if(this.fragContextChanged(_)){this.warn(`Fragment ${_.sn}${j?" p: "+j.index:""} of level ${_.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(_.sn!=="initSegment"){this.fragPrevious=_;const $=this.switchingTrack;$&&(this.bufferedTrack=$,this.switchingTrack=null,this.hls.trigger(Events.AUDIO_TRACK_SWITCHED,_objectSpread2({},$)))}this.fragBufferedComplete(_,j)}onError(i,g){var _;if(g.fatal){this.state=State.ERROR;return}switch(g.details){case ErrorDetails.FRAG_GAP:case ErrorDetails.FRAG_PARSING_ERROR:case ErrorDetails.FRAG_DECRYPT_ERROR:case ErrorDetails.FRAG_LOAD_ERROR:case ErrorDetails.FRAG_LOAD_TIMEOUT:case ErrorDetails.KEY_LOAD_ERROR:case ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(PlaylistLevelType.AUDIO,g);break;case ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:case ErrorDetails.LEVEL_PARSING_ERROR:!g.levelRetry&&this.state===State.WAITING_TRACK&&((_=g.context)==null?void 0:_.type)===PlaylistContextType.AUDIO_TRACK&&(this.state=State.IDLE);break;case ErrorDetails.BUFFER_FULL_ERROR:if(!g.parent||g.parent!=="audio")return;this.reduceLengthAndFlushBuffer(g)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case ErrorDetails.INTERNAL_EXCEPTION:this.recoverWorkerError(g);break}}onBufferFlushed(i,{type:g}){g===ElementaryStreamTypes.AUDIO&&(this.bufferFlushed=!0,this.state===State.ENDED&&(this.state=State.IDLE))}_handleTransmuxComplete(i){var g;const _="audio",{hls:j}=this,{remuxResult:$,chunkMeta:_n}=i,_i=this.getCurrentContext(_n);if(!_i){this.resetWhenMissingContext(_n);return}const{frag:_s,part:ga,level:ba}=_i,{details:xa}=ba,{audio:El,text:Tl,id3:Sl,initSegment:Il}=$;if(this.fragContextChanged(_s)||!xa){this.fragmentTracker.removeFragment(_s);return}if(this.state=State.PARSING,this.switchingTrack&&El&&this.completeAudioSwitch(this.switchingTrack),Il!=null&&Il.tracks){const Cl=_s.initSegment||_s;this._bufferInitSegment(Il.tracks,Cl,_n),j.trigger(Events.FRAG_PARSING_INIT_SEGMENT,{frag:Cl,id:_,tracks:Il.tracks})}if(El){const{startPTS:Cl,endPTS:Nl,startDTS:Dl,endDTS:Ul}=El;ga&&(ga.elementaryStreams[ElementaryStreamTypes.AUDIO]={startPTS:Cl,endPTS:Nl,startDTS:Dl,endDTS:Ul}),_s.setElementaryStreamInfo(ElementaryStreamTypes.AUDIO,Cl,Nl,Dl,Ul),this.bufferFragmentData(El,_s,ga,_n)}if(Sl!=null&&(g=Sl.samples)!=null&&g.length){const Cl=_extends$5({id:_,frag:_s,details:xa},Sl);j.trigger(Events.FRAG_PARSING_METADATA,Cl)}if(Tl){const Cl=_extends$5({id:_,frag:_s,details:xa},Tl);j.trigger(Events.FRAG_PARSING_USERDATA,Cl)}}_bufferInitSegment(i,g,_){if(this.state!==State.PARSING)return;i.video&&delete i.video;const j=i.audio;if(!j)return;j.levelCodec=j.codec,j.id="audio",this.log(`Init audio buffer, container:${j.container}, codecs[parsed]=[${j.codec}]`),this.hls.trigger(Events.BUFFER_CODECS,i);const $=j.initSegment;if($!=null&&$.byteLength){const _n={type:"audio",frag:g,part:null,chunkMeta:_,parent:g.type,data:$};this.hls.trigger(Events.BUFFER_APPENDING,_n)}this.tick()}loadFragment(i,g,_){const j=this.fragmentTracker.getState(i);if(this.fragCurrent=i,this.switchingTrack||j===FragmentState.NOT_LOADED||j===FragmentState.PARTIAL){var $;i.sn==="initSegment"?this._loadInitSegment(i,g):($=g.details)!=null&&$.live&&!this.initPTS[i.cc]?(this.log(`Waiting for video PTS in continuity counter ${i.cc} of live stream before loading audio fragment ${i.sn} of level ${this.trackId}`),this.state=State.WAITING_INIT_PTS):(this.startFragRequested=!0,super.loadFragment(i,g,_))}else this.clearTrackerIfNeeded(i)}completeAudioSwitch(i){const{hls:g,media:_,bufferedTrack:j}=this,$=j==null?void 0:j.attrs,_n=i.attrs;_&&$&&($.CHANNELS!==_n.CHANNELS||$.NAME!==_n.NAME||$.LANGUAGE!==_n.LANGUAGE)&&(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio")),this.bufferedTrack=i,this.switchingTrack=null,g.trigger(Events.AUDIO_TRACK_SWITCHED,_objectSpread2({},i))}}class AudioTrackController extends BasePlaylistController{constructor(i){super(i,"[audio-track-controller]"),this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:i}=this;i.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),i.on(Events.MANIFEST_PARSED,this.onManifestParsed,this),i.on(Events.LEVEL_LOADING,this.onLevelLoading,this),i.on(Events.LEVEL_SWITCHING,this.onLevelSwitching,this),i.on(Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),i.on(Events.ERROR,this.onError,this)}unregisterListeners(){const{hls:i}=this;i.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),i.off(Events.MANIFEST_PARSED,this.onManifestParsed,this),i.off(Events.LEVEL_LOADING,this.onLevelLoading,this),i.off(Events.LEVEL_SWITCHING,this.onLevelSwitching,this),i.off(Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),i.off(Events.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(i,g){this.tracks=g.audioTracks||[]}onAudioTrackLoaded(i,g){const{id:_,groupId:j,details:$}=g,_n=this.tracksInGroup[_];if(!_n||_n.groupId!==j){this.warn(`Track with id:${_} and group:${j} not found in active group ${_n.groupId}`);return}const _i=_n.details;_n.details=g.details,this.log(`audio-track ${_} "${_n.name}" lang:${_n.lang} group:${j} loaded [${$.startSN}-${$.endSN}]`),_===this.trackId&&this.playlistLoaded(_,g,_i)}onLevelLoading(i,g){this.switchLevel(g.level)}onLevelSwitching(i,g){this.switchLevel(g.level)}switchLevel(i){const g=this.hls.levels[i];if(!(g!=null&&g.audioGroupIds))return;const _=g.audioGroupIds[g.urlId];if(this.groupId!==_){this.groupId=_||null;const j=this.tracks.filter(_n=>!_||_n.groupId===_);this.selectDefaultTrack&&!j.some(_n=>_n.default)&&(this.selectDefaultTrack=!1),this.tracksInGroup=j;const $={audioTracks:j};this.log(`Updating audio tracks, ${j.length} track(s) found in group:${_}`),this.hls.trigger(Events.AUDIO_TRACKS_UPDATED,$),this.selectInitialTrack()}else this.shouldReloadPlaylist(this.currentTrack)&&this.setAudioTrack(this.trackId)}onError(i,g){g.fatal||!g.context||g.context.type===PlaylistContextType.AUDIO_TRACK&&g.context.id===this.trackId&&g.context.groupId===this.groupId&&(this.requestScheduled=-1,this.checkRetry(g))}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(i){this.selectDefaultTrack=!1,this.setAudioTrack(i)}setAudioTrack(i){const g=this.tracksInGroup;if(i<0||i>=g.length){this.warn("Invalid id passed to audio-track controller");return}this.clearTimer();const _=this.currentTrack;g[this.trackId];const j=g[i],{groupId:$,name:_n}=j;if(this.log(`Switching to audio-track ${i} "${_n}" lang:${j.lang} group:${$}`),this.trackId=i,this.currentTrack=j,this.selectDefaultTrack=!1,this.hls.trigger(Events.AUDIO_TRACK_SWITCHING,_objectSpread2({},j)),j.details&&!j.details.live)return;const _i=this.switchParams(j.url,_==null?void 0:_.details);this.loadPlaylist(_i)}selectInitialTrack(){const i=this.tracksInGroup,g=this.findTrackId(this.currentTrack)|this.findTrackId(null);if(g!==-1)this.setAudioTrack(g);else{const _=new Error(`No track found for running audio group-ID: ${this.groupId} track count: ${i.length}`);this.warn(_.message),this.hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:_})}}findTrackId(i){const g=this.tracksInGroup;for(let _=0;_<g.length;_++){const j=g[_];if((!this.selectDefaultTrack||j.default)&&(!i||i.attrs["STABLE-RENDITION-ID"]!==void 0&&i.attrs["STABLE-RENDITION-ID"]===j.attrs["STABLE-RENDITION-ID"]||i.name===j.name&&i.lang===j.lang))return j.id}return-1}loadPlaylist(i){super.loadPlaylist();const g=this.tracksInGroup[this.trackId];if(this.shouldLoadPlaylist(g)){const _=g.id,j=g.groupId;let $=g.url;if(i)try{$=i.addDirectives($)}catch(_n){this.warn(`Could not construct new URL with HLS Delivery Directives: ${_n}`)}this.log(`loading audio-track playlist ${_} "${g.name}" lang:${g.lang} group:${j}`),this.clearTimer(),this.hls.trigger(Events.AUDIO_TRACK_LOADING,{url:$,id:_,groupId:j,deliveryDirectives:i||null})}}}function subtitleOptionsIdentical(h,i){if(h.length!==i.length)return!1;for(let g=0;g<h.length;g++)if(!subtitleAttributesIdentical(h[g].attrs,i[g].attrs))return!1;return!0}function subtitleAttributesIdentical(h,i){const g=h["STABLE-RENDITION-ID"];return g?g===i["STABLE-RENDITION-ID"]:!["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED"].some(_=>h[_]!==i[_])}const TICK_INTERVAL=500;class SubtitleStreamController extends BaseStreamController{constructor(i,g,_){super(i,g,_,"[subtitle-stream-controller]",PlaylistLevelType.SUBTITLE),this.levels=[],this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this._registerListeners()}onHandlerDestroying(){this._unregisterListeners(),this.mainDetails=null}_registerListeners(){const{hls:i}=this;i.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),i.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),i.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),i.on(Events.LEVEL_LOADED,this.onLevelLoaded,this),i.on(Events.ERROR,this.onError,this),i.on(Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),i.on(Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),i.on(Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),i.on(Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),i.on(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),i.on(Events.FRAG_BUFFERED,this.onFragBuffered,this)}_unregisterListeners(){const{hls:i}=this;i.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),i.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),i.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),i.off(Events.LEVEL_LOADED,this.onLevelLoaded,this),i.off(Events.ERROR,this.onError,this),i.off(Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),i.off(Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),i.off(Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),i.off(Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),i.off(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),i.off(Events.FRAG_BUFFERED,this.onFragBuffered,this)}startLoad(i){this.stopLoad(),this.state=State.IDLE,this.setInterval(TICK_INTERVAL),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=i,this.tick()}onManifestLoading(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()}onMediaDetaching(){this.tracksBuffered=[],super.onMediaDetaching()}onLevelLoaded(i,g){this.mainDetails=g.details}onSubtitleFragProcessed(i,g){const{frag:_,success:j}=g;if(this.fragPrevious=_,this.state=State.IDLE,!j)return;const $=this.tracksBuffered[this.currentTrackId];if(!$)return;let _n;const _i=_.start;for(let ga=0;ga<$.length;ga++)if(_i>=$[ga].start&&_i<=$[ga].end){_n=$[ga];break}const _s=_.start+_.duration;_n?_n.end=_s:(_n={start:_i,end:_s},$.push(_n)),this.fragmentTracker.fragBuffered(_)}onBufferFlushing(i,g){const{startOffset:_,endOffset:j}=g;if(_===0&&j!==Number.POSITIVE_INFINITY){const{currentTrackId:$,levels:_n}=this;if(!_n.length||!_n[$]||!_n[$].details)return;const _s=_n[$].details.targetduration,ga=j-_s;if(ga<=0)return;g.endOffsetSubtitles=Math.max(0,ga),this.tracksBuffered.forEach(ba=>{for(let xa=0;xa<ba.length;){if(ba[xa].end<=ga){ba.shift();continue}else if(ba[xa].start<ga)ba[xa].start=ga;else break;xa++}}),this.fragmentTracker.removeFragmentsInRange(_,ga,PlaylistLevelType.SUBTITLE)}}onFragBuffered(i,g){if(!this.loadedmetadata&&g.frag.type===PlaylistLevelType.MAIN){var _;(_=this.media)!=null&&_.buffered.length&&(this.loadedmetadata=!0)}}onError(i,g){const _=g.frag;(_==null?void 0:_.type)===PlaylistLevelType.SUBTITLE&&(this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==State.STOPPED&&(this.state=State.IDLE))}onSubtitleTracksUpdated(i,{subtitleTracks:g}){if(subtitleOptionsIdentical(this.levels,g)){this.levels=g.map(_=>new Level(_));return}this.tracksBuffered=[],this.levels=g.map(_=>{const j=new Level(_);return this.tracksBuffered[j.id]=[],j}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,PlaylistLevelType.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(i,g){if(this.currentTrackId=g.id,!this.levels.length||this.currentTrackId===-1){this.clearInterval();return}const _=this.levels[this.currentTrackId];_!=null&&_.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,_&&this.setInterval(TICK_INTERVAL)}onSubtitleTrackLoaded(i,g){var _;const{details:j,id:$}=g,{currentTrackId:_n,levels:_i}=this;if(!_i.length)return;const _s=_i[_n];if($>=_i.length||$!==_n||!_s)return;this.mediaBuffer=this.mediaBufferTimeRanges;let ga=0;if(j.live||(_=_s.details)!=null&&_.live){const ba=this.mainDetails;if(j.deltaUpdateFailed||!ba)return;const xa=ba.fragments[0];_s.details?(ga=this.alignPlaylists(j,_s.details),ga===0&&xa&&(ga=xa.start,addSliding(j,ga))):j.hasProgramDateTime&&ba.hasProgramDateTime?(alignMediaPlaylistByPDT(j,ba),ga=j.fragments[0].start):xa&&(ga=xa.start,addSliding(j,ga))}_s.details=j,this.levelLastLoaded=$,!this.startFragRequested&&(this.mainDetails||!j.live)&&this.setStartPosition(_s.details,ga),this.tick(),j.live&&!this.fragCurrent&&this.media&&this.state===State.IDLE&&(findFragmentByPTS(null,j.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),_s.details=void 0))}_handleFragmentLoadComplete(i){const{frag:g,payload:_}=i,j=g.decryptdata,$=this.hls;if(!this.fragContextChanged(g)&&_&&_.byteLength>0&&j&&j.key&&j.iv&&j.method==="AES-128"){const _n=performance.now();this.decrypter.decrypt(new Uint8Array(_),j.key.buffer,j.iv.buffer).catch(_i=>{throw $.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.FRAG_DECRYPT_ERROR,fatal:!1,error:_i,reason:_i.message,frag:g}),_i}).then(_i=>{const _s=performance.now();$.trigger(Events.FRAG_DECRYPTED,{frag:g,payload:_i,stats:{tstart:_n,tdecrypt:_s}})}).catch(_i=>{this.warn(`${_i.name}: ${_i.message}`),this.state=State.IDLE})}}doTick(){if(!this.media){this.state=State.IDLE;return}if(this.state===State.IDLE){const{currentTrackId:i,levels:g}=this,_=g[i];if(!g.length||!_||!_.details)return;const j=_.details,$=j.targetduration,{config:_n}=this,_i=this.getLoadPosition(),_s=BufferHelper.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],_i-$,_n.maxBufferHole),{end:ga,len:ba}=_s,xa=this.getFwdBufferInfo(this.media,PlaylistLevelType.MAIN),El=this.getMaxBufferLength(xa==null?void 0:xa.len)+$;if(ba>El)return;const Tl=j.fragments,Sl=Tl.length,Il=j.edge;let Cl=null;const Nl=this.fragPrevious;if(ga<Il){const{maxFragLookUpTolerance:Dl}=_n;Cl=findFragmentByPTS(Nl,Tl,Math.max(Tl[0].start,ga),Dl),!Cl&&Nl&&Nl.start<Tl[0].start&&(Cl=Tl[0])}else Cl=Tl[Sl-1];if(!Cl)return;Cl=this.mapToInitFragWhenRequired(Cl),this.fragmentTracker.getState(Cl)===FragmentState.NOT_LOADED&&this.loadFragment(Cl,_,ga)}}getMaxBufferLength(i){const g=super.getMaxBufferLength();return i?Math.max(g,i):g}loadFragment(i,g,_){this.fragCurrent=i,i.sn==="initSegment"?this._loadInitSegment(i,g):(this.startFragRequested=!0,super.loadFragment(i,g,_))}get mediaBufferTimeRanges(){return new BufferableInstance(this.tracksBuffered[this.currentTrackId]||[])}}class BufferableInstance{constructor(i){this.buffered=void 0;const g=(_,j,$)=>{if(j=j>>>0,j>$-1)throw new DOMException(`Failed to execute '${_}' on 'TimeRanges': The index provided (${j}) is greater than the maximum bound (${$})`);return i[j][_]};this.buffered={get length(){return i.length},end(_){return g("end",_,i.length)},start(_){return g("start",_,i.length)}}}}class SubtitleTrackController extends BasePlaylistController{constructor(i){super(i,"[subtitle-track-controller]"),this.media=null,this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.trackChangeListener=()=>this.onTextTracksChanged(),this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(i){this._subtitleDisplay=i,this.trackId>-1&&this.toggleTrackModes(this.trackId)}registerListeners(){const{hls:i}=this;i.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),i.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),i.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),i.on(Events.MANIFEST_PARSED,this.onManifestParsed,this),i.on(Events.LEVEL_LOADING,this.onLevelLoading,this),i.on(Events.LEVEL_SWITCHING,this.onLevelSwitching,this),i.on(Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),i.on(Events.ERROR,this.onError,this)}unregisterListeners(){const{hls:i}=this;i.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),i.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),i.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),i.off(Events.MANIFEST_PARSED,this.onManifestParsed,this),i.off(Events.LEVEL_LOADING,this.onLevelLoading,this),i.off(Events.LEVEL_SWITCHING,this.onLevelSwitching,this),i.off(Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),i.off(Events.ERROR,this.onError,this)}onMediaAttached(i,g){this.media=g.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(i){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,i)}onMediaDetaching(){if(!this.media)return;self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),filterSubtitleTracks(this.media.textTracks).forEach(g=>{clearCurrentCues(g)}),this.subtitleTrack=-1,this.media=null}onManifestLoading(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(i,g){this.tracks=g.subtitleTracks}onSubtitleTrackLoaded(i,g){const{id:_,details:j}=g,{trackId:$}=this,_n=this.tracksInGroup[$];if(!_n){this.warn(`Invalid subtitle track id ${_}`);return}const _i=_n.details;_n.details=g.details,this.log(`subtitle track ${_} loaded [${j.startSN}-${j.endSN}]`),_===this.trackId&&this.playlistLoaded(_,g,_i)}onLevelLoading(i,g){this.switchLevel(g.level)}onLevelSwitching(i,g){this.switchLevel(g.level)}switchLevel(i){const g=this.hls.levels[i];if(!(g!=null&&g.textGroupIds))return;const _=g.textGroupIds[g.urlId],j=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;if(this.groupId!==_){const $=this.tracks.filter(_s=>!_||_s.groupId===_);this.tracksInGroup=$;const _n=this.findTrackId(j==null?void 0:j.name)||this.findTrackId();this.groupId=_||null;const _i={subtitleTracks:$};this.log(`Updating subtitle tracks, ${$.length} track(s) found in "${_}" group-id`),this.hls.trigger(Events.SUBTITLE_TRACKS_UPDATED,_i),_n!==-1&&this.setSubtitleTrack(_n,j)}else this.shouldReloadPlaylist(j)&&this.setSubtitleTrack(this.trackId,j)}findTrackId(i){const g=this.tracksInGroup;for(let _=0;_<g.length;_++){const j=g[_];if((!this.selectDefaultTrack||j.default)&&(!i||i===j.name))return j.id}return-1}onError(i,g){g.fatal||!g.context||g.context.type===PlaylistContextType.SUBTITLE_TRACK&&g.context.id===this.trackId&&g.context.groupId===this.groupId&&this.checkRetry(g)}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(i){this.selectDefaultTrack=!1;const g=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(i,g)}loadPlaylist(i){super.loadPlaylist();const g=this.tracksInGroup[this.trackId];if(this.shouldLoadPlaylist(g)){const _=g.id,j=g.groupId;let $=g.url;if(i)try{$=i.addDirectives($)}catch(_n){this.warn(`Could not construct new URL with HLS Delivery Directives: ${_n}`)}this.log(`Loading subtitle playlist for id ${_}`),this.hls.trigger(Events.SUBTITLE_TRACK_LOADING,{url:$,id:_,groupId:j,deliveryDirectives:i||null})}}toggleTrackModes(i){const{media:g,trackId:_}=this;if(!g)return;const j=filterSubtitleTracks(g.textTracks),$=j.filter(_i=>_i.groupId===this.groupId);if(i===-1)[].slice.call(j).forEach(_i=>{_i.mode="disabled"});else{const _i=$[_];_i&&(_i.mode="disabled")}const _n=$[i];_n&&(_n.mode=this.subtitleDisplay?"showing":"hidden")}setSubtitleTrack(i,g){var _;const j=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=i;return}if(this.trackId!==i&&this.toggleTrackModes(i),this.trackId===i&&(i===-1||(_=j[i])!=null&&_.details)||i<-1||i>=j.length)return;this.clearTimer();const $=j[i];if(this.log(`Switching to subtitle-track ${i}`+($?` "${$.name}" lang:${$.lang} group:${$.groupId}`:"")),this.trackId=i,$){const{id:_n,groupId:_i="",name:_s,type:ga,url:ba}=$;this.hls.trigger(Events.SUBTITLE_TRACK_SWITCH,{id:_n,groupId:_i,name:_s,type:ga,url:ba});const xa=this.switchParams($.url,g==null?void 0:g.details);this.loadPlaylist(xa)}else this.hls.trigger(Events.SUBTITLE_TRACK_SWITCH,{id:i})}onTextTracksChanged(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let i=-1;const g=filterSubtitleTracks(this.media.textTracks);for(let _=0;_<g.length;_++)if(g[_].mode==="hidden")i=_;else if(g[_].mode==="showing"){i=_;break}this.subtitleTrack!==i&&(this.subtitleTrack=i)}}function filterSubtitleTracks(h){const i=[];for(let g=0;g<h.length;g++){const _=h[g];(_.kind==="subtitles"||_.kind==="captions")&&_.label&&i.push(h[g])}return i}class BufferOperationQueue{constructor(i){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=i}append(i,g){const _=this.queues[g];_.push(i),_.length===1&&this.buffers[g]&&this.executeNext(g)}insertAbort(i,g){this.queues[g].unshift(i),this.executeNext(g)}appendBlocker(i){let g;const _=new Promise($=>{g=$}),j={execute:g,onStart:()=>{},onComplete:()=>{},onError:()=>{}};return this.append(j,i),_}executeNext(i){const{buffers:g,queues:_}=this,j=g[i],$=_[i];if($.length){const _n=$[0];try{_n.execute()}catch(_i){logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),_n.onError(_i),j!=null&&j.updating||($.shift(),this.executeNext(i))}}}shiftAndExecuteNext(i){this.queues[i].shift(),this.executeNext(i)}current(i){return this.queues[i][0]}}const MediaSource=getMediaSource(),VIDEO_CODEC_PROFILE_REPACE=/([ha]vc.)(?:\.[^.,]+)+/;class BufferController{constructor(i){this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=()=>{const{media:g,mediaSource:_}=this;logger.log("[buffer-controller]: Media source opened"),g&&(g.removeEventListener("emptied",this._onMediaEmptied),this.updateMediaElementDuration(),this.hls.trigger(Events.MEDIA_ATTACHED,{media:g})),_&&_.removeEventListener("sourceopen",this._onMediaSourceOpen),this.checkPendingTracks()},this._onMediaSourceClose=()=>{logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=()=>{logger.log("[buffer-controller]: Media source ended")},this._onMediaEmptied=()=>{const{media:g,_objectUrl:_}=this;g&&g.src!==_&&logger.error(`Media element src was set while attaching MediaSource (${_} > ${g.src})`)},this.hls=i,this._initSourceBuffer(),this.registerListeners()}hasSourceTypes(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=null}registerListeners(){const{hls:i}=this;i.on(Events.MEDIA_ATTACHING,this.onMediaAttaching,this),i.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),i.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),i.on(Events.MANIFEST_PARSED,this.onManifestParsed,this),i.on(Events.BUFFER_RESET,this.onBufferReset,this),i.on(Events.BUFFER_APPENDING,this.onBufferAppending,this),i.on(Events.BUFFER_CODECS,this.onBufferCodecs,this),i.on(Events.BUFFER_EOS,this.onBufferEos,this),i.on(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),i.on(Events.LEVEL_UPDATED,this.onLevelUpdated,this),i.on(Events.FRAG_PARSED,this.onFragParsed,this),i.on(Events.FRAG_CHANGED,this.onFragChanged,this)}unregisterListeners(){const{hls:i}=this;i.off(Events.MEDIA_ATTACHING,this.onMediaAttaching,this),i.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),i.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),i.off(Events.MANIFEST_PARSED,this.onManifestParsed,this),i.off(Events.BUFFER_RESET,this.onBufferReset,this),i.off(Events.BUFFER_APPENDING,this.onBufferAppending,this),i.off(Events.BUFFER_CODECS,this.onBufferCodecs,this),i.off(Events.BUFFER_EOS,this.onBufferEos,this),i.off(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),i.off(Events.LEVEL_UPDATED,this.onLevelUpdated,this),i.off(Events.FRAG_PARSED,this.onFragParsed,this),i.off(Events.FRAG_CHANGED,this.onFragChanged,this)}_initSourceBuffer(){this.sourceBuffer={},this.operationQueue=new BufferOperationQueue(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]},this.lastMpegAudioChunk=null}onManifestLoading(){this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=0,this.details=null}onManifestParsed(i,g){let _=2;(g.audio&&!g.video||!g.altAudio)&&(_=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=_,logger.log(`${this.bufferCodecEventsExpected} bufferCodec event(s) expected`)}onMediaAttaching(i,g){const _=this.media=g.media;if(_&&MediaSource){const j=this.mediaSource=new MediaSource;j.addEventListener("sourceopen",this._onMediaSourceOpen),j.addEventListener("sourceended",this._onMediaSourceEnded),j.addEventListener("sourceclose",this._onMediaSourceClose),_.src=self.URL.createObjectURL(j),this._objectUrl=_.src,_.addEventListener("emptied",this._onMediaEmptied)}}onMediaDetaching(){const{media:i,mediaSource:g,_objectUrl:_}=this;if(g){if(logger.log("[buffer-controller]: media source detaching"),g.readyState==="open")try{g.endOfStream()}catch(j){logger.warn(`[buffer-controller]: onMediaDetaching: ${j.message} while calling endOfStream`)}this.onBufferReset(),g.removeEventListener("sourceopen",this._onMediaSourceOpen),g.removeEventListener("sourceended",this._onMediaSourceEnded),g.removeEventListener("sourceclose",this._onMediaSourceClose),i&&(i.removeEventListener("emptied",this._onMediaEmptied),_&&self.URL.revokeObjectURL(_),i.src===_?(i.removeAttribute("src"),i.load()):logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(Events.MEDIA_DETACHED,void 0)}onBufferReset(){this.getSourceBufferTypes().forEach(i=>{const g=this.sourceBuffer[i];try{g&&(this.removeBufferListeners(i),this.mediaSource&&this.mediaSource.removeSourceBuffer(g),this.sourceBuffer[i]=void 0)}catch(_){logger.warn(`[buffer-controller]: Failed to reset the ${i} buffer`,_)}}),this._initSourceBuffer()}onBufferCodecs(i,g){const _=this.getSourceBufferTypes().length;Object.keys(g).forEach(j=>{if(_){const $=this.tracks[j];if($&&typeof $.buffer.changeType=="function"){const{id:_n,codec:_i,levelCodec:_s,container:ga,metadata:ba}=g[j],xa=($.levelCodec||$.codec).replace(VIDEO_CODEC_PROFILE_REPACE,"$1"),El=(_s||_i).replace(VIDEO_CODEC_PROFILE_REPACE,"$1");if(xa!==El){const Tl=`${ga};codecs=${_s||_i}`;this.appendChangeType(j,Tl),logger.log(`[buffer-controller]: switching codec ${xa} to ${El}`),this.tracks[j]={buffer:$.buffer,codec:_i,container:ga,levelCodec:_s,metadata:ba,id:_n}}}}else this.pendingTracks[j]=g[j]}),!_&&(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&this.mediaSource.readyState==="open"&&this.checkPendingTracks())}appendChangeType(i,g){const{operationQueue:_}=this,j={execute:()=>{const $=this.sourceBuffer[i];$&&(logger.log(`[buffer-controller]: changing ${i} sourceBuffer type to ${g}`),$.changeType(g)),_.shiftAndExecuteNext(i)},onStart:()=>{},onComplete:()=>{},onError:$=>{logger.warn(`[buffer-controller]: Failed to change ${i} SourceBuffer type`,$)}};_.append(j,i)}onBufferAppending(i,g){const{hls:_,operationQueue:j,tracks:$}=this,{data:_n,type:_i,frag:_s,part:ga,chunkMeta:ba}=g,xa=ba.buffering[_i],El=self.performance.now();xa.start=El;const Tl=_s.stats.buffering,Sl=ga?ga.stats.buffering:null;Tl.start===0&&(Tl.start=El),Sl&&Sl.start===0&&(Sl.start=El);const Il=$.audio;let Cl=!1;_i==="audio"&&(Il==null?void 0:Il.container)==="audio/mpeg"&&(Cl=!this.lastMpegAudioChunk||ba.id===1||this.lastMpegAudioChunk.sn!==ba.sn,this.lastMpegAudioChunk=ba);const Nl=_s.start,Dl={execute:()=>{if(xa.executeStart=self.performance.now(),Cl){const Ul=this.sourceBuffer[_i];if(Ul){const Kl=Nl-Ul.timestampOffset;Math.abs(Kl)>=.1&&(logger.log(`[buffer-controller]: Updating audio SourceBuffer timestampOffset to ${Nl} (delta: ${Kl}) sn: ${_s.sn})`),Ul.timestampOffset=Nl)}}this.appendExecutor(_n,_i)},onStart:()=>{},onComplete:()=>{const Ul=self.performance.now();xa.executeEnd=xa.end=Ul,Tl.first===0&&(Tl.first=Ul),Sl&&Sl.first===0&&(Sl.first=Ul);const{sourceBuffer:Kl}=this,Jl={};for(const Ep in Kl)Jl[Ep]=BufferHelper.getBuffered(Kl[Ep]);this.appendError=0,this.hls.trigger(Events.BUFFER_APPENDED,{type:_i,frag:_s,part:ga,chunkMeta:ba,parent:_s.type,timeRanges:Jl})},onError:Ul=>{logger.error(`[buffer-controller]: Error encountered while trying to append to the ${_i} SourceBuffer`,Ul);const Kl={type:ErrorTypes.MEDIA_ERROR,parent:_s.type,details:ErrorDetails.BUFFER_APPEND_ERROR,frag:_s,part:ga,chunkMeta:ba,error:Ul,err:Ul,fatal:!1};Ul.code===DOMException.QUOTA_EXCEEDED_ERR?Kl.details=ErrorDetails.BUFFER_FULL_ERROR:(this.appendError++,Kl.details=ErrorDetails.BUFFER_APPEND_ERROR,this.appendError>_.config.appendErrorMaxRetry&&(logger.error(`[buffer-controller]: Failed ${_.config.appendErrorMaxRetry} times to append segment in sourceBuffer`),Kl.fatal=!0)),_.trigger(Events.ERROR,Kl)}};j.append(Dl,_i)}onBufferFlushing(i,g){const{operationQueue:_}=this,j=$=>({execute:this.removeExecutor.bind(this,$,g.startOffset,g.endOffset),onStart:()=>{},onComplete:()=>{this.hls.trigger(Events.BUFFER_FLUSHED,{type:$})},onError:_n=>{logger.warn(`[buffer-controller]: Failed to remove from ${$} SourceBuffer`,_n)}});g.type?_.append(j(g.type),g.type):this.getSourceBufferTypes().forEach($=>{_.append(j($),$)})}onFragParsed(i,g){const{frag:_,part:j}=g,$=[],_n=j?j.elementaryStreams:_.elementaryStreams;_n[ElementaryStreamTypes.AUDIOVIDEO]?$.push("audiovideo"):(_n[ElementaryStreamTypes.AUDIO]&&$.push("audio"),_n[ElementaryStreamTypes.VIDEO]&&$.push("video"));const _i=()=>{const _s=self.performance.now();_.stats.buffering.end=_s,j&&(j.stats.buffering.end=_s);const ga=j?j.stats:_.stats;this.hls.trigger(Events.FRAG_BUFFERED,{frag:_,part:j,stats:ga,id:_.type})};$.length===0&&logger.warn(`Fragments must have at least one ElementaryStreamType set. type: ${_.type} level: ${_.level} sn: ${_.sn}`),this.blockBuffers(_i,$)}onFragChanged(i,g){this.flushBackBuffer()}onBufferEos(i,g){this.getSourceBufferTypes().reduce((j,$)=>{const _n=this.sourceBuffer[$];return _n&&(!g.type||g.type===$)&&(_n.ending=!0,_n.ended||(_n.ended=!0,logger.log(`[buffer-controller]: ${$} sourceBuffer now EOS`))),j&&!!(!_n||_n.ended)},!0)&&(logger.log("[buffer-controller]: Queueing mediaSource.endOfStream()"),this.blockBuffers(()=>{this.getSourceBufferTypes().forEach($=>{const _n=this.sourceBuffer[$];_n&&(_n.ending=!1)});const{mediaSource:j}=this;if(!j||j.readyState!=="open"){j&&logger.info(`[buffer-controller]: Could not call mediaSource.endOfStream(). mediaSource.readyState: ${j.readyState}`);return}logger.log("[buffer-controller]: Calling mediaSource.endOfStream()"),j.endOfStream()}))}onLevelUpdated(i,{details:g}){g.fragments.length&&(this.details=g,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())}flushBackBuffer(){const{hls:i,details:g,media:_,sourceBuffer:j}=this;if(!_||g===null)return;const $=this.getSourceBufferTypes();if(!$.length)return;const _n=g.live&&i.config.liveBackBufferLength!==null?i.config.liveBackBufferLength:i.config.backBufferLength;if(!isFiniteNumber(_n)||_n<0)return;const _i=_.currentTime,_s=g.levelTargetDuration,ga=Math.max(_n,_s),ba=Math.floor(_i/_s)*_s-ga;$.forEach(xa=>{const El=j[xa];if(El){const Tl=BufferHelper.getBuffered(El);if(Tl.length>0&&ba>Tl.start(0)){if(i.trigger(Events.BACK_BUFFER_REACHED,{bufferEnd:ba}),g.live)i.trigger(Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:ba});else if(El.ended&&Tl.end(Tl.length-1)-_i<_s*2){logger.info(`[buffer-controller]: Cannot flush ${xa} back buffer while SourceBuffer is in ended state`);return}i.trigger(Events.BUFFER_FLUSHING,{startOffset:0,endOffset:ba,type:xa})}}})}updateMediaElementDuration(){if(!this.details||!this.media||!this.mediaSource||this.mediaSource.readyState!=="open")return;const{details:i,hls:g,media:_,mediaSource:j}=this,$=i.fragments[0].start+i.totalduration,_n=_.duration,_i=isFiniteNumber(j.duration)?j.duration:0;i.live&&g.config.liveDurationInfinity?(logger.log("[buffer-controller]: Media Source duration is set to Infinity"),j.duration=1/0,this.updateSeekableRange(i)):($>_i&&$>_n||!isFiniteNumber(_n))&&(logger.log(`[buffer-controller]: Updating Media Source duration to ${$.toFixed(3)}`),j.duration=$)}updateSeekableRange(i){const g=this.mediaSource,_=i.fragments;if(_.length&&i.live&&g!=null&&g.setLiveSeekableRange){const $=Math.max(0,_[0].start),_n=Math.max($,$+i.totalduration);g.setLiveSeekableRange($,_n)}}checkPendingTracks(){const{bufferCodecEventsExpected:i,operationQueue:g,pendingTracks:_}=this,j=Object.keys(_).length;if(j&&!i||j===2){this.createSourceBuffers(_),this.pendingTracks={};const $=this.getSourceBufferTypes();if($.length)this.hls.trigger(Events.BUFFER_CREATED,{tracks:this.tracks}),$.forEach(_n=>{g.executeNext(_n)});else{const _n=new Error("could not create source buffer for media codec(s)");this.hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:_n,reason:_n.message})}}}createSourceBuffers(i){const{sourceBuffer:g,mediaSource:_}=this;if(!_)throw Error("createSourceBuffers called when mediaSource was null");for(const j in i)if(!g[j]){const $=i[j];if(!$)throw Error(`source buffer exists for track ${j}, however track does not`);const _n=$.levelCodec||$.codec,_i=`${$.container};codecs=${_n}`;logger.log(`[buffer-controller]: creating sourceBuffer(${_i})`);try{const _s=g[j]=_.addSourceBuffer(_i),ga=j;this.addBufferListener(ga,"updatestart",this._onSBUpdateStart),this.addBufferListener(ga,"updateend",this._onSBUpdateEnd),this.addBufferListener(ga,"error",this._onSBUpdateError),this.tracks[j]={buffer:_s,codec:_n,container:$.container,levelCodec:$.levelCodec,metadata:$.metadata,id:$.id}}catch(_s){logger.error(`[buffer-controller]: error while trying to add sourceBuffer: ${_s.message}`),this.hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:_s,mimeType:_i})}}}_onSBUpdateStart(i){const{operationQueue:g}=this;g.current(i).onStart()}_onSBUpdateEnd(i){const{operationQueue:g}=this;g.current(i).onComplete(),g.shiftAndExecuteNext(i)}_onSBUpdateError(i,g){const _=new Error(`${i} SourceBuffer error`);logger.error(`[buffer-controller]: ${_}`,g),this.hls.trigger(Events.ERROR,{type:ErrorTypes.MEDIA_ERROR,details:ErrorDetails.BUFFER_APPENDING_ERROR,error:_,fatal:!1});const j=this.operationQueue.current(i);j&&j.onError(g)}removeExecutor(i,g,_){const{media:j,mediaSource:$,operationQueue:_n,sourceBuffer:_i}=this,_s=_i[i];if(!j||!$||!_s){logger.warn(`[buffer-controller]: Attempting to remove from the ${i} SourceBuffer, but it does not exist`),_n.shiftAndExecuteNext(i);return}const ga=isFiniteNumber(j.duration)?j.duration:1/0,ba=isFiniteNumber($.duration)?$.duration:1/0,xa=Math.max(0,g),El=Math.min(_,ga,ba);El>xa&&!_s.ending?(_s.ended=!1,logger.log(`[buffer-controller]: Removing [${xa},${El}] from the ${i} SourceBuffer`),_s.remove(xa,El)):_n.shiftAndExecuteNext(i)}appendExecutor(i,g){const{operationQueue:_,sourceBuffer:j}=this,$=j[g];if(!$){logger.warn(`[buffer-controller]: Attempting to append to the ${g} SourceBuffer, but it does not exist`),_.shiftAndExecuteNext(g);return}$.ended=!1,$.appendBuffer(i)}blockBuffers(i,g=this.getSourceBufferTypes()){if(!g.length){logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(i);return}const{operationQueue:_}=this,j=g.map($=>_.appendBlocker($));Promise.all(j).then(()=>{i(),g.forEach($=>{const _n=this.sourceBuffer[$];_n!=null&&_n.updating||_.shiftAndExecuteNext($)})})}getSourceBufferTypes(){return Object.keys(this.sourceBuffer)}addBufferListener(i,g,_){const j=this.sourceBuffer[i];if(!j)return;const $=_.bind(this,i);this.listeners[i].push({event:g,listener:$}),j.addEventListener(g,$)}removeBufferListeners(i){const g=this.sourceBuffer[i];g&&this.listeners[i].forEach(_=>{g.removeEventListener(_.event,_.listener)})}}const specialCea608CharsCodes={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},getCharForByte=function(i){let g=i;return specialCea608CharsCodes.hasOwnProperty(i)&&(g=specialCea608CharsCodes[i]),String.fromCharCode(g)},NR_ROWS=15,NR_COLS=100,rowsLowCh1={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},rowsHighCh1={17:2,18:4,21:6,22:8,23:10,19:13,20:15},rowsLowCh2={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},rowsHighCh2={25:2,26:4,29:6,30:8,31:10,27:13,28:15},backgroundColors=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class CaptionsLogger{constructor(){this.time=null,this.verboseLevel=0}log(i,g){if(this.verboseLevel>=i){const _=typeof g=="function"?g():g;logger.log(`${this.time} [${i}] ${_}`)}}}const numArrayToHexArray=function(i){const g=[];for(let _=0;_<i.length;_++)g.push(i[_].toString(16));return g};class PenState{constructor(i,g,_,j,$){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=i||"white",this.underline=g||!1,this.italics=_||!1,this.background=j||"black",this.flash=$||!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(i){const g=["foreground","underline","italics","background","flash"];for(let _=0;_<g.length;_++){const j=g[_];i.hasOwnProperty(j)&&(this[j]=i[j])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(i){return this.foreground===i.foreground&&this.underline===i.underline&&this.italics===i.italics&&this.background===i.background&&this.flash===i.flash}copy(i){this.foreground=i.foreground,this.underline=i.underline,this.italics=i.italics,this.background=i.background,this.flash=i.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class StyledUnicodeChar{constructor(i,g,_,j,$,_n){this.uchar=void 0,this.penState=void 0,this.uchar=i||" ",this.penState=new PenState(g,_,j,$,_n)}reset(){this.uchar=" ",this.penState.reset()}setChar(i,g){this.uchar=i,this.penState.copy(g)}setPenState(i){this.penState.copy(i)}equals(i){return this.uchar===i.uchar&&this.penState.equals(i.penState)}copy(i){this.uchar=i.uchar,this.penState.copy(i.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class Row{constructor(i){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(let g=0;g<NR_COLS;g++)this.chars.push(new StyledUnicodeChar);this.logger=i,this.pos=0,this.currPenState=new PenState}equals(i){let g=!0;for(let _=0;_<NR_COLS;_++)if(!this.chars[_].equals(i.chars[_])){g=!1;break}return g}copy(i){for(let g=0;g<NR_COLS;g++)this.chars[g].copy(i.chars[g])}isEmpty(){let i=!0;for(let g=0;g<NR_COLS;g++)if(!this.chars[g].isEmpty()){i=!1;break}return i}setCursor(i){this.pos!==i&&(this.pos=i),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>NR_COLS&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=NR_COLS)}moveCursor(i){const g=this.pos+i;if(i>1)for(let _=this.pos+1;_<g+1;_++)this.chars[_].setPenState(this.currPenState);this.setCursor(g)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(i){i>=144&&this.backSpace();const g=getCharForByte(i);if(this.pos>=NR_COLS){this.logger.log(0,()=>"Cannot insert "+i.toString(16)+" ("+g+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(g,this.currPenState),this.moveCursor(1)}clearFromPos(i){let g;for(g=i;g<NR_COLS;g++)this.chars[g].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const i=[];let g=!0;for(let _=0;_<NR_COLS;_++){const j=this.chars[_].uchar;j!==" "&&(g=!1),i.push(j)}return g?"":i.join("")}setPenStyles(i){this.currPenState.setStyles(i),this.chars[this.pos].setPenState(this.currPenState)}}class CaptionScreen{constructor(i){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(let g=0;g<NR_ROWS;g++)this.rows.push(new Row(i));this.logger=i,this.currRow=NR_ROWS-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}reset(){for(let i=0;i<NR_ROWS;i++)this.rows[i].clear();this.currRow=NR_ROWS-1}equals(i){let g=!0;for(let _=0;_<NR_ROWS;_++)if(!this.rows[_].equals(i.rows[_])){g=!1;break}return g}copy(i){for(let g=0;g<NR_ROWS;g++)this.rows[g].copy(i.rows[g])}isEmpty(){let i=!0;for(let g=0;g<NR_ROWS;g++)if(!this.rows[g].isEmpty()){i=!1;break}return i}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(i){this.rows[this.currRow].insertChar(i)}setPen(i){this.rows[this.currRow].setPenStyles(i)}moveCursor(i){this.rows[this.currRow].moveCursor(i)}setCursor(i){this.logger.log(2,"setCursor: "+i),this.rows[this.currRow].setCursor(i)}setPAC(i){this.logger.log(2,()=>"pacData = "+JSON.stringify(i));let g=i.row-1;if(this.nrRollUpRows&&g<this.nrRollUpRows-1&&(g=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==g){for(let _i=0;_i<NR_ROWS;_i++)this.rows[_i].clear();const $=this.currRow+1-this.nrRollUpRows,_n=this.lastOutputScreen;if(_n){const _i=_n.rows[$].cueStartTime,_s=this.logger.time;if(_i&&_s!==null&&_i<_s)for(let ga=0;ga<this.nrRollUpRows;ga++)this.rows[g-this.nrRollUpRows+ga+1].copy(_n.rows[$+ga])}}this.currRow=g;const _=this.rows[this.currRow];if(i.indent!==null){const $=i.indent,_n=Math.max($-1,0);_.setCursor(i.indent),i.color=_.chars[_n].penState.foreground}const j={foreground:i.color,underline:i.underline,italics:i.italics,background:"black",flash:!1};this.setPen(j)}setBkgData(i){this.logger.log(2,()=>"bkgData = "+JSON.stringify(i)),this.backSpace(),this.setPen(i),this.insertChar(32)}setRollUpRows(i){this.nrRollUpRows=i}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const i=this.currRow+1-this.nrRollUpRows,g=this.rows.splice(i,1)[0];g.clear(),this.rows.splice(this.currRow,0,g),this.logger.log(2,"Rolling up")}getDisplayText(i){i=i||!1;const g=[];let _="",j=-1;for(let $=0;$<NR_ROWS;$++){const _n=this.rows[$].getTextString();_n&&(j=$+1,i?g.push("Row "+j+": '"+_n+"'"):g.push(_n.trim()))}return g.length>0&&(i?_="["+g.join(" | ")+"]":_=g.join(`
`)),_}getTextAndFormat(){return this.rows}}class Cea608Channel{constructor(i,g,_){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=i,this.outputFilter=g,this.mode=null,this.verbose=0,this.displayedMemory=new CaptionScreen(_),this.nonDisplayedMemory=new CaptionScreen(_),this.lastOutputScreen=new CaptionScreen(_),this.currRollUpRow=this.displayedMemory.rows[NR_ROWS-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=_}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[NR_ROWS-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(i){this.outputFilter=i}setPAC(i){this.writeScreen.setPAC(i)}setBkgData(i){this.writeScreen.setBkgData(i)}setMode(i){i!==this.mode&&(this.mode=i,this.logger.log(2,()=>"MODE="+i),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=i)}insertChars(i){for(let _=0;_<i.length;_++)this.writeScreen.insertChar(i[_]);const g=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>g+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(i){this.logger.log(2,"RU("+i+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(i)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const i=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=i,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(i){this.logger.log(2,"TO("+i+") - Tab Offset"),this.writeScreen.moveCursor(i)}ccMIDROW(i){const g={flash:!1};if(g.underline=i%2===1,g.italics=i>=46,g.italics)g.foreground="white";else{const _=Math.floor(i/2)-16,j=["white","green","blue","cyan","red","yellow","magenta"];g.foreground=j[_]}this.logger.log(2,"MIDROW: "+JSON.stringify(g)),this.writeScreen.setPen(g)}outputDataUpdate(i=!1){const g=this.logger.time;g!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=g:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,g,this.lastOutputScreen),i&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:g),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(i){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,i,this.displayedMemory),this.cueStartTime=i))}}class Cea608Parser{constructor(i,g,_){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;const j=new CaptionsLogger;this.channels=[null,new Cea608Channel(i,g,j),new Cea608Channel(i+1,_,j)],this.cmdHistory=createCmdHistory(),this.logger=j}getHandler(i){return this.channels[i].getHandler()}setHandler(i,g){this.channels[i].setHandler(g)}addData(i,g){let _,j,$,_n=!1;this.logger.time=i;for(let _i=0;_i<g.length;_i+=2)if(j=g[_i]&127,$=g[_i+1]&127,!(j===0&&$===0)){if(this.logger.log(3,"["+numArrayToHexArray([g[_i],g[_i+1]])+"] -> ("+numArrayToHexArray([j,$])+")"),_=this.parseCmd(j,$),_||(_=this.parseMidrow(j,$)),_||(_=this.parsePAC(j,$)),_||(_=this.parseBackgroundAttributes(j,$)),!_&&(_n=this.parseChars(j,$),_n)){const _s=this.currentChannel;_s&&_s>0?this.channels[_s].insertChars(_n):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!_&&!_n&&this.logger.log(2,"Couldn't parse cleaned data "+numArrayToHexArray([j,$])+" orig: "+numArrayToHexArray([g[_i],g[_i+1]]))}}parseCmd(i,g){const{cmdHistory:_}=this,j=(i===20||i===28||i===21||i===29)&&g>=32&&g<=47,$=(i===23||i===31)&&g>=33&&g<=35;if(!(j||$))return!1;if(hasCmdRepeated(i,g,_))return setLastCmd(null,null,_),this.logger.log(3,"Repeated command ("+numArrayToHexArray([i,g])+") is dropped"),!0;const _n=i===20||i===21||i===23?1:2,_i=this.channels[_n];return i===20||i===21||i===28||i===29?g===32?_i.ccRCL():g===33?_i.ccBS():g===34?_i.ccAOF():g===35?_i.ccAON():g===36?_i.ccDER():g===37?_i.ccRU(2):g===38?_i.ccRU(3):g===39?_i.ccRU(4):g===40?_i.ccFON():g===41?_i.ccRDC():g===42?_i.ccTR():g===43?_i.ccRTD():g===44?_i.ccEDM():g===45?_i.ccCR():g===46?_i.ccENM():g===47&&_i.ccEOC():_i.ccTO(g-32),setLastCmd(i,g,_),this.currentChannel=_n,!0}parseMidrow(i,g){let _=0;if((i===17||i===25)&&g>=32&&g<=47){if(i===17?_=1:_=2,_!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const j=this.channels[_];return j?(j.ccMIDROW(g),this.logger.log(3,"MIDROW ("+numArrayToHexArray([i,g])+")"),!0):!1}return!1}parsePAC(i,g){let _;const j=this.cmdHistory,$=(i>=17&&i<=23||i>=25&&i<=31)&&g>=64&&g<=127,_n=(i===16||i===24)&&g>=64&&g<=95;if(!($||_n))return!1;if(hasCmdRepeated(i,g,j))return setLastCmd(null,null,j),!0;const _i=i<=23?1:2;g>=64&&g<=95?_=_i===1?rowsLowCh1[i]:rowsLowCh2[i]:_=_i===1?rowsHighCh1[i]:rowsHighCh2[i];const _s=this.channels[_i];return _s?(_s.setPAC(this.interpretPAC(_,g)),setLastCmd(i,g,j),this.currentChannel=_i,!0):!1}interpretPAC(i,g){let _;const j={color:null,italics:!1,indent:null,underline:!1,row:i};return g>95?_=g-96:_=g-64,j.underline=(_&1)===1,_<=13?j.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(_/2)]:_<=15?(j.italics=!0,j.color="white"):j.indent=Math.floor((_-16)/2)*4,j}parseChars(i,g){let _,j=null,$=null;if(i>=25?(_=2,$=i-8):(_=1,$=i),$>=17&&$<=19){let _n;$===17?_n=g+80:$===18?_n=g+112:_n=g+144,this.logger.log(2,"Special char '"+getCharForByte(_n)+"' in channel "+_),j=[_n]}else i>=32&&i<=127&&(j=g===0?[i]:[i,g]);if(j){const _n=numArrayToHexArray(j);this.logger.log(3,"Char codes =  "+_n.join(",")),setLastCmd(i,g,this.cmdHistory)}return j}parseBackgroundAttributes(i,g){const _=(i===16||i===24)&&g>=32&&g<=47,j=(i===23||i===31)&&g>=45&&g<=47;if(!(_||j))return!1;let $;const _n={};i===16||i===24?($=Math.floor((g-32)/2),_n.background=backgroundColors[$],g%2===1&&(_n.background=_n.background+"_semi")):g===45?_n.background="transparent":(_n.foreground="black",g===47&&(_n.underline=!0));const _i=i<=23?1:2;return this.channels[_i].setBkgData(_n),setLastCmd(i,g,this.cmdHistory),!0}reset(){for(let i=0;i<Object.keys(this.channels).length;i++){const g=this.channels[i];g&&g.reset()}this.cmdHistory=createCmdHistory()}cueSplitAtTime(i){for(let g=0;g<this.channels.length;g++){const _=this.channels[g];_&&_.cueSplitAtTime(i)}}}function setLastCmd(h,i,g){g.a=h,g.b=i}function hasCmdRepeated(h,i,g){return g.a===h&&g.b===i}function createCmdHistory(){return{a:null,b:null}}class OutputFilter{constructor(i,g){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=i,this.trackName=g}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(i,g,_){(this.startTime===null||this.startTime>i)&&(this.startTime=i),this.endTime=g,this.screen=_,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}var VTTCue=function(){if(typeof self<"u"&&self.VTTCue)return self.VTTCue;const h=["","lr","rl"],i=["start","middle","end","left","right"];function g(_i,_s){if(typeof _s!="string"||!Array.isArray(_i))return!1;const ga=_s.toLowerCase();return~_i.indexOf(ga)?ga:!1}function _(_i){return g(h,_i)}function j(_i){return g(i,_i)}function $(_i,..._s){let ga=1;for(;ga<arguments.length;ga++){const ba=arguments[ga];for(const xa in ba)_i[xa]=ba[xa]}return _i}function _n(_i,_s,ga){const ba=this,xa={enumerable:!0};ba.hasBeenReset=!1;let El="",Tl=!1,Sl=_i,Il=_s,Cl=ga,Nl=null,Dl="",Ul=!0,Kl="auto",Jl="start",Ep=50,_p="middle",Ip=50,Up="middle";Object.defineProperty(ba,"id",$({},xa,{get:function(){return El},set:function(yp){El=""+yp}})),Object.defineProperty(ba,"pauseOnExit",$({},xa,{get:function(){return Tl},set:function(yp){Tl=!!yp}})),Object.defineProperty(ba,"startTime",$({},xa,{get:function(){return Sl},set:function(yp){if(typeof yp!="number")throw new TypeError("Start time must be set to a number.");Sl=yp,this.hasBeenReset=!0}})),Object.defineProperty(ba,"endTime",$({},xa,{get:function(){return Il},set:function(yp){if(typeof yp!="number")throw new TypeError("End time must be set to a number.");Il=yp,this.hasBeenReset=!0}})),Object.defineProperty(ba,"text",$({},xa,{get:function(){return Cl},set:function(yp){Cl=""+yp,this.hasBeenReset=!0}})),Object.defineProperty(ba,"region",$({},xa,{get:function(){return Nl},set:function(yp){Nl=yp,this.hasBeenReset=!0}})),Object.defineProperty(ba,"vertical",$({},xa,{get:function(){return Dl},set:function(yp){const Ap=_(yp);if(Ap===!1)throw new SyntaxError("An invalid or illegal string was specified.");Dl=Ap,this.hasBeenReset=!0}})),Object.defineProperty(ba,"snapToLines",$({},xa,{get:function(){return Ul},set:function(yp){Ul=!!yp,this.hasBeenReset=!0}})),Object.defineProperty(ba,"line",$({},xa,{get:function(){return Kl},set:function(yp){if(typeof yp!="number"&&yp!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");Kl=yp,this.hasBeenReset=!0}})),Object.defineProperty(ba,"lineAlign",$({},xa,{get:function(){return Jl},set:function(yp){const Ap=j(yp);if(!Ap)throw new SyntaxError("An invalid or illegal string was specified.");Jl=Ap,this.hasBeenReset=!0}})),Object.defineProperty(ba,"position",$({},xa,{get:function(){return Ep},set:function(yp){if(yp<0||yp>100)throw new Error("Position must be between 0 and 100.");Ep=yp,this.hasBeenReset=!0}})),Object.defineProperty(ba,"positionAlign",$({},xa,{get:function(){return _p},set:function(yp){const Ap=j(yp);if(!Ap)throw new SyntaxError("An invalid or illegal string was specified.");_p=Ap,this.hasBeenReset=!0}})),Object.defineProperty(ba,"size",$({},xa,{get:function(){return Ip},set:function(yp){if(yp<0||yp>100)throw new Error("Size must be between 0 and 100.");Ip=yp,this.hasBeenReset=!0}})),Object.defineProperty(ba,"align",$({},xa,{get:function(){return Up},set:function(yp){const Ap=j(yp);if(!Ap)throw new SyntaxError("An invalid or illegal string was specified.");Up=Ap,this.hasBeenReset=!0}})),ba.displayState=void 0}return _n.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},_n}();class StringDecoder{decode(i,g){if(!i)return"";if(typeof i!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(i))}}function parseTimeStamp(h){function i(_,j,$,_n){return(_|0)*3600+(j|0)*60+($|0)+parseFloat(_n||0)}const g=h.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return g?parseFloat(g[2])>59?i(g[2],g[3],0,g[4]):i(g[1],g[2],g[3],g[4]):null}class Settings{constructor(){this.values=Object.create(null)}set(i,g){!this.get(i)&&g!==""&&(this.values[i]=g)}get(i,g,_){return _?this.has(i)?this.values[i]:g[_]:this.has(i)?this.values[i]:g}has(i){return i in this.values}alt(i,g,_){for(let j=0;j<_.length;++j)if(g===_[j]){this.set(i,g);break}}integer(i,g){/^-?\d+$/.test(g)&&this.set(i,parseInt(g,10))}percent(i,g){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(g)){const _=parseFloat(g);if(_>=0&&_<=100)return this.set(i,_),!0}return!1}}function parseOptions(h,i,g,_){const j=_?h.split(_):[h];for(const $ in j){if(typeof j[$]!="string")continue;const _n=j[$].split(g);if(_n.length!==2)continue;const _i=_n[0],_s=_n[1];i(_i,_s)}}const defaults$1=new VTTCue(0,0,""),center=defaults$1.align==="middle"?"middle":"center";function parseCue(h,i,g){const _=h;function j(){const _i=parseTimeStamp(h);if(_i===null)throw new Error("Malformed timestamp: "+_);return h=h.replace(/^[^\sa-zA-Z-]+/,""),_i}function $(_i,_s){const ga=new Settings;parseOptions(_i,function(El,Tl){let Sl;switch(El){case"region":for(let Il=g.length-1;Il>=0;Il--)if(g[Il].id===Tl){ga.set(El,g[Il].region);break}break;case"vertical":ga.alt(El,Tl,["rl","lr"]);break;case"line":Sl=Tl.split(","),ga.integer(El,Sl[0]),ga.percent(El,Sl[0])&&ga.set("snapToLines",!1),ga.alt(El,Sl[0],["auto"]),Sl.length===2&&ga.alt("lineAlign",Sl[1],["start",center,"end"]);break;case"position":Sl=Tl.split(","),ga.percent(El,Sl[0]),Sl.length===2&&ga.alt("positionAlign",Sl[1],["start",center,"end","line-left","line-right","auto"]);break;case"size":ga.percent(El,Tl);break;case"align":ga.alt(El,Tl,["start",center,"end","left","right"]);break}},/:/,/\s/),_s.region=ga.get("region",null),_s.vertical=ga.get("vertical","");let ba=ga.get("line","auto");ba==="auto"&&defaults$1.line===-1&&(ba=-1),_s.line=ba,_s.lineAlign=ga.get("lineAlign","start"),_s.snapToLines=ga.get("snapToLines",!0),_s.size=ga.get("size",100),_s.align=ga.get("align",center);let xa=ga.get("position","auto");xa==="auto"&&defaults$1.position===50&&(xa=_s.align==="start"||_s.align==="left"?0:_s.align==="end"||_s.align==="right"?100:50),_s.position=xa}function _n(){h=h.replace(/^\s+/,"")}if(_n(),i.startTime=j(),_n(),h.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+_);h=h.slice(3),_n(),i.endTime=j(),_n(),$(h,i)}function fixLineBreaks(h){return h.replace(/<br(?: \/)?>/gi,`
`)}class VTTParser{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new StringDecoder,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(i){const g=this;i&&(g.buffer+=g.decoder.decode(i,{stream:!0}));function _(){let $=g.buffer,_n=0;for($=fixLineBreaks($);_n<$.length&&$[_n]!=="\r"&&$[_n]!==`
`;)++_n;const _i=$.slice(0,_n);return $[_n]==="\r"&&++_n,$[_n]===`
`&&++_n,g.buffer=$.slice(_n),_i}function j($){parseOptions($,function(_n,_i){},/:/)}try{let $="";if(g.state==="INITIAL"){if(!/\r\n|\n/.test(g.buffer))return this;$=_();const _i=$.match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!(_i!=null&&_i[0]))throw new Error("Malformed WebVTT signature.");g.state="HEADER"}let _n=!1;for(;g.buffer;){if(!/\r\n|\n/.test(g.buffer))return this;switch(_n?_n=!1:$=_(),g.state){case"HEADER":/:/.test($)?j($):$||(g.state="ID");continue;case"NOTE":$||(g.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test($)){g.state="NOTE";break}if(!$)continue;if(g.cue=new VTTCue(0,0,""),g.state="CUE",$.indexOf("-->")===-1){g.cue.id=$;continue}case"CUE":if(!g.cue){g.state="BADCUE";continue}try{parseCue($,g.cue,g.regionList)}catch{g.cue=null,g.state="BADCUE";continue}g.state="CUETEXT";continue;case"CUETEXT":{const _i=$.indexOf("-->")!==-1;if(!$||_i&&(_n=!0)){g.oncue&&g.cue&&g.oncue(g.cue),g.cue=null,g.state="ID";continue}if(g.cue===null)continue;g.cue.text&&(g.cue.text+=`
`),g.cue.text+=$}continue;case"BADCUE":$||(g.state="ID")}}}catch{g.state==="CUETEXT"&&g.cue&&g.oncue&&g.oncue(g.cue),g.cue=null,g.state=g.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const i=this;try{if((i.cue||i.state==="HEADER")&&(i.buffer+=`

`,i.parse()),i.state==="INITIAL"||i.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(g){i.onparsingerror&&i.onparsingerror(g)}return i.onflush&&i.onflush(),this}}const LINEBREAKS=/\r\n|\n\r|\n|\r/g,startsWith=function(i,g,_=0){return i.slice(_,_+g.length)===g},cueString2millis=function(i){let g=parseInt(i.slice(-3));const _=parseInt(i.slice(-6,-4)),j=parseInt(i.slice(-9,-7)),$=i.length>9?parseInt(i.substring(0,i.indexOf(":"))):0;if(!isFiniteNumber(g)||!isFiniteNumber(_)||!isFiniteNumber(j)||!isFiniteNumber($))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${i}`);return g+=1e3*_,g+=60*1e3*j,g+=60*60*1e3*$,g},hash=function(i){let g=5381,_=i.length;for(;_;)g=g*33^i.charCodeAt(--_);return(g>>>0).toString()};function generateCueId(h,i,g){return hash(h.toString())+hash(i.toString())+hash(g)}const calculateOffset=function(i,g,_){let j=i[g],$=i[j.prevCC];if(!$||!$.new&&j.new){i.ccOffset=i.presentationOffset=j.start,j.new=!1;return}for(;(_n=$)!=null&&_n.new;){var _n;i.ccOffset+=j.start-$.start,j.new=!1,j=$,$=i[j.prevCC]}i.presentationOffset=_};function parseWebVTT(h,i,g,_,j,$,_n){const _i=new VTTParser,_s=utf8ArrayToStr(new Uint8Array(h)).trim().replace(LINEBREAKS,`
`).split(`
`),ga=[],ba=toMpegTsClockFromTimescale(i.baseTime,i.timescale);let xa="00:00.000",El=0,Tl=0,Sl,Il=!0;_i.oncue=function(Cl){const Nl=g[_];let Dl=g.ccOffset;const Ul=(El-ba)/9e4;Nl!=null&&Nl.new&&(Tl!==void 0?Dl=g.ccOffset=Nl.start:calculateOffset(g,_,Ul)),Ul&&(Dl=Ul-g.presentationOffset);const Kl=Cl.endTime-Cl.startTime,Jl=normalizePts((Cl.startTime+Dl-Tl)*9e4,j*9e4)/9e4;Cl.startTime=Math.max(Jl,0),Cl.endTime=Math.max(Jl+Kl,0);const Ep=Cl.text.trim();Cl.text=decodeURIComponent(encodeURIComponent(Ep)),Cl.id||(Cl.id=generateCueId(Cl.startTime,Cl.endTime,Ep)),Cl.endTime>0&&ga.push(Cl)},_i.onparsingerror=function(Cl){Sl=Cl},_i.onflush=function(){if(Sl){_n(Sl);return}$(ga)},_s.forEach(Cl=>{if(Il)if(startsWith(Cl,"X-TIMESTAMP-MAP=")){Il=!1,Cl.slice(16).split(",").forEach(Nl=>{startsWith(Nl,"LOCAL:")?xa=Nl.slice(6):startsWith(Nl,"MPEGTS:")&&(El=parseInt(Nl.slice(7)))});try{Tl=cueString2millis(xa)/1e3}catch(Nl){Sl=Nl}return}else Cl===""&&(Il=!1);_i.parse(Cl+`
`)}),_i.flush()}const IMSC1_CODEC="stpp.ttml.im1t",HMSF_REGEX=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,TIME_UNIT_REGEX=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,textAlignToLineAlign={left:"start",center:"center",right:"end",start:"start",end:"end"};function parseIMSC1(h,i,g,_){const j=findBox(new Uint8Array(h),["mdat"]);if(j.length===0){_(new Error("Could not parse IMSC1 mdat"));return}const $=j.map(_i=>utf8ArrayToStr(_i)),_n=toTimescaleFromScale(i.baseTime,1,i.timescale);try{$.forEach(_i=>g(parseTTML(_i,_n)))}catch(_i){_(_i)}}function parseTTML(h,i){const j=new DOMParser().parseFromString(h,"text/xml").getElementsByTagName("tt")[0];if(!j)throw new Error("Invalid ttml");const $={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},_n=Object.keys($).reduce((xa,El)=>(xa[El]=j.getAttribute(`ttp:${El}`)||$[El],xa),{}),_i=j.getAttribute("xml:space")!=="preserve",_s=collectionToDictionary(getElementCollection(j,"styling","style")),ga=collectionToDictionary(getElementCollection(j,"layout","region")),ba=getElementCollection(j,"body","[begin]");return[].map.call(ba,xa=>{const El=getTextContent(xa,_i);if(!El||!xa.hasAttribute("begin"))return null;const Tl=parseTtmlTime(xa.getAttribute("begin"),_n),Sl=parseTtmlTime(xa.getAttribute("dur"),_n);let Il=parseTtmlTime(xa.getAttribute("end"),_n);if(Tl===null)throw timestampParsingError(xa);if(Il===null){if(Sl===null)throw timestampParsingError(xa);Il=Tl+Sl}const Cl=new VTTCue(Tl-i,Il-i,El);Cl.id=generateCueId(Cl.startTime,Cl.endTime,Cl.text);const Nl=ga[xa.getAttribute("region")],Dl=_s[xa.getAttribute("style")],Ul=getTtmlStyles(Nl,Dl,_s),{textAlign:Kl}=Ul;if(Kl){const Jl=textAlignToLineAlign[Kl];Jl&&(Cl.lineAlign=Jl),Cl.align=Kl}return _extends$5(Cl,Ul),Cl}).filter(xa=>xa!==null)}function getElementCollection(h,i,g){const _=h.getElementsByTagName(i)[0];return _?[].slice.call(_.querySelectorAll(g)):[]}function collectionToDictionary(h){return h.reduce((i,g)=>{const _=g.getAttribute("xml:id");return _&&(i[_]=g),i},{})}function getTextContent(h,i){return[].slice.call(h.childNodes).reduce((g,_,j)=>{var $;return _.nodeName==="br"&&j?g+`
`:($=_.childNodes)!=null&&$.length?getTextContent(_,i):i?g+_.textContent.trim().replace(/\s+/g," "):g+_.textContent},"")}function getTtmlStyles(h,i,g){const _="http://www.w3.org/ns/ttml#styling";let j=null;const $=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],_n=h!=null&&h.hasAttribute("style")?h.getAttribute("style"):null;return _n&&g.hasOwnProperty(_n)&&(j=g[_n]),$.reduce((_i,_s)=>{const ga=getAttributeNS(i,_,_s)||getAttributeNS(h,_,_s)||getAttributeNS(j,_,_s);return ga&&(_i[_s]=ga),_i},{})}function getAttributeNS(h,i,g){return h&&h.hasAttributeNS(i,g)?h.getAttributeNS(i,g):null}function timestampParsingError(h){return new Error(`Could not parse ttml timestamp ${h}`)}function parseTtmlTime(h,i){if(!h)return null;let g=parseTimeStamp(h);return g===null&&(HMSF_REGEX.test(h)?g=parseHoursMinutesSecondsFrames(h,i):TIME_UNIT_REGEX.test(h)&&(g=parseTimeUnits(h,i))),g}function parseHoursMinutesSecondsFrames(h,i){const g=HMSF_REGEX.exec(h),_=(g[4]|0)+(g[5]|0)/i.subFrameRate;return(g[1]|0)*3600+(g[2]|0)*60+(g[3]|0)+_/i.frameRate}function parseTimeUnits(h,i){const g=TIME_UNIT_REGEX.exec(h),_=Number(g[1]);switch(g[2]){case"h":return _*3600;case"m":return _*60;case"ms":return _*1e3;case"f":return _/i.frameRate;case"t":return _/i.tickRate}return _}class TimelineController{constructor(i){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=newVTTCCs(),this.captionsProperties=void 0,this.hls=i,this.config=i.config,this.Cues=i.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){const g=new OutputFilter(this,"textTrack1"),_=new OutputFilter(this,"textTrack2"),j=new OutputFilter(this,"textTrack3"),$=new OutputFilter(this,"textTrack4");this.cea608Parser1=new Cea608Parser(1,g,_),this.cea608Parser2=new Cea608Parser(3,j,$)}i.on(Events.MEDIA_ATTACHING,this.onMediaAttaching,this),i.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this),i.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),i.on(Events.MANIFEST_LOADED,this.onManifestLoaded,this),i.on(Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),i.on(Events.FRAG_LOADING,this.onFragLoading,this),i.on(Events.FRAG_LOADED,this.onFragLoaded,this),i.on(Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),i.on(Events.FRAG_DECRYPTED,this.onFragDecrypted,this),i.on(Events.INIT_PTS_FOUND,this.onInitPtsFound,this),i.on(Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),i.on(Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:i}=this;i.off(Events.MEDIA_ATTACHING,this.onMediaAttaching,this),i.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this),i.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),i.off(Events.MANIFEST_LOADED,this.onManifestLoaded,this),i.off(Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),i.off(Events.FRAG_LOADING,this.onFragLoading,this),i.off(Events.FRAG_LOADED,this.onFragLoaded,this),i.off(Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),i.off(Events.FRAG_DECRYPTED,this.onFragDecrypted,this),i.off(Events.INIT_PTS_FOUND,this.onInitPtsFound,this),i.off(Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),i.off(Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null}addCues(i,g,_,j,$){let _n=!1;for(let _i=$.length;_i--;){const _s=$[_i],ga=intersection(_s[0],_s[1],g,_);if(ga>=0&&(_s[0]=Math.min(_s[0],g),_s[1]=Math.max(_s[1],_),_n=!0,ga/(_-g)>.5))return}if(_n||$.push([g,_]),this.config.renderTextTracksNatively){const _i=this.captionsTracks[i];this.Cues.newCue(_i,g,_,j)}else{const _i=this.Cues.newCue(null,g,_,j);this.hls.trigger(Events.CUES_PARSED,{type:"captions",cues:_i,track:i})}}onInitPtsFound(i,{frag:g,id:_,initPTS:j,timescale:$}){const{unparsedVttFrags:_n}=this;_==="main"&&(this.initPTS[g.cc]={baseTime:j,timescale:$}),_n.length&&(this.unparsedVttFrags=[],_n.forEach(_i=>{this.onFragLoaded(Events.FRAG_LOADED,_i)}))}getExistingTrack(i){const{media:g}=this;if(g)for(let _=0;_<g.textTracks.length;_++){const j=g.textTracks[_];if(j[i])return j}return null}createCaptionsTrack(i){this.config.renderTextTracksNatively?this.createNativeTrack(i):this.createNonNativeTrack(i)}createNativeTrack(i){if(this.captionsTracks[i])return;const{captionsProperties:g,captionsTracks:_,media:j}=this,{label:$,languageCode:_n}=g[i],_i=this.getExistingTrack(i);if(_i)_[i]=_i,clearCurrentCues(_[i]),sendAddTrackEvent(_[i],j);else{const _s=this.createTextTrack("captions",$,_n);_s&&(_s[i]=!0,_[i]=_s)}}createNonNativeTrack(i){if(this.nonNativeCaptionsTracks[i])return;const g=this.captionsProperties[i];if(!g)return;const _=g.label,j={_id:i,label:_,kind:"captions",default:g.media?!!g.media.default:!1,closedCaptions:g.media};this.nonNativeCaptionsTracks[i]=j,this.hls.trigger(Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[j]})}createTextTrack(i,g,_){const j=this.media;if(j)return j.addTextTrack(i,g,_)}onMediaAttaching(i,g){this.media=g.media,this._cleanTracks()}onMediaDetaching(){const{captionsTracks:i}=this;Object.keys(i).forEach(g=>{clearCurrentCues(i[g]),delete i[g]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=newVTTCCs(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:i}=this;if(!i)return;const g=i.textTracks;if(g)for(let _=0;_<g.length;_++)clearCurrentCues(g[_])}onSubtitleTracksUpdated(i,g){const _=g.subtitleTracks||[],j=_.some($=>$.textCodec===IMSC1_CODEC);if(this.config.enableWebVTT||j&&this.config.enableIMSC1){if(subtitleOptionsIdentical(this.tracks,_)){this.tracks=_;return}if(this.textTracks=[],this.tracks=_,this.config.renderTextTracksNatively){const _n=this.media?this.media.textTracks:null;this.tracks.forEach((_i,_s)=>{let ga;if(_n&&_s<_n.length){let ba=null;for(let xa=0;xa<_n.length;xa++)if(canReuseVttTextTrack(_n[xa],_i)){ba=_n[xa];break}ba&&(ga=ba)}if(ga)clearCurrentCues(ga);else{const ba=this._captionsOrSubtitlesFromCharacteristics(_i);ga=this.createTextTrack(ba,_i.name,_i.lang),ga&&(ga.mode="disabled")}ga&&(ga.groupId=_i.groupId,this.textTracks.push(ga))})}else if(this.tracks.length){const _n=this.tracks.map(_i=>({label:_i.name,kind:_i.type.toLowerCase(),default:_i.default,subtitleTrack:_i}));this.hls.trigger(Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:_n})}}}_captionsOrSubtitlesFromCharacteristics(i){if(i.attrs.CHARACTERISTICS){const g=/transcribes-spoken-dialog/gi.test(i.attrs.CHARACTERISTICS),_=/describes-music-and-sound/gi.test(i.attrs.CHARACTERISTICS);if(g&&_)return"captions"}return"subtitles"}onManifestLoaded(i,g){this.config.enableCEA708Captions&&g.captions&&g.captions.forEach(_=>{const j=/(?:CC|SERVICE)([1-4])/.exec(_.instreamId);if(!j)return;const $=`textTrack${j[1]}`,_n=this.captionsProperties[$];_n&&(_n.label=_.name,_.lang&&(_n.languageCode=_.lang),_n.media=_)})}closedCaptionsForLevel(i){const g=this.hls.levels[i.level];return g==null?void 0:g.attrs["CLOSED-CAPTIONS"]}onFragLoading(i,g){const{cea608Parser1:_,cea608Parser2:j,lastSn:$,lastPartIndex:_n}=this;if(!(!this.enabled||!(_&&j))&&g.frag.type===PlaylistLevelType.MAIN){var _i,_s;const ga=g.frag.sn,ba=(_i=g==null||(_s=g.part)==null?void 0:_s.index)!=null?_i:-1;ga===$+1||ga===$&&ba===_n+1||(_.reset(),j.reset()),this.lastSn=ga,this.lastPartIndex=ba}}onFragLoaded(i,g){const{frag:_,payload:j}=g,{initPTS:$,unparsedVttFrags:_n}=this;if(_.type===PlaylistLevelType.SUBTITLE)if(j.byteLength){if(!$[_.cc]){_n.push(g),$.length&&this.hls.trigger(Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:_,error:new Error("Missing initial subtitle PTS")});return}const _i=_.decryptdata,_s="stats"in g;if(_i==null||!_i.encrypted||_s){const ga=this.tracks[_.level],ba=this.vttCCs;ba[_.cc]||(ba[_.cc]={start:_.start,prevCC:this.prevCC,new:!0},this.prevCC=_.cc),ga&&ga.textCodec===IMSC1_CODEC?this._parseIMSC1(_,j):this._parseVTTs(_,j,ba)}}else this.hls.trigger(Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:_,error:new Error("Empty subtitle payload")})}_parseIMSC1(i,g){const _=this.hls;parseIMSC1(g,this.initPTS[i.cc],j=>{this._appendCues(j,i.level),_.trigger(Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:i})},j=>{logger.log(`Failed to parse IMSC1: ${j}`),_.trigger(Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:j})})}_parseVTTs(i,g,_){var j;const $=this.hls,_n=(j=i.initSegment)!=null&&j.data?appendUint8Array(i.initSegment.data,new Uint8Array(g)):g;parseWebVTT(_n,this.initPTS[i.cc],_,i.cc,i.start,_i=>{this._appendCues(_i,i.level),$.trigger(Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:i})},_i=>{this._fallbackToIMSC1(i,g),logger.log(`Failed to parse VTT cue: ${_i}`),$.trigger(Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:i,error:_i})})}_fallbackToIMSC1(i,g){const _=this.tracks[i.level];_.textCodec||parseIMSC1(g,this.initPTS[i.cc],()=>{_.textCodec=IMSC1_CODEC,this._parseIMSC1(i,g)},()=>{_.textCodec="wvtt"})}_appendCues(i,g){const _=this.hls;if(this.config.renderTextTracksNatively){const j=this.textTracks[g];if(!j||j.mode==="disabled")return;i.forEach($=>addCueToTrack(j,$))}else{const j=this.tracks[g];if(!j)return;const $=j.default?"default":"subtitles"+g;_.trigger(Events.CUES_PARSED,{type:"subtitles",cues:i,track:$})}}onFragDecrypted(i,g){const{frag:_}=g;if(_.type===PlaylistLevelType.SUBTITLE){if(!this.initPTS[_.cc]){this.unparsedVttFrags.push(g);return}this.onFragLoaded(Events.FRAG_LOADED,g)}}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(i,g){const{cea608Parser1:_,cea608Parser2:j}=this;if(!this.enabled||!(_&&j))return;const{frag:$,samples:_n}=g;if(!($.type===PlaylistLevelType.MAIN&&this.closedCaptionsForLevel($)==="NONE"))for(let _i=0;_i<_n.length;_i++){const _s=_n[_i].bytes;if(_s){const ga=this.extractCea608Data(_s);_.addData(_n[_i].pts,ga[0]),j.addData(_n[_i].pts,ga[1])}}}onBufferFlushing(i,{startOffset:g,endOffset:_,endOffsetSubtitles:j,type:$}){const{media:_n}=this;if(!(!_n||_n.currentTime<_)){if(!$||$==="video"){const{captionsTracks:_i}=this;Object.keys(_i).forEach(_s=>removeCuesInRange(_i[_s],g,_))}if(this.config.renderTextTracksNatively&&g===0&&j!==void 0){const{textTracks:_i}=this;Object.keys(_i).forEach(_s=>removeCuesInRange(_i[_s],g,j))}}}extractCea608Data(i){const g=[[],[]],_=i[0]&31;let j=2;for(let $=0;$<_;$++){const _n=i[j++],_i=127&i[j++],_s=127&i[j++];if(_i===0&&_s===0)continue;if((4&_n)!==0){const ba=3&_n;(ba===0||ba===1)&&(g[ba].push(_i),g[ba].push(_s))}}return g}}function canReuseVttTextTrack(h,i){return!!h&&h.label===i.name&&!(h.textTrack1||h.textTrack2)}function intersection(h,i,g,_){return Math.min(i,_)-Math.max(h,g)}function newVTTCCs(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}class CapLevelController{constructor(i){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=i,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(i){this.streamController=i}destroy(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:i}=this;i.on(Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),i.on(Events.MEDIA_ATTACHING,this.onMediaAttaching,this),i.on(Events.MANIFEST_PARSED,this.onManifestParsed,this),i.on(Events.BUFFER_CODECS,this.onBufferCodecs,this),i.on(Events.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:i}=this;i.off(Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),i.off(Events.MEDIA_ATTACHING,this.onMediaAttaching,this),i.off(Events.MANIFEST_PARSED,this.onManifestParsed,this),i.off(Events.BUFFER_CODECS,this.onBufferCodecs,this),i.off(Events.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(i,g){const _=this.hls.levels[g.droppedLevel];this.isLevelAllowed(_)&&this.restrictedLevels.push({bitrate:_.bitrate,height:_.height,width:_.width})}onMediaAttaching(i,g){this.media=g.media instanceof HTMLVideoElement?g.media:null,this.clientRect=null}onManifestParsed(i,g){const _=this.hls;this.restrictedLevels=[],this.firstLevel=g.firstLevel,_.config.capLevelToPlayerSize&&g.video&&this.startCapping()}onBufferCodecs(i,g){this.hls.config.capLevelToPlayerSize&&g.video&&this.startCapping()}onMediaDetaching(){this.stopCapping()}detectPlayerSize(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){const i=this.hls.levels;if(i.length){const g=this.hls;g.autoLevelCapping=this.getMaxLevel(i.length-1),g.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=g.autoLevelCapping}}}getMaxLevel(i){const g=this.hls.levels;if(!g.length)return-1;const _=g.filter((j,$)=>this.isLevelAllowed(j)&&$<=i);return this.clientRect=null,CapLevelController.getMaxLevelByMediaSize(_,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const i=this.media,g={width:0,height:0};if(i){const _=i.getBoundingClientRect();g.width=_.width,g.height=_.height,!g.width&&!g.height&&(g.width=_.right-_.left||i.width||0,g.height=_.bottom-_.top||i.height||0)}return this.clientRect=g,g}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let i=1;if(!this.hls.config.ignoreDevicePixelRatio)try{i=self.devicePixelRatio}catch{}return i}isLevelAllowed(i){return!this.restrictedLevels.some(_=>i.bitrate===_.bitrate&&i.width===_.width&&i.height===_.height)}static getMaxLevelByMediaSize(i,g,_){if(!(i!=null&&i.length))return-1;const j=(_n,_i)=>_i?_n.width!==_i.width||_n.height!==_i.height:!0;let $=i.length-1;for(let _n=0;_n<i.length;_n+=1){const _i=i[_n];if((_i.width>=g||_i.height>=_)&&j(_i,i[_n+1])){$=_n;break}}return $}}class FPSController{constructor(i){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=i,this.registerListeners()}setStreamController(i){this.streamController=i}registerListeners(){this.hls.on(Events.MEDIA_ATTACHING,this.onMediaAttaching,this)}unregisterListeners(){this.hls.off(Events.MEDIA_ATTACHING,this.onMediaAttaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(i,g){const _=this.hls.config;if(_.capLevelOnFPSDrop){const j=g.media instanceof self.HTMLVideoElement?g.media:null;this.media=j,j&&typeof j.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),_.fpsDroppedMonitoringPeriod)}}checkFPS(i,g,_){const j=performance.now();if(g){if(this.lastTime){const $=j-this.lastTime,_n=_-this.lastDroppedFrames,_i=g-this.lastDecodedFrames,_s=1e3*_n/$,ga=this.hls;if(ga.trigger(Events.FPS_DROP,{currentDropped:_n,currentDecoded:_i,totalDroppedFrames:_}),_s>0&&_n>ga.config.fpsDroppedMonitoringThreshold*_i){let ba=ga.currentLevel;logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+ba),ba>0&&(ga.autoLevelCapping===-1||ga.autoLevelCapping>=ba)&&(ba=ba-1,ga.trigger(Events.FPS_DROP_LEVEL_CAPPING,{level:ba,droppedLevel:ga.currentLevel}),ga.autoLevelCapping=ba,this.streamController.nextLevelSwitch())}}this.lastTime=j,this.lastDroppedFrames=_,this.lastDecodedFrames=g}}checkFPSInterval(){const i=this.media;if(i)if(this.isVideoPlaybackQualityAvailable){const g=i.getVideoPlaybackQuality();this.checkFPS(i,g.totalVideoFrames,g.droppedVideoFrames)}else this.checkFPS(i,i.webkitDecodedFrameCount,i.webkitDroppedFrameCount)}}const LOGGER_PREFIX="[eme]";class EMEController{constructor(i){this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.setMediaKeysQueue=EMEController.CDMCleanupPromise?[EMEController.CDMCleanupPromise]:[],this.onMediaEncrypted=this._onMediaEncrypted.bind(this),this.onWaitingForKey=this._onWaitingForKey.bind(this),this.debug=logger.debug.bind(logger,LOGGER_PREFIX),this.log=logger.log.bind(logger,LOGGER_PREFIX),this.warn=logger.warn.bind(logger,LOGGER_PREFIX),this.error=logger.error.bind(logger,LOGGER_PREFIX),this.hls=i,this.config=i.config,this.registerListeners()}destroy(){this.unregisterListeners(),this.onMediaDetached();const i=this.config;i.requestMediaKeySystemAccessFunc=null,i.licenseXhrSetup=i.licenseResponseCallback=void 0,i.drmSystems=i.drmSystemOptions={},this.hls=this.onMediaEncrypted=this.onWaitingForKey=this.keyIdToKeySessionPromise=null,this.config=null}registerListeners(){this.hls.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(Events.MANIFEST_LOADED,this.onManifestLoaded,this)}unregisterListeners(){this.hls.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(Events.MANIFEST_LOADED,this.onManifestLoaded,this)}getLicenseServerUrl(i){const{drmSystems:g,widevineLicenseUrl:_}=this.config,j=g[i];if(j)return j.licenseUrl;if(i===KeySystems.WIDEVINE&&_)return _;throw new Error(`no license server URL configured for key-system "${i}"`)}getServerCertificateUrl(i){const{drmSystems:g}=this.config,_=g[i];if(_)return _.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${i}"]`)}attemptKeySystemAccess(i){const g=this.hls.levels,_=(_n,_i,_s)=>!!_n&&_s.indexOf(_n)===_i,j=g.map(_n=>_n.audioCodec).filter(_),$=g.map(_n=>_n.videoCodec).filter(_);return j.length+$.length===0&&$.push("avc1.42e01e"),new Promise((_n,_i)=>{const _s=ga=>{const ba=ga.shift();this.getMediaKeysPromise(ba,j,$).then(xa=>_n({keySystem:ba,mediaKeys:xa})).catch(xa=>{ga.length?_s(ga):xa instanceof EMEKeyError?_i(xa):_i(new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_NO_ACCESS,error:xa,fatal:!0},xa.message))})};_s(i)})}requestMediaKeySystemAccess(i,g){const{requestMediaKeySystemAccessFunc:_}=this.config;if(typeof _!="function"){let j=`Configured requestMediaKeySystemAccess is not a function ${_}`;return requestMediaKeySystemAccess===null&&self.location.protocol==="http:"&&(j=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(j))}return _(i,g)}getMediaKeysPromise(i,g,_){const j=getSupportedMediaKeySystemConfigurations(i,g,_,this.config.drmSystemOptions),$=this.keySystemAccessPromises[i];let _n=$==null?void 0:$.keySystemAccess;if(!_n){this.log(`Requesting encrypted media "${i}" key-system access with config: ${JSON.stringify(j)}`),_n=this.requestMediaKeySystemAccess(i,j);const _i=this.keySystemAccessPromises[i]={keySystemAccess:_n};return _n.catch(_s=>{this.log(`Failed to obtain access to key-system "${i}": ${_s}`)}),_n.then(_s=>{this.log(`Access for key-system "${_s.keySystem}" obtained`);const ga=this.fetchServerCertificate(i);return this.log(`Create media-keys for "${i}"`),_i.mediaKeys=_s.createMediaKeys().then(ba=>(this.log(`Media-keys created for "${i}"`),ga.then(xa=>xa?this.setMediaKeysServerCertificate(ba,i,xa):ba))),_i.mediaKeys.catch(ba=>{this.error(`Failed to create media-keys for "${i}"}: ${ba}`)}),_i.mediaKeys})}return _n.then(()=>$.mediaKeys)}createMediaKeySessionContext({decryptdata:i,keySystem:g,mediaKeys:_}){this.log(`Creating key-system session "${g}" keyId: ${Hex.hexDump(i.keyId||[])}`);const j=_.createSession(),$={decryptdata:i,keySystem:g,mediaKeys:_,mediaKeysSession:j,keyStatus:"status-pending"};return this.mediaKeySessions.push($),$}renewKeySession(i){const g=i.decryptdata;if(g.pssh){const _=this.createMediaKeySessionContext(i),j=this.getKeyIdString(g),$="cenc";this.keyIdToKeySessionPromise[j]=this.generateRequestWithPreferredKeySession(_,$,g.pssh,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(i)}getKeyIdString(i){if(!i)throw new Error("Could not read keyId of undefined decryptdata");if(i.keyId===null)throw new Error("keyId is null");return Hex.hexDump(i.keyId)}updateKeySession(i,g){var _;const j=i.mediaKeysSession;return this.log(`Updating key-session "${j.sessionId}" for keyID ${Hex.hexDump(((_=i.decryptdata)==null?void 0:_.keyId)||[])}
      } (data length: ${g&&g.byteLength})`),j.update(g)}selectKeySystemFormat(i){const g=Object.keys(i.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${i.sn} ${i.type}: ${i.level}) key formats ${g.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(g)),this.keyFormatPromise}getKeyFormatPromise(i){return new Promise((g,_)=>{const j=getKeySystemsForConfig(this.config),$=i.map(keySystemFormatToKeySystemDomain).filter(_n=>!!_n&&j.indexOf(_n)!==-1);return this.getKeySystemSelectionPromise($).then(({keySystem:_n})=>{const _i=keySystemDomainToKeySystemFormat(_n);_i?g(_i):_(new Error(`Unable to find format for key-system "${_n}"`))}).catch(_)})}loadKey(i){const g=i.keyInfo.decryptdata,_=this.getKeyIdString(g),j=`(keyId: ${_} format: "${g.keyFormat}" method: ${g.method} uri: ${g.uri})`;this.log(`Starting session for key ${j}`);let $=this.keyIdToKeySessionPromise[_];return $||($=this.keyIdToKeySessionPromise[_]=this.getKeySystemForKeyPromise(g).then(({keySystem:_n,mediaKeys:_i})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${i.frag.sn} ${i.frag.type}: ${i.frag.level} using key ${j}`),this.attemptSetMediaKeys(_n,_i).then(()=>{this.throwIfDestroyed();const _s=this.createMediaKeySessionContext({keySystem:_n,mediaKeys:_i,decryptdata:g}),ga="cenc";return this.generateRequestWithPreferredKeySession(_s,ga,g.pssh,"playlist-key")}))),$.catch(_n=>this.handleError(_n))),$}throwIfDestroyed(i="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(i){this.hls&&(this.error(i.message),i instanceof EMEKeyError?this.hls.trigger(Events.ERROR,i.data):this.hls.trigger(Events.ERROR,{type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_NO_KEYS,error:i,fatal:!0}))}getKeySystemForKeyPromise(i){const g=this.getKeyIdString(i),_=this.keyIdToKeySessionPromise[g];if(!_){const j=keySystemFormatToKeySystemDomain(i.keyFormat),$=j?[j]:getKeySystemsForConfig(this.config);return this.attemptKeySystemAccess($)}return _}getKeySystemSelectionPromise(i){if(i.length||(i=getKeySystemsForConfig(this.config)),i.length===0)throw new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${JSON.stringify({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(i)}_onMediaEncrypted(i){const{initDataType:g,initData:_}=i;if(this.debug(`"${i.type}" event: init data type: "${g}"`),_===null)return;let j,$;if(g==="sinf"&&this.config.drmSystems[KeySystems.FAIRPLAY]){const ba=bin2str(new Uint8Array(_));try{const xa=base64Decode(JSON.parse(ba).sinf),El=parseSinf(new Uint8Array(xa));if(!El)return;j=El.subarray(8,24),$=KeySystems.FAIRPLAY}catch{this.warn('Failed to parse sinf "encrypted" event message initData');return}}else{const ba=parsePssh(_);if(ba===null)return;ba.version===0&&ba.systemId===KeySystemIds.WIDEVINE&&ba.data&&(j=ba.data.subarray(8,24)),$=keySystemIdToKeySystemDomain(ba.systemId)}if(!$||!j)return;const _n=Hex.hexDump(j),{keyIdToKeySessionPromise:_i,mediaKeySessions:_s}=this;let ga=_i[_n];for(let ba=0;ba<_s.length;ba++){const xa=_s[ba],El=xa.decryptdata;if(El.pssh||!El.keyId)continue;const Tl=Hex.hexDump(El.keyId);if(_n===Tl||El.uri.replace(/-/g,"").indexOf(_n)!==-1){ga=_i[Tl],delete _i[Tl],El.pssh=new Uint8Array(_),El.keyId=j,ga=_i[_n]=ga.then(()=>this.generateRequestWithPreferredKeySession(xa,g,_,"encrypted-event-key-match"));break}}ga||(ga=_i[_n]=this.getKeySystemSelectionPromise([$]).then(({keySystem:ba,mediaKeys:xa})=>{var El;this.throwIfDestroyed();const Tl=new LevelKey("ISO-23001-7",_n,(El=keySystemDomainToKeySystemFormat(ba))!=null?El:"");return Tl.pssh=new Uint8Array(_),Tl.keyId=j,this.attemptSetMediaKeys(ba,xa).then(()=>{this.throwIfDestroyed();const Sl=this.createMediaKeySessionContext({decryptdata:Tl,keySystem:ba,mediaKeys:xa});return this.generateRequestWithPreferredKeySession(Sl,g,_,"encrypted-event-no-match")})})),ga.catch(ba=>this.handleError(ba))}_onWaitingForKey(i){this.log(`"${i.type}" event`)}attemptSetMediaKeys(i,g){const _=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${i}"`);const j=Promise.all(_).then(()=>{if(!this.media)throw new Error("Attempted to set mediaKeys without media element attached");return this.media.setMediaKeys(g)});return this.setMediaKeysQueue.push(j),j.then(()=>{this.log(`Media-keys set for "${i}"`),_.push(j),this.setMediaKeysQueue=this.setMediaKeysQueue.filter($=>_.indexOf($)===-1)})}generateRequestWithPreferredKeySession(i,g,_,j){var $,_n;const _i=($=this.config.drmSystems)==null||(_n=$[i.keySystem])==null?void 0:_n.generateRequest;if(_i)try{const El=_i.call(this.hls,g,_,i);if(!El)throw new Error("Invalid response from configured generateRequest filter");g=El.initDataType,_=i.decryptdata.pssh=El.initData?new Uint8Array(El.initData):null}catch(El){var _s;if(this.warn(El.message),(_s=this.hls)!=null&&_s.config.debug)throw El}if(_===null)return this.log(`Skipping key-session request for "${j}" (no initData)`),Promise.resolve(i);const ga=this.getKeyIdString(i.decryptdata);this.log(`Generating key-session request for "${j}": ${ga} (init data type: ${g} length: ${_?_.byteLength:null})`);const ba=new EventEmitter;i.mediaKeysSession.onmessage=El=>{const Tl=i.mediaKeysSession;if(!Tl){ba.emit("error",new Error("invalid state"));return}const{messageType:Sl,message:Il}=El;this.log(`"${Sl}" message event for session "${Tl.sessionId}" message size: ${Il.byteLength}`),Sl==="license-request"||Sl==="license-renewal"?this.renewLicense(i,Il).catch(Cl=>{this.handleError(Cl),ba.emit("error",Cl)}):Sl==="license-release"?i.keySystem===KeySystems.FAIRPLAY&&(this.updateKeySession(i,strToUtf8array("acknowledged")),this.removeSession(i)):this.warn(`unhandled media key message type "${Sl}"`)},i.mediaKeysSession.onkeystatuseschange=El=>{if(!i.mediaKeysSession){ba.emit("error",new Error("invalid state"));return}this.onKeyStatusChange(i);const Sl=i.keyStatus;ba.emit("keyStatus",Sl),Sl==="expired"&&(this.warn(`${i.keySystem} expired for key ${ga}`),this.renewKeySession(i))};const xa=new Promise((El,Tl)=>{ba.on("error",Tl),ba.on("keyStatus",Sl=>{Sl.startsWith("usable")?El():Sl==="output-restricted"?Tl(new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):Sl==="internal-error"?Tl(new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},`key status changed to "${Sl}"`)):Sl==="expired"?Tl(new Error("key expired while generating request")):this.warn(`unhandled key status change "${Sl}"`)})});return i.mediaKeysSession.generateRequest(g,_).then(()=>{var El;this.log(`Request generated for key-session "${(El=i.mediaKeysSession)==null?void 0:El.sessionId}" keyId: ${ga}`)}).catch(El=>{throw new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_NO_SESSION,error:El,fatal:!1},`Error generating key-session request: ${El}`)}).then(()=>xa).catch(El=>{throw ba.removeAllListeners(),this.removeSession(i),El}).then(()=>(ba.removeAllListeners(),i))}onKeyStatusChange(i){i.mediaKeysSession.keyStatuses.forEach((g,_)=>{this.log(`key status change "${g}" for keyStatuses keyId: ${Hex.hexDump("buffer"in _?new Uint8Array(_.buffer,_.byteOffset,_.byteLength):new Uint8Array(_))} session keyId: ${Hex.hexDump(new Uint8Array(i.decryptdata.keyId||[]))} uri: ${i.decryptdata.uri}`),i.keyStatus=g})}fetchServerCertificate(i){const g=this.config,_=g.loader,j=new _(g),$=this.getServerCertificateUrl(i);return $?(this.log(`Fetching serverCertificate for "${i}"`),new Promise((_n,_i)=>{const _s={responseType:"arraybuffer",url:$},ga=g.certLoadPolicy.default,ba={loadPolicy:ga,timeout:ga.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},xa={onSuccess:(El,Tl,Sl,Il)=>{_n(El.data)},onError:(El,Tl,Sl,Il)=>{_i(new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:Sl,response:_objectSpread2({url:_s.url,data:void 0},El)},`"${i}" certificate request failed (${$}). Status: ${El.code} (${El.text})`))},onTimeout:(El,Tl,Sl)=>{_i(new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:Sl,response:{url:_s.url,data:void 0}},`"${i}" certificate request timed out (${$})`))},onAbort:(El,Tl,Sl)=>{_i(new Error("aborted"))}};j.load(_s,ba,xa)})):Promise.resolve()}setMediaKeysServerCertificate(i,g,_){return new Promise((j,$)=>{i.setServerCertificate(_).then(_n=>{this.log(`setServerCertificate ${_n?"success":"not supported by CDM"} (${_==null?void 0:_.byteLength}) on "${g}"`),j(i)}).catch(_n=>{$(new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:_n,fatal:!0},_n.message))})})}renewLicense(i,g){return this.requestLicense(i,new Uint8Array(g)).then(_=>this.updateKeySession(i,new Uint8Array(_)).catch(j=>{throw new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:j,fatal:!0},j.message)}))}setupLicenseXHR(i,g,_,j){const $=this.config.licenseXhrSetup;return $?Promise.resolve().then(()=>{if(!_.decryptdata)throw new Error("Key removed");return $.call(this.hls,i,g,_,j)}).catch(_n=>{if(!_.decryptdata)throw _n;return i.open("POST",g,!0),$.call(this.hls,i,g,_,j)}).then(_n=>(i.readyState||i.open("POST",g,!0),{xhr:i,licenseChallenge:_n||j})):(i.open("POST",g,!0),Promise.resolve({xhr:i,licenseChallenge:j}))}requestLicense(i,g){const _=this.config.keyLoadPolicy.default;return new Promise((j,$)=>{const _n=this.getLicenseServerUrl(i.keySystem);this.log(`Sending license request to URL: ${_n}`);const _i=new XMLHttpRequest;_i.responseType="arraybuffer",_i.onreadystatechange=()=>{if(!this.hls||!i.mediaKeysSession)return $(new Error("invalid state"));if(_i.readyState===4)if(_i.status===200){this._requestLicenseFailureCount=0;let _s=_i.response;this.log(`License received ${_s instanceof ArrayBuffer?_s.byteLength:_s}`);const ga=this.config.licenseResponseCallback;if(ga)try{_s=ga.call(this.hls,_i,_n,i)}catch(ba){this.error(ba)}j(_s)}else{const _s=_.errorRetry,ga=_s?_s.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>ga||_i.status>=400&&_i.status<500)$(new EMEKeyError({type:ErrorTypes.KEY_SYSTEM_ERROR,details:ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:_i,response:{url:_n,data:void 0,code:_i.status,text:_i.statusText}},`License Request XHR failed (${_n}). Status: ${_i.status} (${_i.statusText})`));else{const ba=ga-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${ba} attempts left`),this.requestLicense(i,g).then(j,$)}}},i.licenseXhr&&i.licenseXhr.readyState!==XMLHttpRequest.DONE&&i.licenseXhr.abort(),i.licenseXhr=_i,this.setupLicenseXHR(_i,_n,i,g).then(({xhr:_s,licenseChallenge:ga})=>{_s.send(ga)})})}onMediaAttached(i,g){if(!this.config.emeEnabled)return;const _=g.media;this.media=_,_.addEventListener("encrypted",this.onMediaEncrypted),_.addEventListener("waitingforkey",this.onWaitingForKey)}onMediaDetached(){const i=this.media,g=this.mediaKeySessions;i&&(i.removeEventListener("encrypted",this.onMediaEncrypted),i.removeEventListener("waitingforkey",this.onWaitingForKey),this.media=null),this._requestLicenseFailureCount=0,this.setMediaKeysQueue=[],this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},LevelKey.clearKeyUriToKeyIdMap();const _=g.length;EMEController.CDMCleanupPromise=Promise.all(g.map(j=>this.removeSession(j)).concat(i==null?void 0:i.setMediaKeys(null).catch(j=>{this.log(`Could not clear media keys: ${j}. media.src: ${i==null?void 0:i.src}`)}))).then(()=>{_&&(this.log("finished closing key sessions and clearing media keys"),g.length=0)}).catch(j=>{this.log(`Could not close sessions and clear media keys: ${j}. media.src: ${i==null?void 0:i.src}`)})}onManifestLoading(){this.keyFormatPromise=null}onManifestLoaded(i,{sessionKeys:g}){if(!(!g||!this.config.emeEnabled)&&!this.keyFormatPromise){const _=g.reduce((j,$)=>(j.indexOf($.keyFormat)===-1&&j.push($.keyFormat),j),[]);this.log(`Selecting key-system from session-keys ${_.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(_)}}removeSession(i){const{mediaKeysSession:g,licenseXhr:_}=i;if(g){this.log(`Remove licenses and keys and close session ${g.sessionId}`),g.onmessage=null,g.onkeystatuseschange=null,_&&_.readyState!==XMLHttpRequest.DONE&&_.abort(),i.mediaKeysSession=i.decryptdata=i.licenseXhr=void 0;const j=this.mediaKeySessions.indexOf(i);return j>-1&&this.mediaKeySessions.splice(j,1),g.remove().catch($=>{this.log(`Could not remove session: ${$}`)}).then(()=>g.close()).catch($=>{this.log(`Could not close session: ${$}`)})}}}EMEController.CDMCleanupPromise=void 0;class EMEKeyError extends Error{constructor(i,g){super(g),this.data=void 0,i.error||(i.error=new Error(g)),this.data=i,i.err=i.error}}const CMCDVersion=1;var CMCDObjectType={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"};const CMCDStreamingFormatHLS="h";class CMCDController{constructor(i){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=j=>{try{this.apply(j,{ot:CMCDObjectType.MANIFEST,su:!this.initialized})}catch($){logger.warn("Could not generate manifest CMCD data.",$)}},this.applyFragmentData=j=>{try{const $=j.frag,_n=this.hls.levels[$.level],_i=this.getObjectType($),_s={d:$.duration*1e3,ot:_i};(_i===CMCDObjectType.VIDEO||_i===CMCDObjectType.AUDIO||_i==CMCDObjectType.MUXED)&&(_s.br=_n.bitrate/1e3,_s.tb=this.getTopBandwidth(_i)/1e3,_s.bl=this.getBufferLength(_i)),this.apply(j,_s)}catch($){logger.warn("Could not generate segment CMCD data.",$)}},this.hls=i;const g=this.config=i.config,{cmcd:_}=g;_!=null&&(g.pLoader=this.createPlaylistLoader(),g.fLoader=this.createFragmentLoader(),this.sid=_.sessionId||CMCDController.uuid(),this.cid=_.contentId,this.useHeaders=_.useHeaders===!0,this.registerListeners())}registerListeners(){const i=this.hls;i.on(Events.MEDIA_ATTACHED,this.onMediaAttached,this),i.on(Events.MEDIA_DETACHED,this.onMediaDetached,this),i.on(Events.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const i=this.hls;i.off(Events.MEDIA_ATTACHED,this.onMediaAttached,this),i.off(Events.MEDIA_DETACHED,this.onMediaDetached,this),i.off(Events.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null}onMediaAttached(i,g){this.media=g.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(i,g){var _,j;this.audioBuffer=(_=g.tracks.audio)==null?void 0:_.buffer,this.videoBuffer=(j=g.tracks.video)==null?void 0:j.buffer}createData(){var i;return{v:CMCDVersion,sf:CMCDStreamingFormatHLS,sid:this.sid,cid:this.cid,pr:(i=this.media)==null?void 0:i.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(i,g={}){_extends$5(g,this.createData());const _=g.ot===CMCDObjectType.INIT||g.ot===CMCDObjectType.VIDEO||g.ot===CMCDObjectType.MUXED;if(this.starved&&_&&(g.bs=!0,g.su=!0,this.starved=!1),g.su==null&&(g.su=this.buffering),this.useHeaders){const j=CMCDController.toHeaders(g);if(!Object.keys(j).length)return;i.headers||(i.headers={}),_extends$5(i.headers,j)}else{const j=CMCDController.toQuery(g);if(!j)return;i.url=CMCDController.appendQueryToUri(i.url,j)}}getObjectType(i){const{type:g}=i;if(g==="subtitle")return CMCDObjectType.TIMED_TEXT;if(i.sn==="initSegment")return CMCDObjectType.INIT;if(g==="audio")return CMCDObjectType.AUDIO;if(g==="main")return this.hls.audioTracks.length?CMCDObjectType.VIDEO:CMCDObjectType.MUXED}getTopBandwidth(i){let g=0,_;const j=this.hls;if(i===CMCDObjectType.AUDIO)_=j.audioTracks;else{const $=j.maxAutoLevel,_n=$>-1?$+1:j.levels.length;_=j.levels.slice(0,_n)}for(const $ of _)$.bitrate>g&&(g=$.bitrate);return g>0?g:NaN}getBufferLength(i){const g=this.hls.media,_=i===CMCDObjectType.AUDIO?this.audioBuffer:this.videoBuffer;return!_||!g?NaN:BufferHelper.bufferInfo(_,g.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:i}=this.config,g=this.applyPlaylistData,_=i||this.config.loader;return class{constructor($){this.loader=void 0,this.loader=new _($)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load($,_n,_i){g($),this.loader.load($,_n,_i)}}}createFragmentLoader(){const{fLoader:i}=this.config,g=this.applyFragmentData,_=i||this.config.loader;return class{constructor($){this.loader=void 0,this.loader=new _($)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load($,_n,_i){g($),this.loader.load($,_n,_i)}}}static uuid(){const i=URL.createObjectURL(new Blob),g=i.toString();return URL.revokeObjectURL(i),g.slice(g.lastIndexOf("/")+1)}static serialize(i){const g=[],_=ga=>!Number.isNaN(ga)&&ga!=null&&ga!==""&&ga!==!1,j=ga=>Math.round(ga),$=ga=>j(ga/100)*100,_i={br:j,d:j,bl:$,dl:$,mtp:$,nor:ga=>encodeURIComponent(ga),rtp:$,tb:j},_s=Object.keys(i||{}).sort();for(const ga of _s){let ba=i[ga];if(!_(ba)||ga==="v"&&ba===1||ga=="pr"&&ba===1)continue;const xa=_i[ga];xa&&(ba=xa(ba));const El=typeof ba;let Tl;ga==="ot"||ga==="sf"||ga==="st"?Tl=`${ga}=${ba}`:El==="boolean"?Tl=ga:El==="number"?Tl=`${ga}=${ba}`:Tl=`${ga}=${JSON.stringify(ba)}`,g.push(Tl)}return g.join(",")}static toHeaders(i){const g=Object.keys(i),_={},j=["Object","Request","Session","Status"],$=[{},{},{},{}],_n={br:0,d:0,ot:0,tb:0,bl:1,dl:1,mtp:1,nor:1,nrr:1,su:1,cid:2,pr:2,sf:2,sid:2,st:2,v:2,bs:3,rtp:3};for(const _i of g){const _s=_n[_i]!=null?_n[_i]:1;$[_s][_i]=i[_i]}for(let _i=0;_i<$.length;_i++){const _s=CMCDController.serialize($[_i]);_s&&(_[`CMCD-${j[_i]}`]=_s)}return _}static toQuery(i){return`CMCD=${encodeURIComponent(CMCDController.serialize(i))}`}static appendQueryToUri(i,g){if(!g)return i;const _=i.includes("?")?"&":"?";return`${i}${_}${g}`}}const PATHWAY_PENALTY_DURATION_MS=3e5;class ContentSteeringController{constructor(i){this.hls=void 0,this.log=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this.pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=i,this.log=logger.log.bind(logger,"[content-steering]:"),this.registerListeners()}registerListeners(){const i=this.hls;i.on(Events.MANIFEST_LOADING,this.onManifestLoading,this),i.on(Events.MANIFEST_LOADED,this.onManifestLoaded,this),i.on(Events.MANIFEST_PARSED,this.onManifestParsed,this),i.on(Events.ERROR,this.onError,this)}unregisterListeners(){const i=this.hls;i&&(i.off(Events.MANIFEST_LOADING,this.onManifestLoading,this),i.off(Events.MANIFEST_LOADED,this.onManifestLoaded,this),i.off(Events.MANIFEST_PARSED,this.onManifestParsed,this),i.off(Events.ERROR,this.onError,this))}startLoad(){if(this.started=!0,self.clearTimeout(this.reloadTimer),this.enabled&&this.uri)if(this.updated){const i=Math.max(this.timeToLoad*1e3-(performance.now()-this.updated),0);this.scheduleRefresh(this.uri,i)}else this.loadSteeringManifest(this.uri)}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),self.clearTimeout(this.reloadTimer)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(i){const g=this.levels;g&&(this.levels=g.filter(_=>_!==i))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(i,g){const{contentSteering:_}=g;_!==null&&(this.pathwayId=_.pathwayId,this.uri=_.uri,this.started&&this.startLoad())}onManifestParsed(i,g){this.audioTracks=g.audioTracks,this.subtitleTracks=g.subtitleTracks}onError(i,g){const{errorAction:_}=g;if((_==null?void 0:_.action)===NetworkErrorAction.SendAlternateToPenaltyBox&&_.flags===ErrorActionFlags.MoveAllAlternatesMatchingHost){let j=this.pathwayPriority;const $=this.pathwayId;this.penalizedPathways[$]||(this.penalizedPathways[$]=performance.now()),!j&&this.levels&&(j=this.levels.reduce((_n,_i)=>(_n.indexOf(_i.pathwayId)===-1&&_n.push(_i.pathwayId),_n),[])),j&&j.length>1&&(this.updatePathwayPriority(j),_.resolved=this.pathwayId!==$)}}filterParsedLevels(i){this.levels=i;let g=this.getLevelsForPathway(this.pathwayId);if(g.length===0){const _=i[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${_}"`),g=this.getLevelsForPathway(_),this.pathwayId=_}return g.length!==i.length?(this.log(`Found ${g.length}/${i.length} levels in Pathway "${this.pathwayId}"`),g):i}getLevelsForPathway(i){return this.levels===null?[]:this.levels.filter(g=>i===g.pathwayId)}updatePathwayPriority(i){this.pathwayPriority=i;let g;const _=this.penalizedPathways,j=performance.now();Object.keys(_).forEach($=>{j-_[$]>PATHWAY_PENALTY_DURATION_MS&&delete _[$]});for(let $=0;$<i.length;$++){const _n=i[$];if(_[_n])continue;if(_n===this.pathwayId)return;const _i=this.hls.nextLoadLevel,_s=this.hls.levels[_i];if(g=this.getLevelsForPathway(_n),g.length>0){this.log(`Setting Pathway to "${_n}"`),this.pathwayId=_n,this.hls.trigger(Events.LEVELS_UPDATED,{levels:g});const ga=this.hls.levels[_i];_s&&ga&&this.levels&&(ga.attrs["STABLE-VARIANT-ID"]!==_s.attrs["STABLE-VARIANT-ID"]&&ga.bitrate!==_s.bitrate&&this.log(`Unstable Pathways change from bitrate ${_s.bitrate} to ${ga.bitrate}`),this.hls.nextLoadLevel=_i);break}}}clonePathways(i){const g=this.levels;if(!g)return;const _={},j={};i.forEach($=>{const{ID:_n,"BASE-ID":_i,"URI-REPLACEMENT":_s}=$;if(g.some(ba=>ba.pathwayId===_n))return;const ga=this.getLevelsForPathway(_i).map(ba=>{const xa=_extends$5({},ba);xa.details=void 0,xa.url=performUriReplacement(ba.uri,ba.attrs["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",_s);const El=new AttrList(ba.attrs);El["PATHWAY-ID"]=_n;const Tl=El.AUDIO&&`${El.AUDIO}_clone_${_n}`,Sl=El.SUBTITLES&&`${El.SUBTITLES}_clone_${_n}`;Tl&&(_[El.AUDIO]=Tl,El.AUDIO=Tl),Sl&&(j[El.SUBTITLES]=Sl,El.SUBTITLES=Sl),xa.attrs=El;const Il=new Level(xa);return addGroupId(Il,"audio",Tl),addGroupId(Il,"text",Sl),Il});g.push(...ga),cloneRenditionGroups(this.audioTracks,_,_s,_n),cloneRenditionGroups(this.subtitleTracks,j,_s,_n)})}loadSteeringManifest(i){const g=this.hls.config,_=g.loader;this.loader&&this.loader.destroy(),this.loader=new _(g);let j;try{j=new self.URL(i)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${i}`);return}if(j.protocol!=="data:"){const ba=(this.hls.bandwidthEstimate||g.abrEwmaDefaultEstimate)|0;j.searchParams.set("_HLS_pathway",this.pathwayId),j.searchParams.set("_HLS_throughput",""+ba)}const $={responseType:"json",url:j.href},_n=g.steeringManifestLoadPolicy.default,_i=_n.errorRetry||_n.timeoutRetry||{},_s={loadPolicy:_n,timeout:_n.maxLoadTimeMs,maxRetry:_i.maxNumRetry||0,retryDelay:_i.retryDelayMs||0,maxRetryDelay:_i.maxRetryDelayMs||0},ga={onSuccess:(ba,xa,El,Tl)=>{this.log(`Loaded steering manifest: "${j}"`);const Sl=ba.data;if(Sl.VERSION!==1){this.log(`Steering VERSION ${Sl.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=Sl.TTL;const{"RELOAD-URI":Il,"PATHWAY-CLONES":Cl,"PATHWAY-PRIORITY":Nl}=Sl;if(Il)try{this.uri=new self.URL(Il,j).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${Il}`);return}this.scheduleRefresh(this.uri||El.url),Cl&&this.clonePathways(Cl),Nl&&this.updatePathwayPriority(Nl)},onError:(ba,xa,El,Tl)=>{if(this.log(`Error loading steering manifest: ${ba.code} ${ba.text} (${xa.url})`),this.stopLoad(),ba.code===410){this.enabled=!1,this.log(`Steering manifest ${xa.url} no longer available`);return}let Sl=this.timeToLoad*1e3;if(ba.code===429){const Il=this.loader;if(typeof(Il==null?void 0:Il.getResponseHeader)=="function"){const Cl=Il.getResponseHeader("Retry-After");Cl&&(Sl=parseFloat(Cl)*1e3)}this.log(`Steering manifest ${xa.url} rate limited`);return}this.scheduleRefresh(this.uri||xa.url,Sl)},onTimeout:(ba,xa,El)=>{this.log(`Timeout loading steering manifest (${xa.url})`),this.scheduleRefresh(this.uri||xa.url)}};this.log(`Requesting steering manifest: ${j}`),this.loader.load($,_s,ga)}scheduleRefresh(i,g=this.timeToLoad*1e3){self.clearTimeout(this.reloadTimer),this.reloadTimer=self.setTimeout(()=>{this.loadSteeringManifest(i)},g)}}function cloneRenditionGroups(h,i,g,_){h&&Object.keys(i).forEach(j=>{const $=h.filter(_n=>_n.groupId===j).map(_n=>{const _i=_extends$5({},_n);return _i.details=void 0,_i.attrs=new AttrList(_i.attrs),_i.url=_i.attrs.URI=performUriReplacement(_n.url,_n.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",g),_i.groupId=_i.attrs["GROUP-ID"]=i[j],_i.attrs["PATHWAY-ID"]=_,_i});h.push(...$)})}function performUriReplacement(h,i,g,_){const{HOST:j,PARAMS:$,[g]:_n}=_;let _i;i&&(_i=_n==null?void 0:_n[i],_i&&(h=_i));const _s=new self.URL(h);return j&&!_i&&(_s.host=j),$&&Object.keys($).sort().forEach(ga=>{ga&&_s.searchParams.set(ga,$[ga])}),_s.href}const AGE_HEADER_LINE_REGEX=/^age:\s*[\d.]+\s*$/im;class XhrLoader{constructor(i){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=i&&i.xhrSetup||null,this.stats=new LoadStats,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null}abortInternal(){const i=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),i&&(i.onreadystatechange=null,i.onprogress=null,i.readyState!==4&&(this.stats.aborted=!0,i.abort()))}abort(){var i;this.abortInternal(),(i=this.callbacks)!=null&&i.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(i,g,_){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=i,this.config=g,this.callbacks=_,this.loadInternal()}loadInternal(){const{config:i,context:g}=this;if(!i)return;const _=this.loader=new self.XMLHttpRequest,j=this.stats;j.loading.first=0,j.loaded=0;const $=this.xhrSetup;$?Promise.resolve().then(()=>{if(!this.stats.aborted)return $(_,g.url)}).catch(_n=>(_.open("GET",g.url,!0),$(_,g.url))).then(()=>{this.stats.aborted||this.openAndSendXhr(_,g,i)}).catch(_n=>{this.callbacks.onError({code:_.status,text:_n.message},g,_,j)}):this.openAndSendXhr(_,g,i)}openAndSendXhr(i,g,_){i.readyState||i.open("GET",g.url,!0);const j=this.context.headers,{maxTimeToFirstByteMs:$,maxLoadTimeMs:_n}=_.loadPolicy;if(j)for(const _i in j)i.setRequestHeader(_i,j[_i]);g.rangeEnd&&i.setRequestHeader("Range","bytes="+g.rangeStart+"-"+(g.rangeEnd-1)),i.onreadystatechange=this.readystatechange.bind(this),i.onprogress=this.loadprogress.bind(this),i.responseType=g.responseType,self.clearTimeout(this.requestTimeout),_.timeout=$&&isFiniteNumber($)?$:_n,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),_.timeout),i.send()}readystatechange(){const{context:i,loader:g,stats:_}=this;if(!i||!g)return;const j=g.readyState,$=this.config;if(!_.aborted&&j>=2&&(_.loading.first===0&&(_.loading.first=Math.max(self.performance.now(),_.loading.start),$.timeout!==$.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),$.timeout=$.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),$.loadPolicy.maxLoadTimeMs-(_.loading.first-_.loading.start)))),j===4)){self.clearTimeout(this.requestTimeout),g.onreadystatechange=null,g.onprogress=null;const _n=g.status,_i=g.responseType!=="text";if(_n>=200&&_n<300&&(_i&&g.response||g.responseText!==null)){_.loading.end=Math.max(self.performance.now(),_.loading.first);const _s=_i?g.response:g.responseText,ga=g.responseType==="arraybuffer"?_s.byteLength:_s.length;if(_.loaded=_.total=ga,_.bwEstimate=_.total*8e3/(_.loading.end-_.loading.first),!this.callbacks)return;const ba=this.callbacks.onProgress;if(ba&&ba(_,i,_s,g),!this.callbacks)return;const xa={url:g.responseURL,data:_s,code:_n};this.callbacks.onSuccess(xa,_,i,g)}else{const _s=$.loadPolicy.errorRetry,ga=_.retry;shouldRetry(_s,ga,!1,_n)?this.retry(_s):(logger.error(`${_n} while loading ${i.url}`),this.callbacks.onError({code:_n,text:g.statusText},i,g,_))}}}loadtimeout(){var i;const g=(i=this.config)==null?void 0:i.loadPolicy.timeoutRetry,_=this.stats.retry;if(shouldRetry(g,_,!0))this.retry(g);else{logger.warn(`timeout while loading ${this.context.url}`);const j=this.callbacks;j&&(this.abortInternal(),j.onTimeout(this.stats,this.context,this.loader))}}retry(i){const{context:g,stats:_}=this;this.retryDelay=getRetryDelay(i,_.retry),_.retry++,logger.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${g.url}, retrying ${_.retry}/${i.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(i){const g=this.stats;g.loaded=i.loaded,i.lengthComputable&&(g.total=i.total)}getCacheAge(){let i=null;if(this.loader&&AGE_HEADER_LINE_REGEX.test(this.loader.getAllResponseHeaders())){const g=this.loader.getResponseHeader("age");i=g?parseFloat(g):null}return i}getResponseHeader(i){return this.loader&&new RegExp(`^${i}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(i):null}}function fetchSupported(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const BYTERANGE=/(\d+)-(\d+)\/(\d+)/;class FetchLoader{constructor(i){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=i.fetchSetup||getRequest,this.controller=new self.AbortController,this.stats=new LoadStats}destroy(){this.loader=this.callbacks=null,this.abortInternal()}abortInternal(){const i=this.response;i!=null&&i.ok||(this.stats.aborted=!0,this.controller.abort())}abort(){var i;this.abortInternal(),(i=this.callbacks)!=null&&i.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(i,g,_){const j=this.stats;if(j.loading.start)throw new Error("Loader can only be used once.");j.loading.start=self.performance.now();const $=getRequestParameters(i,this.controller.signal),_n=_.onProgress,_i=i.responseType==="arraybuffer",_s=_i?"byteLength":"length",{maxTimeToFirstByteMs:ga,maxLoadTimeMs:ba}=g.loadPolicy;this.context=i,this.config=g,this.callbacks=_,this.request=this.fetchSetup(i,$),self.clearTimeout(this.requestTimeout),g.timeout=ga&&isFiniteNumber(ga)?ga:ba,this.requestTimeout=self.setTimeout(()=>{this.abortInternal(),_.onTimeout(j,i,this.response)},g.timeout),self.fetch(this.request).then(xa=>{this.response=this.loader=xa;const El=Math.max(self.performance.now(),j.loading.start);if(self.clearTimeout(this.requestTimeout),g.timeout=ba,this.requestTimeout=self.setTimeout(()=>{this.abortInternal(),_.onTimeout(j,i,this.response)},ba-(El-j.loading.start)),!xa.ok){const{status:Tl,statusText:Sl}=xa;throw new FetchError(Sl||"fetch, bad network response",Tl,xa)}return j.loading.first=El,j.total=getContentLength(xa.headers)||j.total,_n&&isFiniteNumber(g.highWaterMark)?this.loadProgressively(xa,j,i,g.highWaterMark,_n):_i?xa.arrayBuffer():i.responseType==="json"?xa.json():xa.text()}).then(xa=>{const{response:El}=this;self.clearTimeout(this.requestTimeout),j.loading.end=Math.max(self.performance.now(),j.loading.first);const Tl=xa[_s];Tl&&(j.loaded=j.total=Tl);const Sl={url:El.url,data:xa,code:El.status};_n&&!isFiniteNumber(g.highWaterMark)&&_n(j,i,xa,El),_.onSuccess(Sl,j,i,El)}).catch(xa=>{if(self.clearTimeout(this.requestTimeout),j.aborted)return;const El=xa&&xa.code||0,Tl=xa?xa.message:null;_.onError({code:El,text:Tl},i,xa?xa.details:null,j)})}getCacheAge(){let i=null;if(this.response){const g=this.response.headers.get("age");i=g?parseFloat(g):null}return i}getResponseHeader(i){return this.response?this.response.headers.get(i):null}loadProgressively(i,g,_,j=0,$){const _n=new ChunkCache,_i=i.body.getReader(),_s=()=>_i.read().then(ga=>{if(ga.done)return _n.dataLength&&$(g,_,_n.flush(),i),Promise.resolve(new ArrayBuffer(0));const ba=ga.value,xa=ba.length;return g.loaded+=xa,xa<j||_n.dataLength?(_n.push(ba),_n.dataLength>=j&&$(g,_,_n.flush(),i)):$(g,_,ba,i),_s()}).catch(()=>Promise.reject());return _s()}}function getRequestParameters(h,i){const g={method:"GET",mode:"cors",credentials:"same-origin",signal:i,headers:new self.Headers(_extends$5({},h.headers))};return h.rangeEnd&&g.headers.set("Range","bytes="+h.rangeStart+"-"+String(h.rangeEnd-1)),g}function getByteRangeLength(h){const i=BYTERANGE.exec(h);if(i)return parseInt(i[2])-parseInt(i[1])+1}function getContentLength(h){const i=h.get("Content-Range");if(i){const _=getByteRangeLength(i);if(isFiniteNumber(_))return _}const g=h.get("Content-Length");if(g)return parseInt(g)}function getRequest(h,i){return new self.Request(h.url,i)}class FetchError extends Error{constructor(i,g,_){super(i),this.code=void 0,this.details=void 0,this.code=g,this.details=_}}const WHITESPACE_CHAR=/\s/,Cues={newCue(h,i,g,_){const j=[];let $,_n,_i,_s,ga;const ba=self.VTTCue||self.TextTrackCue;for(let El=0;El<_.rows.length;El++)if($=_.rows[El],_i=!0,_s=0,ga="",!$.isEmpty()){var xa;for(let Il=0;Il<$.chars.length;Il++)WHITESPACE_CHAR.test($.chars[Il].uchar)&&_i?_s++:(ga+=$.chars[Il].uchar,_i=!1);$.cueStartTime=i,i===g&&(g+=1e-4),_s>=16?_s--:_s++;const Tl=fixLineBreaks(ga.trim()),Sl=generateCueId(i,g,Tl);h!=null&&(xa=h.cues)!=null&&xa.getCueById(Sl)||(_n=new ba(i,g,Tl),_n.id=Sl,_n.line=El+1,_n.align="left",_n.position=10+Math.min(80,Math.floor(_s*8/32)*10),j.push(_n))}return h&&j.length&&(j.sort((El,Tl)=>El.line==="auto"||Tl.line==="auto"?0:El.line>8&&Tl.line>8?Tl.line-El.line:El.line-Tl.line),j.forEach(El=>addCueToTrack(h,El))),j}},defaultLoadPolicy={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},hlsDefaultConfig=_objectSpread2(_objectSpread2({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:60*1e3*1e3,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:XhrLoader,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:AbrController,bufferController:BufferController,capLevelController:CapLevelController,errorController:ErrorController,fpsController:FPSController,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:requestMediaKeySystemAccess,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0,certLoadPolicy:{default:defaultLoadPolicy},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},timelineConfig()),{},{subtitleStreamController:SubtitleStreamController,subtitleTrackController:SubtitleTrackController,timelineController:TimelineController,audioStreamController:AudioStreamController,audioTrackController:AudioTrackController,emeController:EMEController,cmcdController:CMCDController,contentSteeringController:ContentSteeringController});function timelineConfig(){return{cueHandler:Cues,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function mergeConfig(h,i){if((i.liveSyncDurationCount||i.liveMaxLatencyDurationCount)&&(i.liveSyncDuration||i.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(i.liveMaxLatencyDurationCount!==void 0&&(i.liveSyncDurationCount===void 0||i.liveMaxLatencyDurationCount<=i.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(i.liveMaxLatencyDuration!==void 0&&(i.liveSyncDuration===void 0||i.liveMaxLatencyDuration<=i.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const g=deepCpy(h),_=["manifest","level","frag"],j=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return _.forEach($=>{const _n=`${$==="level"?"playlist":$}LoadPolicy`,_i=i[_n]===void 0,_s=[];j.forEach(ga=>{const ba=`${$}Loading${ga}`,xa=i[ba];if(xa!==void 0&&_i){_s.push(ba);const El=g[_n].default;switch(i[_n]={default:El},ga){case"TimeOut":El.maxLoadTimeMs=xa,El.maxTimeToFirstByteMs=xa;break;case"MaxRetry":El.errorRetry.maxNumRetry=xa,El.timeoutRetry.maxNumRetry=xa;break;case"RetryDelay":El.errorRetry.retryDelayMs=xa,El.timeoutRetry.retryDelayMs=xa;break;case"MaxRetryTimeout":El.errorRetry.maxRetryDelayMs=xa,El.timeoutRetry.maxRetryDelayMs=xa;break}}}),_s.length&&logger.warn(`hls.js config: "${_s.join('", "')}" setting(s) are deprecated, use "${_n}": ${JSON.stringify(i[_n])}`)}),_objectSpread2(_objectSpread2({},g),i)}function deepCpy(h){return h&&typeof h=="object"?Array.isArray(h)?h.map(deepCpy):Object.keys(h).reduce((i,g)=>(i[g]=deepCpy(h[g]),i),{}):h}function enableStreamingMode(h){const i=h.loader;i!==FetchLoader&&i!==XhrLoader?(logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),h.progressive=!1):fetchSupported()&&(h.loader=FetchLoader,h.progressive=!0,h.enableSoftwareAES=!0,logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}class Hls{static get version(){return"1.4.6"}static isSupported(){return isSupported()}static get Events(){return Events}static get ErrorTypes(){return ErrorTypes}static get ErrorDetails(){return ErrorDetails}static get DefaultConfig(){return Hls.defaultConfig?Hls.defaultConfig:hlsDefaultConfig}static set DefaultConfig(i){Hls.defaultConfig=i}constructor(i={}){this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new EventEmitter,this._autoLevelCapping=void 0,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null,enableLogs(i.debug||!1,"Hls instance");const g=this.config=mergeConfig(Hls.DefaultConfig,i);this.userConfig=i,this._autoLevelCapping=-1,g.progressive&&enableStreamingMode(g);const{abrController:_,bufferController:j,capLevelController:$,errorController:_n,fpsController:_i}=g,_s=new _n(this),ga=this.abrController=new _(this),ba=this.bufferController=new j(this),xa=this.capLevelController=new $(this),El=new _i(this),Tl=new PlaylistLoader(this),Sl=new ID3TrackController(this),Il=g.contentSteeringController,Cl=Il?new Il(this):null,Nl=this.levelController=new LevelController(this,Cl),Dl=new FragmentTracker(this),Ul=new KeyLoader(this.config),Kl=this.streamController=new StreamController(this,Dl,Ul);xa.setStreamController(Kl),El.setStreamController(Kl);const Jl=[Tl,Nl,Kl];Cl&&Jl.splice(1,0,Cl),this.networkControllers=Jl;const Ep=[ga,ba,xa,El,Sl,Dl];this.audioTrackController=this.createController(g.audioTrackController,Jl);const _p=g.audioStreamController;_p&&Jl.push(new _p(this,Dl,Ul)),this.subtitleTrackController=this.createController(g.subtitleTrackController,Jl);const Ip=g.subtitleStreamController;Ip&&Jl.push(new Ip(this,Dl,Ul)),this.createController(g.timelineController,Ep),Ul.emeController=this.emeController=this.createController(g.emeController,Ep),this.cmcdController=this.createController(g.cmcdController,Ep),this.latencyController=this.createController(LatencyController,Ep),this.coreComponents=Ep,Jl.push(_s);const Up=_s.onErrorOut;typeof Up=="function"&&this.on(Events.ERROR,Up,_s)}createController(i,g){if(i){const _=new i(this);return g&&g.push(_),_}return null}on(i,g,_=this){this._emitter.on(i,g,_)}once(i,g,_=this){this._emitter.once(i,g,_)}removeAllListeners(i){this._emitter.removeAllListeners(i)}off(i,g,_=this,j){this._emitter.off(i,g,_,j)}listeners(i){return this._emitter.listeners(i)}emit(i,g,_){return this._emitter.emit(i,g,_)}trigger(i,g){if(this.config.debug)return this.emit(i,i,g);try{return this.emit(i,i,g)}catch(_){logger.error("An internal error happened while handling event "+i+'. Error message: "'+_.message+'". Here is a stacktrace:',_),this.trigger(Events.ERROR,{type:ErrorTypes.OTHER_ERROR,details:ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:i,error:_})}return!1}listenerCount(i){return this._emitter.listenerCount(i)}destroy(){logger.log("destroy"),this.trigger(Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(g=>g.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(g=>g.destroy()),this.coreComponents.length=0;const i=this.config;i.xhrSetup=i.fetchSetup=void 0,this.userConfig=null}attachMedia(i){logger.log("attachMedia"),this._media=i,this.trigger(Events.MEDIA_ATTACHING,{media:i})}detachMedia(){logger.log("detachMedia"),this.trigger(Events.MEDIA_DETACHING,void 0),this._media=null}loadSource(i){this.stopLoad();const g=this.media,_=this.url,j=this.url=urlToolkitExports.buildAbsoluteURL(self.location.href,i,{alwaysNormalize:!0});logger.log(`loadSource:${j}`),g&&_&&(_!==j||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(g)),this.trigger(Events.MANIFEST_LOADING,{url:i})}startLoad(i=-1){logger.log(`startLoad(${i})`),this.networkControllers.forEach(g=>{g.startLoad(i)})}stopLoad(){logger.log("stopLoad"),this.networkControllers.forEach(i=>{i.stopLoad()})}swapAudioCodec(){logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){logger.log("recoverMediaError");const i=this._media;this.detachMedia(),i&&this.attachMedia(i)}removeLevel(i,g=0){this.levelController.removeLevel(i,g)}get levels(){const i=this.levelController.levels;return i||[]}get currentLevel(){return this.streamController.currentLevel}set currentLevel(i){logger.log(`set currentLevel:${i}`),this.loadLevel=i,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(i){logger.log(`set nextLevel:${i}`),this.levelController.manualLevel=i,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(i){logger.log(`set loadLevel:${i}`),this.levelController.manualLevel=i}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(i){this.levelController.nextLoadLevel=i}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(i){logger.log(`set firstLevel:${i}`),this.levelController.firstLevel=i}get startLevel(){return this.levelController.startLevel}set startLevel(i){logger.log(`set startLevel:${i}`),i!==-1&&(i=Math.max(i,this.minAutoLevel)),this.levelController.startLevel=i}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(i){const g=!!i;g!==this.config.capLevelToPlayerSize&&(g?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=g)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:i}=this.abrController;return i?i.getEstimate():NaN}get ttfbEstimate(){const{bwEstimator:i}=this.abrController;return i?i.getEstimateTTFB():NaN}set autoLevelCapping(i){this._autoLevelCapping!==i&&(logger.log(`set autoLevelCapping:${i}`),this._autoLevelCapping=i)}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(i){HdcpLevels.indexOf(i)>-1&&(this._maxHdcpLevel=i)}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:i,config:{minAutoBitrate:g}}=this;if(!i)return 0;const _=i.length;for(let j=0;j<_;j++)if(i[j].maxBitrate>=g)return j;return 0}get maxAutoLevel(){const{levels:i,autoLevelCapping:g,maxHdcpLevel:_}=this;let j;if(g===-1&&i&&i.length?j=i.length-1:j=g,_)for(let $=j;$--;){const _n=i[$].attrs["HDCP-LEVEL"];if(_n&&_n<=_)return $}return j}get nextAutoLevel(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)}set nextAutoLevel(i){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,i)}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get audioTracks(){const i=this.audioTrackController;return i?i.audioTracks:[]}get audioTrack(){const i=this.audioTrackController;return i?i.audioTrack:-1}set audioTrack(i){const g=this.audioTrackController;g&&(g.audioTrack=i)}get subtitleTracks(){const i=this.subtitleTrackController;return i?i.subtitleTracks:[]}get subtitleTrack(){const i=this.subtitleTrackController;return i?i.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(i){const g=this.subtitleTrackController;g&&(g.subtitleTrack=i)}get subtitleDisplay(){const i=this.subtitleTrackController;return i?i.subtitleDisplay:!1}set subtitleDisplay(i){const g=this.subtitleTrackController;g&&(g.subtitleDisplay=i)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(i){this.config.lowLatencyMode=i}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}}Hls.defaultConfig=void 0;const w3="",Header=()=>jsx("header",{className:"w3-container w3-header w3-dark-grey w3-margin-bottom",children:jsxs("div",{className:"w3-bar",children:[jsx("button",{className:"w3-bar-item w3-button w3-left",children:"Main Menu"}),jsxs("div",{className:"w3-right",children:[jsx("button",{className:"w3-bar-item w3-button",children:"Courses"}),jsx("button",{className:"w3-bar-item w3-button",children:"Live Lectures"}),jsx("button",{className:"w3-bar-item w3-button",children:"Profile"})]})]})}),Player=()=>{const h=reactExports.useRef(null),{videoName:i}=useParams(),g=`https://edu-recordings.s3.amazonaws.com/${i}.m3u8`;return reactExports.useEffect(()=>{let _=null;const j=h.current;return j&&(Hls.isSupported()?(_=new Hls,_.loadSource(g),_.attachMedia(j)):j.canPlayType("application/vnd.apple.mpegurl")&&(j.src=g)),()=>{_&&_.destroy()}},[g]),jsxs("div",{className:"w3-container",children:[jsx(Header,{}),jsx("video",{className:"w3-border",controls:!0,ref:h,children:"Your browser does not support HTML5 video."})]})};var AgoraRTC_NProductionExports={},AgoraRTC_NProduction={get exports(){return AgoraRTC_NProductionExports},set exports(h){AgoraRTC_NProductionExports=h}};(function(h,i){(function(g,_){h.exports=_()})(commonjsGlobal,function(){function g(_e,_t){return _t.forEach(function(_r){_r&&typeof _r!="string"&&!Array.isArray(_r)&&Object.keys(_r).forEach(function(_o){if(_o!=="default"&&!(_o in _e)){var _a=Object.getOwnPropertyDescriptor(_r,_o);Object.defineProperty(_e,_o,_a.get?_a:{enumerable:!0,get:function(){return _r[_o]}})}})}),Object.freeze(_e)}var _=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof commonjsGlobal<"u"?commonjsGlobal:typeof self<"u"?self:{},j=function(_e){try{return!!_e()}catch{return!0}},$=!j(function(){var _e=function(){}.bind();return typeof _e!="function"||_e.hasOwnProperty("prototype")}),_n=$,_i=Function.prototype,_s=_i.bind,ga=_i.call,ba=_n&&_s.bind(ga,ga),xa=_n?function(_e){return _e&&ba(_e)}:function(_e){return _e&&function(){return ga.apply(_e,arguments)}},El=xa({}.isPrototypeOf),Tl=function(_e){return _e&&_e.Math==Math&&_e},Sl=Tl(typeof globalThis=="object"&&globalThis)||Tl(typeof window=="object"&&window)||Tl(typeof self=="object"&&self)||Tl(typeof _=="object"&&_)||function(){return this}()||Function("return this")(),Il=$,Cl=Function.prototype,Nl=Cl.apply,Dl=Cl.call,Ul=typeof Reflect=="object"&&Reflect.apply||(Il?Dl.bind(Nl):function(){return Dl.apply(Nl,arguments)}),Kl=function(_e){return typeof _e=="function"},Jl={},Ep=!j(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),_p=$,Ip=Function.prototype.call,Up=_p?Ip.bind(Ip):function(){return Ip.apply(Ip,arguments)},yp={},Ap={}.propertyIsEnumerable,Cp=Object.getOwnPropertyDescriptor,Mp=Cp&&!Ap.call({1:2},1);yp.f=Mp?function(_e){var _t=Cp(this,_e);return!!_t&&_t.enumerable}:Ap;var wp,Np,Fp=function(_e,_t){return{enumerable:!(1&_e),configurable:!(2&_e),writable:!(4&_e),value:_t}},Hp=xa,xp=Hp({}.toString),Gp=Hp("".slice),$p=function(_e){return Gp(xp(_e),8,-1)},c0=xa,n0=j,C0=$p,Op=Sl.Object,Q0=c0("".split),dy=n0(function(){return!Op("z").propertyIsEnumerable(0)})?function(_e){return C0(_e)=="String"?Q0(_e,""):Op(_e)}:Op,Yy=Sl.TypeError,J_=function(_e){if(_e==null)throw Yy("Can't call method on "+_e);return _e},R0=dy,ry=J_,q0=function(_e){return R0(ry(_e))},d0=Kl,Cy=function(_e){return typeof _e=="object"?_e!==null:d0(_e)},vy={},A_=vy,I_=Sl,IT=Kl,HS=function(_e){return IT(_e)?_e:void 0},NT=function(_e,_t){return arguments.length<2?HS(A_[_e])||HS(I_[_e]):A_[_e]&&A_[_e][_t]||I_[_e]&&I_[_e][_t]},KS=NT("navigator","userAgent")||"",S0=Sl,$0=KS,ey=S0.process,w_=S0.Deno,Ay=ey&&ey.versions||w_&&w_.version,Jy=Ay&&Ay.v8;Jy&&(Np=(wp=Jy.split("."))[0]>0&&wp[0]<4?1:+(wp[0]+wp[1])),!Np&&$0&&(!(wp=$0.match(/Edge\/(\d+)/))||wp[1]>=74)&&(wp=$0.match(/Chrome\/(\d+)/))&&(Np=+wp[1]);var Iy=Np,qS=Iy,SN=j,I1=!!Object.getOwnPropertySymbols&&!SN(function(){var _e=Symbol();return!String(_e)||!(Object(_e)instanceof Symbol)||!Symbol.sham&&qS&&qS<41}),P2=I1&&!Symbol.sham&&typeof Symbol.iterator=="symbol",N2=NT,wU=Kl,OU=El,CU=P2,xU=Sl.Object,RN=CU?function(_e){return typeof _e=="symbol"}:function(_e){var _t=N2("Symbol");return wU(_t)&&OU(_t.prototype,xU(_e))},kU=Sl.String,fR=function(_e){try{return kU(_e)}catch{return"Object"}},PU=Kl,NU=fR,LU=Sl.TypeError,JT=function(_e){if(PU(_e))return _e;throw LU(NU(_e)+" is not a function")},DU=JT,zS=function(_e,_t){var _r=_e[_t];return _r==null?void 0:DU(_r)},AN=Up,IN=Kl,wN=Cy,Qy=Sl.TypeError,My={exports:{}},L2=Sl,MU=Object.defineProperty,UU=function(_e,_t){try{MU(L2,_e,{value:_t,configurable:!0,writable:!0})}catch{L2[_e]=_t}return _t},ON="__core-js_shared__",CN=Sl[ON]||UU(ON,{}),L_=CN;(My.exports=function(_e,_t){return L_[_e]||(L_[_e]=_t!==void 0?_t:{})})("versions",[]).push({version:"3.20.3",mode:"pure",copyright:"© 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.20.3/LICENSE",source:"https://github.com/zloirock/core-js"});var xN=J_,pR=Sl.Object,kS=function(_e){return pR(xN(_e))},kN=kS,LT=xa({}.hasOwnProperty),Q_=Object.hasOwn||function(_e,_t){return LT(kN(_e),_t)},D2=xa,M2=0,U2=Math.random(),j2=D2(1 .toString),gO=function(_e){return"Symbol("+(_e===void 0?"":_e)+")_"+j2(++M2+U2,36)},jU=Sl,FU=My.exports,F2=Q_,BU=gO,gR=I1,Xp=P2,a0=FU("wks"),zl=jU.Symbol,M0=zl&&zl.for,V0=Xp?zl:zl&&zl.withoutSetter||BU,T0=function(_e){if(!F2(a0,_e)||!gR&&typeof a0[_e]!="string"){var _t="Symbol."+_e;gR&&F2(zl,_e)?a0[_e]=zl[_e]:a0[_e]=Xp&&M0?M0(_t):V0(_t)}return a0[_e]},T_=Up,DT=Cy,yS=RN,mR=zS,QT=function(_e,_t){var _r,_o;if(_t==="string"&&IN(_r=_e.toString)&&!wN(_o=AN(_r,_e))||IN(_r=_e.valueOf)&&!wN(_o=AN(_r,_e))||_t!=="string"&&IN(_r=_e.toString)&&!wN(_o=AN(_r,_e)))return _o;throw Qy("Can't convert object to primitive value")},B2=T0,$2=Sl.TypeError,$U=B2("toPrimitive"),VU=function(_e,_t){if(!DT(_e)||yS(_e))return _e;var _r,_o=mR(_e,$U);if(_o){if(_t===void 0&&(_t="default"),_r=T_(_o,_e,_t),!DT(_r)||yS(_r))return _r;throw $2("Can't convert object to primitive value")}return _t===void 0&&(_t="number"),QT(_e,_t)},PN=RN,YS=function(_e){var _t=VU(_e,"string");return PN(_t)?_t:_t+""},w1=Cy,NN=Sl.document,V2=w1(NN)&&w1(NN.createElement),ZT=function(_e){return V2?NN.createElement(_e):{}},LN=ZT,XS=!Ep&&!j(function(){return Object.defineProperty(LN("div"),"a",{get:function(){return 7}}).a!=7}),MT=Ep,G2=Up,W2=yp,O1=Fp,GU=q0,mO=YS,H2=Q_,K_=XS,eS=Object.getOwnPropertyDescriptor;Jl.f=MT?eS:function(_e,_t){if(_e=GU(_e),_t=mO(_t),K_)try{return eS(_e,_t)}catch{}if(H2(_e,_t))return O1(!G2(W2.f,_e,_t),_e[_t])};var DN=j,yO=Kl,PS=/#|\.prototype\./,FR=function(_e,_t){var _r=MN[oT(_e)];return _r==HU||_r!=WU&&(yO(_t)?DN(_t):!!_t)},oT=FR.normalize=function(_e){return String(_e).replace(PS,".").toLowerCase()},MN=FR.data={},WU=FR.NATIVE="N",HU=FR.POLYFILL="P",vO=FR,C1=JT,K2=$,JS=xa(xa.bind),yR=function(_e,_t){return C1(_e),_t===void 0?_e:K2?JS(_e,_t):function(){return _e.apply(_t,arguments)}},UT={},UN=Ep&&j(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),EO=Sl,jN=Cy,q2=EO.String,z2=EO.TypeError,jT=function(_e){if(jN(_e))return _e;throw z2(q2(_e)+" is not an object")},_O=Ep,Y2=XS,X2=UN,x1=jT,bO=YS,J2=Sl.TypeError,k1=Object.defineProperty,FN=Object.getOwnPropertyDescriptor,hy="enumerable",KU="configurable",qU="writable";UT.f=_O?X2?function(_e,_t,_r){if(x1(_e),_t=bO(_t),x1(_r),typeof _e=="function"&&_t==="prototype"&&"value"in _r&&qU in _r&&!_r.writable){var _o=FN(_e,_t);_o&&_o.writable&&(_e[_t]=_r.value,_r={configurable:KU in _r?_r.configurable:_o.configurable,enumerable:hy in _r?_r.enumerable:_o.enumerable,writable:!1})}return k1(_e,_t,_r)}:k1:function(_e,_t,_r){if(x1(_e),_t=bO(_t),x1(_r),Y2)try{return k1(_e,_t,_r)}catch{}if("get"in _r||"set"in _r)throw J2("Accessors not supported");return"value"in _r&&(_e[_t]=_r.value),_e};var BR=UT,zU=Fp,O_=Ep?function(_e,_t,_r){return BR.f(_e,_t,zU(1,_r))}:function(_e,_t,_r){return _e[_t]=_r,_e},AO=Sl,IO=Ul,BN=xa,Q2=Kl,Z2=Jl.f,wT=vO,OT=vy,$N=yR,NS=O_,VN=Q_,GN=function(_e){var _t=function(_r,_o,_a){if(this instanceof _t){switch(arguments.length){case 0:return new _e;case 1:return new _e(_r);case 2:return new _e(_r,_o)}return new _e(_r,_o,_a)}return IO(_e,this,arguments)};return _t.prototype=_e.prototype,_t},D_=function(_e,_t){var _r,_o,_a,_u,yl,Rl,Al,Ol,xl=_e.target,Ll=_e.global,Bl=_e.stat,Hl=_e.proto,up=Ll?AO:Bl?AO[xl]:(AO[xl]||{}).prototype,_f=Ll?OT:OT[xl]||NS(OT,xl,{})[xl],vp=_f.prototype;for(_a in _t)_r=!wT(Ll?_a:xl+(Bl?".":"#")+_a,_e.forced)&&up&&VN(up,_a),yl=_f[_a],_r&&(Rl=_e.noTargetGet?(Ol=Z2(up,_a))&&Ol.value:up[_a]),_u=_r&&Rl?Rl:_t[_a],_r&&typeof yl==typeof _u||(Al=_e.bind&&_r?$N(_u,AO):_e.wrap&&_r?GN(_u):Hl&&Q2(_u)?BN(_u):_u,(_e.sham||_u&&_u.sham||yl&&yl.sham)&&NS(Al,"sham",!0),NS(_f,_a,Al),Hl&&(VN(OT,_o=xl+"Prototype")||NS(OT,_o,{}),NS(OT[_o],_a,_u),_e.real&&vp&&!vp[_a]&&NS(vp,_a,_u)))},WN=Math.ceil,HN=Math.floor,vS=function(_e){var _t=+_e;return _t!=_t||_t===0?0:(_t>0?HN:WN)(_t)},QS=vS,eM=Math.min,KN=function(_e){return _e>0?eM(QS(_e),9007199254740991):0},LS=function(_e){return KN(_e.length)},tM=JT,nM=kS,rM=dy,pT=LS,ES=Sl.TypeError,P1=function(_e){return function(_t,_r,_o,_a){tM(_r);var _u=nM(_t),yl=rM(_u),Rl=pT(_u),Al=_e?Rl-1:0,Ol=_e?-1:1;if(_o<2)for(;;){if(Al in yl){_a=yl[Al],Al+=Ol;break}if(Al+=Ol,_e?Al<0:Rl<=Al)throw ES("Reduce of empty array with no initial value")}for(;_e?Al>=0:Rl>Al;Al+=Ol)Al in yl&&(_a=_r(_a,yl[Al],Al,_u));return _a}},$R={left:P1(!1),right:P1(!0)},iM=j,wO=function(_e,_t){var _r=[][_e];return!!_r&&iM(function(){_r.call(null,_t||function(){throw 1},1)})},N1=$p(Sl.process)=="process",VR=$R.left,GR=Iy,oM=N1;D_({target:"Array",proto:!0,forced:!wO("reduce")||!oM&&GR>79&&GR<83},{reduce:function(_e){var _t=arguments.length;return VR(this,_e,_t,_t>1?arguments[1]:void 0)}});var sM=vy,tS=function(_e){return sM[_e+"Prototype"]},aM=tS("Array").reduce,CO=El,qN=aM,WR=Array.prototype,zN=function(_e){var _t=_e.reduce;return _e===WR||CO(WR,_e)&&_t===WR.reduce?qN:_t},nS=zN;let YN=!0,xO=!0;function L1(_e,_t,_r){const _o=_e.match(_t);return _o&&_o.length>=_r&&parseInt(_o[_r],10)}function sT(_e,_t,_r){if(!_e.RTCPeerConnection)return;const _o=_e.RTCPeerConnection.prototype,_a=_o.addEventListener;_o.addEventListener=function(yl,Rl){if(yl!==_t)return _a.apply(this,arguments);const Al=Ol=>{const xl=_r(Ol);xl&&(Rl.handleEvent?Rl.handleEvent(xl):Rl(xl))};return this._eventMap=this._eventMap||{},this._eventMap[_t]||(this._eventMap[_t]=new Map),this._eventMap[_t].set(Rl,Al),_a.apply(this,[yl,Al])};const _u=_o.removeEventListener;_o.removeEventListener=function(yl,Rl){if(yl!==_t||!this._eventMap||!this._eventMap[_t])return _u.apply(this,arguments);if(!this._eventMap[_t].has(Rl))return _u.apply(this,arguments);const Al=this._eventMap[_t].get(Rl);return this._eventMap[_t].delete(Rl),this._eventMap[_t].size===0&&delete this._eventMap[_t],Object.keys(this._eventMap).length===0&&delete this._eventMap,_u.apply(this,[yl,Al])},Object.defineProperty(_o,"on"+_t,{get(){return this["_on"+_t]},set(yl){this["_on"+_t]&&(this.removeEventListener(_t,this["_on"+_t]),delete this["_on"+_t]),yl&&this.addEventListener(_t,this["_on"+_t]=yl)},enumerable:!0,configurable:!0})}function cM(_e){return typeof _e!="boolean"?new Error("Argument type: "+typeof _e+". Please use a boolean."):(YN=_e,_e?"adapter.js logging disabled":"adapter.js logging enabled")}function uM(_e){return typeof _e!="boolean"?new Error("Argument type: "+typeof _e+". Please use a boolean."):(xO=!_e,"adapter.js deprecation warnings "+(_e?"disabled":"enabled"))}function lM(){if(typeof window=="object"){if(YN)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function kO(_e,_t){xO&&console.warn(_e+" is deprecated, please use "+_t+" instead.")}function DS(_e){const _t={browser:null,version:null};if(_e===void 0||!_e.navigator)return _t.browser="Not a browser.",_t;const{navigator:_r}=_e;if(_r.mozGetUserMedia)_t.browser="firefox",_t.version=L1(_r.userAgent,/Firefox\/(\d+)\./,1);else if(_r.webkitGetUserMedia||_e.isSecureContext===!1&&_e.webkitRTCPeerConnection)_t.browser="chrome",_t.version=L1(_r.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!_e.RTCPeerConnection||!_r.userAgent.match(/AppleWebKit\/(\d+)\./))return _t.browser="Not a supported browser.",_t;_t.browser="safari",_t.version=L1(_r.userAgent,/AppleWebKit\/(\d+)\./,1),_t.supportsUnifiedPlan=_e.RTCRtpTransceiver&&"currentDirection"in _e.RTCRtpTransceiver.prototype}return _t}function DO(_e){return Object.prototype.toString.call(_e)==="[object Object]"}function jO(_e){var _t;return DO(_e)?nS(_t=Object.keys(_e)).call(_t,function(_r,_o){const _a=DO(_e[_o]),_u=_a?jO(_e[_o]):_e[_o],yl=_a&&!Object.keys(_u).length;return _u===void 0||yl?_r:Object.assign(_r,{[_o]:_u})},{}):_e}function D1(_e,_t,_r){const _o=_r?"outbound-rtp":"inbound-rtp",_a=new Map;if(_t===null)return _a;const _u=[];return _e.forEach(yl=>{yl.type==="track"&&yl.trackIdentifier===_t.id&&_u.push(yl)}),_u.forEach(yl=>{_e.forEach(Rl=>{Rl.type===_o&&Rl.trackId===yl.id&&function Al(Ol,xl,Ll){xl&&!Ll.has(xl.id)&&(Ll.set(xl.id,xl),Object.keys(xl).forEach(Bl=>{Bl.endsWith("Id")?Al(Ol,Ol.get(xl[Bl]),Ll):Bl.endsWith("Ids")&&xl[Bl].forEach(Hl=>{Al(Ol,Ol.get(Hl),Ll)})}))}(_e,Rl,_a)})}),_a}var HR=My.exports,F0=gO,M1=HR("keys"),KR=function(_e){return M1[_e]||(M1[_e]=F0(_e))},vR=!j(function(){function _e(){}return _e.prototype.constructor=null,Object.getPrototypeOf(new _e)!==_e.prototype}),dM=Sl,hM=Q_,YU=Kl,MS=kS,aT=vR,FO=KR("IE_PROTO"),U1=dM.Object,j1=U1.prototype,BO=aT?U1.getPrototypeOf:function(_e){var _t=MS(_e);if(hM(_t,FO))return _t[FO];var _r=_t.constructor;return YU(_r)&&_t instanceof _r?_r.prototype:_t instanceof U1?j1:null},XN=Sl,JN=Kl,fM=XN.String,pM=XN.TypeError,GO=xa,_S=jT,ER=function(_e){if(typeof _e=="object"||JN(_e))return _e;throw pM("Can't set "+fM(_e)+" as a prototype")},XU=Object.setPrototypeOf||("__proto__"in{}?function(){var _e,_t=!1,_r={};try{(_e=GO(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(_r,[]),_t=_r instanceof Array}catch{}return function(_o,_a){return _S(_o),ER(_a),_t?_e(_o,_a):_o.__proto__=_a,_o}}():void 0),F1={},gM=vS,mM=Math.max,yM=Math.min,HO=function(_e,_t){var _r=gM(_e);return _r<0?mM(_r+_t,0):yM(_r,_t)},FT=q0,vM=HO,QN=LS,qO=function(_e){return function(_t,_r,_o){var _a,_u=FT(_t),yl=QN(_u),Rl=vM(_o,yl);if(_e&&_r!=_r){for(;yl>Rl;)if((_a=_u[Rl++])!=_a)return!0}else for(;yl>Rl;Rl++)if((_e||Rl in _u)&&_u[Rl]===_r)return _e||Rl||0;return!_e&&-1}},EM={includes:qO(!0),indexOf:qO(!1)},B1={},qR=Q_,_M=q0,bM=EM.indexOf,zO=B1,ZN=xa([].push),EL=function(_e,_t){var _r,_o=_M(_e),_a=0,_u=[];for(_r in _o)!qR(zO,_r)&&qR(_o,_r)&&ZN(_u,_r);for(;_t.length>_a;)qR(_o,_r=_t[_a++])&&(~bM(_u,_r)||ZN(_u,_r));return _u},JO=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],_C=EL,_x=JO.concat("length","prototype");F1.f=Object.getOwnPropertyNames||function(_e){return _C(_e,_x)};var CT={};CT.f=Object.getOwnPropertySymbols;var gT=NT,E_=F1,_L=CT,US=jT,TM=xa([].concat),Tx=gT("Reflect","ownKeys")||function(_e){var _t=E_.f(US(_e)),_r=_L.f;return _r?TM(_t,_r(_e)):_t},Zy=Q_,g_=Tx,SM=Jl,$1=UT,zR={},xT=EL,RM=JO,rS=Object.keys||function(_e){return xT(_e,RM)},sy=Ep,AM=UN,BT=UT,IM=jT,Ly=q0,TL=rS;zR.f=sy&&!AM?Object.defineProperties:function(_e,_t){IM(_e);for(var _r,_o=Ly(_t),_a=TL(_t),_u=_a.length,yl=0;_u>yl;)BT.f(_e,_r=_a[yl++],_o[_r]);return _e};var YR,C_=NT("document","documentElement"),mT=jT,wM=zR,_R=JO,OM=B1,CM=C_,xM=ZT,Sx=KR("IE_PROTO"),Z_=function(){},Rx=function(_e){return"<script>"+_e+"<\/script>"},Ox=function(_e){_e.write(Rx("")),_e.close();var _t=_e.parentWindow.Object;return _e=null,_t},XR=function(){try{YR=new ActiveXObject("htmlfile")}catch{}var _e,_t;XR=typeof document<"u"?document.domain&&YR?Ox(YR):((_t=xM("iframe")).style.display="none",CM.appendChild(_t),_t.src="javascript:",(_e=_t.contentWindow.document).open(),_e.write(Rx("document.F=Object")),_e.close(),_e.F):Ox(YR);for(var _r=_R.length;_r--;)delete XR.prototype[_R[_r]];return XR()};OM[Sx]=!0;var V1=Object.create||function(_e,_t){var _r;return _e!==null?(Z_.prototype=mT(_e),_r=new Z_,Z_.prototype=null,_r[Sx]=_e):_r=XR(),_t===void 0?_r:wM.f(_r,_t)},SL=xa("".replace),RL=String(Error("zxcasd").stack),IL=/\n\s*at [^:]*:[^\n]*/,x_=IL.test(RL),Px=Cy,OL=O_,bR={},JR=bR,_v=T0("iterator"),CL=Array.prototype,kM={};kM[T0("toStringTag")]="z";var yT=String(kM)==="[object z]",Nx=Sl,QR=yT,Lx=Kl,TR=$p,Uy=T0("toStringTag"),JU=Nx.Object,PM=TR(function(){return arguments}())=="Arguments",iS=QR?TR:function(_e){var _t,_r,_o;return _e===void 0?"Undefined":_e===null?"Null":typeof(_r=function(_a,_u){try{return _a[_u]}catch{}}(_t=JU(_e),Uy))=="string"?_r:PM?TR(_t):(_o=TR(_t))=="Object"&&Lx(_t.callee)?"Arguments":_o},QU=iS,NM=zS,ZU=bR,Mx=T0("iterator"),jS=function(_e){if(_e!=null)return NM(_e,Mx)||NM(_e,"@@iterator")||ZU[QU(_e)]},Ux=Up,LM=JT,$x=jT,DM=fR,MM=jS,Vx=Sl.TypeError,UM=Up,ZR=jT,SR=zS,Wx=yR,e3=Up,t3=jT,n3=fR,Yx=function(_e){return _e!==void 0&&(JR.Array===_e||CL[_v]===_e)},Xx=LS,Qx=El,r3=function(_e,_t){var _r=arguments.length<2?MM(_e):_t;if(LM(_r))return $x(Ux(_r,_e));throw Vx(DM(_e)+" is not iterable")},jM=jS,FM=function(_e,_t,_r){var _o,_a;ZR(_e);try{if(!(_o=SR(_e,"return"))){if(_t==="throw")throw _r;return _r}_o=UM(_o,_e)}catch(_u){_a=!0,_o=_u}if(_t==="throw")throw _r;if(_a)throw _o;return ZR(_o),_r},i3=Sl.TypeError,m_=function(_e,_t){this.stopped=_e,this.result=_t},q_=m_.prototype,Zx=function(_e,_t,_r){var _o,_a,_u,yl,Rl,Al,Ol,xl=_r&&_r.that,Ll=!(!_r||!_r.AS_ENTRIES),Bl=!(!_r||!_r.IS_ITERATOR),Hl=!(!_r||!_r.INTERRUPTED),up=Wx(_t,xl),_f=function(Dp){return _o&&FM(_o,"normal",Dp),new m_(!0,Dp)},vp=function(Dp){return Ll?(t3(Dp),Hl?up(Dp[0],Dp[1],_f):up(Dp[0],Dp[1])):Hl?up(Dp,_f):up(Dp)};if(Bl)_o=_e;else{if(!(_a=jM(_e)))throw i3(n3(_e)+" is not iterable");if(Yx(_a)){for(_u=0,yl=Xx(_e);yl>_u;_u++)if((Rl=vp(_e[_u]))&&Qx(q_,Rl))return Rl;return new m_(!1)}_o=r3(_e,_a)}for(Al=_o.next;!(Ol=e3(Al,_o)).done;){try{Rl=vp(Ol.value)}catch(Dp){FM(_o,"throw",Dp)}if(typeof Rl=="object"&&Rl&&Qx(q_,Rl))return Rl}return new m_(!1)},o3=iS,BM=Sl.String,_A=function(_e){if(o3(_e)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return BM(_e)},PL=_A,G1=Fp,NL=!j(function(){var _e=Error("a");return!("stack"in _e)||(Object.defineProperty(_e,"stack",G1(1,7)),_e.stack!==7)}),_I=D_,W1=Sl,H1=El,_k=BO,FS=XU,s3=function(_e,_t,_r){for(var _o=g_(_t),_a=$1.f,_u=SM.f,yl=0;yl<_o.length;yl++){var Rl=_o[yl];Zy(_e,Rl)||_r&&Zy(_r,Rl)||_a(_e,Rl,_u(_t,Rl))}},$M=V1,_P=O_,LL=Fp,a3=function(_e,_t){if(x_&&typeof _e=="string")for(;_t--;)_e=SL(_e,IL,"");return _e},TP=function(_e,_t){Px(_t)&&"cause"in _t&&OL(_e,"cause",_t.cause)},K1=Zx,VM=function(_e,_t){return _e===void 0?arguments.length<2?"":_t:PL(_e)},_w=NL,ZS=T0("toStringTag"),q1=W1.Error,DL=[].push,e1=function(_e,_t){var _r,_o=arguments.length>2?arguments[2]:void 0,_a=H1(SP,this);FS?_r=FS(new q1,_a?_k(this):SP):(_r=_a?this:$M(SP),_P(_r,ZS,"Error")),_t!==void 0&&_P(_r,"message",VM(_t)),_w&&_P(_r,"stack",a3(_r.stack,1)),TP(_r,_o);var _u=[];return K1(_e,DL,{that:_u}),_P(_r,"errors",_u),_r};FS?FS(e1,q1):s3(e1,q1,{name:!0});var SP=e1.prototype=$M(q1.prototype,{constructor:LL(1,e1),message:LL(1,""),name:LL(1,"AggregateError")});_I({global:!0},{AggregateError:e1});var c3=Kl,RP=CN,u3=xa(Function.toString);c3(RP.inspectSource)||(RP.inspectSource=function(_e){return u3(_e)});var n1,RR,z1,M_=RP.inspectSource,l3=Kl,GM=M_,r1=Sl.WeakMap,ML=l3(r1)&&/native code/.test(GM(r1)),UL=Sl,FL=xa,d3=Cy,h3=O_,BL=Q_,$L=CN,f3=KR,p3=B1,WM="Object already initialized",VL=UL.TypeError,g3=UL.WeakMap;if(ML||$L.state){var AR=$L.state||($L.state=new g3),m3=FL(AR.get),HM=FL(AR.has),y3=FL(AR.set);n1=function(_e,_t){if(HM(AR,_e))throw new VL(WM);return _t.facade=_e,y3(AR,_e,_t),_t},RR=function(_e){return m3(AR,_e)||{}},z1=function(_e){return HM(AR,_e)}}else{var i1=f3("state");p3[i1]=!0,n1=function(_e,_t){if(BL(_e,i1))throw new VL(WM);return _t.facade=_e,h3(_e,i1,_t),_t},RR=function(_e){return BL(_e,i1)?_e[i1]:{}},z1=function(_e){return BL(_e,i1)}}var IR,KM,qM,OP={set:n1,get:RR,has:z1,enforce:function(_e){return z1(_e)?RR(_e):n1(_e,{})},getterFor:function(_e){return function(_t){var _r;if(!d3(_t)||(_r=RR(_t)).type!==_e)throw VL("Incompatible receiver, "+_e+" required");return _r}}},GL=Ep,v3=Q_,zM=Function.prototype,E3=GL&&Object.getOwnPropertyDescriptor,WL=v3(zM,"name"),YM={EXISTS:WL,PROPER:WL&&function(){}.name==="something",CONFIGURABLE:WL&&(!GL||GL&&E3(zM,"name").configurable)},_3=O_,wR=function(_e,_t,_r,_o){_o&&_o.enumerable?_e[_t]=_r:_3(_e,_t,_r)},HL=j,XM=Kl,T3=V1,JM=BO,S3=wR,Y1=T0("iterator"),KL=!1;[].keys&&("next"in(qM=[].keys())?(KM=JM(JM(qM)))!==Object.prototype&&(IR=KM):KL=!0);var R3=IR==null||HL(function(){var _e={};return IR[Y1].call(_e)!==_e});XM((IR=R3?{}:T3(IR))[Y1])||S3(IR,Y1,function(){return this});var QM={IteratorPrototype:IR,BUGGY_SAFARI_ITERATORS:KL},A3=iS,OR=yT?{}.toString:function(){return"[object "+A3(this)+"]"},iy=yT,I3=UT.f,eR=O_,O3=Q_,ZM=OR,PP=T0("toStringTag"),o1=function(_e,_t,_r,_o){if(_e){var _a=_r?_e:_e.prototype;O3(_a,PP)||I3(_a,PP,{configurable:!0,value:_t}),_o&&!iy&&eR(_a,"toString",ZM)}},s1=QM.IteratorPrototype,C3=V1,x3=Fp,k3=o1,t5=bR,NP=function(){return this},P3=D_,N3=Up,L3=function(_e,_t,_r,_o){var _a=_t+" Iterator";return _e.prototype=C3(s1,{next:x3(+!_o,_r)}),k3(_e,_a,!1,!0),t5[_a]=NP,_e},D3=BO,M3=o1,n5=wR,r5=bR,U3=YM.PROPER,X1=QM.BUGGY_SAFARI_ITERATORS,YL=T0("iterator"),i5="keys",J1="values",XL="entries",j3=function(){return this},o5=function(_e,_t,_r,_o,_a,_u,yl){L3(_r,_t,_o);var Rl,Al,Ol,xl=function(Dp){if(Dp===_a&&_f)return _f;if(!X1&&Dp in Hl)return Hl[Dp];switch(Dp){case i5:case J1:case XL:return function(){return new _r(this,Dp)}}return function(){return new _r(this)}},Ll=_t+" Iterator",Bl=!1,Hl=_e.prototype,up=Hl[YL]||Hl["@@iterator"]||_a&&Hl[_a],_f=!X1&&up||xl(_a),vp=_t=="Array"&&Hl.entries||up;if(vp&&(Rl=D3(vp.call(new _e)))!==Object.prototype&&Rl.next&&(M3(Rl,Ll,!0,!0),r5[Ll]=j3),U3&&_a==J1&&up&&up.name!==J1&&(Bl=!0,_f=function(){return N3(up,this)}),_a)if(Al={values:xl(J1),keys:_u?_f:xl(i5),entries:xl(XL)},yl)for(Ol in Al)(X1||Bl||!(Ol in Hl))&&n5(Hl,Ol,Al[Ol]);else P3({target:_t,proto:!0,forced:X1||Bl},Al);return yl&&Hl[YL]!==_f&&n5(Hl,YL,_f,{name:_a}),r5[_t]=_f,Al},F3=q0,s5=bR,a5=OP;UT.f;var B3=o5,c5="Array Iterator",JL=a5.set,u5=a5.getterFor(c5);B3(Array,"Array",function(_e,_t){JL(this,{type:c5,target:F3(_e),index:0,kind:_t})},function(){var _e=u5(this),_t=_e.target,_r=_e.kind,_o=_e.index++;return!_t||_o>=_t.length?(_e.target=void 0,{value:void 0,done:!0}):_r=="keys"?{value:_o,done:!1}:_r=="values"?{value:_t[_o],done:!1}:{value:[_o,_t[_o]],done:!1}},"values"),s5.Arguments=s5.Array;var l5=Sl.Promise,$3=wR,V3=NT,G3=UT,W3=Ep,d5=T0("species"),H3=El,K3=Sl.TypeError,h5=T0("iterator"),f5=!1;try{var q3=0,p5={next:function(){return{done:!!q3++}},return:function(){f5=!0}};p5[h5]=function(){return this},Array.from(p5,function(){throw 2})}catch{}var z3=xa,Y3=j,g5=Kl,X3=iS,J3=M_,_c=function(){},_l=[],Pl=NT("Reflect","construct"),Gl=/^\s*(?:class|function)\b/,_d=z3(Gl.exec),Sp=!Gl.exec(_c),Lp=function(_e){if(!g5(_e))return!1;try{return Pl(_c,_l,_e),!0}catch{return!1}},Wp=function(_e){if(!g5(_e))return!1;switch(X3(_e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return Sp||!!_d(Gl,J3(_e))}catch{return!0}};Wp.sham=!0;var Kp,Qp,i0,v0,A0=!Pl||Y3(function(){var _e;return Lp(Lp.call)||!Lp(Object)||!Lp(function(){_e=!0})||_e})?Wp:Lp,f0=A0,L0=fR,G0=Sl.TypeError,ay=jT,a_=function(_e){if(f0(_e))return _e;throw G0(L0(_e)+" is not a constructor")},j0=T0("species"),xy=function(_e,_t){var _r,_o=ay(_e).constructor;return _o===void 0||(_r=ay(_o)[j0])==null?_t:a_(_r)},_E=xa([].slice),S_=/(?:ipad|iphone|ipod).*applewebkit/i.test(KS),e_=Sl,LP=Ul,a1=yR,m5=Kl,fX=Q_,pX=j,x$=C_,gX=_E,k$=ZT,mX=S_,yX=N1,Q3=e_.setImmediate,Z3=e_.clearImmediate,vX=e_.process,_j=e_.Dispatch,EX=e_.Function,P$=e_.MessageChannel,_X=e_.String,$j=0,QL={},bX="onreadystatechange";try{Kp=e_.location}catch{}var _F=function(_e){if(fX(QL,_e)){var _t=QL[_e];delete QL[_e],_t()}},e6=function(_e){return function(){_F(_e)}},N$=function(_e){_F(_e.data)},L$=function(_e){e_.postMessage(_X(_e),Kp.protocol+"//"+Kp.host)};Q3&&Z3||(Q3=function(_e){var _t=gX(arguments,1);return QL[++$j]=function(){LP(m5(_e)?_e:EX(_e),void 0,_t)},Qp($j),$j},Z3=function(_e){delete QL[_e]},yX?Qp=function(_e){vX.nextTick(e6(_e))}:_j&&_j.now?Qp=function(_e){_j.now(e6(_e))}:P$&&!mX?(v0=(i0=new P$).port2,i0.port1.onmessage=N$,Qp=a1(v0.postMessage,v0)):e_.addEventListener&&m5(e_.postMessage)&&!e_.importScripts&&Kp&&Kp.protocol!=="file:"&&!pX(L$)?(Qp=L$,e_.addEventListener("message",N$,!1)):Qp=bX in k$("script")?function(_e){x$.appendChild(k$("script")).onreadystatechange=function(){x$.removeChild(this),_F(_e)}}:function(_e){setTimeout(e6(_e),0)});var ZL,Q1,_D,MP,t6,n6,r6,D$,M$={set:Q3,clear:Z3},TX=Sl,SX=/ipad|iphone|ipod/i.test(KS)&&TX.Pebble!==void 0,RX=/web0s(?!.*chrome)/i.test(KS),Z1=Sl,U$=yR,AX=Jl.f,i6=M$.set,IX=S_,wX=SX,OX=RX,o6=N1,j$=Z1.MutationObserver||Z1.WebKitMutationObserver,F$=Z1.document,B$=Z1.process,y5=Z1.Promise,$$=AX(Z1,"queueMicrotask"),V$=$$&&$$.value;V$||(ZL=function(){var _e,_t;for(o6&&(_e=B$.domain)&&_e.exit();Q1;){_t=Q1.fn,Q1=Q1.next;try{_t()}catch(_r){throw Q1?MP():_D=void 0,_r}}_D=void 0,_e&&_e.enter()},IX||o6||OX||!j$||!F$?!wX&&y5&&y5.resolve?((r6=y5.resolve(void 0)).constructor=y5,D$=U$(r6.then,r6),MP=function(){D$(ZL)}):o6?MP=function(){B$.nextTick(ZL)}:(i6=U$(i6,Z1),MP=function(){i6(ZL)}):(t6=!0,n6=F$.createTextNode(""),new j$(ZL).observe(n6,{characterData:!0}),MP=function(){n6.data=t6=!t6}));var CX=V$||function(_e){var _t={fn:_e,next:void 0};_D&&(_D.next=_t),Q1||(Q1=_t,MP()),_D=_t},UP={},G$=JT,xX=function(_e){var _t,_r;this.promise=new _e(function(_o,_a){if(_t!==void 0||_r!==void 0)throw TypeError("Bad Promise constructor");_t=_o,_r=_a}),this.resolve=G$(_t),this.reject=G$(_r)};UP.f=function(_e){return new xX(_e)};var kX=jT,PX=Cy,NX=UP,W$=function(_e,_t){if(kX(_e),PX(_t)&&_t.constructor===_e)return _t;var _r=NX.f(_e);return(0,_r.resolve)(_t),_r.promise},LX=Sl,v5=function(_e){try{return{error:!1,value:_e()}}catch(_t){return{error:!0,value:_t}}},H$=function(){this.head=null,this.tail=null};H$.prototype={add:function(_e){var _t={item:_e,next:null};this.head?this.tail.next=_t:this.head=_t,this.tail=_t},get:function(){var _e=this.head;if(_e)return this.head=_e.next,this.tail===_e&&(this.tail=null),_e.item}};var s6,K$,a6,DX=typeof window=="object",E5=D_,CR=Sl,MX=NT,c1=Up,c6=l5,UX=function(_e,_t,_r){for(var _o in _t)_r&&_r.unsafe&&_e[_o]?_e[_o]=_t[_o]:$3(_e,_o,_t[_o],_r);return _e},jX=o1,FX=function(_e){var _t=V3(_e),_r=G3.f;W3&&_t&&!_t[d5]&&_r(_t,d5,{configurable:!0,get:function(){return this}})},u6=JT,_5=Kl,BX=Cy,$X=function(_e,_t){if(H3(_t,_e))return _e;throw K3("Incorrect invocation")},VX=M_,q$=Zx,GX=function(_e,_t){if(!_t&&!f5)return!1;var _r=!1;try{var _o={};_o[h5]=function(){return{next:function(){return{done:_r=!0}}}},_e(_o)}catch{}return _r},WX=xy,z$=M$.set,l6=CX,HX=W$,KX=function(_e,_t){var _r=LX.console;_r&&_r.error&&(arguments.length==1?_r.error(_e):_r.error(_e,_t))},Y$=UP,d6=v5,qX=H$,h6=OP,zX=vO,YX=DX,T5=N1,X$=Iy,XX=T0("species"),tR="Promise",J$=h6.getterFor(tR),JX=h6.set,QX=h6.getterFor(tR),ZX=c6&&c6.prototype,nR=c6,S5=ZX,Q$=CR.TypeError,f6=CR.document,p6=CR.process,$P=Y$.f,_J=$P,eQ=!!(f6&&f6.createEvent&&CR.dispatchEvent),Z$=_5(CR.PromiseRejectionEvent),eV="unhandledrejection",R5=zX(tR,function(){var _e=VX(nR),_t=_e!==String(nR);if(!_t&&X$===66||!S5.finally)return!0;if(X$>=51&&/native code/.test(_e))return!1;var _r=new nR(function(_a){_a(1)}),_o=function(_a){_a(function(){},function(){})};return(_r.constructor={})[XX]=_o,!(_r.then(function(){})instanceof _o)||!_t&&YX&&!Z$}),tQ=R5||!GX(function(_e){nR.all(_e).catch(function(){})}),tV=function(_e){var _t;return!(!BX(_e)||!_5(_t=_e.then))&&_t},nV=function(_e,_t){var _r,_o,_a,_u=_t.value,yl=_t.state==1,Rl=yl?_e.ok:_e.fail,Al=_e.resolve,Ol=_e.reject,xl=_e.domain;try{Rl?(yl||(_t.rejection===2&&rQ(_t),_t.rejection=1),Rl===!0?_r=_u:(xl&&xl.enter(),_r=Rl(_u),xl&&(xl.exit(),_a=!0)),_r===_e.promise?Ol(Q$("Promise-chain cycle")):(_o=tV(_r))?c1(_o,_r,Al,Ol):Al(_r)):Ol(_u)}catch(Ll){xl&&!_a&&xl.exit(),Ol(Ll)}},rV=function(_e,_t){_e.notified||(_e.notified=!0,l6(function(){for(var _r,_o=_e.reactions;_r=_o.get();)nV(_r,_e);_e.notified=!1,_t&&!_e.rejection&&nQ(_e)}))},iV=function(_e,_t,_r){var _o,_a;eQ?((_o=f6.createEvent("Event")).promise=_t,_o.reason=_r,_o.initEvent(_e,!1,!0),CR.dispatchEvent(_o)):_o={promise:_t,reason:_r},!Z$&&(_a=CR["on"+_e])?_a(_o):_e===eV&&KX("Unhandled promise rejection",_r)},nQ=function(_e){c1(z$,CR,function(){var _t,_r=_e.facade,_o=_e.value;if(oV(_e)&&(_t=d6(function(){T5?p6.emit("unhandledRejection",_o,_r):iV(eV,_r,_o)}),_e.rejection=T5||oV(_e)?2:1,_t.error))throw _t.value})},oV=function(_e){return _e.rejection!==1&&!_e.parent},rQ=function(_e){c1(z$,CR,function(){var _t=_e.facade;T5?p6.emit("rejectionHandled",_t):iV("rejectionhandled",_t,_e.value)})},VP=function(_e,_t,_r){return function(_o){_e(_t,_o,_r)}},WP=function(_e,_t,_r){_e.done||(_e.done=!0,_r&&(_e=_r),_e.value=_t,_e.state=2,rV(_e,!0))},g6=function(_e,_t,_r){if(!_e.done){_e.done=!0,_r&&(_e=_r);try{if(_e.facade===_t)throw Q$("Promise can't be resolved itself");var _o=tV(_t);_o?l6(function(){var _a={done:!1};try{c1(_o,_t,VP(g6,_a,_e),VP(WP,_a,_e))}catch(_u){WP(_a,_u,_e)}}):(_e.value=_t,_e.state=1,rV(_e,!1))}catch(_a){WP({done:!1},_a,_e)}}};R5&&(S5=(nR=function(_e){$X(this,S5),u6(_e),c1(s6,this);var _t=J$(this);try{_e(VP(g6,_t),VP(WP,_t))}catch(_r){WP(_t,_r)}}).prototype,(s6=function(_e){JX(this,{type:tR,done:!1,notified:!1,parent:!1,reactions:new qX,rejection:!1,state:0,value:void 0})}).prototype=UX(S5,{then:function(_e,_t){var _r=QX(this),_o=$P(WX(this,nR));return _r.parent=!0,_o.ok=!_5(_e)||_e,_o.fail=_5(_t)&&_t,_o.domain=T5?p6.domain:void 0,_r.state==0?_r.reactions.add(_o):l6(function(){nV(_o,_r)}),_o.promise},catch:function(_e){return this.then(void 0,_e)}}),K$=function(){var _e=new s6,_t=J$(_e);this.promise=_e,this.resolve=VP(g6,_t),this.reject=VP(WP,_t)},Y$.f=$P=function(_e){return _e===nR||_e===a6?new K$(_e):_J(_e)}),E5({global:!0,wrap:!0,forced:R5},{Promise:nR}),jX(nR,tR,!1,!0),FX(tR),a6=MX(tR),E5({target:tR,stat:!0,forced:R5},{reject:function(_e){var _t=$P(this);return c1(_t.reject,void 0,_e),_t.promise}}),E5({target:tR,stat:!0,forced:!0},{resolve:function(_e){return HX(this===a6?nR:this,_e)}}),E5({target:tR,stat:!0,forced:tQ},{all:function(_e){var _t=this,_r=$P(_t),_o=_r.resolve,_a=_r.reject,_u=d6(function(){var yl=u6(_t.resolve),Rl=[],Al=0,Ol=1;q$(_e,function(xl){var Ll=Al++,Bl=!1;Ol++,c1(yl,_t,xl).then(function(Hl){Bl||(Bl=!0,Rl[Ll]=Hl,--Ol||_o(Rl))},_a)}),--Ol||_o(Rl)});return _u.error&&_a(_u.value),_r.promise},race:function(_e){var _t=this,_r=$P(_t),_o=_r.reject,_a=d6(function(){var _u=u6(_t.resolve);q$(_e,function(yl){c1(_u,_t,yl).then(_r.resolve,_o)})});return _a.error&&_o(_a.value),_r.promise}});var iQ=Up,oQ=JT,sQ=UP,aQ=v5,cQ=Zx;D_({target:"Promise",stat:!0},{allSettled:function(_e){var _t=this,_r=sQ.f(_t),_o=_r.resolve,_a=_r.reject,_u=aQ(function(){var yl=oQ(_t.resolve),Rl=[],Al=0,Ol=1;cQ(_e,function(xl){var Ll=Al++,Bl=!1;Ol++,iQ(yl,_t,xl).then(function(Hl){Bl||(Bl=!0,Rl[Ll]={status:"fulfilled",value:Hl},--Ol||_o(Rl))},function(Hl){Bl||(Bl=!0,Rl[Ll]={status:"rejected",reason:Hl},--Ol||_o(Rl))})}),--Ol||_o(Rl)});return _u.error&&_a(_u.value),_r.promise}});var uQ=JT,lQ=NT,dQ=Up,hQ=UP,fQ=v5,pQ=Zx,sV="No one promise resolved";D_({target:"Promise",stat:!0},{any:function(_e){var _t=this,_r=lQ("AggregateError"),_o=hQ.f(_t),_a=_o.resolve,_u=_o.reject,yl=fQ(function(){var Rl=uQ(_t.resolve),Al=[],Ol=0,xl=1,Ll=!1;pQ(_e,function(Bl){var Hl=Ol++,up=!1;xl++,dQ(Rl,_t,Bl).then(function(_f){up||Ll||(Ll=!0,_a(_f))},function(_f){up||Ll||(up=!0,Al[Hl]=_f,--xl||_u(new _r(Al,sV)))})}),--xl||_u(new _r(Al,sV))});return yl.error&&_u(yl.value),_o.promise}});var aV=l5,gQ=NT,mQ=Kl,yQ=xy,cV=W$;D_({target:"Promise",proto:!0,real:!0,forced:!!aV&&j(function(){aV.prototype.finally.call({then:function(){}},function(){})})},{finally:function(_e){var _t=yQ(this,gQ("Promise")),_r=mQ(_e);return this.then(_r?function(_o){return cV(_t,_e()).then(function(){return _o})}:_e,_r?function(_o){return cV(_t,_e()).then(function(){throw _o})}:_e)}});var m6=xa,vQ=vS,EQ=_A,_Q=J_,bQ=m6("".charAt),uV=m6("".charCodeAt),TQ=m6("".slice),lV=function(_e){return function(_t,_r){var _o,_a,_u=EQ(_Q(_t)),yl=vQ(_r),Rl=_u.length;return yl<0||yl>=Rl?_e?"":void 0:(_o=uV(_u,yl))<55296||_o>56319||yl+1===Rl||(_a=uV(_u,yl+1))<56320||_a>57343?_e?bQ(_u,yl):_o:_e?TQ(_u,yl,yl+2):_a-56320+(_o-55296<<10)+65536}},SQ={codeAt:lV(!1),charAt:lV(!0)}.charAt,RQ=_A,dV=OP,AQ=o5,hV="String Iterator",IQ=dV.set,wQ=dV.getterFor(hV);AQ(String,"String",function(_e){IQ(this,{type:hV,string:RQ(_e),index:0})},function(){var _e,_t=wQ(this),_r=_t.string,_o=_t.index;return _o>=_r.length?{value:void 0,done:!0}:(_e=SQ(_r,_o),_t.index+=_e.length,{value:_e,done:!1})});var OQ=vy.Promise,CQ={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},xQ=Sl,kQ=iS,PQ=O_,fV=bR,pV=T0("toStringTag");for(var y6 in CQ){var gV=xQ[y6],v6=gV&&gV.prototype;v6&&kQ(v6)!==pV&&PQ(v6,pV,y6),fV[y6]=fV.Array}var mV=OQ,u0=mV;const yV=lM;function vV(_e,_t){const _r=_e&&_e.navigator;if(!_r.mediaDevices)return;const _o=function(yl){if(typeof yl!="object"||yl.mandatory||yl.optional)return yl;const Rl={};return Object.keys(yl).forEach(Al=>{if(Al==="require"||Al==="advanced"||Al==="mediaSource")return;const Ol=typeof yl[Al]=="object"?yl[Al]:{ideal:yl[Al]};Ol.exact!==void 0&&typeof Ol.exact=="number"&&(Ol.min=Ol.max=Ol.exact);const xl=function(Ll,Bl){return Ll?Ll+Bl.charAt(0).toUpperCase()+Bl.slice(1):Bl==="deviceId"?"sourceId":Bl};if(Ol.ideal!==void 0){Rl.optional=Rl.optional||[];let Ll={};typeof Ol.ideal=="number"?(Ll[xl("min",Al)]=Ol.ideal,Rl.optional.push(Ll),Ll={},Ll[xl("max",Al)]=Ol.ideal,Rl.optional.push(Ll)):(Ll[xl("",Al)]=Ol.ideal,Rl.optional.push(Ll))}Ol.exact!==void 0&&typeof Ol.exact!="number"?(Rl.mandatory=Rl.mandatory||{},Rl.mandatory[xl("",Al)]=Ol.exact):["min","max"].forEach(Ll=>{Ol[Ll]!==void 0&&(Rl.mandatory=Rl.mandatory||{},Rl.mandatory[xl(Ll,Al)]=Ol[Ll])})}),yl.advanced&&(Rl.optional=(Rl.optional||[]).concat(yl.advanced)),Rl},_a=function(yl,Rl){if(_t.version>=61)return Rl(yl);if((yl=JSON.parse(JSON.stringify(yl)))&&typeof yl.audio=="object"){const Al=function(Ol,xl,Ll){xl in Ol&&!(Ll in Ol)&&(Ol[Ll]=Ol[xl],delete Ol[xl])};Al((yl=JSON.parse(JSON.stringify(yl))).audio,"autoGainControl","googAutoGainControl"),Al(yl.audio,"noiseSuppression","googNoiseSuppression"),yl.audio=_o(yl.audio)}if(yl&&typeof yl.video=="object"){let Al=yl.video.facingMode;Al=Al&&(typeof Al=="object"?Al:{ideal:Al});const Ol=_t.version<66;if(Al&&(Al.exact==="user"||Al.exact==="environment"||Al.ideal==="user"||Al.ideal==="environment")&&(!_r.mediaDevices.getSupportedConstraints||!_r.mediaDevices.getSupportedConstraints().facingMode||Ol)){let xl;if(delete yl.video.facingMode,Al.exact==="environment"||Al.ideal==="environment"?xl=["back","rear"]:Al.exact!=="user"&&Al.ideal!=="user"||(xl=["front"]),xl)return _r.mediaDevices.enumerateDevices().then(Ll=>{let Bl=(Ll=Ll.filter(Hl=>Hl.kind==="videoinput")).find(Hl=>xl.some(up=>Hl.label.toLowerCase().includes(up)));return!Bl&&Ll.length&&xl.includes("back")&&(Bl=Ll[Ll.length-1]),Bl&&(yl.video.deviceId=Al.exact?{exact:Bl.deviceId}:{ideal:Bl.deviceId}),yl.video=_o(yl.video),yV("chrome: "+JSON.stringify(yl)),Rl(yl)})}yl.video=_o(yl.video)}return yV("chrome: "+JSON.stringify(yl)),Rl(yl)},_u=function(yl){return _t.version>=64?yl:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[yl.name]||yl.name,message:yl.message,constraint:yl.constraint||yl.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(_r.getUserMedia=function(yl,Rl,Al){_a(yl,Ol=>{_r.webkitGetUserMedia(Ol,Rl,xl=>{Al&&Al(_u(xl))})})}.bind(_r),_r.mediaDevices.getUserMedia){const yl=_r.mediaDevices.getUserMedia.bind(_r.mediaDevices);_r.mediaDevices.getUserMedia=function(Rl){return _a(Rl,Al=>yl(Al).then(Ol=>{if(Al.audio&&!Ol.getAudioTracks().length||Al.video&&!Ol.getVideoTracks().length)throw Ol.getTracks().forEach(xl=>{xl.stop()}),new DOMException("","NotFoundError");return Ol},Ol=>u0.reject(_u(Ol))))}}}function EV(_e){_e.MediaStream=_e.MediaStream||_e.webkitMediaStream}function _V(_e){if(typeof _e=="object"&&_e.RTCPeerConnection&&!("ontrack"in _e.RTCPeerConnection.prototype)){Object.defineProperty(_e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(_r){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=_r)},enumerable:!0,configurable:!0});const _t=_e.RTCPeerConnection.prototype.setRemoteDescription;_e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=_r=>{_r.stream.addEventListener("addtrack",_o=>{let _a;_a=_e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(yl=>yl.track&&yl.track.id===_o.track.id):{track:_o.track};const _u=new Event("track");_u.track=_o.track,_u.receiver=_a,_u.transceiver={receiver:_a},_u.streams=[_r.stream],this.dispatchEvent(_u)}),_r.stream.getTracks().forEach(_o=>{let _a;_a=_e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(yl=>yl.track&&yl.track.id===_o.id):{track:_o};const _u=new Event("track");_u.track=_o,_u.receiver=_a,_u.transceiver={receiver:_a},_u.streams=[_r.stream],this.dispatchEvent(_u)})},this.addEventListener("addstream",this._ontrackpoly)),_t.apply(this,arguments)}}else sT(_e,"track",_t=>(_t.transceiver||Object.defineProperty(_t,"transceiver",{value:{receiver:_t.receiver}}),_t))}function bV(_e){if(typeof _e=="object"&&_e.RTCPeerConnection&&!("getSenders"in _e.RTCPeerConnection.prototype)&&"createDTMFSender"in _e.RTCPeerConnection.prototype){const _t=function(_a,_u){return{track:_u,get dtmf(){return this._dtmf===void 0&&(_u.kind==="audio"?this._dtmf=_a.createDTMFSender(_u):this._dtmf=null),this._dtmf},_pc:_a}};if(!_e.RTCPeerConnection.prototype.getSenders){_e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const _a=_e.RTCPeerConnection.prototype.addTrack;_e.RTCPeerConnection.prototype.addTrack=function(yl,Rl){let Al=_a.apply(this,arguments);return Al||(Al=_t(this,yl),this._senders.push(Al)),Al};const _u=_e.RTCPeerConnection.prototype.removeTrack;_e.RTCPeerConnection.prototype.removeTrack=function(yl){_u.apply(this,arguments);const Rl=this._senders.indexOf(yl);Rl!==-1&&this._senders.splice(Rl,1)}}const _r=_e.RTCPeerConnection.prototype.addStream;_e.RTCPeerConnection.prototype.addStream=function(_a){this._senders=this._senders||[],_r.apply(this,[_a]),_a.getTracks().forEach(_u=>{this._senders.push(_t(this,_u))})};const _o=_e.RTCPeerConnection.prototype.removeStream;_e.RTCPeerConnection.prototype.removeStream=function(_a){this._senders=this._senders||[],_o.apply(this,[_a]),_a.getTracks().forEach(_u=>{const yl=this._senders.find(Rl=>Rl.track===_u);yl&&this._senders.splice(this._senders.indexOf(yl),1)})}}else if(typeof _e=="object"&&_e.RTCPeerConnection&&"getSenders"in _e.RTCPeerConnection.prototype&&"createDTMFSender"in _e.RTCPeerConnection.prototype&&_e.RTCRtpSender&&!("dtmf"in _e.RTCRtpSender.prototype)){const _t=_e.RTCPeerConnection.prototype.getSenders;_e.RTCPeerConnection.prototype.getSenders=function(){const _r=_t.apply(this,[]);return _r.forEach(_o=>_o._pc=this),_r},Object.defineProperty(_e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function TV(_e){if(!_e.RTCPeerConnection)return;const _t=_e.RTCPeerConnection.prototype.getStats;_e.RTCPeerConnection.prototype.getStats=function(){const[_r,_o,_a]=arguments;if(arguments.length>0&&typeof _r=="function")return _t.apply(this,arguments);if(_t.length===0&&(arguments.length===0||typeof _r!="function"))return _t.apply(this,[]);const _u=function(Rl){const Al={};return Rl.result().forEach(Ol=>{const xl={id:Ol.id,timestamp:Ol.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[Ol.type]||Ol.type};Ol.names().forEach(Ll=>{xl[Ll]=Ol.stat(Ll)}),Al[xl.id]=xl}),Al},yl=function(Rl){return new Map(Object.keys(Rl).map(Al=>[Al,Rl[Al]]))};if(arguments.length>=2){const Rl=function(Al){_o(yl(_u(Al)))};return _t.apply(this,[Rl,_r])}return new u0((Rl,Al)=>{_t.apply(this,[function(Ol){Rl(yl(_u(Ol)))},Al])}).then(_o,_a)}}function SV(_e){if(!(typeof _e=="object"&&_e.RTCPeerConnection&&_e.RTCRtpSender&&_e.RTCRtpReceiver))return;if(!("getStats"in _e.RTCRtpSender.prototype)){const _r=_e.RTCPeerConnection.prototype.getSenders;_r&&(_e.RTCPeerConnection.prototype.getSenders=function(){const _a=_r.apply(this,[]);return _a.forEach(_u=>_u._pc=this),_a});const _o=_e.RTCPeerConnection.prototype.addTrack;_o&&(_e.RTCPeerConnection.prototype.addTrack=function(){const _a=_o.apply(this,arguments);return _a._pc=this,_a}),_e.RTCRtpSender.prototype.getStats=function(){const _a=this;return this._pc.getStats().then(_u=>D1(_u,_a.track,!0))}}if(!("getStats"in _e.RTCRtpReceiver.prototype)){const _r=_e.RTCPeerConnection.prototype.getReceivers;_r&&(_e.RTCPeerConnection.prototype.getReceivers=function(){const _o=_r.apply(this,[]);return _o.forEach(_a=>_a._pc=this),_o}),sT(_e,"track",_o=>(_o.receiver._pc=_o.srcElement,_o)),_e.RTCRtpReceiver.prototype.getStats=function(){const _o=this;return this._pc.getStats().then(_a=>D1(_a,_o.track,!1))}}if(!("getStats"in _e.RTCRtpSender.prototype)||!("getStats"in _e.RTCRtpReceiver.prototype))return;const _t=_e.RTCPeerConnection.prototype.getStats;_e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof _e.MediaStreamTrack){const _r=arguments[0];let _o,_a,_u;return this.getSenders().forEach(yl=>{yl.track===_r&&(_o?_u=!0:_o=yl)}),this.getReceivers().forEach(yl=>(yl.track===_r&&(_a?_u=!0:_a=yl),yl.track===_r)),_u||_o&&_a?u0.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):_o?_o.getStats():_a?_a.getStats():u0.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return _t.apply(this,arguments)}}function RV(_e){_e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(_u=>this._shimmedLocalStreams[_u][0])};const _t=_e.RTCPeerConnection.prototype.addTrack;_e.RTCPeerConnection.prototype.addTrack=function(_u,yl){if(!yl)return _t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const Rl=_t.apply(this,arguments);return this._shimmedLocalStreams[yl.id]?this._shimmedLocalStreams[yl.id].indexOf(Rl)===-1&&this._shimmedLocalStreams[yl.id].push(Rl):this._shimmedLocalStreams[yl.id]=[yl,Rl],Rl};const _r=_e.RTCPeerConnection.prototype.addStream;_e.RTCPeerConnection.prototype.addStream=function(_u){this._shimmedLocalStreams=this._shimmedLocalStreams||{},_u.getTracks().forEach(Al=>{if(this.getSenders().find(Ol=>Ol.track===Al))throw new DOMException("Track already exists.","InvalidAccessError")});const yl=this.getSenders();_r.apply(this,arguments);const Rl=this.getSenders().filter(Al=>yl.indexOf(Al)===-1);this._shimmedLocalStreams[_u.id]=[_u].concat(Rl)};const _o=_e.RTCPeerConnection.prototype.removeStream;_e.RTCPeerConnection.prototype.removeStream=function(_u){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[_u.id],_o.apply(this,arguments)};const _a=_e.RTCPeerConnection.prototype.removeTrack;_e.RTCPeerConnection.prototype.removeTrack=function(_u){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},_u&&Object.keys(this._shimmedLocalStreams).forEach(yl=>{const Rl=this._shimmedLocalStreams[yl].indexOf(_u);Rl!==-1&&this._shimmedLocalStreams[yl].splice(Rl,1),this._shimmedLocalStreams[yl].length===1&&delete this._shimmedLocalStreams[yl]}),_a.apply(this,arguments)}}function AV(_e,_t){if(!_e.RTCPeerConnection)return;if(_e.RTCPeerConnection.prototype.addTrack&&_t.version>=65)return RV(_e);const _r=_e.RTCPeerConnection.prototype.getLocalStreams;_e.RTCPeerConnection.prototype.getLocalStreams=function(){const Ol=_r.apply(this);return this._reverseStreams=this._reverseStreams||{},Ol.map(xl=>this._reverseStreams[xl.id])};const _o=_e.RTCPeerConnection.prototype.addStream;_e.RTCPeerConnection.prototype.addStream=function(Ol){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},Ol.getTracks().forEach(xl=>{if(this.getSenders().find(Ll=>Ll.track===xl))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[Ol.id]){const xl=new _e.MediaStream(Ol.getTracks());this._streams[Ol.id]=xl,this._reverseStreams[xl.id]=Ol,Ol=xl}_o.apply(this,[Ol])};const _a=_e.RTCPeerConnection.prototype.removeStream;function _u(Ol,xl){let Ll=xl.sdp;return Object.keys(Ol._reverseStreams||[]).forEach(Bl=>{const Hl=Ol._reverseStreams[Bl],up=Ol._streams[Hl.id];Ll=Ll.replace(new RegExp(up.id,"g"),Hl.id)}),new RTCSessionDescription({type:xl.type,sdp:Ll})}function yl(Ol,xl){let Ll=xl.sdp;return Object.keys(Ol._reverseStreams||[]).forEach(Bl=>{const Hl=Ol._reverseStreams[Bl],up=Ol._streams[Hl.id];Ll=Ll.replace(new RegExp(Hl.id,"g"),up.id)}),new RTCSessionDescription({type:xl.type,sdp:Ll})}_e.RTCPeerConnection.prototype.removeStream=function(Ol){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},_a.apply(this,[this._streams[Ol.id]||Ol]),delete this._reverseStreams[this._streams[Ol.id]?this._streams[Ol.id].id:Ol.id],delete this._streams[Ol.id]},_e.RTCPeerConnection.prototype.addTrack=function(Ol,xl){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const Ll=[].slice.call(arguments,1);if(Ll.length!==1||!Ll[0].getTracks().find(up=>up===Ol))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(up=>up.track===Ol))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const Hl=this._streams[xl.id];if(Hl)Hl.addTrack(Ol),u0.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const up=new _e.MediaStream([Ol]);this._streams[xl.id]=up,this._reverseStreams[up.id]=xl,this.addStream(up)}return this.getSenders().find(up=>up.track===Ol)},["createOffer","createAnswer"].forEach(function(Ol){const xl=_e.RTCPeerConnection.prototype[Ol],Ll={[Ol](){const Bl=arguments;return arguments.length&&typeof arguments[0]=="function"?xl.apply(this,[Hl=>{const up=_u(this,Hl);Bl[0].apply(null,[up])},Hl=>{Bl[1]&&Bl[1].apply(null,Hl)},arguments[2]]):xl.apply(this,arguments).then(Hl=>_u(this,Hl))}};_e.RTCPeerConnection.prototype[Ol]=Ll[Ol]});const Rl=_e.RTCPeerConnection.prototype.setLocalDescription;_e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=yl(this,arguments[0]),Rl.apply(this,arguments)):Rl.apply(this,arguments)};const Al=Object.getOwnPropertyDescriptor(_e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(_e.RTCPeerConnection.prototype,"localDescription",{get(){const Ol=Al.get.apply(this);return Ol.type===""?Ol:_u(this,Ol)}}),_e.RTCPeerConnection.prototype.removeTrack=function(Ol){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!Ol._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(Ol._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let xl;this._streams=this._streams||{},Object.keys(this._streams).forEach(Ll=>{this._streams[Ll].getTracks().find(Bl=>Ol.track===Bl)&&(xl=this._streams[Ll])}),xl&&(xl.getTracks().length===1?this.removeStream(this._reverseStreams[xl.id]):xl.removeTrack(Ol.track),this.dispatchEvent(new Event("negotiationneeded")))}}function E6(_e,_t){!_e.RTCPeerConnection&&_e.webkitRTCPeerConnection&&(_e.RTCPeerConnection=_e.webkitRTCPeerConnection),_e.RTCPeerConnection&&_t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(_r){const _o=_e.RTCPeerConnection.prototype[_r],_a={[_r](){return arguments[0]=new(_r==="addIceCandidate"?_e.RTCIceCandidate:_e.RTCSessionDescription)(arguments[0]),_o.apply(this,arguments)}};_e.RTCPeerConnection.prototype[_r]=_a[_r]})}function IV(_e,_t){sT(_e,"negotiationneeded",_r=>{const _o=_r.target;if(!(_t.version<72||_o.getConfiguration&&_o.getConfiguration().sdpSemantics==="plan-b")||_o.signalingState==="stable")return _r})}var wV=Object.freeze({__proto__:null,shimMediaStream:EV,shimOnTrack:_V,shimGetSendersWithDtmf:bV,shimGetStats:TV,shimSenderReceiverGetStats:SV,shimAddTrackRemoveTrackWithNative:RV,shimAddTrackRemoveTrack:AV,shimPeerConnection:E6,fixNegotiationNeeded:IV,shimGetUserMedia:vV,shimGetDisplayMedia:function(_e,_t){_e.navigator.mediaDevices&&"getDisplayMedia"in _e.navigator.mediaDevices||_e.navigator.mediaDevices&&(typeof _t=="function"?_e.navigator.mediaDevices.getDisplayMedia=function(_r){return _t(_r).then(_o=>{const _a=_r.video&&_r.video.width,_u=_r.video&&_r.video.height,yl=_r.video&&_r.video.frameRate;return _r.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:_o,maxFrameRate:yl||3}},_a&&(_r.video.mandatory.maxWidth=_a),_u&&(_r.video.mandatory.maxHeight=_u),_e.navigator.mediaDevices.getUserMedia(_r)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}});function OV(_e,_t){const _r=_e&&_e.navigator,_o=_e&&_e.MediaStreamTrack;if(_r.getUserMedia=function(_a,_u,yl){kO("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),_r.mediaDevices.getUserMedia(_a).then(_u,yl)},!(_t.version>55&&"autoGainControl"in _r.mediaDevices.getSupportedConstraints())){const _a=function(yl,Rl,Al){Rl in yl&&!(Al in yl)&&(yl[Al]=yl[Rl],delete yl[Rl])},_u=_r.mediaDevices.getUserMedia.bind(_r.mediaDevices);if(_r.mediaDevices.getUserMedia=function(yl){return typeof yl=="object"&&typeof yl.audio=="object"&&(yl=JSON.parse(JSON.stringify(yl)),_a(yl.audio,"autoGainControl","mozAutoGainControl"),_a(yl.audio,"noiseSuppression","mozNoiseSuppression")),_u(yl)},_o&&_o.prototype.getSettings){const yl=_o.prototype.getSettings;_o.prototype.getSettings=function(){const Rl=yl.apply(this,arguments);return _a(Rl,"mozAutoGainControl","autoGainControl"),_a(Rl,"mozNoiseSuppression","noiseSuppression"),Rl}}if(_o&&_o.prototype.applyConstraints){const yl=_o.prototype.applyConstraints;_o.prototype.applyConstraints=function(Rl){return this.kind==="audio"&&typeof Rl=="object"&&(Rl=JSON.parse(JSON.stringify(Rl)),_a(Rl,"autoGainControl","mozAutoGainControl"),_a(Rl,"noiseSuppression","mozNoiseSuppression")),yl.apply(this,[Rl])}}}}function CV(_e){typeof _e=="object"&&_e.RTCTrackEvent&&"receiver"in _e.RTCTrackEvent.prototype&&!("transceiver"in _e.RTCTrackEvent.prototype)&&Object.defineProperty(_e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function _6(_e,_t){if(typeof _e!="object"||!_e.RTCPeerConnection&&!_e.mozRTCPeerConnection)return;!_e.RTCPeerConnection&&_e.mozRTCPeerConnection&&(_e.RTCPeerConnection=_e.mozRTCPeerConnection),_t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(_a){const _u=_e.RTCPeerConnection.prototype[_a],yl={[_a](){return arguments[0]=new(_a==="addIceCandidate"?_e.RTCIceCandidate:_e.RTCSessionDescription)(arguments[0]),_u.apply(this,arguments)}};_e.RTCPeerConnection.prototype[_a]=yl[_a]});const _r={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},_o=_e.RTCPeerConnection.prototype.getStats;_e.RTCPeerConnection.prototype.getStats=function(){const[_a,_u,yl]=arguments;return _o.apply(this,[_a||null]).then(Rl=>{if(_t.version<53&&!_u)try{Rl.forEach(Al=>{Al.type=_r[Al.type]||Al.type})}catch(Al){if(Al.name!=="TypeError")throw Al;Rl.forEach((Ol,xl)=>{Rl.set(xl,Object.assign({},Ol,{type:_r[Ol.type]||Ol.type}))})}return Rl}).then(_u,yl)}}function xV(_e){if(typeof _e!="object"||!_e.RTCPeerConnection||!_e.RTCRtpSender||_e.RTCRtpSender&&"getStats"in _e.RTCRtpSender.prototype)return;const _t=_e.RTCPeerConnection.prototype.getSenders;_t&&(_e.RTCPeerConnection.prototype.getSenders=function(){const _o=_t.apply(this,[]);return _o.forEach(_a=>_a._pc=this),_o});const _r=_e.RTCPeerConnection.prototype.addTrack;_r&&(_e.RTCPeerConnection.prototype.addTrack=function(){const _o=_r.apply(this,arguments);return _o._pc=this,_o}),_e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):u0.resolve(new Map)}}function kV(_e){if(typeof _e!="object"||!_e.RTCPeerConnection||!_e.RTCRtpSender||_e.RTCRtpSender&&"getStats"in _e.RTCRtpReceiver.prototype)return;const _t=_e.RTCPeerConnection.prototype.getReceivers;_t&&(_e.RTCPeerConnection.prototype.getReceivers=function(){const _r=_t.apply(this,[]);return _r.forEach(_o=>_o._pc=this),_r}),sT(_e,"track",_r=>(_r.receiver._pc=_r.srcElement,_r)),_e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function PV(_e){_e.RTCPeerConnection&&!("removeStream"in _e.RTCPeerConnection.prototype)&&(_e.RTCPeerConnection.prototype.removeStream=function(_t){kO("removeStream","removeTrack"),this.getSenders().forEach(_r=>{_r.track&&_t.getTracks().includes(_r.track)&&this.removeTrack(_r)})})}function NV(_e){_e.DataChannel&&!_e.RTCDataChannel&&(_e.RTCDataChannel=_e.DataChannel)}function LV(_e){if(typeof _e!="object"||!_e.RTCPeerConnection)return;const _t=_e.RTCPeerConnection.prototype.addTransceiver;_t&&(_e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let _r=arguments[1]&&arguments[1].sendEncodings;_r===void 0&&(_r=[]),_r=[..._r];const _o=_r.length>0;_o&&_r.forEach(_u=>{if("rid"in _u&&!/^[a-z0-9]{0,16}$/i.test(_u.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in _u&&!(parseFloat(_u.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in _u&&!(parseFloat(_u.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const _a=_t.apply(this,arguments);if(_o){const{sender:_u}=_a,yl=_u.getParameters();(!("encodings"in yl)||yl.encodings.length===1&&Object.keys(yl.encodings[0]).length===0)&&(yl.encodings=_r,_u.sendEncodings=_r,this.setParametersPromises.push(_u.setParameters(yl).then(()=>{delete _u.sendEncodings}).catch(()=>{delete _u.sendEncodings})))}return _a})}function DV(_e){if(typeof _e!="object"||!_e.RTCRtpSender)return;const _t=_e.RTCRtpSender.prototype.getParameters;_t&&(_e.RTCRtpSender.prototype.getParameters=function(){const _r=_t.apply(this,arguments);return"encodings"in _r||(_r.encodings=[].concat(this.sendEncodings||[{}])),_r})}function MV(_e){if(typeof _e!="object"||!_e.RTCPeerConnection)return;const _t=_e.RTCPeerConnection.prototype.createOffer;_e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?u0.all(this.setParametersPromises).then(()=>_t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):_t.apply(this,arguments)}}function UV(_e){if(typeof _e!="object"||!_e.RTCPeerConnection)return;const _t=_e.RTCPeerConnection.prototype.createAnswer;_e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?u0.all(this.setParametersPromises).then(()=>_t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):_t.apply(this,arguments)}}var jV=Object.freeze({__proto__:null,shimOnTrack:CV,shimPeerConnection:_6,shimSenderGetStats:xV,shimReceiverGetStats:kV,shimRemoveStream:PV,shimRTCDataChannel:NV,shimAddTransceiver:LV,shimGetParameters:DV,shimCreateOffer:MV,shimCreateAnswer:UV,shimGetUserMedia:OV,shimGetDisplayMedia:function(_e,_t){_e.navigator.mediaDevices&&"getDisplayMedia"in _e.navigator.mediaDevices||_e.navigator.mediaDevices&&(_e.navigator.mediaDevices.getDisplayMedia=function(_r){if(!_r||!_r.video){const _o=new DOMException("getDisplayMedia without video constraints is undefined");return _o.name="NotFoundError",_o.code=8,u0.reject(_o)}return _r.video===!0?_r.video={mediaSource:_t}:_r.video.mediaSource=_t,_e.navigator.mediaDevices.getUserMedia(_r)})}});function FV(_e){if(typeof _e=="object"&&_e.RTCPeerConnection){if("getLocalStreams"in _e.RTCPeerConnection.prototype||(_e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in _e.RTCPeerConnection.prototype)){const _t=_e.RTCPeerConnection.prototype.addTrack;_e.RTCPeerConnection.prototype.addStream=function(_r){this._localStreams||(this._localStreams=[]),this._localStreams.includes(_r)||this._localStreams.push(_r),_r.getAudioTracks().forEach(_o=>_t.call(this,_o,_r)),_r.getVideoTracks().forEach(_o=>_t.call(this,_o,_r))},_e.RTCPeerConnection.prototype.addTrack=function(_r){for(var _o=arguments.length,_a=new Array(_o>1?_o-1:0),_u=1;_u<_o;_u++)_a[_u-1]=arguments[_u];return _a&&_a.forEach(yl=>{this._localStreams?this._localStreams.includes(yl)||this._localStreams.push(yl):this._localStreams=[yl]}),_t.apply(this,arguments)}}"removeStream"in _e.RTCPeerConnection.prototype||(_e.RTCPeerConnection.prototype.removeStream=function(_t){this._localStreams||(this._localStreams=[]);const _r=this._localStreams.indexOf(_t);if(_r===-1)return;this._localStreams.splice(_r,1);const _o=_t.getTracks();this.getSenders().forEach(_a=>{_o.includes(_a.track)&&this.removeTrack(_a)})})}}function BV(_e){if(typeof _e=="object"&&_e.RTCPeerConnection&&("getRemoteStreams"in _e.RTCPeerConnection.prototype||(_e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in _e.RTCPeerConnection.prototype))){Object.defineProperty(_e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(_r){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=_r),this.addEventListener("track",this._onaddstreampoly=_o=>{_o.streams.forEach(_a=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(_a))return;this._remoteStreams.push(_a);const _u=new Event("addstream");_u.stream=_a,this.dispatchEvent(_u)})})}});const _t=_e.RTCPeerConnection.prototype.setRemoteDescription;_e.RTCPeerConnection.prototype.setRemoteDescription=function(){const _r=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(_o){_o.streams.forEach(_a=>{if(_r._remoteStreams||(_r._remoteStreams=[]),_r._remoteStreams.indexOf(_a)>=0)return;_r._remoteStreams.push(_a);const _u=new Event("addstream");_u.stream=_a,_r.dispatchEvent(_u)})}),_t.apply(_r,arguments)}}}function $V(_e){if(typeof _e!="object"||!_e.RTCPeerConnection)return;const _t=_e.RTCPeerConnection.prototype,_r=_t.createOffer,_o=_t.createAnswer,_a=_t.setLocalDescription,_u=_t.setRemoteDescription,yl=_t.addIceCandidate;_t.createOffer=function(Al,Ol){const xl=arguments.length>=2?arguments[2]:arguments[0],Ll=_r.apply(this,[xl]);return Ol?(Ll.then(Al,Ol),u0.resolve()):Ll},_t.createAnswer=function(Al,Ol){const xl=arguments.length>=2?arguments[2]:arguments[0],Ll=_o.apply(this,[xl]);return Ol?(Ll.then(Al,Ol),u0.resolve()):Ll};let Rl=function(Al,Ol,xl){const Ll=_a.apply(this,[Al]);return xl?(Ll.then(Ol,xl),u0.resolve()):Ll};_t.setLocalDescription=Rl,Rl=function(Al,Ol,xl){const Ll=_u.apply(this,[Al]);return xl?(Ll.then(Ol,xl),u0.resolve()):Ll},_t.setRemoteDescription=Rl,Rl=function(Al,Ol,xl){const Ll=yl.apply(this,[Al]);return xl?(Ll.then(Ol,xl),u0.resolve()):Ll},_t.addIceCandidate=Rl}function VV(_e){const _t=_e&&_e.navigator;if(_t.mediaDevices&&_t.mediaDevices.getUserMedia){const _r=_t.mediaDevices,_o=_r.getUserMedia.bind(_r);_t.mediaDevices.getUserMedia=_a=>_o(GV(_a))}!_t.getUserMedia&&_t.mediaDevices&&_t.mediaDevices.getUserMedia&&(_t.getUserMedia=function(_r,_o,_a){_t.mediaDevices.getUserMedia(_r).then(_o,_a)}.bind(_t))}function GV(_e){return _e&&_e.video!==void 0?Object.assign({},_e,{video:jO(_e.video)}):_e}function WV(_e){if(!_e.RTCPeerConnection)return;const _t=_e.RTCPeerConnection;_e.RTCPeerConnection=function(_r,_o){if(_r&&_r.iceServers){const _a=[];for(let _u=0;_u<_r.iceServers.length;_u++){let yl=_r.iceServers[_u];!yl.hasOwnProperty("urls")&&yl.hasOwnProperty("url")?(kO("RTCIceServer.url","RTCIceServer.urls"),yl=JSON.parse(JSON.stringify(yl)),yl.urls=yl.url,delete yl.url,_a.push(yl)):_a.push(_r.iceServers[_u])}_r.iceServers=_a}return new _t(_r,_o)},_e.RTCPeerConnection.prototype=_t.prototype,"generateCertificate"in _t&&Object.defineProperty(_e.RTCPeerConnection,"generateCertificate",{get:()=>_t.generateCertificate})}function HV(_e){typeof _e=="object"&&_e.RTCTrackEvent&&"receiver"in _e.RTCTrackEvent.prototype&&!("transceiver"in _e.RTCTrackEvent.prototype)&&Object.defineProperty(_e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function KV(_e){const _t=_e.RTCPeerConnection.prototype.createOffer;_e.RTCPeerConnection.prototype.createOffer=function(_r){if(_r){_r.offerToReceiveAudio!==void 0&&(_r.offerToReceiveAudio=!!_r.offerToReceiveAudio);const _o=this.getTransceivers().find(_u=>_u.receiver.track.kind==="audio");_r.offerToReceiveAudio===!1&&_o?_o.direction==="sendrecv"?_o.setDirection?_o.setDirection("sendonly"):_o.direction="sendonly":_o.direction==="recvonly"&&(_o.setDirection?_o.setDirection("inactive"):_o.direction="inactive"):_r.offerToReceiveAudio!==!0||_o||this.addTransceiver("audio",{direction:"recvonly"}),_r.offerToReceiveVideo!==void 0&&(_r.offerToReceiveVideo=!!_r.offerToReceiveVideo);const _a=this.getTransceivers().find(_u=>_u.receiver.track.kind==="video");_r.offerToReceiveVideo===!1&&_a?_a.direction==="sendrecv"?_a.setDirection?_a.setDirection("sendonly"):_a.direction="sendonly":_a.direction==="recvonly"&&(_a.setDirection?_a.setDirection("inactive"):_a.direction="inactive"):_r.offerToReceiveVideo!==!0||_a||this.addTransceiver("video",{direction:"recvonly"})}return _t.apply(this,arguments)}}function qV(_e){typeof _e!="object"||_e.AudioContext||(_e.AudioContext=_e.webkitAudioContext)}var zV=Object.freeze({__proto__:null,shimLocalStreamsAPI:FV,shimRemoteStreamsAPI:BV,shimCallbacksAPI:$V,shimGetUserMedia:VV,shimConstraints:GV,shimRTCIceServerUrls:WV,shimTrackEventTransceiver:HV,shimCreateOfferLegacy:KV,shimAudioContext:qV}),NQ=`	
\v\f\r                　\u2028\u2029\uFEFF`,LQ=J_,DQ=_A,YV=xa("".replace),A5=`[	
\v\f\r                　\u2028\u2029\uFEFF]`,MQ=RegExp("^"+A5+A5+"*"),UQ=RegExp(A5+A5+"*$"),T6=function(_e){return function(_t){var _r=DQ(LQ(_t));return 1&_e&&(_r=YV(_r,MQ,"")),2&_e&&(_r=YV(_r,UQ,"")),_r}},jQ={start:T6(1),end:T6(2),trim:T6(3)},FQ=YM.PROPER,BQ=j,XV=NQ,$Q=jQ.trim;D_({target:"String",proto:!0,forced:function(_e){return BQ(function(){return!!XV[_e]()||"​᠎"[_e]()!=="​᠎"||FQ&&XV[_e].name!==_e})}("trim")},{trim:function(){return $Q(this)}});var VQ=tS("String").trim,GQ=El,WQ=VQ,S6=String.prototype,xR=function(_e){var _t=_e.trim;return typeof _e=="string"||_e===S6||GQ(S6,_e)&&_t===S6.trim?WQ:_t},R6={exports:{}};(function(_e){const _t={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};_t.localCName=_t.generateIdentifier(),_t.splitLines=function(_r){return xR(_r).call(_r).split(`
`).map(_o=>xR(_o).call(_o))},_t.splitSections=function(_r){return _r.split(`
m=`).map((_o,_a)=>{var _u;return xR(_u=_a>0?"m="+_o:_o).call(_u)+`\r
`})},_t.getDescription=function(_r){const _o=_t.splitSections(_r);return _o&&_o[0]},_t.getMediaSections=function(_r){const _o=_t.splitSections(_r);return _o.shift(),_o},_t.matchPrefix=function(_r,_o){return _t.splitLines(_r).filter(_a=>_a.indexOf(_o)===0)},_t.parseCandidate=function(_r){let _o;_o=_r.indexOf("a=candidate:")===0?_r.substring(12).split(" "):_r.substring(10).split(" ");const _a={foundation:_o[0],component:{1:"rtp",2:"rtcp"}[_o[1]]||_o[1],protocol:_o[2].toLowerCase(),priority:parseInt(_o[3],10),ip:_o[4],address:_o[4],port:parseInt(_o[5],10),type:_o[7]};for(let _u=8;_u<_o.length;_u+=2)switch(_o[_u]){case"raddr":_a.relatedAddress=_o[_u+1];break;case"rport":_a.relatedPort=parseInt(_o[_u+1],10);break;case"tcptype":_a.tcpType=_o[_u+1];break;case"ufrag":_a.ufrag=_o[_u+1],_a.usernameFragment=_o[_u+1];break;default:_a[_o[_u]]===void 0&&(_a[_o[_u]]=_o[_u+1])}return _a},_t.writeCandidate=function(_r){const _o=[];_o.push(_r.foundation);const _a=_r.component;_a==="rtp"?_o.push(1):_a==="rtcp"?_o.push(2):_o.push(_a),_o.push(_r.protocol.toUpperCase()),_o.push(_r.priority),_o.push(_r.address||_r.ip),_o.push(_r.port);const _u=_r.type;return _o.push("typ"),_o.push(_u),_u!=="host"&&_r.relatedAddress&&_r.relatedPort&&(_o.push("raddr"),_o.push(_r.relatedAddress),_o.push("rport"),_o.push(_r.relatedPort)),_r.tcpType&&_r.protocol.toLowerCase()==="tcp"&&(_o.push("tcptype"),_o.push(_r.tcpType)),(_r.usernameFragment||_r.ufrag)&&(_o.push("ufrag"),_o.push(_r.usernameFragment||_r.ufrag)),"candidate:"+_o.join(" ")},_t.parseIceOptions=function(_r){return _r.substr(14).split(" ")},_t.parseRtpMap=function(_r){let _o=_r.substr(9).split(" ");const _a={payloadType:parseInt(_o.shift(),10)};return _o=_o[0].split("/"),_a.name=_o[0],_a.clockRate=parseInt(_o[1],10),_a.channels=_o.length===3?parseInt(_o[2],10):1,_a.numChannels=_a.channels,_a},_t.writeRtpMap=function(_r){let _o=_r.payloadType;_r.preferredPayloadType!==void 0&&(_o=_r.preferredPayloadType);const _a=_r.channels||_r.numChannels||1;return"a=rtpmap:"+_o+" "+_r.name+"/"+_r.clockRate+(_a!==1?"/"+_a:"")+`\r
`},_t.parseExtmap=function(_r){const _o=_r.substr(9).split(" ");return{id:parseInt(_o[0],10),direction:_o[0].indexOf("/")>0?_o[0].split("/")[1]:"sendrecv",uri:_o[1]}},_t.writeExtmap=function(_r){return"a=extmap:"+(_r.id||_r.preferredId)+(_r.direction&&_r.direction!=="sendrecv"?"/"+_r.direction:"")+" "+_r.uri+`\r
`},_t.parseFmtp=function(_r){const _o={};let _a;const _u=_r.substr(_r.indexOf(" ")+1).split(";");for(let Al=0;Al<_u.length;Al++){var yl,Rl;_a=xR(yl=_u[Al]).call(yl).split("="),_o[xR(Rl=_a[0]).call(Rl)]=_a[1]}return _o},_t.writeFmtp=function(_r){let _o="",_a=_r.payloadType;if(_r.preferredPayloadType!==void 0&&(_a=_r.preferredPayloadType),_r.parameters&&Object.keys(_r.parameters).length){const _u=[];Object.keys(_r.parameters).forEach(yl=>{_r.parameters[yl]!==void 0?_u.push(yl+"="+_r.parameters[yl]):_u.push(yl)}),_o+="a=fmtp:"+_a+" "+_u.join(";")+`\r
`}return _o},_t.parseRtcpFb=function(_r){const _o=_r.substr(_r.indexOf(" ")+1).split(" ");return{type:_o.shift(),parameter:_o.join(" ")}},_t.writeRtcpFb=function(_r){let _o="",_a=_r.payloadType;return _r.preferredPayloadType!==void 0&&(_a=_r.preferredPayloadType),_r.rtcpFeedback&&_r.rtcpFeedback.length&&_r.rtcpFeedback.forEach(_u=>{_o+="a=rtcp-fb:"+_a+" "+_u.type+(_u.parameter&&_u.parameter.length?" "+_u.parameter:"")+`\r
`}),_o},_t.parseSsrcMedia=function(_r){const _o=_r.indexOf(" "),_a={ssrc:parseInt(_r.substr(7,_o-7),10)},_u=_r.indexOf(":",_o);return _u>-1?(_a.attribute=_r.substr(_o+1,_u-_o-1),_a.value=_r.substr(_u+1)):_a.attribute=_r.substr(_o+1),_a},_t.parseSsrcGroup=function(_r){const _o=_r.substr(13).split(" ");return{semantics:_o.shift(),ssrcs:_o.map(_a=>parseInt(_a,10))}},_t.getMid=function(_r){const _o=_t.matchPrefix(_r,"a=mid:")[0];if(_o)return _o.substr(6)},_t.parseFingerprint=function(_r){const _o=_r.substr(14).split(" ");return{algorithm:_o[0].toLowerCase(),value:_o[1].toUpperCase()}},_t.getDtlsParameters=function(_r,_o){return{role:"auto",fingerprints:_t.matchPrefix(_r+_o,"a=fingerprint:").map(_t.parseFingerprint)}},_t.writeDtlsParameters=function(_r,_o){let _a="a=setup:"+_o+`\r
`;return _r.fingerprints.forEach(_u=>{_a+="a=fingerprint:"+_u.algorithm+" "+_u.value+`\r
`}),_a},_t.parseCryptoLine=function(_r){const _o=_r.substr(9).split(" ");return{tag:parseInt(_o[0],10),cryptoSuite:_o[1],keyParams:_o[2],sessionParams:_o.slice(3)}},_t.writeCryptoLine=function(_r){return"a=crypto:"+_r.tag+" "+_r.cryptoSuite+" "+(typeof _r.keyParams=="object"?_t.writeCryptoKeyParams(_r.keyParams):_r.keyParams)+(_r.sessionParams?" "+_r.sessionParams.join(" "):"")+`\r
`},_t.parseCryptoKeyParams=function(_r){if(_r.indexOf("inline:")!==0)return null;const _o=_r.substr(7).split("|");return{keyMethod:"inline",keySalt:_o[0],lifeTime:_o[1],mkiValue:_o[2]?_o[2].split(":")[0]:void 0,mkiLength:_o[2]?_o[2].split(":")[1]:void 0}},_t.writeCryptoKeyParams=function(_r){return _r.keyMethod+":"+_r.keySalt+(_r.lifeTime?"|"+_r.lifeTime:"")+(_r.mkiValue&&_r.mkiLength?"|"+_r.mkiValue+":"+_r.mkiLength:"")},_t.getCryptoParameters=function(_r,_o){return _t.matchPrefix(_r+_o,"a=crypto:").map(_t.parseCryptoLine)},_t.getIceParameters=function(_r,_o){const _a=_t.matchPrefix(_r+_o,"a=ice-ufrag:")[0],_u=_t.matchPrefix(_r+_o,"a=ice-pwd:")[0];return _a&&_u?{usernameFragment:_a.substr(12),password:_u.substr(10)}:null},_t.writeIceParameters=function(_r){let _o="a=ice-ufrag:"+_r.usernameFragment+`\r
a=ice-pwd:`+_r.password+`\r
`;return _r.iceLite&&(_o+=`a=ice-lite\r
`),_o},_t.parseRtpParameters=function(_r){const _o={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},_a=_t.splitLines(_r)[0].split(" ");for(let _u=3;_u<_a.length;_u++){const yl=_a[_u],Rl=_t.matchPrefix(_r,"a=rtpmap:"+yl+" ")[0];if(Rl){const Al=_t.parseRtpMap(Rl),Ol=_t.matchPrefix(_r,"a=fmtp:"+yl+" ");switch(Al.parameters=Ol.length?_t.parseFmtp(Ol[0]):{},Al.rtcpFeedback=_t.matchPrefix(_r,"a=rtcp-fb:"+yl+" ").map(_t.parseRtcpFb),_o.codecs.push(Al),Al.name.toUpperCase()){case"RED":case"ULPFEC":_o.fecMechanisms.push(Al.name.toUpperCase())}}}return _t.matchPrefix(_r,"a=extmap:").forEach(_u=>{_o.headerExtensions.push(_t.parseExtmap(_u))}),_o},_t.writeRtpDescription=function(_r,_o){let _a="";_a+="m="+_r+" ",_a+=_o.codecs.length>0?"9":"0",_a+=" UDP/TLS/RTP/SAVPF ",_a+=_o.codecs.map(yl=>yl.preferredPayloadType!==void 0?yl.preferredPayloadType:yl.payloadType).join(" ")+`\r
`,_a+=`c=IN IP4 0.0.0.0\r
`,_a+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,_o.codecs.forEach(yl=>{_a+=_t.writeRtpMap(yl),_a+=_t.writeFmtp(yl),_a+=_t.writeRtcpFb(yl)});let _u=0;return _o.codecs.forEach(yl=>{yl.maxptime>_u&&(_u=yl.maxptime)}),_u>0&&(_a+="a=maxptime:"+_u+`\r
`),_o.headerExtensions&&_o.headerExtensions.forEach(yl=>{_a+=_t.writeExtmap(yl)}),_a},_t.parseRtpEncodingParameters=function(_r){const _o=[],_a=_t.parseRtpParameters(_r),_u=_a.fecMechanisms.indexOf("RED")!==-1,yl=_a.fecMechanisms.indexOf("ULPFEC")!==-1,Rl=_t.matchPrefix(_r,"a=ssrc:").map(Bl=>_t.parseSsrcMedia(Bl)).filter(Bl=>Bl.attribute==="cname"),Al=Rl.length>0&&Rl[0].ssrc;let Ol;const xl=_t.matchPrefix(_r,"a=ssrc-group:FID").map(Bl=>Bl.substr(17).split(" ").map(Hl=>parseInt(Hl,10)));xl.length>0&&xl[0].length>1&&xl[0][0]===Al&&(Ol=xl[0][1]),_a.codecs.forEach(Bl=>{if(Bl.name.toUpperCase()==="RTX"&&Bl.parameters.apt){let Hl={ssrc:Al,codecPayloadType:parseInt(Bl.parameters.apt,10)};Al&&Ol&&(Hl.rtx={ssrc:Ol}),_o.push(Hl),_u&&(Hl=JSON.parse(JSON.stringify(Hl)),Hl.fec={ssrc:Al,mechanism:yl?"red+ulpfec":"red"},_o.push(Hl))}}),_o.length===0&&Al&&_o.push({ssrc:Al});let Ll=_t.matchPrefix(_r,"b=");return Ll.length&&(Ll=Ll[0].indexOf("b=TIAS:")===0?parseInt(Ll[0].substr(7),10):Ll[0].indexOf("b=AS:")===0?1e3*parseInt(Ll[0].substr(5),10)*.95-16e3:void 0,_o.forEach(Bl=>{Bl.maxBitrate=Ll})),_o},_t.parseRtcpParameters=function(_r){const _o={},_a=_t.matchPrefix(_r,"a=ssrc:").map(Rl=>_t.parseSsrcMedia(Rl)).filter(Rl=>Rl.attribute==="cname")[0];_a&&(_o.cname=_a.value,_o.ssrc=_a.ssrc);const _u=_t.matchPrefix(_r,"a=rtcp-rsize");_o.reducedSize=_u.length>0,_o.compound=_u.length===0;const yl=_t.matchPrefix(_r,"a=rtcp-mux");return _o.mux=yl.length>0,_o},_t.writeRtcpParameters=function(_r){let _o="";return _r.reducedSize&&(_o+=`a=rtcp-rsize\r
`),_r.mux&&(_o+=`a=rtcp-mux\r
`),_r.ssrc!==void 0&&_r.cname&&(_o+="a=ssrc:"+_r.ssrc+" cname:"+_r.cname+`\r
`),_o},_t.parseMsid=function(_r){let _o;const _a=_t.matchPrefix(_r,"a=msid:");if(_a.length===1)return _o=_a[0].substr(7).split(" "),{stream:_o[0],track:_o[1]};const _u=_t.matchPrefix(_r,"a=ssrc:").map(yl=>_t.parseSsrcMedia(yl)).filter(yl=>yl.attribute==="msid");return _u.length>0?(_o=_u[0].value.split(" "),{stream:_o[0],track:_o[1]}):void 0},_t.parseSctpDescription=function(_r){const _o=_t.parseMLine(_r),_a=_t.matchPrefix(_r,"a=max-message-size:");let _u;_a.length>0&&(_u=parseInt(_a[0].substr(19),10)),isNaN(_u)&&(_u=65536);const yl=_t.matchPrefix(_r,"a=sctp-port:");if(yl.length>0)return{port:parseInt(yl[0].substr(12),10),protocol:_o.fmt,maxMessageSize:_u};const Rl=_t.matchPrefix(_r,"a=sctpmap:");if(Rl.length>0){const Al=Rl[0].substr(10).split(" ");return{port:parseInt(Al[0],10),protocol:Al[1],maxMessageSize:_u}}},_t.writeSctpDescription=function(_r,_o){let _a=[];return _a=_r.protocol!=="DTLS/SCTP"?["m="+_r.kind+" 9 "+_r.protocol+" "+_o.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+_o.port+`\r
`]:["m="+_r.kind+" 9 "+_r.protocol+" "+_o.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+_o.port+" "+_o.protocol+` 65535\r
`],_o.maxMessageSize!==void 0&&_a.push("a=max-message-size:"+_o.maxMessageSize+`\r
`),_a.join("")},_t.generateSessionId=function(){return Math.random().toString().substr(2,21)},_t.writeSessionBoilerplate=function(_r,_o,_a){let _u;const yl=_o!==void 0?_o:2;return _u=_r||_t.generateSessionId(),`v=0\r
o=`+(_a||"thisisadapterortc")+" "+_u+" "+yl+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},_t.getDirection=function(_r,_o){const _a=_t.splitLines(_r);for(let _u=0;_u<_a.length;_u++)switch(_a[_u]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return _a[_u].substr(2)}return _o?_t.getDirection(_o):"sendrecv"},_t.getKind=function(_r){return _t.splitLines(_r)[0].split(" ")[0].substr(2)},_t.isRejected=function(_r){return _r.split(" ",2)[1]==="0"},_t.parseMLine=function(_r){const _o=_t.splitLines(_r)[0].substr(2).split(" ");return{kind:_o[0],port:parseInt(_o[1],10),protocol:_o[2],fmt:_o.slice(3).join(" ")}},_t.parseOLine=function(_r){const _o=_t.matchPrefix(_r,"o=")[0].substr(2).split(" ");return{username:_o[0],sessionId:_o[1],sessionVersion:parseInt(_o[2],10),netType:_o[3],addressType:_o[4],address:_o[5]}},_t.isValidSDP=function(_r){if(typeof _r!="string"||_r.length===0)return!1;const _o=_t.splitLines(_r);for(let _a=0;_a<_o.length;_a++)if(_o[_a].length<2||_o[_a].charAt(1)!=="=")return!1;return!0},_e.exports=_t})(R6);var YP=R6.exports,HQ=Object.freeze(g({__proto__:null,default:YP},[R6.exports]));function I5(_e){if(!_e.RTCIceCandidate||_e.RTCIceCandidate&&"foundation"in _e.RTCIceCandidate.prototype)return;const _t=_e.RTCIceCandidate;_e.RTCIceCandidate=function(_r){if(typeof _r=="object"&&_r.candidate&&_r.candidate.indexOf("a=")===0&&((_r=JSON.parse(JSON.stringify(_r))).candidate=_r.candidate.substr(2)),_r.candidate&&_r.candidate.length){const _o=new _t(_r),_a=YP.parseCandidate(_r.candidate),_u=Object.assign(_o,_a);return _u.toJSON=function(){return{candidate:_u.candidate,sdpMid:_u.sdpMid,sdpMLineIndex:_u.sdpMLineIndex,usernameFragment:_u.usernameFragment}},_u}return new _t(_r)},_e.RTCIceCandidate.prototype=_t.prototype,sT(_e,"icecandidate",_r=>(_r.candidate&&Object.defineProperty(_r,"candidate",{value:new _e.RTCIceCandidate(_r.candidate),writable:"false"}),_r))}function A6(_e){!_e.RTCIceCandidate||_e.RTCIceCandidate&&"relayProtocol"in _e.RTCIceCandidate.prototype||sT(_e,"icecandidate",_t=>{if(_t.candidate){const _r=YP.parseCandidate(_t.candidate.candidate);_r.type==="relay"&&(_t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[_r.priority>>24])}return _t})}function w5(_e,_t){if(!_e.RTCPeerConnection)return;"sctp"in _e.RTCPeerConnection.prototype||Object.defineProperty(_e.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const _r=function(Rl){if(!Rl||!Rl.sdp)return!1;const Al=YP.splitSections(Rl.sdp);return Al.shift(),Al.some(Ol=>{const xl=YP.parseMLine(Ol);return xl&&xl.kind==="application"&&xl.protocol.indexOf("SCTP")!==-1})},_o=function(Rl){const Al=Rl.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(Al===null||Al.length<2)return-1;const Ol=parseInt(Al[1],10);return Ol!=Ol?-1:Ol},_a=function(Rl){let Al=65536;return _t.browser==="firefox"&&(Al=_t.version<57?Rl===-1?16384:2147483637:_t.version<60?_t.version===57?65535:65536:2147483637),Al},_u=function(Rl,Al){let Ol=65536;_t.browser==="firefox"&&_t.version===57&&(Ol=65535);const xl=YP.matchPrefix(Rl.sdp,"a=max-message-size:");return xl.length>0?Ol=parseInt(xl[0].substr(19),10):_t.browser==="firefox"&&Al!==-1&&(Ol=2147483637),Ol},yl=_e.RTCPeerConnection.prototype.setRemoteDescription;_e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,_t.browser==="chrome"&&_t.version>=76){const{sdpSemantics:Rl}=this.getConfiguration();Rl==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(_r(arguments[0])){const Rl=_o(arguments[0]),Al=_a(Rl),Ol=_u(arguments[0],Rl);let xl;xl=Al===0&&Ol===0?Number.POSITIVE_INFINITY:Al===0||Ol===0?Math.max(Al,Ol):Math.min(Al,Ol);const Ll={};Object.defineProperty(Ll,"maxMessageSize",{get:()=>xl}),this._sctp=Ll}return yl.apply(this,arguments)}}function O5(_e){if(!_e.RTCPeerConnection||!("createDataChannel"in _e.RTCPeerConnection.prototype))return;function _t(_o,_a){const _u=_o.send;_o.send=function(){const yl=arguments[0],Rl=yl.length||yl.size||yl.byteLength;if(_o.readyState==="open"&&_a.sctp&&Rl>_a.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+_a.sctp.maxMessageSize+" bytes)");return _u.apply(_o,arguments)}}const _r=_e.RTCPeerConnection.prototype.createDataChannel;_e.RTCPeerConnection.prototype.createDataChannel=function(){const _o=_r.apply(this,arguments);return _t(_o,this),_o},sT(_e,"datachannel",_o=>(_t(_o.channel,_o.target),_o))}function I6(_e){if(!_e.RTCPeerConnection||"connectionState"in _e.RTCPeerConnection.prototype)return;const _t=_e.RTCPeerConnection.prototype;Object.defineProperty(_t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(_t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(_r){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),_r&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=_r)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(_r=>{const _o=_t[_r];_t[_r]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=_a=>{const _u=_a.target;if(_u._lastConnectionState!==_u.connectionState){_u._lastConnectionState=_u.connectionState;const yl=new Event("connectionstatechange",_a);_u.dispatchEvent(yl)}return _a},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),_o.apply(this,arguments)}})}function w6(_e,_t){if(!_e.RTCPeerConnection||_t.browser==="chrome"&&_t.version>=71||_t.browser==="safari"&&_t.version>=605)return;const _r=_e.RTCPeerConnection.prototype.setRemoteDescription;_e.RTCPeerConnection.prototype.setRemoteDescription=function(_o){if(_o&&_o.sdp&&_o.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const _a=_o.sdp.split(`
`).filter(_u=>xR(_u).call(_u)!=="a=extmap-allow-mixed").join(`
`);_e.RTCSessionDescription&&_o instanceof _e.RTCSessionDescription?arguments[0]=new _e.RTCSessionDescription({type:_o.type,sdp:_a}):_o.sdp=_a}return _r.apply(this,arguments)}}function C5(_e,_t){if(!_e.RTCPeerConnection||!_e.RTCPeerConnection.prototype)return;const _r=_e.RTCPeerConnection.prototype.addIceCandidate;_r&&_r.length!==0&&(_e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(_t.browser==="chrome"&&_t.version<78||_t.browser==="firefox"&&_t.version<68||_t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?u0.resolve():_r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),u0.resolve())})}function x5(_e,_t){if(!_e.RTCPeerConnection||!_e.RTCPeerConnection.prototype)return;const _r=_e.RTCPeerConnection.prototype.setLocalDescription;_r&&_r.length!==0&&(_e.RTCPeerConnection.prototype.setLocalDescription=function(){let _o=arguments[0]||{};if(typeof _o!="object"||_o.type&&_o.sdp)return _r.apply(this,arguments);if(_o={type:_o.type,sdp:_o.sdp},!_o.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":_o.type="offer";break;default:_o.type="answer"}return _o.sdp||_o.type!=="offer"&&_o.type!=="answer"?_r.apply(this,[_o]):(_o.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(_u=>_r.apply(this,[_u]))})}var KQ=Object.freeze({__proto__:null,shimRTCIceCandidate:I5,shimRTCIceCandidateRelayProtocol:A6,shimMaxMessageSize:w5,shimSendThrowTypeError:O5,shimConnectionState:I6,removeExtmapAllowMixed:w6,shimAddIceCandidateNullOrEmpty:C5,shimParameterlessSetLocalDescription:x5});let z_,fy;(function(){let{window:_e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},_t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const _r=lM,_o=DS(_e),_a={browserDetails:_o,commonShim:KQ,extractVersion:L1,disableLog:cM,disableWarnings:uM,sdp:HQ};switch(_o.browser){case"chrome":if(!wV||!E6||!_t.shimChrome)return _r("Chrome shim is not included in this adapter release."),_a;if(_o.version===null)return _r("Chrome shim can not determine version, not shimming."),_a;_r("adapter.js shimming chrome."),_a.browserShim=wV,C5(_e,_o),x5(_e),vV(_e,_o),EV(_e),E6(_e,_o),_V(_e),AV(_e,_o),bV(_e),TV(_e),SV(_e),IV(_e,_o),I5(_e),A6(_e),I6(_e),w5(_e,_o),O5(_e),w6(_e,_o);break;case"firefox":if(!jV||!_6||!_t.shimFirefox)return _r("Firefox shim is not included in this adapter release."),_a;_r("adapter.js shimming firefox."),_a.browserShim=jV,C5(_e,_o),x5(_e),OV(_e,_o),_6(_e,_o),CV(_e),PV(_e),xV(_e),kV(_e),NV(_e),LV(_e),DV(_e),MV(_e),UV(_e),I5(_e),I6(_e),w5(_e,_o),O5(_e);break;case"safari":if(!zV||!_t.shimSafari)return _r("Safari shim is not included in this adapter release."),_a;_r("adapter.js shimming safari."),_a.browserShim=zV,C5(_e,_o),x5(_e),WV(_e),KV(_e),$V(_e),FV(_e),BV(_e),HV(_e),VV(_e),qV(_e),I5(_e),A6(_e),w5(_e,_o),O5(_e),w6(_e,_o);break;default:_r("Unsupported browser!")}})({window:typeof window>"u"?void 0:window}),function(_e){_e.WIN_10="Windows 10",_e.WIN_81="Windows 8.1",_e.WIN_8="Windows 8",_e.WIN_7="Windows 7",_e.WIN_VISTA="Windows Vista",_e.WIN_SERVER_2003="Windows Server 2003",_e.WIN_XP="Windows XP",_e.WIN_2000="Windows 2000",_e.ANDROID="Android",_e.OPEN_BSD="Open BSD",_e.SUN_OS="Sun OS",_e.LINUX="Linux",_e.IOS="iOS",_e.MAC_OS="Mac OS",_e.QNX="QNX",_e.UNIX="UNIX",_e.BEOS="BeOS",_e.OS_2="OS/2",_e.SEARCH_BOT="Search Bot"}(z_||(z_={})),function(_e){_e.CHROME="Chrome",_e.SAFARI="Safari",_e.EDGE="Edge",_e.FIREFOX="Firefox",_e.OPERA="OPR",_e.QQ="QQBrowser",_e.WECHAT="MicroMessenger"}(fy||(fy={}));var O6={exports:{}};(function(_e,_t){(function(_r,_o){var _a="function",_u="undefined",yl="object",Rl="string",Al="major",Ol="model",xl="name",Ll="type",Bl="vendor",Hl="version",up="architecture",_f="console",vp="mobile",Dp="tablet",Bp="smarttv",_g="wearable",y0="embedded",e0="Amazon",r0="Apple",Zp="ASUS",h0="BlackBerry",_y="Firefox",k0="Google",Oy="Huawei",by="LG",Xy="Microsoft",P_="Motorola",zy="Opera",RT="Samsung",Vp="Sharp",Jp="Sony",s0="Xiaomi",O0="Zebra",Z0="Facebook",_m="Chromium OS",Fl="Mac OS",_h=function(Vy){for(var s_={},Ty=0;Ty<Vy.length;Ty++)s_[Vy[Ty].toUpperCase()]=Vy[Ty];return s_},Rp=function(Vy,s_){return typeof Vy===Rl&&zp(s_).indexOf(zp(Vy))!==-1},zp=function(Vy){return Vy.toLowerCase()},x0=function(Vy,s_){if(typeof Vy===Rl)return Vy=Vy.replace(/^\s\s*/,""),typeof s_===_u?Vy:Vy.substring(0,350)},Ry=function(Vy,s_){for(var Ty,fT,hR,Gy,J0,AT,A1=0;A1<s_.length&&!J0;){var WS=s_[A1],dX=s_[A1+1];for(Ty=fT=0;Ty<WS.length&&!J0&&WS[Ty];)if(J0=WS[Ty++].exec(Vy))for(hR=0;hR<dX.length;hR++)AT=J0[++fT],typeof(Gy=dX[hR])===yl&&Gy.length>0?Gy.length===2?typeof Gy[1]==_a?this[Gy[0]]=Gy[1].call(this,AT):this[Gy[0]]=Gy[1]:Gy.length===3?typeof Gy[1]!==_a||Gy[1].exec&&Gy[1].test?this[Gy[0]]=AT?AT.replace(Gy[1],Gy[2]):_o:this[Gy[0]]=AT?Gy[1].call(this,AT,Gy[2]):_o:Gy.length===4&&(this[Gy[0]]=AT?Gy[3].call(this,AT.replace(Gy[1],Gy[2])):_o):this[Gy]=AT||_o;A1+=2}},N_=function(Vy,s_){for(var Ty in s_)if(typeof s_[Ty]===yl&&s_[Ty].length>0){for(var fT=0;fT<s_[Ty].length;fT++)if(Rp(s_[Ty][fT],Vy))return Ty==="?"?_o:Ty}else if(Rp(s_[Ty],Vy))return Ty==="?"?_o:Ty;return Vy},xS={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},S1={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[Hl,[xl,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[Hl,[xl,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[xl,Hl],[/opios[\/ ]+([\w\.]+)/i],[Hl,[xl,"Opera Mini"]],[/\bopr\/([\w\.]+)/i],[Hl,[xl,zy]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[xl,Hl],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[Hl,[xl,"UCBrowser"]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[Hl,[xl,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[Hl,[xl,"WeChat"]],[/konqueror\/([\w\.]+)/i],[Hl,[xl,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[Hl,[xl,"IE"]],[/yabrowser\/([\w\.]+)/i],[Hl,[xl,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[xl,/(.+)/,"$1 Secure Browser"],Hl],[/\bfocus\/([\w\.]+)/i],[Hl,[xl,"Firefox Focus"]],[/\bopt\/([\w\.]+)/i],[Hl,[xl,"Opera Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[Hl,[xl,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[Hl,[xl,"Dolphin"]],[/coast\/([\w\.]+)/i],[Hl,[xl,"Opera Coast"]],[/miuibrowser\/([\w\.]+)/i],[Hl,[xl,"MIUI Browser"]],[/fxios\/([-\w\.]+)/i],[Hl,[xl,_y]],[/\bqihu|(qi?ho?o?|360)browser/i],[[xl,"360 Browser"]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[xl,/(.+)/,"$1 Browser"],Hl],[/(comodo_dragon)\/([\w\.]+)/i],[[xl,/_/g," "],Hl],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[xl,Hl],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[xl],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[xl,Z0],Hl],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[xl,Hl],[/\bgsa\/([\w\.]+) .*safari\//i],[Hl,[xl,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[Hl,[xl,"Chrome Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[xl,"Chrome WebView"],Hl],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[Hl,[xl,"Android Browser"]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[xl,Hl],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[Hl,[xl,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[Hl,xl],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[xl,[Hl,N_,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[xl,Hl],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[xl,"Netscape"],Hl],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[Hl,[xl,"Firefox Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[xl,Hl],[/(cobalt)\/([\w\.]+)/i],[xl,[Hl,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[up,"amd64"]],[/(ia32(?=;))/i],[[up,zp]],[/((?:i[346]|x)86)[;\)]/i],[[up,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[up,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[up,"armhf"]],[/windows (ce|mobile); ppc;/i],[[up,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[up,/ower/,"",zp]],[/(sun4\w)[;\)]/i],[[up,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[up,zp]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[Ol,[Bl,RT],[Ll,Dp]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[Ol,[Bl,RT],[Ll,vp]],[/\((ip(?:hone|od)[\w ]*);/i],[Ol,[Bl,r0],[Ll,vp]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[Ol,[Bl,r0],[Ll,Dp]],[/(macintosh);/i],[Ol,[Bl,r0]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[Ol,[Bl,Vp],[Ll,vp]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[Ol,[Bl,Oy],[Ll,Dp]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[Ol,[Bl,Oy],[Ll,vp]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[Ol,/_/g," "],[Bl,s0],[Ll,vp]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[Ol,/_/g," "],[Bl,s0],[Ll,Dp]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[Ol,[Bl,"OPPO"],[Ll,vp]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[Ol,[Bl,"Vivo"],[Ll,vp]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[Ol,[Bl,"Realme"],[Ll,vp]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[Ol,[Bl,P_],[Ll,vp]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[Ol,[Bl,P_],[Ll,Dp]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[Ol,[Bl,by],[Ll,Dp]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[Ol,[Bl,by],[Ll,vp]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[Ol,[Bl,"Lenovo"],[Ll,Dp]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[Ol,/_/g," "],[Bl,"Nokia"],[Ll,vp]],[/(pixel c)\b/i],[Ol,[Bl,k0],[Ll,Dp]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[Ol,[Bl,k0],[Ll,vp]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[Ol,[Bl,Jp],[Ll,vp]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[Ol,"Xperia Tablet"],[Bl,Jp],[Ll,Dp]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[Ol,[Bl,"OnePlus"],[Ll,vp]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[Ol,[Bl,e0],[Ll,Dp]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[Ol,/(.+)/g,"Fire Phone $1"],[Bl,e0],[Ll,vp]],[/(playbook);[-\w\),; ]+(rim)/i],[Ol,Bl,[Ll,Dp]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[Ol,[Bl,h0],[Ll,vp]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[Ol,[Bl,Zp],[Ll,Dp]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[Ol,[Bl,Zp],[Ll,vp]],[/(nexus 9)/i],[Ol,[Bl,"HTC"],[Ll,Dp]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[Bl,[Ol,/_/g," "],[Ll,vp]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[Ol,[Bl,"Acer"],[Ll,Dp]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[Ol,[Bl,"Meizu"],[Ll,vp]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[Bl,Ol,[Ll,vp]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[Bl,Ol,[Ll,Dp]],[/(surface duo)/i],[Ol,[Bl,Xy],[Ll,Dp]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[Ol,[Bl,"Fairphone"],[Ll,vp]],[/(u304aa)/i],[Ol,[Bl,"AT&T"],[Ll,vp]],[/\bsie-(\w*)/i],[Ol,[Bl,"Siemens"],[Ll,vp]],[/\b(rct\w+) b/i],[Ol,[Bl,"RCA"],[Ll,Dp]],[/\b(venue[\d ]{2,7}) b/i],[Ol,[Bl,"Dell"],[Ll,Dp]],[/\b(q(?:mv|ta)\w+) b/i],[Ol,[Bl,"Verizon"],[Ll,Dp]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[Ol,[Bl,"Barnes & Noble"],[Ll,Dp]],[/\b(tm\d{3}\w+) b/i],[Ol,[Bl,"NuVision"],[Ll,Dp]],[/\b(k88) b/i],[Ol,[Bl,"ZTE"],[Ll,Dp]],[/\b(nx\d{3}j) b/i],[Ol,[Bl,"ZTE"],[Ll,vp]],[/\b(gen\d{3}) b.+49h/i],[Ol,[Bl,"Swiss"],[Ll,vp]],[/\b(zur\d{3}) b/i],[Ol,[Bl,"Swiss"],[Ll,Dp]],[/\b((zeki)?tb.*\b) b/i],[Ol,[Bl,"Zeki"],[Ll,Dp]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[Bl,"Dragon Touch"],Ol,[Ll,Dp]],[/\b(ns-?\w{0,9}) b/i],[Ol,[Bl,"Insignia"],[Ll,Dp]],[/\b((nxa|next)-?\w{0,9}) b/i],[Ol,[Bl,"NextBook"],[Ll,Dp]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[Bl,"Voice"],Ol,[Ll,vp]],[/\b(lvtel\-)?(v1[12]) b/i],[[Bl,"LvTel"],Ol,[Ll,vp]],[/\b(ph-1) /i],[Ol,[Bl,"Essential"],[Ll,vp]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[Ol,[Bl,"Envizen"],[Ll,Dp]],[/\b(trio[-\w\. ]+) b/i],[Ol,[Bl,"MachSpeed"],[Ll,Dp]],[/\btu_(1491) b/i],[Ol,[Bl,"Rotor"],[Ll,Dp]],[/(shield[\w ]+) b/i],[Ol,[Bl,"Nvidia"],[Ll,Dp]],[/(sprint) (\w+)/i],[Bl,Ol,[Ll,vp]],[/(kin\.[onetw]{3})/i],[[Ol,/\./g," "],[Bl,Xy],[Ll,vp]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[Ol,[Bl,O0],[Ll,Dp]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[Ol,[Bl,O0],[Ll,vp]],[/smart-tv.+(samsung)/i],[Bl,[Ll,Bp]],[/hbbtv.+maple;(\d+)/i],[[Ol,/^/,"SmartTV"],[Bl,RT],[Ll,Bp]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[Bl,by],[Ll,Bp]],[/(apple) ?tv/i],[Bl,[Ol,"Apple TV"],[Ll,Bp]],[/crkey/i],[[Ol,"Chromecast"],[Bl,k0],[Ll,Bp]],[/droid.+aft(\w)( bui|\))/i],[Ol,[Bl,e0],[Ll,Bp]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[Ol,[Bl,Vp],[Ll,Bp]],[/(bravia[\w ]+)( bui|\))/i],[Ol,[Bl,Jp],[Ll,Bp]],[/(mitv-\w{5}) bui/i],[Ol,[Bl,s0],[Ll,Bp]],[/Hbbtv.*(technisat) (.*);/i],[Bl,Ol,[Ll,Bp]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[Bl,x0],[Ol,x0],[Ll,Bp]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[Ll,Bp]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[Bl,Ol,[Ll,_f]],[/droid.+; (shield) bui/i],[Ol,[Bl,"Nvidia"],[Ll,_f]],[/(playstation [345portablevi]+)/i],[Ol,[Bl,Jp],[Ll,_f]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[Ol,[Bl,Xy],[Ll,_f]],[/((pebble))app/i],[Bl,Ol,[Ll,_g]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[Ol,[Bl,r0],[Ll,_g]],[/droid.+; (glass) \d/i],[Ol,[Bl,k0],[Ll,_g]],[/droid.+; (wt63?0{2,3})\)/i],[Ol,[Bl,O0],[Ll,_g]],[/(quest( 2| pro)?)/i],[Ol,[Bl,Z0],[Ll,_g]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[Bl,[Ll,y0]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[Ol,[Ll,vp]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[Ol,[Ll,Dp]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[Ll,Dp]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[Ll,vp]],[/(android[-\w\. ]{0,9});.+buil/i],[Ol,[Bl,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[Hl,[xl,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[Hl,[xl,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[xl,Hl],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[Hl,xl]],os:[[/microsoft (windows) (vista|xp)/i],[xl,Hl],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[xl,[Hl,N_,xS]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[xl,"Windows"],[Hl,N_,xS]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[Hl,/_/g,"."],[xl,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[xl,Fl],[Hl,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[Hl,xl],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[xl,Hl],[/\(bb(10);/i],[Hl,[xl,h0]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[Hl,[xl,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[Hl,[xl,"Firefox OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[Hl,[xl,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[Hl,[xl,"watchOS"]],[/crkey\/([\d\.]+)/i],[Hl,[xl,"Chromecast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[xl,_m],Hl],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[xl,Hl],[/(sunos) ?([\w\.\d]*)/i],[[xl,"Solaris"],Hl],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[xl,Hl]]},mS=function(Vy,s_){if(typeof Vy===yl&&(s_=Vy,Vy=_o),!(this instanceof mS))return new mS(Vy,s_).getResult();var Ty=typeof _r!==_u&&_r.navigator?_r.navigator:_o,fT=Vy||(Ty&&Ty.userAgent?Ty.userAgent:""),hR=Ty&&Ty.userAgentData?Ty.userAgentData:_o,Gy=s_?function(J0,AT){var A1={};for(var WS in J0)AT[WS]&&AT[WS].length%2==0?A1[WS]=AT[WS].concat(J0[WS]):A1[WS]=J0[WS];return A1}(S1,s_):S1;return this.getBrowser=function(){var J0={};return J0.name=_o,J0.version=_o,Ry.call(J0,fT,Gy.browser),J0.major=function(AT){return typeof AT===Rl?AT.replace(/[^\d\.]/g,"").split(".")[0]:_o}(J0.version),Ty&&Ty.brave&&typeof Ty.brave.isBrave==_a&&(J0.name="Brave"),J0},this.getCPU=function(){var J0={};return J0.architecture=_o,Ry.call(J0,fT,Gy.cpu),J0},this.getDevice=function(){var J0={};return J0.vendor=_o,J0.model=_o,J0.type=_o,Ry.call(J0,fT,Gy.device),!J0.type&&hR&&hR.mobile&&(J0.type=vp),J0.model=="Macintosh"&&Ty&&typeof Ty.standalone!==_u&&Ty.maxTouchPoints&&Ty.maxTouchPoints>2&&(J0.model="iPad",J0.type=Dp),J0},this.getEngine=function(){var J0={};return J0.name=_o,J0.version=_o,Ry.call(J0,fT,Gy.engine),J0},this.getOS=function(){var J0={};return J0.name=_o,J0.version=_o,Ry.call(J0,fT,Gy.os),!J0.name&&hR&&hR.platform!="Unknown"&&(J0.name=hR.platform.replace(/chrome os/i,_m).replace(/macos/i,Fl)),J0},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return fT},this.setUA=function(J0){return fT=typeof J0===Rl&&J0.length>350?x0(J0,350):J0,this},this.setUA(fT),this};mS.VERSION="0.7.34",mS.BROWSER=_h([xl,Hl,Al]),mS.CPU=_h([up]),mS.DEVICE=_h([Ol,Bl,Ll,_f,vp,Bp,Dp,_g,y0]),mS.ENGINE=mS.OS=_h([xl,Hl]),_e.exports&&(_t=_e.exports=mS),_t.UAParser=mS;var R1=typeof _r!==_u&&(_r.jQuery||_r.Zepto);if(R1&&!R1.ua){var TN=new mS;R1.ua=TN.getResult(),R1.ua.get=function(){return TN.getUA()},R1.ua.set=function(Vy){TN.setUA(Vy);var s_=TN.getResult();for(var Ty in s_)R1.ua[Ty]=s_[Ty]}}})(typeof window=="object"?window:_)})(O6,O6.exports);const C6=new O6.exports;let bS,kR=C6.getResult();function gy(_e){return _e&&C6.setUA(_e),kR=C6.getResult(),{name:qQ(kR),version:zQ(kR),os:YQ(kR),osVersion:kR.os.version}}function qQ(_e){if(_e.engine.name==="Blink"&&_e.browser.name!=="WeChat")return fy.CHROME;switch(_e.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return fy.CHROME;case"Safari":case"Mobile Safari":return fy.SAFARI;case"Edge":return fy.EDGE;case"Firefox":return fy.FIREFOX;case"QQBrowser":return fy.QQ;case"Opera":return fy.OPERA;case"WeChat":return fy.WECHAT;default:return _e.browser.name||""}}function zQ(_e){let _t;return _t=_e.engine.name==="Blink"?_e.engine.version||"":_e.browser.version||"",_t.split(".")[0]}function YQ(_e){switch(_e.os.name){case"Windows":return _e.os.version?_e.os.name+" "+_e.os.version:_e.os.name;default:return _e.os.name||""}}function k5(){const _e=gy();return!!(kR.engine.name==="WebKit"&&_e.os===z_.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&_e.name!==fy.SAFARI||eT()&&_e.name!==fy.SAFARI)}function XQ(){const _e=gy();if(k5()){if(_e.os===z_.MAC_OS)return!0;if(_e.os===z_.IOS){const _t=kR.os.version&&kR.os.version.split(".");if(_t&&Number(_t[0])===14&&_t[1]&&Number(_t[1])>=3||_t&&Number(_t[0])>14)return!0}}return!1}function JQ(){return kR.engine.name==="WebKit"}function x6(){return gy().name===fy.CHROME}function _b(){return gy().name===fy.SAFARI}function Wy(){return gy().name===fy.FIREFOX}function eT(){return gy().os===z_.IOS}function k6(_e){const _t=gy();return!(_t.name!==fy.CHROME||!_t.osVersion)&&Number(_t.version)>=_e}function JV(_e){const _t=gy();return!(_t.name!==fy.EDGE||!_t.osVersion)&&Number(_t.version)>=_e}function QV(_e){const _t=gy();return!(_t.name!==fy.OPERA||!_t.osVersion)&&Number(_t.version)>=_e}function ZV(){const _e=gy();return!(_e.name!==fy.CHROME||!_e.osVersion)&&Number(_e.version)<=90}function e8(){const _e=gy();if(_e.os!==z_.IOS||!_e.osVersion)return!1;const _t=_e.osVersion.split(".");return Number(_t[0])<14||Number(_t[0])===14&&Number(_t[1])<=6}function XP(){const _e=gy();if(_e.os!==z_.IOS||!_e.osVersion)return!1;const _t=_e.osVersion.split(".");return Number(_t[0])===15}function t8(){const _e=gy();if(_e.os!==z_.IOS||!_e.osVersion)return!1;const _t=_e.osVersion.split(".");return Number(_t[0])===15&&Number(_t[1])===0}function n8(){const _e=gy();if(_e.os!==z_.IOS||!_e.osVersion)return!1;const _t=_e.osVersion.split(".");return Number(_t[0])===15&&Number(_t[1])>=1}function P6(){const _e=gy();if(_e.os!==z_.IOS||!_e.osVersion)return!1;const _t=_e.osVersion.split(".");return Number(_t[0])===15&&Number(_t[1])>=2}function rR(){return _b()&&navigator.maxTouchPoints>0}function r8(){return gy().name===fy.WECHAT}function i8(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function eO(){const _e=gy();return _e.name===fy.EDGE||_e.name===fy.SAFARI?!1:!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function N6(){return gy().os===z_.ANDROID}function t2(){const _e=gy();return _e.os==="Android"&&(_e.name==="Chrome"||_e.name===fy.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}(function(_e){_e.CERTIFICATE="certificate",_e.CODEC="codec",_e.CANDIDATE_PAIR="candidate-pair",_e.LOCAL_CANDIDATE="local-candidate",_e.REMOTE_CANDIDATE="remote-candidate",_e.INBOUND="inbound-rtp",_e.TRACK="track",_e.OUTBOUND="outbound-rtp",_e.PC="peer-connection",_e.REMOTE_INBOUND="remote-inbound-rtp",_e.REMOTE_OUTBOUND="remote-outbound-rtp",_e.TRANSPORT="transport",_e.CSRC="csrc",_e.DATA_CHANNEL="data-channel",_e.STREAM="stream",_e.SENDER="sender",_e.RECEIVER="receiver"})(bS||(bS={}));var o8={exports:{}},QQ=D_,ZQ=Ep,s8=UT.f;QQ({target:"Object",stat:!0,forced:Object.defineProperty!==s8,sham:!ZQ},{defineProperty:s8});var a8=vy.Object,eZ=o8.exports=function(_e,_t,_r){return a8.defineProperty(_e,_t,_r)};a8.defineProperty.sham&&(eZ.sham=!0);var c8=o8.exports;function Ml(_e,_t,_r){return _t in _e?c8(_e,_t,{value:_r,enumerable:!0,configurable:!0,writable:!0}):_e[_t]=_r,_e}var L6,D6={exports:{}},u8=function(_e,_t){return function(){for(var _r=new Array(arguments.length),_o=0;_o<_r.length;_o++)_r[_o]=arguments[_o];return _e.apply(_t,_r)}},tZ=u8,M6=Object.prototype.toString,U6=(L6=Object.create(null),function(_e){var _t=M6.call(_e);return L6[_t]||(L6[_t]=_t.slice(8,-1).toLowerCase())});function tO(_e){return _e=_e.toLowerCase(),function(_t){return U6(_t)===_e}}function j6(_e){return Array.isArray(_e)}function P5(_e){return _e===void 0}var l8=tO("ArrayBuffer");function d8(_e){return _e!==null&&typeof _e=="object"}function N5(_e){if(U6(_e)!=="object")return!1;var _t=Object.getPrototypeOf(_e);return _t===null||_t===Object.prototype}var nZ=tO("Date"),rZ=tO("File"),iZ=tO("Blob"),oZ=tO("FileList");function F6(_e){return M6.call(_e)==="[object Function]"}var sZ=tO("URLSearchParams");function B6(_e,_t){if(_e!=null)if(typeof _e!="object"&&(_e=[_e]),j6(_e))for(var _r=0,_o=_e.length;_r<_o;_r++)_t.call(null,_e[_r],_r,_e);else for(var _a in _e)Object.prototype.hasOwnProperty.call(_e,_a)&&_t.call(null,_e[_a],_a,_e)}var $6,aZ=($6=typeof Uint8Array<"u"&&Object.getPrototypeOf(Uint8Array),function(_e){return $6&&_e instanceof $6}),cT={isArray:j6,isArrayBuffer:l8,isBuffer:function(_e){return _e!==null&&!P5(_e)&&_e.constructor!==null&&!P5(_e.constructor)&&typeof _e.constructor.isBuffer=="function"&&_e.constructor.isBuffer(_e)},isFormData:function(_e){var _t="[object FormData]";return _e&&(typeof FormData=="function"&&_e instanceof FormData||M6.call(_e)===_t||F6(_e.toString)&&_e.toString()===_t)},isArrayBufferView:function(_e){return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(_e):_e&&_e.buffer&&l8(_e.buffer)},isString:function(_e){return typeof _e=="string"},isNumber:function(_e){return typeof _e=="number"},isObject:d8,isPlainObject:N5,isUndefined:P5,isDate:nZ,isFile:rZ,isBlob:iZ,isFunction:F6,isStream:function(_e){return d8(_e)&&F6(_e.pipe)},isURLSearchParams:sZ,isStandardBrowserEnv:function(){return(typeof navigator>"u"||navigator.product!=="ReactNative"&&navigator.product!=="NativeScript"&&navigator.product!=="NS")&&typeof window<"u"&&typeof document<"u"},forEach:B6,merge:function _e(){var _t={};function _r(_u,yl){N5(_t[yl])&&N5(_u)?_t[yl]=_e(_t[yl],_u):N5(_u)?_t[yl]=_e({},_u):j6(_u)?_t[yl]=_u.slice():_t[yl]=_u}for(var _o=0,_a=arguments.length;_o<_a;_o++)B6(arguments[_o],_r);return _t},extend:function(_e,_t,_r){return B6(_t,function(_o,_a){_e[_a]=_r&&typeof _o=="function"?tZ(_o,_r):_o}),_e},trim:function(_e){return _e.trim?_e.trim():_e.replace(/^\s+|\s+$/g,"")},stripBOM:function(_e){return _e.charCodeAt(0)===65279&&(_e=_e.slice(1)),_e},inherits:function(_e,_t,_r,_o){_e.prototype=Object.create(_t.prototype,_o),_e.prototype.constructor=_e,_r&&Object.assign(_e.prototype,_r)},toFlatObject:function(_e,_t,_r){var _o,_a,_u,yl={};_t=_t||{};do{for(_a=(_o=Object.getOwnPropertyNames(_e)).length;_a-- >0;)yl[_u=_o[_a]]||(_t[_u]=_e[_u],yl[_u]=!0);_e=Object.getPrototypeOf(_e)}while(_e&&(!_r||_r(_e,_t))&&_e!==Object.prototype);return _t},kindOf:U6,kindOfTest:tO,endsWith:function(_e,_t,_r){_e=String(_e),(_r===void 0||_r>_e.length)&&(_r=_e.length),_r-=_t.length;var _o=_e.indexOf(_t,_r);return _o!==-1&&_o===_r},toArray:function(_e){if(!_e)return null;var _t=_e.length;if(P5(_t))return null;for(var _r=new Array(_t);_t-- >0;)_r[_t]=_e[_t];return _r},isTypedArray:aZ,isFileList:oZ},QP=cT;function h8(_e){return encodeURIComponent(_e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var f8=function(_e,_t,_r){if(!_t)return _e;var _o;if(_r)_o=_r(_t);else if(QP.isURLSearchParams(_t))_o=_t.toString();else{var _a=[];QP.forEach(_t,function(yl,Rl){yl!=null&&(QP.isArray(yl)?Rl+="[]":yl=[yl],QP.forEach(yl,function(Al){QP.isDate(Al)?Al=Al.toISOString():QP.isObject(Al)&&(Al=JSON.stringify(Al)),_a.push(h8(Rl)+"="+h8(Al))}))}),_o=_a.join("&")}if(_o){var _u=_e.indexOf("#");_u!==-1&&(_e=_e.slice(0,_u)),_e+=(_e.indexOf("?")===-1?"?":"&")+_o}return _e},cZ=cT;function L5(){this.handlers=[]}L5.prototype.use=function(_e,_t,_r){return this.handlers.push({fulfilled:_e,rejected:_t,synchronous:!!_r&&_r.synchronous,runWhen:_r?_r.runWhen:null}),this.handlers.length-1},L5.prototype.eject=function(_e){this.handlers[_e]&&(this.handlers[_e]=null)},L5.prototype.forEach=function(_e){cZ.forEach(this.handlers,function(_t){_t!==null&&_e(_t)})};var uZ=L5,lZ=cT,p8=cT;function ZP(_e,_t,_r,_o,_a){Error.call(this),this.message=_e,this.name="AxiosError",_t&&(this.code=_t),_r&&(this.config=_r),_o&&(this.request=_o),_a&&(this.response=_a)}p8.inherits(ZP,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var g8=ZP.prototype,m8={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED"].forEach(function(_e){m8[_e]={value:_e}}),Object.defineProperties(ZP,m8),Object.defineProperty(g8,"isAxiosError",{value:!0}),ZP.from=function(_e,_t,_r,_o,_a,_u){var yl=Object.create(g8);return p8.toFlatObject(_e,yl,function(Rl){return Rl!==Error.prototype}),ZP.call(yl,_e.message,_t,_r,_o,_a),yl.name=_e.name,_u&&Object.assign(yl,_u),yl};var eN=ZP,y8={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},BS=cT,v8=function(_e,_t){_t=_t||new FormData;var _r=[];function _o(_a){return _a===null?"":BS.isDate(_a)?_a.toISOString():BS.isArrayBuffer(_a)||BS.isTypedArray(_a)?typeof Blob=="function"?new Blob([_a]):Buffer.from(_a):_a}return function _a(_u,yl){if(BS.isPlainObject(_u)||BS.isArray(_u)){if(_r.indexOf(_u)!==-1)throw Error("Circular reference detected in "+yl);_r.push(_u),BS.forEach(_u,function(Rl,Al){if(!BS.isUndefined(Rl)){var Ol,xl=yl?yl+"."+Al:Al;if(Rl&&!yl&&typeof Rl=="object"){if(BS.endsWith(Al,"{}"))Rl=JSON.stringify(Rl);else if(BS.endsWith(Al,"[]")&&(Ol=BS.toArray(Rl)))return void Ol.forEach(function(Ll){!BS.isUndefined(Ll)&&_t.append(xl,_o(Ll))})}_a(Rl,xl)}}),_r.pop()}else _t.append(yl,_o(_u))}(_e),_t},V6=eN,D5=cT,dZ=D5.isStandardBrowserEnv()?{write:function(_e,_t,_r,_o,_a,_u){var yl=[];yl.push(_e+"="+encodeURIComponent(_t)),D5.isNumber(_r)&&yl.push("expires="+new Date(_r).toGMTString()),D5.isString(_o)&&yl.push("path="+_o),D5.isString(_a)&&yl.push("domain="+_a),_u===!0&&yl.push("secure"),document.cookie=yl.join("; ")},read:function(_e){var _t=document.cookie.match(new RegExp("(^|;\\s*)("+_e+")=([^;]*)"));return _t?decodeURIComponent(_t[3]):null},remove:function(_e){this.write(_e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}},hZ=function(_e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(_e)},fZ=function(_e,_t){return _t?_e.replace(/\/+$/,"")+"/"+_t.replace(/^\/+/,""):_e},E8=function(_e,_t){return _e&&!hZ(_t)?fZ(_e,_t):_t},G6=cT,pZ=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"],_8=cT,gZ=_8.isStandardBrowserEnv()?function(){var _e,_t=/(msie|trident)/i.test(navigator.userAgent),_r=document.createElement("a");function _o(_a){var _u=_a;return _t&&(_r.setAttribute("href",_u),_u=_r.href),_r.setAttribute("href",_u),{href:_r.href,protocol:_r.protocol?_r.protocol.replace(/:$/,""):"",host:_r.host,search:_r.search?_r.search.replace(/^\?/,""):"",hash:_r.hash?_r.hash.replace(/^#/,""):"",hostname:_r.hostname,port:_r.port,pathname:_r.pathname.charAt(0)==="/"?_r.pathname:"/"+_r.pathname}}return _e=_o(window.location.href),function(_a){var _u=_8.isString(_a)?_o(_a):_a;return _u.protocol===_e.protocol&&_u.host===_e.host}}():function(){return!0},W6=eN;function T8(_e){W6.call(this,_e??"canceled",W6.ERR_CANCELED),this.name="CanceledError"}cT.inherits(T8,W6,{__CANCEL__:!0});var M5=T8,n2=cT,mZ=function(_e,_t,_r){var _o=_r.config.validateStatus;_r.status&&_o&&!_o(_r.status)?_t(new V6("Request failed with status code "+_r.status,[V6.ERR_BAD_REQUEST,V6.ERR_BAD_RESPONSE][Math.floor(_r.status/100)-4],_r.config,_r.request,_r)):_e(_r)},yZ=dZ,vZ=f8,EZ=E8,_Z=function(_e){var _t,_r,_o,_a={};return _e&&G6.forEach(_e.split(`
`),function(_u){if(_o=_u.indexOf(":"),_t=G6.trim(_u.substr(0,_o)).toLowerCase(),_r=G6.trim(_u.substr(_o+1)),_t){if(_a[_t]&&pZ.indexOf(_t)>=0)return;_a[_t]=_t==="set-cookie"?(_a[_t]?_a[_t]:[]).concat([_r]):_a[_t]?_a[_t]+", "+_r:_r}}),_a},bZ=gZ,TZ=y8,PR=eN,SZ=M5,RZ=function(_e){var _t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(_e);return _t&&_t[1]||""},AZ=function(_e){return new Promise(function(_t,_r){var _o,_a=_e.data,_u=_e.headers,yl=_e.responseType;function Rl(){_e.cancelToken&&_e.cancelToken.unsubscribe(_o),_e.signal&&_e.signal.removeEventListener("abort",_o)}n2.isFormData(_a)&&n2.isStandardBrowserEnv()&&delete _u["Content-Type"];var Al=new XMLHttpRequest;if(_e.auth){var Ol=_e.auth.username||"",xl=_e.auth.password?unescape(encodeURIComponent(_e.auth.password)):"";_u.Authorization="Basic "+btoa(Ol+":"+xl)}var Ll=EZ(_e.baseURL,_e.url);function Bl(){if(Al){var _f="getAllResponseHeaders"in Al?_Z(Al.getAllResponseHeaders()):null,vp={data:yl&&yl!=="text"&&yl!=="json"?Al.response:Al.responseText,status:Al.status,statusText:Al.statusText,headers:_f,config:_e,request:Al};mZ(function(Dp){_t(Dp),Rl()},function(Dp){_r(Dp),Rl()},vp),Al=null}}if(Al.open(_e.method.toUpperCase(),vZ(Ll,_e.params,_e.paramsSerializer),!0),Al.timeout=_e.timeout,"onloadend"in Al?Al.onloadend=Bl:Al.onreadystatechange=function(){Al&&Al.readyState===4&&(Al.status!==0||Al.responseURL&&Al.responseURL.indexOf("file:")===0)&&setTimeout(Bl)},Al.onabort=function(){Al&&(_r(new PR("Request aborted",PR.ECONNABORTED,_e,Al)),Al=null)},Al.onerror=function(){_r(new PR("Network Error",PR.ERR_NETWORK,_e,Al,Al)),Al=null},Al.ontimeout=function(){var _f=_e.timeout?"timeout of "+_e.timeout+"ms exceeded":"timeout exceeded",vp=_e.transitional||TZ;_e.timeoutErrorMessage&&(_f=_e.timeoutErrorMessage),_r(new PR(_f,vp.clarifyTimeoutError?PR.ETIMEDOUT:PR.ECONNABORTED,_e,Al)),Al=null},n2.isStandardBrowserEnv()){var Hl=(_e.withCredentials||bZ(Ll))&&_e.xsrfCookieName?yZ.read(_e.xsrfCookieName):void 0;Hl&&(_u[_e.xsrfHeaderName]=Hl)}"setRequestHeader"in Al&&n2.forEach(_u,function(_f,vp){_a===void 0&&vp.toLowerCase()==="content-type"?delete _u[vp]:Al.setRequestHeader(vp,_f)}),n2.isUndefined(_e.withCredentials)||(Al.withCredentials=!!_e.withCredentials),yl&&yl!=="json"&&(Al.responseType=_e.responseType),typeof _e.onDownloadProgress=="function"&&Al.addEventListener("progress",_e.onDownloadProgress),typeof _e.onUploadProgress=="function"&&Al.upload&&Al.upload.addEventListener("progress",_e.onUploadProgress),(_e.cancelToken||_e.signal)&&(_o=function(_f){Al&&(_r(!_f||_f&&_f.type?new SZ:_f),Al.abort(),Al=null)},_e.cancelToken&&_e.cancelToken.subscribe(_o),_e.signal&&(_e.signal.aborted?_o():_e.signal.addEventListener("abort",_o))),_a||(_a=null);var up=RZ(Ll);up&&["http","https","file"].indexOf(up)===-1?_r(new PR("Unsupported protocol "+up+":",PR.ERR_BAD_REQUEST,_e)):Al.send(_a)})},tT=cT,S8=function(_e,_t){lZ.forEach(_e,function(_r,_o){_o!==_t&&_o.toUpperCase()===_t.toUpperCase()&&(_e[_t]=_r,delete _e[_o])})},R8=eN,IZ=v8,wZ={"Content-Type":"application/x-www-form-urlencoded"};function A8(_e,_t){!tT.isUndefined(_e)&&tT.isUndefined(_e["Content-Type"])&&(_e["Content-Type"]=_t)}var I8,U5={transitional:y8,adapter:((typeof XMLHttpRequest<"u"||typeof process<"u"&&Object.prototype.toString.call(process)==="[object process]")&&(I8=AZ),I8),transformRequest:[function(_e,_t){if(S8(_t,"Accept"),S8(_t,"Content-Type"),tT.isFormData(_e)||tT.isArrayBuffer(_e)||tT.isBuffer(_e)||tT.isStream(_e)||tT.isFile(_e)||tT.isBlob(_e))return _e;if(tT.isArrayBufferView(_e))return _e.buffer;if(tT.isURLSearchParams(_e))return A8(_t,"application/x-www-form-urlencoded;charset=utf-8"),_e.toString();var _r,_o=tT.isObject(_e),_a=_t&&_t["Content-Type"];if((_r=tT.isFileList(_e))||_o&&_a==="multipart/form-data"){var _u=this.env&&this.env.FormData;return IZ(_r?{"files[]":_e}:_e,_u&&new _u)}return _o||_a==="application/json"?(A8(_t,"application/json"),function(yl,Rl,Al){if(tT.isString(yl))try{return(Rl||JSON.parse)(yl),tT.trim(yl)}catch(Ol){if(Ol.name!=="SyntaxError")throw Ol}return(Al||JSON.stringify)(yl)}(_e)):_e}],transformResponse:[function(_e){var _t=this.transitional||U5.transitional,_r=_t&&_t.silentJSONParsing,_o=_t&&_t.forcedJSONParsing,_a=!_r&&this.responseType==="json";if(_a||_o&&tT.isString(_e)&&_e.length)try{return JSON.parse(_e)}catch(_u){if(_a)throw _u.name==="SyntaxError"?R8.from(_u,R8.ERR_BAD_RESPONSE,this,null,this.response):_u}return _e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:null},validateStatus:function(_e){return _e>=200&&_e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};tT.forEach(["delete","get","head"],function(_e){U5.headers[_e]={}}),tT.forEach(["post","put","patch"],function(_e){U5.headers[_e]=tT.merge(wZ)});var H6=U5,OZ=cT,CZ=H6,w8=function(_e){return!(!_e||!_e.__CANCEL__)},O8=cT,K6=function(_e,_t,_r){var _o=this||CZ;return OZ.forEach(_r,function(_a){_e=_a.call(_o,_e,_t)}),_e},xZ=w8,kZ=H6,PZ=M5;function q6(_e){if(_e.cancelToken&&_e.cancelToken.throwIfRequested(),_e.signal&&_e.signal.aborted)throw new PZ}var oS=cT,C8=function(_e,_t){_t=_t||{};var _r={};function _o(Ol,xl){return oS.isPlainObject(Ol)&&oS.isPlainObject(xl)?oS.merge(Ol,xl):oS.isPlainObject(xl)?oS.merge({},xl):oS.isArray(xl)?xl.slice():xl}function _a(Ol){return oS.isUndefined(_t[Ol])?oS.isUndefined(_e[Ol])?void 0:_o(void 0,_e[Ol]):_o(_e[Ol],_t[Ol])}function _u(Ol){if(!oS.isUndefined(_t[Ol]))return _o(void 0,_t[Ol])}function yl(Ol){return oS.isUndefined(_t[Ol])?oS.isUndefined(_e[Ol])?void 0:_o(void 0,_e[Ol]):_o(void 0,_t[Ol])}function Rl(Ol){return Ol in _t?_o(_e[Ol],_t[Ol]):Ol in _e?_o(void 0,_e[Ol]):void 0}var Al={url:_u,method:_u,data:_u,baseURL:yl,transformRequest:yl,transformResponse:yl,paramsSerializer:yl,timeout:yl,timeoutMessage:yl,withCredentials:yl,adapter:yl,responseType:yl,xsrfCookieName:yl,xsrfHeaderName:yl,onUploadProgress:yl,onDownloadProgress:yl,decompress:yl,maxContentLength:yl,maxBodyLength:yl,beforeRedirect:yl,transport:yl,httpAgent:yl,httpsAgent:yl,cancelToken:yl,socketPath:yl,responseEncoding:yl,validateStatus:Rl};return oS.forEach(Object.keys(_e).concat(Object.keys(_t)),function(Ol){var xl=Al[Ol]||_a,Ll=xl(Ol);oS.isUndefined(Ll)&&xl!==Rl||(_r[Ol]=Ll)}),_r},x8="0.27.2",NZ=x8,u1=eN,z6={};["object","boolean","number","function","string","symbol"].forEach(function(_e,_t){z6[_e]=function(_r){return typeof _r===_e||"a"+(_t<1?"n ":" ")+_e}});var k8={};z6.transitional=function(_e,_t,_r){function _o(_a,_u){return"[Axios v"+NZ+"] Transitional option '"+_a+"'"+_u+(_r?". "+_r:"")}return function(_a,_u,yl){if(_e===!1)throw new u1(_o(_u," has been removed"+(_t?" in "+_t:"")),u1.ERR_DEPRECATED);return _t&&!k8[_u]&&(k8[_u]=!0,console.warn(_o(_u," has been deprecated since v"+_t+" and will be removed in the near future"))),!_e||_e(_a,_u,yl)}};var P8=cT,LZ=f8,N8=uZ,L8=function(_e){return q6(_e),_e.headers=_e.headers||{},_e.data=K6.call(_e,_e.data,_e.headers,_e.transformRequest),_e.headers=O8.merge(_e.headers.common||{},_e.headers[_e.method]||{},_e.headers),O8.forEach(["delete","get","head","post","put","patch","common"],function(_t){delete _e.headers[_t]}),(_e.adapter||kZ.adapter)(_e).then(function(_t){return q6(_e),_t.data=K6.call(_e,_t.data,_t.headers,_e.transformResponse),_t},function(_t){return xZ(_t)||(q6(_e),_t&&_t.response&&(_t.response.data=K6.call(_e,_t.response.data,_t.response.headers,_e.transformResponse))),Promise.reject(_t)})},j5=C8,DZ=E8,D8={assertOptions:function(_e,_t,_r){if(typeof _e!="object")throw new u1("options must be an object",u1.ERR_BAD_OPTION_VALUE);for(var _o=Object.keys(_e),_a=_o.length;_a-- >0;){var _u=_o[_a],yl=_t[_u];if(yl){var Rl=_e[_u],Al=Rl===void 0||yl(Rl,_u,_e);if(Al!==!0)throw new u1("option "+_u+" must be "+Al,u1.ERR_BAD_OPTION_VALUE)}else if(_r!==!0)throw new u1("Unknown option "+_u,u1.ERR_BAD_OPTION)}},validators:z6},tN=D8.validators;function nN(_e){this.defaults=_e,this.interceptors={request:new N8,response:new N8}}nN.prototype.request=function(_e,_t){typeof _e=="string"?(_t=_t||{}).url=_e:_t=_e||{},(_t=j5(this.defaults,_t)).method?_t.method=_t.method.toLowerCase():this.defaults.method?_t.method=this.defaults.method.toLowerCase():_t.method="get";var _r=_t.transitional;_r!==void 0&&D8.assertOptions(_r,{silentJSONParsing:tN.transitional(tN.boolean),forcedJSONParsing:tN.transitional(tN.boolean),clarifyTimeoutError:tN.transitional(tN.boolean)},!1);var _o=[],_a=!0;this.interceptors.request.forEach(function(Ll){typeof Ll.runWhen=="function"&&Ll.runWhen(_t)===!1||(_a=_a&&Ll.synchronous,_o.unshift(Ll.fulfilled,Ll.rejected))});var _u,yl=[];if(this.interceptors.response.forEach(function(Ll){yl.push(Ll.fulfilled,Ll.rejected)}),!_a){var Rl=[L8,void 0];for(Array.prototype.unshift.apply(Rl,_o),Rl=Rl.concat(yl),_u=Promise.resolve(_t);Rl.length;)_u=_u.then(Rl.shift(),Rl.shift());return _u}for(var Al=_t;_o.length;){var Ol=_o.shift(),xl=_o.shift();try{Al=Ol(Al)}catch(Ll){xl(Ll);break}}try{_u=L8(Al)}catch(Ll){return Promise.reject(Ll)}for(;yl.length;)_u=_u.then(yl.shift(),yl.shift());return _u},nN.prototype.getUri=function(_e){_e=j5(this.defaults,_e);var _t=DZ(_e.baseURL,_e.url);return LZ(_t,_e.params,_e.paramsSerializer)},P8.forEach(["delete","get","head","options"],function(_e){nN.prototype[_e]=function(_t,_r){return this.request(j5(_r||{},{method:_e,url:_t,data:(_r||{}).data}))}}),P8.forEach(["post","put","patch"],function(_e){function _t(_r){return function(_o,_a,_u){return this.request(j5(_u||{},{method:_e,headers:_r?{"Content-Type":"multipart/form-data"}:{},url:_o,data:_a}))}}nN.prototype[_e]=_t(),nN.prototype[_e+"Form"]=_t(!0)});var MZ=nN,UZ=M5;function rN(_e){if(typeof _e!="function")throw new TypeError("executor must be a function.");var _t;this.promise=new Promise(function(_o){_t=_o});var _r=this;this.promise.then(function(_o){if(_r._listeners){var _a,_u=_r._listeners.length;for(_a=0;_a<_u;_a++)_r._listeners[_a](_o);_r._listeners=null}}),this.promise.then=function(_o){var _a,_u=new Promise(function(yl){_r.subscribe(yl),_a=yl}).then(_o);return _u.cancel=function(){_r.unsubscribe(_a)},_u},_e(function(_o){_r.reason||(_r.reason=new UZ(_o),_t(_r.reason))})}rN.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},rN.prototype.subscribe=function(_e){this.reason?_e(this.reason):this._listeners?this._listeners.push(_e):this._listeners=[_e]},rN.prototype.unsubscribe=function(_e){if(this._listeners){var _t=this._listeners.indexOf(_e);_t!==-1&&this._listeners.splice(_t,1)}},rN.source=function(){var _e;return{token:new rN(function(_t){_e=_t}),cancel:_e}};var jZ=rN,FZ=cT,M8=cT,BZ=u8,F5=MZ,$Z=C8,$T=function _e(_t){var _r=new F5(_t),_o=BZ(F5.prototype.request,_r);return M8.extend(_o,F5.prototype,_r),M8.extend(_o,_r),_o.create=function(_a){return _e($Z(_t,_a))},_o}(H6);$T.Axios=F5,$T.CanceledError=M5,$T.CancelToken=jZ,$T.isCancel=w8,$T.VERSION=x8,$T.toFormData=v8,$T.AxiosError=eN,$T.Cancel=$T.CanceledError,$T.all=function(_e){return Promise.all(_e)},$T.spread=function(_e){return function(_t){return _e.apply(null,_t)}},$T.isAxiosError=function(_e){return FZ.isObject(_e)&&_e.isAxiosError===!0},D6.exports=$T,D6.exports.default=$T;var TS=D6.exports;class VZ{constructor(_t){Ml(this,"logger",void 0),Ml(this,"prefixLists",[]),this.logger=_t}debug(){for(var _t=arguments.length,_r=new Array(_t),_o=0;_o<_t;_o++)_r[_o]=arguments[_o];this.logger.debug(...this.prefixLists,..._r)}info(){for(var _t=arguments.length,_r=new Array(_t),_o=0;_o<_t;_o++)_r[_o]=arguments[_o];this.logger.info(...this.prefixLists,..._r)}warning(){for(var _t=arguments.length,_r=new Array(_t),_o=0;_o<_t;_o++)_r[_o]=arguments[_o];this.logger.warning(...this.prefixLists,..._r)}error(){for(var _t=arguments.length,_r=new Array(_t),_o=0;_o<_t;_o++)_r[_o]=arguments[_o];this.logger.error(...this.prefixLists,..._r)}prefix(_t){return this.prefixLists.push(_t),this}popPrefix(){return this.prefixLists.pop(),this}}class Hy{constructor(){Ml(this,"_events",{}),Ml(this,"addListener",this.on)}getListeners(_t){return this._events[_t]?this._events[_t].map(_r=>_r.listener):[]}on(_t,_r){this._events[_t]||(this._events[_t]=[]);const _o=this._events[_t];this._indexOfListener(_o,_r)===-1&&_o.push({listener:_r,once:!1})}once(_t,_r){this._events[_t]||(this._events[_t]=[]);const _o=this._events[_t];this._indexOfListener(_o,_r)===-1&&_o.push({listener:_r,once:!0})}off(_t,_r){if(!this._events[_t])return;const _o=this._events[_t],_a=this._indexOfListener(_o,_r);_a!==-1&&_o.splice(_a,1),this._events[_t].length===0&&delete this._events[_t]}removeAllListeners(_t){_t?delete this._events[_t]:this._events={}}emit(_t){this._events[_t]||(this._events[_t]=[]);const _r=this._events[_t].map(yl=>yl);for(var _o=arguments.length,_a=new Array(_o>1?_o-1:0),_u=1;_u<_o;_u++)_a[_u-1]=arguments[_u];for(let yl=0;yl<_r.length;yl+=1){const Rl=_r[yl];Rl.once&&this.off(_t,Rl.listener),Rl.listener.apply(this,_a||[])}}_indexOfListener(_t,_r){let _o=_t.length;for(;_o--;)if(_t[_o].listener===_r)return _o;return-1}}const B5=new class extends Hy{reportLogUploadError(_e){this.emit("REPORT_LOG_UPLOAD",_e)}};let Ql;(function(_e){_e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",_e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",_e.TIMEOUT="TIMEOUT",_e.INVALID_PARAMS="INVALID_PARAMS",_e.NOT_READABLE="NOT_READABLE",_e.NOT_SUPPORTED="NOT_SUPPORTED",_e.INVALID_OPERATION="INVALID_OPERATION",_e.OPERATION_ABORTED="OPERATION_ABORTED",_e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",_e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",_e.NETWORK_ERROR="NETWORK_ERROR",_e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",_e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",_e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",_e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",_e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",_e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",_e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",_e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",_e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",_e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",_e.PERMISSION_DENIED="PERMISSION_DENIED",_e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",_e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",_e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",_e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",_e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",_e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",_e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",_e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",_e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",_e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",_e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",_e.UID_CONFLICT="UID_CONFLICT",_e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",_e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",_e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",_e.INVALID_TRACK="INVALID_TRACK",_e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",_e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",_e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",_e.ICE_FAILED="ICE_FAILED",_e.PC_CLOSED="PC_CLOSED",_e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",_e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",_e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",_e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",_e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",_e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",_e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",_e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",_e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",_e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",_e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",_e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",_e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",_e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",_e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",_e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",_e.WS_ABORT="WS_ABORT",_e.WS_DISCONNECT="WS_DISCONNECT",_e.WS_ERR="WS_ERR",_e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",_e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",_e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",_e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",_e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",_e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",_e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",_e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",_e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",_e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",_e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",_e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",_e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",_e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",_e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",_e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",_e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",_e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",_e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",_e.INVALID_PLUGIN="INVALID_PLUGIN",_e.DISCONNECT_P2P="DISCONNECT_P2P",_e.INIT_WEBSOCKET_TIMEOUT="INIT_WEBSOCKET_TIMEOUT",_e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",_e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",_e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",_e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",_e.PROHIBITED_OPERATION="PROHIBITED_OPERATION"})(Ql||(Ql={}));class Tp extends Error{constructor(_t){let _r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",_o=arguments.length>2?arguments[2]:void 0;super(_r),Ml(this,"code",void 0),Ml(this,"message",void 0),Ml(this,"data",void 0),Ml(this,"name","AgoraRTCException"),this.code=_t,this.message="AgoraRTCError ".concat(this.code,": ").concat(_r),this.data=_o}toString(){return this.data?"data: ".concat(JSON.stringify(this.data),`
`).concat(this.stack):"".concat(this.stack)}print(){let _t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return _t==="error"&&Vl.error(this.toString()),_t==="warning"&&Vl.warning(this.toString()),this}throw(){throw this.print(),this}}const h_={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function Y6(_e,_t){const _r=Math.floor(_t.timeout*Math.pow(_t.timeoutFactor,_e));return Math.min(_t.maxRetryTimeout,_r)}function iR(_e,_t,_r,_o){const _a=Object.assign({},h_,_o);let _u=_a.timeout;const yl=async()=>{await function(Ol){return new u0(xl=>{window.setTimeout(xl,Ol)})}(_u),_u*=_a.timeoutFactor,_u=Math.min(_a.maxRetryTimeout,_u)};let Rl=!1;const Al=new u0(async(Ol,xl)=>{_t=_t||(()=>!1),_r=_r||(()=>!0);for(let Ll=0;Ll<_a.maxRetryCount;Ll+=1){if(Rl)return xl(new Tp(Ql.OPERATION_ABORTED));try{const Bl=await _e();if(!_t(Bl,Ll)||Ll+1===_a.maxRetryCount)return Ol(Bl);await yl()}catch(Bl){if(!_r(Bl,Ll)||Ll+1===_a.maxRetryCount)return xl(Bl);await yl()}}});return Al.cancel=()=>Rl=!0,Al}function X6(){const _e=new Date;return _e.toTimeString().split(" ")[0]+":"+_e.getMilliseconds()}function U8(){const _e=new Date,_t=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return _t?(_t==null?void 0:_t[0])+":"+_e.getUTCMilliseconds():_e.toTimeString().split(" ")[0]+":"+_e.getMilliseconds()}const sS={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},$5=Date.now(),r2=_e=>{for(const _t in sS)if(Object.prototype.hasOwnProperty.call(sS,_t)&&sS[_t]===_e)return _t;return"DEFAULT"},Vl=new class{constructor(){Ml(this,"proxyServerURL",void 0),Ml(this,"logLevel",sS.DEBUG),Ml(this,"uploadState","collecting"),Ml(this,"uploadLogWaitingList",[]),Ml(this,"uploadLogUploadingList",[]),Ml(this,"uploadErrorCount",0),Ml(this,"currentLogID",0),Ml(this,"url",void 0),Ml(this,"extLog",(_e,_t)=>{this.appendLogToWaitingList(_e,..._t)})}debug(){for(var _e=arguments.length,_t=new Array(_e),_r=0;_r<_e;_r++)_t[_r]=arguments[_r];const _o=[sS.DEBUG].concat(_t);this.log.apply(this,_o)}info(){for(var _e=arguments.length,_t=new Array(_e),_r=0;_r<_e;_r++)_t[_r]=arguments[_r];const _o=[sS.INFO].concat(_t);this.log.apply(this,_o)}warning(){for(var _e=arguments.length,_t=new Array(_e),_r=0;_r<_e;_r++)_t[_r]=arguments[_r];const _o=[sS.WARNING].concat(_t);this.log.apply(this,_o)}error(){for(var _e=arguments.length,_t=new Array(_e),_r=0;_r<_e;_r++)_t[_r]=arguments[_r];const _o=[sS.ERROR].concat(_t);this.log.apply(this,_o)}upload(){for(var _e=arguments.length,_t=new Array(_e),_r=0;_r<_e;_r++)_t[_r]=arguments[_r];const _o=[sS.DEBUG].concat(_t);this.uploadLog.apply(this,_o)}setLogLevel(_e){_e=Math.min(Math.max(0,_e),4),this.logLevel=_e}enableLogUpload(){Ey("UPLOAD_LOG",!0)}disableLogUpload(){Ey("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(_e){this.proxyServerURL=_e}prefix(_e){return new VZ(this).prefix(_e)}log(){for(var _e=arguments.length,_t=new Array(_e),_r=0;_r<_e;_r++)_t[_r]=arguments[_r];if(Date.now()-$5<100)return void setTimeout(()=>{this.log(..._t)},Date.now()-$5);const _o=Math.max(0,Math.min(4,_t[0]));if(_t[0]=X6()+" Agora-SDK [".concat(r2(_o),"]:"),this.appendLogToWaitingList(_o,..._t),_o<this.logLevel)return;const _a=X6()+" %cAgora-SDK [".concat(r2(_o),"]:");let _u=[];if(!Pp("USE_NEW_LOG"))switch(_o){case sS.DEBUG:_u=[_a,"color: #64B5F6;"].concat(_t.slice(1)),console.log.apply(console,_u);break;case sS.INFO:_u=[_a,"color: #1E88E5; font-weight: bold;"].concat(_t.slice(1)),console.log.apply(console,_u);break;case sS.WARNING:_u=[_a,"color: #FB8C00; font-weight: bold;"].concat(_t.slice(1)),console.warn.apply(console,_u);break;case sS.ERROR:_u=[_a,"color: #B00020; font-weight: bold;"].concat(_t.slice(1)),console.error.apply(console,_u)}}uploadLog(){for(var _e=arguments.length,_t=new Array(_e),_r=0;_r<_e;_r++)_t[_r]=arguments[_r];if(Date.now()-$5<100)return void setTimeout(()=>{this.uploadLog(..._t)},Date.now()-$5);const _o=Math.max(0,Math.min(4,_t[0]));_t[0]=X6()+" Agora-SDK [".concat(r2(_o),"]:"),this.appendLogToWaitingList(_o,..._t)}appendLogToWaitingList(_e){if(!Pp("UPLOAD_LOG"))return;for(var _t=arguments.length,_r=new Array(_t>1?_t-1:0),_o=1;_o<_t;_o++)_r[_o-1]=arguments[_o];Array.isArray(_r[0])?_r[0][0]=U8()+" Agora-SDK [".concat(r2(_e),"]:"):_r[0]=U8()+" Agora-SDK [".concat(r2(_e),"]:");let _a="";_r.forEach(_u=>{typeof _u=="object"&&(_u=JSON.stringify(_u)),_a+="".concat(_u," ")}),this.uploadLogWaitingList.push({payload_str:_a,log_level:_e,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const _e=this.uploadLogUploadingList,_t={sdk_version:aS,process_id:Pp("PROCESS_ID"),payload:JSON.stringify(_e)};return iR(async()=>{const _r=await TS.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(Pp("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(Pp("LOG_UPLOAD_SERVER"),"/upload/v1")),_t,{responseType:"text"});if(_r.data!=="OK"){const _o=new Error("unexpected upload log response");throw _o.response=_r,_o}},()=>(this.uploadLogUploadingList=[],!1),_r=>(_r.response?B5.reportLogUploadError({status:_r.response.status,data:_r.response.data,headers:_r.response.headers,message:_r.message}):_r.request?B5.reportLogUploadError({status:_r.request.status,message:_r.message}):B5.reportLogUploadError({status:-1,message:_r.message}),!0),{timeout:Pp("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:Pp("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,Pp("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),Pp("UPLOAD_LOG_INTERVAL"))}).catch(_e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),Pp("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),Pp("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}},J6="v4.17.1-0-gab544cc9-dirty(4/14/2023, 6:27:40 PM)",aS=function(_e){if(_e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return _e;const _t=_e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-alpha\.([0-9]+)/);if(_t&&_t[1]&&_t[2]){const _o=_t[1],_a=_t[2];return"".concat(_o,".").concat(_a)}const _r=_e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-special\.([0-9]+)/);if(_r&&_r[1]&&_r[2]){const _o=_r[1],_a=_r[2];return"".concat(_o,".").concat(100*(Number(_a)+1))}return"4.0.0.999"}("4.17.1"),Q6=function(){try{return JSON.parse("true")===!0}catch{return!0}}(),j8=["CHINA","GLOBAL"],VT=function(){const _e="us".concat("erna","me"),_t="pa".concat("sswo","rd"),_r=["t","s","t"];_r.splice(1,0,"e");const _o=_r.join(""),_a=[];for(let Rl=0;Rl<6;Rl++)_a.push("1");const _u=_a.join(""),yl={};return yl[_e]=_o,yl[_t]=_u,Object.assign(yl,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=VT;const GZ={"90p":z0(160,90),"90p_1":z0(160,90),"120p":z0(160,120,15,30,65),"120p_1":z0(160,120,15,30,65),"120p_3":z0(120,120,15,30,50),"120p_4":z0(212,120),"180p":z0(320,180,15,30,140),"180p_1":z0(320,180,15,30,140),"180p_3":z0(180,180,15,30,100),"180p_4":z0(240,180,15,30,120),"240p":z0(320,240,15,40,200),"240p_1":z0(320,240,15,40,200),"240p_3":z0(240,240,15,40,140),"240p_4":z0(424,240,15,40,220),"360p":z0(640,360,15,80,400),"360p_1":z0(640,360,15,80,400),"360p_3":z0(360,360,15,80,260),"360p_4":z0(640,360,30,80,600),"360p_6":z0(360,360,30,80,400),"360p_7":z0(480,360,15,80,320),"360p_8":z0(480,360,30,80,490),"360p_9":z0(640,360,15,80,800),"360p_10":z0(640,360,24,80,800),"360p_11":z0(640,360,24,80,1e3),"480p":z0(640,480,15,100,500),"480p_1":z0(640,480,15,100,500),"480p_2":z0(640,480,30,100,1e3),"480p_3":z0(480,480,15,100,400),"480p_4":z0(640,480,30,100,750),"480p_6":z0(480,480,30,100,600),"480p_8":z0(848,480,15,100,610),"480p_9":z0(848,480,30,100,930),"480p_10":z0(640,480,10,100,400),"720p":z0(1280,720,15,120,1130),"720p_1":z0(1280,720,15,120,1130),"720p_2":z0(1280,720,30,120,2e3),"720p_3":z0(1280,720,30,120,1710),"720p_5":z0(960,720,15,120,910),"720p_6":z0(960,720,30,120,1380),"1080p":z0(1920,1080,15,120,2080),"1080p_1":z0(1920,1080,15,120,2080),"1080p_2":z0(1920,1080,30,120,3e3),"1080p_3":z0(1920,1080,30,120,3150),"1080p_5":z0(1920,1080,60,120,4780),"1440p":z0(2560,1440,30,120,4850),"1440p_1":z0(2560,1440,30,120,4850),"1440p_2":z0(2560,1440,60,120,7350),"4k":z0(3840,2160,30,120,8910),"4k_1":z0(3840,2160,30,120,8910),"4k_3":z0(3840,2160,60,120,13500)},WZ={"480p":SS(640,480,5),"480p_1":SS(640,480,5),"480p_2":SS(640,480,30),"480p_3":SS(640,480,15),"720p":SS(1280,720,5),"720p_1":SS(1280,720,5),"720p_2":SS(1280,720,30),"720p_3":SS(1280,720,15),"1080p":SS(1920,1080,5),"1080p_1":SS(1920,1080,5),"1080p_2":SS(1920,1080,30),"1080p_3":SS(1920,1080,15)},HZ={"1SL1TL":e4(1,1),"3SL3TL":e4(3,3),"2SL3TL":e4(2,3)};function nO(_e){return _e||(_e="480p_1"),typeof _e=="string"?Object.assign({},GZ[_e]):_e}function Z6(_e){return typeof _e=="string"?Object.assign({},WZ[_e]):_e}function V5(_e){return typeof _e=="string"?Object.assign({},HZ[_e]):_e}const KZ={speech_low_quality:iN(16e3,!1),speech_standard:iN(32e3,!1,18),music_standard:iN(48e3,!1),standard_stereo:iN(48e3,!0,56),high_quality:iN(48e3,!1,128),high_quality_stereo:iN(48e3,!0,192)};function G5(_e){return typeof _e=="string"?Object.assign({},KZ[_e]):_e}function Ey(_e,_t,_r){Object.keys(vT).includes(_e)&&(!_r&&Object.keys(rO).includes(_e)||(vT[_e]=_t))}function Pp(_e){return vT[_e]}const vT={PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:j8,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",ENABLE_EVENT_REPORT:!0,GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,UPLOAD_LOG:!1,NOT_REPORT_EVENT:[],SUBSCRIBE_TWCC:!1,PUBLISH_TWCC:!1,PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],WORKER_DOMAIN:"edge.agora.io",TURN_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,USE_RTX:!1,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_WITH_FALLBACK_PROXY_PENDING_DURATION:2e3,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!0,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,ENABLE_USER_LICENSE_CHECK:!0,SIGNAL_CHANNEL:0,TRANSMITTER_INITIAL_RTT:30,TRANSMITTER_INITIAL_RTO:30,TRANSMITTER_MAX_BATCH_ACK_COUNT:2,TRANSMITTER_MAX_RTO:500,DATACHANNEL_COMPRESS:!1,FINGERPRINT:null,DC_JOIN_WITH_FAILBACK:5e3,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,AV_SYNC:!0,BLOCK_LOCAL_CLIENT:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0}},rO={};function iN(_e,_t,_r){return{sampleRate:_e,stereo:_t,bitrate:_r}}function z0(_e,_t,_r,_o,_a){return{width:_e,height:_t,frameRate:_r,bitrateMin:_o,bitrateMax:_a}}function SS(_e,_t,_r,_o,_a){return{width:{max:_e},height:{max:_t},frameRate:_r,bitrateMin:_o,bitrateMax:_a}}function e4(_e,_t){return{numSpatialLayers:_e,numTemporalLayers:_t}}Q6||(vT.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],vT.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],vT.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],vT.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],vT.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],vT.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],vT.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",vT.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",vT.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",vT.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",vT.AREAS=["NORTH_AMERICA","OVERSEA"]);const qZ=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],iO=[],i2=[];function oO(_e,_t){return!!_t&&iO.some(_r=>_r.uid===_e&&_r.channelName===_t)}var zZ=YS,YZ=UT,XZ=Fp,t4=function(_e,_t,_r){var _o=zZ(_t);_o in _e?YZ.f(_e,_o,XZ(0,_r)):_e[_o]=_r},F8=HO,JZ=LS,QZ=t4,ZZ=Sl.Array,eee=Math.max,B8=function(_e,_t,_r){for(var _o=JZ(_e),_a=F8(_t,_o),_u=F8(_r===void 0?_o:_r,_o),yl=ZZ(eee(_u-_a,0)),Rl=0;_a<_u;_a++,Rl++)QZ(yl,Rl,_e[_a]);return yl.length=Rl,yl},$8=B8,tee=Math.floor,n4=function(_e,_t){var _r=_e.length,_o=tee(_r/2);return _r<8?nee(_e,_t):ree(_e,n4($8(_e,0,_o),_t),n4($8(_e,_o),_t),_t)},nee=function(_e,_t){for(var _r,_o,_a=_e.length,_u=1;_u<_a;){for(_o=_u,_r=_e[_u];_o&&_t(_e[_o-1],_r)>0;)_e[_o]=_e[--_o];_o!==_u++&&(_e[_o]=_r)}return _e},ree=function(_e,_t,_r,_o){for(var _a=_t.length,_u=_r.length,yl=0,Rl=0;yl<_a||Rl<_u;)_e[yl+Rl]=yl<_a&&Rl<_u?_o(_t[yl],_r[Rl])<=0?_t[yl++]:_r[Rl++]:yl<_a?_t[yl++]:_r[Rl++];return _e},iee=n4,V8=KS.match(/firefox\/(\d+)/i),oee=!!V8&&+V8[1],see=/MSIE|Trident/.test(KS),G8=KS.match(/AppleWebKit\/(\d+)\./),aee=!!G8&&+G8[1],cee=D_,W8=xa,uee=JT,lee=kS,dee=LS,H8=_A,r4=j,hee=iee,fee=wO,K8=oee,pee=see,q8=Iy,z8=aee,l1=[],Y8=W8(l1.sort),gee=W8(l1.push),mee=r4(function(){l1.sort(void 0)}),yee=r4(function(){l1.sort(null)}),vee=fee("sort"),X8=!r4(function(){if(q8)return q8<70;if(!(K8&&K8>3)){if(pee)return!0;if(z8)return z8<603;var _e,_t,_r,_o,_a="";for(_e=65;_e<76;_e++){switch(_t=String.fromCharCode(_e),_e){case 66:case 69:case 70:case 72:_r=3;break;case 68:case 71:_r=4;break;default:_r=2}for(_o=0;_o<47;_o++)l1.push({k:_t+_o,v:_r})}for(l1.sort(function(_u,yl){return yl.v-_u.v}),_o=0;_o<l1.length;_o++)_t=l1[_o].k.charAt(0),_a.charAt(_a.length-1)!==_t&&(_a+=_t);return _a!=="DGBEFHACIJK"}});cee({target:"Array",proto:!0,forced:mee||!yee||!vee||!X8},{sort:function(_e){_e!==void 0&&uee(_e);var _t=lee(this);if(X8)return _e===void 0?Y8(_t):Y8(_t,_e);var _r,_o,_a=[],_u=dee(_t);for(_o=0;_o<_u;_o++)_o in _t&&gee(_a,_t[_o]);for(hee(_a,function(yl){return function(Rl,Al){return Al===void 0?-1:Rl===void 0?1:yl!==void 0?+yl(Rl,Al)||0:H8(Rl)>H8(Al)?1:-1}}(_e)),_r=_a.length,_o=0;_o<_r;)_t[_o]=_a[_o++];for(;_o<_u;)delete _t[_o++];return _t}});var Eee=tS("Array").sort,_ee=El,bee=Eee,i4=Array.prototype,o4=function(_e){var _t=_e.sort;return _e===i4||_ee(i4,_e)&&_t===i4.sort?bee:_t};function o2(_e,_t){if(typeof _e!="boolean")throw new Tp(Ql.INVALID_PARAMS,"Invalid ".concat(_t,": The value is of the boolean type."))}function __(_e,_t,_r){if(!_r.includes(_e))throw new Tp(Ql.INVALID_PARAMS,"".concat(_t," can only be set as ").concat(JSON.stringify(_r)))}function wy(_e,_t){let _r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,_o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4,_a=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(_e<_r||_e>_o||_a&&!Tee(_e))throw new Tp(Ql.INVALID_PARAMS,"invalid ".concat(_t,": the value range is [").concat(_r,", ").concat(_o,"]. integer only"))}function s4(_e,_t){if(typeof _e!="number"){if(!(_e.min||_e.max||_e.ideal||_e.exact))throw new Tp(Ql.INVALID_PARAMS,"".concat(_t," is not a valid ConstrainLong"));_e.min!==void 0&&wy(_e.min,"".concat(_t,".min"),0,1/0),_e.max!==void 0&&wy(_e.max,"".concat(_t,".max"),1,1/0),_e.exact!==void 0&&wy(_e.exact,"".concat(_t,".exact"),1,1/0),_e.ideal!==void 0&&wy(_e.ideal,"".concat(_t,".ideal"),1,1/0)}else wy(_e,_t,1,1/0)}function U_(_e,_t){let _r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,_o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,_a=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(_e==null)throw new Tp(Ql.INVALID_PARAMS,"".concat(_t||"param"," cannot be empty"));if(!J8(_e,_r,_o,_a))throw new Tp(Ql.INVALID_PARAMS,"Invalid ".concat(_t||"string param",": Length of the string: [").concat(_r,",").concat(_o,"].").concat(_a?" ASCII characters only.":""))}function NR(_e,_t){if(!Array.isArray(_e))throw new Tp(Ql.INVALID_PARAMS,"".concat(_t," should be an array"))}function a4(_e){if(typeof _e!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(_e))throw Vl.error("Invalid Channel Name ".concat(_e)),new Tp(Ql.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function c4(_e){if(_t=_e,!(typeof _t=="number"&&Math.floor(_t)===_t&&0<=_t&&_t<=4294967295||J8(_e,1,255)))throw Vl.error("Invalid UID ".concat(_e," ").concat(typeof _e)),new Tp(Ql.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var _t;typeof _e=="string"&&Vl.warning("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}function Py(_e){return _e==null}function J8(_e){let _t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,_r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,_o=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof _e=="string"&&_e.length<=_r&&_e.length>=_t&&(!_o||See(_e))}function Tee(_e){return typeof _e=="number"&&_e%1==0}function See(_e){if(typeof _e!="string")return!1;for(let _t=0;_t<_e.length;_t+=1){const _r=_e.charCodeAt(_t);if(_r<0||_r>255)return!1}return!0}let Q8,Z8,j_;(function(_e){_e.FREE="free",_e.UPLOADING="uploading"})(Q8||(Q8={})),function(_e){_e[_e.MISC=0]="MISC",_e[_e.INTERNAL_EVENT=1]="INTERNAL_EVENT",_e[_e.PUBLIC_EVENT=2]="PUBLIC_EVENT",_e[_e.WEB_EVENT=3]="WEB_EVENT",_e[_e.INTERNAL_API=4]="INTERNAL_API",_e[_e.WEB_API=5]="WEB_API",_e[_e.PUBLIC_API=6]="PUBLIC_API"}(Z8||(Z8={})),function(_e){_e.NONE="none",_e.INIT="init",_e.CANPLAY="canplay",_e.PLAYING="playing",_e.PAUSED="paused",_e.SUSPEND="suspend",_e.STALLED="stalled",_e.WAITING="waiting",_e.ERROR="error",_e.DESTROYED="destroyed",_e.ABORT="abort",_e.ENDED="ended",_e.EMPTIED="emptied",_e.LOADEDDATA="loadeddata"}(j_||(j_={}));const u4={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};function Ree(_e){return U_(_e.reportId,"params.reportId",0,100,!1),U_(_e.category,"params.category",0,100,!1),U_(_e.event,"params.event",0,100,!1),U_(_e.label,"params.label",0,100,!1),wy(_e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}const Aee={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let F_,Fy,e7,l4,c_,jy,sO,LR,oN,s2,GT,B_,E0,d4,cy,W0,uT,py,p0,I0,ET,U0,t7,_T;function n7(_e){return wy(_e.timeout,"config.timeout",0,1e5),wy(_e.timeoutFactor,"config.timeoutFactor",0,100,!1),wy(_e.maxRetryCount,"config.maxRetryConfig",0,1/0),wy(_e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}function Iee(_e){return __(_e.codec,"config.codec",["vp8","vp9","av1","h264"]),__(_e.mode,"config.mode",["rtc","live"]),_e.audioCodec!==void 0&&__(_e.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),_e.proxyServer!==void 0&&U_(_e.proxyServer,"config.proxyServer",1,1e4),_e.turnServer!==void 0&&r7(_e.turnServer),_e.httpRetryConfig!==void 0&&n7(_e.httpRetryConfig),_e.websocketRetryConfig!==void 0&&n7(_e.websocketRetryConfig),!0}function a2(_e){if(!Array.isArray(_e)||_e.length<1)return!1;try{_e.forEach(_t=>{if(!_t.urls)throw Error()})}catch{return!1}return!0}function r7(_e){return U_(_e.turnServerURL,"turnServerURL"),U_(_e.username,"username"),U_(_e.password,"password"),_e.udpport&&wy(_e.udpport,"udpport",1,99999,!0),_e.forceturn&&o2(_e.forceturn,"forceturn"),_e.security&&o2(_e.security,"security"),_e.tcpport&&wy(_e.tcpport,"tcpport",1,99999,!0),!0}function i7(_e){return _e.level!==void 0&&__(_e.level,"level",[1,2,3]),!0}(function(_e){_e.PUBLISH="publish",_e.SUBSCRIBE="subscribe",_e.WS_COMPRESSOR_INIT="ws_compressor_init",_e.SESSION_INIT="session_init",_e.JOIN_CHOOSE_SERVER="join_choose_server",_e.REQ_USER_ACCOUNT="req_user_account",_e.JOIN_GATEWAY="join_gateway",_e.REJOIN_GATEWAY="rejoin_gateway",_e.STREAM_SWITCH="stream_switch",_e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",_e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",_e.FIRST_VIDEO_RECEIVED="first_video_received",_e.FIRST_AUDIO_RECEIVED="first_audio_received",_e.FIRST_VIDEO_DECODE="first_video_decode",_e.FIRST_AUDIO_DECODE="first_audio_decode",_e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",_e.ON_ADD_VIDEO_STREAM="on_add_video_stream",_e.ON_UPDATE_STREAM="on_update_stream",_e.ON_REMOVE_STREAM="on_remove_stream",_e.USER_ANALYTICS="req_user_analytics"})(F_||(F_={})),function(_e){_e.SESSION="io.agora.pb.Wrtc.Session",_e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",_e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",_e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",_e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",_e.PUBLISH="io.agora.pb.Wrtc.Publish",_e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",_e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",_e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",_e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",_e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",_e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",_e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",_e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",_e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",_e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",_e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",_e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",_e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",_e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",_e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",_e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",_e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",_e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",_e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",_e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",_e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",_e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",_e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",_e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed"}(Fy||(Fy={})),function(_e){_e[_e.WORKER_EVENT=156]="WORKER_EVENT",_e[_e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"}(e7||(e7={})),function(_e){_e[_e.SESSION=26]="SESSION",_e[_e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",_e[_e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",_e[_e.JOIN_GATEWAY=28]="JOIN_GATEWAY",_e[_e.PUBLISH=30]="PUBLISH",_e[_e.SUBSCRIBE=29]="SUBSCRIBE",_e[_e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",_e[_e.STREAM_SWITCH=32]="STREAM_SWITCH",_e[_e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",_e[_e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",_e[_e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",_e[_e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",_e[_e.API_INVOKE=41]="API_INVOKE",_e[_e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",_e[_e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",_e[_e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",_e[_e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",_e[_e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",_e[_e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",_e[_e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",_e[_e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",_e[_e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",_e[_e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",_e[_e.WORKER_EVENT=156]="WORKER_EVENT",_e[_e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",_e[_e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",_e[_e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",_e[_e.USER_ANALYTICS=1e4]="USER_ANALYTICS",_e[_e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED"}(l4||(l4={})),function(_e){_e.CREATE_CLIENT="createClient",_e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",_e.SET_AREA="setArea",_e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",_e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",_e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",_e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",_e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",_e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",_e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",_e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",_e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",_e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",_e.START_PROXY_SERVER="Client.startProxyServer",_e.STOP_PROXY_SERVER="Client.stopProxyServer",_e.SET_PROXY_SERVER="Client.setProxyServer",_e.SET_TURN_SERVER="Client.setTurnServer",_e.SET_CLIENT_ROLE="Client.setClientRole",_e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",_e.ENABLE_DUAL_STREAM="Client.enableDualStream",_e.DISABLE_DUAL_STREAM="Client.disableDualStream",_e.JOIN="Client.join",_e.LEAVE="Client.leave",_e.PUBLISH="Client.publish",_e.UNPUBLISH="Client.unpublish",_e.SUBSCRIBE="Client.subscribe",_e.MASS_SUBSCRIBE="Client.massSubscribe",_e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",_e.UNSUBSCRIBE="Client.unsubscribe",_e.RENEW_TOKEN="Client.renewToken",_e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",_e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",_e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",_e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",_e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",_e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",_e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",_e.DATACHANNEL_FAILBACK="Client._datachannelFailback",_e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",_e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",_e.START_LIVE_STREAMING="Client.startLiveStreaming",_e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",_e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",_e.ADD_INJECT_STREAM_URL="Client.addInjectStreamUrl",_e.REMOVE_INJECT_STREAM_URL="Client.removeInjectStreamUrl",_e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",_e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",_e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",_e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",_e.SET_CONFIG_DISTRIBUTE="_configDistribute",_e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",_e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",_e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",_e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",_e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",_e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",_e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",_e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",_e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",_e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",_e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",_e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",_e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",_e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",_e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",_e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",_e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",_e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",_e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",_e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",_e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",_e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",_e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",_e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",_e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",_e.STREAM_TYPE_CHANGE="streamTypeChange",_e.CONNECTION_STATE_CHANGE="connectionStateChange",_e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage"}(c_||(c_={})),function(_e){_e.TRACER="tracer"}(jy||(jy={})),function(_e){_e.IDLE="IDLE",_e.INITING="INITING",_e.INITEND="INITEND"}(sO||(sO={})),function(_e){_e.STATE_CHANGE="state_change",_e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",_e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",_e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged"}(LR||(LR={})),function(_e){_e[_e.ACCESS_POINT=101]="ACCESS_POINT",_e[_e.UNILBS=201]="UNILBS",_e[_e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR"}(oN||(oN={})),function(_e){_e[_e.IIIEGAL_APPID=1]="IIIEGAL_APPID",_e[_e.IIIEGAL_UID=2]="IIIEGAL_UID",_e[_e.INTERNAL_ERROR=3]="INTERNAL_ERROR"}(s2||(s2={})),function(_e){_e[_e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",_e[_e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",_e[_e.INTERNAL_ERROR=8]="INTERNAL_ERROR",_e[_e.NO_AUTHORIZED=9]="NO_AUTHORIZED",_e[_e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",_e[_e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",_e[_e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",_e[_e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",_e[_e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",_e[_e.USER_OVERLOAD=16]="USER_OVERLOAD",_e[_e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",_e[_e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND"}(GT||(GT={})),function(_e){_e[_e.NO_FLAG_SET=100]="NO_FLAG_SET",_e[_e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",_e[_e.INVALID_FALG_SET=102]="INVALID_FALG_SET",_e[_e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",_e[_e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",_e[_e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",_e[_e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",_e[_e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",_e[_e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",_e[_e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",_e[_e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",_e[_e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",_e[_e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",_e[_e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",_e[_e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",_e[_e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",_e[_e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",_e[_e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",_e[_e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV"}(B_||(B_={})),function(_e){_e[_e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",_e[_e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",_e[_e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",_e[_e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",_e[_e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",_e[_e.K_TICKET_INVALID=7]="K_TICKET_INVALID",_e[_e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",_e[_e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",_e[_e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",_e[_e.K_UID_BANNED=14]="K_UID_BANNED",_e[_e.K_IP_BANNED=15]="K_IP_BANNED",_e[_e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",_e[_e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",_e[_e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",_e[_e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",_e[_e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",_e[_e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",_e[_e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",_e[_e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",_e[_e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",_e[_e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",_e[_e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",_e[_e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",_e[_e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",_e[_e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",_e[_e.ERR_INVALID_UID=117]="ERR_INVALID_UID",_e[_e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",_e[_e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",_e[_e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",_e[_e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",_e[_e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",_e[_e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",_e[_e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",_e[_e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",_e[_e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",_e[_e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",_e[_e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",_e[_e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",_e[_e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",_e[_e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",_e[_e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",_e[_e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",_e[_e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",_e[_e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",_e[_e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",_e[_e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",_e[_e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",_e[_e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",_e[_e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",_e[_e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",_e[_e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",_e[_e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",_e[_e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",_e[_e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",_e[_e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",_e[_e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",_e[_e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",_e[_e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",_e[_e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",_e[_e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",_e[_e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",_e[_e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",_e[_e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY"}(E0||(E0={})),function(_e){_e[_e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",_e[_e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",_e[_e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY"}(d4||(d4={})),function(_e){_e.LEAVE="LEAVE",_e.NETWORK_ERROR="NETWORK_ERROR",_e.SERVER_ERROR="SERVER_ERROR",_e.UID_BANNED="UID_BANNED",_e.IP_BANNED="IP_BANNED",_e.CHANNEL_BANNED="CHANNEL_BANNED",_e.FALLBACK="FALLBACK",_e.LICENSE_MISSING="LICENSE_MISSING",_e.LICENSE_EXPIRED="LICENSE_EXPIRED",_e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",_e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",_e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",_e.LICENSE_ILLEGAL="LICENSE_ILLEGAL"}(cy||(cy={})),function(_e){_e.CONNECTION_STATE_CHANGE="connection-state-change",_e.MEDIA_RECONNECT_START="media-reconnect-start",_e.MEDIA_RECONNECT_END="media-reconnect-end",_e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",_e.USER_JOINED="user-joined",_e.USER_LEAVED="user-left",_e.USER_PUBLISHED="user-published",_e.USER_UNPUBLISHED="user-unpublished",_e.USER_INFO_UPDATED="user-info-updated",_e.CLIENT_BANNED="client-banned",_e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",_e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",_e.VOLUME_INDICATOR="volume-indicator",_e.CRYPT_ERROR="crypt-error",_e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",_e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",_e.NETWORK_QUALITY="network-quality",_e.STREAM_TYPE_CHANGED="stream-type-changed",_e.STREAM_FALLBACK="stream-fallback",_e.RECEIVE_METADATA="receive-metadata",_e.STREAM_MESSAGE="stream-message",_e.LIVE_STREAMING_ERROR="live-streaming-error",_e.LIVE_STREAMING_WARNING="live-streaming-warning",_e.INJECT_STREAM_STATUS="stream-inject-status",_e.EXCEPTION="exception",_e.ERROR="error",_e.P2P_LOST="p2p_lost",_e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",_e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",_e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",_e.PUBLISHED_USER_LIST="published-user-list",_e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",_e.CONTENT_INSPECT_ERROR="content-inspect-error",_e.CONTENT_INSPECT_RESULT="content-inspect-result"}(W0||(W0={})),function(_e){_e.NETWORK_ERROR="NETWORK_ERROR",_e.SERVER_ERROR="SERVER_ERROR",_e.MULTI_IP="MULTI_IP",_e.TIMEOUT="TIMEOUT",_e.OFFLINE="OFFLINE",_e.LEAVE="LEAVE",_e.P2P_FAILED="P2P_FAILED",_e.FALLBACK="FALLBACK"}(uT||(uT={})),function(_e){_e.CONNECTING="connecting",_e.CONNECTED="connected",_e.RECONNECTING="reconnecting",_e.CLOSED="closed"}(py||(py={})),function(_e){_e.WS_CONNECTED="ws_connected",_e.WS_RECONNECTING="ws_reconnecting",_e.WS_CLOSED="ws_closed",_e.WS_RECONNECT_WAITTING_FINISH="ws_reconnect_waitting_finish",_e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",_e.ON_BINARY_DATA="on_binary_data",_e.REQUEST_RECOVER="request_recover",_e.REQUEST_JOIN_INFO="request_join_info",_e.REQUEST_REJOIN_INFO="req_rejoin_info",_e.IS_P2P_DISCONNECTED="is_p2p_dis",_e.DISCONNECT_P2P="dis_p2p",_e.ABORT_P2P_EXECUTION="abort_p2p_execution",_e.NEED_RENEW_SESSION="need-sid",_e.REPORT_JOIN_GATEWAY="report_join_gateway",_e.REQUEST_TIMEOUT="request_timeout",_e.REQUEST_SUCCESS="request_success",_e.JOIN_RESPONSE="join_response",_e.DATACHANNEL_PRECONNECT="datachannel_preconnect",_e.DATACHANNEL_CONNECTING="datachannel_connecting",_e.DATACHANNEL_FAILBACK="datachannel_failback"}(p0||(p0={})),function(_e){_e.PING="ping",_e.PING_BACK="ping_back",_e.JOIN="join_v3",_e.REJOIN="rejoin_v3",_e.LEAVE="leave",_e.SET_CLIENT_ROLE="set_client_role",_e.PUBLISH="publish",_e.UNPUBLISH="unpublish",_e.SUBSCRIBE="subscribe",_e.SUBSCRIBE_STREAMS="subscribe_streams",_e.UNSUBSCRIBE="unsubscribe",_e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",_e.SUBSCRIBE_CHANGE="subscribe_change",_e.TRAFFIC_STATS="traffic_stats",_e.RENEW_TOKEN="renew_token",_e.SWITCH_VIDEO_STREAM="switch_video_stream",_e.DEFAULT_VIDEO_STREAM="default_video_stream",_e.SET_FALLBACK_OPTION="set_fallback_option",_e.GATEWAY_INFO="gateway_info",_e.CONTROL="control",_e.SEND_METADATA="send_metadata",_e.DATA_STREAM="data_stream",_e.PICK_SVC_LAYER="pick_svc_layer",_e.RESTART_ICE="restart_ice",_e.CONNECT_PC="connect_pc",_e.SET_VIDEO_PROFILE="set_video_profile",_e.SET_PARAMETER="set_parameter"}(I0||(I0={})),function(_e){_e.PUBLISH_STATS="publish_stats",_e.PUBLISH_RELATED_STATS="publish_related_stats",_e.SUBSCRIBE_STATS="subscribe_stats",_e.SUBSCRIBE_RELATED_STATS="subscribe_related_stats",_e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",_e.DENOISER_STATS="denoiser_stats",_e.TRANSPORT_STATS="transport_stats",_e.EXTENSION_USAGE_STATS="extension_usage_stats"}(ET||(ET={})),function(_e){_e.ON_USER_ONLINE="on_user_online",_e.ON_USER_OFFLINE="on_user_offline",_e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",_e.ON_PUBLISH_STREAM="on_publish_stream",_e.ON_UPLINK_STATS="on_uplink_stats",_e.ON_P2P_LOST="on_p2p_lost",_e.ON_REMOVE_STREAM="on_remove_stream",_e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",_e.ON_ADD_VIDEO_STREAM="on_add_video_stream",_e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",_e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",_e.ON_USER_BANNED="on_user_banned",_e.ON_USER_LICENSE_BANNED="on_user_license_banned",_e.ON_NOTIFICATION="on_notification",_e.ON_CRYPT_ERROR="on_crypt_error",_e.MUTE_AUDIO="mute_audio",_e.MUTE_VIDEO="mute_video",_e.UNMUTE_AUDIO="unmute_audio",_e.UNMUTE_VIDEO="unmute_video",_e.ON_P2P_OK="on_p2p_ok",_e.RECEIVE_METADATA="receive_metadata",_e.ON_DATA_STREAM="on_data_stream",_e.ENABLE_LOCAL_VIDEO="enable_local_video",_e.DISABLE_LOCAL_VIDEO="disable_local_video",_e.ENABLE_LOCAL_AUDIO="enable_local_audio",_e.DISABLE_LOCAL_AUDIO="disable_local_audio",_e.ON_PUBLISHED_USER_LIST="on_published_user_list"}(U0||(U0={})),function(_e){_e.CONNECTION_STATE_CHANGE="CONNECTION_STATE_CHANGE",_e.NEED_ANSWER="NEED_ANSWER",_e.NEED_RENEGOTIATE="NEED_RENEGOTIATE",_e.P2P_LOST="P2P_LOST",_e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",_e.NEED_UNPUB="NEED_UNPUB",_e.NEED_UNSUB="NEED_UNSUB",_e.NEED_UPLOAD="NEED_UPLOAD",_e.NEED_CONTROL="NEED_CONTROL",_e.START_RECONNECT="START_RECONNECT",_e.END_RECONNECT="END_RECONNECT",_e.NEED_SIGNAL_RTT="NEED_SIGNAL_RTT"}(t7||(t7={})),function(_e){_e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",_e.RECEIVE_TRACK_BUFFER="receive_track_buffer",_e.ON_AUDIO_BUFFER="on_audio_buffer",_e.UPDATE_SOURCE="update_source"}(_T||(_T={}));const h4={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,currentPacketLossRate:0},f4={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},o7={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},wee={uplinkNetworkQuality:0,downlinkNetworkQuality:0},s7={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let N0,u_,d1;(function(_e){_e.CONNECTED="websocket:connected",_e.RECONNECTING="websocket:reconnecting",_e.WILL_RECONNECT="websocket:will_reconnect",_e.CLOSED="websocket:closed",_e.FAILED="websocket:failed",_e.ON_MESSAGE="websocket:on_message",_e.REQUEST_NEW_URLS="websocket:request_new_urls",_e.RECONNECT_WAITTING_FINISH="websocket:reconnect_waitting_finish",_e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",_e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire"})(N0||(N0={})),function(_e){_e.TRANSCODE="mix_streaming",_e.RAW="raw_streaming",_e.INJECT="inject_streaming"}(u_||(u_={})),function(_e){_e[_e.INJECT_STREAM_STATUS_START_SUCCESS=0]="INJECT_STREAM_STATUS_START_SUCCESS",_e[_e.INJECT_STREAM_STATUS_START_ALREADY_EXISTS=1]="INJECT_STREAM_STATUS_START_ALREADY_EXISTS",_e[_e.INJECT_STREAM_STATUS_START_UNAUTHORIZED=2]="INJECT_STREAM_STATUS_START_UNAUTHORIZED",_e[_e.INJECT_STREAM_STATUS_START_TIMEOUT=3]="INJECT_STREAM_STATUS_START_TIMEOUT",_e[_e.INJECT_STREAM_STATUS_START_FAILED=4]="INJECT_STREAM_STATUS_START_FAILED",_e[_e.INJECT_STREAM_STATUS_STOP_SUCCESS=5]="INJECT_STREAM_STATUS_STOP_SUCCESS",_e[_e.INJECT_STREAM_STATUS_STOP_NOT_FOUND=6]="INJECT_STREAM_STATUS_STOP_NOT_FOUND",_e[_e.INJECT_STREAM_STATUS_STOP_UNAUTHORIZED=7]="INJECT_STREAM_STATUS_STOP_UNAUTHORIZED",_e[_e.INJECT_STREAM_STATUS_STOP_TIMEOUT=8]="INJECT_STREAM_STATUS_STOP_TIMEOUT",_e[_e.INJECT_STREAM_STATUS_STOP_FAILED=9]="INJECT_STREAM_STATUS_STOP_FAILED",_e[_e.INJECT_STREAM_STATUS_BROKEN=10]="INJECT_STREAM_STATUS_BROKEN"}(d1||(d1={}));const Oee={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},p4={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function g4(_e,_t){U_(_e.url,"".concat(_t,".url"),1,1e3,!1),Py(_e.x)||wy(_e.x,"".concat(_t,".x"),0,1e4),Py(_e.y)||wy(_e.y,"".concat(_t,".y"),0,1e4),Py(_e.width)||wy(_e.width,"".concat(_t,".width"),0,1e4),Py(_e.height)||wy(_e.height,"".concat(_t,".height"),0,1e4),Py(_e.zOrder)||wy(_e.zOrder,"".concat(_t,".zOrder"),0,255),Py(_e.alpha)||wy(_e.alpha,"".concat(_t,".alpha"),0,1,!1)}const Cee={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""},xee={audioBitrate:48,audioChannels:2,audioVolume:100,audioSampleRate:48e3,height:0,width:0,videoBitrate:400,videoFramerate:15,videoGop:30};let RS,sN,Ky,a7,nT,$S,lT,h1,l_,Dy,t_,W5,w0,f_,m4,y4,f1,aN,Y0;function c7(_e){if(!_e.channelName)throw new Tp(Ql.INVALID_PARAMS,"invalid channelName in info");if(typeof _e.uid!="number")throw new Tp(Ql.INVALID_PARAMS,"invalid uid in info, uid must be a number");return _e.token&&U_(_e.token,"info.token",1,2047),c4(_e.uid),a4(_e.channelName),!0}function u7(_e){return __(_e,"mediaSource",["screen","window","application"]),!0}(function(_e){_e.WARNING="@live_uap-warning",_e.ERROR="@line_uap-error",_e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",_e.INJECT_STREAM_STATUS="@live_uap-inject-status",_e.WORKER_STATUS="@live_uap-worker-status",_e.REQUEST_NEW_ADDRESS="@live_uap-request-address"})(RS||(RS={})),function(_e){_e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager"}(sN||(sN={})),function(_e){_e[_e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",_e[_e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",_e[_e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",_e[_e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",_e[_e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",_e[_e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",_e[_e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",_e[_e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",_e[_e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",_e[_e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",_e[_e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",_e[_e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",_e[_e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",_e[_e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",_e[_e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",_e[_e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",_e[_e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",_e[_e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",_e[_e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",_e[_e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",_e[_e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN"}(Ky||(Ky={})),function(_e){_e.CONNECT_FAILED="connect failed",_e.CONNECT_TIMEOUT="connect timeout",_e.WS_DISCONNECTED="websocket disconnected",_e.REQUEST_TIMEOUT="request timeout",_e.REQUEST_FAILED="request failed",_e.WAIT_STATUS_TIMEOUT="wait status timeout",_e.WAIT_STATUS_ERROR="wait status error",_e.BAD_STATE="bad state",_e.WS_ABORT="ws abort",_e.AP_REQUEST_TIMEOUT="AP request timeout",_e.AP_JSON_PARSE_ERROR="AP json parse error",_e.AP_REQUEST_ERROR="AP request error",_e.AP_REQUEST_ABORT="AP request abort"}(a7||(a7={})),function(_e){_e[_e.SetSdkProfile=0]="SetSdkProfile",_e[_e.SetSourceChannel=1]="SetSourceChannel",_e[_e.SetSourceUserId=2]="SetSourceUserId",_e[_e.SetDestChannel=3]="SetDestChannel",_e[_e.StartPacketTransfer=4]="StartPacketTransfer",_e[_e.StopPacketTransfer=5]="StopPacketTransfer",_e[_e.UpdateDestChannel=6]="UpdateDestChannel",_e[_e.Reconnect=7]="Reconnect",_e[_e.SetVideoProfile=8]="SetVideoProfile"}(nT||(nT={})),function(_e){_e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",_e.NETWORK_CONNECTED="NETWORK_CONNECTED",_e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",_e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",_e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",_e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",_e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",_e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",_e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",_e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE"}($S||($S={})),function(_e){_e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",_e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",_e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",_e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE"}(lT||(lT={})),function(_e){_e.RELAY_OK="RELAY_OK",_e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",_e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",_e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED"}(h1||(h1={})),function(_e){_e.High="high",_e.Low="low",_e.Audio="audio",_e.Screen="screen",_e.ScreenLow="screen_low"}(l_||(l_={})),function(_e){_e.DISCONNECT="disconnect",_e.CONNECTION_STATE_CHANGE="connection-state-change",_e.NETWORK_QUALITY="network-quality",_e.STREAM_TYPE_CHANGE="stream-type-change",_e.IS_P2P_DISCONNECTED="is-p2p-dis",_e.DISCONNECT_P2P="dis-p2p",_e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",_e.NEED_RENEW_SESSION="need-sid",_e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",_e.JOIN_RESPONSE="join-response",_e.REQUEST_DC_CONNECTION_PARAMS="request-dc-connection-params",_e.RESET_CONNECTION_EVENTS="reset-connection-events",_e.DATACHANNEL_PRECONNECT="datachannel_preconnect",_e.DATACHANNEL_FAILBACK="datachannel_failback",_e.RESET_SIGNAL="reset-signal"}(Dy||(Dy={})),function(_e){_e[_e.Nothing=0]="Nothing",_e[_e.Audio=1]="Audio",_e[_e.LwoVideo=2]="LwoVideo",_e[_e.Video=4]="Video",_e[_e.Data=8]="Data"}(t_||(t_={})),function(_e){_e[_e.websocket=0]="websocket",_e[_e.datachannel=1]="datachannel"}(W5||(W5={})),function(_e){_e.NEED_RENEGOTIATE="@need_renegotiate",_e.NEED_REPLACE_TRACK="@need_replace_track",_e.NEED_CLOSE="@need_close",_e.NEED_ENABLE_TRACK="@need_enable_track",_e.NEED_DISABLE_TRACK="@need_disable_track",_e.NEED_SESSION_ID="@need_sid",_e.SET_OPTIMIZATION_MODE="@set_optimization_mode",_e.GET_STATS="@get_stats",_e.GET_LOW_VIDEO_TRACK="@get_low_video_track",_e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",_e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",_e.NEED_MUTE_TRACK="@need_mute_track",_e.NEED_UNMUTE_TRACK="@need_unmute_track"}(w0||(w0={})),function(_e){_e.SCREEN_TRACK="screen_track",_e.CUSTOM_TRACK="custome_track",_e.LOW_STREAM="low_stream"}(f_||(f_={})),function(_e){_e[_e.HIGH_STREAM=0]="HIGH_STREAM",_e[_e.LOW_STREAM=1]="LOW_STREAM"}(m4||(m4={})),function(_e){_e[_e.DISABLE=0]="DISABLE",_e[_e.LOW_STREAM=1]="LOW_STREAM",_e[_e.AUDIO_ONLY=2]="AUDIO_ONLY"}(y4||(y4={})),function(_e){_e.SOURCE_STATE_CHANGE="source-state-change",_e.TRACK_ENDED="track-ended",_e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",_e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",_e.CLOSED="closed"}(f1||(f1={})),function(_e){_e.FIRST_FRAME_DECODED="first-frame-decoded",_e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status"}(aN||(aN={})),function(_e){_e.CHINA="CHINA",_e.ASIA="ASIA",_e.NORTH_AMERICA="NORTH_AMERICA",_e.EUROPE="EUROPE",_e.JAPAN="JAPAN",_e.INDIA="INDIA",_e.KOREA="KOREA",_e.HKMC="HKMC",_e.US="US",_e.OCEANIA="OCEANIA",_e.SOUTH_AMERICA="SOUTH_AMERICA",_e.AFRICA="AFRICA",_e.OVERSEA="OVERSEA",_e.GLOBAL="GLOBAL",_e.EXTENSIONS="EXTENSIONS"}(Y0||(Y0={}));const kee=[Y0.AFRICA,Y0.ASIA,Y0.CHINA,Y0.EUROPE,Y0.GLOBAL,Y0.INDIA,Y0.JAPAN,Y0.NORTH_AMERICA,Y0.OCEANIA,Y0.OVERSEA,Y0.SOUTH_AMERICA];let b_;(function(_e){_e.CHINA="CN",_e.ASIA="AS",_e.NORTH_AMERICA="NA",_e.EUROPE="EU",_e.JAPAN="JP",_e.INDIA="IN",_e.KOREA="KR",_e.HKMC="HK",_e.US="US",_e.OCEANIA="OC",_e.SOUTH_AMERICA="SA",_e.AFRICA="AF",_e.OVERSEA="OVERSEA",_e.GLOBAL="GLOBAL",_e.EXTENSIONS="GLOBAL"})(b_||(b_={}));const H5={CHINA:{},ASIA:{CODE:b_.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:b_.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:b_.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:b_.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","	uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:b_.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:b_.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:b_.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:b_.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:b_.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:b_.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:b_.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:b_.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:b_.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};let c2,l7,P0,l0,p_,ty,Y_,p1,$_,bT,WT,HT,d_,oR,By;Q6&&(H5.CHINA={CODE:b_.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]}),function(_e){_e.UPDATE_BITRATE_LIMIT="update_bitrate_limit"}(c2||(c2={}));class K5 extends Hy{constructor(_t,_r){super(),Ml(this,"onICEConnectionStateChange",void 0),Ml(this,"onConnectionStateChange",void 0),Ml(this,"onDTLSTransportStateChange",void 0),Ml(this,"onDTLSTransportError",void 0),Ml(this,"onICETransportStateChange",void 0),Ml(this,"onFirstAudioReceived",void 0),Ml(this,"onFirstVideoReceived",void 0),Ml(this,"onFirstAudioDecoded",void 0),Ml(this,"onFirstVideoDecoded",void 0),Ml(this,"onFirstVideoDecodedTimeout",void 0),Ml(this,"onSelectedLocalCandidateChanged",void 0),Ml(this,"onSelectedRemoteCandidateChanged",void 0),Ml(this,"establishPromise",void 0)}}(function(_e){_e.SEND="sendonly",_e.RECV="recvonly",_e.SENDRECV="sendrecv",_e.INACTIVE="inactive"})(l7||(l7={})),function(_e){_e.VIDEO="video",_e.AUDIO="audio"}(P0||(P0={})),function(_e){_e.LocalVideoTrack="videoTrack",_e.LocalAudioTrack="audioTrack",_e.LocalVideoLowTrack="videoLowTrack"}(l0||(l0={})),function(_e){_e.New="new",_e.Connected="connected",_e.Reconnecting="reconnecting",_e.Disconnected="disconnected"}(p_||(p_={})),function(_e){_e.StateChange="stateChange",_e.IceConnectionStateChange="iceConnectionStateChange",_e.RequestMuteLocal="requestMuteLocal",_e.RequestUnmuteLocal="requestUnmuteLocal",_e.RequestRePublish="requestRePublish",_e.RequestReSubscribe="requestReSubscribe",_e.RequestUploadStats="requestUploadStats",_e.MediaReconnectStart="MediaReconnectStart",_e.MediaReconnectEnd="MediaReconnectEnd",_e.NeedSignalRTT="NeedSignalRTT",_e.RequestRestartICE="RequestRestartIce",_e.PeerConnectionStateChange="PeerConnectionStateChange",_e.RequestReconnect="RequestReconnect",_e.RequestReconnectPC="RequestReconnectPC",_e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",_e.P2PLost="P2PLost",_e.UpdateVideoEncoder="UpdateVideoEncoder",_e.ConnectionTypeChange="ConnectionTypeChange",_e.RequestLowStreamParameter="RequestLowStreamParameter",_e.QueryClientConnectionState="QueryClientConnectionState"}(ty||(ty={})),function(_e){_e.ONLINE="ONLINE",_e.OFFLINE="OFFLINE"}(Y_||(Y_={})),function(_e){_e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",_e.ONLINE="ONLINE",_e.OFFLINE="OFFLINE"}(p1||(p1={})),function(_e){_e.ON_TRACK="on_track",_e.ON_NODE="on_node"}($_||($_={})),function(_e){_e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",_e.REQUEST_CONSTRAINTS="request_constraints"}(bT||(bT={})),function(_e){_e.CONNECTING="CONNECTING",_e.RECONNECTING="RECONNECTING",_e.CONNECTED="CONNECTED",_e.CLOSED="CLOSED"}(WT||(WT={})),function(_e){_e[_e.CONNECT_AP=0]="CONNECT_AP",_e[_e.AP_CONNECTED=1]="AP_CONNECTED",_e[_e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",_e[_e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",_e[_e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",_e[_e.CONNECT_WORKER=5]="CONNECT_WORKER",_e[_e.WORKER_CONNECTED=6]="WORKER_CONNECTED",_e[_e.CLOSED=7]="CLOSED"}(HT||(HT={})),function(_e){_e.CONNECTION_STATE_CHANGE="connection-state-change",_e.STATE_CHANGE="state-change",_e.INSPECT_RESULT="inspect-result",_e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",_e.REQUEST_NEW_WORKER_URL="request-new-worker-url"}(d_||(d_={})),function(_e){_e.NETWORK_ERROR="NETWORK_ERROR",_e.SERVER_ERROR="SERVER_ERROR",_e.MULTI_IP="MULTI_IP",_e.TIMEOUT="TIMEOUT",_e.OFFLINE="OFFLINE",_e.LEAVE="LEAVE",_e.P2P_FAILED="P2P_FAILED",_e.FALLBACK="FALLBACK"}(oR||(oR={})),function(_e){_e.CONNECTED="transmitter:connected",_e.RECONNECTING="transmitter:reconnecting",_e.WILL_RECONNECT="transmitter:will_reconnect",_e.CLOSED="transmitter:closed",_e.FAILED="transmitter:failed",_e.ON_MESSAGE="transmitter:on_message",_e.REQUEST_NEW_URLS="transmitter:request_new_urls",_e.RECONNECT_WAITTING_FINISH="transmitter:reconnect_waitting_finish",_e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",_e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",_e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",_e.FAILBACK="transmitter:failback"}(By||(By={}));const rT={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1};function R_(){return rT}let y_;(function(_e){_e[_e.CHOOSE_SERVER=11]="CHOOSE_SERVER",_e[_e.CLOUD_PROXY=18]="CLOUD_PROXY",_e[_e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",_e[_e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK"})(y_||(y_={}));var Pee=$p,u2=Array.isArray||function(_e){return Pee(_e)=="Array"},Nee=Sl,d7=u2,Lee=A0,Dee=Cy,Mee=T0("species"),h7=Nee.Array,Uee=function(_e){var _t;return d7(_e)&&(_t=_e.constructor,(Lee(_t)&&(_t===h7||d7(_t.prototype))||Dee(_t)&&(_t=_t[Mee])===null)&&(_t=void 0)),_t===void 0?h7:_t},f7=function(_e,_t){return new(Uee(_e))(_t===0?0:_t)},jee=yR,Fee=dy,Bee=kS,$ee=LS,Vee=f7,p7=xa([].push),g1=function(_e){var _t=_e==1,_r=_e==2,_o=_e==3,_a=_e==4,_u=_e==6,yl=_e==7,Rl=_e==5||_u;return function(Al,Ol,xl,Ll){for(var Bl,Hl,up=Bee(Al),_f=Fee(up),vp=jee(Ol,xl),Dp=$ee(_f),Bp=0,_g=Ll||Vee,y0=_t?_g(Al,Dp):_r||yl?_g(Al,0):void 0;Dp>Bp;Bp++)if((Rl||Bp in _f)&&(Hl=vp(Bl=_f[Bp],Bp,up),_e))if(_t)y0[Bp]=Hl;else if(Hl)switch(_e){case 3:return!0;case 5:return Bl;case 6:return Bp;case 2:p7(y0,Bl)}else switch(_e){case 4:return!1;case 7:p7(y0,Bl)}return _u?-1:_o||_a?_a:y0}},g7={forEach:g1(0),map:g1(1),filter:g1(2),some:g1(3),every:g1(4),find:g1(5),findIndex:g1(6),filterReject:g1(7)},Gee=g7.forEach,m7=wO("forEach")?[].forEach:function(_e){return Gee(this,_e,arguments.length>1?arguments[1]:void 0)};D_({target:"Array",proto:!0,forced:[].forEach!=m7},{forEach:m7});var Wee=tS("Array").forEach,Hee=iS,Kee=Q_,qee=El,zee=Wee,v4=Array.prototype,Yee={DOMTokenList:!0,NodeList:!0},Xee=function(_e){var _t=_e.forEach;return _e===v4||qee(v4,_e)&&_t===v4.forEach||Kee(Yee,Hee(_e))?zee:_t},Jee=kS,y7=rS;D_({target:"Object",stat:!0,forced:j(function(){y7(1)})},{keys:function(_e){return y7(Jee(_e))}});var Qee=vy.Object.keys,Zee=zN,ete=D_,tte=u2,nte=xa([].reverse),v7=[1,2];ete({target:"Array",proto:!0,forced:String(v7)===String(v7.reverse())},{reverse:function(){return tte(this)&&(this.length=this.length),nte(this)}});var rte=tS("Array").reverse,ite=El,ote=rte,E4=Array.prototype,ste=function(_e){var _t=_e.reverse;return _e===E4||ite(E4,_e)&&_t===E4.reverse?ote:_t},ate=j,cte=Iy,ute=T0("species"),E7=function(_e){return cte>=51||!ate(function(){var _t=[];return(_t.constructor={})[ute]=function(){return{foo:1}},_t[_e](Boolean).foo!==1})},lte=D_,dte=Sl,_7=u2,hte=A0,fte=Cy,T7=HO,pte=LS,gte=q0,mte=t4,yte=T0,vte=_E,Ete=E7("slice"),_te=yte("species"),_4=dte.Array,bte=Math.max;lte({target:"Array",proto:!0,forced:!Ete},{slice:function(_e,_t){var _r,_o,_a,_u=gte(this),yl=pte(_u),Rl=T7(_e,yl),Al=T7(_t===void 0?yl:_t,yl);if(_7(_u)&&(_r=_u.constructor,(hte(_r)&&(_r===_4||_7(_r.prototype))||fte(_r)&&(_r=_r[_te])===null)&&(_r=void 0),_r===_4||_r===void 0))return vte(_u,Rl,Al);for(_o=new(_r===void 0?_4:_r)(bte(Al-Rl,0)),_a=0;Rl<Al;Rl++,_a++)Rl in _u&&mte(_o,_a,_u[Rl]);return _o.length=_a,_o}});var Tte=tS("Array").slice,Ste=El,Rte=Tte,T4=Array.prototype,Ate=function(_e){var _t=_e.slice;return _e===T4||Ste(T4,_e)&&_t===T4.slice?Rte:_t};function Yp(_e,_t,_r,_o,_a){var _u,yl,Rl,Al={};return Xee(_u=Qee(_o)).call(_u,function(Ol){Al[Ol]=_o[Ol]}),Al.enumerable=!!Al.enumerable,Al.configurable=!!Al.configurable,("value"in Al||Al.initializer)&&(Al.writable=!0),Al=Zee(yl=ste(Rl=Ate(_r).call(_r)).call(Rl)).call(yl,function(Ol,xl){return xl(_e,_t,Ol)||Ol},Al),_a&&Al.initializer!==void 0&&(Al.value=Al.initializer?Al.initializer.call(_a):void 0,Al.initializer=void 0),Al.initializer===void 0&&(c8(_e,_t,Al),Al=null),Al}var Ite=tS("Array").keys,wte=iS,Ote=Q_,Cte=El,xte=Ite,S4=Array.prototype,kte={DOMTokenList:!0,NodeList:!0},aO=function(_e){var _t=_e.keys;return _e===S4||Cte(S4,_e)&&_t===S4.keys||Ote(kte,wte(_e))?xte:_t};function S7(_e,_t){var _r=Object.keys(_e);if(Object.getOwnPropertySymbols){var _o=Object.getOwnPropertySymbols(_e);_t&&(_o=_o.filter(function(_a){return Object.getOwnPropertyDescriptor(_e,_a).enumerable})),_r.push.apply(_r,_o)}return _r}function R7(_e){for(var _t=1;_t<arguments.length;_t++){var _r=arguments[_t]!=null?arguments[_t]:{};_t%2?S7(Object(_r),!0).forEach(function(_o){Ml(_e,_o,_r[_o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_e,Object.getOwnPropertyDescriptors(_r)):S7(Object(_r)).forEach(function(_o){Object.defineProperty(_e,_o,Object.getOwnPropertyDescriptor(_r,_o))})}return _e}let q5=0,R4=0;function VS(_e,_t,_r,_o){return new u0((_a,_u)=>{_t.timeout=_t.timeout||Pp("HTTP_CONNECT_TIMEOUT"),_t.responseType=_t.responseType||"json",_t.data&&!_r?(_t.data=JSON.stringify(_t.data),q5+=fN(_t.data)):_r&&(_t.data.size?q5+=_t.data.size:_t.data instanceof FormData?q5+=function(yl){let Rl=0;return/DingTalk/i.test(navigator.userAgent)&&yl.realFormData&&(yl=yl.realFormData),yl.forEach(Al=>{Rl+=typeof Al=="string"?fN(Al):Al.size}),Rl+138}(_t.data):q5+=fN(JSON.stringify(_t.data))),_t.headers=_t.headers||{},_t.headers["Content-Type"]=_t.headers["Content-Type"]||"application/json",_t.method="POST",_t.url=_e,TS.request(_t).then(yl=>{typeof yl.data=="string"?R4+=fN(yl.data):yl.data instanceof ArrayBuffer||yl.data instanceof Uint8Array?R4+=yl.data.byteLength:R4+=fN(JSON.stringify(yl.data)),_o&&_a({data:yl.data,headers:yl.headers}),_a(yl.data)}).catch(yl=>{TS.isCancel(yl)?_u(new Tp(Ql.OPERATION_ABORTED,"cancel token canceled")):yl.code==="ECONNABORTED"?_u(new Tp(Ql.NETWORK_TIMEOUT,yl.message)):yl.response?_u(new Tp(Ql.NETWORK_RESPONSE_ERROR,yl.response.status)):_u(new Tp(Ql.NETWORK_ERROR,yl.message))})})}async function Pte(_e,_t){const _r=new Blob([_t.data],{type:"buffer"});return await VS(_e,R7(R7({},_t),{},{data:_r,headers:{"Content-Type":"application/octet-stream"}}),!0)}const n_=new class extends Hy{set networkState(_e){Vl.info("[".concat(this._moduleName,"]")+"network state changed, "+this._networkState+" -> "+_e),this.emit(p1.NETWORK_STATE_CHANGE,_e,this._networkState),_e===Y_.ONLINE?this.emit(p1.ONLINE):_e===Y_.OFFLINE&&(this.onlineWaiter=new u0(_t=>{this.once(p1.ONLINE,()=>{this.onlineWaiter=void 0,_t(Y_.ONLINE)})}),this.emit(p1.OFFLINE)),this._networkState=_e}get networkState(){return this._networkState}constructor(){super(),Ml(this,"_moduleName","network-indicator"),Ml(this,"_networkState",Y_.ONLINE),Ml(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=Y_.ONLINE}),window.addEventListener("offline",()=>{this.networkState=Y_.OFFLINE})}};let A4=!1;const KT=new class extends Hy{constructor(){super(...arguments),Ml(this,"onAutoplayFailed",void 0),Ml(this,"onAudioAutoplayFailed",void 0)}};function A7(){if(gy(),!A4){const _e=_t=>{_t.preventDefault(),A4=!1,t2()?document.body.removeEventListener("click",_e,!0):(document.body.removeEventListener("touchstart",_e,!0),document.body.removeEventListener("mousedown",_e,!0))};A4=!0,t2()?document.body.addEventListener("click",_e,!0):(document.body.addEventListener("touchstart",_e,!0),document.body.addEventListener("mousedown",_e,!0)),Vl.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),KT.onAutoplayFailed?KT.onAutoplayFailed():KT.onAudioAutoplayFailed?Vl.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):Vl.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),KT.emit("autoplay-failed")}}function I4(_e){return new TextEncoder().encode(_e)}const I7=function(_e,_t){const _r=new Uint8Array(_e.byteLength+_t.byteLength);return _r.set(new Uint8Array(_e),0),_r.set(new Uint8Array(_t),_e.byteLength),_r},Nte=async _e=>function(_t,_r){let _o="";return new Uint8Array(_t).forEach(_a=>{_o+=_a.toString(_r).padStart(2,"0")}),_o}(await crypto.subtle.digest("SHA-256",I4(_e)),16);function w7(_e,_t){var _r=Object.keys(_e);if(Object.getOwnPropertySymbols){var _o=Object.getOwnPropertySymbols(_e);_t&&(_o=_o.filter(function(_a){return Object.getOwnPropertyDescriptor(_e,_a).enumerable})),_r.push.apply(_r,_o)}return _r}function D0(_e){for(var _t=1;_t<arguments.length;_t++){var _r=arguments[_t]!=null?arguments[_t]:{};_t%2?w7(Object(_r),!0).forEach(function(_o){Ml(_e,_o,_r[_o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_e,Object.getOwnPropertyDescriptors(_r)):w7(Object(_r)).forEach(function(_o){Object.defineProperty(_e,_o,Object.getOwnPropertyDescriptor(_r,_o))})}return _e}function _0(){let _e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(_t,_r,_o){const _a=_o.value;if(typeof _a=="function"){const _u=_e.className||_t.__className__||(_t.constructor.name==="AgoraRTCClient"?"Client":_t.constructor.name);_o.value=function(){for(var yl=arguments.length,Rl=new Array(yl),Al=0;Al<yl;Al++)Rl[Al]=arguments[Al];let Ol=Rl;if(_e.argsMap)try{Ol=_e.argsMap(this,...Rl)}catch(Ll){Vl.warning(Ll),Ol=[]}try{JSON.stringify(Ol)}catch{Vl.warning("arguments for method ".concat(_u,".").concat(_r," not serializable for apiInvoke.")),Ol=[]}const xl=(_e.report||g0).reportApiInvoke(this._sessionId||null,{name:"".concat(_u,".").concat(_r),options:Ol,tag:jy.TRACER,reportResult:_e.reportResult},_e.throttleTime);try{const Ll=_a.apply(this,Rl);return Ll instanceof u0?Ll.then(Bl=>(xl.onSuccess(_e.reportResult&&Bl),Bl)).catch(Bl=>{throw xl.onError(Bl),Bl}):(xl.onSuccess(_e.reportResult&&Ll),Ll)}catch(Ll){throw xl.onError(Ll),Ll}}}return _o}}const g0=new class{constructor(){Ml(this,"baseInfoMap",new Map),Ml(this,"proxyServer",void 0),Ml(this,"clientList",iO),Ml(this,"eventUploadTimer",void 0),Ml(this,"setSessionIdTimer",void 0),Ml(this,"url",void 0),Ml(this,"backupUrl",void 0),Ml(this,"_appId",void 0),Ml(this,"keyEventUploadPendingItems",[]),Ml(this,"normalEventUploadPendingItems",[]),Ml(this,"apiInvokeUploadPendingItems",[]),Ml(this,"apiInvokeCount",0),Ml(this,"ltsList",[]),Ml(this,"lastSendNormalEventTime",Date.now()),Ml(this,"customReportCounterTimer",void 0),Ml(this,"customReportCount",0),Ml(this,"extApiInvoke",async _e=>{for(const _t of _e){const _r=D0(D0({},_t),{},{sid:null,invokeId:++this.apiInvokeCount,tag:jy.TRACER});this.sendApiInvoke(_r)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),Pp("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),Pp("EVENT_REPORT_SEND_INTERVAL"))}adjustSessionStartTime(_e){if(!this.baseInfoMap.has(_e)&&!this.baseInfoMap.get(_e))return void Vl.error("adjust session ".concat(_e," start time, sid is not exist or info is undefined"));const _t=this.baseInfoMap.get(_e),_r=Date.now(),_o=_t.startTime;_t.startTime=_r,Vl.debug("rewrite session ".concat(_e," startTime: ").concat(_r," , ").concat(_r-_o,"ms")),this.baseInfoMap.set(_e,_t)}setAppId(_e){this._appId=_e}reportApiInvoke(_e,_t,_r){_t.timeout=_t.timeout||6e4,_t.reportResult=_t.reportResult===void 0||_t.reportResult;const _o=Date.now();this.apiInvokeCount+=1;const _a=this.apiInvokeCount,_u=()=>({tag:_t.tag,invokeId:_a,sid:_e,name:_t.name,apiInvokeTime:_o,options:_t.options,states:_t.states||null}),yl=!!Pp("SHOW_REPORT_INVOKER_LOG");yl&&Vl.info("".concat(_t.name," start"),_t.options);let Rl=!1;G_(_t.timeout).then(()=>{Rl||(this.sendApiInvoke(D0(D0({},_u()),{},{error:Ql.API_INVOKE_TIMEOUT,success:!1})),Vl.debug("".concat(_t.name," timeout")))});const Al=new Tp(Ql.UNEXPECTED_ERROR,"".concat(_t.name,": this api invoke is end"));return{onSuccess:Ol=>{const xl=()=>{if(Rl)throw Al;return Rl=!0,this.sendApiInvoke(D0(D0({},_u()),{},{success:!0},_t.reportResult&&{result:Ol})),yl&&Vl.info("".concat(_t.name," onSuccess")),Ol};return _r?$W(xl,_t.name+"Success",_r,()=>Rl=!0):xl()},onError:Ol=>{const xl=()=>{if(Rl)throw Ol;Rl=!0,this.sendApiInvoke(D0(D0({},_u()),{},{success:!1,error:Ol})),yl&&Vl.info("".concat(_t.name," onFailure"),Ol.toString())};return _r?$W(xl,_t.name+"Error",_r,()=>Rl=!0):xl()}}}sessionInit(_e,_t){if(this.baseInfoMap.has(_e))return;const _r=Date.now(),_o=this.createBaseInfo(_e,_r);_o.cname=_t.cname;const _a=Object.assign({},{willUploadConsoleLog:Pp("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:Q6?"global":"oversea",areas:Pp("AREAS")&&Pp("AREAS").join(",")},_t.extend),_u=Date.now(),yl=D0(D0({},_o),{},{eventType:F_.SESSION_INIT,appid:_t.appid,browser:navigator.userAgent,build:J6,lts:_u,elapse:_u-_r,extend:JSON.stringify(_a),mode:_t.mode,process:Pp("PROCESS_ID"),appType:Pp("APP_TYPE"),success:!0,version:aS});this.send({type:Fy.SESSION,data:yl},!0)}joinChooseServer(_e,_t){const _r=this.baseInfoMap.get(_e);if(!_r)return;const _o=_r.info,_a=Date.now(),_u=D0(D0({},_o),{},{eventType:F_.JOIN_CHOOSE_SERVER,lts:_a,eventElapse:_a-_t.lts,chooseServerAddr:_t.csAddr,errorCode:_t.ec,elapse:_a-_r.startTime,success:_t.succ,chooseServerAddrList:JSON.stringify(_t.serverList),uid:_t.uid?parseInt(_t.uid):null,cid:_t.cid?parseInt(_t.cid):null,chooseServerIp:_t.csIp||"",opid:_t.opid,unilbsServerIds:_t.unilbsServerIds,extend:_t.extend||void 0,isHttp3:_t.isHttp3});this.send({type:Fy.JOIN_CHOOSE_SERVER,data:_u},!0)}reqUserAccount(_e,_t){const _r=this.baseInfoMap.get(_e);if(!_r)return;const _o=_r.info,_a=Date.now(),_u=D0(D0({},_o),{},{eventType:F_.REQ_USER_ACCOUNT,lts:_a,success:_t.success,serverAddress:_t.serverAddr,stringUid:_t.stringUid,uid:_t.uid,errorCode:_t.errorCode,elapse:_a-_r.startTime,eventElapse:_a-_t.lts,extend:JSON.stringify(_t.extend)});this.send({type:Fy.REQ_USER_ACCOUNT,data:_u},!0)}joinGateway(_e,_t){const _r=this.baseInfoMap.get(_e);if(!_r)return;const _o=_r.info;_t.vid&&(_o.vid=_t.vid),_o.uid=_t.uid,_o.cid=_t.cid;const _a=Date.now(),{firstSuccess:_u,avoidJoinStartTime:yl,isProxy:Rl,addr:Al}=_t,Ol=_a-(_u&&yl?yl:_r.startTime),xl=D0(D0({},_o),{},{eventType:F_.JOIN_GATEWAY,lts:_a,gatewayAddr:_t.addr,success:_t.succ,errorCode:_t.ec,elapse:Ol,eventElapse:_a-_t.lts,firstSuccess:_u,signalChannel:_t.signalChannel}),Ll=xl.success?1:0;if(_t.succ&&(_r.lastJoinSuccessTime=_a),_u)this.send({type:Fy.JOIN_GATEWAY,data:xl},!0);else{let Bl;if(Al)if(Rl){const up=Al.match(/h=(\d{1,3}-){3}\d{1,3}/g),_f=Al.match(/p=[0-9]{1,6}/g);Bl={isSuccess:Ll,gatewayIp:up&&up.length?up[0].split("=")[1].replace(/-/g,"."):"",port:_f&&_f.length?_f[0].split("=")[1]:"",isProxy:Rl?1:0}}else{const up=Al.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),_f=Al.match(/:[0-9]{1,6}/g);Bl={isSuccess:Ll,gatewayIp:up&&up.length?up[0].split("//")[1].replace(/-/g,"."):"",port:_f&&_f.length?_f[0].split(":")[1]:"",isProxy:Rl?1:0}}else Bl={isSuccess:Ll,gatewayIp:"",port:"",isProxy:Rl?1:0};delete xl.success,delete xl.eventType,delete xl.firstSuccess,xl.vid=Number(xl.vid);const Hl=Object.assign({},xl,Bl,{eventType:F_.REJOIN_GATEWAY});this.send({type:Fy.RE_JOIN_GATEWAY,data:Hl},!0)}}joinChannelTimeout(_e,_t){const _r=this.baseInfoMap.get(_e);if(!_r)return;const _o=Date.now(),_a=D0(D0({},_r.info),{},{lts:_o,timeout:_t,elapse:_o-_r.startTime});this.send({type:Fy.JOIN_CHANNEL_TIMEOUT,data:_a},!0)}publish(_e,_t){const _r=this.baseInfoMap.get(_e);if(!_r)return;const _o=_r.info,_a=Date.now(),_u=D0(D0({},_o),{},{eventType:F_.PUBLISH,lts:_a,eventElapse:_t.eventElapse,elapse:_a-_r.startTime,success:_t.succ,errorCode:_t.ec,videoName:_t.videoName,audioName:_t.audioName,screenName:_t.screenName,screenshare:_t.screenshare,audio:_t.audio,video:_t.video,p2pid:_t.p2pid,publishRequestid:_t.publishRequestid});this.send({type:Fy.PUBLISH,data:_u},!0)}subscribe(_e,_t,_r){const _o=this.baseInfoMap.get(_e);if(!_o)return;const _a=_o.info,_u=Date.now(),yl=D0(D0({},_a),{},{eventType:F_.SUBSCRIBE,lts:_u,eventElapse:_t.eventElapse,elapse:_u-_o.startTime,success:_t.succ,errorCode:_t.ec,video:_t.video,audio:_t.audio,subscribeRequestid:_t.subscribeRequestid,p2pid:_t.p2pid},_r&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof _t.peerid=="string"?yl.peerSuid=_t.peerid:yl.peer=_t.peerid,this.send({type:Fy.SUBSCRIBE,data:yl},!0)}wsCompressorInit(_e){var _t;const _r=[...aO(_t=this.baseInfoMap).call(_t)],_o=_r.length?_r[0]:"UnableToGetSid",_a=this.baseInfoMap.get(_o);if(!_a)return;const _u=_a.info,yl=Date.now(),Rl=D0(D0({},_u),{},{eventType:F_.WS_COMPRESSOR_INIT,lts:yl,eventElapse:_e.eventElapse,elapse:yl-_a.startTime,status:_e.status?1:2});this.send({type:Fy.WS_COMPRESSOR_INIT,data:Rl},!0)}firstRemoteVideoDecode(_e,_t,_r,_o){const _a=this.baseInfoMap.get(_e);if(!_a)return;const _u=_a.info,yl=Date.now(),Rl=D0(D0(D0({},_u),_o),{},{elapse:yl-_a.startTime,eventType:_t,lts:yl,firstDecodeFrame:Math.max(yl-_a.startTime,0),apEnd:Math.max(_o.apEnd-_a.startTime,0),apStart:Math.max(_o.apStart-_a.startTime,0),joinGwEnd:Math.max(_o.joinGwEnd-_a.startTime,0),joinGwStart:Math.max(_o.joinGwStart-_a.startTime,0),pcEnd:Math.max(_o.pcEnd-_a.startTime,0),pcStart:Math.max(_o.pcStart-_a.startTime,0),subscriberEnd:Math.max(_o.subscriberEnd-_a.startTime,0),subscriberStart:Math.max(_o.subscriberStart-_a.startTime,0),videoAddNotify:Math.max(_o.videoAddNotify-_a.startTime,0)});this.send({type:_r,data:Rl},!0)}firstRemoteFrame(_e,_t,_r,_o){const _a=this.baseInfoMap.get(_e);if(!_a)return;const _u=_a.info,yl=Date.now(),Rl=D0(D0(D0({},_u),_o),{},{elapse:yl-_a.startTime,eventType:_t,lts:yl});this.send({type:_r,data:Rl},!0)}onGatewayStream(_e,_t,_r,_o){const _a=this.baseInfoMap.get(_e);if(!_a)return;const _u=_a.info,yl=Date.now(),Rl=D0(D0(D0({},_u),_o),{},{eventType:_t,lts:yl});this.send({type:_r,data:Rl},!0)}streamSwitch(_e,_t){const _r=this.baseInfoMap.get(_e);if(!_r)return;const _o=_r.info,_a=Date.now(),_u=D0(D0({},_o),{},{eventType:F_.STREAM_SWITCH,lts:_a,isDual:_t.isdual,elapse:_a-_r.startTime,success:_t.succ});this.send({type:Fy.STREAM_SWITCH,data:_u},!0)}requestProxyAppCenter(_e,_t){const _r=this.baseInfoMap.get(_e);if(!_r)return;const _o=_r.info,_a=Date.now(),_u=D0(D0({},_o),{},{eventType:F_.REQUEST_PROXY_APPCENTER,lts:_a,eventElapse:_a-_t.lts,elapse:_a-_r.startTime,APAddr:_t.APAddr,workerManagerList:_t.workerManagerList,response:_t.response,errorCode:_t.ec,success:_t.succ});this.send({type:Fy.REQUEST_PROXY_APPCENTER,data:_u},!0)}requestProxyWorkerManager(_e,_t){const _r=this.baseInfoMap.get(_e);if(!_r)return;const _o=_r.info,_a=Date.now(),_u=D0(D0({},_o),{},{eventType:F_.REQUEST_PROXY_WORKER_MANAGER,lts:_a,eventElapse:_a-_t.lts,elapse:_a-_r.startTime,workerManagerAddr:_t.workerManagerAddr,response:_t.response,errorCode:_t.ec,success:_t.succ});this.send({type:Fy.REQUEST_PROXY_WORKER_MANAGER,data:_u},!0)}setProxyServer(_e){this.proxyServer=_e,_e?Vl.debug("reportProxyServerurl: ".concat(_e)):Vl.debug("disable reportProxyServerurl: ".concat(_e))}peerPublishStatus(_e,_t){const _r=this.baseInfoMap.get(_e);if(!_r)return;const _o=_r.info,_a=Date.now(),_u=D0(D0({},_o),{},{subscribeElapse:_t.subscribeElapse,peer:_t.peer,peerPublishDuration:Math.max(_t.audioPublishDuration,_t.videoPublishDuration),audiotag:_t.audioPublishDuration>0?1:-1,videotag:_t.videoPublishDuration>0?1:-1,lts:_a,elapse:_a-_r.startTime,joinChannelSuccessElapse:_a-(_r.lastJoinSuccessTime||_a),peerPublishDurationVideo:_t.videoPublishDuration,peerPublishDurationAudio:_t.audioPublishDuration});this.send({type:Fy.PEER_PUBLISH_STATUS,data:_u},!0)}workerEvent(_e,_t){const _r=this.baseInfoMap.get(_e);if(!_r)return;const _o=_r.info,_a=Date.now();(function(_u,yl,Rl){const Al=_u[yl];if(!Al||typeof Al!="string")return[_u];_u[yl]="";const Ol=fN(JSON.stringify(_u));let xl=0;const Ll=[];let Bl=0;for(let Hl=0;Hl<Al.length;Hl++)Bl+=Al.charCodeAt(Hl)<=127?1:3,Bl<=Rl-Ol||(Ll[Ll.length]=lO(lO({},_u),{},{[yl]:Al.substring(xl,Hl)}),xl=Hl,Bl=Al.charCodeAt(Hl)<=127?1:3);return xl!==Al.length-1&&(Ll[Ll.length]=lO(lO({},_u),{},{[yl]:Al.substring(xl)})),Ll})(D0(D0(D0({},_o),_t),{},{elapse:_a-_r.startTime,lts:_a,productType:"WebRTC"}),"payload",1300).forEach(_u=>this.send({type:Fy.WORKER_EVENT,data:_u},!0))}apworkerEvent(_e,_t){const _r=this.baseInfoMap.get(_e);if(!_r)return;const _o=_r.info,_a=Date.now(),_u=D0(D0(D0({},_o),_t),{},{elapse:_a-_r.startTime,lts:_a});this.send({type:Fy.AP_WORKER_EVENT,data:_u},!0)}joinWebProxyAP(_e,_t){const _r=this.baseInfoMap.get(_e);if(!_r)return;const _o=_r.info,_a=Date.now(),_u=D0(D0(D0({},_o),_t),{},{elapse:_a-_r.startTime,lts:_a,extend:_t.extend||void 0});this.send({type:Fy.JOIN_WEB_PROXY_AP,data:_u},!0)}WebSocketQuit(_e,_t){const _r=this.baseInfoMap.get(_e);if(!_r)return;const _o=_r.info,_a=Date.now(),_u=D0(D0(D0({},_o),_t),{},{elapse:_a-_r.startTime,lts:_a});this.send({type:Fy.WEBSOCKET_QUIT,data:_u},!0)}async sendCustomReportMessage(_e,_t){if(this.customReportCount+=_t.length,this.customReportCount>Pp("CUSTOM_REPORT_LIMIT"))throw new Tp(Ql.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const _r=Date.now(),_o=_t.map(_a=>({type:Fy.USER_ANALYTICS,data:D0(D0({sid:_e},_a),{},{lts:_r})}));try{Pp("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(_o):await this.postDataToStatsCollector(_o)}catch(_a){throw Vl.error("send custom report message failed",_a.toString()),new Tp(Ql.CUSTOM_REPORT_SEND_FAILED,_a.message)}}autoplayFailed(_e,_t,_r,_o){if(!_e)return;const _a=this.baseInfoMap.get(_e);if(!_a)return;const _u=_a.info,yl=Date.now(),Rl=D0(D0({},_u),{},{vid:_u.vid===void 0?0:Number(_u.vid),lts:yl,elapse:yl-_a.startTime,cbRegistered:KT.onAutoplayFailed||KT.onAudioAutoplayFailed?1:-1,errorMsg:_r,mediaType:_t,trackId:_o,extend:void 0});this.send({type:Fy.AUTOPLAY_FAILED,data:Rl},!0)}sendApiInvoke(_e){const _t=Pp("NOT_REPORT_EVENT");if(_e.tag&&_t.includes&&_t.includes(_e.tag))return!1;if(_e.sid===null)return this.apiInvokeUploadPendingItems.push(_e),!1;const _r=this.baseInfoMap.get(_e.sid);if(!_r)return this.apiInvokeUploadPendingItems.push(_e),!1;const{cname:_o,uid:_a,cid:_u}=_r.info;_e.lts=_e.lts||Date.now();let yl;if(_e.error)if(_e.error instanceof Tp){const{code:Al,message:Ol}=_e.error;yl=Al||Ol||_e.error.toString()}else yl=_e.error.toString();const Rl={invokeId:_e.invokeId,sid:_e.sid,cname:_o,cid:_u,uid:_a,lts:_e.lts,success:_e.success,elapse:_e.lts-_r.startTime,execElapse:_e.lts-_e.apiInvokeTime,apiName:_e.name,options:_e.options?JSON.stringify(_e.options):void 0,execStates:_e.states?JSON.stringify(_e.states):void 0,execResult:_e.result?JSON.stringify(_e.result):void 0,errorCode:_e.error?yl:void 0,errorMsg:_e.error?JSON.stringify(_e.error):void 0};return this.send({type:Fy.API_INVOKE,data:Rl},!1),!0}appendSessionId(){this.clientList.forEach(_e=>{if(_e._sessionId){const _t=this.apiInvokeUploadPendingItems.length;for(let _r=0;_r<_t;_r++){const _o=this.apiInvokeUploadPendingItems.shift();_o&&(_o.sid=_e._sessionId,this.sendApiInvoke(Object.assign({},_o)))}}})}send(_e,_t){if(_t)return this.keyEventUploadPendingItems.push(_e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(_e),this.normalEventUploadPendingItems.length>Pp("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(_e,_t){const _r=[],_o=[];for(;_e.length;){const _u=_e.shift();_r.length<20?_r.push(_u):_o.push(_u)}_e.push(..._o);for(const _u of[..._r]){var _a;this.ltsList.indexOf(_u.data.lts)!==-1?(_u.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(_u.data.lts)):(this.ltsList.push(_u.data.lts),o4(_a=this.ltsList).call(_a,(yl,Rl)=>yl-Rl))}return _t||(this.lastSendNormalEventTime=Date.now()),Pp("ENABLE_EVENT_REPORT")&&_r.length&&(Pp("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(_r):this.postDataToStatsCollector(_r)).catch((_u=>yl=>{Pp("EVENT_REPORT_RETRY")&&(_t?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(_u):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(_u),this.normalEventUploadPendingItems.length>Pp("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-Pp("NORMAL_EVENT_QUEUE_CAPACITY")),Vl.warning("report: drop normal events"))))})(_r)),_e}async postDataToStatsCollector2(_e){n_.networkState===Y_.OFFLINE&&await u0.race([n_.onlineWaiter,G_(2*h_.maxRetryTimeout)]);const _t=_a=>{let _u=new Uint8Array;return _a.forEach(yl=>{const Rl=I4(JSON.stringify(yl.data)),Al=new ArrayBuffer(5),Ol=(Ll=>{let Bl=0;return Object.entries(Fy).forEach(Hl=>{let[up,_f]=Hl;_f===Ll.type&&(Bl=l4[up])}),Bl})(yl),xl=new DataView(Al);xl.setUint16(0,Rl.byteLength,!0),xl.setUint8(2,255&Ol),xl.setUint8(3,Ol>>>8&255),xl.setUint8(4,Ol>>>16&255),_u=I7(_u,new Uint8Array(Al)),_u=I7(_u,Rl)}),_u},_r="event";let _o=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(Pp("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(_r):"https://".concat(Pp("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(_r);for(let _a=0;_a<2;_a+=1){_a===1&&(_o=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(Pp("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(_r):"https://".concat(Pp("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(_r));try{await VS(_o,{timeout:1e4,data:_t(_e),headers:D0(D0({token:"32f24ab2ddb74f508aa9286c356cec84",biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(_u){if(_a===1)throw _u;continue}return}}async postDataToStatsCollector(_e){let _t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const _r={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:_e.map(_u=>JSON.stringify(_u)),vid:(_u=>{const yl=_u&&_u.data.sid&&this.baseInfoMap.get(_u.data.sid);return yl&&yl.info.vid&&+yl.info.vid||0})(_e[0])};n_.networkState===Y_.OFFLINE&&await u0.race([n_.onlineWaiter,G_(2*h_.maxRetryTimeout)]);const _o=_t?"/events/proto-raws":"/events/messages";let _a=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(Pp("EVENT_REPORT_DOMAIN"),"&p=").concat(Pp("STATS_COLLECTOR_PORT"),"&d=").concat(_o):"https://".concat(Pp("EVENT_REPORT_DOMAIN"),":").concat(Pp("STATS_COLLECTOR_PORT")).concat(_o));for(let _u=0;_u<2;_u+=1){_u===1&&(_a=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(Pp("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(Pp("STATS_COLLECTOR_PORT"),"&d=").concat(_o):"https://".concat(Pp("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(Pp("STATS_COLLECTOR_PORT")).concat(_o)));try{_t?await Pte(_a,{timeout:1e4,data:_r}):await VS(_a,{timeout:1e4,data:_r})}catch(yl){if(_u===1)throw yl;continue}return}}createBaseInfo(_e,_t){const _r=Object.assign({},Aee);return _r.sid=_e,this.baseInfoMap.set(_e,{info:_r,startTime:_t}),_r}reportResourceTiming(_e,_t){const _r=performance.getEntriesByName(_e),_o=_r[_r.length-1];_o&&this.reportApiInvoke(_t,{name:"Client.resourceTiming",options:_o,tag:jy.TRACER}).onSuccess()}};B5.on("REPORT_LOG_UPLOAD",_e=>{_e.networkState=n_.networkState,g0.reportApiInvoke(null,{name:"logUploadError",options:_e,tag:jy.TRACER})});class O7 extends Hy{constructor(_t,_r){super(),Ml(this,"trackMediaType",void 0),Ml(this,"_ID",void 0),Ml(this,"_hints",[]),Ml(this,"_isClosed",!1),Ml(this,"_originMediaStreamTrack",void 0),Ml(this,"_mediaStreamTrack",void 0),Ml(this,"_external",{}),this._ID=_r||Ny(8,"track-"),this._originMediaStreamTrack=_t,this._mediaStreamTrack=_t,function(_o){i2.includes(_o)||i2.push(_o)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(_t){if(!_t){const _r=g0.reportApiInvoke(null,{name:c_.GET_MEDIA_STREAM_TRACK,options:[],tag:jy.TRACER});this._mediaStreamTrack&&typeof this._mediaStreamTrack.label=="string"?_r.onSuccess(this._mediaStreamTrack.label):_r.onSuccess("")}return this._mediaStreamTrack}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,function(_t){const _r=i2.indexOf(_t);_r!==-1&&i2.splice(_r,1)}(this),this.emit(f1.CLOSED)}}let v_,Lte=1;class iT{constructor(_t){Ml(this,"lockingPromise",u0.resolve()),Ml(this,"locks",0),Ml(this,"name",""),Ml(this,"lockId",void 0),this.lockId=Lte++,_t&&(this.name=_t),Vl.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is created."))}get isLocked(){return this.locks>0}lock(_t){let _r;this.locks+=1,Vl.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is locked, current queue ").concat(this.locks,". ").concat(typeof _t=="string"?_t:""));const _o=new u0(_u=>{_r=()=>{this.locks-=1,Vl.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is not locked, current queue ").concat(this.locks,". ").concat(typeof _t=="string"?_t:"")),_u()}}),_a=this.lockingPromise.then(()=>_r);return this.lockingPromise=this.lockingPromise.then(()=>_o),_a}}function cN(_e,_t){return function(_r,_o,_a){const _u=_a.value;if(typeof _u!="function")throw new Error("Cannot use mutex on object property.");return _a.value=async function(){const yl=this[_t];if(!yl)throw new Error("mutex property key ".concat(_t," doesn't exist on ").concat(_e));const Rl=await yl.lock("From ".concat(_e,".").concat(_o));try{for(var Al=arguments.length,Ol=new Array(Al),xl=0;xl<Al;xl++)Ol[xl]=arguments[xl];return await _u.apply(this,Ol)}finally{Rl()}},_a}}class w4 extends O7{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}set processorContext(_t){this._processorContext=_t}constructor(_t,_r){super(_t,_r),Ml(this,"_enabled",!0),Ml(this,"_muted",!1),Ml(this,"_isExternalTrack",!1),Ml(this,"_isClosed",!1),Ml(this,"_enabledMutex",void 0),Ml(this,"processor",void 0),Ml(this,"_processorContext",void 0),Ml(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new iT("".concat(this.getTrackId())),_t.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var _t,_r;return(_t=(_r=this._originMediaStreamTrack)===null||_r===void 0?void 0:_r.label)!==null&&_t!==void 0?_t:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,Vl.debug("[".concat(this.getTrackId(),"] close")),this.emit(w0.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(_t,_r){let _o=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=_o,_t!==this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),_r&&this._originMediaStreamTrack.stop(),_t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=_t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await $y(this,w0.NEED_REPLACE_TRACK,this),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){Vl.debug("[".concat(this.getTrackId(),"] track ended")),this.emit(f1.TRACK_ENDED)}stateCheck(_t,_r){if(Vl.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(_t,": ").concat(_r,"]")),o2(_r,_t),this._enabled&&this._muted&&_t==="enabled"&&_r===!1)throw new Tp(Ql.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print();if(!this._enabled&&!this._muted&&_t==="muted"&&_r===!0)throw new Tp(Ql.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}function C7(_e,_t){var _r=Object.keys(_e);if(Object.getOwnPropertySymbols){var _o=Object.getOwnPropertySymbols(_e);_t&&(_o=_o.filter(function(_a){return Object.getOwnPropertyDescriptor(_e,_a).enumerable})),_r.push.apply(_r,_o)}return _r}(function(_e){_e.IOS_15_INTERRUPTION_START="ios15-interruption-start",_e.IOS_15_INTERRUPTION_END="ios15-interruption-end",_e.IOS_INTERRUPTION_START="ios-interruption-start",_e.IOS_INTERRUPTION_END="ios-interruption-end",_e.STATE_CHANGE="state-change"})(v_||(v_={}));const x7=window.AudioContext||window.webkitAudioContext;let qT=null;const X0=new class extends Hy{constructor(){super(...arguments),Ml(this,"prevState",void 0),Ml(this,"curState",void 0),Ml(this,"currentTime",void 0),Ml(this,"currentTimeStuckAt",void 0),Ml(this,"interruptDetectorTrack",void 0),Ml(this,"onLocalAudioTrackMute",()=>{Vl.info("ios15-interruption-start"),this.emit(v_.IOS_15_INTERRUPTION_START)}),Ml(this,"onLocalAudioTrackUnmute",async()=>{Vl.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?Vl.info("ios15-interruption-end-canceled"):(qT&&await qT.suspend(),this.emit(v_.IOS_15_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(_e){Vl.debug("webaudio bindInterruptDetectorTrack ".concat(_e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=_e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(_e){Vl.debug("webaudio unbindInterruptDetectorTrack ".concat(_e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===_e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function Dte(){if(!x7)return void Vl.error("your browser is not support web audio");Vl.info("create audio context");const _e=function(_t){for(var _r=1;_r<arguments.length;_r++){var _o=arguments[_r]!=null?arguments[_r]:{};_r%2?C7(Object(_o),!0).forEach(function(_a){Ml(_t,_a,_o[_a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_t,Object.getOwnPropertyDescriptors(_o)):C7(Object(_o)).forEach(function(_a){Object.defineProperty(_t,_a,Object.getOwnPropertyDescriptor(_o,_a))})}return _t}({},Pp("WEBAUDIO_INIT_OPTIONS"));Vl.debug("audio context init option:",JSON.stringify(_e)),qT=new x7(_e),X0.curState=qT.state,qT.onstatechange=()=>{X0.prevState=X0.curState,X0.curState=qT?qT.state:void 0,(eT()||rR())&&X0.prevState==="running"&&X0.curState==="interrupted"&&(Vl.info("ios-interruption-start"),X0.emit(v_.IOS_INTERRUPTION_START)),(eT()||rR())&&X0.prevState==="interrupted"&&X0.curState==="running"&&(Vl.info("ios-interruption-end"),X0.emit(v_.IOS_INTERRUPTION_END)),X0.prevState!==X0.curState&&(Vl.debug("AudioContext State Change","".concat(X0.prevState,"=>").concat(X0.curState)),X0.emit(v_.STATE_CHANGE))},setInterval(()=>{var _t;const _r=(_t=qT)===null||_t===void 0?void 0:_t.currentTime;X0.currentTime!==_r?(X0.currentTimeStuckAt&&(Vl.debug("AudioContext current time resume at ".concat(_r)),X0.currentTimeStuckAt=void 0),X0.currentTime=_r):(_r!==X0.currentTimeStuckAt&&(g0.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:_r},tag:jy.TRACER}).onSuccess(),Vl.warning("AudioContext current time stuck at ".concat(_r))),X0.currentTimeStuckAt=_r)},5e3),async function(_t){const _r=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let _o,_a=!1,_u=!1,yl=!1;function Rl(vp){_t.state==="running"?Al(!1):eT()||rR()?_t.state==="suspended"&&(Al(!0),vp&&_t.resume().then(xl,xl)):_t.state!=="closed"&&(Al(!0),vp&&_t.resume().then(xl,xl))}function Al(vp){if(_a!==vp){_a=vp;for(let Dp=0,Bp=_r;Dp<Bp.length;Dp+=1){const _g=Bp[Dp];vp?window.addEventListener(_g,Ll,{capture:!0,passive:!0}):window.removeEventListener(_g,Ll,{capture:!0,passive:!0})}}}function Ol(){Rl(!0)}function xl(){Rl(!1)}function Ll(){Rl(!0)}function Bl(vp){if(!yl)if(_o.paused)if(vp){Hl(!1),yl=!0;let Dp;try{Dp=_o.play(),Dp?Dp.then(up,up):(_o.addEventListener("playing",up),_o.addEventListener("abort",up),_o.addEventListener("error",up))}catch{up()}}else Hl(!0);else Hl(!1)}function Hl(vp){if(_u!==vp){_u=vp;for(let Dp=0,Bp=_r;Dp<Bp.length;Dp++){const _g=Bp[Dp];vp?window.addEventListener(_g,_f,{capture:!0,passive:!0}):window.removeEventListener(_g,_f,{capture:!0,passive:!0})}}}function up(){_o.removeEventListener("playing",up),_o.removeEventListener("abort",up),_o.removeEventListener("error",up),yl=!1,Bl(!1)}function _f(){Bl(!0)}if(eT()){const vp=_t.createMediaStreamDestination(),Dp=document.createElement("div");Dp.innerHTML="<audio x-webkit-airplay='deny'></audio>",_o=Dp.children.item(0),_o.controls=!1,_o.disableRemotePlayback=!0,_o.preload="auto",_o.srcObject=vp.stream,Bl(!0)}X0.on(v_.STATE_CHANGE,Ol),Rl(!1)}(qT)}function uN(){if(!qT){if(Dte(),!qT)throw new Tp(Ql.NOT_SUPPORTED,"can not create audio context");return qT}return qT}function k7(){return!!qT}function cO(_e){if(function(){if(O4!==null)return O4;const _o=uN(),_a=_o.createBufferSource(),_u=_o.createGain(),yl=_o.createGain();_a.connect(_u),_a.connect(yl),_a.disconnect(_u);let Rl=!1;try{_a.disconnect(_u)}catch{Rl=!0}return _a.disconnect(),O4=Rl,Rl}())return;const _t=_e.connect,_r=_e.disconnect;_e.connect=(_o,_a,_u)=>(_e._inputNodes||(_e._inputNodes=[]),_e._inputNodes.includes(_o)||(_o instanceof AudioNode?(_e._inputNodes.push(_o),_t.call(_e,_o,_a,_u)):_t.call(_e,_o,_a)),_e),_e.disconnect=(_o,_a,_u)=>{_r.call(_e),_o?U4(_e._inputNodes,_o):_e._inputNodes=[];for(const yl of _e._inputNodes)_t.call(_e,yl)}}let O4=null;function P7(_e,_t){let _r=!1;const _o=1/_t;if(Pp("DISABLE_WEBAUDIO")){const _a=window.setInterval(()=>{_r?window.clearInterval(_a):_e(performance.now()/1e3)},1e3*_o)}else{const _a=uN();let _u=_a.createGain();_u.gain.value=0,_u.connect(_a.destination);const yl=()=>{if(_r)return void(_u=null);const Rl=_a.createOscillator();Rl.onended=yl,Rl.connect(_u),Rl.start(0),Rl.stop(_a.currentTime+_o),_e(_a.currentTime)};yl()}return()=>{_r=!0}}class N7{constructor(){Ml(this,"context",void 0),Ml(this,"analyserNode",void 0),Ml(this,"sourceNode",void 0),this.context=uN(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(_t){if(_t!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=_t,_t==null||_t.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||eT()||rR()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const _t=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(_t);else{const _o=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(_o);for(let _a=0;_a<_t.length;++_a)_t[_a]=_o[_a]/128-1}const _r=nS(_t).call(_t,(_o,_a)=>_o+_a*_a,0)/_t.length;return Math.max(10*Math.log10(_r)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var _t,_r;(_t=this.sourceNode)===null||_t===void 0||_t.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(_r=this.sourceNode)===null||_r===void 0||_r.connect(this.analyserNode)}catch{Vl.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class L7 extends Hy{get processSourceNode(){return this.sourceNode}set processedNode(_t){var _r;if(!this.isDestroyed&&this._processedNode!==_t){try{var _o;(_o=this.sourceNode)===null||_o===void 0||_o.disconnect(this.outputNode)}catch{}(_r=this._processedNode)===null||_r===void 0||_r.disconnect(),this._processedNode=_t,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),Ml(this,"outputNode",void 0),Ml(this,"outputTrack",void 0),Ml(this,"isPlayed",!1),Ml(this,"sourceNode",void 0),Ml(this,"context",void 0),Ml(this,"audioBufferNode",void 0),Ml(this,"destNode",void 0),Ml(this,"audioOutputLevel",0),Ml(this,"volumeLevelAnalyser",void 0),Ml(this,"_processedNode",void 0),Ml(this,"playNode",void 0),Ml(this,"isDestroyed",!1),Ml(this,"onNoAudioInput",void 0),Ml(this,"isNoAudioInput",!1),Ml(this,"_noAudioInputCount",0),this.context=uN(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),cO(this.outputNode),this.volumeLevelAnalyser=new N7}startGetAudioBuffer(_t){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(_t),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=_r=>{this.emit(_T.ON_AUDIO_BUFFER,function(_o){for(let _a=0;_a<_o.outputBuffer.numberOfChannels;_a+=1){const _u=_o.outputBuffer.getChannelData(_a);for(let yl=0;yl<_u.length;yl+=1)_u[yl]=0}return _o.inputBuffer}(_r))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!R_().webAudioMediaStreamDest)throw new Tp(Ql.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(_t){this.context.state!=="running"&&IS(()=>{X0.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=_t||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let _t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(_t>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;eT()||rR()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const _r=this.volumeLevelAnalyser.getAnalyserNode();let _o;_r.getFloatTimeDomainData?(_o=new Float32Array(_r.fftSize),_r.getFloatTimeDomainData(_o)):(_o=new Uint8Array(_r.fftSize),_r.getByteTimeDomainData(_o));let _a=!1;for(let _u=0;_u<_o.length;_u++)_o[_u]!==0&&(_a=!0);return _a?(this.isNoAudioInput=!1,!0):(await G_(200),await this.checkHasAudioInput(_t?_t+1:1)&&_a)}getAudioVolume(){return this.outputNode.gain.value}setVolume(_t){this.outputNode.gain.setValueAtTime(_t,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var _t,_r;(_t=this.processedNode)===null||_t===void 0||_t.disconnect(),(_r=this.sourceNode)===null||_r===void 0||_r.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var _t;this.processedNode?(_t=this.processedNode)===null||_t===void 0||_t.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class C4 extends L7{get isFreeze(){return!1}constructor(_t,_r,_o){var _a;if(super(),Ml(this,"sourceNode",void 0),Ml(this,"track",void 0),Ml(this,"clonedTrack",void 0),Ml(this,"audioElement",void 0),Ml(this,"isCurrentTrackCloned",!1),Ml(this,"isRemoteTrack",!1),Ml(this,"originVolumeLevelAnalyser",void 0),Ml(this,"rebuildWebAudio",async()=>{if(Vl.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void Vl.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>Vl.info("resume success")),Vl.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const Rl=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?Rl.stop():this.isCurrentTrackCloned=!0;const Al=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(Al),cO(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const Ol=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(Ol,this.context.currentTime),cO(this.outputNode),this.emit(_T.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=Al,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),_t.kind!=="audio")throw new Tp(Ql.UNEXPECTED_ERROR);this.track=_t;const _u=new MediaStream([this.track]);if(this.isRemoteTrack=!!_r,this.sourceNode=this.context.createMediaStreamSource(_u),cO(this.sourceNode),_o){const Rl=_o.clone();Rl.enabled=!0,this.clonedTrack=Rl,Vl.debug("create an unmuted track ".concat(Rl.id," from the original track ").concat(_o.id," to get the volume"));const Al=this.context.createMediaStreamSource(new MediaStream([Rl]));cO(Al),this.originVolumeLevelAnalyser=new N7,this.originVolumeLevelAnalyser.updateSource(Al)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=_u;const yl=gy();_r&&yl.os===z_.IOS&&Number((_a=yl.osVersion)===null||_a===void 0?void 0:_a.split(".")[0])<15&&(X0.on(v_.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(Rl=>{Rl||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(_t){this.sourceNode.disconnect(),this.track=_t,this.isCurrentTrackCloned=!1;const _r=new MediaStream([_t]);this.sourceNode=this.context.createMediaStreamSource(_r),cO(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(_T.UPDATE_SOURCE),this.audioElement.srcObject=_r}destroy(){var _t;this.audioElement.srcObject=null,this.audioElement.remove(),X0.off("state-change",this.rebuildWebAudio),(_t=this.originVolumeLevelAnalyser)===null||_t===void 0||_t.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(_t){return this.context.createMediaStreamSource(new MediaStream([_t]))}updateOriginTrack(_t){const _r=_t.clone();_r.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=_r),Vl.debug("create an unmuted track ".concat(_r.id," from the original track ").concat(_t.id," to get the volume"));const _o=this.context.createMediaStreamSource(new MediaStream([_r]));cO(_o),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(_o)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function D7(_e,_t){const _r=(_a,_u)=>_a?typeof _a!="number"?_a.max||_a.exact||_a.ideal||_a.min||_u:_a:_u,_o={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:_e,maxHeight:_r(_t.height,1080),maxWidth:_r(_t.width,1920)}}};return _t.frameRate&&typeof _t.frameRate!="number"?(_o.video.mandatory.maxFrameRate=_t.frameRate.max,_o.video.mandatory.minFrameRate=_t.frameRate.min):typeof _t.frameRate=="number"&&(_o.video.mandatory.maxFrameRate=_t.frameRate),await navigator.mediaDevices.getUserMedia(_o)}async function Mte(_e){const _t=await M7(_e.mediaSource),_r=await function(_o){return new u0((_a,_u)=>{const yl=document.createElement("div");yl.innerText="share screen",yl.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const Rl=document.createElement("div");Rl.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const Al=document.createElement("div");Al.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",Al.setAttribute("style","height: 12%;");const Ol=document.createElement("div");Ol.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const xl=document.createElement("div");xl.setAttribute("style","text-align: right; padding: 16px 0;");const Ll=document.createElement("button");Ll.innerHTML="cancel",Ll.setAttribute("style","width: 85px;"),Ll.onclick=()=>{document.body.removeChild(Bl);const Hl=new Error("NotAllowedError");Hl.name="NotAllowedError",_u(Hl)},xl.appendChild(Ll),Rl.appendChild(Al),Rl.appendChild(Ol),Rl.appendChild(xl);const Bl=document.createElement("div");Bl.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),Bl.appendChild(yl),Bl.appendChild(Rl),document.body.appendChild(Bl),_o.map(Hl=>{if(Hl.id){const up=document.createElement("div");up.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let _f=Hl.thumbnail;const{width:vp}=_f.getSize();vp>1920&&(_f=_f.resize({width:1920})),up.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+_f.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+(Hl.name.replace(/[\u00A0-\u9999<>\&]/g,function(Dp){return"&#"+Dp.charCodeAt(0)+";"})+"</span>"),up.onclick=()=>{document.body.removeChild(Bl),_a(Hl.id)},Ol.appendChild(up)}})})}(_t);return await D7(_r,_e)}async function M7(_e){let _t=["window","screen"];_e!=="application"&&_e!=="window"||(_t=["window"]),_e==="screen"&&(_t=["screen"]);const _r=U7();if(!_r)throw new Tp(Ql.ELECTRON_IS_NULL);let _o=null;try{var _a;_o=((_a=_r.desktopCapturer)===null||_a===void 0?void 0:_a.getSources({types:_t}))||_r.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:_t})}catch{_o=null}_o&&_o.then||(_o=new u0((_u,yl)=>{_r.desktopCapturer.getSources({types:_t},(Rl,Al)=>{Rl?yl(Rl):_u(Al)})}));try{return await _o}catch(_u){throw new Tp(Ql.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,_u.toString())}}let z5=null;function U7(){if(z5)return z5;try{return z5=window.require("electron"),z5}catch{return null}}function j7(_e,_t){var _r=Object.keys(_e);if(Object.getOwnPropertySymbols){var _o=Object.getOwnPropertySymbols(_e);_t&&(_o=_o.filter(function(_a){return Object.getOwnPropertyDescriptor(_e,_a).enumerable})),_r.push.apply(_r,_o)}return _r}const x4=new iT("safari");let F7=!1,B7=!1;async function AS(_e,_t){let _r=0,_o=null;for(;_r<2;)try{_o=await Ute(_e,_t,_r>0);break}catch(_a){if(_a instanceof Tp)throw Vl.error("[".concat(_t,"] ").concat(_a.toString())),_a;const _u=Y5(_a.name||_a.code||_a,_a.message);if(_u.code===Ql.MEDIA_OPTION_INVALID){Vl.debug("[".concat(_t,"] detect media option invalid, retry")),_r+=1,await G_(500);continue}throw Vl.error("[".concat(_t,"] ").concat(_u.toString())),_u}if(!_o)throw new Tp(Ql.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return _o}async function Ute(_e,_t,_r){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Tp(Ql.NOT_SUPPORTED,"can not find getUserMedia");_r&&(_e.video&&(delete _e.video.width,delete _e.video.height),_e.screen&&(delete _e.screen.width,delete _e.screen.height));const _o=R_(),_a=new MediaStream;if(_e.audioSource&&_a.addTrack(_e.audioSource),_e.videoSource&&_a.addTrack(_e.videoSource),!_e.audio&&!_e.video&&!_e.screen)return Vl.debug("Using Video Source/ Audio Source"),_a;if(_e.screen)if(U7())_e.screen.sourceId?lN(_a,await D7(_e.screen.sourceId,_e.screen)):lN(_a,await Mte(_e.screen));else if(x6()&&_e.screen.extensionId&&_e.screen.mandatory){if(!_o.getStreamFromExtension)throw new Tp(Ql.NOT_SUPPORTED,"This browser does not support screen sharing");Vl.debug("[".concat(_t,'] Screen access on chrome stable, looking for extension"'));const Bl=await(yl=_e.screen.extensionId,Rl=_t,new u0((Hl,up)=>{try{chrome.runtime.sendMessage(yl,{getStream:!0},_f=>{if(!_f||!_f.streamId)return Vl.error("[".concat(Rl,"] No response from Chrome Plugin. Plugin not installed properly"),_f),void up(new Tp(Ql.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));Hl(_f.streamId)})}catch(_f){Vl.error("[".concat(Rl,"] AgoraRTC screensharing plugin is not accessible(").concat(yl,")"),_f.toString()),up(new Tp(Ql.CHROME_PLUGIN_NOT_INSTALL))}}));_e.screen.mandatory.chromeMediaSourceId=Bl,lN(_a,await navigator.mediaDevices.getUserMedia({video:{mandatory:_e.screen.mandatory}}))}else if(_o.getDisplayMedia){var _u;_e.screen.mediaSource&&u7(_e.screen.mediaSource);const Bl={width:_e.screen.width,height:_e.screen.height,frameRate:_e.screen.frameRate,displaySurface:(_u=_e.screen.displaySurface)!==null&&_u!==void 0?_u:_e.screen.mediaSource==="screen"?"monitor":_e.screen.mediaSource},{selfBrowserSurface:Hl,surfaceSwitching:up,systemAudio:_f}=_e.screen,vp={selfBrowserSurface:Hl,surfaceSwitching:up,systemAudio:_f};!Hl&&delete vp.selfBrowserSurface,!up&&delete vp.surfaceSwitching,!_f&&delete vp.systemAudio,Vl.debug("[".concat(_t,"] getDisplayMedia:"),JSON.stringify({video:Bl,audio:!!_e.screenAudio,controls:vp})),lN(_a,await navigator.mediaDevices.getDisplayMedia(function(Dp){for(var Bp=1;Bp<arguments.length;Bp++){var _g=arguments[Bp]!=null?arguments[Bp]:{};Bp%2?j7(Object(_g),!0).forEach(function(y0){Ml(Dp,y0,_g[y0])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Dp,Object.getOwnPropertyDescriptors(_g)):j7(Object(_g)).forEach(function(y0){Object.defineProperty(Dp,y0,Object.getOwnPropertyDescriptor(_g,y0))})}return Dp}({video:Bl,audio:!!_e.screenAudio},vp)))}else{if(!Wy())throw Vl.error("[".concat(_t,"] This browser does not support screenSharing")),new Tp(Ql.NOT_SUPPORTED,"This browser does not support screen sharing");{_e.screen.mediaSource&&u7(_e.screen.mediaSource);const Bl={video:{mediaSource:_e.screen.mediaSource,width:_e.screen.width,height:_e.screen.height,frameRate:_e.screen.frameRate}};Vl.debug("[".concat(_t,"] getUserMedia: ").concat(JSON.stringify(Bl))),lN(_a,await navigator.mediaDevices.getUserMedia(Bl))}}var yl,Rl;if(!_e.video&&!_e.audio)return _a;let Al={video:_e.video,audio:_e.audio},Ol=Pp("MEDIA_DEVICE_CONSTRAINTS");if(Ol)try{typeof Ol=="string"&&(Ol=JSON.parse(Ol)),Al=function Bl(Hl,up){if(!VW(Hl)||!VW(up)||Array.isArray(Hl)&&!Array.isArray(up)||!Array.isArray(Hl)&&Array.isArray(up))return up;if(Array.isArray(up)&&Array.isArray(Hl)){const _f=[...Hl];for(let vp=0;vp<up.length;vp++)_f[vp]=Bl(Hl[vp],up[vp]);return _f}{const _f=lO({},Hl);for(const vp in up)Object.prototype.hasOwnProperty.call(up,vp)&&(Object.prototype.hasOwnProperty.call(Hl,vp)?_f[vp]=Bl(Hl[vp],up[vp]):_f[vp]=up[vp]);return _f}}(Al,Ol)}catch{}Vl.debug("[".concat(_t,"] GetUserMedia"),JSON.stringify(Al)),gy();let xl,Ll=null;(_b()||eT()||k5())&&(Ll=await x4.lock());try{xl=await navigator.mediaDevices.getUserMedia(Al)}catch(Bl){throw Ll&&Ll(),Bl}return Al.audio&&(F7=!0),Al.video&&(B7=!0),lN(_a,xl),Ll&&Ll(),_a}function Y5(_e,_t){switch(_e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new Tp(Ql.MEDIA_OPTION_INVALID,"".concat(_e,": ").concat(_t));case"NotFoundError":case"DevicesNotFoundError":return new Tp(Ql.DEVICE_NOT_FOUND,"".concat(_e,": ").concat(_t));case"NotSupportedError":return new Tp(Ql.NOT_SUPPORTED,"".concat(_e,": ").concat(_t));case"NotReadableError":return new Tp(Ql.NOT_READABLE,"".concat(_e,": ").concat(_t));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new Tp(Ql.PERMISSION_DENIED,"".concat(_e,": ").concat(_t));case"ConstraintNotSatisfiedError":return new Tp(Ql.CONSTRAINT_NOT_SATISFIED,"".concat(_e,": ").concat(_t));default:return Vl.error("getUserMedia unexpected error",_e),new Tp(Ql.UNEXPECTED_ERROR,"".concat(_e,": ").concat(_t))}}function lN(_e,_t){const _r=_e.getVideoTracks()[0],_o=_e.getAudioTracks()[0],_a=_t.getVideoTracks()[0],_u=_t.getAudioTracks()[0];_u&&(_o&&_e.removeTrack(_o),_e.addTrack(_u)),_a&&(_r&&_e.removeTrack(_r),_e.addTrack(_a))}const zT=new class extends Hy{get state(){return this._state}set state(_e){_e!==this._state&&(this.emit(LR.STATE_CHANGE,_e),this._state=_e)}constructor(){super(),Ml(this,"_state",sO.IDLE),Ml(this,"isAccessMicrophonePermission",!1),Ml(this,"isAccessCameraPermission",!1),Ml(this,"lastAccessMicrophonePermission",!1),Ml(this,"lastAccessCameraPermission",!1),Ml(this,"checkdeviceMatched",!1),Ml(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(Pp("ENUMERATE_DEVICES_INTERVAL")||N6()&&eO())&&this.updateDevicesInfo()},Pp("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(_e=>Vl.error(_e.toString()))}async enumerateDevices(_e,_t){let _r=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new Tp(Ql.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const _o=await navigator.mediaDevices.enumerateDevices(),_a=this.checkMediaDeviceInfoIsOk(_o);let _u=!this.isAccessMicrophonePermission&&_e,yl=!this.isAccessCameraPermission&&_t;_a.audio&&(_u=!1),_a.video&&(yl=!1);let Rl=null,Al=null,Ol=null;if(!_r&&(_u||yl)){if(x4.isLocked&&(Vl.debug("[device manager] wait GUM lock"),(await x4.lock())(),Vl.debug("[device manager] GUM unlock")),F7&&(_u=!1,this.isAccessMicrophonePermission=!0),B7&&(yl=!1,this.isAccessCameraPermission=!0),Vl.debug("[device manager] check media device permissions",_e,_t,_u,yl),_u&&yl){try{Ol=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(xl){const Ll=Y5(xl.name||xl.code||xl,xl.message);if(Ll.code===Ql.PERMISSION_DENIED)throw Ll;Vl.warning("getUserMedia failed in getDevices",Ll)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(_u){try{Rl=await navigator.mediaDevices.getUserMedia({audio:_e})}catch(xl){const Ll=Y5(xl.name||xl.code||xl,xl.message);if(Ll.code===Ql.PERMISSION_DENIED)throw Ll;Vl.warning("getUserMedia failed in getDevices",Ll)}this.isAccessMicrophonePermission=!0}else if(yl){try{Al=await navigator.mediaDevices.getUserMedia({video:_t})}catch(xl){const Ll=Y5(xl.name||xl.code||xl,xl.message);if(Ll.code===Ql.PERMISSION_DENIED)throw Ll;Vl.warning("getUserMedia failed in getDevices",Ll)}this.isAccessCameraPermission=!0}Vl.debug("[device manager] mic permission",_e,"cam permission",_t)}try{const xl=await navigator.mediaDevices.enumerateDevices();return Rl&&Rl.getTracks().forEach(Ll=>Ll.stop()),Al&&Al.getTracks().forEach(Ll=>Ll.stop()),Ol&&Ol.getTracks().forEach(Ll=>Ll.stop()),Rl=null,Al=null,Ol=null,xl}catch(xl){return Rl&&Rl.getTracks().forEach(Ll=>Ll.stop()),Al&&Al.getTracks().forEach(Ll=>Ll.stop()),Ol&&Ol.getTracks().forEach(Ll=>Ll.stop()),Rl=null,Al=null,Ol=null,new Tp(Ql.ENUMERATE_DEVICES_FAILED,xl.toString()).throw()}}async getRecordingDevices(){let _e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,_e)).filter(_t=>_t.kind==="audioinput")}async getCamerasDevices(){let _e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,_e)).filter(_t=>_t.kind==="videoinput")}async getSpeakers(){let _e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,_e)).filter(_t=>_t.kind==="audiooutput")}searchDeviceIdByName(_e){let _t=null;return this.deviceInfoMap.forEach(_r=>{_r.device.label===_e&&(_t=_r.device.deviceId)}),_t}async getDeviceById(_e){const _t=(await this.enumerateDevices(!0,!0,!0)).find(_r=>_r.deviceId===_e);if(!_t)throw new Tp(Ql.DEVICE_NOT_FOUND,"deviceId: ".concat(_e));return _t}async init(){this.state=sO.INITING;try{await this.updateDevicesInfo(),this.state=sO.INITEND}catch(_e){throw Vl.warning("Device Detection functionality cannot start properly.",_e.toString()),this.state=sO.IDLE,!function(){return typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1"}()&&new Tp(Ql.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),_e}}async updateDevicesInfo(){const _e=await this.enumerateDevices(!0,!0,!0),_t=Date.now(),_r=[];if(_e[0]&&_e[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const _a=_e.find(yl=>yl.kind==="audioinput"&&yl.deviceId==="default"),_u=_e.find(yl=>yl.kind==="audiooutput"&&yl.deviceId==="default");_a&&_u?_u.groupId===_a.groupId?Vl.debug("[device-check] default input ".concat(_a.label," and output ").concat(_u.label," is the same group")):Vl.warning("[device-check] default input ".concat(_a.label," and output ").concat(_u.label," is not the same group")):Vl.debug("[device-check] default input or output not found")}const _o=this.checkMediaDeviceInfoIsOk(_e);if(_e.forEach(_a=>{if(!_a.deviceId)return;const _u=this.deviceInfoMap.get("".concat(_a.kind,"_").concat(_a.deviceId));if((_u?_u.state:"INACTIVE")!=="ACTIVE"){const yl={initAt:_t,updateAt:_t,device:_a,state:"ACTIVE"};this.deviceInfoMap.set("".concat(_a.kind,"_").concat(_a.deviceId),yl),_r.push(yl)}_u&&(_u.updateAt=_t)}),this.deviceInfoMap.forEach((_a,_u)=>{_a.state==="ACTIVE"&&_a.updateAt!==_t&&(_a.state="INACTIVE",_r.push(_a))}),this.state!==sO.INITEND)return _o.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(_o.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));_r.forEach(_a=>{switch(_a.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(LR.RECORDING_DEVICE_CHANGED,_a);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(LR.CAMERA_DEVICE_CHANGED,_a);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(LR.PLAYOUT_DEVICE_CHANGED,_a)}}),_o.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),_o.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(_e){const _t=_e.filter(_a=>_a.kind==="audioinput"),_r=_e.filter(_a=>_a.kind==="videoinput"),_o={audio:!1,video:!1};for(const _a of _t)if(_a.label&&_a.deviceId){_o.audio=!0;break}for(const _a of _r)if(_a.label&&_a.deviceId){_o.video=!0;break}return _o}},jte=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],kT=new class{constructor(){Ml(this,"onAutoplayFailed",void 0),Ml(this,"elementMap",new Map),Ml(this,"elementStateMap",new Map),Ml(this,"elementsNeedToResume",[]),Ml(this,"sinkIdMap",new Map),Ml(this,"autoResumeAfterInterruption",()=>{Array.from(this.elementMap.entries()).forEach(_e=>{let[_t,_r]=_e;const _o=this.elementStateMap.get(_t),_a=_r.srcObject.getAudioTracks()[0];XP()?_a&&_a.readyState==="live"&&X0.curState==="running"&&(Vl.debug("auto resume after interruption for iOS 15"),_r.pause(),_r.play()):_o&&_o==="paused"&&_a&&_a.readyState==="live"&&X0.curState==="running"&&(Vl.debug("auto resume after interruption for iOS"),_r.play())})}),Ml(this,"autoResumeAfterInterruptionOnIOS15",()=>{Array.from(this.elementMap.entries()).forEach(_e=>{let[_t,_r]=_e;const _o=_r.srcObject.getAudioTracks()[0];_o&&_o.readyState==="live"&&(Vl.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),_r.pause(),_r.play())})}),this.autoResumeAudioElement(),X0.on(v_.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),X0.on(v_.IOS_15_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15),X0.on(v_.STATE_CHANGE,()=>{eT()&&X0.prevState==="suspended"&&X0.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(_e,_t){const _r=this.elementMap.get(_e);if(this.sinkIdMap.set(_e,_t),_r)try{await _r.setSinkId(_t)}catch(_o){throw new Tp(Ql.PERMISSION_DENIED,"can not set sink id: "+_o.toString())}}play(_e,_t,_r,_o){if(this.elementMap.has(_t))return;const _a=document.createElement("audio");_a.autoplay=!0,_a.srcObject=new MediaStream([_e]),this.bindAudioElementEvents(_t,_a),this.elementMap.set(_t,_a),this.elementStateMap.set(_t,j_.INIT),this.setVolume(_t,_r);const _u=this.sinkIdMap.get(_t);if(_u)try{_a.setSinkId(_u).catch(Rl=>{Vl.warning("[".concat(_t,"] set sink id failed"),Rl.toString())})}catch(Rl){Vl.warning("[".concat(_t,"] set sink id failed"),Rl.toString())}const yl=_a.play();yl&&yl.then&&yl.catch(Rl=>{_o&&g0.autoplayFailed(_o,"audio",Rl.message,_t),Vl.warning("audio element play warning",Rl.toString()),this.elementMap.has(_t)&&Rl.name==="NotAllowedError"&&(Vl.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(_a),IS(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),A7()}))})}updateTrack(_e,_t){const _r=this.elementMap.get(_e);_r&&(_r.srcObject=new MediaStream([_t]))}isPlaying(_e){return this.elementMap.has(_e)}setVolume(_e,_t){const _r=this.elementMap.get(_e);_r&&(_t=Math.max(0,Math.min(100,_t)),_r.volume=_t/100)}stop(_e){const _t=this.elementMap.get(_e);if(this.sinkIdMap.delete(_e),!_t)return;const _r=this.elementsNeedToResume.indexOf(_t);this.elementsNeedToResume.splice(_r,1),_t.srcObject=null,_t.remove(),this.elementMap.delete(_e),this.elementStateMap.delete(_e)}bindAudioElementEvents(_e,_t){jte.forEach(_r=>{_t.addEventListener(_r,_o=>{const _a=this.elementStateMap.get(_e),_u=_o.type==="pause"?"paused":_o.type;if(Vl.debug("[".concat(_e,"] audio-element-status change ").concat(_a," => ").concat(_u)),_o.type==="error"){const yl=_t==null?void 0:_t.error;yl&&Vl.error("[".concat(_e,"] media error, code: ").concat(yl.code,", message: ").concat(yl.message))}this.elementStateMap.set(_e,_u)})})}getPlayerState(_e){return this.elementStateMap.get(_e)||"uninit"}autoResumeAudioElement(){const _e=()=>{this.elementsNeedToResume.forEach(_t=>{_t.play().then(_r=>{Vl.debug("Auto resume audio element success")}).catch(_r=>{Vl.warning("Auto resume audio element failed!",_r)})}),this.elementsNeedToResume=[]};new u0(_t=>{document.body?_t():window.addEventListener("load",()=>_t())}).then(()=>{t2()?document.body.addEventListener("click",_e,!0):(document.body.addEventListener("touchstart",_e,!0),document.body.addEventListener("mousedown",_e,!0))})}};function qy(){return function(_e,_t,_r){const _o=_r.value;return typeof _o=="function"&&(_r.value=function(){this._isClosed&&new Tp(Ql.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning");for(var _a=arguments.length,_u=new Array(_a),yl=0;yl<_a;yl++)_u[yl]=arguments[yl];const Rl=_o.apply(this,_u);return Rl instanceof u0?new u0((Al,Ol)=>{Rl.then(Al).catch(Ol)}):Rl}),_r}}var Fte=tS("Array").values,Bte=iS,$te=Q_,Vte=El,Gte=Fte,k4=Array.prototype,Wte={DOMTokenList:!0,NodeList:!0},sR=function(_e){var _t=_e.values;return _e===k4||Vte(k4,_e)&&_t===k4.values||$te(Wte,Bte(_e))?Gte:_t};function $7(_e,_t){var _r=Object.keys(_e);if(Object.getOwnPropertySymbols){var _o=Object.getOwnPropertySymbols(_e);_t&&(_o=_o.filter(function(_a){return Object.getOwnPropertyDescriptor(_e,_a).enumerable})),_r.push.apply(_r,_o)}return _r}function X5(_e){for(var _t=1;_t<arguments.length;_t++){var _r=arguments[_t]!=null?arguments[_t]:{};_t%2?$7(Object(_r),!0).forEach(function(_o){Ml(_e,_o,_r[_o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_e,Object.getOwnPropertyDescriptors(_r)):$7(Object(_r)).forEach(function(_o){Object.defineProperty(_e,_o,Object.getOwnPropertyDescriptor(_r,_o))})}return _e}class V7 extends Hy{constructor(_t){super(),Ml(this,"name","VideoProcessorDestination"),Ml(this,"ID","0"),Ml(this,"_source",void 0),Ml(this,"videoContext",void 0),Ml(this,"inputTrack",void 0),this.videoContext=_t}get kind(){return"video"}get enabled(){return!0}pipe(){throw new Tp(Ql.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new Tp(Ql.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(_t){if(_t.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);_t.track&&_t.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=_t.track,this.emit($_.ON_TRACK,_t.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit($_.ON_TRACK,void 0)}}class G7 extends Hy{set chained(_t){this._chained=_t}get chained(){return this._chained}constructor(_t,_r){super(),Ml(this,"constraintsMap",new Map),Ml(this,"statsRegistry",[]),Ml(this,"usageRegistry",[]),Ml(this,"trackId",void 0),Ml(this,"direction",void 0),Ml(this,"_chained",!1),this.trackId=_t,this.direction=_r}async getConstraints(){return await W_(this,bT.REQUEST_CONSTRAINTS)}async requestApplyConstraints(_t,_r){var _o;return Vl.info("processor ".concat(_r.name," requestApplyConstraints for ").concat(this.trackId)),_t&&this.constraintsMap.set(_r,_t),$y(this,bT.REQUEST_UPDATE_CONSTRAINTS,Array.from(sR(_o=this.constraintsMap).call(_o)))}async requestRevertConstraints(_t){var _r;if(this.constraintsMap.has(_t))return Vl.info("processor ".concat(_t.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(_t),$y(this,bT.REQUEST_UPDATE_CONSTRAINTS,Array.from(sR(_r=this.constraintsMap).call(_r)))}registerStats(_t,_r,_o){this.statsRegistry.find(_a=>_a.processorID===_t.ID&&_a.processorName===_t.name&&_a.type===_r)||this.statsRegistry.push({processorName:_t.name,processorID:_t.ID,type:_r,cb:_o})}unregisterStats(_t,_r){const _o=this.statsRegistry.findIndex(_a=>_a.processorID===_t.ID&&_a.processorName===_t.name&&_a.type===_r);_o!==-1&&this.statsRegistry.splice(_o,1)}gatherStats(){const _t=[];for(const{processorID:_r,processorName:_o,type:_a,cb:_u}of this.statsRegistry)try{const yl=_u();_t.push({processorID:_r,processorName:_o,type:_a,stats:yl})}catch(yl){Vl.error(new Tp(Ql.UNEXPECTED_ERROR,yl.message))}return _t}registerUsage(_t,_r){this.usageRegistry.find(_o=>_o.processorID===_t.ID&&_o.processorName===_t.name)||this.usageRegistry.push({processorID:_t.ID,processorName:_t.name,cb:_r})}unregisterUsage(_t){const _r=this.usageRegistry.findIndex(_o=>_o.processorID===_t.ID&&_o.processorName===_t.name);_r!==-1&&this.usageRegistry.splice(_r,1)}async gatherUsage(){const _t=[];if(!this.chained)return[];for(const{cb:_r}of this.usageRegistry)try{let _o=_r();_o instanceof u0&&(_o=await _o),_t.push(X5(X5({},_o),{},{direction:this.direction}))}catch(_o){Vl.error("gather extension usage error",_o)}return _t}getDirection(){return this.direction}}class W7 extends Hy{constructor(_t){super(),Ml(this,"name","AudioProcessorDestination"),Ml(this,"ID","0"),Ml(this,"inputTrack",void 0),Ml(this,"inputNode",void 0),Ml(this,"audioProcessorContext",void 0),Ml(this,"_source",void 0),this.audioProcessorContext=_t}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new Tp(Ql.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new Tp(Ql.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit($_.ON_TRACK,void 0),this.emit($_.ON_NODE,void 0)}updateInput(_t){if(_t.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);_t.track&&this.inputTrack!==_t.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=_t.track,this.emit($_.ON_TRACK,this.inputTrack)),_t.node&&this.inputNode!==_t.node&&(this.audioProcessorContext.chained=!0,this.inputNode=_t.node,this.emit($_.ON_NODE,this.inputNode))}}class H7 extends Hy{set chained(_t){this._chained=_t}get chained(){return this._chained}constructor(_t,_r,_o){super(),Ml(this,"constraintsMap",new Map),Ml(this,"statsRegistry",[]),Ml(this,"audioContext",void 0),Ml(this,"trackId",void 0),Ml(this,"direction",void 0),Ml(this,"usageRegistry",[]),Ml(this,"_chained",!1),this.audioContext=_t,this.trackId=_r,this.direction=_o}async getConstraints(){return W_(this,bT.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(_t,_r){var _o;return Vl.info("processor ".concat(_r.name," requestApplyConstraints for ").concat(this.trackId)),_t&&this.constraintsMap.set(_r,_t),$y(this,bT.REQUEST_UPDATE_CONSTRAINTS,Array.from(sR(_o=this.constraintsMap).call(_o)))}async requestRevertConstraints(_t){var _r;if(this.constraintsMap.has(_t))return this.constraintsMap.delete(_t),$y(this,bT.REQUEST_UPDATE_CONSTRAINTS,Array.from(sR(_r=this.constraintsMap).call(_r)))}registerStats(_t,_r,_o){this.statsRegistry.find(_a=>_a.processorID===_t.ID&&_a.processorName===_t.name&&_a.type===_r)||this.statsRegistry.push({processorName:_t.name,processorID:_t.ID,type:_r,cb:_o})}unregisterStats(_t,_r){const _o=this.statsRegistry.findIndex(_a=>_a.processorID===_t.ID&&_a.processorName===_t.name&&_a.type===_r);_o!==-1&&this.statsRegistry.splice(_o,1)}gatherStats(){const _t=[];for(const{processorID:_r,processorName:_o,type:_a,cb:_u}of this.statsRegistry)try{const yl=_u();_t.push({processorID:_r,processorName:_o,type:_a,stats:yl})}catch(yl){Vl.error(new Tp(Ql.UNEXPECTED_ERROR,yl.message))}return _t}registerUsage(_t,_r){this.usageRegistry.find(_o=>_o.processorID===_t.ID&&_o.processorName===_t.name)||this.usageRegistry.push({processorID:_t.ID,processorName:_t.name,cb:_r})}unregisterUsage(_t){const _r=this.usageRegistry.findIndex(_o=>_o.processorID===_t.ID&&_o.processorName===_t.name);_r!==-1&&this.usageRegistry.splice(_r,1)}async gatherUsage(){const _t=[];if(!this.chained)return[];for(const{cb:_r}of this.usageRegistry)try{let _o=_r();_o instanceof u0&&(_o=await _o),_t.push(X5(X5({},_o),{},{direction:this.direction}))}catch(_o){Vl.error("gather extension usage error",_o)}return _t}getDirection(){return this.direction}}class P4 extends Hy{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),Ml(this,"context",void 0),Ml(this,"processSourceNode",void 0),Ml(this,"outputTrack",void 0),Ml(this,"processedNode",void 0),Ml(this,"clonedTrack",void 0),Ml(this,"outputNode",void 0),this.outputNode=new Hte}setVolume(){}createOutputTrack(){throw new Tp(Ql.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class Hte{disconnect(){}connect(){}}let J5,dN=null;class Kte{constructor(){Ml(this,"state","open"),Ml(this,"trigger",void 0),Ml(this,"tasks",[]),Vl.debug("[macro-task-queue] is created."),this.trigger=setTimeout(()=>{this.state="closed",Vl.debug("[macro-task-queue] will be closed, all remaining tasks will execute. [".concat(this.tasks.map(_t=>_t.key),"]")),this.trigger=void 0,this.tasks.forEach(_t=>{let{func:_r}=_t;return _r()}),this.tasks.length=0,Vl.debug("[macro-task-queue] is closed.")})}enqueue(_t,_r){this.state!=="closed"&&(this.tasks.push({key:_t,func:_r}),Vl.debug("[macro-task-queue] is queued, current queue ".concat(this.tasks.length,". ").concat(typeof _t=="string"?_t:"")))}runTask(_t){if(this.state==="closed")return;const _r=this.tasks.findIndex(_o=>_o.key===_t);if(_r!==-1){const _o=this.tasks.splice(_r,1);Vl.debug("[macro-task-queue] is unqueued, current queue ".concat(this.tasks.length,". ").concat(typeof _t=="string"?_t:"")),_o[0].func()}}release(){this.trigger&&(this.state="closed",clearTimeout(this.trigger),this.trigger=void 0,this.tasks.length=0,Vl.debug("[macro-task-queue] is closed."))}}function N4(_e){return function(_t,_r,_o){var _a;const _u=(_a=_o.value)!==null&&_a!==void 0?_a:_o.get,yl=function(){dN&&dN.state==="open"&&dN.runTask(_e);for(var Rl=arguments.length,Al=new Array(Rl),Ol=0;Ol<Rl;Ol++)Al[Ol]=arguments[Ol];return _u==null?void 0:_u.apply(this,...Al)};return _o.value?_o.value=yl:_o.get=yl,_o}}var K7,q7,z7,Y7,X7,J7,Q7,Z7,_G,eW,tW,nW,rW,iW,oW,sW,aW,cW,uW,lW,dW,uy,hW,fW,pW,gW,mW,yW,aR,vW,EW,_W,bW,TW,SW,RW,AW,IW,wW,TT;function OW(_e,_t){var _r=Object.keys(_e);if(Object.getOwnPropertySymbols){var _o=Object.getOwnPropertySymbols(_e);_t&&(_o=_o.filter(function(_a){return Object.getOwnPropertyDescriptor(_e,_a).enumerable})),_r.push.apply(_r,_o)}return _r}function L4(_e){for(var _t=1;_t<arguments.length;_t++){var _r=arguments[_t]!=null?arguments[_t]:{};_t%2?OW(Object(_r),!0).forEach(function(_o){Ml(_e,_o,_r[_o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_e,Object.getOwnPropertyDescriptors(_r)):OW(Object(_r)).forEach(function(_o){Object.defineProperty(_e,_o,Object.getOwnPropertyDescriptor(_r,_o))})}return _e}(function(_e){_e.UPDATE_TRACK_SOURCE="update-track-source"})(J5||(J5={}));let V_=(K7=N4("INIT_WEBAUDIO"),q7=N4("INIT_WEBAUDIO"),z7=N4("INIT_WEBAUDIO"),Y7=_0({argsMap:(_e,_t)=>[_e.getTrackId(),_t],throttleTime:300}),X7=_0({argsMap:(_e,_t)=>[_e.getTrackId(),_t]}),J7=qy(),Q7=cN("LocalAudioTrack","_enabledMutex"),Z7=_0({argsMap:(_e,_t)=>[_e.getTrackId(),_t]}),_G=qy(),eW=cN("LocalAudioTrack","_enabledMutex"),tW=_0({argsMap:(_e,_t)=>[_e.getTrackId(),_t]}),nW=qy(),rW=qy(),iW=qy(),oW=_0({argsMap:_e=>[_e.getTrackId()]}),sW=qy(),aW=_0({argsMap:_e=>[_e.getTrackId()]}),cW=qy(),uW=_0({argsMap:_e=>[_e.getTrackId()]}),lW=_0({argsMap:(_e,_t)=>[_e.getTrackId(),_t.name]}),dW=_0({argsMap:_e=>[_e.getTrackId()]}),Yp((uy=class extends w4{get _source(){return this._trackSource}set _source(_e){this._trackSource=_e}get processorContext(){return this._processorContext}set processorContext(_e){this._processorContext=_e}get processorDestination(){return this._processorDestination}set processorDestination(_e){this._processorDestination=_e}get isPlaying(){return this._useAudioElement?kT.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(_e,_t,_r,_o,_a){super(_e,_r),Ml(this,"trackMediaType","audio"),Ml(this,"_encoderConfig",void 0),Ml(this,"_trackSource",void 0),Ml(this,"_enabled",!0),Ml(this,"_volume",100),Ml(this,"_useAudioElement",!1),Ml(this,"_bypassWebAudio",!1),Ml(this,"processor",void 0),Ml(this,"_processorContext",void 0),Ml(this,"_processorDestination",void 0),Ml(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=_t,this._getOriginVolumeLevel=!!_o;const _u=()=>{this.processorContext=new H7(this._source.context,this.getTrackId(),"local"),this.processorDestination=new W7(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(_T.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})},yl=_a&&_b()&&!k7();Pp("DISABLE_WEBAUDIO")?(this._source=new P4,this._useAudioElement=!0,this._bypassWebAudio=!0):yl?this._source=new P4:(this._source=new C4(_e,!1,this._getOriginVolumeLevel?_e:void 0),Pp("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")||(this._useAudioElement=!0)),_u(),!Pp("DISABLE_WEBAUDIO")&&yl&&(dN||(dN=new Kte),dN).enqueue("INIT_WEBAUDIO",()=>{this._source=new C4(_e,!1,this._getOriginVolumeLevel?_e:void 0),Pp("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")||(this._useAudioElement=!0),_u(),this.emit(J5.UPDATE_TRACK_SOURCE)})}setVolume(_e){wy(_e,"volume",0,1e3),this._volume=_e,this._source.setVolume(_e/100),this._useAudioElement&&kT.setVolume(this.getTrackId(),_e);try{if(this._bypassWebAudio)return void Vl.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const _t=this._source.createOutputTrack();this._mediaStreamTrack!==_t&&(this._mediaStreamTrack=_t,$y(this,w0.NEED_REPLACE_TRACK,this).then(()=>{Vl.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(_r=>{Vl.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),_r)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(_e){if(!this._useAudioElement)throw new Tp(Ql.NOT_SUPPORTED,"your browser does not support setting the audio output device");await kT.setSinkID(this.getTrackId(),_e)}async setEnabled(_e,_t,_r){return this._setEnabled(_e,_t,_r)}async _setEnabled(_e,_t,_r){if(!_r){if(_e===this._enabled)return;this.stateCheck("enabled",_e)}if(Vl.info("[".concat(this.getTrackId(),"] start setEnabled"),_e),_e){this._originMediaStreamTrack.enabled=!0;try{_r||(this._enabled=!0),await $y(this,w0.NEED_ENABLE_TRACK,this),Vl.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(_e," success"))}catch(_o){throw _r||(this._enabled=!1),Vl.error("[".concat(this.getTrackId(),"] setEnabled to true error"),_o.toString()),_o}}else{this._originMediaStreamTrack.enabled=!1,_r||(this._enabled=!1);try{await $y(this,w0.NEED_DISABLE_TRACK,this)}catch(_o){throw _r||(this._enabled=!0),Vl.error("[".concat(this.getTrackId(),"] setEnabled to false error"),_o.toString()),_o}}}async setMuted(_e){_e!==this._muted&&(this.stateCheck("muted",_e),this._muted=_e,this._originMediaStreamTrack.enabled=!_e,Vl.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(_e)),_e?await $y(this,w0.NEED_MUTE_TRACK,this):await $y(this,w0.NEED_UNMUTE_TRACK,this))}getStats(){return l2(()=>{Vl.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),cR(this,w0.GET_STATS)||L4({},h4)}setAudioFrameCallback(_e){let _t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!_e)return this._source.removeAllListeners(_T.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(_t),this._source.removeAllListeners(_T.ON_AUDIO_BUFFER),this._source.on(_T.ON_AUDIO_BUFFER,_r=>_e(_r))}play(){Vl.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(Vl.debug("[".concat(this.getTrackId(),"] start audio playback in element")),kT.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){Vl.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?kT.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let _e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];Vl.debug("[".concat(this.getTrackId(),"] update player source track")),_e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&kT.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(_e,_t){this._originMediaStreamTrack!==_e&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),_e.addEventListener("ended",this._handleTrackEnded),_t&&this._originMediaStreamTrack.stop(),this._originMediaStreamTrack=_e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this.processor.updateInput({track:_e,context:this.processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await $y(this,w0.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(_e))}renewMediaStreamTrack(_e){return u0.resolve(void 0)}pipe(_e){if(this._bypassWebAudio)throw new Tp(Ql.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===_e)return _e;if(_e._source)throw new Tp(Ql.INVALID_OPERATION,"Processor ".concat(_e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=_e,this.processor._source=this,_e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),_e}unpipe(){var _e;if(!this.processor)return;const _t=this.processor;(_e=this._source.processSourceNode)===null||_e===void 0||_e.disconnect(),this.processor._source=!1,this.processor=void 0,_t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on($_.ON_TRACK,async _e=>{_e?_e!==this._mediaStreamTrack&&(this._mediaStreamTrack=_e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(_e),await $y(this,w0.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await $y(this,w0.NEED_REPLACE_TRACK,this))}),this.processorDestination.on($_.ON_NODE,_e=>{this._source.processedNode=_e})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners($_.ON_TRACK),this.processorDestination.removeAllListeners($_.ON_NODE)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(bT.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(bT.REQUEST_CONSTRAINTS)}}).prototype,"_source",[K7],Object.getOwnPropertyDescriptor(uy.prototype,"_source"),uy.prototype),Yp(uy.prototype,"processorContext",[q7],Object.getOwnPropertyDescriptor(uy.prototype,"processorContext"),uy.prototype),Yp(uy.prototype,"processorDestination",[z7],Object.getOwnPropertyDescriptor(uy.prototype,"processorDestination"),uy.prototype),Yp(uy.prototype,"setVolume",[Y7],Object.getOwnPropertyDescriptor(uy.prototype,"setVolume"),uy.prototype),Yp(uy.prototype,"setPlaybackDevice",[X7,J7],Object.getOwnPropertyDescriptor(uy.prototype,"setPlaybackDevice"),uy.prototype),Yp(uy.prototype,"setEnabled",[Q7,Z7,_G],Object.getOwnPropertyDescriptor(uy.prototype,"setEnabled"),uy.prototype),Yp(uy.prototype,"setMuted",[eW,tW,nW],Object.getOwnPropertyDescriptor(uy.prototype,"setMuted"),uy.prototype),Yp(uy.prototype,"getStats",[rW],Object.getOwnPropertyDescriptor(uy.prototype,"getStats"),uy.prototype),Yp(uy.prototype,"setAudioFrameCallback",[iW],Object.getOwnPropertyDescriptor(uy.prototype,"setAudioFrameCallback"),uy.prototype),Yp(uy.prototype,"play",[oW,sW],Object.getOwnPropertyDescriptor(uy.prototype,"play"),uy.prototype),Yp(uy.prototype,"stop",[aW,cW],Object.getOwnPropertyDescriptor(uy.prototype,"stop"),uy.prototype),Yp(uy.prototype,"close",[uW],Object.getOwnPropertyDescriptor(uy.prototype,"close"),uy.prototype),Yp(uy.prototype,"pipe",[lW],Object.getOwnPropertyDescriptor(uy.prototype,"pipe"),uy.prototype),Yp(uy.prototype,"unpipe",[dW],Object.getOwnPropertyDescriptor(uy.prototype,"unpipe"),uy.prototype),uy),Q5=(hW=_0({argsMap:(_e,_t)=>[_e.getTrackId(),_t]}),fW=qy(),pW=cN("MicrophoneAudioTrack","_enabledMutex"),gW=_0({argsMap:(_e,_t,_r)=>[_e.getTrackId(),_t,_r]}),mW=qy(),yW=_0({argsMap:_e=>[_e.getTrackId()]}),Yp((aR=class extends V_{get __className__(){return"MicrophoneAudioTrack"}constructor(_e,_t,_r,_o){super(_e,_t.encoderConfig?G5(_t.encoderConfig):{},_o,Pp("GET_VOLUME_OF_MUTED_AUDIO_TRACK"),!0),Ml(this,"_config",void 0),Ml(this,"_deviceName","default"),Ml(this,"_constraints",void 0),Ml(this,"_originalConstraints",void 0),Ml(this,"_enabled",!0),this._config=_t,this._constraints=_r,this._originalConstraints=_r,this._deviceName=_e.label,typeof _t.bypassWebAudio=="boolean"&&(this._bypassWebAudio=_t.bypassWebAudio),XP()&&X0.bindInterruptDetectorTrack(this),this.on(J5.UPDATE_TRACK_SOURCE,()=>{this.bindProcessorContextEvents()}),k7()&&this.bindProcessorContextEvents()}async setDevice(_e){if(Vl.info("[".concat(this.getTrackId(),"] start set device to ").concat(_e)),this._enabled)try{const _t=await zT.getDeviceById(_e),_r={};_r.audio=L4({},this._constraints),_r.audio.deviceId={exact:_e},this._originMediaStreamTrack.stop();let _o=null;try{_o=await AS(_r,this.getTrackId())}catch(_a){throw Vl.error("[".concat(this.getTrackId(),"] setDevice failed"),_a.toString()),_o=await AS({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(_o.getAudioTracks()[0],!1),_a}await this._updateOriginMediaStreamTrack(_o.getAudioTracks()[0],!1),this._deviceName=_t.label,this._config.microphoneId=_e,this._constraints.deviceId={exact:_e}}catch(_t){throw Vl.error("[".concat(this.getTrackId(),"] setDevice error"),_t.toString()),_t}else try{const _t=await zT.getDeviceById(_e);this._deviceName=_t.label,this._config.microphoneId=_e,this._constraints.deviceId={exact:_e}}catch(_t){throw Vl.error("[".concat(this.getTrackId(),"] setDevice error"),_t.toString()),_t}Vl.info("[".concat(this.getTrackId(),"] set device to ").concat(_e," success"))}async setEnabled(_e,_t,_r){if(_t)return Vl.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(_e);if(!_r){if(_e===this._enabled)return;this.stateCheck("enabled",_e)}if(Vl.info("[".concat(this.getTrackId(),"] start setEnabled"),_e),!_e){var _o;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(_o=this._source.clonedTrack)===null||_o===void 0||_o.stop(),_r||(this._enabled=!1);try{await $y(this,w0.NEED_DISABLE_TRACK,this)}catch(yl){throw Vl.error("[".concat(this.getTrackId(),"] setEnabled false failed"),yl.toString()),yl}return}const _a=L4({},this._constraints),_u=zT.searchDeviceIdByName(this._deviceName);_u&&!_a.deviceId&&(_a.deviceId=_u);try{_r||(this._enabled=!0);const yl=await AS({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(yl.getAudioTracks()[0],!1),await $y(this,w0.NEED_ENABLE_TRACK,this)}catch(yl){throw _r||(this._enabled=!1),Vl.error("[".concat(this.getTrackId(),"] setEnabled true failed"),yl.toString()),yl}Vl.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),XP()&&X0.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((eT()||rR())&&this._enabled&&!this._isClosed&&X0.duringInterruption){const _e=async()=>{X0.off(v_.IOS_INTERRUPTION_END,_e),this._enabled&&!this._isClosed&&(Vl.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};X0.on(v_.IOS_INTERRUPTION_END,_e)}else Vl.debug("[".concat(this.getTrackId(),"] track ended")),this.emit(f1.TRACK_ENDED)}async renewMediaStreamTrack(_e){const _t=_e||this._constraints,_r=zT.searchDeviceIdByName(this._deviceName);if(_r&&!_t.deviceId&&(_t.deviceId=_r),this._constraints=_t,this._enabled){this._originMediaStreamTrack.stop();const _o=await AS({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(_o.getAudioTracks()[0],!0)}}bindProcessorContextEvents(){this.processorContext.on(bT.REQUEST_UPDATE_CONSTRAINTS,async(_e,_t,_r)=>{try{const _o=Object.assign({},this._originalConstraints,..._e);await this.renewMediaStreamTrack(_o),_t()}catch(_o){_r(_o)}}),this.processorContext.on(bT.REQUEST_CONSTRAINTS,async _e=>{_e(this._originMediaStreamTrack.getSettings())})}}).prototype,"setDevice",[hW,fW],Object.getOwnPropertyDescriptor(aR.prototype,"setDevice"),aR.prototype),Yp(aR.prototype,"setEnabled",[pW,gW,mW],Object.getOwnPropertyDescriptor(aR.prototype,"setEnabled"),aR.prototype),Yp(aR.prototype,"close",[yW],Object.getOwnPropertyDescriptor(aR.prototype,"close"),aR.prototype),aR),qte=(vW=_0({argsMap:(_e,_t)=>[_e.getTrackId(),_t,_e.duration]}),EW=qy(),_W=_0({argsMap:_e=>[_e.getTrackId()]}),bW=qy(),TW=_0({argsMap:_e=>[_e.getTrackId()]}),SW=qy(),RW=_0({argsMap:_e=>[_e.getTrackId()]}),AW=qy(),IW=_0({argsMap:_e=>[_e.getTrackId()]}),wW=qy(),Yp((TT=class extends V_{get __className__(){return"BufferSourceAudioTrack"}constructor(_e,_t,_r,_o){super(_t.createOutputTrack(),_r,_o),Ml(this,"source",void 0),Ml(this,"_bufferSource",void 0),this.source=_e,this._bufferSource=_t,this._bufferSource.on(_T.AUDIO_SOURCE_STATE_CHANGE,_a=>{this.emit(f1.SOURCE_STATE_CHANGE,_a)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(_e){_e&&this._bufferSource.updateOptions(_e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(_e){this._bufferSource.seekAudioBuffer(_e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}}).prototype,"startProcessAudioBuffer",[vW,EW],Object.getOwnPropertyDescriptor(TT.prototype,"startProcessAudioBuffer"),TT.prototype),Yp(TT.prototype,"pauseProcessAudioBuffer",[_W,bW],Object.getOwnPropertyDescriptor(TT.prototype,"pauseProcessAudioBuffer"),TT.prototype),Yp(TT.prototype,"seekAudioBuffer",[TW,SW],Object.getOwnPropertyDescriptor(TT.prototype,"seekAudioBuffer"),TT.prototype),Yp(TT.prototype,"resumeProcessAudioBuffer",[RW,AW],Object.getOwnPropertyDescriptor(TT.prototype,"resumeProcessAudioBuffer"),TT.prototype),Yp(TT.prototype,"stopProcessAudioBuffer",[IW,wW],Object.getOwnPropertyDescriptor(TT.prototype,"stopProcessAudioBuffer"),TT.prototype),TT);class cS extends V_{get __className__(){return"MixingAudioTrack"}get isActive(){for(const _t of this.trackList)if(_t._enabled&&!_t._isClosed&&!_t.muted)return!0;return!1}constructor(){const _t=uN().createMediaStreamDestination();super(_t.stream.getAudioTracks()[0],void 0,Ny(8,"track-mix-")),Ml(this,"trackList",void 0),Ml(this,"destNode",void 0);try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=_t,this.trackList=[]}hasAudioTrack(_t){return this.trackList.indexOf(_t)!==-1}addAudioTrack(_t){this.trackList.indexOf(_t)===-1?(Vl.debug("add ".concat(_t.getTrackId()," to mixing track")),_t._source.outputNode.connect(this.destNode),this.trackList.push(_t),this.updateEncoderConfig()):Vl.debug("track ".concat(_t.getTrackId()," is already added"))}removeAudioTrack(_t){if(this.trackList.indexOf(_t)!==-1){Vl.debug("remove ".concat(_t.getTrackId()," from mixing track"));try{_t._source.outputNode.disconnect(this.destNode)}catch{}U4(this.trackList,_t),this.updateEncoderConfig()}}updateEncoderConfig(){const _t={};this.trackList.forEach(_r=>{_r._encoderConfig&&((_r._encoderConfig.bitrate||0)>(_t.bitrate||0)&&(_t.bitrate=_r._encoderConfig.bitrate),(_r._encoderConfig.sampleRate||0)>(_t.sampleRate||0)&&(_t.sampleRate=_r._encoderConfig.sampleRate),(_r._encoderConfig.sampleSize||0)>(_t.sampleSize||0)&&(_t.sampleSize=_r._encoderConfig.sampleSize),_r._encoderConfig.stereo&&(_t.stereo=!0))}),this._encoderConfig=_t}}class zte extends Hy{constructor(){super(...arguments),Ml(this,"resultStorage",new Map)}setLocalAudioStats(_t,_r,_o){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",_t,this.checkAudioInputLevel(_o,_r)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",_t,this.checkSendAudioBitrate(_o,_r))}setLocalVideoStats(_t,_r,_o){this.record("SEND_VIDEO_BITRATE_TOO_LOW",_t,this.checkSendVideoBitrate(_o,_r)),this.record("FRAMERATE_INPUT_TOO_LOW",_t,this.checkFramerateInput(_o,_r)),this.record("FRAMERATE_SENT_TOO_LOW",_t,this.checkFramerateSent(_o))}setRemoteAudioStats(_t,_r){const _o=_t.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",_o,this.checkAudioOutputLevel(_r))}setRemoteVideoStats(_t,_r){const _o=_t.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",_o,this.checkVideoDecode(_r))}record(_t,_r,_o){this.resultStorage.has(_t)||this.resultStorage.set(_t,{result:[],isPrevNormal:!0});const _a=this.resultStorage.get(_t);if(_a&&(_a.result.push(_o),_a.result.length>=5)){const _u=_a.result.includes(!0);_a.isPrevNormal&&!_u&&this.emit("exception",CW[_t],_t,_r),!_a.isPrevNormal&&_u&&this.emit("exception",CW[_t]+2e3,_t+"_RECOVER",_r),_a.isPrevNormal=_u,_a.result=[]}}checkAudioOutputLevel(_t){return!(_t.receiveBitrate>0&&_t.receiveLevel===0)}checkAudioInputLevel(_t,_r){return _r instanceof cS&&!_r.isActive||!!_r.muted||_t.sendVolumeLevel!==0}checkFramerateInput(_t,_r){let _o=null;_r._encoderConfig&&_r._encoderConfig.frameRate&&(_o=MR(_r._encoderConfig.frameRate));const _a=_t.captureFrameRate;return!_o||!_a||!(_o>10&&_a<5||_o<10&&_o>=5&&_a<=1)}checkFramerateSent(_t){return!(_t.captureFrameRate&&_t.sendFrameRate&&_t.captureFrameRate>5&&_t.sendFrameRate<=1)}checkSendVideoBitrate(_t,_r){return!!_r.muted||_t.sendBitrate!==0}checkSendAudioBitrate(_t,_r){return _r instanceof cS&&!_r.isActive||!!_r.muted||_t.sendBitrate!==0}checkVideoDecode(_t){return _t.receiveBitrate===0||_t.decodeFrameRate!==0}}const CW={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},uS=new class{markSubscribeStart(_e,_t){performance.mark("agora-web-sdk/".concat(_e,"/subscribe-").concat(_t))}markPublishStart(_e,_t){performance.mark("agora-web-sdk/".concat(_e,"/publish-").concat(_t))}measureFromSubscribeStart(_e,_t){const _r=performance.getEntriesByName("agora-web-sdk/".concat(_e,"/subscribe-").concat(_t));if(_r.length>0){const _o=_r[_r.length-1];return Math.round(performance.now()-_o.startTime)}return 0}measureFromPublishStart(_e,_t){const _r=performance.getEntriesByName("agora-web-sdk/".concat(_e,"/publish-").concat(_t));if(_r.length>0){const _o=_r[_r.length-1];return Math.round(performance.now()-_o.startTime)}return 0}};function xW(_e,_t){var _r=Object.keys(_e);if(Object.getOwnPropertySymbols){var _o=Object.getOwnPropertySymbols(_e);_t&&(_o=_o.filter(function(_a){return Object.getOwnPropertyDescriptor(_e,_a).enumerable})),_r.push.apply(_r,_o)}return _r}function uO(_e){for(var _t=1;_t<arguments.length;_t++){var _r=arguments[_t]!=null?arguments[_t]:{};_t%2?xW(Object(_r),!0).forEach(function(_o){Ml(_e,_o,_r[_o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_e,Object.getOwnPropertyDescriptors(_r)):xW(Object(_r)).forEach(function(_o){Object.defineProperty(_e,_o,Object.getOwnPropertyDescriptor(_r,_o))})}return _e}class hN{constructor(_t){Ml(this,"store",void 0),Ml(this,"onStatsException",void 0),Ml(this,"onUploadPublishDuration",void 0),Ml(this,"localStats",new Map),Ml(this,"remoteStats",new Map),Ml(this,"updateStatsInterval",void 0),Ml(this,"trafficStats",void 0),Ml(this,"trafficStatsPeerList",[]),Ml(this,"uplinkStats",void 0),Ml(this,"exceptionMonitor",void 0),Ml(this,"p2pChannel",void 0),Ml(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=_t,this.updateStatsInterval=window.setInterval(this.updateStats,1e3),this.exceptionMonitor=new zte,this.exceptionMonitor.on("exception",(_r,_o,_a)=>{this.onStatsException&&this.onStatsException(_r,_o,_a)})}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(l0.LocalAudioTrack)||uO({},h4)}getLocalVideoTrackStats(){return this.localStats.get(l0.LocalVideoTrack)||uO({},f4)}getRemoteAudioTrackStats(_t){const _r=(_u,yl)=>{if(!this.trafficStats)return yl;const Rl=this.trafficStats.peer_delay.find(Al=>Al.peer_uid===_u);return Rl&&(yl.publishDuration=Rl.B_ppad+(Date.now()-this.trafficStats.timestamp)),yl},_o={};if(_t){var _a;const _u=(_a=this.remoteStats.get(_t))===null||_a===void 0?void 0:_a.audioStats;_u&&(_o[_t]=_r(_t,_u))}else Array.from(this.remoteStats.entries()).forEach(_u=>{let[yl,{audioStats:Rl}]=_u;Rl&&(_o[yl]=_r(yl,Rl))});return _o}getRemoteNetworkQualityStats(_t){const _r={};if(_t){var _o;const _a=(_o=this.remoteStats.get(_t))===null||_o===void 0?void 0:_o.networkStats;_a&&(_r[_t]=_a)}else Array.from(this.remoteStats.entries()).forEach(_a=>{let[_u,{networkStats:yl}]=_a;yl&&(_r[_u]=yl)});return _r}getRemoteVideoTrackStats(_t){const _r=(_u,yl)=>{if(!this.trafficStats)return yl;const Rl=this.trafficStats.peer_delay.find(Al=>Al.peer_uid===_u);return Rl&&(yl.publishDuration=Rl.B_ppvd+(Date.now()-this.trafficStats.timestamp)),yl},_o={};if(_t){var _a;const _u=(_a=this.remoteStats.get(_t))===null||_a===void 0?void 0:_a.videoStats;_u&&(_o[_t]=_r(_t,_u))}else Array.from(this.remoteStats.entries()).forEach(_u=>{let[yl,{videoStats:Rl}]=_u;Rl&&(_o[yl]=_r(yl,Rl))});return _o}getRTCStats(){let _t=0,_r=0,_o=0,_a=0;const _u=this.localStats.get(l0.LocalAudioTrack);_u&&(_t+=_u.sendBytes,_r+=_u.sendBitrate);const yl=this.localStats.get(l0.LocalVideoTrack);yl&&(_t+=yl.sendBytes,_r+=yl.sendBitrate);const Rl=this.localStats.get(l0.LocalVideoLowTrack);Rl&&(_t+=Rl.sendBytes,_r+=Rl.sendBitrate),this.remoteStats.forEach(Ol=>{let{audioStats:xl,videoStats:Ll}=Ol;xl&&(_o+=xl.receiveBytes,_a+=xl.receiveBitrate),Ll&&(_o+=Ll.receiveBytes,_a+=Ll.receiveBitrate)});let Al=1;return this.trafficStats&&(Al+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:Al,SendBitrate:_r,SendBytes:_t,RecvBytes:_o,RecvBitrate:_a,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(_t){this.localStats.set(_t,void 0)}removeLocalStats(_t){_t?this.localStats.delete(_t):this.localStats.clear()}addRemoteStats(_t){this.remoteStats.set(_t,{})}removeRemoteStats(_t){_t?this.remoteStats.delete(_t):this.remoteStats.clear()}addP2PChannel(_t){this.p2pChannel=_t}updateTrafficStats(_t){_t.peer_delay=_t.peer_delay.filter(_r=>_r.B_ppad!==void 0||_r.B_ppvd!==void 0),_t.peer_delay.filter(_r=>this.trafficStatsPeerList.indexOf(_r.peer_uid)===-1).forEach(_r=>{var _o;const _a=(_o=this.p2pChannel)===null||_o===void 0?void 0:_o.getRemoteMedia(_r.peer_uid),_u=_a!=null&&_a.videoSSRC?uS.measureFromSubscribeStart(this.store.clientId,_a.videoSSRC):0,yl=_a!=null&&_a.audioSSRC?uS.measureFromSubscribeStart(this.store.clientId,_a.audioSSRC):0;_r.B_ppad!==void 0&&_r.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(_r.peer_uid,_r.B_ppad,_r.B_ppvd,_u>yl?_u:yl),this.trafficStatsPeerList.push(_r.peer_uid))}),this.trafficStats=_t}updateUplinkStats(_t){this.uplinkStats&&this.uplinkStats.B_fir!==_t.B_fir&&Vl.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(_t.B_fir)),this.uplinkStats=_t}static isRemoteVideoFreeze(_t,_r,_o){if(!_t)return!1;const _a=!!_o&&_r.framesDecodeFreezeTime>_o.framesDecodeFreezeTime,_u=!_o||_r.framesDecodeCount>_o.framesDecodeCount;return _a||!_u}static isRemoteAudioFreeze(_t){return!!_t&&_t._isFreeze()}isLocalVideoFreeze(_t){return!(!_t.inputFrame||!_t.sentFrame)&&_t.inputFrame.frameRate>5&&_t.sentFrame.frameRate<3}updateLocalStats(_t){Array.from(this.localStats.entries()).forEach(_r=>{let[_o,_a]=_r;switch(_o){case l0.LocalVideoTrack:case l0.LocalVideoLowTrack:{const _u=_a,yl=uO({},f4),Rl=_t.getStats(),Al=_t.getLocalMedia(_o);if(Rl){const Ol=Rl.videoSend.find(xl=>xl.ssrc===(Al==null?void 0:Al.ssrcs[0].ssrcId));if(Ol){const xl=_t.getLocalVideoSize(),Ll=_t.getEncoderConfig(l0.LocalVideoTrack);Ol.codec!=="H264"&&Ol.codec!=="VP8"&&Ol.codec!=="VP9"&&Ol.codec!=="AV1X"&&Ol.codec!=="AV1"||(yl.codecType=Ol.codec),yl.sendBytes=Ol.bytes,yl.sendBitrate=_u?8*Math.max(0,yl.sendBytes-_u.sendBytes):0,Ol.inputFrame?(yl.captureFrameRate=Ol.inputFrame.frameRate,yl.captureResolutionHeight=Ol.inputFrame.height,yl.captureResolutionWidth=Ol.inputFrame.width):xl&&(yl.captureResolutionWidth=xl.width,yl.captureResolutionHeight=xl.height),Ol.sentFrame?(yl.sendFrameRate=Ol.sentFrame.frameRate,yl.sendResolutionHeight=Ol.sentFrame.height,yl.sendResolutionWidth=Ol.sentFrame.width):xl&&(yl.sendResolutionWidth=xl.width,yl.sendResolutionHeight=xl.height),Ol.avgEncodeMs&&(yl.encodeDelay=Ol.avgEncodeMs),Ll&&Ll.bitrateMax&&(yl.targetSendBitrate=1e3*Ll.bitrateMax),yl.sendPackets=Ol.packets,yl.sendPacketsLost=Ol.packetsLost,yl.totalDuration=_u?_u.totalDuration+1:1,yl.totalFreezeTime=_u?_u.totalFreezeTime:0,this.isLocalVideoFreeze(Ol)&&(yl.totalFreezeTime+=1)}this.trafficStats&&(yl.sendPacketsLost=this.trafficStats.B_pvlr4/100)}this.localStats.set(_o,yl),yl&&Al&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,Al.track,yl);break}case l0.LocalAudioTrack:{const _u=_a,yl=uO({},h4),Rl=_t.getStats(),Al=_t.getLocalMedia(_o);if(Rl){const Ol=Rl.audioSend.find(xl=>xl.ssrc===(Al==null?void 0:Al.ssrcs[0].ssrcId));if(Ol){if(Ol.codec!=="opus"&&Ol.codec!=="aac"&&Ol.codec!=="PCMU"&&Ol.codec!=="PCMA"&&Ol.codec!=="G722"||(yl.codecType=Ol.codec),Ol.inputLevel)yl.sendVolumeLevel=Math.round(32767*Ol.inputLevel);else{const xl=_t.getLocalAudioVolume();xl&&(yl.sendVolumeLevel=Math.round(32767*xl))}yl.sendBytes=Ol.bytes,yl.sendPackets=Ol.packets,yl.sendPacketsLost=Ol.packetsLost,yl.sendBitrate=_u?8*Math.max(0,yl.sendBytes-_u.sendBytes):0}}this.trafficStats&&(yl.sendPacketsLost=this.trafficStats.B_pvlr4/100),this.localStats.set(l0.LocalAudioTrack,yl),yl&&Al&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,Al.track,yl);break}}})}updateRemoteStats(_t){Array.from(this.remoteStats.entries()).forEach(_r=>{let[_o,{videoStats:_a,audioStats:_u,videoPcStats:yl}]=_r;const Rl=_u,Al=_a,Ol=yl,xl=uO({},o7),Ll=uO({},s7),Bl=uO({},wee),{audioTrack:Hl,videoTrack:up,audioSSRC:_f,videoSSRC:vp}=_t.getRemoteMedia(_o),Dp=_t.getStats(),Bp=Dp==null?void 0:Dp.audioRecv.find(e0=>e0.ssrc===_f),_g=Dp==null?void 0:Dp.videoRecv.find(e0=>e0.ssrc===vp),y0=this.trafficStats&&this.trafficStats.peer_delay.find(e0=>e0.peer_uid===_o);if(Bp&&(Bp.codec!=="opus"&&Bp.codec!=="aac"&&Bp.codec!=="PCMU"&&Bp.codec!=="PCMA"&&Bp.codec!=="G722"||(xl.codecType=Bp.codec),Bp.outputLevel?xl.receiveLevel=Math.round(32767*Bp.outputLevel):Hl&&(xl.receiveLevel=Math.round(32767*Hl.getVolumeLevel())),xl.receiveBytes=Bp.bytes,xl.receivePackets=Bp.packets,xl.receivePacketsLost=Bp.packetsLost,xl.packetLossRate=xl.receivePacketsLost/(xl.receivePackets+xl.receivePacketsLost),xl.receiveBitrate=Rl?8*Math.max(0,xl.receiveBytes-Rl.receiveBytes):0,xl.totalDuration=Rl?Rl.totalDuration+1:1,xl.totalFreezeTime=Rl?Rl.totalFreezeTime:0,xl.freezeRate=xl.totalFreezeTime/xl.totalDuration,xl.receiveDelay=Bp.jitterBufferMs,xl.totalDuration>10&&hN.isRemoteAudioFreeze(Hl)&&(xl.totalFreezeTime+=1)),_g){_g.codec!=="H264"&&_g.codec!=="VP8"&&_g.codec!=="VP9"&&_g.codec!=="AV1X"&&_g.codec!=="AV1"||(Ll.codecType=_g.codec),Ll.receiveBytes=_g.bytes,Ll.receiveBitrate=Al?8*Math.max(0,Ll.receiveBytes-Al.receiveBytes):0,Ll.decodeFrameRate=_g.decodeFrameRate<0?0:_g.decodeFrameRate,Ll.renderFrameRate=_g.decodeFrameRate<0?0:_g.decodeFrameRate,_g.outputFrame&&(Ll.renderFrameRate=_g.outputFrame.frameRate),_g.receivedFrame?(Ll.receiveFrameRate=_g.receivedFrame.frameRate,Ll.receiveResolutionHeight=_g.receivedFrame.height,Ll.receiveResolutionWidth=_g.receivedFrame.width):up&&(Ll.receiveResolutionHeight=up._videoHeight||0,Ll.receiveResolutionWidth=up._videoWidth||0),_g.framesRateFirefox!==void 0&&(Ll.receiveFrameRate=Math.round(_g.framesRateFirefox)),Ll.receivePackets=_g.packets,Ll.receivePacketsLost=_g.packetsLost,Ll.packetLossRate=Ll.receivePacketsLost/(Ll.receivePackets+Ll.receivePacketsLost),Ll.totalDuration=Al?Al.totalDuration+1:1,Ll.totalFreezeTime=Al?Al.totalFreezeTime:0,Ll.receiveDelay=_g.jitterBufferMs||0;const e0=!!vp&&_t.getRemoteVideoIsReady(vp);up&&e0&&hN.isRemoteVideoFreeze(up,_g,Ol)&&(Ll.totalFreezeTime+=1),Ll.freezeRate=Ll.totalFreezeTime/Ll.totalDuration}y0&&(xl.end2EndDelay=y0.B_ad,Ll.end2EndDelay=y0.B_vd,xl.transportDelay=y0.B_ed,Ll.transportDelay=y0.B_ed,xl.currentPacketLossRate=y0.B_ealr4/100,Ll.currentPacketLossRate=y0.B_evlr4/100,Bl.uplinkNetworkQuality=y0.B_punq?y0.B_punq:0,Bl.downlinkNetworkQuality=y0.B_pdnq?y0.B_pdnq:0),this.remoteStats.set(_o,{audioStats:xl,videoStats:Ll,videoPcStats:_g,networkStats:Bl}),Hl&&this.exceptionMonitor.setRemoteAudioStats(Hl,xl),up&&this.exceptionMonitor.setRemoteVideoStats(up,Ll)})}}const DR=new class extends Hy{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),Ml(this,"_lastHiddenTime",0),Ml(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),Vl.debug("document visibility went ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};function kW(_e,_t){var _r=Object.keys(_e);if(Object.getOwnPropertySymbols){var _o=Object.getOwnPropertySymbols(_e);_t&&(_o=_o.filter(function(_a){return Object.getOwnPropertyDescriptor(_e,_a).enumerable})),_r.push.apply(_r,_o)}return _r}function Z5(_e){for(var _t=1;_t<arguments.length;_t++){var _r=arguments[_t]!=null?arguments[_t]:{};_t%2?kW(Object(_r),!0).forEach(function(_o){Ml(_e,_o,_r[_o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_e,Object.getOwnPropertyDescriptors(_r)):kW(Object(_r)).forEach(function(_o){Object.defineProperty(_e,_o,Object.getOwnPropertyDescriptor(_r,_o))})}return _e}function eU(_e){return _e.match(/^[\.\:\d]+$/)?"".concat(_e.replace(/[^\d]/g,"-"),".").concat(Pp("TURN_DOMAIN")):(Vl.info("Cannot recognized as IP address ".concat(_e,". Used As Host instead")),_e)}function PW(_e,_t){var _r,_o;const _a=Pp("GATEWAY_DOMAINS");let _u=_a[1]&&_t.indexOf(_a[1])!==-1?1:0;_e.addresses=_e.addresses||[];const yl=_e.addresses.map(Al=>Al.domain_prefix?{address:"".concat(Al.domain_prefix,".").concat(_a[_u++%_a.length],":").concat(Al.port)}:Al.ip.match(/^[\.\:\d]+$/)?{ip:Al.ip,port:Al.port,address:"".concat(Al.ip.replace(/[^\d]/g,"-"),".").concat(_a[_u++%_a.length],":").concat(Al.port)}:(Vl.info("Cannot recognized as IP address ".concat(Al.ip,". Used As Host instead")),{ip:Al.ip,port:Al.port,address:"".concat(Al.ip,":").concat(Al.port)}));if((_r=_e.detail)!==null&&_r!==void 0&&_r[18]&&typeof((_o=_e.detail)===null||_o===void 0?void 0:_o[18])=="string"){const Al=_e.detail[18],Ol=Al==null?void 0:Al.split(";");for(let xl=0;xl<Ol.length;xl++){var Rl;const Ll=xR(Rl=Ol[xl]).call(Rl);yl[xl]&&Ll&&(yl[xl].ip6=Ll)}}return{gatewayAddrs:yl,uid:_e.uid,cid:_e.cid,cert:_e.cert,vid:_e.detail&&_e.detail[8],uni_lbs_ip:_e.detail&&_e.detail[1],res:_e,csIp:_e.detail&&_e.detail[502]}}function MR(_e){return typeof _e=="number"?_e:_e.exact||_e.ideal||_e.max||_e.min||0}function NW(_e){const _t=_e._encoderConfig;if(!_t)return{};const _r={resolution:_t.width&&_t.height?"".concat(MR(_t.width),"x").concat(MR(_t.height)):void 0,maxVideoBW:_t.bitrateMax,minVideoBW:_t.bitrateMin};return typeof _t.frameRate=="number"?(_r.maxFrameRate=_t.frameRate,_r.minFrameRate=_t.frameRate):_t.frameRate&&(_r.maxFrameRate=_t.frameRate.max||_t.frameRate.ideal||_t.frameRate.exact||_t.frameRate.min,_r.minFrameRate=_t.frameRate.min||_t.frameRate.ideal||_t.frameRate.exact||_t.frameRate.max),_r}function LW(_e,_t,_r){var _o,_a,_u,yl,Rl,Al,Ol,xl;const Ll=_t.videoSend.find(vp=>vp.ssrc===_e);if(!Ll)return null;const Bl={id:Ny(10,""),timestamp:new Date(_t.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:Ll.ssrc.toString()},Hl=(_o=(_a=(_u=Ll.inputFrame)===null||_u===void 0?void 0:_u.height)!==null&&_a!==void 0?_a:_r==null?void 0:_r._videoHeight)!==null&&_o!==void 0?_o:0,up=(yl=(Rl=(Al=Ll.inputFrame)===null||Al===void 0?void 0:Al.width)!==null&&Rl!==void 0?Rl:_r==null?void 0:_r._videoWidth)!==null&&yl!==void 0?yl:0,_f=(Ol=(xl=Ll.inputFrame)===null||xl===void 0?void 0:xl.frameRate)!==null&&Ol!==void 0?Ol:0;return Hl&&(Bl.A_fhi=Hl+""),up&&(Bl.A_fwi=up+""),_f&&(Bl.A_fri=_f+""),Bl}function DW(_e){return _e>=0&&_e<.17?1:_e>=.17&&_e<.36?2:_e>=.36&&_e<.59?3:_e>=.59&&_e<=1?4:_e>1?5:0}function D4(_e,_t){let _r,_o,_a;switch(_t){case y_.CHOOSE_SERVER:_r=4096,_o="choose server";break;case y_.CLOUD_PROXY:_r=1048576,_o="proxy";break;case y_.CLOUD_PROXY_5:_r=4194304,_o="proxy5";break;case y_.CLOUD_PROXY_FALLBACK:_r=4194310,_o="proxy fallback";break;default:throw new Tp(Ql.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:_e.detail&&_e.detail[502],retry:!1})}if(_e.response_body.forEach(_u=>{_u.buffer&&_u.buffer.flag===_r&&(_a={code:_u.buffer.code,addresses:(_u.buffer.edges_services||[]).map(yl=>Z5(Z5({},yl),{},{ticket:_u.buffer.cert})),server_ts:_e.enter_ts,uid:_u.buffer.uid,cid:_u.buffer.cid,cname:_u.buffer.cname,detail:Z5(Z5({},_u.buffer.detail),_e.detail),flag:_u.buffer.flag,opid:_e.opid,cert:_u.buffer.cert})}),!_a)throw new Tp(Ql.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(_o," from multi unilbs response"),{csIp:_e.detail&&_e.detail[502]});return _a}async function Yte(_e,_t){return await u0.all(_e.addresses.map(async _r=>({address:eU(_r.ip),tcpport:_r.port,udpport:_r.port,username:_t&&Pp("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?_t.toString():VT.username,password:_t&&Pp("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await Nte(_t.toString()):VT.password})))}function Xte(_e,_t){const _r=_t._videoWidth||_t.getMediaStreamTrack(!0).getSettings().width;return _r||Vl.warning("cannot get original video track's width, default scale down 4 times for low stream"),_r?_r/MR(_e.width):4}function tU(_e){let{candidateType:_t,relayProtocol:_r,type:_o,address:_a,port:_u,protocol:yl}=_e;return _o==="local-candidate"?{candidateType:_t,relayProtocol:_r,protocol:yl}:{candidateType:_t,relayProtocol:_r,address:_a,port:_u,protocol:yl}}function MW(_e,_t){var _r=Object.keys(_e);if(Object.getOwnPropertySymbols){var _o=Object.getOwnPropertySymbols(_e);_t&&(_o=_o.filter(function(_a){return Object.getOwnPropertyDescriptor(_e,_a).enumerable})),_r.push.apply(_r,_o)}return _r}function lO(_e){for(var _t=1;_t<arguments.length;_t++){var _r=arguments[_t]!=null?arguments[_t]:{};_t%2?MW(Object(_r),!0).forEach(function(_o){Ml(_e,_o,_r[_o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_e,Object.getOwnPropertyDescriptors(_r)):MW(Object(_r)).forEach(function(_o){Object.defineProperty(_e,_o,Object.getOwnPropertyDescriptor(_r,_o))})}return _e}function fN(_e){return window.TextEncoder?new TextEncoder().encode(_e).length:_e.length}function G_(_e){return new u0(_t=>{window.setTimeout(_t,_e)})}function Jte(_e){const _t=new Tp(Ql.TIMEOUT,"timeout");return new u0((_r,_o)=>{window.setTimeout(()=>_o(_t),_e)})}function Ny(){let _e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,_t=arguments.length>1?arguments[1]:void 0;const _r=Math.random().toString(16).substr(2,_e).toLowerCase();return _r.length===_e?"".concat(_t).concat(_r):"".concat(_t).concat(_r)+Ny(_e-_r.length,"")}function M4(){return Ny(32,"").toUpperCase()}const nU=()=>{};function UW(_e){return new u0((_t,_r)=>{let _o=!1;const _a=document.createElement("video");_a.setAttribute("autoplay",""),_a.setAttribute("muted",""),_a.muted=!0,_a.autoplay=!0,_a.setAttribute("playsinline",""),_a.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(_a);const _u=eT()?"canplay":"playing";_a.addEventListener(_u,()=>{const yl=_a.videoWidth,Rl=_a.videoHeight;!yl&&Wy()||(_o=!0,_a.srcObject=null,_a.remove(),_t([yl,Rl]))}),_a.srcObject=new MediaStream([_e]),_a.play().catch(nU),setTimeout(()=>{_o||(_a.srcObject=null,_a.remove(),_t([_a.videoWidth,_a.videoHeight]))},4e3)})}function pN(_e){return u0.all(_e.map(_t=>_t.then(_r=>{throw _r},_r=>_r))).then(_t=>{throw _t},_t=>_t)}function W_(_e,_t){for(var _r=arguments.length,_o=new Array(_r>2?_r-2:0),_a=2;_a<_r;_a++)_o[_a-2]=arguments[_a];return _e.getListeners(_t).length===0?u0.reject(new Tp(Ql.UNEXPECTED_ERROR,"can not emit promise")):new u0((_u,yl)=>{_e.emit(_t,..._o,_u,yl)})}function $y(_e,_t){if(_e.getListeners(_t).length===0)return u0.resolve();for(var _r=arguments.length,_o=new Array(_r>2?_r-2:0),_a=2;_a<_r;_a++)_o[_a-2]=arguments[_a];return W_(_e,_t,..._o)}function cR(_e,_t){if(_e.getListeners(_t).length===0)return null;for(var _r=arguments.length,_o=new Array(_r>2?_r-2:0),_a=2;_a<_r;_a++)_o[_a-2]=arguments[_a];return dO(_e,_t,..._o)}function dO(_e,_t){let _r=null,_o=null;for(var _a=arguments.length,_u=new Array(_a>2?_a-2:0),yl=2;yl<_a;yl++)_u[yl-2]=arguments[yl];if(_e.emit(_t,..._u,Rl=>{_r=Rl},Rl=>{_o=Rl}),_o!==null)throw _o;if(_r===null)throw new Tp(Ql.UNEXPECTED_ERROR,"handler is not sync");return _r}function U4(_e,_t){const _r=_e.indexOf(_t);_r!==-1&&_e.splice(_r,1)}function jW(_e){const _t=[];return _e.forEach(_r=>{_t.indexOf(_r)===-1&&_t.push(_r)}),_t}function IS(_e){u0.resolve().then(_e)}function r_(_e){return JSON.parse(JSON.stringify(_e))}const FW={};function l2(_e,_t){FW[_t]||(FW[_t]=!0,_e())}function j4(_e){const _t=window.atob(_e),_r=new Uint8Array(new ArrayBuffer(_t.length));for(let _o=0;_o<_t.length;_o+=1)_r[_o]=_t.charCodeAt(_o);return _r}function rU(_e){let _t="";for(let _r=0;_r<_e.length;_r+=1)_t+=String.fromCharCode(_e[_r]);return window.btoa(_t)}const BW=new class{constructor(){Ml(this,"fnMap",new Map)}throttleByKey(_e,_t,_r,_o){for(var _a=arguments.length,_u=new Array(_a>4?_a-4:0),yl=4;yl<_a;yl++)_u[yl-4]=arguments[yl];if(this.fnMap.has(_t)){const Rl=this.fnMap.get(_t);if(Rl.threshold!==_r){Rl.fn(...Rl.args),clearTimeout(Rl.timer);const Al=window.setTimeout(()=>{const Ol=this.fnMap.get(_t);Ol&&Ol.fn(...Ol.args),this.fnMap.delete(_t)},_r);this.fnMap.set(_t,{fn:_e,threshold:_r,timer:Al,args:_u,skipFn:_o})}else Rl.skipFn&&Rl.skipFn(...Rl.args),this.fnMap.set(_t,lO(lO({},Rl),{},{fn:_e,args:_u,skipFn:_o}))}else{const Rl=window.setTimeout(()=>{const Al=this.fnMap.get(_t);Al&&Al.fn(...Al.args),this.fnMap.delete(_t)},_r);this.fnMap.set(_t,{fn:_e,threshold:_r,timer:Rl,args:_u,skipFn:_o})}}},$W=BW.throttleByKey.bind(BW),d2=async _e=>{let{fragementLength:_t,referenceList:_r,asyncMapHandler:_o,allFailedhandler:_a,promisesCollector:_u}=_e,yl=0;const Rl=_t;let Al,Ol=0;const xl=async()=>{const Ll=(()=>{const Bl=yl*Rl,Hl=Bl+Rl;return _r.slice(Bl,Hl).map(_o)})();_u&&_u.push(...Ll);try{Al=await pN(Ll)}catch(Bl){if(Ol+=Rl,yl++,!(Ol>=_r.length))return void await xl();_a(Bl)}Ll.forEach(Bl=>Bl.cancel())};return await xl(),Al};function VW(_e){return typeof _e=="object"&&_e!==null&&!(_e instanceof RegExp)}const Qte={[oN.ACCESS_POINT]:{[B_.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[B_.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[B_.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[B_.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[B_.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[B_.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[B_.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[B_.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voice service available",retry:!0},[B_.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[B_.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[B_.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[B_.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[B_.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[B_.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[B_.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[B_.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[B_.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[B_.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[oN.UNILBS]:{[GT.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[GT.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[GT.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[GT.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[GT.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[GT.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[GT.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[GT.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[GT.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[GT.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[GT.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[GT.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[oN.STRING_UID_ALLOCATOR]:{[s2.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[s2.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[s2.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function iU(_e){const _t=Qte[Math.floor(_e/1e4)];if(!_t)return{desc:"unkonw error",retry:!1};const _r=_t[_e%1e4];if(!_r){if(Math.floor(_e/1e4)===oN.ACCESS_POINT){const _o=_e%1e4;if(_o.toString()[0]==="1")return{desc:_e.toString(),retry:!1};if(_o.toString()[0]==="2")return{desc:_e.toString(),retry:!0}}return{desc:"unkonw error",retry:!1}}return _r}const Zte={[E0.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[E0.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[E0.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[E0.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[E0.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[E0.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[E0.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[E0.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[E0.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[E0.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[E0.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[E0.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[E0.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[E0.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[E0.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[E0.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[E0.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[E0.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[E0.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[E0.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[E0.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[E0.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[E0.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[E0.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[E0.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[E0.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[E0.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[E0.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[E0.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[E0.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[E0.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[E0.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[E0.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[E0.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[E0.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[E0.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[E0.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[E0.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[E0.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[E0.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[E0.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[E0.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[E0.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[E0.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[E0.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[E0.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[E0.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[E0.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[E0.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[E0.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[E0.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[E0.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[E0.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[E0.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[E0.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[E0.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[E0.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[E0.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[E0.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[E0.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[E0.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[E0.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[E0.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[E0.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function h2(_e){return Zte[_e]||{desc:"UNKNOW_ERROR_".concat(_e),action:"failed"}}function GW(_e,_t){var _r=Object.keys(_e);if(Object.getOwnPropertySymbols){var _o=Object.getOwnPropertySymbols(_e);_t&&(_o=_o.filter(function(_a){return Object.getOwnPropertyDescriptor(_e,_a).enumerable})),_r.push.apply(_r,_o)}return _r}class gN extends Hy{get url(){return this.websocket?this.websocket.url:null}get reconnectMode(){return this._reconnectMode}set reconnectMode(_t){["tryNext","recover"].includes(_t)&&this.resetReconnectCount(_t),this._reconnectMode=_t}get state(){return this._state}set state(_t){_t!==this._state&&(this._state=_t,this._state==="reconnecting"?this.emit(N0.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(N0.CONNECTED):this._state==="closed"?this.emit(N0.CLOSED):this._state==="failed"&&this.emit(N0.FAILED))}resetReconnectCount(_t){Vl.debug("websocket reset reconnect count, reason: "+_t),this.reconnectCount=0}constructor(_t,_r){let _o=arguments.length>2&&arguments[2]!==void 0&&arguments[2],_a=arguments.length>3&&arguments[3]!==void 0&&arguments[3],_u=arguments.length>4?arguments[4]:void 0;super(),Ml(this,"connectionID",0),Ml(this,"currentURLIndex",0),Ml(this,"urls",void 0),Ml(this,"_reconnectMode","tryNext"),Ml(this,"reconnectReason",void 0),Ml(this,"_initMutex",new iT("websocket")),Ml(this,"name",void 0),Ml(this,"_state","closed"),Ml(this,"reconnectInterrupter",void 0),Ml(this,"websocket",void 0),Ml(this,"retryConfig",void 0),Ml(this,"reconnectCount",0),Ml(this,"forceCloseTimeout",5e3),Ml(this,"onlineReconnectListener",void 0),Ml(this,"useCompress",void 0),Ml(this,"tryDoubleDomain",!1),Ml(this,"wsInflateLength",0),Ml(this,"wsDeflateLength",0),Ml(this,"closeEstablishingWs",()=>{}),Ml(this,"store",void 0),Ml(this,"joinChannelServiceRecordIndex",void 0),this.store=_u,this.name=_t,this.retryConfig=function(xl){for(var Ll=1;Ll<arguments.length;Ll++){var Bl=arguments[Ll]!=null?arguments[Ll]:{};Ll%2?GW(Object(Bl),!0).forEach(function(Hl){Ml(xl,Hl,Bl[Hl])}):Object.getOwnPropertyDescriptors?Object.defineProperties(xl,Object.getOwnPropertyDescriptors(Bl)):GW(Object(Bl)).forEach(function(Hl){Object.defineProperty(xl,Hl,Object.getOwnPropertyDescriptor(Bl,Hl))})}return xl}({},_r),this.useCompress=_o,this.tryDoubleDomain=_a;const{timeout:yl,timeoutFactor:Rl}=_r,Al=Math.max(300,Math.floor(3*yl/5)),Ol=Math.max(1.2,Math.floor(8*Rl)/10);Y_.ONLINE&&(this.retryConfig.timeout=Al,this.retryConfig.timeoutFactor=Ol),n_.on(p1.NETWORK_STATE_CHANGE,(xl,Ll)=>{xl!==Ll&&(this.resetReconnectCount("network state change: ".concat(Ll," -> ").concat(xl)),xl===Y_.ONLINE?(this.retryConfig.timeout=Al,this.retryConfig.timeoutFactor=Ol):(this.retryConfig.timeout=yl,this.retryConfig.timeoutFactor=Rl))})}getConnection(){return this.websocket||void 0}init(_t){let _r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;this.forceCloseTimeout=_r;const _o=(_a,_u)=>{this.urls=_t;const yl=this.urls[this.currentURLIndex];this.state="connecting",this.createWebSocketConnection(yl).then(_a).catch(_u),this.once(N0.CLOSED,()=>_u(new Tp(Ql.WS_DISCONNECT))),this.once(N0.CONNECTED,()=>_a())};return this._initMutex.lock().then(_a=>new u0((_u,yl)=>{_o(_u,yl)}).then(()=>{_a()}).catch(()=>{_a()}))}close(_t,_r){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const _o=this.websocket;_r?setTimeout(()=>_o.close(),500):_o.close(),this.websocket=void 0}this.state=_t?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(_t,_r){if(!this.websocket)return void Vl.warning("[".concat(this.name,"] can not reconnect, no websocket"));var _o;_t!==void 0&&(this.reconnectMode=_t),Vl.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinChannelServiceRecordIndex=="number"&&((_o=this.store)===null||_o===void 0||_o.recordJoinChannelService({status:"error",errors:[new Error(_r)]},this.joinChannelServiceRecordIndex));const _a=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),_a&&_a.bind(this.websocket)({code:9999,reason:_r})}sendMessage(_t){let _r=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new Tp(Ql.WS_ABORT,"websocket is not ready");try{_r||(_t=JSON.stringify(_t)),this.websocket.send(_t)}catch(_o){throw new Tp(Ql.WS_ERR,"send websocket message error"+_o.toString())}}setWsInflateData(_t){this.wsDeflateLength=this.wsDeflateLength+_t.originLength,this.wsInflateLength=this.wsInflateLength+_t.compressedLength}getWsInflateData(){const _t=this.wsInflateLength,_r=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:_t,wsDeflateLength:_r}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(_t,_r){return this.connectionID+=1,this.connectionID,this.joinChannelServiceRecordIndex=void 0,new u0((_o,_a)=>{var _u;const yl=xl=>{var Ll;(Ll=this.store)===null||Ll===void 0||Ll.signalChannelOpen(),Vl.debug("[".concat(this.name,"] websocket opened:"),xl),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),_o()},Rl=async xl=>{if(Vl.debug("[".concat(this.name,"] websocket close ").concat(this.websocket&&this.websocket.url,", code: ").concat(xl.code,", reason: ").concat(xl.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount<this.retryConfig.maxRetryCount){this.state==="connected"&&(this.reconnectReason=xl.reason,this.state="reconnecting");const Ll=cR(this,N0.WILL_RECONNECT,this.reconnectMode)||this.reconnectMode,Bl=await this.reconnectWithAction(Ll);if(this.state==="closed")return void Vl.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!Bl)return _a(new Tp(Ql.WS_DISCONNECT,"websocket reconnect failed: ".concat(xl.code))),void this.close(!0);_o()}else _a(new Tp(Ql.WS_DISCONNECT,"websocket close: ".concat(xl.code))),this.close()},Al=xl=>{this.emit(N0.ON_MESSAGE,xl)};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),Pp("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(_t=Pp("GATEWAY_WSS_ADDRESS")),Vl.debug("[".concat(this.name,"] start connect, url: ").concat(_t));const Ol=(_u=this.store)===null||_u===void 0?void 0:_u.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});this.chooseBestWebsocketConnection(_t,!!_r,Ol).then(xl=>{var Ll;this.websocket=xl,yl&&yl(xl.url),xl.onclose=Rl,xl.onmessage=Al,(Ll=this.store)===null||Ll===void 0||Ll.recordJoinChannelService({endTs:Date.now(),status:"success"},Ol),this.joinChannelServiceRecordIndex=Ol}).catch(xl=>{var Ll;if((Ll=this.store)===null||Ll===void 0||Ll.recordJoinChannelService({endTs:Date.now(),status:xl instanceof Tp&&xl.code===Ql.WS_ABORT?"aborted":"error",errors:[xl]},Ol),this.state!=="closed"){if(xl instanceof Tp&&xl.code===Ql.WS_ERR){const Bl=new Tp(Ql.WS_ERR,"init websocket failed! Error: ".concat(xl.toString()));return Vl.error("[".concat(this.name,"]").concat(Bl)),void _a(Bl)}Rl&&Rl(xl)}else _a(new Tp(Ql.WS_DISCONNECT,"websocket is closed: ".concat(xl.toString())))})})}async reconnectWithAction(_t){let _r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||!this.urls||this.state==="closed")return!1;this.onlineReconnectListener||n_.networkState!==Y_.OFFLINE||(this.onlineReconnectListener=n_.onlineWaiter&&n_.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let _o=!0;if(this.reconnectInterrupter=()=>{_o=!1},_r){const yl=Y6(this.reconnectCount,this.retryConfig);Vl.debug("[".concat(this.name,"] wait ").concat(yl,"ms to reconnect websocket, mode: ").concat(_t)),await u0.race([G_(yl),this.onlineReconnectListener||new u0(()=>{})])}if(this.state==="closed"||!_o)return!1;this.reconnectCount+=1;const _a=async(yl,Rl)=>{this.emit(N0.RECONNECT_CREATE_CONNECTION,Rl),await this.createWebSocketConnection(yl)};try{if(_t==="retry"){const yl=this.urls[this.currentURLIndex];this.emit(N0.RECONNECT_WAITTING_FINISH,_t),await _a(yl,_t)}else if(_t==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return await this.reconnectWithAction("recover",!1);Vl.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex));const yl=this.urls[this.currentURLIndex];this.emit(N0.RECONNECT_WAITTING_FINISH,_t),await _a(yl,_t)}else if(_t==="recover"){Vl.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.emit(N0.RECONNECT_WAITTING_FINISH,_t),this.urls=await W_(this,N0.REQUEST_NEW_URLS),this.currentURLIndex=0;const yl=this.urls[this.currentURLIndex];await _a(yl,_t)}return!0}catch(yl){var _u;return Vl.error("[".concat(this.name,"] reconnect failed"),yl.toString()),yl!=null&&(_u=yl.data)!==null&&_u!==void 0&&_u.desc&&Array.isArray(yl.data.desc)&&yl.data.desc.length&&yl.data.desc.includes("dynamic key expired")?(this.emit(N0.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):await this.reconnectWithAction(_t,_r)}}async chooseBestWebsocketConnection(_t,_r,_o){return new u0((_a,_u)=>{let yl=!1;const Rl=[];this.closeEstablishingWs=()=>{Vl.debug("[choose-best-ws] close establishing websockets"),Rl.forEach(_f=>{_f.onclose=null,_f.onopen=null,_f.onmessage=null,_f.close()}),_u(new Tp(Ql.WS_ABORT,"choose best websocket aborted"))};const Al=Pp("GATEWAY_DOMAINS");let Ol;const xl=_t.indexOf("?h="),Ll=Al.find(_f=>xl!==-1?_t.includes(_f,xl):_t.includes(_f));Vl.debug("[choose-best-ws] currentDomain: ",Ll,", domains: ",Al);let Bl=!this.tryDoubleDomain||_r||!Ll;if(!Bl&&Ll){var Hl;const _f=Date.now();try{Al.forEach(vp=>{const Dp=xl===-1?_t.replace(Ll,vp):_t.substr(0,xl)+_t.substr(xl).replace(Ll,vp),Bp=new WebSocket(Dp);Bp.binaryType="arraybuffer",Rl.push(Bp),Vl.debug("[choose-best-ws] ws is connecting:",Bp.url)})}catch{for(Vl.debug("[choose-best-ws] ws create failed, fallback to single url"),Rl.forEach(Dp=>Dp.close());Rl.length;)Rl.pop();Bl=!0}(Hl=this.store)===null||Hl===void 0||Hl.recordJoinChannelService({urls:Rl.map(vp=>vp.url),service:"gateway"},_o),Rl.forEach(vp=>{vp.onopen=()=>{if(yl)return;const Dp=Date.now()-_f;Vl.debug("[choose-best-ws] ws open cost ".concat(Dp,"ms")),Rl.filter(Bp=>Bp!==vp).forEach(Bp=>{Vl.debug("[choose-best-ws]close backup websocket: ".concat(Bp.url)),Bp.close()}),yl=!0,_a(vp)},vp.onclose=Dp=>{Ol=Dp,!yl&&(Rl.find(Bp=>!(Bp.readyState===WebSocket.CLOSED||Bp.readyState===WebSocket.CLOSING))||(Vl.debug("[choose-best-ws] all websocket is closed"),yl=!0,_u(Ol)))},vp.onmessage=Dp=>{Vl.debug("[choose-best-ws]".concat(vp.url," onmessage: ").concat(Dp.data))}}),G_(this.forceCloseTimeout).then(()=>{Rl.forEach(vp=>{vp.readyState!==WebSocket.OPEN&&vp.close()})})}if(Bl){var up;let _f;Vl.debug("[choose-best-ws] use single url: ",_t),(up=this.store)===null||up===void 0||up.recordJoinChannelService({urls:[_t],service:"gateway"},_o);try{_f=new WebSocket(_t),Rl.push(_f),_f.binaryType="arraybuffer"}catch(vp){const Dp=new Tp(Ql.WS_ERR,"init websocket failed! Error: ".concat(vp.toString()));return Vl.error("[".concat(this.name,"]").concat(Dp)),void _u(Dp)}_f.onopen=()=>{_a(_f)},_f.onclose=vp=>{_u(vp)},_f.onmessage=vp=>{Vl.debug("[choose-best-ws]".concat(_f.url," onmessage: ").concat(vp.data))},G_(this.forceCloseTimeout).then(()=>{_f&&_f.readyState!==WebSocket.OPEN&&_f.close()})}}).then(_a=>(this.closeEstablishingWs=void 0,_a)).catch(_a=>{throw this.closeEstablishingWs=void 0,_a})}}class WW{constructor(_t){Ml(this,"input",[]),Ml(this,"size",void 0),this.size=_t}add(_t){this.input.push(_t),this.input.length>this.size&&this.input.splice(0,1)}mean(){var _t;return this.input.length===0?0:nS(_t=this.input).call(_t,(_r,_o)=>_r+_o)/this.input.length}}class HW extends Hy{get connectionState(){return this._connectionState}set connectionState(_t){_t!==this._connectionState&&(this._connectionState=_t,_t===py.CONNECTED?this.emit(p0.WS_CONNECTED):_t===py.RECONNECTING?this.emit(p0.WS_RECONNECTING,this._websocketReconnectReason):_t===py.CLOSED&&this.emit(p0.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket?this.websocket.url:null}get rtt(){return this.rttRolling.mean()}constructor(_t,_r){super(),Ml(this,"_disconnectedReason",void 0),Ml(this,"_websocketReconnectReason",void 0),Ml(this,"_connectionState",py.CLOSED),Ml(this,"reconnectToken",void 0),Ml(this,"websocket",void 0),Ml(this,"openConnectionTime",void 0),Ml(this,"clientId",void 0),Ml(this,"lastMsgTime",Date.now()),Ml(this,"uploadCache",[]),Ml(this,"uploadCacheInterval",void 0),Ml(this,"rttRolling",new WW(5)),Ml(this,"pingpongTimer",void 0),Ml(this,"wsInflateDataTimer",void 0),Ml(this,"pingpongTimeoutCount",0),Ml(this,"joinResponse",void 0),Ml(this,"multiIpOption",void 0),Ml(this,"initError",void 0),Ml(this,"spec",void 0),Ml(this,"store",void 0),Ml(this,"onWebsocketMessage",_o=>{if(_o.data instanceof ArrayBuffer)return void this.emit(p0.ON_BINARY_DATA,_o.data);const _a=JSON.parse(_o.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(_a,"_id")){const _u="res-@".concat(_a._id);this.emit(_u,_a._result,_a._message)}else if(Object.prototype.hasOwnProperty.call(_a,"_type")){if(this.emit(_a._type,_a._message),_a._type===U0.ON_NOTIFICATION&&this.handleNotification(_a._message),_a._type===U0.ON_USER_BANNED)switch(_a._message.error_code){case 14:this.close(cy.UID_BANNED);break;case 15:this.close(cy.IP_BANNED);break;case 16:this.close(cy.CHANNEL_BANNED)}if(_a._type===U0.ON_USER_LICENSE_BANNED)switch(_a._message.error_code){case E0.ERR_LICENSE_MISSING:this.close(cy.LICENSE_MISSING);break;case E0.ERR_LICENSE_EXPIRED:this.close(cy.LICENSE_EXPIRED);break;case E0.ERR_LICENSE_MINUTES_EXCEEDED:this.close(cy.LICENSE_MINUTES_EXCEEDED);break;case E0.ERR_LICENSE_PERIOD_INVALID:this.close(cy.LICENSE_PERIOD_INVALID);break;case E0.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(cy.LICENSE_MULTIPLE_SDK_SERVICE);break;case E0.ERR_LICENSE_ILLEGAL:this.close(cy.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=_t.clientId,this.spec=_t,this.store=_r,this.websocket=new gN("gateway-".concat(this.clientId),this.spec.retryConfig,!0,!0,_r),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===py.CONNECTED&&this.reconnect("retry",uT.OFFLINE)})}async request(_t,_r,_o,_a){const _u=Ny(6,""),yl={_id:_u,_type:_t,_message:_r},Rl=this.websocket.connectionID,Al=()=>new u0((up,_f)=>{if(this.connectionState===py.CONNECTED)return up();const vp=()=>{this.off(p0.WS_CLOSED,Dp),up()},Dp=()=>{this.off(p0.WS_CONNECTED,vp),_f(new Tp(Ql.WS_ABORT))};this.once(p0.WS_CONNECTED,vp),this.once(p0.WS_CLOSED,Dp),_t!==I0.PUBLISH&&_t!==I0.SUBSCRIBE&&_t!==I0.UNSUBSCRIBE&&_t!==I0.UNPUBLISH&&_t!==I0.CONTROL&&_t!==I0.RESTART_ICE||this.once(p0.DISCONNECT_P2P,()=>{_f(new Tp(Ql.DISCONNECT_P2P))}),_t!==I0.PUBLISH&&_t!==I0.RESTART_ICE||this.once(p0.ABORT_P2P_EXECUTION,()=>{_f(new Tp(Ql.DISCONNECT_P2P))})});if(this.connectionState!==py.CONNECTING&&this.connectionState!==py.RECONNECTING||_t===I0.JOIN||_t===I0.REJOIN||await Al(),this.websocket.sendMessage(yl,!0),_a)return;const Ol=new u0((up,_f)=>{let vp=!1;const Dp=(_g,y0)=>{vp=!0,up({isSuccess:_g==="success",message:y0||{}}),this.off(p0.WS_CLOSED,Bp),this.off(p0.WS_RECONNECTING,Bp),this.emit(p0.REQUEST_SUCCESS,_t,_r)};this.once("res-@".concat(_u),Dp);const Bp=()=>{_f(new Tp(Ql.WS_ABORT,"type: ".concat(_t))),this.off(p0.WS_CLOSED,Bp),this.off(p0.WS_RECONNECTING,Bp),this.off("res-@".concat(_u),Dp)};this.once(p0.WS_CLOSED,Bp),this.once(p0.WS_RECONNECTING,Bp),G_(Pp("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==Rl||vp||(Vl.warning("ws request timeout, type: ".concat(_t)),this.emit(p0.REQUEST_TIMEOUT,_t,_r))})});let xl=null;try{xl=await Ol}catch(up){if(this.connectionState===py.CLOSED||_t===I0.LEAVE)throw new Tp(Ql.WS_ABORT);return!this.spec.forceWaitGatewayResponse||_o?up.throw():_t===I0.JOIN||_t===I0.REJOIN?null:(await Al(),await this.request(_t,_r))}if(xl.isSuccess)return xl.message;const Ll=Number(xl.message.error_code||xl.message.code),Bl=h2(Ll),Hl=new Tp(Ql.UNEXPECTED_RESPONSE,"".concat(Bl.desc,": ").concat(xl.message.error_str),{code:Ll,data:xl.message});return Bl.action==="success"?xl.message:(Vl.warning("[".concat(this.websocket.connectionID,"] unexpected response from type ").concat(_t,", error_code: ").concat(Ll,", message: ").concat(Bl.desc,", action: ").concat(Bl.action)),Ll===E0.ERR_TOO_MANY_BROADCASTERS?((_t===I0.JOIN||_t===I0.REJOIN)&&(this.initError=Hl,this.close()),Hl.throw()):Bl.action==="failed"?Hl.throw():Bl.action==="quit"?(this.initError=Hl,this.close(),Hl.throw()):(Ll===E0.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=xl.message.option,Vl.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",uT.MULTI_IP)):this.reconnect(Bl.action,uT.SERVER_ERROR),_t===I0.JOIN||_t===I0.REJOIN?null:await this.request(_t,_r)))}waitMessage(_t,_r){return new u0(_o=>{const _a=_u=>{(!_r||_r(_u))&&(this.off(_t,_a),_o(_u))};this.on(_t,_a)})}upload(_t,_r){const _o={_type:_t,_message:_r};try{this.websocket.sendMessage(_o)}catch{const _u=Pp("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(_o),this.uploadCache.length>_u&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==py.CONNECTED)return;const yl=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(yl._type,yl._message)},Pp("UPLOAD_CACHE_INTERVAL")||2e3))}}send(_t,_r){const _o={_type:_t,_message:_r};this.websocket.sendMessage(_o)}init(_t,_r){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new u0((_o,_a)=>{this.once(p0.WS_CONNECTED,()=>_o(this.joinResponse)),this.once(p0.WS_CLOSED,()=>_a(this.initError||new Tp(Ql.WS_ABORT))),this.connectionState=py.CONNECTING,this.websocket.init(_t).catch(_a),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4),setTimeout(()=>{_r&&this.openConnectionTime===void 0&&(Vl.debug("[".concat(this.clientId,"] init websocket timeout while join with fallback to proxy")),_a(new Tp(Ql.INIT_WEBSOCKET_TIMEOUT)))},Pp("JOIN_WITH_FALLBACK_PROXY_PENDING_DURATION"))})}close(_t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=_t||cy.LEAVE,this.connectionState=py.CLOSED,Vl.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),_t===cy.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new gN("gateway-".concat(this.clientId),this.spec.retryConfig,!0,!0,this.store),this.handleWebsocketEvents())}async join(){if(!this.joinResponse){this.emit(p0.ABORT_P2P_EXECUTION);const _t=await W_(this,p0.REQUEST_JOIN_INFO),_r=await this.request(I0.JOIN,_t);if(!_r)return this.emit(p0.REPORT_JOIN_GATEWAY,Ql.TIMEOUT,this.url||""),!1;this.joinResponse=_r,this.emit(p0.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=py.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new Tp(Ql.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const _t=dO(this,p0.REQUEST_REJOIN_INFO);_t.token=this.reconnectToken;const _r=await this.request(I0.REJOIN,_t);return!!_r&&(this.connectionState=py.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),_r.peers&&_r.peers.forEach(_o=>{this.emit(U0.ON_USER_ONLINE,{uid:_o.uid}),_o.audio&&this.emit(U0.ON_ADD_AUDIO_STREAM,{uid:_o.uid,uint_id:_o.uint_id,audio:!0,ssrcId:_o.audio_ssrc}),_o.video&&this.emit(U0.ON_ADD_VIDEO_STREAM,{uid:_o.uid,uint_id:_o.uint_id,video:!0,ssrcId:_o.video_ssrc}),_o.audio_mute?this.emit(U0.MUTE_AUDIO,{uid:_o.uid}):this.emit(U0.UNMUTE_AUDIO,{uid:_o.uid}),_o.video_mute?this.emit(U0.MUTE_VIDEO,{uid:_o.uid}):this.emit(U0.UNMUTE_VIDEO,{uid:_o.uid}),_o.audio_enable_local?this.emit(U0.ENABLE_LOCAL_AUDIO,{uid:_o.uid}):this.emit(U0.DISABLE_LOCAL_AUDIO,{uid:_o.uid}),_o.video_enable_local?this.emit(U0.ENABLE_LOCAL_VIDEO,{uid:_o.uid}):this.emit(U0.DISABLE_LOCAL_VIDEO,{uid:_o.uid}),_o.audio||_o.video||this.emit(U0.ON_REMOVE_STREAM,{uid:_o.uid,uint_id:_o.uint_id})}),!0)}reconnect(_t,_r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(_t,_r)}handleNotification(_t){Vl.debug("[".concat(this.clientId,"] receive notification: "),_t);const _r=h2(_t.code);if(_r.action!=="success"){if(_r.action!=="failed")return _r.action==="quit"?(_r.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(cy.UID_BANNED),void this.close()):void this.reconnect(_r.action,uT.SERVER_ERROR);Vl.error("[".concat(this.clientId,"] ignore error: "),_r.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const _t=Pp("PING_PONG_TIME_OUT"),_r=Date.now();this.pingpongTimeoutCount>=_t&&(Vl.warning("PINGPONG Timeout. Last Socket Message: ".concat(_r-this.lastMsgTime,"ms")),_r-this.lastMsgTime>Pp("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",uT.TIMEOUT):this.request(I0.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const _o=Date.now()-_r;this.rttRolling.add(_o),Pp("REPORT_STATS")&&this.send(I0.PING_BACK,{pingpongElapse:_o})}).catch(_o=>{})}handleWsInflateData(){const{wsInflateLength:_t,wsDeflateLength:_r}=this.websocket.getWsInflateData();_t!==0&&_r!==0&&this.upload(ET.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:_r,ws_inflate_length:_t})}handleWebsocketEvents(){this.websocket.on(N0.RECONNECT_WAITTING_FINISH,_t=>{this.emit(p0.WS_RECONNECT_WAITTING_FINISH,_t)}),this.websocket.on(N0.RECONNECT_CREATE_CONNECTION,_t=>{this.emit(p0.WS_RECONNECT_CREATE_CONNECTION,_t)}),this.websocket.on(N0.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(N0.CLOSED,()=>{this.connectionState=py.CLOSED}),this.websocket.on(N0.FAILED,()=>{this._disconnectedReason=cy.NETWORK_ERROR,this.connectionState=py.CLOSED}),this.websocket.on(N0.RECONNECTING,_t=>{this._websocketReconnectReason=_t,this.joinResponse=void 0,this.connectionState===py.CONNECTED?this.connectionState=py.RECONNECTING:this.connectionState=py.CONNECTING}),this.websocket.on(N0.WILL_RECONNECT,(_t,_r)=>{if(dO(this,p0.IS_P2P_DISCONNECTED)&&_t==="retry")return Vl.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),this.reconnectToken=void 0,this.emit(p0.NEED_RENEW_SESSION),this.emit(p0.DISCONNECT_P2P),_r("tryNext");_t!=="retry"&&(Vl.debug("".concat(this.clientId," websockt will_connect event, renewSession reconnectMode is ").concat(_t)),this.reconnectToken=void 0,this.emit(p0.NEED_RENEW_SESSION),this.emit(p0.DISCONNECT_P2P)),_r(_t)}),this.websocket.on(N0.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(_t=>{Vl.warning("[".concat(this.clientId,"] rejoin failed ").concat(_t)),this.reconnect("tryNext",uT.SERVER_ERROR)}):this.join().catch(_t=>{if(this.emit(p0.REPORT_JOIN_GATEWAY,_t.message||_t.code,this.url||""),_t instanceof Tp&&_t.code===Ql.UNEXPECTED_RESPONSE&&_t.data.code===E0.ERR_NO_AUTHORIZED)return Vl.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",uT.SERVER_ERROR);Vl.error("[".concat(this.clientId,"] join gateway request failed"),_t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",uT.SERVER_ERROR):(this.initError=_t,this.close())})}),this.websocket.on(N0.REQUEST_NEW_URLS,(_t,_r)=>{W_(this,p0.REQUEST_RECOVER,this.multiIpOption).then(_t).catch(_r)}),this.websocket.on(N0.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(U0.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}function KW(_e,_t){var _r=Object.keys(_e);if(Object.getOwnPropertySymbols){var _o=Object.getOwnPropertySymbols(_e);_t&&(_o=_o.filter(function(_a){return Object.getOwnPropertyDescriptor(_e,_a).enumerable})),_r.push.apply(_r,_o)}return _r}class ene extends Hy{get url(){return this._url?this._url:null}get reconnectMode(){return this._reconnectMode}set reconnectMode(_t){["tryNext","recover"].includes(_t)&&this.resetReconnectCount(_t),this._reconnectMode=_t}get state(){return this._state}set state(_t){_t!==this._state&&(this._state=_t,this._state==="reconnecting"?this.emit(By.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(By.CONNECTED):this._state==="closed"?this.emit(By.CLOSED):this._state==="failed"&&this.emit(By.FAILED))}constructor(_t,_r,_o,_a){super(),Ml(this,"connectionID",0),Ml(this,"currentURLIndex",0),Ml(this,"reconnectReason",void 0),Ml(this,"_reconnectMode","tryNext"),Ml(this,"_initMutex",void 0),Ml(this,"_name",void 0),Ml(this,"_state","closed"),Ml(this,"_reconnectInterrupter",void 0),Ml(this,"_url",void 0),Ml(this,"_retryConfig",void 0),Ml(this,"_reconnectCount",0),Ml(this,"_forceCloseTimeout",5e3),Ml(this,"_onlineReconnectListener",void 0),Ml(this,"_closeEstablishingTransmitter",()=>{}),Ml(this,"_store",void 0),Ml(this,"_joinChannelServiceRecordIndex",void 0),Ml(this,"_transmitter",void 0),Ml(this,"_useCompress",void 0),Ml(this,"_inflateLength",0),Ml(this,"_deflateLength",0),this._store=_a,this._name=_t,this._retryConfig=function(_u){for(var yl=1;yl<arguments.length;yl++){var Rl=arguments[yl]!=null?arguments[yl]:{};yl%2?KW(Object(Rl),!0).forEach(function(Al){Ml(_u,Al,Rl[Al])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_u,Object.getOwnPropertyDescriptors(Rl)):KW(Object(Rl)).forEach(function(Al){Object.defineProperty(_u,Al,Object.getOwnPropertyDescriptor(Rl,Al))})}return _u}({},_r),this._useCompress=_o}resetReconnectCount(_t){Vl.debug("".concat(this._name," reset reconnect count, reason: ").concat(_t)),this._reconnectCount=0}close(_t,_r){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this._reconnectInterrupter&&this._reconnectInterrupter(),this._transmitter){this._transmitter.onclose=null,this._transmitter.onopen=null,this._transmitter.onmessage=null;const _o=this._transmitter;_r?setTimeout(()=>_o.close(),500):_o.close(),this._transmitter=void 0}this.state=_t?"failed":"closed",this._closeEstablishingTransmitter&&this._closeEstablishingTransmitter()}reconnect(_t,_r){if(!this._transmitter)return void Vl.warning("[".concat(this._name,"] can not reconnect, no websocket"));var _o;_t!==void 0&&(this.reconnectMode=_t),Vl.debug("[".concat(this._name,"] reconnect is triggered initiative")),typeof this._joinChannelServiceRecordIndex=="number"&&((_o=this._store)===null||_o===void 0||_o.recordJoinChannelService({status:"error",errors:[new Error(_r)]},this._joinChannelServiceRecordIndex));const _a=this._transmitter.onclose;this._transmitter.onclose=null,this._transmitter.close(),_a&&_a.bind(this._transmitter)({code:9999,reason:_r})}getInflateData(){const _t=this._inflateLength,_r=this._deflateLength;return this.clearInflateData(),{inflateLength:_t,deflateLength:_r}}setInflateData(_t){this._deflateLength=this._deflateLength+_t.originLength,this._inflateLength=this._inflateLength+_t.compressedLength}clearInflateData(){this._inflateLength=0,this._deflateLength=0}}function qW(_e,_t,_r){if("getBigUint64"in DataView.prototype)return _e.getBigUint64(_t,_r);const _o=_e.getUint32(_t,_r),_a=_e.getUint32(_t+4,_r),_u=+!!_r,yl=+!_r;return BigInt(_o*yl+_a*_u)<<BigInt(32)|BigInt(_o*_u+_a*yl)}function zW(_e,_t,_r,_o){if("setBigUint64"in DataView.prototype)return _e.setBigUint64(_t,_r,_o);const _a=Number(_r>>BigInt(32)),_u=Number(_r&BigInt(4294967295));_o?(_e.setUint32(_t+4,_a,_o),_e.setUint32(_t,_u,_o)):(_e.setUint32(_t,_a,_o),_e.setUint32(_t+4,_u,_o))}let lS;(function(_e){_e[_e.Default=0]="Default",_e[_e.Ack=1]="Ack"})(lS||(lS={}));class tne{constructor(_t,_r,_o){Ml(this,"version",1),Ml(this,"initialRTO",void 0),Ml(this,"maxBatchAckCount",void 0),Ml(this,"maxRTO",void 0),Ml(this,"initialRTT",void 0),Ml(this,"ID",void 0),Ml(this,"rtt",void 0),Ml(this,"packetNumber",1),Ml(this,"rtoRatioMap",new Map),Ml(this,"timeoutMap",new Map),Ml(this,"unorderedPacketQueue",[]),Ml(this,"batchAckPacketQueue",[]),Ml(this,"lastOrderedPacketNumber",0),Ml(this,"batchAckTimer",void 0),Ml(this,"sendImpl",void 0),Ml(this,"receiveImpl",void 0),this.sendImpl=_t,this.receiveImpl=_r,this.ID=Ny(7,"transmitter-"),this.initialRTO=(_o==null?void 0:_o.initialRTO)!==void 0?_o.initialRTO:Pp("TRANSMITTER_INITIAL_RTO"),this.initialRTT=(_o==null?void 0:_o.initialRTT)!==void 0?_o.initialRTT:Pp("TRANSMITTER_INITIAL_RTT"),this.rtt=(_o==null?void 0:_o.initialRTT)!==void 0?_o.initialRTT:Pp("TRANSMITTER_INITIAL_RTT"),this.maxBatchAckCount=(_o==null?void 0:_o.maxBatchAckCount)!==void 0?_o.maxBatchAckCount:Pp("TRANSMITTER_MAX_BATCH_ACK_COUNT"),this.maxRTO=(_o==null?void 0:_o.maxRTO)!==void 0?_o.maxRTO:Pp("TRANSMITTER_MAX_RTO")}packetize(_t,_r){return{type:lS.Default,version:this.version,packetNumber:_r,payload:_t}}serialize(_t){switch(_t.type){case lS.Default:{let _r;typeof _t.payload=="string"?_r=new TextEncoder().encode(_t.payload):_r=_t.payload;const _o=new ArrayBuffer(_r.length+15),_a=new DataView(_o);return _a.setUint16(0,_t.version),_a.setUint8(2,_t.type),_a.setUint32(3,_t.packetNumber),zW(_a,7,BigInt(_t.sendTs)),new Uint8Array(_a.buffer).set(_r,15),_o}case lS.Ack:{const _r=new ArrayBuffer(16),_o=new DataView(_r);return _o.setUint16(0,_t.version),_o.setUint8(2,_t.type),_o.setUint32(3,_t.maxAckPacketNumber),_o.setUint8(7,_t.shift),zW(_o,8,BigInt(_t.ackSendTs)),_r}}}deserialize(_t){const _r=new DataView(_t),_o=_r.getUint16(0),_a=_r.getUint8(2);switch(_a){case lS.Default:{const _u=_r.getUint32(3),yl=qW(_r,7),Rl=_t.slice(15),Al=new TextDecoder().decode(Rl);return{version:_o,type:_a,packetNumber:_u,sendTs:Number(yl),payload:Al}}case lS.Ack:{const _u=_r.getUint32(3),yl=_r.getUint8(7),Rl=qW(_r,8);return{version:_o,type:_a,maxAckPacketNumber:_u,shift:yl,ackSendTs:Number(Rl)}}default:throw Vl.error("[".concat(this.ID,"] Unrecognized packet type ").concat(_a)),new Error("Unrecognized packet type ".concat(_a))}}sendMessage(_t){const _r=this.packetize(_t,this.packetNumber);this.packetNumber=this.packetNumber===4294967295?1:this.packetNumber+1;const _o=this.calculateRTO(_r),_a=window.setTimeout(()=>{this.resendMessage(_r)},_o);this.timeoutMap.set(_r.packetNumber,_a),this.sendPacket(_r)}onData(_t){const _r=this.deserialize(_t);_r.type===lS.Default?this.ack(_r):_r.type===lS.Ack&&(this.updateRTT(_r,Math.round(performance.now())),this.clearRTO(_r))}close(){this.rtt=this.initialRTT,this.packetNumber=1,Array.from(this.timeoutMap.entries()).forEach(_t=>{let[_r,_o]=_t;window.clearTimeout(_o)}),this.timeoutMap=new Map,this.rtoRatioMap=new Map,this.unorderedPacketQueue=[],this.batchAckPacketQueue=[],this.lastOrderedPacketNumber=0,this.batchAckTimer!==void 0&&window.clearTimeout(this.batchAckTimer)}resendMessage(_t){const _r=this.calculateRTO(_t),_o=window.setTimeout(()=>{this.resendMessage(_t)},_r);this.timeoutMap.set(_t.packetNumber,_o),this.sendPacket(_t)}calculateRTO(_t){const _r=this.rtoRatioMap.get(_t.packetNumber);if(_r===void 0)return this.rtoRatioMap.set(_t.packetNumber,1),this.initialRTO;{const _o=9*this.rtt/8*_r;return this.rtoRatioMap.set(_t.packetNumber,_r+1),_o>this.maxRTO?this.maxRTO:_o}}updateRTT(_t,_r){const _o=_t.ackSendTs;this.rtt=this.rtt*(7/8)+(_r-_o-this.rtt)/8}ack(_t){if(_t.packetNumber===this.lastOrderedPacketNumber+1)for(this.batchAckPacketQueue.length>=this.maxBatchAckCount&&this.batchAck(),this.batchAckTimer?this.batchAckPacketQueue.push(_t):(this.batchAckPacketQueue.push(_t),this.batchAckTimer=window.setTimeout(()=>{this.batchAck()},this.rtt/8)),this.lastOrderedPacketNumber+=1,this.receiveImpl(_t.payload);;){const _r=this.unorderedPacketQueue[0];if(!_r){this.unorderedPacketQueue.shift();break}this.batchAckTimer&&this.batchAck(),this.receiveImpl(_r.payload),this.unorderedPacketQueue.shift(),this.lastOrderedPacketNumber+=1}else if(_t.packetNumber<=this.lastOrderedPacketNumber){const _r={ackSendTs:_t.sendTs,maxAckPacketNumber:_t.packetNumber,shift:0,type:lS.Ack,version:this.version};this.sendPacket(_r)}else if(_t.packetNumber>this.lastOrderedPacketNumber){this.unorderedPacketQueue[_t.packetNumber-this.lastOrderedPacketNumber-2]=_t;const _r={ackSendTs:_t.sendTs,maxAckPacketNumber:_t.packetNumber,shift:0,type:lS.Ack,version:this.version};this.sendPacket(_r)}}batchAck(){window.clearTimeout(this.batchAckTimer),this.batchAckTimer=void 0;const _t={ackSendTs:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].sendTs,maxAckPacketNumber:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].packetNumber,shift:this.batchAckPacketQueue.length-1,type:lS.Ack,version:this.version};this.sendPacket(_t),this.batchAckPacketQueue=[]}sendPacket(_t){_t.type===lS.Default&&(_t.sendTs=Math.round(performance.now()));const _r=this.serialize(_t);this.sendImpl(_r)}clearRTO(_t){for(let _r=_t.maxAckPacketNumber-_t.shift;_r<=_t.maxAckPacketNumber;_r++){const _o=this.timeoutMap.get(_r);_o!==void 0&&window.clearTimeout(_o),this.timeoutMap.delete(_r),this.rtoRatioMap.delete(_r)}}}class YW extends ene{constructor(_t,_r){super(_t,_r,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3?arguments[3]:void 0),Ml(this,"_initMutex",void 0),Ml(this,"_reconnectInterrupter",void 0),Ml(this,"_url",void 0),Ml(this,"_transmitter",void 0),Ml(this,"_addresses",void 0),Ml(this,"_reliableTransmission",void 0),this._initMutex=new iT("datachannel");const{timeout:_o,timeoutFactor:_a}=_r,_u=Math.max(300,Math.floor(3*_o/5)),yl=Math.max(1.2,Math.floor(8*_a)/10);Y_.ONLINE&&(this._retryConfig.timeout=_u,this._retryConfig.timeoutFactor=yl),n_.on(p1.NETWORK_STATE_CHANGE,(Rl,Al)=>{Rl!==Al&&(this.resetReconnectCount("network state change: ".concat(Al," -> ").concat(Rl)),Rl===Y_.ONLINE?(this._retryConfig.timeout=_u,this._retryConfig.timeoutFactor=yl):(this._retryConfig.timeout=_o,this._retryConfig.timeoutFactor=_a))})}getConnection(){if(this._reliableTransmission)return this._reliableTransmission}async init(_t){let _r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;this._forceCloseTimeout=_r;const _o=(_a,_u)=>{this._addresses=_t,this.currentURLIndex=this._addresses.findIndex(Rl=>Rl.fingerprint||Pp("FINGERPRINT"));const yl=this._addresses[this.currentURLIndex];this.state="connecting",this.createTransmitterConnection(yl).then(_a).catch(_u),this.once(By.CLOSED,()=>_u(new Tp(Ql.WS_DISCONNECT))),this.once(By.CONNECTED,()=>_a())};return this._initMutex.lock().then(_a=>new u0((_u,yl)=>{_o(_u,yl)}).then(()=>{_a()}).catch(()=>{_a()}))}sendMessage(_t){let _r=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this._transmitter||!this._reliableTransmission)throw new Tp(Ql.WS_ABORT,"datachannel is not ready");try{_r||(_t=JSON.stringify(_t)),this._reliableTransmission.sendMessage(_t)}catch(_o){throw new Tp(Ql.WS_ERR,"send datachannel signal message error"+_o.toString())}}unbindDcCloseEventListener(){this._transmitter&&(this._transmitter.onclose=null)}sendMessageWithJSON(_t){const _r=JSON.stringify(_t);return{compressed:_r,compressedLength:_r.length,origin:_t}}sendMessageWithUint8Array(_t){return{compressed:_t,compressedLength:_t.byteLength,origin:_t}}createTransmitterConnection(_t){return this.connectionID+=1,this._joinChannelServiceRecordIndex=void 0,this._url="dc://".concat(_t.ip,":").concat(_t.port),new u0((_r,_o)=>{var _a;const _u=()=>{Vl.debug("[".concat(this._name,"] datachannel opened:"),this._url),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),_r()},yl=async xl=>{var Ll;if((Ll=this._closeEstablishingTransmitter)===null||Ll===void 0||Ll.call(this),Vl.debug("[".concat(this._name,"] datachannel close ").concat(this._url,", code: ").concat(xl.code,", reason: ").concat(xl.reason,", current mode: ").concat(this.reconnectMode)),this._reconnectCount<this._retryConfig.maxRetryCount){this.state==="connected"&&(this.reconnectReason=xl.reason,this.state="reconnecting");const Bl=cR(this,By.WILL_RECONNECT,this.reconnectMode)||this.reconnectMode,Hl=await this.reconnectWithAction(Bl);if(this.state==="closed")return void Vl.debug("[".concat(this.connectionID,"] dc is closed, no need to reconnect"));if(!Hl)return _o(new Tp(Ql.WS_DISCONNECT,"datachannel reconnect failed: ".concat(xl.code))),void this.close(!0);_r()}else _o(new Tp(Ql.WS_DISCONNECT,"datachannel close: ".concat(xl.code))),this.close()},Rl=xl=>{var Ll;(Ll=this._reliableTransmission)===null||Ll===void 0||Ll.onData(xl.data)};this._transmitter&&(this._transmitter.onclose=null,this._transmitter.close()),this._reliableTransmission&&(this._reliableTransmission.close(),this._reliableTransmission=void 0),Vl.debug("[".concat(this._name,"] start connect, address: ").concat(JSON.stringify(_t)));const Al=(_a=this._store)===null||_a===void 0?void 0:_a.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"}),Ol=Date.now();W_(this,By.TO_CONNECT_DATACHANNEL,_t).then(xl=>{var Ll,Bl;if(!xl)throw new Error("transmissonInfo not exist yet");const{transmitter:Hl,close:up}=xl;this._transmitter=Hl,(Ll=this._store)===null||Ll===void 0||Ll.signalChannelOpen();const _f=Date.now()-Ol;Vl.debug("[choose dc] dc open cost ".concat(_f,"ms")),this._reliableTransmission=new tne(vp=>{var Dp;this._transmitter&&this._transmitter.readyState==="open"&&((Dp=this._transmitter)===null||Dp===void 0||Dp.send(vp))},vp=>{typeof vp=="string"&&this.emit(By.ON_MESSAGE,vp)}),this._closeEstablishingTransmitter=()=>{var vp;(vp=this._reliableTransmission)===null||vp===void 0||vp.close(),this._reliableTransmission=void 0,up()},_u&&_u(),Hl.onclose=yl,Hl.onmessage=Rl,(Bl=this._store)===null||Bl===void 0||Bl.recordJoinChannelService({endTs:Date.now(),status:"success"},Al),this._joinChannelServiceRecordIndex=Al}).catch(xl=>{var Ll;if((Ll=this._store)===null||Ll===void 0||Ll.recordJoinChannelService({endTs:Date.now(),status:xl instanceof Tp&&xl.code===Ql.WS_ABORT?"aborted":"error",errors:[xl]},Al),this.state!=="closed"){if(xl instanceof Tp&&xl.code===Ql.WS_ERR){const Bl=new Tp(Ql.WS_ERR,"init datachannel failed! Error: ".concat(xl.toString()));return Vl.error("[".concat(this._name,"]").concat(Bl)),void _o(Bl)}yl&&yl(xl)}else _o(new Tp(Ql.WS_DISCONNECT,"datachannel is closed: ".concat(xl.toString())))})})}async reconnectWithAction(_t){let _r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this._reconnectCount>=this._retryConfig.maxRetryCount||!this._addresses||this.state==="closed")return!1;this._onlineReconnectListener||n_.networkState!==Y_.OFFLINE||(this._onlineReconnectListener=n_.onlineWaiter&&n_.onlineWaiter.then(()=>{this._onlineReconnectListener=void 0}));let _o=!0;if(this._reconnectInterrupter=()=>{_o=!1},_r){const yl=Y6(this._reconnectCount,this._retryConfig);Vl.debug("[".concat(this._name,"] wait ").concat(yl,"ms to reconnect datachannel, mode: ").concat(_t)),await u0.race([G_(yl),this._onlineReconnectListener||new u0(()=>{})])}if(this.state==="closed"||!_o)return!1;this._reconnectCount+=1;const _a=async(yl,Rl)=>{this.emit(By.RECONNECT_CREATE_CONNECTION,Rl),await this.createTransmitterConnection(yl)};try{if(_t==="retry"){const yl=this._addresses[this.currentURLIndex];this.emit(By.RECONNECT_WAITTING_FINISH,_t),await _a(yl,_t)}else if(_t==="tryNext"){this.currentURLIndex+=1;for(let Rl=this.currentURLIndex;Rl<this._addresses.length;Rl++){if(this._addresses[Rl].fingerprint||Pp("FINGERPRINT")){this.currentURLIndex=Rl;break}this.currentURLIndex+=1}if(this.currentURLIndex>=this._addresses.length)return Vl.debug("[".concat(this._name,"] the available addresses are exhausted, change to recover")),await this.reconnectWithAction("recover",!1);Vl.debug("[".concat(this._name,"] datachannel url length: ").concat(this._addresses.length," current index: ").concat(this.currentURLIndex));const yl=this._addresses[this.currentURLIndex];this.emit(By.RECONNECT_WAITTING_FINISH,_t),await _a(yl,_t)}else _t==="recover"&&(Vl.debug("[".concat(this._name,"] start to failback to websocket")),this.resetReconnectCount("recover mode"),this.emit(By.RECONNECT_WAITTING_FINISH,_t),this.emit(By.FAILBACK));return!0}catch(yl){var _u;return Vl.error("[".concat(this._name,"] reconnect failed"),yl.toString()),yl!=null&&(_u=yl.data)!==null&&_u!==void 0&&_u.desc&&Array.isArray(yl.data.desc)&&yl.data.desc.length&&yl.data.desc.includes("dynamic key expired")?(this.emit(By.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):await this.reconnectWithAction(_t,_r)}}}class UR extends Hy{get connectionState(){return this._connectionState}set connectionState(_t){_t!==this._connectionState&&(this._connectionState=_t,_t===py.CONNECTED?this.emit(p0.WS_CONNECTED):_t===py.RECONNECTING?this.emit(p0.WS_RECONNECTING,this._websocketReconnectReason):_t===py.CLOSED&&this.emit(p0.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket?this.websocket.url:null}get rtt(){return this.rttRolling.mean()}constructor(_t,_r){super(),Ml(this,"_disconnectedReason",void 0),Ml(this,"_websocketReconnectReason",void 0),Ml(this,"_connectionState",py.CLOSED),Ml(this,"reconnectToken",void 0),Ml(this,"websocket",void 0),Ml(this,"openConnectionTime",void 0),Ml(this,"clientId",void 0),Ml(this,"lastMsgTime",Date.now()),Ml(this,"uploadCache",[]),Ml(this,"uploadCacheInterval",void 0),Ml(this,"rttRolling",new WW(5)),Ml(this,"pingpongTimer",void 0),Ml(this,"inflateDataTimer",void 0),Ml(this,"pingpongTimeoutCount",0),Ml(this,"joinResponse",void 0),Ml(this,"multiIpOption",void 0),Ml(this,"initError",void 0),Ml(this,"spec",void 0),Ml(this,"store",void 0),Ml(this,"onWebsocketMessage",_o=>{if(_o instanceof ArrayBuffer)return void this.emit(p0.ON_BINARY_DATA,_o);const _a=JSON.parse(_o);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(_a,"_id")){const _u="res-@".concat(_a._id);this.emit(_u,_a._result,_a._message)}else if(Object.prototype.hasOwnProperty.call(_a,"_type")&&(this.emit(_a._type,_a._message),_a._type===U0.ON_NOTIFICATION&&this.handleNotification(_a._message),_a._type===U0.ON_USER_BANNED))switch(_a._message.error_code){case 14:this.close(cy.UID_BANNED);break;case 15:this.close(cy.IP_BANNED);break;case 16:this.close(cy.CHANNEL_BANNED)}}),this.clientId=_t.clientId,this.spec=_t,this.store=_r,this.websocket=new YW("gateway-".concat(this.clientId),this.spec.retryConfig,!0,_r),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===py.CONNECTED&&this.reconnect("retry",oR.OFFLINE)})}async request(_t,_r,_o,_a){const _u=Ny(6,""),yl={_id:_u,_type:_t,_message:_r},Rl=this.websocket.connectionID,Al=()=>new u0((up,_f)=>{if(this.connectionState===py.CONNECTED)return up();const vp=()=>{this.off(p0.WS_CLOSED,Dp),up()},Dp=()=>{this.off(p0.WS_CONNECTED,vp),_f(new Tp(Ql.WS_ABORT))};this.once(p0.WS_CONNECTED,vp),this.once(p0.WS_CLOSED,Dp),_t!==I0.PUBLISH&&_t!==I0.SUBSCRIBE&&_t!==I0.UNSUBSCRIBE&&_t!==I0.UNPUBLISH&&_t!==I0.CONTROL&&_t!==I0.RESTART_ICE||this.once(p0.DISCONNECT_P2P,()=>{_f(new Tp(Ql.DISCONNECT_P2P))}),_t!==I0.PUBLISH&&_t!==I0.RESTART_ICE||this.once(p0.ABORT_P2P_EXECUTION,()=>{_f(new Tp(Ql.DISCONNECT_P2P))})});if(this.connectionState!==py.CONNECTING&&this.connectionState!==py.RECONNECTING||_t===I0.JOIN||_t===I0.REJOIN||await Al(),_t===I0.LEAVE&&(this.websocket.unbindDcCloseEventListener(),_a=!0),this.websocket.sendMessage(yl,!0,!1),_a)return;const Ol=new u0((up,_f)=>{let vp=!1;const Dp=(_g,y0)=>{vp=!0,up({isSuccess:_g==="success",message:y0||{}}),this.off(p0.WS_CLOSED,Bp),this.off(p0.WS_RECONNECTING,Bp),this.emit(p0.REQUEST_SUCCESS,_t,_r)};this.once("res-@".concat(_u),Dp);const Bp=()=>{_f(new Tp(Ql.WS_ABORT,"type: ".concat(_t))),this.off(p0.WS_CLOSED,Bp),this.off(p0.WS_RECONNECTING,Bp),this.off("res-@".concat(_u),Dp)};this.once(p0.WS_CLOSED,Bp),this.once(p0.WS_RECONNECTING,Bp),G_(Pp("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==Rl||vp||(Vl.warning("dc request timeout, type: ".concat(_t)),this.emit(p0.REQUEST_TIMEOUT,_t,_r))})});let xl=null;try{xl=await Ol}catch(up){if(this.connectionState===py.CLOSED||_t===I0.LEAVE)throw new Tp(Ql.WS_ABORT);return!this.spec.forceWaitGatewayResponse||_o?up.throw():_t===I0.JOIN||_t===I0.REJOIN?null:(await Al(),await this.request(_t,_r))}if(xl.isSuccess)return xl.message;const Ll=Number(xl.message.error_code||xl.message.code),Bl=h2(Ll),Hl=new Tp(Ql.UNEXPECTED_RESPONSE,"".concat(Bl.desc,": ").concat(xl.message.error_str),{code:Ll,data:xl.message});return Bl.action==="success"?xl.message:(Vl.warning("[".concat(this.websocket.connectionID,"] unexpected response from type ").concat(_t,", error_code: ").concat(Ll,", message: ").concat(Bl.desc,", action: ").concat(Bl.action)),Ll===E0.ERR_TOO_MANY_BROADCASTERS?((_t===I0.JOIN||_t===I0.REJOIN)&&(this.initError=Hl,this.close()),Hl.throw()):Bl.action==="failed"?Hl.throw():Bl.action==="quit"?(this.initError=Hl,this.close(),Hl.throw()):(Ll===E0.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=xl.message.option,Vl.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",oR.MULTI_IP)):this.reconnect(Bl.action,oR.SERVER_ERROR),_t===I0.JOIN||_t===I0.REJOIN?null:await this.request(_t,_r)))}waitMessage(_t,_r){return new u0(_o=>{const _a=_u=>{(!_r||_r(_u))&&(this.off(_t,_a),_o(_u))};this.on(_t,_a)})}upload(_t,_r){const _o={_type:_t,_message:_r};try{this.websocket.sendMessage(_o)}catch{const _u=Pp("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(_o),this.uploadCache.length>_u&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==py.CONNECTED)return;const yl=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(yl._type,yl._message)},Pp("UPLOAD_CACHE_INTERVAL")||2e3))}}send(_t,_r){const _o={_type:_t,_message:_r};this.websocket.sendMessage(_o)}init(_t,_r){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new u0((_o,_a)=>{this.once(p0.WS_CONNECTED,()=>_o(this.joinResponse)),this.once(p0.WS_CLOSED,()=>_a(this.initError||new Tp(Ql.WS_ABORT))),this.connectionState=py.CONNECTING,this.websocket.init(_t).catch(_a),this.websocket.once(By.FAILBACK,()=>{this.openConnectionTime===void 0&&_a(new Tp(Ql.INIT_DATACHANNEL_TIMEOUT))}),this.inflateDataTimer&&window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=window.setInterval(()=>{this.handleInflateData()},2e4),setTimeout(()=>{_r&&this.openConnectionTime===void 0&&(Vl.debug("[".concat(this.clientId,"] init datachannel timeout while join with failback to websocket")),_a(new Tp(Ql.INIT_DATACHANNEL_TIMEOUT)))},Pp("DC_JOIN_WITH_FAILBACK"))})}close(_t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.inflateDataTimer&&(this.handleInflateData(),window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=_t||cy.LEAVE,this.connectionState=py.CLOSED,Vl.debug("[".concat(this.clientId,"] ")+"will close datachannel in signal"),this.websocket.close(),_t===cy.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new YW("gateway-".concat(this.clientId),this.spec.retryConfig,!0,this.store),this.handleWebsocketEvents())}async join(){if(!this.joinResponse){this.emit(p0.ABORT_P2P_EXECUTION);const _t=await W_(this,p0.DATACHANNEL_CONNECTING),_r=await this.request(I0.JOIN,_t);if(!_r)return this.emit(p0.REPORT_JOIN_GATEWAY,Ql.TIMEOUT,this.url||""),!1;this.joinResponse=_r,this.emit(p0.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=py.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new Tp(Ql.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const _t=dO(this,p0.REQUEST_REJOIN_INFO);_t.token=this.reconnectToken;const _r=await this.request(I0.REJOIN,_t);return!!_r&&(this.connectionState=py.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),_r.peers&&_r.peers.forEach(_o=>{this.emit(U0.ON_USER_ONLINE,{uid:_o.uid}),_o.audio&&this.emit(U0.ON_ADD_AUDIO_STREAM,{uid:_o.uid,uint_id:_o.uint_id,audio:!0,ssrcId:_o.audio_ssrc}),_o.video&&this.emit(U0.ON_ADD_VIDEO_STREAM,{uid:_o.uid,uint_id:_o.uint_id,video:!0,ssrcId:_o.video_ssrc}),_o.audio_mute?this.emit(U0.MUTE_AUDIO,{uid:_o.uid}):this.emit(U0.UNMUTE_AUDIO,{uid:_o.uid}),_o.video_mute?this.emit(U0.MUTE_VIDEO,{uid:_o.uid}):this.emit(U0.UNMUTE_VIDEO,{uid:_o.uid}),_o.audio_enable_local?this.emit(U0.ENABLE_LOCAL_AUDIO,{uid:_o.uid}):this.emit(U0.DISABLE_LOCAL_AUDIO,{uid:_o.uid}),_o.video_enable_local?this.emit(U0.ENABLE_LOCAL_VIDEO,{uid:_o.uid}):this.emit(U0.DISABLE_LOCAL_VIDEO,{uid:_o.uid}),_o.audio||_o.video||this.emit(U0.ON_REMOVE_STREAM,{uid:_o.uid,uint_id:_o.uint_id})}),!0)}reconnect(_t,_r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(_t,_r)}handleNotification(_t){Vl.debug("[".concat(this.clientId,"] receive notification: "),_t);const _r=h2(_t.code);if(_r.action!=="success"){if(_r.action!=="failed")return _r.action==="quit"?(_r.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(cy.UID_BANNED),void this.close()):void this.reconnect(_r.action,oR.SERVER_ERROR);Vl.error("[".concat(this.clientId,"] ignore error: "),_r.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const _t=Pp("PING_PONG_TIME_OUT"),_r=Date.now();this.pingpongTimeoutCount>=_t&&(Vl.warning("PINGPONG Timeout. Last Socket Message: ".concat(_r-this.lastMsgTime,"ms")),_r-this.lastMsgTime>Pp("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",oR.TIMEOUT):this.request(I0.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const _o=Date.now()-_r;this.rttRolling.add(_o),Pp("REPORT_STATS")&&this.send(I0.PING_BACK,{pingpongElapse:_o})}).catch(_o=>{})}handleInflateData(){const{inflateLength:_t,deflateLength:_r}=this.websocket.getInflateData();_t!==0&&_r!==0&&this.upload(ET.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:_r,ws_inflate_length:_t})}handleWebsocketEvents(){this.websocket.on(By.RECONNECT_WAITTING_FINISH,_t=>{this.emit(p0.WS_RECONNECT_WAITTING_FINISH,_t)}),this.websocket.on(By.RECONNECT_CREATE_CONNECTION,_t=>{this.emit(p0.WS_RECONNECT_CREATE_CONNECTION,_t)}),this.websocket.on(By.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(By.CLOSED,()=>{this.connectionState=py.CLOSED}),this.websocket.on(By.FAILED,()=>{this._disconnectedReason=cy.NETWORK_ERROR,this.connectionState=py.CLOSED}),this.websocket.on(By.RECONNECTING,_t=>{this._websocketReconnectReason=_t,this.joinResponse=void 0,this.connectionState===py.CONNECTED?this.connectionState=py.RECONNECTING:this.connectionState=py.CONNECTING}),this.websocket.on(By.WILL_RECONNECT,(_t,_r)=>{if(dO(this,p0.IS_P2P_DISCONNECTED)&&_t==="retry")return Vl.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),this.reconnectToken=void 0,this.emit(p0.NEED_RENEW_SESSION),this.emit(p0.DISCONNECT_P2P),_r("tryNext");_t!=="retry"&&(Vl.debug("".concat(this.clientId," websockt will_connect event, renewSession reconnectMode is ").concat(_t)),this.reconnectToken=void 0,this.emit(p0.NEED_RENEW_SESSION),this.emit(p0.DISCONNECT_P2P)),_r(_t)}),this.websocket.on(By.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(_t=>{Vl.warning("[".concat(this.clientId,"] rejoin failed ").concat(_t)),this.reconnect("tryNext",oR.SERVER_ERROR)}):this.join().catch(_t=>{if(this.emit(p0.REPORT_JOIN_GATEWAY,_t.message||_t.code,this.url||""),_t instanceof Tp&&_t.code===Ql.UNEXPECTED_RESPONSE&&_t.data.code===E0.ERR_NO_AUTHORIZED)return Vl.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",oR.SERVER_ERROR);Vl.error("[".concat(this.clientId,"] join gateway request failed"),_t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",oR.SERVER_ERROR):(this.initError=_t,this.close())})}),this.websocket.on(By.REQUEST_NEW_URLS,(_t,_r)=>{W_(this,p0.REQUEST_RECOVER,this.multiIpOption).then(_t).catch(_r)}),this.websocket.on(By.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(U0.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(By.TO_CONNECT_DATACHANNEL,async(_t,_r,_o)=>W_(this,p0.DATACHANNEL_PRECONNECT,_t).then(_r).catch(_o)),this.websocket.on(By.FAILBACK,()=>{this.openConnectionTime!==void 0&&this.emit(p0.DATACHANNEL_FAILBACK)})}}function XW(_e,_t){var _r=Object.keys(_e);if(Object.getOwnPropertySymbols){var _o=Object.getOwnPropertySymbols(_e);_t&&(_o=_o.filter(function(_a){return Object.getOwnPropertyDescriptor(_e,_a).enumerable})),_r.push.apply(_r,_o)}return _r}function uR(_e){for(var _t=1;_t<arguments.length;_t++){var _r=arguments[_t]!=null?arguments[_t]:{};_t%2?XW(Object(_r),!0).forEach(function(_o){Ml(_e,_o,_r[_o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_e,Object.getOwnPropertyDescriptors(_r)):XW(Object(_r)).forEach(function(_o){Object.defineProperty(_e,_o,Object.getOwnPropertyDescriptor(_r,_o))})}return _e}const F4=new Map;class nne extends Hy{get state(){return this._state}set state(_t){if(_t===this._state)return;const _r=this._state;this._state=_t,_t==="DISCONNECTED"&&this._disconnectedReason?this.emit(Dy.CONNECTION_STATE_CHANGE,_t,_r,this._disconnectedReason):this.emit(Dy.CONNECTION_STATE_CHANGE,_t,_r)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(_t){Vl.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(_t)),this._joinGatewayStartTime=_t}constructor(_t,_r){super(),Ml(this,"store",void 0),Ml(this,"joinInfo",void 0),Ml(this,"key",void 0),Ml(this,"signal",void 0),Ml(this,"role",void 0),Ml(this,"inChannelInfo",{joinAt:null,duration:0}),Ml(this,"spec",void 0),Ml(this,"_state","DISCONNECTED"),Ml(this,"_statsCollector",void 0),Ml(this,"_disconnectedReason",void 0),Ml(this,"isSignalRecover",!1),Ml(this,"hasChangeBGPAddress",!1),Ml(this,"trafficStatsInterval",void 0),Ml(this,"networkQualityInterval",void 0),Ml(this,"_joinGatewayStartTime",0),Ml(this,"_signalTimeout",!1),Ml(this,"_clientRoleOptions",void 0),Ml(this,"_isProactiveJoin",!1),this.store=_t,this.spec=_r,this.signal=this.store.useDataChannel?new UR(uR(uR({},_r),{},{retryConfig:_r.websocketRetryConfig}),_t):new HW(uR(uR({},_r),{},{retryConfig:_r.websocketRetryConfig}),_t),this._statsCollector=_r.statsCollector,this.role=_r.role||"audience",this._clientRoleOptions=_r.clientRoleOptions,this.handleSignalEvents()}async join(_t,_r,_o){if(this.signal instanceof UR){let Al=!1;_t.cloudProxyServer!=="disabled"?(Vl.debug("[".concat(this.store.clientId,"] Dc is not supported, because cloudProxyServer are not supported (").concat(_t.cloudProxyServer,")")),Al=!0):"".concat(_t.apResponse.cid,"_").concat(_t.apResponse.cert).length>255||"".concat(_t.apResponse.cid,"_").concat(_t.apResponse.cert).length<22?(Vl.debug("[".concat(this.store.clientId,"] Dc is not supported, because ticket length is incorrect, it has to be between 22 and 255")),Al=!0):_t.apResponse.addresses.some(Ol=>Ol.fingerprint)||Pp("FINGERPRINT")||(Vl.debug("[".concat(this.store.clientId,"] Dc is not supported, because fingerprint does not exist")),Al=!0),Al&&this.resetSignal()}this.store.joinGatewayStart(),_t.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const _a=Date.now();let _u=F4.get(_t.cname);if(_u||(_u=new Map,F4.set(_t.cname,_u)),this._isProactiveJoin=!0,_u.has(_t.uid)){const Al=new Tp(Ql.UID_CONFLICT);throw g0.joinGateway(_t.sid,{lts:_a,succ:!1,ec:Al.message,addr:null,uid:_t.uid,cid:_t.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!_t.proxyServer,signalChannel:this.signal instanceof UR?"1":"0"}),this._isProactiveJoin=!1,Al}_u.set(_t.uid,!0),this.joinInfo=_t,this.key=_r;let yl=0;this.joinGatewayStartTime=_a;const Rl=_t.proxyServer;try{let Al;if(Vl.debug("[".concat(this.store.clientId,"] use ").concat(this.signal instanceof UR?"datachannel":"websocket"," join uid ").concat(yl)),this.signal instanceof UR)Al=await this.signal.init(_t.apResponse.addresses,_o);else{const Ol=_t.proxyServer,xl=Ol?_t.gatewayAddrs.map(Ll=>{const Bl=Ll.address.split(":");return"wss://".concat(Ol,"/ws/?h=").concat(Bl[0],"&p=").concat(Bl[1])}):_t.gatewayAddrs.map(Ll=>"wss://".concat(Ll.address));Al=await this.signal.init(xl,_o)}yl=Al.uid,Vl.debug("[".concat(this.store.clientId,"] ").concat(this.signal instanceof UR?"datachannel":"websocket"," join uid ").concat(yl," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(Al){throw Al&&Al.code===Ql.INIT_WEBSOCKET_TIMEOUT?(Vl.warning("[".concat(this.store.clientId,"] User join failed"),Al.toString()),Al):Al&&Al.code===Ql.INIT_DATACHANNEL_TIMEOUT?(Vl.warning("[".concat(this.store.clientId,"] User join datachannel failed"),Al.toString()),this.resetSignal(),Al):(Vl.error("[".concat(this.store.clientId,"] User join failed"),Al.toString()),g0.joinGateway(_t.sid,{lts:_a,succ:!1,ec:Al.message,addr:this.signal.url,uid:_t.uid,cid:_t.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!Rl,signalChannel:this.signal instanceof UR?"1":"0"}),this._isProactiveJoin=!1,_u.delete(_t.uid),this.signal.close(),Al)}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),Vl.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(Al=>{Vl.warning("[".concat(this.store.clientId,"] get traffic stats error"),Al.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(Dy.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(Dy.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(Dy.NETWORK_QUALITY,{uplinkNetworkQuality:DW(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:DW(this._statsCollector.trafficStats.B_dnq)}):this.emit(Dy.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),yl}async leave(){let _t=arguments.length>0&&arguments[0]!==void 0&&arguments[0],_r=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){_r!==cy.FALLBACK&&(this.state="DISCONNECTING");try{_t||this.signal.connectionState!==py.CONNECTED||await function(_o,_a){return _a===1/0?_o:u0.race([_o,Jte(_a)])}(this.signal.request(I0.LEAVE,void 0,!0),3e3)}catch(_o){Vl.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),_o)}this.signal.close(_r),_r!==cy.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(_t,_r,_o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Tp(Ql.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const _a={state:"offer",p2p_id:this.store.p2pId,ortc:_r,mode:this.spec.mode,extend:Pp("PUB_EXTEND"),twcc:!!Pp("PUBLISH_TWCC")};try{return(await this.signal.request(I0.PUBLISH,_a,!0))._message}catch(_u){if(_o&&_u.data&&_u.data.code===E0.ERR_PUBLISH_REQUEST_INVALID)return Vl.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),_u.toString()),await this.tryUnpubBeforeRepub(_t,_r),this.publish(_t,_r,!1);throw _u}}async unpublish(_t,_r){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Tp(Ql.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(I0.UNPUBLISH,{stream_id:_r,ortc:_t},!0)}catch(_o){Vl.warning("unpublish warning: ",_o)}}async subscribe(_t,_r,_o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Tp(Ql.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const _a={stream_id:_t,stream_type:_r.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!Pp("SUBSCRIBE_TWCC"),extend:Pp("SUB_EXTEND"),ssrcId:_r.ssrcId};try{return(await this.signal.request(I0.SUBSCRIBE,_a,!0))._message}catch(_u){if(_o&&_u.data&&_u.data.code===E0.ERR_SUBSCRIBE_REQUEST_INVALID)return Vl.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),_u.toString()),await this.tryUnsubBeforeResub(_t,_r),await this.subscribe(_t,_r,!1);throw _u}}async subscribeAll(_t,_r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new Tp(Ql.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const _o={p2p_id:this.store.p2pId,users:_t,dtx:!1};try{return await this.signal.request(I0.SUBSCRIBE_STREAMS,_o,!0)}catch(_a){if(_r&&_a.data&&_a.data.code===E0.ERR_SUBSCRIBE_REQUEST_INVALID)return Vl.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),_a.toString()),await this.tryMassUnsubBeforeResub(_t),await this.subscribeAll(_t,!1);throw _a}}async setVideoProfile(_t){const _r=function(_o){if(!(_o.bitrateMax&&_o.bitrateMin&&_o.frameRate&&_o.height&&_o.width))return;let _a=_o.frameRate,_u=_o.width,yl=_o.height,Rl=!0;return typeof _a!="number"&&(_a=_a.exact||_a.ideal||_a.max||_a.min||0,_a||(Rl=!1)),typeof _u!="number"&&(_u=_u.exact||_u.ideal||_u.max||_u.min||0,_u||(Rl=!1)),typeof yl!="number"&&(yl=yl.exact||yl.ideal||yl.max||yl.min||0,_a||(Rl=!1)),Rl?{stream_type:0,width:_u,height:yl,fps:_a,start_bps:1e3*_o.bitrateMax,min_bps:1e3*_o.bitrateMin,target_bps:1e3*_o.bitrateMax}:void 0}(_t);if(_r)return this.signal.request(I0.SET_VIDEO_PROFILE,_r);Vl.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(_t,_r){try{await this.signal.request(I0.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:_t,stream_id:_r},!0)}catch(_o){Vl.warning("unsubscribe warning: ",_o)}}async massUnsubscribe(_t){try{await this.signal.request(I0.UNSUBSCRIBE_STREAMS,_t,!0)}catch(_r){Vl.warning("unsubscribeAll warning: ",_r)}}async reconnectPC(_t){const{iceParameters:_r,dtlsParameters:_o,rtpCapabilities:_a}=_t;return{gatewayEstablishParams:await this.signal.request(I0.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:_r,dtlsParameters:_o,rtpCapabilities:_a}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(I0.GATEWAY_INFO)}renewToken(_t){return this.signal.request(I0.RENEW_TOKEN,_t)}async setClientRole(_t,_r){if(_r&&(this._clientRoleOptions=Object.assign({},_r)),this.state!=="CONNECTED")return void(this.role=_t);let _o;_o=_t==="audience"?this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:0,await this.signal.request(I0.SET_CLIENT_ROLE,{role:_t,level:_o,client_ts:Date.now()}),this.role=_t}async setRemoteVideoStreamType(_t,_r){await this.signal.request(I0.SWITCH_VIDEO_STREAM,{stream_id:_t,stream_type:_r})}async setDefaultRemoteVideoStreamType(_t){await this.signal.request(I0.DEFAULT_VIDEO_STREAM,{stream_type:_t})}async setStreamFallbackOption(_t,_r){await this.signal.request(I0.SET_FALLBACK_OPTION,{stream_id:_t,fallback_type:_r})}async pickSVCLayer(_t,_r){await this.signal.request(I0.PICK_SVC_LAYER,{stream_id:_t,spatial_layer:_r.spatialLayer,temporal_layer:_r.temporalLayer})}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),uR({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(I0.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const _t=F4.get(this.joinInfo.cname);_t&&_t.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const _t=function(_r){let _o;return _o=_r.startsWith("dc")?_r.match(/(dc\:\/\/)?([^:]+):(\d+)/):_r.match(/(wss\:\/\/)?([^:]+):(\d+)/),_o?{username:VT.username,password:VT.password,turnServerURL:_o[2],tcpport:parseInt(_o[3])+30,udpport:parseInt(_o[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],_t&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(uR(uR({},VT),{},{turnServerURL:_t.turnServerURL,tcpport:_t.tcpport,udpport:_t.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const _t=await this.signal.request(I0.TRAFFIC_STATS,void 0,!0);_t.timestamp=Date.now(),_t.peer_delay.forEach(_r=>{const _o=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(_a=>_a.peer_uid===_r.peer_uid);_o&&_o.B_st!==_r.B_st&&IS(()=>{this.emit(Dy.STREAM_TYPE_CHANGE,_r.peer_uid,_r.B_st)})}),this._statsCollector.updateTrafficStats(_t)}getJoinMessage(_t){if(!this.joinInfo||!this.key)throw new Tp(Ql.UNEXPECTED_ERROR,"can not generate join message, no join info");const _r=Object.assign({},this.joinInfo.apResponse);let _o=Pp("REPORT_APP_SCENARIO");if(typeof _o!="string")try{_o=JSON.stringify(_o)}catch{_o=void 0}_o&&_o.length>128&&(_o=void 0);const _a=uR({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:aS,browser:navigator.userAgent,process_id:Pp("PROCESS_ID"),mode:this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:_r,extend:Pp("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:_o,attributes:{userAttributes:{enablePublishedUserList:Pp("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:Pp("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:typeof Pp("SUBSCRIBE_AUDIO_FILTER_TOPN")=="number"?Pp("SUBSCRIBE_AUDIO_FILTER_TOPN"):void 0,enablePublishAudioFilter:typeof Pp("ENABLE_PUBLISH_AUDIO_FILTER")=="boolean"?Pp("ENABLE_PUBLISH_AUDIO_FILTER"):void 0,enableUserLicenseCheck:typeof Pp("ENABLE_USER_LICENSE_CHECK")=="boolean"?Pp("ENABLE_USER_LICENSE_CHECK"):void 0}},join_ts:this.joinGatewayStartTime},_t);return this.joinInfo.stringUid&&(_a.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(_a.aes_mode=this.joinInfo.aesmode,Pp("ENCRYPT_AES")?(_a.aes_secret=this.joinInfo.aespassword,_a.aes_encrypt=!0):_a.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(_a.aes_salt=this.joinInfo.aessalt)),_r.addresses[this.signal.websocket.currentURLIndex]&&(_a.ap_response.ticket=_r.addresses[this.signal.websocket.currentURLIndex].ticket,delete _r.addresses),this.joinInfo.defaultVideoStream!==void 0&&(_a.default_video_stream=this.joinInfo.defaultVideoStream),_a}getRejoinMessage(){if(!this.joinInfo)throw new Tp(Ql.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(p0.WS_RECONNECT_WAITTING_FINISH,_t=>{["tryNext","recover"].includes(_t)&&this.joinInfo&&g0.adjustSessionStartTime(this.joinInfo.sid)}),this.signal.on(p0.WS_RECONNECT_CREATE_CONNECTION,_t=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(p0.WS_RECONNECTING,_t=>{this.joinInfo&&g0.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:_t||uT.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",g0.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(p0.WS_CLOSED,_t=>{let _r;switch(_t){case cy.LEAVE:_r=uT.LEAVE;break;case cy.UID_BANNED:case cy.IP_BANNED:case cy.CHANNEL_BANNED:case cy.SERVER_ERROR:_r=uT.SERVER_ERROR;break;case cy.FALLBACK:_r=uT.FALLBACK;break;case cy.LICENSE_MISSING:case cy.LICENSE_EXPIRED:case cy.LICENSE_MINUTES_EXCEEDED:case cy.LICENSE_PERIOD_INVALID:case cy.LICENSE_MULTIPLE_SDK_SERVICE:case cy.LICENSE_ILLEGAL:_r=_t;break;default:_r=uT.NETWORK_ERROR}Vl.debug("[signal] websocket closed, reason: ".concat(_r||"undefined -> "+uT.NETWORK_ERROR)),this.joinInfo&&g0.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:_t===cy.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:_r}),this._disconnectedReason=_t,_t!==cy.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(p0.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo&&(this.role==="audience"&&this._clientRoleOptions&&this._clientRoleOptions.level&&(Vl.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(this._clientRoleOptions&&this._clientRoleOptions.level)),this.setClientRole(this.role,this._clientRoleOptions)),g0.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:this.signal instanceof UR?"1":"0"}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1)){const _t=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!_t)return void Vl.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(_t));Ey("EVENT_REPORT_DOMAIN",_t[1]),Ey("EVENT_REPORT_BACKUP_DOMAIN",_t[1]),Ey("LOG_UPLOAD_SERVER","".concat(_t[1],":6444"))}}),this.signal.on(U0.ON_UPLINK_STATS,_t=>{this._statsCollector.updateUplinkStats(_t)}),this.signal.on(p0.REQUEST_RECOVER,(_t,_r,_o)=>{if(!this.joinInfo)return _o(new Tp(Ql.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));_t&&(this.joinInfo.multiIP=_t,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,W_(this,Dy.REQUEST_NEW_GATEWAY_LIST).then(_r).catch(_o)}),this.signal.on(p0.REQUEST_JOIN_INFO,async _t=>{var _r;this.updateTurnConfigFromSignal();const{iceParameters:_o,dtlsParameters:_a,rtpCapabilities:_u}=await W_(this,Dy.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:(_r=this.joinInfo)===null||_r===void 0?void 0:_r.turnServer});_t(this.getJoinMessage({ortc:{iceParameters:_o,dtlsParameters:_a,rtpCapabilities:_u,version:"2"}}))}),this.signal.on(p0.REQUEST_REJOIN_INFO,_t=>{_t(this.getRejoinMessage())}),this.signal.on(p0.REPORT_JOIN_GATEWAY,(_t,_r)=>{this.joinInfo&&(g0.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:_t,addr:_r,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:this.signal instanceof UR?"1":"0"}),this._isProactiveJoin=!1)}),this.signal.on(p0.IS_P2P_DISCONNECTED,_t=>{_t(dO(this,Dy.IS_P2P_DISCONNECTED))}),this.signal.on(p0.DISCONNECT_P2P,()=>{this.emit(Dy.DISCONNECT_P2P)}),this.signal.on(p0.NEED_RENEW_SESSION,()=>{this.emit(Dy.NEED_RENEW_SESSION)}),this.signal.on(p0.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(p0.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(p0.JOIN_RESPONSE,_t=>{const _r=this.getCurrentGatewayAddress();this.emit(Dy.JOIN_RESPONSE,_t,_r)}),this.signal.on(p0.DATACHANNEL_PRECONNECT,async(_t,_r,_o)=>{this.updateTurnConfigFromSignal();const _a=this.getCurrentGatewayAddress();return W_(this,Dy.DATACHANNEL_PRECONNECT,_t,_a).then(_r).catch(_o)}),this.signal.on(p0.DATACHANNEL_CONNECTING,async _t=>{const{iceParameters:_r,dtlsParameters:_o,rtpCapabilities:_a}=await W_(this,Dy.REQUEST_DC_CONNECTION_PARAMS);_t(this.getJoinMessage({ortc:{iceParameters:_r,dtlsParameters:_o,rtpCapabilities:_a,version:"2"}}))}),this.signal.on(p0.DATACHANNEL_FAILBACK,()=>{Vl.warning("[".concat(this.store.clientId,"] User join datachannel failed")),this.reset(),this.resetSignal(),this.emit(Dy.DATACHANNEL_FAILBACK)})}async tryUnsubBeforeResub(_t,_r){try{await this.signal.request(I0.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:_t,ortc:[_r]},!0)}catch(_o){throw Vl.warning("unsubscribe warning",_o),_o}}async tryUnpubBeforeRepub(_t,_r){try{await this.signal.request(I0.UNPUBLISH,{stream_id:_t,ortc:_r},!0)}catch(_o){throw Vl.warning("unpublish warning: ",_o),_o}}async tryMassUnsubBeforeResub(_t){const _r={users:_t.map(_o=>({stream_id:_o.stream_id,stream_type:_o.stream_type}))};try{await this.signal.request(I0.UNSUBSCRIBE_STREAMS,_r,!0)}catch(_o){throw Vl.warning("massUnsubscribe warning",_o),_o}}async muteLocal(_t,_r){const _o={action:_t.find(_a=>_a.stream_type===l_.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:_t,stream_id:_r};try{await this.signal.request(I0.CONTROL,_o,!0,!0)}catch(_a){throw Vl.warning("gateway unmuteLocal warning: ",_a),_a}}async unmuteLocal(_t,_r){const _o={action:_t.find(_a=>_a.stream_type===l_.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:_t,stream_id:_r};try{await this.signal.request(I0.CONTROL,_o,!0,!0)}catch(_a){throw Vl.warning("gateway muteLocal warning: ",_a),_a}}uploadStats(_t,_r){this.signal.upload(_t,_r)}getSignalRTT(){return this.signal.rtt}async restartICE(_t){const _r={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:_t};try{return await this.signal.request(I0.RESTART_ICE,_r,!0)}catch(_o){throw Vl.warning("P2PChannel.restartICE warning: ",_o),_o}}reconnect(){this.state==="CONNECTED"&&this.signal.reconnect(void 0,uT.P2P_FAILED)}getCurrentGatewayAddress(){var _t;if(!Pp("GATEWAY_WSS_ADDRESS"))return(_t=this.joinInfo)!==null&&_t!==void 0&&_t.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(_t){await this.signal.request(I0.SET_PARAMETER,{enablePublishAudioFilter:_t})}resetSignal(){this.signal&&(this.signal.removeAllListeners(),this.signal.close(cy.FALLBACK)),this.store.useDataChannel=!1,this.signal=new HW(uR(uR({},this.spec),{},{retryConfig:this.spec.websocketRetryConfig}),this.store),this.handleSignalEvents(),this.emit(Dy.RESET_SIGNAL,W5.websocket)}}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var _e;function _t(Vp){var Jp=0;return function(){return Jp<Vp.length?{done:!1,value:Vp[Jp++]}:{done:!0}}}var _r=typeof Object.defineProperties=="function"?Object.defineProperty:function(Vp,Jp,s0){return Vp==Array.prototype||Vp==Object.prototype||(Vp[Jp]=s0.value),Vp},_o,_a=function(Vp){Vp=[typeof globalThis=="object"&&globalThis,Vp,typeof window=="object"&&window,typeof self=="object"&&self,typeof _=="object"&&_];for(var Jp=0;Jp<Vp.length;++Jp){var s0=Vp[Jp];if(s0&&s0.Math==Math)return s0}throw Error("Cannot find global object")}(this);function _u(Vp,Jp){if(Jp)e:{var s0=_a;Vp=Vp.split(".");for(var O0=0;O0<Vp.length-1;O0++){var Z0=Vp[O0];if(!(Z0 in s0))break e;s0=s0[Z0]}(Jp=Jp(O0=s0[Vp=Vp[Vp.length-1]]))!=O0&&Jp!=null&&_r(s0,Vp,{configurable:!0,writable:!0,value:Jp})}}function yl(Vp){return(Vp={next:Vp})[Symbol.iterator]=function(){return this},Vp}function Rl(Vp){var Jp=typeof Symbol<"u"&&Symbol.iterator&&Vp[Symbol.iterator];return Jp?Jp.call(Vp):{next:_t(Vp)}}if(_u("Symbol",function(Vp){function Jp(Z0,_m){this.A=Z0,_r(this,"description",{configurable:!0,writable:!0,value:_m})}if(Vp)return Vp;Jp.prototype.toString=function(){return this.A};var s0="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",O0=0;return function Z0(_m){if(this instanceof Z0)throw new TypeError("Symbol is not a constructor");return new Jp(s0+(_m||"")+"_"+O0++,_m)}}),_u("Symbol.iterator",function(Vp){if(Vp)return Vp;Vp=Symbol("Symbol.iterator");for(var Jp="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),s0=0;s0<Jp.length;s0++){var O0=_a[Jp[s0]];typeof O0=="function"&&typeof O0.prototype[Vp]!="function"&&_r(O0.prototype,Vp,{configurable:!0,writable:!0,value:function(){return yl(_t(this))}})}return Vp}),typeof Object.setPrototypeOf=="function")_o=Object.setPrototypeOf;else{var Al;e:{var Ol={};try{Ol.__proto__={a:!0},Al=Ol.a;break e}catch{}Al=!1}_o=Al?function(Vp,Jp){if(Vp.__proto__=Jp,Vp.__proto__!==Jp)throw new TypeError(Vp+" is not extensible");return Vp}:null}var xl=_o;function Ll(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function Bl(Vp){if(Vp.m)throw new TypeError("Generator is already running");Vp.m=!0}function Hl(Vp,Jp){return Vp.h=3,{value:Jp}}function up(Vp){this.g=new Ll,this.G=Vp}function _f(Vp,Jp,s0,O0){try{var Z0=Jp.call(Vp.g.j,s0);if(!(Z0 instanceof Object))throw new TypeError("Iterator result "+Z0+" is not an object");if(!Z0.done)return Vp.g.m=!1,Z0;var _m=Z0.value}catch(Fl){return Vp.g.j=null,Vp.g.s(Fl),vp(Vp)}return Vp.g.j=null,O0.call(Vp.g,_m),vp(Vp)}function vp(Vp){for(;Vp.g.h;)try{var Jp=Vp.G(Vp.g);if(Jp)return Vp.g.m=!1,{value:Jp.value,done:!1}}catch(s0){Vp.g.v=void 0,Vp.g.s(s0)}if(Vp.g.m=!1,Vp.g.l){if(Jp=Vp.g.l,Vp.g.l=null,Jp.F)throw Jp.D;return{value:Jp.return,done:!0}}return{value:void 0,done:!0}}function Dp(Vp){this.next=function(Jp){return Vp.o(Jp)},this.throw=function(Jp){return Vp.s(Jp)},this.return=function(Jp){return function(s0,O0){Bl(s0.g);var Z0=s0.g.j;return Z0?_f(s0,"return"in Z0?Z0.return:function(_m){return{value:_m,done:!0}},O0,s0.g.return):(s0.g.return(O0),vp(s0))}(Vp,Jp)},this[Symbol.iterator]=function(){return this}}function Bp(Vp,Jp){return Jp=new Dp(new up(Jp)),xl&&Vp.prototype&&xl(Jp,Vp.prototype),Jp}if(Ll.prototype.o=function(Vp){this.v=Vp},Ll.prototype.s=function(Vp){this.l={D:Vp,F:!0},this.h=this.C||this.u},Ll.prototype.return=function(Vp){this.l={return:Vp},this.h=this.u},up.prototype.o=function(Vp){return Bl(this.g),this.g.j?_f(this,this.g.j.next,Vp,this.g.o):(this.g.o(Vp),vp(this))},up.prototype.s=function(Vp){return Bl(this.g),this.g.j?_f(this,this.g.j.throw,Vp,this.g.o):(this.g.s(Vp),vp(this))},_u("Array.prototype.entries",function(Vp){return Vp||function(){return function(Jp,s0){Jp instanceof String&&(Jp+="");var O0=0,Z0=!1,_m={next:function(){if(!Z0&&O0<Jp.length){var Fl=O0++;return{value:s0(Fl,Jp[Fl]),done:!1}}return Z0=!0,{done:!0,value:void 0}}};return _m[Symbol.iterator]=function(){return _m},_m}(this,function(Jp,s0){return[Jp,s0]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var _g=function(Vp,Jp){for(var s0=0;s0<Vp.length;s0++)Jp(Vp[s0])},y0=function(Vp){return Vp.replace(/\r?\n|\r/g,`\r
`)},e0=function(Vp,Jp,s0){return Jp instanceof Blob?(s0=s0!==void 0?s0+"":typeof Jp.name=="string"?Jp.name:"blob",Jp.name===s0&&Object.prototype.toString.call(Jp)!=="[object Blob]"||(Jp=new File([Jp],s0)),[String(Vp),Jp]):[String(Vp),String(Jp)]},r0=function(Vp,Jp){if(Vp.length<Jp)throw new TypeError(Jp+" argument required, but only "+Vp.length+" present.")},Zp=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,h0=Zp.FormData,_y=Zp.XMLHttpRequest&&Zp.XMLHttpRequest.prototype.send,k0=Zp.Request&&Zp.fetch,Oy=Zp.navigator&&Zp.navigator.sendBeacon,by=Zp.Element&&Zp.Element.prototype,Xy=Zp.Symbol&&Symbol.toStringTag;Xy&&(Blob.prototype[Xy]||(Blob.prototype[Xy]="Blob"),"File"in Zp&&!File.prototype[Xy]&&(File.prototype[Xy]="File"));try{new File([],"")}catch{Zp.File=function(Jp,s0,O0){return Jp=new Blob(Jp,O0||{}),Object.defineProperties(Jp,{name:{value:s0},lastModified:{value:+(O0&&O0.lastModified!==void 0?new Date(O0.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),Xy&&Object.defineProperty(Jp,Xy,{value:"File"}),Jp}}var P_=function(Vp){return Vp.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},zy=function(Vp){this.i=[];var Jp=this;Vp&&_g(Vp.elements,function(s0){if(s0.name&&!s0.disabled&&s0.type!=="submit"&&s0.type!=="button"&&!s0.matches("form fieldset[disabled] *"))if(s0.type==="file"){var O0=s0.files&&s0.files.length?s0.files:[new File([],"",{type:"application/octet-stream"})];_g(O0,function(Z0){Jp.append(s0.name,Z0)})}else s0.type==="select-multiple"||s0.type==="select-one"?_g(s0.options,function(Z0){!Z0.disabled&&Z0.selected&&Jp.append(s0.name,Z0.value)}):s0.type==="checkbox"||s0.type==="radio"?s0.checked&&Jp.append(s0.name,s0.value):(O0=s0.type==="textarea"?y0(s0.value):s0.value,Jp.append(s0.name,O0))})};if((_e=zy.prototype).append=function(Vp,Jp,s0){r0(arguments,2),this.i.push(e0(Vp,Jp,s0))},_e.delete=function(Vp){r0(arguments,1);var Jp=[];Vp=String(Vp),_g(this.i,function(s0){s0[0]!==Vp&&Jp.push(s0)}),this.i=Jp},_e.entries=function Vp(){var Jp,s0=this;return Bp(Vp,function(O0){if(O0.h==1&&(Jp=0),O0.h!=3)return Jp<s0.i.length?O0=Hl(O0,s0.i[Jp]):(O0.h=0,O0=void 0),O0;Jp++,O0.h=2})},_e.forEach=function(Vp,Jp){r0(arguments,1);for(var s0=Rl(this),O0=s0.next();!O0.done;O0=s0.next()){var Z0=Rl(O0.value);O0=Z0.next().value,Z0=Z0.next().value,Vp.call(Jp,Z0,O0,this)}},_e.get=function(Vp){r0(arguments,1);var Jp=this.i;Vp=String(Vp);for(var s0=0;s0<Jp.length;s0++)if(Jp[s0][0]===Vp)return Jp[s0][1];return null},_e.getAll=function(Vp){r0(arguments,1);var Jp=[];return Vp=String(Vp),_g(this.i,function(s0){s0[0]===Vp&&Jp.push(s0[1])}),Jp},_e.has=function(Vp){r0(arguments,1),Vp=String(Vp);for(var Jp=0;Jp<this.i.length;Jp++)if(this.i[Jp][0]===Vp)return!0;return!1},_e.keys=function Vp(){var Jp,s0,O0,Z0,_m=this;return Bp(Vp,function(Fl){if(Fl.h==1&&(Jp=Rl(_m),s0=Jp.next()),Fl.h!=3)return s0.done?void(Fl.h=0):(O0=s0.value,Z0=Rl(O0),Hl(Fl,Z0.next().value));s0=Jp.next(),Fl.h=2})},_e.set=function(Vp,Jp,s0){r0(arguments,2),Vp=String(Vp);var O0=[],Z0=e0(Vp,Jp,s0),_m=!0;_g(this.i,function(Fl){Fl[0]===Vp?_m&&(_m=!O0.push(Z0)):O0.push(Fl)}),_m&&O0.push(Z0),this.i=O0},_e.values=function Vp(){var Jp,s0,O0,Z0,_m=this;return Bp(Vp,function(Fl){if(Fl.h==1&&(Jp=Rl(_m),s0=Jp.next()),Fl.h!=3)return s0.done?void(Fl.h=0):(O0=s0.value,(Z0=Rl(O0)).next(),Hl(Fl,Z0.next().value));s0=Jp.next(),Fl.h=2})},zy.prototype._asNative=function(){for(var Vp=new h0,Jp=Rl(this),s0=Jp.next();!s0.done;s0=Jp.next()){var O0=Rl(s0.value);s0=O0.next().value,O0=O0.next().value,Vp.append(s0,O0)}return Vp},zy.prototype._blob=function(){var Vp="----formdata-polyfill-"+Math.random(),Jp=[],s0="--"+Vp+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(O0,Z0){return typeof O0=="string"?Jp.push(s0+P_(y0(Z0))+`"\r
\r
`+y0(O0)+`\r
`):Jp.push(s0+P_(y0(Z0))+'"; filename="'+P_(O0.name)+`"\r
Content-Type: `+(O0.type||"application/octet-stream")+`\r
\r
`,O0,`\r
`)}),Jp.push("--"+Vp+"--"),new Blob(Jp,{type:"multipart/form-data; boundary="+Vp})},zy.prototype[Symbol.iterator]=function(){return this.entries()},zy.prototype.toString=function(){return"[object FormData]"},by&&!by.matches&&(by.matches=by.matchesSelector||by.mozMatchesSelector||by.msMatchesSelector||by.oMatchesSelector||by.webkitMatchesSelector||function(Vp){for(var Jp=(Vp=(this.document||this.ownerDocument).querySelectorAll(Vp)).length;0<=--Jp&&Vp.item(Jp)!==this;);return-1<Jp}),Xy&&(zy.prototype[Xy]="FormData"),_y){var RT=Zp.XMLHttpRequest.prototype.setRequestHeader;Zp.XMLHttpRequest.prototype.setRequestHeader=function(Vp,Jp){RT.call(this,Vp,Jp),Vp.toLowerCase()==="content-type"&&(this.B=!0)},Zp.XMLHttpRequest.prototype.send=function(Vp){Vp instanceof zy?(Vp=Vp._blob(),this.B||this.setRequestHeader("Content-Type",Vp.type),_y.call(this,Vp)):_y.call(this,Vp)}}k0&&(Zp.fetch=function(Vp,Jp){return Jp&&Jp.body&&Jp.body instanceof zy&&(Jp.body=Jp.body._blob()),k0.call(this,Vp,Jp)}),Oy&&(Zp.navigator.sendBeacon=function(Vp,Jp){return Jp instanceof zy&&(Jp=Jp._asNative()),Oy.call(this,Vp,Jp)}),Zp.FormData=zy}})();const oU=()=>{const _e=Pp("AREAS");return _e.length===0&&_e.push(Y0.GLOBAL),nS(_e).call(_e,(_t,_r,_o)=>{const _a=JW(_r);return _a?_o===0?_a:"".concat(_t,",").concat(_a):_t},"")},JW=_e=>_e===Y0.OVERSEA?"".concat(b_.ASIA,",").concat(b_.EUROPE,",").concat(b_.AFRICA,",").concat(b_.NORTH_AMERICA,",").concat(b_.SOUTH_AMERICA,",").concat(b_.OCEANIA):b_[_e],rne=_e=>{const _t={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return _e.map(_r=>{const _o=H5[_r],_a=Object.keys(_o);_a&&_a.map(_u=>{_u!=="CODE"&&(_t[_u]=_t[_u].concat(_o[_u]))})}),_t},sU={GLOBAL:{ASIA:[Y0.CHINA,Y0.JAPAN,Y0.INDIA,Y0.KOREA,Y0.HKMC],EUROPE:[],NORTH_AMERICA:[Y0.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},B4=Object.keys(sU[Y0.GLOBAL]),QW=[Y0.CHINA,Y0.NORTH_AMERICA,Y0.EUROPE,Y0.ASIA,Y0.JAPAN,Y0.INDIA,Y0.OCEANIA,Y0.SOUTH_AMERICA,Y0.AFRICA,Y0.KOREA,Y0.HKMC,Y0.US],ine=function(_e,_t){let _r=[];if(_e.includes(Y0.GLOBAL)){const _u=[Y0.GLOBAL,Y0.OVERSEA],yl=Object.keys(H5);if(_t===Y0.GLOBAL)throw new Tp(Ql.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(_t===Y0.CHINA)_r=[Y0.OVERSEA];else if(_a=_t,B4.includes(_a)){const Rl=(_o=_t,sU[Y0.GLOBAL][_o]||[]),Al=[..._u,_t,...Rl];_r=yl.filter(Ol=>!Al.includes(Ol))}else if(function(Rl){let Al=!1;return B4.forEach(Ol=>{sU[Y0.GLOBAL][Ol].includes(Rl)&&(Al=!0)}),Al}(_t)){const Rl=function(Ol){let xl;return B4.forEach(Ll=>{sU[Y0.GLOBAL][Ll].includes(Ol)&&(xl=Ll)}),xl}(_t),Al=[..._u,Rl,_t];_r=yl.filter(Ol=>!Al.includes(Ol))}else _r=_e;_r=function(Rl){const Al=[];return QW.forEach(Ol=>{Rl.includes(Ol)&&Al.push(Ol)}),Al.concat(Rl.filter(Ol=>!QW.includes(Ol)))}(_r)}else _r=_e;var _o,_a;return _r};function ZW(_e){if(!_e&&Pp("AREAS").includes(Y0.EXTENSIONS))return Vl.debug("update area from ap : reset"),void $4(j8,!0);if(!Pp("AREAS").includes(Y0.GLOBAL)||!_e)return;let _t=H5.EXTENSIONS;_t&&(_t={CODE:JW(Y0.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(_e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(_e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(_e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(_e,".agora.io"),"cds-ap-web-2-".concat(_e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(_e,".agora.io"),"sua-ap-web-2-".concat(_e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(_e,".agora.io"),"uap-ap-web-2-".concat(_e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(_e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(_e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(_e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(_e,".agora.io")]},Vl.debug("update area from ap success: ".concat(_e,",config is "),_t),Ey("AREAS",[Y0.EXTENSIONS],!0),Object.keys(_t).map(_r=>{_r==="LOG_UPLOAD_SERVER"||_r==="EVENT_REPORT_DOMAIN"||_r==="EVENT_REPORT_BACKUP_DOMAIN"||_r==="PROXY_SERVER_TYPE3"?Ey(_r,_t[_r][0]):Ey(_r,_t[_r])}))}function $4(_e){let _t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const _r=g0.reportApiInvoke(null,{name:c_.SET_AREA,options:_e,tag:jy.TRACER});try{let _o=[];if(typeof _e=="string"&&(_o=[_e]),Array.isArray(_e)&&(_e.forEach(_u=>{if(!kee.includes(_u))throw new Tp(Ql.INVALID_PARAMS,"invalid area code")}),_o=_e),Object.prototype.toString.call(_e)==="[object Object]"){const{areaCode:_u,excludedArea:yl}=_e;if(!_u)throw new Tp(Ql.INVALID_PARAMS,"area code is needed");let Rl=_u;typeof _u=="string"&&(Rl=[_u]),_o=yl?ine(Rl,yl):Rl}if(!_t){if(rO.AREAS){const _u=new Tp(Ql.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return _r.onError(_u),void Vl.warning("setArea is prohibited because of config-distribute")}if(_o.includes(Y0.GLOBAL)&&Pp("AREAS")===Y0.EXTENSIONS){const _u=new Tp(Ql.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return _r.onError(_u),void Vl.warning("setArea is prohibited because of ap extensions")}}Ey("AREAS",_o,_t);const _a=rne(_o);Object.keys(_a).map(_u=>{_u==="LOG_UPLOAD_SERVER"||_u==="EVENT_REPORT_DOMAIN"||_u==="EVENT_REPORT_BACKUP_DOMAIN"||_u==="PROXY_SERVER_TYPE3"?Ey(_u,_a[_u][0]):Ey(_u,_a[_u])}),Vl.debug("set area success:",_o.join(","))}catch(_o){throw _r.onError(_o),_o}_r.onSuccess()}function _H(_e,_t){var _r=Object.keys(_e);if(Object.getOwnPropertySymbols){var _o=Object.getOwnPropertySymbols(_e);_t&&(_o=_o.filter(function(_a){return Object.getOwnPropertyDescriptor(_e,_a).enumerable})),_r.push.apply(_r,_o)}return _r}function _K(_e){for(var _t=1;_t<arguments.length;_t++){var _r=arguments[_t]!=null?arguments[_t]:{};_t%2?_H(Object(_r),!0).forEach(function(_o){Ml(_e,_o,_r[_o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_e,Object.getOwnPropertyDescriptors(_r)):_H(Object(_r)).forEach(function(_o){Object.defineProperty(_e,_o,Object.getOwnPropertyDescriptor(_r,_o))})}return _e}let V4=1;function sne(_e,_t,_r,_o,_a){V4+=1;const _u={sid:_r.sid,command:"convergeAllocateEdge",uid:"666",appId:_r.appId,ts:Math.floor(Date.now()/1e3),seq:V4,requestId:V4,version:aS,cname:_r.cname},yl={service_name:_t,json_body:JSON.stringify(_u)};let Rl,Al,Ol=_e[0];return iR(async()=>{Rl=Date.now();const xl=await VS(Ol,{data:yl,cancelToken:_o,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(Al=Date.now()-Rl,xl.code!==0){const Hl=new Tp(Ql.UNEXPECTED_RESPONSE,"live streaming ap error, code"+xl.code,{retry:!0,responseTime:Al});throw Vl.error(Hl.toString()),Hl}const Ll=JSON.parse(xl.json_body);if(Ll.code!==200){const Hl=new Tp(Ql.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(Ll.code,", reason: ").concat(Ll.reason),{code:Ll.code,responseTime:Al});throw Vl.error(Hl.toString()),Hl}if(!Ll.servers||Ll.servers.length===0){const Hl=new Tp(Ql.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:Ll.code,responseTime:Al});throw Vl.error(Hl.toString()),Hl}const Bl=function(Hl,up){return{addressList:Hl.servers.map(_f=>"wss://".concat(_f.address.replace(/\./g,"-"),".").concat(Pp("WORKER_DOMAIN"),":").concat(_f.wss,"?serviceName=").concat(encodeURIComponent(up))),workerToken:Hl.workerToken,vid:Hl.vid}}(Ll,_t);return Pp("LIVE_STREAMING_ADDRESS")&&(Bl.addressList=Pp("LIVE_STREAMING_ADDRESS")instanceof Array?Pp("LIVE_STREAMING_ADDRESS"):[Pp("LIVE_STREAMING_ADDRESS")]),_K(_K({},Bl),{},{responseTime:Al})},(xl,Ll)=>(g0.apworkerEvent(_r.sid,{success:!0,sc:200,serviceName:_t,responseDetail:JSON.stringify(xl.addressList),firstSuccess:Ll===0,responseTime:Al,serverIp:_e[Ll%_e.length]}),!1),(xl,Ll)=>(g0.apworkerEvent(_r.sid,{success:!1,sc:xl.data&&xl.data.code||200,serviceName:_t,responseTime:Al,serverIp:_e[Ll%_e.length]}),!!(xl.code!==Ql.OPERATION_ABORTED&&xl.code!==Ql.UNEXPECTED_RESPONSE||xl.data&&xl.data.retry)&&(Ol=_e[(Ll+1)%_e.length],!0)),_a)}let G4=1;function tq(_e,_t,_r,_o){let{url:_a,areaCode:_u}=_e;const yl=Date.now();let Rl;const[Al,Ol]=oq(_t,_u,[y_.CHOOSE_SERVER]);let xl=n_.networkState;return iR(async()=>{xl&&n_.networkState===Y_.OFFLINE&&n_.onlineWaiter&&await u0.race([n_.onlineWaiter,G_(_o&&_o.maxRetryTimeout||h_.maxRetryTimeout)]),xl=n_.networkState;const{data:Ll,headers:Bl}=await VS(_a,{data:Al,cancelToken:_r,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);Rl=Bl.http3==="1"?1:-1,g0.reportResourceTiming(_a,_t.sid),rq(Ll,_a,_t,yl,[y_.CHOOSE_SERVER],Rl);const Hl=D4(Ll,y_.CHOOSE_SERVER);return iq(Hl),PW(Hl,_a)},Ll=>(Ll&&g0.joinChooseServer(_t.sid,{lts:yl,succ:!0,csAddr:_a,opid:Ol,serverList:Ll.gatewayAddrs.map(Bl=>Bl.address),ec:null,cid:Ll.cid.toString(),uid:Ll.uid.toString(),csIp:Ll.csIp,unilbsServerIds:[y_.CHOOSE_SERVER].toString(),isHttp3:Rl}),!1),Ll=>Ll.code!==Ql.OPERATION_ABORTED&&(Ll.code===Ql.CAN_NOT_GET_GATEWAY_SERVER?Ll.data.retry:(g0.joinChooseServer(_t.sid,{lts:yl,succ:!1,csAddr:_a,serverList:null,opid:Ol,ec:Ll.code,csIp:Ll.data&&Ll.data.csIp,unilbsServerIds:[y_.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:xl}),isHttp3:Rl}),Vl.warning("[".concat(_t.clientId,"] Choose server network error, retry"),Ll),!0)),_o)}function nq(_e,_t,_r,_o){let _a,{url:_u,areaCode:yl,serviceIds:Rl}=_e;const Al=Date.now(),[Ol,xl]=oq(_t,yl,Rl);let Ll;return iR(async()=>{Ll&&n_.networkState===Y_.OFFLINE&&n_.onlineWaiter&&await u0.race([n_.onlineWaiter,G_(_o&&_o.maxRetryTimeout||h_.maxRetryTimeout)]),Ll=n_.networkState;const{data:Bl,headers:Hl}=await VS(_u,{data:Ol,cancelToken:_r,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);_a=Hl.http3==="1"?1:-1,g0.reportResourceTiming(_u,_t.sid),rq(Bl,_u,_t,Al,Rl,_a);const up=D4(Bl,y_.CHOOSE_SERVER),_f=D4(Bl,_t.cloudProxyServer==="proxy5"?y_.CLOUD_PROXY_5:_t.cloudProxyServer==="proxy3"||_t.cloudProxyServer==="proxy4"?y_.CLOUD_PROXY:y_.CLOUD_PROXY_FALLBACK);return iq(up),{gatewayInfo:PW(up,_u),proxyInfo:_f,url:_u}},Bl=>(Bl.gatewayInfo&&g0.joinChooseServer(_t.sid,{lts:Al,succ:!0,csAddr:_u,serverList:Bl.gatewayInfo.gatewayAddrs.map(Hl=>Hl.address),ec:null,opid:xl,cid:Bl.gatewayInfo.cid.toString(),uid:Bl.gatewayInfo.uid.toString(),csIp:Bl.gatewayInfo.csIp,unilbsServerIds:Rl.toString(),isHttp3:_a}),Bl.proxyInfo&&g0.joinWebProxyAP(_t.sid,{lts:Al,sucess:1,apServerAddr:_u,turnServerAddrList:Bl.proxyInfo.addresses.map(Hl=>Hl.ip).join(","),errorCode:null,eventType:_t.cloudProxyServer,unilbsServerIds:Rl.toString()}),!1),Bl=>Bl.code!==Ql.OPERATION_ABORTED&&(Bl.code===Ql.CAN_NOT_GET_GATEWAY_SERVER?Bl.data.retry:(g0.joinWebProxyAP(_t.sid,{lts:Al,sucess:0,apServerAddr:_u,turnServerAddrList:null,errorCode:Bl.code,eventType:_t.cloudProxyServer,unilbsServerIds:Rl.toString(),extend:JSON.stringify({networkState:Ll})}),Vl.warning("[".concat(_t.clientId,"] multi unilbs network error, retry"),Bl),!0)),_o)}const rq=(_e,_t,_r,_o,_a,_u)=>{const yl=[],Rl=Al=>{Al.flag===4096?g0.joinChooseServer(_r.sid,{lts:_o,succ:!1,csAddr:_t,opid:_e.opid,serverList:null,ec:Al.error.message,csIp:Al.error.data&&Al.error.data.csIp,unilbsServerIds:_a.toString(),isHttp3:_u}):Al.flag!==1048576&&Al.flag!==4194304&&Al.flag!==4194310||g0.joinWebProxyAP(_r.sid,{lts:_o,sucess:0,apServerAddr:_t,turnServerAddrList:null,errorCode:Al.error.code,eventType:_r.cloudProxyServer,unilbsServerIds:_a.toString()})};if(_e.response_body.forEach(Al=>{const Ol=Al.buffer.code;if(Al.uri===23&&Ol===0&&!Al.buffer.edges_services)if(Al.buffer.flag===4194310)Vl.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),Al.buffer.edges_services=[];else{const xl={error:new Tp(Ql.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:_e.detail[502]}),flag:Al.buffer.flag};yl.push(xl),Rl(xl)}if(Ol!==0){const xl=iU(Ol),Ll={error:new Tp(Ql.CAN_NOT_GET_GATEWAY_SERVER,xl.desc,{desc:xl.desc,retry:xl.retry,csIp:_e.detail[502]}),flag:Al.buffer.flag};Al.buffer.flag===4194310?Vl.warning(Ll.error.toString()):yl.push(Ll),Rl(Ll)}}),yl.length)throw Vl.warning("[".concat(_r.clientId,"] multi unilbs ").concat(_t," failed, ").concat(yl.map(Al=>"flag: ".concat(Al.flag,", message: ").concat(Al.error.message,", retry: ").concat(Al.error.data.retry)).join(" | "))),new Tp(Ql.CAN_NOT_GET_GATEWAY_SERVER,yl.map(Al=>"flag: ".concat(Al.flag,", message: ").concat(Al.error.message)).join(" | "),{retry:!!yl.find(Al=>Al.error.data.retry),csIp:_e.detail[502],desc:[...new Set(yl.map(Al=>{var Ol,xl;return Al==null||(Ol=Al.error)===null||Ol===void 0||(xl=Ol.data)===null||xl===void 0?void 0:xl.desc}).filter(Al=>!!Al))]})},iq=_e=>{var _t,_r,_o,_a;if(_e.addresses&&_e.addresses.length===0&&_e.code===0)throw new Tp(Ql.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:_e.detail&&_e.detail[502]});if((_t=_e.detail)!==null&&_t!==void 0&&_t[23]&&typeof((_r=_e.detail)===null||_r===void 0?void 0:_r[23])=="string"?ZW(_e.detail[23].toLowerCase()):ZW(),(_o=_e.detail)!==null&&_o!==void 0&&_o[19]&&typeof((_a=_e.detail)===null||_a===void 0?void 0:_a[19])=="string"){const yl=_e.detail[19],Rl=yl==null?void 0:yl.split(";");for(let Al=0;Al<Rl.length;Al++){var _u;const Ol=xR(_u=Rl[Al]).call(_u);_e.addresses[Al]&&Rl&&(_e.addresses[Al].fingerprint=Ol)}}if(Pp("GATEWAY_ADDRESS")&&Pp("GATEWAY_ADDRESS").length>0){Vl.debug("assign gateway address to",Pp("GATEWAY_ADDRESS"));const yl=Pp("GATEWAY_ADDRESS").map(Rl=>{var Al,Ol;const xl=(Al=(Ol=_e.addresses.find(Ll=>Ll.ip===Rl.ip&&Ll.port===Rl.port))===null||Ol===void 0?void 0:Ol.fingerprint)!==null&&Al!==void 0?Al:"";return{ip:Rl.ip,port:Rl.port,ticket:_e.addresses[0]&&_e.addresses[0].ticket,fingerprint:xl}});_e.addresses=yl}},ane=(_e,_t)=>{if(_e.response_body&&_e.response_body.length){const _r=_e.response_body[0];if(_r.buffer.code!==0){const _o=iU(_r.buffer.code);throw new Tp(Ql.UPDATE_TICKET_FAILED,"[".concat(_r.buffer.code,"]: ").concat(_o.desc),{retry:_o.retry})}return _r.buffer.ticket}throw Vl.debug("update ticket request received ap response without response body:",_t),new Tp(Ql.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},oq=(_e,_t,_r)=>{const _o=Math.floor(Math.random()*1e12),_a={appid:_e.appId,client_ts:Date.now(),opid:_o,sid:_e.sid,request_bodies:[{uri:22,buffer:{cname:_e.cname,detail:{6:_e.stringUid,11:_t,12:Pp("USE_NEW_TOKEN")?"1":void 0,22:_t},key:_e.token,service_ids:_r,uid:_e.uid||0}}]};_a.request_bodies.forEach(yl=>{_e.multiIP&&_e.multiIP.gateway_ip&&(yl.buffer.detail[5]=JSON.stringify({vocs_ip:[_e.multiIP.uni_lbs_ip],vos_ip:[_e.multiIP.gateway_ip]}))});const _u=new FormData;return _u.append("request",JSON.stringify(_a)),[_u,_o]},cne=(_e,_t)=>{const _r=Math.floor(Math.random()*1e12),_o={appid:_e.appId,client_ts:Date.now(),opid:_r,sid:_e.sid,request_bodies:[{uri:28,buffer:{cname:_e.cname,detail:{1:"",6:_e.stringUid,12:"1"},token:_e.token,service_ids:_t,uid:_e.uid||0,edges_services:_e.apResponse.addresses.map(_u=>({ip:_u.ip,port:_u.port}))}}]},_a=new FormData;return _a.append("request",JSON.stringify(_o)),[_a,_r]};let W4=0;async function H4(_e,_t,_r,_o){return{gatewayInfo:await async function(_u,yl,Rl,Al){let Ol=null;const xl=[],Ll=async()=>{const Hl=Pp("WEBCS_DOMAIN").slice(0,Pp("AJAX_REQUEST_CONCURRENT")).map(vp=>({url:_u.proxyServer?"https://".concat(_u.proxyServer,"/ap/?url=").concat(vp+"/api/v2/transpond/webrtc?v=2"):"https://".concat(vp,"/api/v2/transpond/webrtc?v=2"),areaCode:oU()})),up=Al.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:Hl.map(vp=>vp.url)}),_f=await d2({fragementLength:Pp("FRAGEMENT_LENGTH"),referenceList:Hl,asyncMapHandler:vp=>(Vl.debug("[".concat(_u.clientId,"] Connect to choose_server:"),vp.url),tq(vp,_u,yl,Rl)),allFailedhandler:vp=>{throw Al.recordJoinChannelService({endTs:Date.now(),status:"error",errors:vp},up),vp[0]},promisesCollector:xl});return Al.recordJoinChannelService({endTs:Date.now(),status:"success"},up),_f},Bl=async()=>{if(await G_(1e3),Ol!==null)return Ol;const Hl=Pp("WEBCS_DOMAIN_BACKUP_LIST").map(vp=>({url:_u.proxyServer?"https://".concat(_u.proxyServer,"/ap/?url=").concat(vp+"/api/v2/transpond/webrtc?v=2"):"https://".concat(vp,"/api/v2/transpond/webrtc?v=2"),areaCode:oU()})),up=Al.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:Hl.map(vp=>vp.url)}),_f=await d2({fragementLength:Pp("FRAGEMENT_LENGTH"),referenceList:Hl,asyncMapHandler:vp=>(Vl.debug("[".concat(_u.clientId,"] Connect to backup choose_server:"),vp.url),tq(vp,_u,yl,Rl)),allFailedhandler:vp=>{throw Al.recordJoinChannelService({endTs:Date.now(),status:"error",errors:vp},up),vp[0]},promisesCollector:xl});return Al.recordJoinChannelService({endTs:Date.now(),status:"success"},up),_f};try{return Ol=await pN([Ll(),Bl()]),xl.length&&xl.forEach(Hl=>Hl.cancel&&typeof Hl.cancel=="function"&&Hl.cancel()),Ol}catch(Hl){throw Hl[0]}}(_e,_t,_r,_o)}}async function sq(_e,_t,_r,_o,_a){const _u=_e.cloudProxyServer;if(_u==="disabled"){if(!_o)return;if(_e.useLocalAccessPoint)return await H4(_e,_t,_r,_a);if(Pp("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:Ol,proxyInfo:xl}=await cq(_e,_t,_r,_a);return _e.turnServer&&_e.turnServer.mode!=="auto"||(_e.turnServer={mode:"manual",servers:xl.map(Ll=>({turnServerURL:Ll.address,tcpport:Ll.tcpport||VT.tcpport,udpport:Ll.udpport||VT.udpport,username:Ll.username||VT.username,password:Ll.password||VT.password,forceturn:!1,security:!0}))}),{gatewayInfo:Ol}}return await H4(_e,_t,_r,_a)}const{proxyInfo:yl,gatewayInfo:Rl}=await cq(_e,_t,_r,_a),Al={gatewayInfo:Rl};return _e.turnServer={mode:"manual",servers:yl.map(Ol=>({turnServerURL:Ol.address,tcpport:_u==="proxy3"?void 0:Ol.tcpport?Ol.tcpport:VT.tcpport,udpport:_u==="proxy4"?void 0:Ol.udpport?Ol.udpport:VT.udpport,username:Ol.username||VT.username,password:Ol.password||VT.password,forceturn:_u!=="proxy4",security:_u==="proxy5"}))},Vl.debug("[".concat(_e.clientId,"] set proxy server: ").concat(_e.proxyServer,", mode: ").concat(_u)),Al}async function aq(_e,_t,_r,_o,_a){const _u=Pp("ACCOUNT_REGISTER").slice(0,Pp("AJAX_REQUEST_CONCURRENT"));let yl=[];yl=_t.proxyServer?_u.map(Al=>"https://".concat(_t.proxyServer,"/ap/?url=").concat(Al+"/api/v1")):_u.map(Al=>"https://".concat(Al,"/api/v1"));const Rl=_a==null?void 0:_a.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:yl});try{const Al=await async function(Ol,xl,Ll,Bl,Hl){const up=Date.now(),_f={sid:Ll.sid,opid:10,appid:Ll.appId,string_uid:xl};let vp=Ol[0];const Dp=await iR(()=>VS(vp+"".concat(vp.indexOf("?")===-1?"?":"&","action=stringuid"),{data:_f,cancelToken:Bl,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(Bp,_g)=>{if(Bp.code===0){if(Bp.uid<=0||Bp.uid>=Math.pow(2,32))throw Vl.error("Invalid Uint Uid ".concat(xl," => ").concat(Bp.uid),Bp),g0.reqUserAccount(_f.sid,{lts:up,success:!1,serverAddr:vp,stringUid:_f.string_uid,uid:Bp.uid,errorCode:Ql.INVALID_UINT_UID_FROM_STRING_UID,extend:_f}),new Tp(Ql.INVALID_UINT_UID_FROM_STRING_UID);return g0.reqUserAccount(_f.sid,{lts:up,success:!0,serverAddr:vp,stringUid:_f.string_uid,uid:Bp.uid,errorCode:null,extend:_f}),!1}const y0=iU(Bp.code);return y0.retry&&(vp=Ol[(_g+1)%Ol.length]),g0.reqUserAccount(_f.sid,{lts:up,success:!1,serverAddr:vp,stringUid:_f.string_uid,uid:Bp.uid,errorCode:y0.desc,extend:_f}),y0.retry},(Bp,_g)=>Bp.code!==Ql.OPERATION_ABORTED&&(g0.reqUserAccount(_f.sid,{lts:up,success:!1,serverAddr:vp,stringUid:_f.string_uid,uid:null,errorCode:Bp.code,extend:_f}),vp=Ol[(_g+1)%Ol.length],!0),Hl);if(Dp.code!==0){const Bp=iU(Dp.code);throw new Tp(Ql.UNEXPECTED_RESPONSE,Bp.desc)}return Dp}(yl,_e,_t,_r,_o);return _a==null||_a.recordJoinChannelService({status:"success",endTs:Date.now()},Rl),Al.uid}catch(Al){throw _a==null||_a.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[Al]},Rl),Al}}async function une(_e,_t,_r){const _o=Pp("CDS_AP").slice(0,Pp("AJAX_REQUEST_CONCURRENT")).map(Rl=>_e.proxyServer?"https://".concat(_e.proxyServer,"/ap/?url=").concat(Rl+"/api/v1"):"https://".concat(Rl,"/api/v1?action=config")).map(Rl=>function(Al,Ol,xl,Ll){const Bl=gy(),Hl={flag:64,cipher_method:0,features:{device:Bl.name,system:Bl.os,system_general:navigator.userAgent,vendor:Ol.appId,version:aS,cname:Ol.cname,sid:Ol.sid,session_id:Ol.sid,detail:"",proxyServer:Ol.proxyServer}};return iR(()=>VS(Al,{data:Hl,timeout:1e3,cancelToken:xl,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,up=>up.code!==Ql.OPERATION_ABORTED,Ll)}(Rl,_e,_t,_r));let _a=null,_u=null,yl={};try{_a=await pN(_o)}catch(Rl){if(Rl.code===Ql.OPERATION_ABORTED)throw Rl;_u=Rl}if(_o.forEach(Rl=>Rl.cancel()),g0.reportApiInvoke(_e.sid,{name:c_.REQUEST_CONFIG_DISTRIBUTE,options:{error:_u,res:_a}}).onSuccess(),_a&&_a.test_tags)try{yl=function(Rl){if(!Rl.test_tags)return{};const Al=Rl.test_tags,Ol=Object.keys(Al),xl={};return Ol.forEach(Ll=>{var Bl;const Hl=xR(Bl=Ll.slice(4)).call(Bl),up=JSON.parse(Al[Ll])[1];xl[Hl]=up}),xl}(_a)}catch{}return yl}async function cq(_e,_t,_r,_o){const _a=Pp("PROXY_SERVER_TYPE3"),_u=(Hl,up,_f)=>{let vp=_f||_a;return Array.isArray(vp)&&(vp=up%2==0?_a[1]:_a[0]),"https://".concat(vp,"/ap/?url=").concat(Hl)};let yl=null;const Rl=[],Al=async()=>{const Hl=Pp("WEBCS_DOMAIN").slice(0,Pp("AJAX_REQUEST_CONCURRENT")).map((vp,Dp)=>{let Bp;return Bp=_e.cloudProxyServer==="disabled"&&_e.proxyServer?_u("".concat(vp,"/api/v2/transpond/webrtc?v=2"),Dp,_e.proxyServer):_e.cloudProxyServer==="disabled"||_e.cloudProxyServer==="fallback"?"https://".concat(vp,"/api/v2/transpond/webrtc?v=2"):_u("".concat(vp,"/api/v2/transpond/webrtc?v=2"),Dp),{url:Bp,areaCode:oU(),serviceIds:[y_.CHOOSE_SERVER,_e.cloudProxyServer==="proxy5"?y_.CLOUD_PROXY_5:_e.cloudProxyServer==="proxy3"||_e.cloudProxyServer==="proxy4"?y_.CLOUD_PROXY:y_.CLOUD_PROXY_FALLBACK]}}),up=_o.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:Hl.map(vp=>vp.url)}),_f=await d2({fragementLength:Pp("FRAGEMENT_LENGTH"),referenceList:Hl,asyncMapHandler:vp=>(Vl.debug("[".concat(_e.clientId,"] Connect to choose_server:"),vp.url),nq(vp,_e,_t,_r)),allFailedhandler:vp=>{throw _o.recordJoinChannelService({endTs:Date.now(),status:"error",errors:vp},up),vp[0]},promisesCollector:Rl});return _o.recordJoinChannelService({endTs:Date.now(),status:"success"},up),_f},Ol=async()=>{if(await G_(1e3),yl!==null)return yl;const Hl=Pp("WEBCS_DOMAIN_BACKUP_LIST").map((vp,Dp)=>{let Bp;return Bp=_e.cloudProxyServer==="disabled"&&_e.proxyServer?_u("".concat(vp,"/api/v2/transpond/webrtc?v=2"),Dp,_e.proxyServer):_e.cloudProxyServer==="disabled"||_e.cloudProxyServer==="fallback"?"https://".concat(vp,"/api/v2/transpond/webrtc?v=2"):_u("".concat(vp,"/api/v2/transpond/webrtc?v=2"),Dp),{url:Bp,areaCode:oU(),serviceIds:[y_.CHOOSE_SERVER,_e.cloudProxyServer==="proxy5"?y_.CLOUD_PROXY_5:_e.cloudProxyServer==="proxy3"||_e.cloudProxyServer==="proxy4"?y_.CLOUD_PROXY:y_.CLOUD_PROXY_FALLBACK]}}),up=_o.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:Hl.map(vp=>vp.url)}),_f=await d2({fragementLength:Pp("FRAGEMENT_LENGTH"),referenceList:Hl,asyncMapHandler:vp=>(Vl.debug("[".concat(_e.clientId,"] Connect to backup choose_server:"),vp.url),nq(vp,_e,_t,_r)),allFailedhandler:vp=>{throw _o.recordJoinChannelService({endTs:Date.now(),status:"error",errors:vp},up),vp[0]},promisesCollector:Rl});return _o.recordJoinChannelService({endTs:Date.now(),status:"success"},up),_f};let xl,Ll,Bl;try{({gatewayInfo:xl,proxyInfo:Ll,url:Bl}=await pN([Al(),Ol()]))}catch(Hl){throw Hl[0]}if(Rl.length&&Rl.forEach(Hl=>Hl.cancel&&typeof Hl.cancel=="function"&&Hl.cancel()),!xl||!Ll)throw new Tp(Ql.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(_e.apUrl=Bl,_e.cloudProxyServer!=="disabled"&&Array.isArray(_a)&&Bl){const Hl=/^https?:\/\/(.+?)(\/.*)?$/.exec(Bl)[1];_a.includes(Hl)&&(_e.proxyServer=Hl,Vl.setProxyServer(Hl),g0.setProxyServer(Hl))}return yl={gatewayInfo:xl,proxyInfo:await Yte(Ll,xl.uid)},yl}async function uq(_e,_t,_r,_o){const _a=Pp("UAP_AP").slice(0,Pp("AJAX_REQUEST_CONCURRENT")).map(_u=>_t.proxyServer?"https://".concat(_t.proxyServer,"/ap/?url=").concat(_u+"/api/v1?action=uap"):"https://".concat(_u,"/api/v1?action=uap"));return await sne(_a,_e,_t,_r,_o)}async function lne(_e,_t,_r){const _o=Pp("UAP_AP").slice(0,Pp("AJAX_REQUEST_CONCURRENT")).map(_a=>_e.proxyServer?"https://".concat(_e.proxyServer,"/ap/?url=").concat(_a+"/api/v1?action=uap"):"https://".concat(_a,"/api/v1?action=uap")).map(_a=>function(_u,yl,Rl,Al){const Ol={command:"convergeAllocateEdge",sid:yl.sid,appId:yl.appId,token:yl.token,ts:Date.now(),version:aS,cname:yl.cname,uid:yl.uid.toString(),requestId:G4,seq:G4};G4+=1;const xl={service_name:"tele_channel",json_body:JSON.stringify(Ol)};return iR(async()=>{const Ll=await VS(_u,{data:xl,cancelToken:Rl,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(Ll.code!==0){const Hl=new Tp(Ql.UNEXPECTED_RESPONSE,"cross channel ap error, code"+Ll.code,{retry:!0});throw Vl.error(Hl.toString()),Hl}const Bl=JSON.parse(Ll.json_body);if(Bl.code!==200){const Hl=new Tp(Ql.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(Bl.code,", reason: ").concat(Bl.reason));throw Vl.error(Hl.toString()),Hl}if(!Bl.servers||Bl.servers.length===0){const Hl=new Tp(Ql.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw Vl.error(Hl.toString()),Hl}return{vid:Bl.vid,workerToken:Bl.workerToken,addressList:(Pp("CHANNEL_MEDIA_RELAY_SERVERS")||Bl.servers).map(Hl=>"wss://".concat(Hl.address.replace(/\./g,"-"),".").concat(Pp("WORKER_DOMAIN"),":").concat(Hl.wss))}},void 0,Ll=>!!(Ll.code!==Ql.OPERATION_ABORTED&&Ll.code!==Ql.UNEXPECTED_RESPONSE||Ll.data&&Ll.data.retry),Al)}(_a,_e,_t,_r));try{const _a=await pN(_o);return _o.forEach(_u=>_u.cancel()),_a}catch(_a){throw _a[0]}}async function dne(_e,_t,_r){let _o=null;const _a=[],_u=async yl=>{const Rl=Pp(yl?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(Al=>_e.proxyServer?"https://".concat(_e.proxyServer,"/ap/?url=").concat(Al+"/api/v2/transpond/webrtc?v=2"):"https://".concat(Al,"/api/v2/transpond/webrtc?v=2"));return yl&&(await G_(1e3),_o!==null)?_o:await d2({fragementLength:Pp("FRAGEMENT_LENGTH"),referenceList:Rl,asyncMapHandler:Al=>(Vl.debug("[".concat(_e.clientId,"] update ticket, Connect to ").concat(yl?"backup":""," choose_server:"),Al),function(Ol,xl,Ll,Bl){const[Hl]=cne(xl,[y_.CHOOSE_SERVER]);let up=n_.networkState;return iR(async()=>{up&&n_.networkState===Y_.OFFLINE&&n_.onlineWaiter&&await u0.race([n_.onlineWaiter,G_(Bl&&Bl.maxRetryTimeout||h_.maxRetryTimeout)]),up=n_.networkState;const _f=await VS(Ol,{data:Hl,cancelToken:Ll,headers:{"Content-Type":"multipart/form-data;"}},!0);return ane(_f,Ol)},()=>!1,_f=>_f.code!==Ql.OPERATION_ABORTED&&(_f.code===Ql.UPDATE_TICKET_FAILED?_f.data.retry:(Vl.warning("[".concat(xl.clientId,"] update ticket network error, retry"),_f),!0)),Bl)}(Al,_e,_t,_r)),allFailedhandler:Al=>{throw Al[0]},promisesCollector:_a})};try{return _o=await pN([_u(!1),_u(!0)]),_a.length&&_a.forEach(yl=>yl.cancel&&typeof yl.cancel=="function"&&yl.cancel()),_o}catch(yl){throw yl[0]}}function lq(_e,_t){var _r=Object.keys(_e);if(Object.getOwnPropertySymbols){var _o=Object.getOwnPropertySymbols(_e);_t&&(_o=_o.filter(function(_a){return Object.getOwnPropertyDescriptor(_e,_a).enumerable})),_r.push.apply(_r,_o)}return _r}function dq(_e){for(var _t=1;_t<arguments.length;_t++){var _r=arguments[_t]!=null?arguments[_t]:{};_t%2?lq(Object(_r),!0).forEach(function(_o){Ml(_e,_o,_r[_o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_e,Object.getOwnPropertyDescriptors(_r)):lq(Object(_r)).forEach(function(_o){Object.defineProperty(_e,_o,Object.getOwnPropertyDescriptor(_r,_o))})}return _e}class hne extends Hy{constructor(){super(),Ml(this,"configs",void 0),Ml(this,"joinInfo",void 0),Ml(this,"cancelToken",void 0),Ml(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),Ml(this,"interval",void 0),Ml(this,"mutex",new iT("config-distribute")),Ml(this,"mutableParamsRead",!1)}startGetConfigDistribute(_t,_r){this.joinInfo=_t,this.cancelToken=_r,this.interval&&this.stopGetConfigDistribute(),Pp("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},Pp("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,g0.reportApiInvoke(null,{options:void 0,name:c_.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:jy.TRACER}).onSuccess(JSON.stringify(rO))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void Vl.debug("[config-distribute] get config distribute interrupted have no joininfo");let _t;const _r=await this.mutex.lock();try{_t=await une(this.joinInfo,this.cancelToken,this.retryConfig),Vl.debug("[config-distribute] get config distribute",JSON.stringify(_t)),_t.limit_bitrate&&this.handleBitrateLimit(_t.limit_bitrate),this.cacheGlobalParameterConfig(_t),this.configs=_t}catch(_o){const _a=new Tp(Ql.NETWORK_RESPONSE_ERROR,_o);Vl.warning("[config-distribute] ".concat(_a.toString()))}finally{_r()}}getBitrateLimit(){return this.configs?this.configs.limit_bitrate:void 0}handleBitrateLimit(_t){var _r;(_r=_t)&&_r.uplink&&_r.id&&_r.uplink.max_bitrate!==void 0&&_r.uplink.min_bitrate!==void 0&&(this.configs&&this.configs.limit_bitrate?this.configs&&this.configs.limit_bitrate&&this.configs.limit_bitrate.id!==_t.id&&this.emit(c2.UPDATE_BITRATE_LIMIT,_t):this.emit(c2.UPDATE_BITRATE_LIMIT,_t))}getLowStreamConfigDistribute(){return this.configs&&this.configs.limit_bitrate&&dq({},this.configs.limit_bitrate.low_stream_uplink)}cacheGlobalParameterConfig(_t){var _r;const _o=o4(_r=Object.keys(_t).filter(_u=>/^webrtc_ng_global_parameter/.test(_u))).call(_r);for(let _u=0;_u<_o.length;_u++)for(let yl=_o.length-1;yl>_u;yl--){const Rl=_o[yl];if(typeof _t[Rl].__priority=="number"){const Al=_t[Rl].__priority,Ol=_o[yl-1];if(typeof _t[Ol].__priority=="number"){if(!(Al>_t[Ol].__priority))continue;{const xl=Rl;_o[yl]=_o[yl-1],_o[yl-1]=xl}}else{const xl=Rl;_o[yl]=_o[yl-1],_o[yl-1]=xl}}}const _a={};_o.forEach(_u=>{const yl=_t[_u],Rl=yl.__expires;Object.keys(yl).forEach(Al=>{Al==="__priority"||Al==="__expires"||Object.prototype.hasOwnProperty.call(_a,Al)||(_a[Al]=dq({value:yl[Al]},Rl&&{expires:Rl}))})});try{const _u=JSON.stringify(_a),yl=window.btoa(_u);window.localStorage.setItem("websdk_ng_global_parameter",yl),Vl.debug("Caching global parameters ".concat(_u))}catch(_u){Vl.error("Error caching global parameters:",_u.message)}}}function hq(_e,_t){var _r=Object.keys(_e);if(Object.getOwnPropertySymbols){var _o=Object.getOwnPropertySymbols(_e);_t&&(_o=_o.filter(function(_a){return Object.getOwnPropertyDescriptor(_e,_a).enumerable})),_r.push.apply(_r,_o)}return _r}function f2(_e){for(var _t=1;_t<arguments.length;_t++){var _r=arguments[_t]!=null?arguments[_t]:{};_t%2?hq(Object(_r),!0).forEach(function(_o){Ml(_e,_o,_r[_o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_e,Object.getOwnPropertyDescriptors(_r)):hq(Object(_r)).forEach(function(_o){Object.defineProperty(_e,_o,Object.getOwnPropertyDescriptor(_r,_o))})}return _e}class fne extends Hy{constructor(_t,_r,_o,_a){super(),Ml(this,"spec",void 0),Ml(this,"token",void 0),Ml(this,"websocket",void 0),Ml(this,"pingpongTimer",void 0),Ml(this,"reconnectMode","retry"),Ml(this,"serviceMode",void 0),Ml(this,"reqId",0),Ml(this,"commandReqId",0),Ml(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),Ml(this,"handleWebSocketMessage",_u=>{if(!_u.data)return;const yl=JSON.parse(_u.data);yl.requestId?this.emit("@".concat(yl.requestId,"-").concat(yl.sid),yl):this.serviceMode===u_.INJECT?this.emit(RS.INJECT_STREAM_STATUS,yl):(g0.workerEvent(this.spec.sid,{actionType:"status",serverCode:yl.code,workerType:this.serviceMode===u_.TRANSCODE?1:2}),this.emit(RS.PUBLISH_STREAM_STATUS,yl))}),this.spec=_r,this.token=_t,this.serviceMode=_a,this.websocket=new gN("live-streaming",_o),this.websocket.on(N0.CONNECTED,this.handleWebSocketOpen),this.websocket.on(N0.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(N0.REQUEST_NEW_URLS,(_u,yl)=>{W_(this,RS.REQUEST_NEW_ADDRESS).then(_u).catch(yl)}),this.websocket.on(N0.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(_t){return this.websocket.init(_t)}async request(_t,_r,_o,_a){this.reqId+=1,_t==="request"&&(this.commandReqId+=1);const _u=this.commandReqId,yl=this.reqId;if(!yl||!this.websocket)throw new Tp(Ql.UNEXPECTED_ERROR);const Rl=f2({command:_t,sdkVersion:aS==="4.17.1"?"0.0.1":aS,seq:yl,requestId:yl,allocate:_o,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},_r);if(this.websocket.state==="closed")throw new Tp(Ql.WS_DISCONNECT);const Al=()=>new u0((Bl,Hl)=>{this.websocket.once(N0.CLOSED,()=>Hl(new Tp(Ql.WS_ABORT))),this.websocket.once(N0.CONNECTED,Bl)});this.websocket.state!=="connected"&&await Al(),Rl.clientRequest&&(Rl.clientRequest.workerToken=this.token);const Ol=new u0((Bl,Hl)=>{const up=()=>{Hl(new Tp(Ql.WS_ABORT))};this.websocket.once(N0.RECONNECTING,up),this.websocket.once(N0.CLOSED,up),this.once("@".concat(yl,"-").concat(this.spec.sid),_f=>{Bl(_f)})});_a&&g0.workerEvent(this.spec.sid,f2(f2({},_a),{},{requestId:_u,actionType:"request",payload:JSON.stringify(_r.clientRequest),serverCode:0,code:0}));const xl=Date.now();this.websocket.sendMessage(Rl);let Ll=null;try{Ll=await Ol}catch(Bl){if(this.websocket.state==="closed")throw Bl;return await Al(),await this.request(_t,_r,_o)}return _a&&g0.workerEvent(this.spec.sid,f2(f2({},_a),{},{requestId:_u,actionType:"response",payload:JSON.stringify(Ll.serverResponse),serverCode:Ll.code,success:Ll.code===200,responseTime:Date.now()-xl})),Ll.code!==200&&this.handleResponseError(Ll),Ll}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const _t=aS==="4.17.1"?"0.0.1":aS;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:_t,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(_t){switch(_t.code){case Ky.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void Vl.warning("live stream response already exists stream");case Ky.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case Ky.LIVE_STREAM_RESPONSE_BAD_STREAM:case Ky.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new Tp(Ql.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:_t.code}).throw();case Ky.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(_t.serverResponse.command==="UnpublishStream"||_t.serverResponse.command==="UninjectStream")return;throw new Tp(Ql.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Ky.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new Tp(Ql.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:_t.code}).throw();case Ky.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const _r=new Tp(Ql.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(RS.WARNING,_r,_t.serverResponse.url)}case Ky.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const _r=new Tp(Ql.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(RS.WARNING,_r,_t.serverResponse.url)}case Ky.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new Tp(Ql.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case Ky.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new Tp(Ql.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:_t.code}).throw();case Ky.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const _r=new Tp(Ql.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(RS.WARNING,_r,_t.serverResponse.url)}case Ky.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new Tp(Ql.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:_t.code}).throw();case Ky.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new Tp(Ql.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case Ky.LIVE_STREAM_RESPONSE_WORKER_LOST:case Ky.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(_t.serverResponse.command==="UnpublishStream"||_t.serverResponse.command==="UninjectStream")return;throw new Tp(Ql.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Ky.ERROR_FAIL_SEND_MESSAGE:if(_t.serverResponse.command==="UnpublishStream"||_t.serverResponse.command==="UninjectStream")return;if(_t.serverResponse.command==="UpdateTranscoding"||_t.serverResponse.command==="ControlStream")return new Tp(Ql.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:_t.code}).throw();throw new Tp(Ql.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case Ky.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Ky.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Ky.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Ky.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new Tp(Ql.LIVE_STREAMING_CDN_ERROR,"",{code:_t.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(nU)},6e3)}}function fq(_e,_t){var _r=Object.keys(_e);if(Object.getOwnPropertySymbols){var _o=Object.getOwnPropertySymbols(_e);_t&&(_o=_o.filter(function(_a){return Object.getOwnPropertyDescriptor(_e,_a).enumerable})),_r.push.apply(_r,_o)}return _r}function dT(_e){for(var _t=1;_t<arguments.length;_t++){var _r=arguments[_t]!=null?arguments[_t]:{};_t%2?fq(Object(_r),!0).forEach(function(_o){Ml(_e,_o,_r[_o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_e,Object.getOwnPropertyDescriptors(_r)):fq(Object(_r)).forEach(function(_o){Object.defineProperty(_e,_o,Object.getOwnPropertyDescriptor(_r,_o))})}return _e}class pne extends Hy{constructor(_t){let _r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:h_,_o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:h_;super(),Ml(this,"onLiveStreamWarning",void 0),Ml(this,"onLiveStreamError",void 0),Ml(this,"onInjectStatusChange",void 0),Ml(this,"spec",void 0),Ml(this,"retryTimeout",1e4),Ml(this,"connection",void 0),Ml(this,"httpRetryConfig",void 0),Ml(this,"wsRetryConfig",void 0),Ml(this,"streamingTasks",new Map),Ml(this,"isStartingStreamingTask",!1),Ml(this,"taskMutex",new iT("live-streaming")),Ml(this,"cancelToken",TS.CancelToken.source()),Ml(this,"transcodingConfig",void 0),Ml(this,"injectConfig",dT({},xee)),Ml(this,"injectLoopTimes",0),Ml(this,"uapResponse",void 0),Ml(this,"lastTaskId",1),Ml(this,"statusError",new Map),this.spec=_t,this.httpRetryConfig=_o,this.wsRetryConfig=_r}async setTranscodingConfig(_t){const _r=dT(dT({},Cee),_t);_r.videoCodecProfile!==66&&_r.videoCodecProfile!==77&&_r.videoCodecProfile!==100&&(Vl.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(_r.videoCodecProfile," -> 100")),_r.videoCodecProfile=100),_r.transcodingUsers||(_r.transcodingUsers=_r.userConfigs),_r.transcodingUsers&&(_r.transcodingUsers=_r.transcodingUsers.map(yl=>dT(dT(dT({},Oee),yl),{},{zOrder:yl.zOrder?yl.zOrder+1:1}))),function(yl){Py(yl.width)||wy(yl.width,"config.width",0,1e4),Py(yl.height)||wy(yl.height,"config.height",0,1e4),Py(yl.videoBitrate)||wy(yl.videoBitrate,"config.videoBitrate",1,1e6),Py(yl.videoFrameRate)||wy(yl.videoFrameRate,"config.videoFrameRate"),Py(yl.lowLatency)||o2(yl.lowLatency,"config.lowLatency"),Py(yl.audioSampleRate)||__(yl.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),Py(yl.audioBitrate)||wy(yl.audioBitrate,"config.audioBitrate",1,128),Py(yl.audioChannels)||__(yl.audioChannels,"config.audioChannels",[1,2,3,4,5]),Py(yl.videoGop)||wy(yl.videoGop,"config.videoGop"),Py(yl.videoCodecProfile)||__(yl.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),Py(yl.userCount)||wy(yl.userCount,"config.userCount",0,17),Py(yl.backgroundColor)||wy(yl.backgroundColor,"config.backgroundColor",0,16777215),Py(yl.userConfigExtraInfo)||U_(yl.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),yl.transcodingUsers&&!Py(yl.transcodingUsers)&&(NR(yl.transcodingUsers,"config.transcodingUsers"),yl.transcodingUsers.forEach((Rl,Al)=>{c4(Rl.uid),Py(Rl.x)||wy(Rl.x,"transcodingUser[".concat(Al,"].x"),0,1e4),Py(Rl.y)||wy(Rl.y,"transcodingUser[".concat(Al,"].y"),0,1e4),Py(Rl.width)||wy(Rl.width,"transcodingUser[".concat(Al,"].width"),0,1e4),Py(Rl.height)||wy(Rl.height,"transcodingUser[".concat(Al,"].height"),0,1e4),Py(Rl.zOrder)||wy(Rl.zOrder-1,"transcodingUser[".concat(Al,"].zOrder"),0,100),Py(Rl.alpha)||wy(Rl.alpha,"transcodingUser[".concat(Al,"].alpha"),0,1,!1)})),Py(yl.watermark)||g4(yl.watermark,"watermark"),Py(yl.backgroundImage)||g4(yl.backgroundImage,"backgroundImage"),yl.images&&!Py(yl.images)&&(NR(yl.images,"config.images"),yl.images.forEach((Rl,Al)=>{g4(Rl,"images[".concat(Al,"]"))}))}(_r);const _o=[];_r.images&&_o.push(..._r.images.map(yl=>dT(dT(dT({},p4),yl),{},{zOrder:255}))),_r.backgroundImage&&(_o.push(dT(dT(dT({},p4),_r.backgroundImage),{},{zOrder:0})),delete _r.backgroundImage),_r.watermark&&(_o.push(dT(dT(dT({},p4),_r.watermark),{},{zOrder:255})),delete _r.watermark),_r.images=_o,_r.transcodingUsers&&(_r.userConfigs=_r.transcodingUsers.map(yl=>dT({},yl)),_r.userCount=_r.transcodingUsers.length,delete _r.transcodingUsers);const _a=(_r.userConfigs||[]).map(yl=>typeof yl.uid=="number"?u0.resolve(yl.uid):aq(yl.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await u0.all(_a)).forEach((yl,Rl)=>{_r.userConfigs&&_r.userConfigs[Rl]&&(_r.userConfigs[Rl].uid=yl)}),this.transcodingConfig=_r,this.connection)try{var _u;const yl=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(sR(_u=this.streamingTasks).call(_u)).map(Rl=>Rl.taskId).join("#")});Vl.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(yl.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(yl){if(!yl.data||!yl.data.retry)throw yl;yl.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(Rl=>{Vl.warning("[".concat(this.spec.clientId,"] live streaming receive error"),yl.toString(),"try to republish",Rl.url),this.startLiveStreamingTask(Rl.url,Rl.mode,yl).then(()=>{Vl.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(Rl.url," success"))}).catch(Al=>{Vl.error("[".concat(this.spec.clientId,"] live streaming republish failed"),Rl.url,Al.toString()),this.onLiveStreamError&&this.onLiveStreamError(Rl.url,Al)})})}}setInjectStreamConfig(_t,_r){this.injectConfig=Object.assign({},this.injectConfig,_t),this.injectLoopTimes=_r}async startLiveStreamingTask(_t,_r,_o){var _a;if(Array.from(sR(_a=this.streamingTasks).call(_a)).find(Al=>Al.mode===u_.INJECT)&&_r===u_.INJECT)return new Tp(Ql.LIVE_STREAMING_TASK_CONFLICT,"inject stream over limit").throw();if(!this.transcodingConfig&&_r===u_.TRANSCODE)throw new Tp(Ql.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");let _u={command:"PublishStream",ts:Date.now(),url:_t,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};Vl.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(_t,", mode: ").concat(_r));const yl=await this.taskMutex.lock();if(!this.connection&&_o)return void yl();if(this.streamingTasks.get(_t)&&!_o)return yl(),new Tp(Ql.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(_r))}catch(Al){throw yl(),Al}switch(_r){case u_.TRANSCODE:_u.transcodingConfig=dT({},this.transcodingConfig);break;case u_.RAW:break;case u_.INJECT:_u={cname:this.spec.cname,command:"InjectStream",sid:this.spec.sid,transcodingConfig:this.injectConfig,ts:Date.now(),url:_t,loopTimes:this.injectLoopTimes}}this.uapResponse&&this.uapResponse.vid&&(_u.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const Rl=this.lastTaskId++;try{const Al=new u0((xl,Ll)=>{G_(this.retryTimeout).then(()=>{if(_o)return Ll(_o);const Bl=this.statusError.get(_t);return Bl?(this.statusError.delete(_t),Ll(Bl)):void 0})}),Ol=await u0.race([this.connection.request("request",{clientRequest:_u},!0,{url:_t,command:"PublishStream",workerType:_r===u_.TRANSCODE?1:2,requestByUser:!_o,tid:Rl.toString()}),Al]);this.isStartingStreamingTask=!1,Vl.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(Ol.code)),this.streamingTasks.set(_t,{clientRequest:_u,mode:_r,url:_t,taskId:Rl}),yl()}catch(Al){if(yl(),this.isStartingStreamingTask=!1,!Al.data||!Al.data.retry||_o)throw Al;return Al.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(_t,_r,Al)):await this.startLiveStreamingTask(_t,_r,Al)}}stopLiveStreamingTask(_t){return new u0((_r,_o)=>{const _a=this.streamingTasks.get(_t);if(!_a||!this.connection)return new Tp(Ql.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const _u=_a.mode;_a.abortTask=()=>{Vl.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(_t),_r()},this.connection.request("request",{clientRequest:{command:_u===u_.INJECT?"UninjectStream":"UnpublishStream",url:_a.url}},!1,{url:_t,command:"UnPublishStream",workerType:_u===u_.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(yl=>{Vl.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(yl.code)),this.streamingTasks.delete(_t),this.streamingTasks.size===0&&_u!==u_.INJECT&&(this.connection&&this.connection.close(),this.connection=void 0),_r(),_u===u_.INJECT&&this.onInjectStatusChange&&this.onInjectStatusChange(d1.INJECT_STREAM_STATUS_STOP_SUCCESS,this.spec.uid,_t)}).catch(_o)})}async controlInjectStream(_t,_r,_o,_a){const _u=this.streamingTasks.get(_t);if(!_u||!this.connection||_u.mode!==u_.INJECT)throw new Tp(Ql.INVALID_OPERATION,"can not find inject stream task to control");return(await this.connection.request("request",{clientRequest:{command:"ControlStream",url:_t,control:_r,audioVolume:_o,position:_a}})).serverResponse}resetAllTask(){var _t;const _r=Array.from(sR(_t=this.streamingTasks).call(_t));this.terminate();for(const _o of _r)this.startLiveStreamingTask(_o.url,_o.mode).catch(_a=>{this.onLiveStreamError&&this.onLiveStreamError(_o.url,_a)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=TS.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(_t){if(this.connection)throw new Tp(Ql.UNEXPECTED_ERROR,"live streaming connection has already connected");const _r=await W_(this,sN.REQUEST_WORKER_MANAGER_LIST,_t);return this.uapResponse=_r,this.connection=new fne(_r.workerToken,this.spec,this.wsRetryConfig,_t),this.connection.on(RS.WARNING,(_o,_a)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(_a,_o)),this.connection.on(RS.PUBLISH_STREAM_STATUS,_o=>this.handlePublishStreamServer(_o)),this.connection.on(RS.INJECT_STREAM_STATUS,_o=>this.handleInjectStreamServerStatus(_o)),this.connection.on(RS.REQUEST_NEW_ADDRESS,(_o,_a)=>{if(!this.connection)return _a(new Tp(Ql.UNEXPECTED_ERROR,"can not get new live streaming address list"));W_(this,sN.REQUEST_WORKER_MANAGER_LIST,_t).then(_u=>{this.uapResponse=_u,_o(_u.addressList)}).catch(_a)}),await this.connection.init(_r.addressList),this.connection}handlePublishStreamServer(_t){const _r=_t.serverStatus&&_t.serverStatus.url||"empty_url",_o=this.streamingTasks.get(_r),_a=_t.reason;switch(_t.code){case Ky.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case Ky.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case Ky.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case Ky.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const yl=new Tp(Ql.LIVE_STREAMING_CDN_ERROR,"",{code:_t.code});if(_o)return Vl.error(yl.toString()),this.onLiveStreamError&&this.onLiveStreamError(_r,yl);if(!this.isStartingStreamingTask)return;this.statusError.set(_r,yl)}case Ky.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const yl=new Tp(Ql.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,_a);return this.onLiveStreamWarning&&this.onLiveStreamWarning(_r,yl)}case Ky.LIVE_STREAM_RESPONSE_WORKER_LOST:case Ky.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var _u;if(!this.connection)return;this.connection.tryNextAddress();const yl=Array.from(sR(_u=this.streamingTasks).call(_u));for(const Rl of yl)Rl.abortTask?Rl.abortTask():(Vl.warning("[".concat(this.spec.clientId,"] publish stream status code"),_t.code,"try to republish",Rl.url),this.startLiveStreamingTask(Rl.url,Rl.mode,new Tp(Ql.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:_t.code})).then(()=>{Vl.debug("[".concat(this.spec.clientId,"] republish live stream success"),Rl.url)}).catch(Al=>{Vl.error(Al.toString()),this.onLiveStreamError&&this.onLiveStreamError(Rl.url,Al)}));return}}}handleInjectStreamServerStatus(_t){const _r=Number(_t.uid),_o=_t.serverStatus&&_t.serverStatus.url;switch(_t.code){case 200:return void(this.onInjectStatusChange&&this.onInjectStatusChange(d1.INJECT_STREAM_STATUS_START_SUCCESS,_r,_o));case 451:return this.onInjectStatusChange&&this.onInjectStatusChange(d1.INJECT_STREAM_STATUS_START_ALREADY_EXISTS,_r,_o),void this.streamingTasks.delete(_o);case 453:return this.onInjectStatusChange&&this.onInjectStatusChange(d1.INJECT_STREAM_STATUS_START_UNAUTHORIZED,_r,_o),void this.streamingTasks.delete(_o);case 470:return this.onInjectStatusChange&&this.onInjectStatusChange(d1.INJECT_STREAM_STATUS_BROKEN,_r,_o),void this.streamingTasks.delete(_o);case 499:return this.onInjectStatusChange&&this.onInjectStatusChange(d1.INJECT_STREAM_STATUS_START_TIMEOUT,_r,_o),void this.streamingTasks.delete(_o);default:return void Vl.debug("inject stream server status",_t)}}hasUrl(_t){return this.streamingTasks.has(_t)}}class pq{constructor(){Ml(this,"destChannelMediaInfos",new Map),Ml(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(_t){c7(_t),this.srcChannelMediaInfo=_t}addDestChannelInfo(_t){c7(_t),this.destChannelMediaInfos.set(_t.channelName,_t)}removeDestChannelInfo(_t){a4(_t),this.destChannelMediaInfos.delete(_t)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function gq(_e){if(!(_e instanceof pq))return new Tp(Ql.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const _t=_e.getSrcChannelMediaInfo(),_r=_e.getDestChannelMediaInfo();if(!_t)return new Tp(Ql.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(_r.size===0)return new Tp(Ql.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class gne extends Hy{constructor(_t,_r,_o){super(),Ml(this,"ws",void 0),Ml(this,"requestId",1),Ml(this,"heartBeatTimer",void 0),Ml(this,"joinInfo",void 0),Ml(this,"clientId",void 0),Ml(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),Ml(this,"onClose",_a=>{this.emit("close"),this.dispose()}),Ml(this,"onMessage",_a=>{const _u=JSON.parse(_a.data);if(!_u||_u.command!=="serverResponse"||!_u.requestId)return _u&&_u.command==="serverStatus"&&_u.serverStatus&&_u.serverStatus.command?(this.emit("status",_u.serverStatus),void this.emit(_u.serverStatus.command,_u.serverStatus)):void 0;this.emit("req_".concat(_u.requestId),_u)}),this.joinInfo=_t,this.clientId=_r,this.ws=new gN("cross-channel-".concat(this.clientId),_o),this.ws.on(N0.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(N0.CONNECTED,this.onOpen),this.ws.on(N0.ON_MESSAGE,this.onMessage),this.ws.on(N0.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(_t){const _r=this.requestId++;return _t.requestId=_r,_t.seq=_r,this.ws.sendMessage(_t),_r}waitStatus(_t){return new u0((_r,_o)=>{const _a=window.setTimeout(()=>{_o(new Tp(Ql.TIMEOUT,"wait status timeout, status: ".concat(_t)))},5e3);this.once(_t,_u=>{window.clearTimeout(_a),_u.state&&_u.state!==0?_o(new Tp(Ql.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(_t))):_r(void 0)}),this.once("dispose",()=>{window.clearTimeout(_a),_o(new Tp(Ql.WS_ABORT))})})}async request(_t){if(this.ws.state==="closed")throw new Tp(Ql.WS_DISCONNECT);const _r=()=>new u0((yl,Rl)=>{this.ws.once(N0.CLOSED,()=>Rl(new Tp(Ql.WS_ABORT))),this.ws.once(N0.CONNECTED,yl)});this.ws.state!=="connected"&&await _r();const _o=this.sendMessage(_t),_a=new u0((yl,Rl)=>{const Al=()=>{Rl(new Tp(Ql.WS_ABORT))};this.ws.once(N0.RECONNECTING,Al),this.ws.once(N0.CLOSED,Al),this.once("req_".concat(_o),yl),G_(3e3).then(()=>{this.removeAllListeners("req_".concat(_o)),this.ws.off(N0.RECONNECTING,Al),this.ws.off(N0.CLOSED,Al),Rl(new Tp(Ql.TIMEOUT,"cross channel ws request timeout"))})}),_u=await _a;if(!_u||_u.code!==200)throw new Tp(Ql.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(_u)));return _u}async connect(_t){this.ws.removeAllListeners(N0.REQUEST_NEW_URLS),this.ws.on(N0.REQUEST_NEW_URLS,_r=>{_r(_t)}),await this.ws.init(_t)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(_t){const _r=this.requestId++;return _t.requestId=_r,this.ws.sendMessage(_t),_r}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class mne extends Hy{set state(_t){_t!==this._state&&(_t!==lT.RELAY_STATE_FAILURE&&(this.errorCode=h1.RELAY_OK),this.emit("state",_t,this.errorCode),this._state=_t)}get state(){return this._state}constructor(_t,_r,_o,_a){super(),Ml(this,"joinInfo",void 0),Ml(this,"sid",void 0),Ml(this,"clientId",void 0),Ml(this,"cancelToken",TS.CancelToken.source()),Ml(this,"workerToken",void 0),Ml(this,"requestId",0),Ml(this,"signal",void 0),Ml(this,"prevChannelMediaConfig",void 0),Ml(this,"httpRetryConfig",void 0),Ml(this,"_state",lT.RELAY_STATE_IDLE),Ml(this,"errorCode",h1.RELAY_OK),Ml(this,"onStatus",_u=>{Vl.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(_u))),_u&&_u.command&&(_u.command==="onAudioPacketReceived"&&this.emit("event",$S.PACKET_RECEIVED_AUDIO_FROM_SRC),_u.command==="onVideoPacketReceived"&&this.emit("event",$S.PACKET_RECEIVED_VIDEO_FROM_SRC),_u.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=h1.SRC_TOKEN_EXPIRED,this.state=lT.RELAY_STATE_FAILURE),_u.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=h1.DEST_TOKEN_EXPIRED,this.state=lT.RELAY_STATE_FAILURE))}),Ml(this,"onReconnect",async()=>{Vl.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",$S.NETWORK_DISCONNECTED),this.state=lT.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(_u=>{this.state!==lT.RELAY_STATE_IDLE&&(Vl.error("auto restart channel media relay failed",_u.toString()),this.errorCode=h1.SERVER_CONNECTION_LOST,this.state=lT.RELAY_STATE_FAILURE)})}),this.joinInfo=_t,this.clientId=_r,this.sid=M4(),this.signal=new gne(this.joinInfo,this.clientId,_o),this.httpRetryConfig=_a}async startChannelMediaRelay(_t){if(this.state!==lT.RELAY_STATE_IDLE)throw new Tp(Ql.INVALID_OPERATION);this.state=lT.RELAY_STATE_CONNECTING,await this.connect(),Vl.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(_t)}catch(_r){throw _r.data&&_r.data.serverResponse&&_r.data.serverResponse.command==="SetSourceChannel"?new Tp(Ql.CROSS_CHANNEL_FAILED_JOIN_SRC):_r.data&&_r.data.serverResponse&&_r.serverResponse.command==="SetDestChannelStatus"?new Tp(Ql.CROSS_CHANNEL_FAILED_JOIN_DEST):_r.data&&_r.data.serverResponse&&_r.serverResponse.command==="StartPacketTransfer"?new Tp(Ql.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):_r}this.prevChannelMediaConfig=_t}async updateChannelMediaRelay(_t){if(this.state!==lT.RELAY_STATE_RUNNING)throw new Tp(Ql.INVALID_OPERATION);await this.sendUpdateMessage(_t),this.prevChannelMediaConfig=_t}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),Vl.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=lT.RELAY_STATE_IDLE,this.dispose()}dispose(){Vl.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=TS.CancelToken.source(),this.state=lT.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const _t=await lne(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=_t.workerToken,await this.signal.connect(_t.addressList),this.emit("event",$S.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(_t){const _r=this.genMessage(nT.StopPacketTransfer);await this.signal.request(_r),await this.signal.waitStatus("Normal Quit"),Vl.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const _o=this.genMessage(nT.SetSdkProfile,_t);await this.signal.request(_o),Vl.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const _a=this.genMessage(nT.SetSourceChannel,_t);await this.signal.request(_a),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",$S.PACKET_JOINED_SRC_CHANNEL),Vl.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const _u=this.genMessage(nT.SetSourceUserId,_t);await this.signal.request(_u),Vl.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const yl=this.genMessage(nT.SetDestChannel,_t);await this.signal.request(yl),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",$S.PACKET_JOINED_DEST_CHANNEL),Vl.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const Rl=this.genMessage(nT.StartPacketTransfer,_t);await this.signal.request(Rl),this.emit("event",$S.PACKET_SENT_TO_DEST_CHANNEL),this.state=lT.RELAY_STATE_RUNNING,Vl.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success"))}async sendUpdateMessage(_t){const _r=this.genMessage(nT.UpdateDestChannel,_t);await this.signal.request(_r),this.emit("event",$S.PACKET_UPDATE_DEST_CHANNEL),Vl.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const _t=this.genMessage(nT.StopPacketTransfer);await this.signal.request(_t),Vl.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(_t,_r){const _o=[],_a=[],_u=[];this.requestId+=1;const yl={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:aS,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};yl.sdkVersion==="4.17.1"&&(yl.sdkVersion="0.0.1");let Rl=null,Al=null;switch(_t){case nT.SetSdkProfile:return yl.clientRequest={command:"SetSdkProfile",type:"multi_channel"},yl;case nT.SetSourceChannel:if(Al=_r&&_r.getSrcChannelMediaInfo(),!Al)throw new Tp(Ql.UNEXPECTED_ERROR,"can not find source config");return yl.clientRequest={command:"SetSourceChannel",uid:"0",channelName:Al.channelName,token:Al.token||this.joinInfo.appId},yl;case nT.SetSourceUserId:if(Al=_r&&_r.getSrcChannelMediaInfo(),!Al)throw new Tp(Ql.UNEXPECTED_ERROR,"can not find source config");return yl.clientRequest={command:"SetSourceUserId",uid:Al.uid+""},yl;case nT.SetDestChannel:if(Rl=_r&&_r.getDestChannelMediaInfo(),!Rl)throw new Tp(Ql.UNEXPECTED_ERROR,"can not find dest config");return Rl.forEach(Ol=>{_o.push(Ol.channelName),_a.push(Ol.uid+""),_u.push(Ol.token||this.joinInfo.appId)}),yl.clientRequest={command:"SetDestChannel",channelName:_o,uid:_a,token:_u},yl;case nT.StartPacketTransfer:return yl.clientRequest={command:"StartPacketTransfer"},yl;case nT.Reconnect:return yl.clientRequest={command:"Reconnect"},yl;case nT.StopPacketTransfer:return yl.clientRequest={command:"StopPacketTransfer"},yl;case nT.UpdateDestChannel:if(Rl=_r&&_r.getDestChannelMediaInfo(),!Rl)throw new Tp(Ql.UNEXPECTED_ERROR,"can not find dest config");return Rl.forEach(Ol=>{_o.push(Ol.channelName),_a.push(Ol.uid+""),_u.push(Ol.token||this.joinInfo.appId)}),yl.clientRequest={command:"UpdateDestChannel",channelName:_o,uid:_a,token:_u},yl}return yl}}const K4=_e=>{const _t=document.createElement("canvas");return _t.width=2,_t.height=2,new u0((_r,_o)=>{_t.toBlob(async _a=>{if(_t.remove(),_a){const _u=await mq(_a);_r({buffer:_u,width:_t.width,height:_t.height})}else _o(new Tp(Ql.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},_e,1)})},mq=async _e=>{const _t=await _e.arrayBuffer();return new Uint8Array(_t)};function vq(_e,_t){var _r=Object.keys(_e);if(Object.getOwnPropertySymbols){var _o=Object.getOwnPropertySymbols(_e);_t&&(_o=_o.filter(function(_a){return Object.getOwnPropertyDescriptor(_e,_a).enumerable})),_r.push.apply(_r,_o)}return _r}function _q(_e){for(var _t=1;_t<arguments.length;_t++){var _r=arguments[_t]!=null?arguments[_t]:{};_t%2?vq(Object(_r),!0).forEach(function(_o){Ml(_e,_o,_r[_o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_e,Object.getOwnPropertyDescriptors(_r)):vq(Object(_r)).forEach(function(_o){Object.defineProperty(_e,_o,Object.getOwnPropertyDescriptor(_r,_o))})}return _e}class q4{get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(_t){_t!==this._videoElementStatus&&(Vl.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(_t)),this._videoElementStatus=_t)}constructor(_t){Ml(this,"trackId",void 0),Ml(this,"config",void 0),Ml(this,"onFirstVideoFrameDecoded",void 0),Ml(this,"freezeTimeCounterList",[]),Ml(this,"renderFreezeAccTime",0),Ml(this,"timeUpdatedCount",0),Ml(this,"freezeTime",0),Ml(this,"playbackTime",0),Ml(this,"lastTimeUpdatedTime",0),Ml(this,"autoplayFailed",!1),Ml(this,"videoTrack",void 0),Ml(this,"videoElement",void 0),Ml(this,"cacheVideoElement",void 0),Ml(this,"videoElementCheckInterval",void 0),Ml(this,"_videoElementStatus",j_.NONE),Ml(this,"isGettingVideoDimensions",!1),Ml(this,"startGetVideoDimensions",()=>{const _r=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return Vl.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(_r,500)};!this.isGettingVideoDimensions&&_r()}),Ml(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&X0.curState==="running"&&(P6()?(Vl.debug("[track-".concat(this.trackId,"] video element paused, auto resume for iOS 15.2")),this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):n8()?(Vl.debug("[track-".concat(this.trackId,"] video element paused, auto resume for iOS 15.1")),this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):t8()&&(Vl.debug("[track-".concat(this.trackId,"] video element paused, auto resume for iOS 15.0")),this.videoElement.pause(),this.videoElement.play()))}),Ml(this,"handleVideoEvents",_r=>{switch(_r.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=j_.PLAYING;break;case"loadeddata":if(this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=j_.CANPLAY;break;case"stalled":this.videoElementStatus=j_.STALLED;break;case"suspend":this.videoElementStatus=j_.SUSPEND;break;case"pause":this.videoElementStatus=j_.PAUSED,eT()||rR()||_b()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(Vl.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=j_.WAITING;break;case"abort":this.videoElementStatus=j_.ABORT;break;case"ended":this.videoElementStatus=j_.ENDED;break;case"emptied":this.videoElementStatus=j_.EMPTIED;break;case"error":{this.videoElementStatus=j_.ERROR;const _o=this.videoElement.error;_o&&Vl.error("[".concat(this.trackId,"] media error, code: ").concat(_o.code,", message: ").concat(_o.message));break}case"timeupdate":{const _o=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=_o);const _a=_o-this.lastTimeUpdatedTime,_u=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=_o,DR.lastVisibleTime<DR.lastHiddenTime||_u<DR.lastHiddenTime||_u<DR.lastVisibleTime)return;for(_a>Pp("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=_a),this.playbackTime+=_a;this.playbackTime>=6e3;){this.playbackTime-=6e3;const yl=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(yl),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),Ml(this,"autoResumeAfterInterruptionOnIOS15",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(P6()?(Vl.debug("[track-".concat(this.trackId,"] video element paused, auto resume for iOS 15.2")),this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):n8()?(Vl.debug("[track-".concat(this.trackId,"] video element paused, auto resume for iOS 15.1")),this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):t8()&&(Vl.debug("[track-".concat(this.trackId,"] video element paused, auto resume for iOS 15.0")),this.videoElement.pause(),this.videoElement.play()))}),this.trackId=_t.trackId,this.config=_t,_t.element instanceof HTMLVideoElement?this.videoElement=_t.element:this.videoElement=document.createElement("video"),X0.on(v_.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),X0.on(v_.IOS_15_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15)}getVideoElement(){return this.videoElement}getContainerElement(){var _t;return(_t=this.videoElement.parentElement)!==null&&_t!==void 0?_t:void 0}updateConfig(_t){this.config=_t,this.trackId=_t.trackId,_t.element!==this.videoElement&&(this.destroy(),this.videoElement=_t.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(_t){this.videoTrack!==_t&&(this.videoTrack=_t,this.initVideoElement())}play(_t){const _r=this.videoElement.play();_r&&_r.catch&&_r.catch(_a=>{_t&&g0.autoplayFailed(_t,"video",_a.message,this.trackId),_a.name==="NotAllowedError"?(Vl.warning("detected video element autoplay failed",_a),this.autoplayFailed=!0,this.handleAutoPlayFailed()):Vl.warning("[".concat(this.trackId,"] play warning: "),_a)});const _o=gy();if((_o.name==="Safari"&&Number(_o.version)===15||XP())&&_r&&_r.then&&_r.catch){const _a=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};_r.then(_a).catch(_a)}}getCurrentFrame(){const _t=document.createElement("canvas");_t.width=this.videoElement.videoWidth,_t.height=this.videoElement.videoHeight;const _r=_t.getContext("2d");if(!_r)return Vl.error("create canvas context failed!"),new ImageData(2,2);_r.drawImage(this.videoElement,0,0,_t.width,_t.height);const _o=_r.getImageData(0,0,_t.width,_t.height);return _t.remove(),_o}async getCurrentFrameToUint8Array(_t){let _r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const _o=document.createElement("canvas");_o.width=this.videoElement.videoWidth,_o.height=this.videoElement.videoHeight;const _a=_o.getContext("2d");return _a?(_a.drawImage(this.videoElement,0,0,_o.width,_o.height),new u0((_u,yl)=>{_o.toBlob(async Rl=>{if(_o.remove(),Rl){const Al=await mq(Rl);_u({buffer:Al,width:_o.width,height:_o.height})}else yl(new Tp(Ql.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},_t,_r<0?.1:_r>1?1:_r)})):await K4(_t)}destroy(){X0.off(v_.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),X0.off(v_.IOS_15_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[]}initVideoElement(){if(this.videoElementStatus=j_.INIT,!this.videoElementCheckInterval&&(bq.forEach(_u=>{this.videoElement.addEventListener(_u,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{(function(_u){return _u!==document.body&&document.body.contains(_u)})(this.videoElement)||(this.videoElementStatus=j_.DESTROYED)},1e3),Pp("ENABLE_VIDEO_FRAME_CALLBACK"))){var _t,_r;let _u;const yl=(Rl,Al)=>{if(this.videoElementStatus===j_.PLAYING){if(_u){const Ll=Al.presentationTime-_u.presentationTime;Ll>Pp("VIDEO_FREEZE_DURATION")&&DR.lastVisibleTime>=DR.lastHiddenTime&&_u.timestamp>DR.lastVisibleTime&&_u.timestamp>DR.lastHiddenTime&&(this.renderFreezeAccTime+=Ll)}_u=_q(_q({},Al),{},{timestamp:Rl})}var Ol,xl;Pp("ENABLE_VIDEO_FRAME_CALLBACK")&&((Ol=(xl=this.videoElement).requestVideoFrameCallback)===null||Ol===void 0||Ol.call(xl,yl))};(_t=(_r=this.videoElement).requestVideoFrameCallback)===null||_t===void 0||_t.call(_r,yl)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),N6()&&(this.videoElement.poster="noposter");const _o=gy();_o.name==="Safari"&&Number(_o.version)===15||XP()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Wy()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Wy()&&this.videoElement.load());const _a=this.videoElement.play();_a!==void 0&&_a.catch(_u=>{Vl.debug("[".concat(this.trackId,"] playback interrupted"),_u.toString())})}resetVideoElement(){bq.forEach(_t=>{this.videoElement&&this.videoElement.removeEventListener(_t,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=j_.NONE}handleAutoPlayFailed(){const _t=_r=>{_r.preventDefault(),this.videoElement.play().then(()=>{Vl.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(_o=>{Vl.error(_o)}),this.autoplayFailed=!1,t2()?document.body.removeEventListener("click",_t,!0):(document.body.removeEventListener("touchstart",_t,!0),document.body.removeEventListener("mousedown",_t,!0))};t2()?document.body.addEventListener("click",_t,!0):(document.body.addEventListener("touchstart",_t,!0),document.body.addEventListener("mousedown",_t,!0)),A7()}}const bq=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class kq extends q4{constructor(_t){super(_t),Ml(this,"container",void 0),Ml(this,"slot",void 0),this.slot=_t.element,this.updateConfig(_t)}updateConfig(_t){this.config=_t,this.trackId=_t.trackId;const _r=_t.element;_r!==this.slot&&(this.destroy(),this.slot=_r),this.createElements()}updateVideoTrack(_t){this.videoTrack!==_t&&(this.videoTrack=_t,this.createElements())}play(_t){var _r;(_r=this.container)!==null&&_r!==void 0&&_r.contains(this.videoElement)&&super.play(_t)}getCurrentFrame(){var _t;return(_t=this.container)!==null&&_t!==void 0&&_t.contains(this.videoElement)?new ImageData(2,2):super.getCurrentFrame()}async getCurrentFrameToUint8Array(_t){var _r;let _o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(_r=this.container)!==null&&_r!==void 0&&_r.contains(this.videoElement)?await K4(_t):await super.getCurrentFrameToUint8Array(_t,_o)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",Pp("KEEP_LAST_FRAME")&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var _t;!this.container||(_t=this.container)!==null&&_t!==void 0&&_t.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var _t;if((_t=this.container)!==null&&_t!==void 0&&_t.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var _t;(_t=this.container)!==null&&_t!==void 0&&_t.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}function aU(_e){const _t={};_e.facingMode&&(_t.facingMode=_e.facingMode),_e.cameraId&&(_t.deviceId={exact:_e.cameraId});const _r=nO(_e.encoderConfig);return _t.width=_r.width,_t.height=_r.height,!i8()&&_r.frameRate&&(_t.frameRate=_r.frameRate),gy().name===fy.EDGE&&typeof _t.frameRate=="object"&&(_t.frameRate.max=60),Wy()&&(_t.frameRate={ideal:30,max:30}),_t}function yne(_e){const _t={};_e.screenSourceType&&(_t.mediaSource=_e.screenSourceType),_e.extensionId&&x6()&&(_t.extensionId=_e.extensionId);const{displaySurface:_r,selfBrowserSurface:_o,surfaceSwitching:_a,systemAudio:_u}=_e;(k6(107)||JV(107)||QV(93))&&(_r&&(__(_r,"displaySurface",["browser","window","monitor"]),_t.displaySurface=_r),_o?(__(_o,"selfBrowserSurface",["exclude","include"]),_t.selfBrowserSurface=_o):_t.selfBrowserSurface="include",_a&&(__(_a,"surfaceSwitching",["exclude","include"]),_t.surfaceSwitching=_a)),(k6(105)||JV(105)||QV(91))&&_u&&(__(_u,"systemAudio",["exclude","include"]),_t.systemAudio=_u),_e.electronScreenSourceId&&(_t.sourceId=_e.electronScreenSourceId);const yl=_e.encoderConfig?Z6(_e.encoderConfig):null;return _t.mandatory={chromeMediaSource:"desktop",maxWidth:yl?yl.width:void 0,maxHeight:yl?yl.height:void 0},yl&&(yl.frameRate&&(typeof yl.frameRate=="number"?(_t.mandatory.maxFrameRate=yl.frameRate,_t.mandatory.minFrameRate=yl.frameRate):(_t.mandatory.maxFrameRate=yl.frameRate.max||yl.frameRate.ideal||yl.frameRate.exact||void 0,_t.mandatory.minFrameRate=yl.frameRate.min||yl.frameRate.ideal||yl.frameRate.exact||void 0),_t.frameRate=yl.frameRate),yl.width&&(_t.width=yl.width),yl.height&&(_t.height=yl.height)),_t}function jq(_e){const _t={};if(i8()||(_e.AGC!==void 0&&(_t.autoGainControl=_e.AGC),_e.AEC!==void 0&&(_t.echoCancellation=_e.AEC),_e.ANS!==void 0&&(_t.noiseSuppression=_e.ANS,x6()&&_e.ANS&&(_t.googHighpassFilter=_e.ANS))),_e.encoderConfig){const _r=G5(_e.encoderConfig);_t.channelCount=_r.stereo?2:1,_t.sampleRate=_r.sampleRate,_t.sampleSize=_r.sampleSize}return _e.microphoneId&&(_t.deviceId={exact:_e.microphoneId}),N6()&&(_t.sampleRate=void 0),_t}var mN,cU;(function(_e){_e.COVERED="COVERED",_e.POSITION="POSITION",_e.SIZE="SIZE",_e.STYLE="STYLE"})(mN||(mN={})),function(_e){_e.UNMOUNTED="UNMOUNTED",_e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT"}(cU||(cU={}));var qq,e9,t9,n9,r9,i9,o9,s9,a9,c9,u9,l9,d9,h9,f9,p9,g9,m9,y9,v9,E9,_9,T9,S9,B0,R9,A9,I9,w9,O9,C9,x9,k9,dS,P9=new class{constructor(){Ml(this,"_clientSize",null),Ml(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),Ml(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),Ml(this,"getStyle",_e=>window.getComputedStyle(_e,null)),Ml(this,"checkCssVisibleProperty",_e=>{let _t=!0;const _r=this.getStyle(_e),{display:_o,visibility:_a,opacity:_u,filter:yl}=_r;return(_o==="none"||["hidden","collapse"].includes(_a)||Number(_u)<.1)&&(_t=!1),_t?(yl&&yl.split(" ").filter(Rl=>{const Al=Rl.split("(")[0];return["brightness","blur","opacity"].includes(Al)}).map(Rl=>{const[Al,Ol]=Rl.split(/\(|\)/);return[Al,Number(Ol.match(/^[0-9\.]+/))]}).forEach(Rl=>{const[Al,Ol]=Rl;switch(Al){case"brightness":(Ol<.1||Ol>3)&&(_t=!1);break;case"blur":Ol>3&&(_t=!1);break;case"opacity":Ol<.1&&(_t=!1)}}),_t):!1}),Ml(this,"checkPropertyUpToAllParentNodes",(_e,_t)=>{let _r=!0,_o=!0;const _a=yl=>_t(yl);let _u=_e;for(;_u&&_o;)_a(_u)||(_r=!1,_o=!1),_u=_u.parentElement,_u||(_o=!1);return _r}),Ml(this,"checkActualCssVisibleIncludeInherit",_e=>this.checkPropertyUpToAllParentNodes(_e,this.checkCssVisibleProperty)),Ml(this,"getSizeAboutClient",_e=>{const{width:_t,height:_r,left:_o,right:_a,top:_u,bottom:yl}=_e.getBoundingClientRect(),Rl=this.getClientWidth(),Al=this.getClientHeight();return{width:_t,height:_r,left:_o,right:_a,top:_u,bottom:yl,clientWidth:Rl,clientHeight:Al,clientMin:Math.min(Rl,Al)}}),Ml(this,"checkActualSize",()=>{const{width:_e,height:_t,clientMin:_r}=this._clientSize;return this.checkSizeIsVisible(_e,_t,_r)}),Ml(this,"elementFromPoint",(_e,_t)=>document.elementFromPoint?document.elementFromPoint(_e,_t):null),Ml(this,"checkCoverForAPoint",(_e,_t,_r)=>{const _o=this.elementFromPoint(_e,_t);return _o!==null&&_o!==_r}),Ml(this,"getPointPositionList",()=>{const{width:_e,height:_t,left:_r,top:_o}=this._clientSize,_a=_e/6,_u=_t/6,yl=[],Rl=10**6;for(let Al=0;Al<5;Al++)for(let Ol=0;Ol<5;Ol++){const xl=(_r*Rl+(Al===0?.1:Al===4?(_a*Al*Rl-1e5)/Rl:_a*Al)*Rl)/Rl,Ll=(_o*Rl+(Ol===0?.1:Ol===4?(_u*Ol*Rl-1e5)/Rl:_u*Ol)*Rl)/Rl;yl.push({x:xl,y:Ll})}return[...yl]}),Ml(this,"checkElementCover",_e=>this.getPointPositionList().map(_t=>this.checkCoverForAPoint(_t.x,_t.y,_e)).filter(_t=>!!_t).length>6),Ml(this,"checkSizeIsVisible",(_e,_t,_r)=>(_e>50||_r/_e<=10)&&(_t>50||_r/_t<=10)),Ml(this,"checkSizeOfPartInClient",()=>{const{left:_e,right:_t,top:_r,bottom:_o,clientHeight:_a,clientWidth:_u,clientMin:yl}=this._clientSize;let Rl,Al,Ol,xl;if(_e<0)Rl=0;else{if(!(_e<_u))return!1;Rl=_e}if(_t<0)return!1;if(Al=_t<_u?_t:_u,_r<0)Ol=0;else{if(!(_r<_a))return!1;Ol=_r}if(_o<0)return!1;xl=_o<_a?_o:_a;const Ll=Al-Rl,Bl=xl-Ol;return this.checkSizeIsVisible(Ll,Bl,yl)}),Ml(this,"returnHiddenResult",_e=>(this._clientSize=null,{visible:!1,reason:_e})),Ml(this,"checkOneElementVisible",_e=>{if(_e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(_e)){if(this.checkActualCssVisibleIncludeInherit(_e)){if(this._clientSize=this.getSizeAboutClient(_e),this.checkElementCover(_e))return this.returnHiddenResult(mN.COVERED);{const _t=this.checkActualSize(),_r=this.checkSizeOfPartInClient();return _t&&!_r?this.returnHiddenResult(mN.POSITION):_t?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(mN.SIZE)}}return this.returnHiddenResult(mN.STYLE)}return this.returnHiddenResult(cU.UNMOUNTED)}return this.returnHiddenResult(cU.INVALID_HTML_ELEMENT)}),Ml(this,"checkElementIsMountedOnDom",_e=>this.checkPropertyUpToAllParentNodes(_e,_t=>_t.nodeName.toUpperCase()!=="HTML"?_t.parentElement!==null:!!document.documentElement))}};function N9(_e,_t){var _r=Object.keys(_e);if(Object.getOwnPropertySymbols){var _o=Object.getOwnPropertySymbols(_e);_t&&(_o=_o.filter(function(_a){return Object.getOwnPropertyDescriptor(_e,_a).enumerable})),_r.push.apply(_r,_o)}return _r}function p2(_e){for(var _t=1;_t<arguments.length;_t++){var _r=arguments[_t]!=null?arguments[_t]:{};_t%2?N9(Object(_r),!0).forEach(function(_o){Ml(_e,_o,_r[_o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_e,Object.getOwnPropertyDescriptors(_r)):N9(Object(_r)).forEach(function(_o){Object.defineProperty(_e,_o,Object.getOwnPropertyDescriptor(_r,_o))})}return _e}let i_=(qq=_0({argsMap:(_e,_t,_r)=>[_e.getTrackId(),typeof _t=="string"?_t:_t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",_r]}),e9=qy(),t9=_0({argsMap:_e=>[_e.getTrackId()]}),n9=cN("LocalVideoTrack","_enabledMutex"),r9=_0({argsMap:(_e,_t)=>[_e.getTrackId(),_t]}),i9=qy(),o9=cN("LocalVideoTrack","_enabledMutex"),s9=_0({argsMap:(_e,_t)=>[_e.getTrackId(),_t]}),a9=qy(),c9=_0({argsMap:(_e,_t)=>[_e.getTrackId(),_t]}),u9=qy(),l9=qy(),d9=_0({argsMap:(_e,_t,_r)=>[_e.getTrackId(),_t,_r]}),h9=qy(),f9=qy(),p9=qy(),g9=qy(),m9=qy(),y9=qy(),v9=qy(),E9=_0({argsMap:(_e,_t)=>[_e.getTrackId(),_t.name]}),_9=_0({argsMap:_e=>[_e.getTrackId()]}),T9=_0({argsMap:_e=>[_e.getTrackId()]}),S9=_0({argsMap:(_e,_t,_r)=>[_e.getTrackId(),_t.label,_r]}),Yp((B0=class hX extends w4{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==j_.PLAYING)}get processorContext(){return this._processorContext}set processorContext(_t){this._processorContext=_t}get __className__(){return"LocalVideoTrack"}constructor(_t,_r,_o,_a,_u,yl){if(super(_t,_u),Ml(this,"trackMediaType","video"),Ml(this,"_player",void 0),Ml(this,"_videoVisibleTimer",null),Ml(this,"_previousVideoVisibleStatus",void 0),Ml(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),Ml(this,"_encoderConfig",void 0),Ml(this,"_scalabiltyMode",{numSpatialLayers:1,numTemporalLayers:1}),Ml(this,"_optimizationMode",void 0),Ml(this,"_videoHeight",void 0),Ml(this,"_videoWidth",void 0),Ml(this,"_forceBitrateLimit",void 0),Ml(this,"_enabled",!0),Ml(this,"processorDestination",void 0),Ml(this,"_processorContext",void 0),_b()){const{width:Rl,height:Al}=_t.getSettings();this._videoWidth=Rl,this._videoHeight=Al}else this.updateMediaStreamTrackResolution();this._encoderConfig=_r,this._scalabiltyMode=_o,this._optimizationMode=_a,this._hints=yl||[],this._hints.indexOf(f_.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile(),_r&&this._hints.indexOf(f_.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(_r),this.processorContext=new G7(this.getTrackId(),"local"),this.processorDestination=new V7(this.processorContext),this.bindProcessorDestinationEvents()}play(_t){let _r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof _t=="string"){const _a=document.getElementById(_t);_a?_t=_a:(Vl.warning("[".concat(this.getTrackId(),'] can not find "#').concat(_t,'" element, use document.body')),_t=document.body)}Vl.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(_t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(_r));const _o=p2(p2(p2({},this._getDefaultPlayerConfig()),_r),{},{trackId:this.getTrackId(),element:_t});this._player?this._player.updateConfig(_o):(_t instanceof HTMLVideoElement?this._player=new q4(_o):this._player=new kq(_o),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const _a=this.getVideoElementVisibleStatus();this.emit(f1.VIDEO_ELEMENT_VISIBLE_STATUS,_a)}catch{}},Pp("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,Vl.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(_t,_r){if(!_r){if(_t===this._enabled)return;this.stateCheck("enabled",_t)}if(Vl.info("[".concat(this.getTrackId(),"] start setEnabled"),_t),!_t){this._originMediaStreamTrack.enabled=!1;try{await $y(this,w0.NEED_DISABLE_TRACK,this)}catch(_o){throw Vl.error("[".concat(this.getTrackId(),"] setEnabled to false error"),_o.toString()),_o}return _r||(this._enabled=!1),void Vl.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await $y(this,w0.NEED_ENABLE_TRACK,this)}catch(_o){throw Vl.error("[".concat(this.getTrackId(),"] setEnabled to true error"),_o.toString()),_o}Vl.info("[".concat(this.getTrackId(),"] setEnabled to true success")),_r||(this._enabled=!0)}async setMuted(_t){_t!==this._muted&&(this.stateCheck("muted",_t),this._muted=_t,this._originMediaStreamTrack.enabled=!_t,Vl.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(_t)),_t?await $y(this,w0.NEED_MUTE_TRACK,this):await $y(this,w0.NEED_UNMUTE_TRACK,this))}async setEncoderConfiguration(_t,_r){if(!this._enabled)throw new Tp(Ql.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(_t=nO(_t),this._forceBitrateLimit&&(_t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:_t.bitrateMax,_t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:_t.bitrateMin),_t.width||_t.height||_t.frameRate){const _o=aU({encoderConfig:_t});(_b()||eT()||rR())&&(_o.deviceId=void 0),Vl.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(_t),JSON.stringify(_o));try{await this._originMediaStreamTrack.applyConstraints(_o),this.updateMediaStreamTrackResolution()}catch(_a){const _u=new Tp(Ql.UNEXPECTED_ERROR,_a.toString());throw Vl.error("[".concat(this.getTrackId(),"] applyConstraints error"),_u.toString()),_u}}this._encoderConfig=_t,this._hints.indexOf(f_.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await $y(this,w0.NEED_UPDATE_VIDEO_ENCODER,this)}catch(_o){return _o.throw()}}getStats(){return l2(()=>{Vl.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),cR(this,w0.GET_STATS)||p2({},f4)}async setBeautyEffect(_t){Vl.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(_t){let _r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(_t,_r):await K4(_t)}clone(_t,_r,_o,_a){const _u=this._mediaStreamTrack.clone();return new hX(_u,_t,_r,_o,_a)}async setBitrateLimit(_t){if(Vl.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(_t))),_t){this._forceBitrateLimit=_t,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<_t.max_bitrate?this._encoderConfig.bitrateMax:_t.max_bitrate:this._encoderConfig.bitrateMax=_t.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=_t.min_bitrate);try{await $y(this,w0.NEED_UPDATE_VIDEO_ENCODER,this)}catch(_r){return _r.throw()}}}async setOptimizationMode(_t){if(_t!=="motion"&&_t!=="detail"&&_t!=="balanced")return void Vl.error(Ql.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const _r=this._optimizationMode;try{this._optimizationMode=_t,await $y(this,w0.SET_OPTIMIZATION_MODE,this)}catch(_o){throw this._optimizationMode=_r,Vl.error("[".concat(this.getTrackId(),"] set optimization mode failed"),_o.toString()),_o}Vl.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(_t,")"))}setScalabiltyMode(_t){if(_t.numSpatialLayers===1&&_t.numTemporalLayers!==1)return Vl.error(Ql.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabiltyMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabiltyMode=_t,Vl.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(_t,")"))}updateMediaStreamTrackResolution(){UW(this._originMediaStreamTrack).then(_t=>{let[_r,_o]=_t;this._videoHeight=_o,this._videoWidth=_r}).catch(nU)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:_t,height:_r,frameRate:_o}=this.getMediaStreamTrackSettings();if(!_t||!_r||!_o)return;const[_a,_u]=function(yl,Rl,Al){const Ol=Pp("BITRATE_ADAPTER_TYPE");let xl;const Ll=200*Math.pow(Al/15,.6)*Math.pow(yl*Rl/640/360,.75),Bl=Ll;if(Ol==="STANDARD_BITRATE")xl=4*Ll;else{if(Ol!=="COMPATIABLE_BITRATE")return;xl=2*Ll}return[Math.floor(xl),Math.floor(Bl)]}(_t,_r,_o)||[void 0,void 0];this._encoderConfig.bitrateMin||this._encoderConfig.bitrateMax||(this._encoderConfig.bitrateMin=_u,this._encoderConfig.bitrateMax=_a,Vl.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(_t,", h: ").concat(_r,", fps: ").concat(_o,"] => [brMax: ").concat(_a,", brMin: ").concat(_u,"]")))}getVideoElementVisibleStatus(){try{var _t,_r;const _o=this==null||(_t=this._player)===null||_t===void 0?void 0:_t.getContainerElement(),_a={track:this,element:this==null||(_r=this._player)===null||_r===void 0?void 0:_r.getVideoElement(),slot:_o==null?void 0:_o.parentElement},{element:_u,slot:yl}=_a;if(this.isPlaying&&_u instanceof HTMLVideoElement&&yl instanceof HTMLElement){const Rl=P9.checkOneElementVisible(_u),Al=Object.assign({},Rl);if(Al.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=Al.visible;const Ol=g0.reportApiInvoke(null,{tag:jy.TRACER,name:c_.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});Al.visible?Ol.onSuccess("Video is visible"):Ol.onSuccess("Invisible because of ".concat(Al.reason))}return Al}return}catch(_o){throw new Tp(Ql.GET_VIDEO_ELEMENT_VISIBLE_ERROR,_o.message)}}async renewMediaStreamTrack(_t){}pipe(_t){if(this.processor===_t)return _t;if(_t._source)throw new Tp(Ql.INVALID_OPERATION,"Processor ".concat(_t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=_t,this.processor._source=this,_t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),_t}unpipe(){if(!this.processor)return;const _t=this.processor;this.processor._source=void 0,this.processor=void 0,_t.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}async replaceTrack(_t,_r){if(!(_t instanceof MediaStreamTrack))throw new Tp(Ql.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(_t.kind!=="video")throw new Tp(Ql.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(_t,_r,!0),this.updateMediaStreamTrackResolution()}bindProcessorDestinationEvents(){this.processorDestination.on($_.ON_TRACK,async _t=>{_t?_t!==this._mediaStreamTrack&&(this._mediaStreamTrack=_t,this._updatePlayerSource(),await $y(this,w0.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await $y(this,w0.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners($_.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(bT.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(bT.REQUEST_CONSTRAINTS)}}).prototype,"play",[qq,e9],Object.getOwnPropertyDescriptor(B0.prototype,"play"),B0.prototype),Yp(B0.prototype,"stop",[t9],Object.getOwnPropertyDescriptor(B0.prototype,"stop"),B0.prototype),Yp(B0.prototype,"setEnabled",[n9,r9,i9],Object.getOwnPropertyDescriptor(B0.prototype,"setEnabled"),B0.prototype),Yp(B0.prototype,"setMuted",[o9,s9,a9],Object.getOwnPropertyDescriptor(B0.prototype,"setMuted"),B0.prototype),Yp(B0.prototype,"setEncoderConfiguration",[c9,u9],Object.getOwnPropertyDescriptor(B0.prototype,"setEncoderConfiguration"),B0.prototype),Yp(B0.prototype,"getStats",[l9],Object.getOwnPropertyDescriptor(B0.prototype,"getStats"),B0.prototype),Yp(B0.prototype,"setBeautyEffect",[d9,h9],Object.getOwnPropertyDescriptor(B0.prototype,"setBeautyEffect"),B0.prototype),Yp(B0.prototype,"getCurrentFrameData",[f9],Object.getOwnPropertyDescriptor(B0.prototype,"getCurrentFrameData"),B0.prototype),Yp(B0.prototype,"getCurrentFrameImage",[p9],Object.getOwnPropertyDescriptor(B0.prototype,"getCurrentFrameImage"),B0.prototype),Yp(B0.prototype,"setBitrateLimit",[g9],Object.getOwnPropertyDescriptor(B0.prototype,"setBitrateLimit"),B0.prototype),Yp(B0.prototype,"setOptimizationMode",[m9],Object.getOwnPropertyDescriptor(B0.prototype,"setOptimizationMode"),B0.prototype),Yp(B0.prototype,"setScalabiltyMode",[y9],Object.getOwnPropertyDescriptor(B0.prototype,"setScalabiltyMode"),B0.prototype),Yp(B0.prototype,"updateMediaStreamTrackResolution",[v9],Object.getOwnPropertyDescriptor(B0.prototype,"updateMediaStreamTrackResolution"),B0.prototype),Yp(B0.prototype,"pipe",[E9],Object.getOwnPropertyDescriptor(B0.prototype,"pipe"),B0.prototype),Yp(B0.prototype,"unpipe",[_9],Object.getOwnPropertyDescriptor(B0.prototype,"unpipe"),B0.prototype),Yp(B0.prototype,"close",[T9],Object.getOwnPropertyDescriptor(B0.prototype,"close"),B0.prototype),Yp(B0.prototype,"replaceTrack",[S9],Object.getOwnPropertyDescriptor(B0.prototype,"replaceTrack"),B0.prototype),B0),L9=(R9=_0({argsMap:(_e,_t)=>[_e.getTrackId(),_t]}),A9=qy(),I9=cN("CameraVideoTrack","_enabledMutex"),w9=_0({argsMap:(_e,_t)=>[_e.getTrackId(),_t]}),O9=qy(),C9=_0({argsMap:(_e,_t)=>[_e.getTrackId(),_t]}),x9=qy(),k9=_0({argsMap:_e=>[_e.getTrackId()]}),Yp((dS=class extends i_{get __className__(){return"CameraVideoTrack"}constructor(_e,_t,_r,_o,_a,_u){super(_e,nO(_t.encoderConfig),_o,_a,_u),Ml(this,"_config",void 0),Ml(this,"_originalConstraints",void 0),Ml(this,"_constraints",void 0),Ml(this,"_enabled",!0),Ml(this,"_deviceName","default"),Ml(this,"tryResumeVideoForIOS15WeChat",async()=>{XP()&&!P6()&&r8()&&this._enabled&&!this._isClosed&&(Vl.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=_t,this._originalConstraints=_r,this._constraints=_r,this._deviceName=_e.label,this._encoderConfig=nO(this._config.encoderConfig),X0.on(v_.IOS_15_INTERRUPTION_END,this.tryResumeVideoForIOS15WeChat),X0.on(v_.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15WeChat),this.bindProcessorContextEvents()}async setDevice(_e){if(Vl.info("[".concat(this.getTrackId(),"] set device to ").concat(_e)),this._enabled)try{const _t=await zT.getDeviceById(_e),_r={};_r.video=p2({},this._constraints),_r.video.deviceId={exact:_e},_r.video.facingMode=void 0,this._originMediaStreamTrack.stop();let _o=null;try{_o=await AS(_r,this.getTrackId())}catch(_a){throw Vl.error("[".concat(this.getTrackId(),"] setDevice failed"),_a.toString()),_o=await AS({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(_o.getVideoTracks()[0],!1),_a}await this._updateOriginMediaStreamTrack(_o.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=_t.label,this._config.cameraId=_e,this._constraints.deviceId={exact:_e}}catch(_t){throw Vl.error("[".concat(this.getTrackId(),"] setDevice error"),_t.toString()),_t}else try{const _t=await zT.getDeviceById(_e);this._deviceName=_t.label,this._config.cameraId=_e,this._constraints.deviceId={exact:_e}}catch(_t){throw Vl.error("[".concat(this.getTrackId(),"] setDevice error"),_t.toString()),_t}Vl.info("[".concat(this.getTrackId(),"] setDevice success"))}async setEnabled(_e,_t){if(!_t){if(_e===this._enabled)return;this.stateCheck("enabled",_e)}if(Vl.info("[".concat(this.getTrackId(),"] start setEnabled"),_e),_e){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const _r=await AS({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(_r.getVideoTracks()[0],!1)}await $y(this,w0.NEED_ENABLE_TRACK,this)}catch(_r){throw Vl.error("[".concat(this.getTrackId(),"] setEnabled true error"),_r.toString()),_r}this.updateMediaStreamTrackResolution(),Vl.info("[".concat(this.getTrackId(),"] setEnabled to true success")),_t||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),_t||(this._enabled=!1);try{await $y(this,w0.NEED_DISABLE_TRACK,this)}catch(_r){throw Vl.error("[".concat(this.getTrackId(),"] setEnabled to false error"),_r.toString()),_r}Vl.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(_e,_t){if(!this._enabled)throw new Tp(Ql.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");_e=nO(_e),this._forceBitrateLimit&&(_e.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:_e.bitrateMax,_e.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:_e.bitrateMin);const _r=r_(this._config);_r.encoderConfig=_e;const _o=aU(_r);(_b()||eT()||rR())&&(_o.deviceId=void 0),Vl.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(_e),JSON.stringify(_o));try{await this._originMediaStreamTrack.applyConstraints(_o),this.updateMediaStreamTrackResolution()}catch(_a){const _u=new Tp(Ql.UNEXPECTED_ERROR,_a.toString());throw Vl.error("[".concat(this.getTrackId(),"] applyConstraints error"),_u.toString()),_u}this._config=_r,this._constraints=_o,this._originalConstraints=_o,this._encoderConfig=_e,this._hints.indexOf(f_.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await $y(this,w0.NEED_UPDATE_VIDEO_ENCODER,this)}catch(_a){return _a.throw()}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((eT()||rR())&&this._enabled&&!this._isClosed&&X0.duringInterruption){const _e=async()=>{X0.off(v_.IOS_INTERRUPTION_END,_e),this._enabled&&!this._isClosed&&(Vl.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};X0.on(v_.IOS_INTERRUPTION_END,_e)}else Vl.debug("[".concat(this.getTrackId(),"] track ended")),this.emit(f1.TRACK_ENDED)}async renewMediaStreamTrack(_e){const _t=_e||this._constraints,_r=zT.searchDeviceIdByName(this._deviceName);if(_r&&!_t.deviceId&&(_t.deviceId={exact:_r}),this._enabled){const _o=await AS({video:_t},this.getTrackId());this._constraints=_t,await this._updateOriginMediaStreamTrack(_o.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),X0.off(v_.IOS_15_INTERRUPTION_END,this.tryResumeVideoForIOS15WeChat),X0.off(v_.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15WeChat)}bindProcessorContextEvents(){this.processorContext.on(bT.REQUEST_UPDATE_CONSTRAINTS,async(_e,_t,_r)=>{try{const _o=Object.assign({},this._originalConstraints,..._e);await this.renewMediaStreamTrack(_o),_t()}catch(_o){_r(_o)}}),this.processorContext.on(bT.REQUEST_CONSTRAINTS,async _e=>{_e(this._originMediaStreamTrack.getSettings())})}}).prototype,"setDevice",[R9,A9],Object.getOwnPropertyDescriptor(dS.prototype,"setDevice"),dS.prototype),Yp(dS.prototype,"setEnabled",[I9,w9,O9],Object.getOwnPropertyDescriptor(dS.prototype,"setEnabled"),dS.prototype),Yp(dS.prototype,"setEncoderConfiguration",[C9,x9],Object.getOwnPropertyDescriptor(dS.prototype,"setEncoderConfiguration"),dS.prototype),Yp(dS.prototype,"close",[k9],Object.getOwnPropertyDescriptor(dS.prototype,"close"),dS.prototype),dS);class z4{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio)return this._audioTrack}get videoTrack(){if(this.hasVideo)return this._videoTrack}constructor(_t,_r){Ml(this,"uid",void 0),Ml(this,"_uintid",void 0),Ml(this,"_trust_in_room_",!0),Ml(this,"_trust_audio_enabled_state_",!0),Ml(this,"_trust_video_enabled_state_",!0),Ml(this,"_trust_audio_mute_state_",!0),Ml(this,"_trust_video_mute_state_",!0),Ml(this,"_audio_muted_",!1),Ml(this,"_video_muted_",!1),Ml(this,"_audio_enabled_",!0),Ml(this,"_video_enabled_",!0),Ml(this,"_audio_added_",!1),Ml(this,"_video_added_",!1),Ml(this,"_trust_video_stream_added_state_",!0),Ml(this,"_trust_audio_stream_added_state_",!0),Ml(this,"_audioTrack",void 0),Ml(this,"_videoTrack",void 0),Ml(this,"_audioSSRC",void 0),Ml(this,"_videoSSRC",void 0),Ml(this,"_audioOrtc",void 0),Ml(this,"_videoOrtc",void 0),Ml(this,"_cname",void 0),Ml(this,"_rtxSsrcId",void 0),this.uid=_t,this._uintid=_r}}var vne=mV,Ene=UP,_ne=v5;D_({target:"Promise",stat:!0},{try:function(_e){var _t=Ene.f(this),_r=_ne(_e);return(_r.error?_t.reject:_t.resolve)(_r.value),_t.promise}});var Y4=vne,bne=D_,Tne=Sl,Sne=j,Rne=u2,Ane=Cy,Ine=kS,wne=LS,D9=t4,One=f7,Cne=E7,xne=Iy,M9=T0("isConcatSpreadable"),U9=9007199254740991,j9="Maximum allowed index exceeded",F9=Tne.TypeError,kne=xne>=51||!Sne(function(){var _e=[];return _e[M9]=!1,_e.concat()[0]!==_e}),Pne=Cne("concat"),Nne=function(_e){if(!Ane(_e))return!1;var _t=_e[M9];return _t!==void 0?!!_t:Rne(_e)};bne({target:"Array",proto:!0,forced:!kne||!Pne},{concat:function(_e){var _t,_r,_o,_a,_u,yl=Ine(this),Rl=One(yl,0),Al=0;for(_t=-1,_o=arguments.length;_t<_o;_t++)if(Nne(_u=_t===-1?yl:arguments[_t])){if(Al+(_a=wne(_u))>U9)throw F9(j9);for(_r=0;_r<_a;_r++,Al++)_r in _u&&D9(Rl,Al,_u[_r])}else{if(Al>=U9)throw F9(j9);D9(Rl,Al++,_u)}return Rl.length=Al,Rl}});var B9={},Lne=$p,Dne=q0,$9=F1.f,Mne=B8,V9=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];B9.f=function(_e){return V9&&Lne(_e)=="Window"?function(_t){try{return $9(_t)}catch{return Mne(V9)}}(_e):$9(Dne(_e))};var g2={},Une=T0;g2.f=Une;var G9=vy,jne=Q_,Fne=g2,Bne=UT.f,k_=function(_e){var _t=G9.Symbol||(G9.Symbol={});jne(_t,_e)||Bne(_t,_e,{value:Fne.f(_e)})},yN=D_,X4=Sl,$ne=NT,Vne=Ul,m2=Up,Gne=xa,vN=Ep,hO=I1,J4=j,H_=Q_,Wne=u2,Hne=Kl,Kne=Cy,qne=El,Q4=RN,Z4=jT,zne=kS,uU=q0,_B=YS,W9=_A,e$=Fp,y2=V1,H9=rS,Yne=F1,K9=B9,t$=CT,q9=Jl,z9=UT,Xne=zR,Y9=yp,Jne=_E,n$=wR,v2=My.exports,X9=B1,J9=gO,Q9=T0,Qne=g2,Zne=k_,ere=o1,Z9=OP,lU=g7.forEach,YT=KR("hidden"),dU="Symbol",ez=Q9("toPrimitive"),tre=Z9.set,tz=Z9.getterFor(dU),GS=Object.prototype,m1=X4.Symbol,fO=m1&&m1.prototype,nz=X4.TypeError,r$=X4.QObject,E2=$ne("JSON","stringify"),rz=q9.f,y1=z9.f,iz=K9.f,nre=Y9.f,oz=Gne([].push),jR=v2("symbols"),_2=v2("op-symbols"),i$=v2("string-to-symbol-registry"),o$=v2("symbol-to-string-registry"),rre=v2("wks"),s$=!r$||!r$.prototype||!r$.prototype.findChild,a$=vN&&J4(function(){return y2(y1({},"a",{get:function(){return y1(this,"a",{value:7}).a}})).a!=7})?function(_e,_t,_r){var _o=rz(GS,_t);_o&&delete GS[_t],y1(_e,_t,_r),_o&&_e!==GS&&y1(GS,_t,_o)}:y1,c$=function(_e,_t){var _r=jR[_e]=y2(fO);return tre(_r,{type:dU,tag:_e,description:_t}),vN||(_r.description=_t),_r},hU=function(_e,_t,_r){_e===GS&&hU(_2,_t,_r),Z4(_e);var _o=_B(_t);return Z4(_r),H_(jR,_o)?(_r.enumerable?(H_(_e,YT)&&_e[YT][_o]&&(_e[YT][_o]=!1),_r=y2(_r,{enumerable:e$(0,!1)})):(H_(_e,YT)||y1(_e,YT,e$(1,{})),_e[YT][_o]=!0),a$(_e,_o,_r)):y1(_e,_o,_r)},u$=function(_e,_t){Z4(_e);var _r=uU(_t),_o=H9(_r).concat(l$(_r));return lU(_o,function(_a){vN&&!m2(sz,_r,_a)||hU(_e,_a,_r[_a])}),_e},sz=function(_e){var _t=_B(_e),_r=m2(nre,this,_t);return!(this===GS&&H_(jR,_t)&&!H_(_2,_t))&&(!(_r||!H_(this,_t)||!H_(jR,_t)||H_(this,YT)&&this[YT][_t])||_r)},az=function(_e,_t){var _r=uU(_e),_o=_B(_t);if(_r!==GS||!H_(jR,_o)||H_(_2,_o)){var _a=rz(_r,_o);return!_a||!H_(jR,_o)||H_(_r,YT)&&_r[YT][_o]||(_a.enumerable=!0),_a}},cz=function(_e){var _t=iz(uU(_e)),_r=[];return lU(_t,function(_o){H_(jR,_o)||H_(X9,_o)||oz(_r,_o)}),_r},l$=function(_e){var _t=_e===GS,_r=iz(_t?_2:uU(_e)),_o=[];return lU(_r,function(_a){!H_(jR,_a)||_t&&!H_(GS,_a)||oz(_o,jR[_a])}),_o};if(hO||(n$(fO=(m1=function(){if(qne(fO,this))throw nz("Symbol is not a constructor");var _e=arguments.length&&arguments[0]!==void 0?W9(arguments[0]):void 0,_t=J9(_e),_r=function(_o){this===GS&&m2(_r,_2,_o),H_(this,YT)&&H_(this[YT],_t)&&(this[YT][_t]=!1),a$(this,_t,e$(1,_o))};return vN&&s$&&a$(GS,_t,{configurable:!0,set:_r}),c$(_t,_e)}).prototype,"toString",function(){return tz(this).tag}),n$(m1,"withoutSetter",function(_e){return c$(J9(_e),_e)}),Y9.f=sz,z9.f=hU,Xne.f=u$,q9.f=az,Yne.f=K9.f=cz,t$.f=l$,Qne.f=function(_e){return c$(Q9(_e),_e)},vN&&y1(fO,"description",{configurable:!0,get:function(){return tz(this).description}})),yN({global:!0,wrap:!0,forced:!hO,sham:!hO},{Symbol:m1}),lU(H9(rre),function(_e){Zne(_e)}),yN({target:dU,stat:!0,forced:!hO},{for:function(_e){var _t=W9(_e);if(H_(i$,_t))return i$[_t];var _r=m1(_t);return i$[_t]=_r,o$[_r]=_t,_r},keyFor:function(_e){if(!Q4(_e))throw nz(_e+" is not a symbol");if(H_(o$,_e))return o$[_e]},useSetter:function(){s$=!0},useSimple:function(){s$=!1}}),yN({target:"Object",stat:!0,forced:!hO,sham:!vN},{create:function(_e,_t){return _t===void 0?y2(_e):u$(y2(_e),_t)},defineProperty:hU,defineProperties:u$,getOwnPropertyDescriptor:az}),yN({target:"Object",stat:!0,forced:!hO},{getOwnPropertyNames:cz,getOwnPropertySymbols:l$}),yN({target:"Object",stat:!0,forced:J4(function(){t$.f(1)})},{getOwnPropertySymbols:function(_e){return t$.f(zne(_e))}}),E2&&yN({target:"JSON",stat:!0,forced:!hO||J4(function(){var _e=m1();return E2([_e])!="[null]"||E2({a:_e})!="{}"||E2(Object(_e))!="{}"})},{stringify:function(_e,_t,_r){var _o=Jne(arguments),_a=_t;if((Kne(_t)||_e!==void 0)&&!Q4(_e))return Wne(_t)||(_t=function(_u,yl){if(Hne(_a)&&(yl=m2(_a,this,_u,yl)),!Q4(yl))return yl}),_o[1]=_t,Vne(E2,null,_o)}}),!fO[ez]){var ire=fO.valueOf;n$(fO,ez,function(_e){return m2(ire,this)})}ere(m1,dU),X9[YT]=!0,k_("asyncIterator"),k_("hasInstance"),k_("isConcatSpreadable"),k_("iterator"),k_("match"),k_("matchAll"),k_("replace"),k_("search"),k_("species"),k_("split"),k_("toPrimitive"),k_("toStringTag"),k_("unscopables"),o1(Sl.JSON,"JSON",!0);var ore=vy.Symbol;k_("asyncDispose"),k_("dispose"),k_("matcher"),k_("metadata"),k_("observable"),k_("patternMatch"),k_("replaceAll");var uz=ore,lz=g2.f("asyncIterator"),sre=lz;function dz(_e){this.wrapped=_e}function T2(_e){var _t,_r;function _o(_u,yl){try{var Rl=_e[_u](yl),Al=Rl.value,Ol=Al instanceof dz;Y4.resolve(Ol?Al.wrapped:Al).then(function(xl){Ol?_o(_u==="return"?"return":"next",xl):_a(Rl.done?"return":"normal",xl)},function(xl){_o("throw",xl)})}catch(xl){_a("throw",xl)}}function _a(_u,yl){switch(_u){case"return":_t.resolve({value:yl,done:!0});break;case"throw":_t.reject(yl);break;default:_t.resolve({value:yl,done:!1})}(_t=_t.next)?_o(_t.key,_t.arg):_r=null}this._invoke=function(_u,yl){return new Y4(function(Rl,Al){var Ol={key:_u,arg:yl,resolve:Rl,reject:Al,next:null};_r?_r=_r.next=Ol:(_t=_r=Ol,_o(_u,yl))})},typeof _e.return!="function"&&(this.return=void 0)}function wS(_e){return function(){return new T2(_e.apply(this,arguments))}}function H0(_e){return new dz(_e)}T2.prototype[typeof uz=="function"&&sre||"@@asyncIterator"]=function(){return this},T2.prototype.next=function(_e){return this._invoke("next",_e)},T2.prototype.throw=function(_e){return this._invoke("throw",_e)},T2.prototype.return=function(_e){return this._invoke("return",_e)};var are=g2.f("iterator");function S2(_e,_t){var _r={},_o=!1;function _a(_u,yl){return _o=!0,yl=new Y4(function(Rl){Rl(_e[_u](yl))}),{done:!1,value:_t(yl)}}return _r[uz!==void 0&&are||"@@iterator"]=function(){return this},_r.next=function(_u){return _o?(_o=!1,_u):_a("next",_u)},typeof _e.throw=="function"&&(_r.throw=function(_u){if(_o)throw _o=!1,_u;return _a("throw",_u)}),typeof _e.return=="function"&&(_r.return=function(_u){return _o?(_o=!1,_u):_a("return",_u)}),_r}var hz=lz,o_={exports:{}};function fz(_e,_t){var _r=Object.keys(_e);if(Object.getOwnPropertySymbols){var _o=Object.getOwnPropertySymbols(_e);_t&&(_o=_o.filter(function(_a){return Object.getOwnPropertyDescriptor(_e,_a).enumerable})),_r.push.apply(_r,_o)}return _r}function pz(_e){for(var _t=1;_t<arguments.length;_t++){var _r=arguments[_t]!=null?arguments[_t]:{};_t%2?fz(Object(_r),!0).forEach(function(_o){Ml(_e,_o,_r[_o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_e,Object.getOwnPropertyDescriptors(_r)):fz(Object(_r)).forEach(function(_o){Object.defineProperty(_e,_o,Object.getOwnPropertyDescriptor(_r,_o))})}return _e}function d$(_e,_t,_r,_o,_a,_u,yl){let Rl=[],Al=[],Ol=[],xl=[],Ll=!1,Bl=!1;if(o_.exports.parse(_e).mediaDescriptions.forEach(Hl=>{yl&&yl!==Hl.attributes.direction||(Hl.media.mediaType!=="video"||Ll||(Al=Hl.attributes.payloads,xl=Hl.attributes.extmaps,Ll=!0),Hl.media.mediaType!=="audio"||Bl||(Rl=Hl.attributes.payloads,Ol=Hl.attributes.extmaps,Bl=!0))}),!xl||Al.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!Ol||Rl.length===0)throw new Error("Cannot get audio capabilities from SDP.");return Al.forEach(Hl=>{var up;(up=Hl.rtpMap)!==null&&up!==void 0&&up.clockRate&&(Hl.rtpMap.clockRate=parseInt(Hl.rtpMap.clockRate))}),Rl.forEach(Hl=>{var up;(up=Hl.rtpMap)!==null&&up!==void 0&&up.clockRate&&(Hl.rtpMap.clockRate=parseInt(Hl.rtpMap.clockRate))}),_t&&(Rl=Rl.filter(Hl=>{var up;return((up=Hl.rtpMap)===null||up===void 0?void 0:up.encodingName.toLowerCase())!=="rtx"}),Al=Al.filter(Hl=>{var up;return((up=Hl.rtpMap)===null||up===void 0?void 0:up.encodingName.toLowerCase())!=="rtx"})),_r&&(Al=Al.filter(Hl=>{var up;return!/(red)|(ulpfec)|(flexfec)/i.test(((up=Hl.rtpMap)===null||up===void 0?void 0:up.encodingName)||"")})),_o&&(Rl=Rl.filter(Hl=>{var up;return!/(red)|(ulpfec)|(flexfec)/i.test(((up=Hl.rtpMap)===null||up===void 0?void 0:up.encodingName)||"")})),_a&&(_a==null?void 0:_a.length)>0&&(Rl=Rl.filter(Hl=>{var up;return _a.includes(((up=Hl.rtpMap)===null||up===void 0?void 0:up.encodingName.toLowerCase())||"")})),_u&&(_u==null?void 0:_u.length)>0&&(Al=Al.filter(Hl=>{var up;return _u.includes(((up=Hl.rtpMap)===null||up===void 0?void 0:up.encodingName.toLowerCase())||"")})),{audioCodecs:Rl,videoCodecs:Al,audioExtensions:Ol,videoExtensions:xl}}function pO(_e){const _t=o_.exports.parse(_e);let _r,_o;for(const _a of _t.mediaDescriptions){if(!_r){const _u=_a.attributes.iceUfrag,yl=_a.attributes.icePwd;if(!_u||!yl)throw new Error("Cannot get iceUfrag or icePwd from SDP.");_r={iceUfrag:_u,icePwd:yl}}if(!_o){const _u=_a.attributes.fingerprints;_u.length>0&&(_o={fingerprints:_u})}}if(!_o&&_t.attributes.fingerprints.length>0&&(_o={fingerprints:_t.attributes.fingerprints}),!_o||!_r)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:_r,dtlsParameters:_o}}function gz(_e,_t){const _r=[],_o=_e.attributes.ssrcGroups.filter(yl=>yl.semantic==="FID"),_a=_e.attributes.ssrcGroups.find(yl=>yl.semantic==="SIM"),_u=_e.attributes.ssrcs;if(_a)_a.ssrcIds.forEach(yl=>{var Rl;const Al=(Rl=_o.find(Ol=>Ol.ssrcIds[0]===yl))===null||Rl===void 0?void 0:Rl.ssrcIds[1];_r.push({ssrcId:yl,rtx:_t?Al:void 0})});else if(_o.length>0){const yl=_o[0].ssrcIds[0],Rl=_o[0].ssrcIds[1];_r.push({ssrcId:yl,rtx:_t?Rl:void 0})}else{if(_u.length===0)throw new Error("No ssrcs found on local media description.");_r.push({ssrcId:_u[0].ssrcId})}return _r}function mz(_e,_t){const{cname:_r}=_e;let _o;_t&&_t.ip&&typeof _t.port=="number"?(_o=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:_t.ip,port:_t.port.toString(),type:"host",extension:{}}],Vl.debug("Using remote candidate from AP ".concat(_t.ip,":").concat(_t.port)),_t.ip6&&(_o.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:_t.ip6,port:_t.port.toString(),type:"host",extension:{}}),Vl.debug("Using IPV6 remote candidate from AP ".concat(_t.ip6,":").concat(_t.port)))):_o=_e.iceParameters.candidates.map(Rl=>({foundation:Rl.foundation,componentId:"1",transport:Rl.protocol,priority:Rl.priority.toString(),connectionAddress:Rl.ip,port:Rl.port.toString(),type:Rl.type,extension:{}}));const _a={fingerprints:_e.dtlsParameters.fingerprints.map(Rl=>({hashFunction:Rl.algorithm,fingerprint:Rl.fingerprint}))},_u={iceUfrag:_e.iceParameters.iceUfrag,icePwd:_e.iceParameters.icePwd};let yl;switch(_e.dtlsParameters.role){case"server":yl="passive";break;case"client":yl="active";break;case"auto":yl="actpass"}return{dtlsParameters:_a,iceParameters:_u,candidates:_o,rtpCapabilities:p$(_e.rtpCapabilities),setup:yl,cname:_r}}function hS(_e,_t,_r){const _o=[],_a=[];return _e.forEach(_u=>{let{ssrcId:yl,rtx:Rl}=_u;const Al=Ny(8,"track-"),Ol={ssrcId:yl,attributes:pz({label:Al,mslabel:_r=_r||Ny(10,""),msid:"".concat(_r," ").concat(Al)},_t&&{cname:_t})};if(_o.push(Ol),Rl!==void 0){const xl={ssrcId:Rl,attributes:pz({label:Al,mslabel:_r,msid:"".concat(_r," ").concat(Al)},_t&&{cname:_t})};_o.push(xl),_a.push({semantic:"FID",ssrcIds:[yl,Rl]})}}),_e.length>1&&_a.push({semantic:"SIM",ssrcIds:_e.map(_u=>{let{ssrcId:yl}=_u;return yl})}),{ssrcs:_o,ssrcGroups:_a}}function EN(_e,_t){_t instanceof V_&&_e.attributes.payloads.forEach(_r=>{var _o;const _a=(_o=_r.rtpMap)===null||_o===void 0?void 0:_o.encodingName.toLowerCase();if(!_a||["opus","pcmu","pcma","g722"].indexOf(_a)===-1)return;_r.fmtp||(_r.fmtp={parameters:{}}),_r.fmtp.parameters.minptime="10",_r.fmtp.parameters.useinbandfec="1";const _u=_t._encoderConfig;_u&&_a!=="pcmu"&&_a!=="pcma"&&_a!=="g722"&&(_u.bitrate&&!Wy()&&(_r.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*_u.bitrate))),_u.sampleRate&&(_r.fmtp.parameters.maxplaybackrate="".concat(_u.sampleRate),_r.fmtp.parameters["sprop-maxcapturerate"]="".concat(_u.sampleRate)),_u.stereo&&(_r.fmtp.parameters.stereo="1",_r.fmtp.parameters["sprop-stereo"]="1"))})}function h$(_e){const _t=_e.attributes.unrecognized.findIndex(_r=>_r.attField==="x-google-flag"&&_r.attValue==="conference");_t!==-1&&_e.attributes.unrecognized.splice(_t,1)}function f$(_e,_t){if(!(_t instanceof i_&&_t._encoderConfig&&_t._hints.indexOf(f_.SCREEN_TRACK)===-1))return;const _r=_t._encoderConfig;R_().supportMinBitrate&&_r.bitrateMin&&_e.attributes.payloads.forEach(_o=>{var _a;["h264","vp8","vp9","av1"].includes(((_a=_o.rtpMap)===null||_a===void 0?void 0:_a.encodingName.toLowerCase())||"")&&(_o.fmtp||(_o.fmtp={parameters:{}}),_o.fmtp.parameters["x-google-min-bitrate"]="".concat(_r.bitrateMin))}),R_().supportMinBitrate&&!_t._hints.includes(f_.LOW_STREAM)&&_r.bitrateMax&&_e.attributes.payloads.forEach(_o=>{var _a;["h264","vp8","vp9","av1"].includes(((_a=_o.rtpMap)===null||_a===void 0?void 0:_a.encodingName.toLowerCase())||"")&&(_o.fmtp||(_o.fmtp={parameters:{}}),_o.fmtp.parameters["x-google-start-bitrate"]="".concat(Pp("X_GOOGLE_START_BITRATE")||Math.floor(_r.bitrateMax)))})}function yz(_e){if(_e.media.mediaType!=="video")return;const _t=gy();if(_t.name!==fy.SAFARI&&_t.os!==z_.IOS)return;const _r=_e.attributes.extmaps.findIndex(_o=>/video-orientation/g.test(_o.extensionName));_r!==-1&&_e.attributes.extmaps.splice(_r,1)}function fU(_e,_t,_r){if(!_t)return;let _o,_a;if(_e.media.mediaType==="video"?(_o=_r.videoExtensions,_a=_r.videoCodecs):(_o=_r.audioExtensions,_a=_r.audioCodecs),_t.twcc===!0){const _u=_o.find(yl=>yl.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");_u&&(_e.attributes.extmaps.find(yl=>yl.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01")||_e.attributes.extmaps.push({entry:_u.entry,extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"}),function(yl,Rl){return Rl.filter(Al=>!!yl.find(Ol=>Ol.payloadType===Al.payloadType&&!!Ol.rtcpFeedbacks.find(xl=>xl.type==="transport-cc")))}(_a,_e.attributes.payloads).forEach(yl=>{yl.rtcpFeedbacks.find(Rl=>Rl.type==="transport-cc")||yl.rtcpFeedbacks.push({type:"transport-cc"})}))}else if(_t.twcc===!1){const _u=_e.attributes.extmaps.findIndex(yl=>yl.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");_u!==-1&&_e.attributes.extmaps.splice(_u,1),_e.attributes.payloads.forEach(yl=>{const Rl=yl.rtcpFeedbacks.findIndex(Al=>Al.type==="transport-cc");Rl!==-1&&yl.rtcpFeedbacks.splice(Rl,1)})}if(_t.remb===!0){const _u=_o.find(yl=>yl.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time");_u&&(_e.attributes.extmaps.find(yl=>yl.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time")||_e.attributes.extmaps.push({entry:_u.entry,extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}),function(yl,Rl){return Rl.filter(Al=>!!yl.find(Ol=>Ol.payloadType===Al.payloadType&&!!Ol.rtcpFeedbacks.find(xl=>xl.type==="goog-remb")))}(_a,_e.attributes.payloads).forEach(yl=>{yl.rtcpFeedbacks.find(Rl=>Rl.type==="goog-remb")||yl.rtcpFeedbacks.push({type:"goog-remb"})}))}else if(_t.remb===!1){const _u=_e.attributes.extmaps.findIndex(yl=>yl.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time");_u!==-1&&_e.attributes.extmaps.splice(_u,1),_e.attributes.payloads.forEach(yl=>{const Rl=yl.rtcpFeedbacks.findIndex(Al=>Al.type==="goog-remb");Rl!==-1&&yl.rtcpFeedbacks.splice(Rl,1)})}}function vz(_e,_t,_r){if(Wy()||_e.media.mediaType!=="video"||!(_t instanceof i_)||_r!=="vp9"&&_r!=="vp8"||_r==="vp8"&&!Pp("SIMULCAST")||_t._scalabiltyMode===void 0||_t._scalabiltyMode.numSpatialLayers<=1)return;const _o=_r==="vp8"?2:_t._scalabiltyMode.numSpatialLayers,_a=_e.attributes.ssrcs[0],_u=_e.attributes.ssrcGroups.find(Rl=>Rl.semantic==="FID"&&Rl.ssrcIds[0]===_a.ssrcId),yl={semantic:"SIM",ssrcIds:[_a.ssrcId]};for(let Rl=1;Rl<_o;Rl++)_e.attributes.ssrcs.push({ssrcId:_a.ssrcId+Rl,attributes:r_(_a.attributes)}),yl.ssrcIds.push(_a.ssrcId+Rl),_u&&(_e.attributes.ssrcs.push({ssrcId:_u.ssrcIds[1]+Rl,attributes:r_(_a.attributes)}),_e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[_a.ssrcId+Rl,_u.ssrcIds[1]+Rl]}));_e.attributes.ssrcGroups.unshift(yl)}async function Ez(_e,_t,_r,_o,_a){const _u=new RTCPeerConnection;_u.addTransceiver("video",{direction:"sendonly"}),_u.addTransceiver("audio",{direction:"sendonly"}),_u.addTransceiver("video",{direction:"recvonly"}),_u.addTransceiver("audio",{direction:"recvonly"});const yl=(await _u.createOffer()).sdp,Rl=d$(yl,_e,_t,_r,_o,_a,"sendonly"),Al=d$(yl,_e,_t,_r,_o,_a,"recvonly"),Ol={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},xl={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},Ll={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(pU(Rl,Al,"videoExtensions",Ol,xl,Ll),pU(Rl,Al,"videoCodecs",Ol,xl,Ll),pU(Rl,Al,"audioExtensions",Ol,xl,Ll),pU(Rl,Al,"audioCodecs",Ol,xl,Ll),Pp("RAISE_H264_BASELINE_PRIORITY")){const Bl=Ll.videoCodecs.findIndex(Hl=>{var up,_f;return((up=Hl.rtpMap)===null||up===void 0?void 0:up.encodingName.toLocaleLowerCase())==="h264"&&((_f=Hl.fmtp)===null||_f===void 0?void 0:_f.parameters["profile-level-id"])==="42001f"});if(Bl!==-1){const Hl=Ll.videoCodecs.findIndex(up=>{var _f;return((_f=up.rtpMap)===null||_f===void 0?void 0:_f.encodingName.toLocaleLowerCase())==="h264"});if(Hl<Bl){Vl.debug("raising H264 baseline profile priority");const up=Ll.videoCodecs[Bl];Ll.videoCodecs.splice(Bl,1),Ll.videoCodecs.splice(Hl,0,up)}Hl!==-1&&(xl.videoCodecs=xl.videoCodecs.filter(up=>{var _f,vp;return!(((_f=up.rtpMap)===null||_f===void 0?void 0:_f.encodingName.toLocaleLowerCase())==="h264"&&((vp=up.fmtp)===null||vp===void 0?void 0:vp.parameters["profile-level-id"])!=="42001f")})),Hl!==-1&&Pp("FILTER_SEND_H264_BASELINE")&&(Ol.videoCodecs=Ol.videoCodecs.filter(up=>{var _f,vp;return!(((_f=up.rtpMap)===null||_f===void 0?void 0:_f.encodingName.toLocaleLowerCase())==="h264"&&((vp=up.fmtp)===null||vp===void 0?void 0:vp.parameters["profile-level-id"])!=="42001f")}))}}try{_u.close()}catch{}return{send:Ol,recv:xl,sendrecv:Ll}}function pU(_e,_t,_r,_o,_a,_u){if(_r==="videoExtensions"||_r==="audioExtensions"){const yl=[];return _e[_r].forEach(Rl=>{_t[_r].some((Al,Ol)=>{if(Rl.entry===Al.entry&&Rl.extensionName===Al.extensionName)return yl.push(Ol),!0})?_u[_r].push(Rl):_o[_r].push(Rl)}),void _t[_r].forEach((Rl,Al)=>{yl.indexOf(Al)===-1&&_a[_r].push(Rl)})}if(_r==="videoCodecs"||_r==="audioCodecs"){const yl=[];return _e[_r].forEach(Rl=>{_t[_r].some((Al,Ol)=>{if(Rl.payloadType===Al.payloadType&&JSON.stringify(Rl)===JSON.stringify(Al))return yl.push(Ol),!0})?_u[_r].push(Rl):_o[_r].push(Rl)}),void _t[_r].forEach((Rl,Al)=>{yl.indexOf(Al)===-1&&_a[_r].push(Rl)})}}function p$(_e){const{send:_t,recv:_r,sendrecv:_o}=_e;if(!_o){if(!_t||!_r)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:_t,recv:_r}}let _a,_u;return _t?(_a={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},_a.audioCodecs=[..._t.audioCodecs,..._o.audioCodecs],_a.videoCodecs=[..._t.videoCodecs,..._o.videoCodecs],_a.audioExtensions=[..._t.audioExtensions,..._o.audioExtensions],_a.videoExtensions=[..._t.videoExtensions,..._o.videoExtensions]):_a=_o,_r?(_u={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},_u.audioCodecs=[..._r.audioCodecs,..._o.audioCodecs],_u.videoCodecs=[..._r.videoCodecs,..._o.videoCodecs],_u.audioExtensions=[..._r.audioExtensions,..._o.audioExtensions],_u.videoExtensions=[..._r.videoExtensions,..._o.videoExtensions]):_u=_o,{send:_a,recv:_u}}function v1(_e){_e.media.mediaType==="audio"&&_e.attributes.payloads.filter(_t=>{var _r;return((_r=_t.rtpMap)===null||_r===void 0?void 0:_r.encodingName.toLowerCase())==="opus"}).forEach(_t=>{_t.fmtp||(_t.fmtp={parameters:{}}),_t.fmtp.parameters.stereo="1",_t.fmtp.parameters["sprop-stereo"]="1"})}(function(_e,_t){_e.exports=(()=>{var _r={8:(_u,yl,Rl)=>{Rl.r(yl),Rl.d(yl,{Parser:()=>Oy,Printer:()=>RT,parse:()=>O0,print:()=>Z0});const Al=`
`,Ol="".concat("\r").concat(Al),xl=" ";let Ll;function Bl(_m){return _m>="0"&&_m<="9"}function Hl(_m){return _m>="!"&&_m<="~"}function up(_m){return Hl(_m)||_m>=""&&_m<="ÿ"}function _f(_m){return _m==="!"||_m>="#"&&_m<="'"||_m>="*"&&_m<="+"||_m>="-"&&_m<="."||_m>="0"&&_m<="9"||_m>="A"&&_m<="Z"||_m>="^"&&_m<="~"}function vp(_m){return _m>="1"&&_m<="9"}function Dp(_m){return _m>="A"&&_m<="Z"||_m>="a"&&_m<="z"}function Bp(_m){return _m==="d"||_m==="h"||_m==="m"||_m==="s"}function _g(_m){return _m>""&&_m<"	"||_m>"\v"&&_m<"\f"||_m>""&&_m<"ÿ"}function y0(_m){return Dp(_m)||Bl(_m)||_m==="+"||_m==="/"}function e0(_m){return Bl(_m)||Dp(_m)||_m==="+"||_m==="/"||_m==="-"||_m==="_"}function r0(_m){return Dp(_m)||Bl(_m)||_m==="+"||_m==="/"}function Zp(_m,Fl){var _h=Object.keys(_m);if(Object.getOwnPropertySymbols){var Rp=Object.getOwnPropertySymbols(_m);Fl&&(Rp=Rp.filter(function(zp){return Object.getOwnPropertyDescriptor(_m,zp).enumerable})),_h.push.apply(_h,Rp)}return _h}function h0(_m){for(var Fl=1;Fl<arguments.length;Fl++){var _h=arguments[Fl]!=null?arguments[Fl]:{};Fl%2?Zp(Object(_h),!0).forEach(function(Rp){_y(_m,Rp,_h[Rp])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_m,Object.getOwnPropertyDescriptors(_h)):Zp(Object(_h)).forEach(function(Rp){Object.defineProperty(_m,Rp,Object.getOwnPropertyDescriptor(_h,Rp))})}return _m}function _y(_m,Fl,_h){return Fl in _m?Object.defineProperty(_m,Fl,{value:_h,enumerable:!0,configurable:!0,writable:!0}):_m[Fl]=_h,_m}(function(_m){_m.VERSION="v",_m.ORIGIN="o",_m.SESSION_NAME="s",_m.INFORMATION="i",_m.URI="u",_m.EMAIL="e",_m.PHONE="p",_m.CONNECTION="c",_m.BANDWIDTH="b",_m.TIME="t",_m.REPEAT="r",_m.ZONE_ADJUSTMENTS="z",_m.KEY="k",_m.ATTRIBUTE="a",_m.MEDIA="m"})(Ll||(Ll={}));class k0{consumeText(Fl,_h){let Rp=_h;for(;Rp<Fl.length;){const zp=Fl[Rp];if(zp==="\0"||zp==="\r"||zp===Al)break;Rp+=1}if(Rp-_h==0)throw new Error("Invalid text, at ".concat(Fl));return Rp}consumeUnicastAddress(Fl,_h,Rp){return this.consumeTill(Fl,_h,xl)}consumeOneOrMore(Fl,_h,Rp){let zp=_h;for(;Rp(Fl[zp]);)zp++;if(zp-_h==0)throw new Error("Invalid rule at ".concat(_h,"."));return zp}consumeSpace(Fl,_h){if(Fl[_h]===xl)return _h+1;throw new Error("Invalid space at ".concat(_h,"."))}consumeIP4Address(Fl,_h){let Rp=_h;for(let zp=0;zp<4;zp++)if(Rp=this.consumeDecimalUChar(Fl,Rp),zp!==3){if(Fl[Rp]!==".")throw new Error("Invalid IP4 address.");Rp++}return Rp}consumeDecimalUChar(Fl,_h){let Rp=_h;for(let x0=0;x0<3&&Bl(Fl[Rp]);x0++,Rp++);if(Rp-_h==0)throw new Error("Invalid decimal uchar.");const zp=parseInt(Fl.slice(_h,Rp));if(zp>=0&&zp<=255)return Rp;throw new Error("Invalid decimal uchar")}consumeIP6Address(Fl,_h){let Rp=this.consumeHexpart(Fl,_h);return Fl[Rp]===":"&&(Rp+=1,Rp=this.consumeIP4Address(Fl,Rp)),Rp}consumeHexpart(Fl,_h){let Rp=_h;if(Fl[Rp]===":"&&Fl[Rp+1]===":"){Rp+=2;try{Rp=this.consumeHexseq(Fl,Rp)}catch{}return Rp}if(Rp=this.consumeHexseq(Fl,Rp),Fl[Rp]===":"&&Fl[Rp+1]===":"){Rp+=2;try{Rp=this.consumeHexseq(Fl,Rp)}catch{}return Rp}return Rp}consumeHexseq(Fl,_h){let Rp=_h;for(;Rp=this.consumeHex4(Fl,Rp),Fl[Rp]===":"&&Fl[Rp+1]!==":";)Rp+=1;return Rp}consumeHex4(Fl,_h){let Rp=0;for(;Rp<4;Rp++)if(!((zp=Fl[_h+Rp])>="0"&&zp<="9"||zp>="a"&&zp<="f"||zp>="A"&&zp<="F")){if(Rp===0)throw new Error("Invalid hex 4");break}var zp;return _h+Rp}consumeFQDN(Fl,_h){let Rp=_h;for(;Bl(Fl[Rp])||Dp(Fl[Rp])||Fl[Rp]==="-"||Fl[Rp]===".";)Rp+=1;if(Rp-_h<4)throw new Error("Invalid FQDN");return Rp}consumeExtnAddr(Fl,_h){return this.consumeOneOrMore(Fl,_h,up)}consumeMulticastAddress(Fl,_h,Rp){switch(Rp){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(Fl,_h);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(Fl,_h);default:try{return this.consumeFQDN(Fl,_h)}catch{return this.consumeExtnAddr(Fl,_h)}}}consumeIP6MulticastAddress(Fl,_h){const Rp=this.consumeHexpart(Fl,_h);return Fl[Rp]==="/"?this.consumeInteger(Fl,Rp+1):Rp}consumeIP4MulticastAddress(Fl,_h){let Rp=_h+3;const zp=Fl.slice(_h,Rp),x0=parseInt(zp);if(x0<224||x0>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let Ry=0;Ry<3;Ry++){if(Fl[Rp]!==".")throw new Error("Invalid IP4 multicast address.");Rp+=1,Rp=this.consumeDecimalUChar(Fl,Rp)}return Fl[Rp]==="/"&&(Rp+=1),Rp=this.consumeTTL(Fl,Rp),Fl[Rp]==="/"&&(Rp=this.consumeInteger(Fl,Rp)),Rp}consumeInteger(Fl,_h){if(!vp(Fl[_h]))throw new Error("Invalid integer.");for(_h+=1;Bl(Fl[_h]);)_h+=1;return _h}consumeTTL(Fl,_h){if(Fl[_h]==="0")return _h+1;if(!vp(Fl[_h]))throw new Error("Invalid TTL.");_h+=1;for(let Rp=0;Rp<2&&Bl(Fl[_h]);Rp++)_h+=1;return _h}consumeToken(Fl,_h){return this.consumeOneOrMore(Fl,_h,_f)}consumeTime(Fl,_h){let Rp=_h;if(Fl[Rp]==="0")return Rp+1;for(vp(Fl[Rp])&&(Rp+=1);Bl(Fl[Rp]);)Rp++;if(Rp-_h<10)throw new Error("Invalid time");return Rp}consumeAddress(Fl,_h){return this.consumeTill(Fl,_h,xl)}consumeTypedTime(Fl,_h){let Rp=_h;return Rp=this.consumeOneOrMore(Fl,Rp,Bl),Bp(Fl[Rp])?Rp+1:Rp}consumeRepeatInterval(Fl,_h){if(!vp(Fl[_h]))throw new Error("Invalid repeat interval");for(_h+=1;Bl(Fl[_h]);)_h+=1;return Bp(Fl[_h])&&(_h+=1),_h}consumePort(Fl,_h){return this.consumeOneOrMore(Fl,_h,Bl)}consume(Fl,_h,Rp){for(let zp=0;zp<Rp.length;zp++){if(_h+zp>=Fl.length)throw new Error("consume exceeding value length");if(Fl[_h+zp]!==Rp[zp])throw new Error("consume ".concat(Rp," failed at ").concat(zp))}return _h+Rp.length}consumeTill(Fl,_h,Rp){let zp=_h;for(;zp<Fl.length&&(typeof Rp!="string"||Fl[zp]!==Rp)&&(typeof Rp!="function"||!Rp(Fl[zp]));)zp++;return zp}}class Oy extends k0{constructor(){super(),_y(this,"records",[]),_y(this,"currentLine",0)}parse(Fl){const _h=this.probeEOL(Fl);this.records=Fl.split(_h).filter(fT=>!!fT.trim()).map(this.parseLine),this.currentLine=0;const Rp=this.parseVersion(),zp=this.parseOrigin(),x0=this.parseSessionName(),Ry=this.parseInformation(),N_=this.parseUri(),xS=this.parseEmail(),S1=this.parsePhone(),mS=this.parseConnection(),R1=this.parseBandWidth(),TN=this.parseTimeFields(),Vy=this.parseKey(),s_=this.parseSessionAttribute(),Ty=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:Rp,origin:zp,sessionName:x0,information:Ry,uri:N_,emails:xS,phones:S1,connection:mS,bandwidths:R1,timeFields:TN,key:Vy,attributes:s_,mediaDescriptions:Ty}}getCurrentRecord(){const Fl=this.records[this.currentLine];if(!Fl)throw new Error("Record doesn't exit.");return Fl}probeEOL(Fl){for(let _h=0;_h<Fl.length;_h++)if(Fl[_h]===Al)return Fl[_h-1]==="\r"?Ol:Al;throw new Error("Invalid newline character.")}parseLine(Fl,_h){if(Fl.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const Rp=Fl[0];if(Fl[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:Rp,value:Fl.slice(2),line:_h,cur:0}}parseSessionAttribute(){const Fl=new Xy;for(;this.currentLine<this.records.length;){const _h=this.getCurrentRecord();if(_h.type!==Ll.ATTRIBUTE)break;const Rp={attField:this.extractOneOrMore(_h,zp=>_f(zp)&&zp!==":"),_cur:0};_h.value[_h.cur]===":"&&(_h.cur+=1,Rp.attValue=this.extractOneOrMore(_h,_g)),Fl.parse(Rp),this.currentLine++}return Fl.digest()}parseMediaAttributes(Fl){const _h=new P_(Fl);for(;this.currentLine<this.records.length;){const Rp=this.getCurrentRecord();if(Rp.type!==Ll.ATTRIBUTE)break;const zp={attField:this.extractOneOrMore(Rp,x0=>_f(x0)&&x0!==":"),_cur:0};Rp.value[Rp.cur]===":"&&(Rp.cur+=1,zp.attValue=this.extractOneOrMore(Rp,_g)),_h.parse(zp),this.currentLine++}return _h.digest()}parseKey(){const Fl=this.getCurrentRecord();if(Fl.type===Ll.KEY){if(Fl.value==="prompt"||Fl.value==="clear:"||Fl.value==="base64:"||Fl.value==="uri:")return Fl.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const Fl=this.getCurrentRecord();if(Fl.type===Ll.ZONE_ADJUSTMENTS){const _h=[];for(;;)try{const Rp=this.extract(Fl,this.consumeTime);this.consumeSpaceForRecord(Fl);let zp=!1;Fl.value[Fl.cur]==="-"&&(zp=!0,Fl.cur+=1);const x0=this.extract(Fl,this.consumeTypedTime);_h.push({time:Rp,typedTime:x0,back:zp})}catch{break}if(_h.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,_h}return[]}parseRepeat(){const Fl=[];for(;;){const _h=this.getCurrentRecord();if(_h.type!==Ll.REPEAT)break;{const Rp=this.extract(_h,this.consumeRepeatInterval),zp=this.parseTypedTime(_h);Fl.push({repeatInterval:Rp,typedTimes:zp}),this.currentLine++}}return Fl}parseTypedTime(Fl){const _h=[];for(;;)try{this.consumeSpaceForRecord(Fl),_h.push(this.extract(Fl,this.consumeTypedTime))}catch{break}if(_h.length===0)throw new Error("Invalid typed time.");return _h}parseTime(){const Fl=this.getCurrentRecord(),_h=this.extract(Fl,this.consumeTime);this.consumeSpaceForRecord(Fl);const Rp=this.extract(Fl,this.consumeTime);return this.currentLine++,{startTime:_h,stopTime:Rp}}parseBandWidth(){const Fl=[];for(;this.currentLine<this.records.length;){const _h=this.getCurrentRecord();if(_h.type!==Ll.BANDWIDTH)break;{const Rp=this.extractOneOrMore(_h,_f);if(_h.value[_h.cur]!==":")throw new Error("Invalid bandwidth field.");_h.cur++;const zp=this.extractOneOrMore(_h,Bl);Fl.push({bwtype:Rp,bandwidth:zp}),this.currentLine++}}return Fl}parseVersion(){const Fl=this.getCurrentRecord();if(Fl.type!==Ll.VERSION)throw new Error("first sdp record must be version");const _h=Fl.value.slice(0,this.consumeOneOrMore(Fl.value,0,Bl));if(_h.length!==Fl.value.length)throw new Error('invalid proto version, "v='.concat(Fl.value,'"'));return this.currentLine++,_h}parseOrigin(){const Fl=this.getCurrentRecord();if(Fl.type!==Ll.ORIGIN)throw new Error("second line of sdp must be origin");const _h=this.extractOneOrMore(Fl,up);this.consumeSpaceForRecord(Fl);const Rp=this.extractOneOrMore(Fl,Bl);this.consumeSpaceForRecord(Fl);const zp=this.extractOneOrMore(Fl,Bl);this.consumeSpaceForRecord(Fl);const x0=this.extractOneOrMore(Fl,_f);this.consumeSpaceForRecord(Fl);const Ry=this.extractOneOrMore(Fl,_f);this.consumeSpaceForRecord(Fl);const N_=this.extract(Fl,this.consumeUnicastAddress);return this.currentLine++,{username:_h,sessId:Rp,sessVersion:zp,nettype:x0,addrtype:Ry,unicastAddress:N_}}parseSessionName(){const Fl=this.getCurrentRecord();if(Fl.type===Ll.SESSION_NAME){const _h=this.extract(Fl,this.consumeText);return this.currentLine++,_h}}parseInformation(){const Fl=this.getCurrentRecord();if(Fl.type!==Ll.INFORMATION)return;const _h=this.extract(Fl,this.consumeText);return this.currentLine++,_h}parseUri(){const Fl=this.getCurrentRecord();if(Fl.type===Ll.URI)return this.currentLine++,Fl.value}parseEmail(){const Fl=[];for(;;){const _h=this.getCurrentRecord();if(_h.type!==Ll.EMAIL)break;Fl.push(_h.value),this.currentLine++}return Fl}parsePhone(){const Fl=[];for(;;){const _h=this.getCurrentRecord();if(_h.type!==Ll.PHONE)break;Fl.push(_h.value),this.currentLine++}return Fl}parseConnection(){const Fl=this.getCurrentRecord();if(Fl.type===Ll.CONNECTION){const _h=this.extractOneOrMore(Fl,_f);this.consumeSpaceForRecord(Fl);const Rp=this.extractOneOrMore(Fl,_f);this.consumeSpaceForRecord(Fl);const zp=this.extract(Fl,this.consumeAddress);return this.currentLine++,{nettype:_h,addrtype:Rp,address:zp}}}parseMedia(){const Fl=this.getCurrentRecord(),_h=this.extract(Fl,this.consumeToken);this.consumeSpaceForRecord(Fl);let Rp=this.extract(Fl,this.consumePort);Fl.value[Fl.cur]==="/"&&(Fl.cur+=1,Rp+=this.extract(Fl,this.consumeInteger)),this.consumeSpaceForRecord(Fl);const zp=[];for(zp.push(this.extract(Fl,this.consumeToken));Fl.value[Fl.cur]==="/";)Fl.cur+=1,zp.push(this.extract(Fl,this.consumeToken));if(zp.length===0)throw new Error("Invalid proto");const x0=this.parseFmt(Fl);return this.currentLine++,{mediaType:_h,port:Rp,protos:zp,fmts:x0}}parseTimeFields(){const Fl=[];for(;this.getCurrentRecord().type===Ll.TIME;){const _h=this.parseTime(),Rp=this.parseRepeat(),zp=this.parseZone();Fl.push({time:_h,repeats:Rp,zones:zp})}return Fl}parseMediaDescription(){const Fl=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===Ll.MEDIA;){const _h=this.parseMedia(),Rp=this.parseInformation(),zp=this.parseConnections(),x0=this.parseBandWidth(),Ry=this.parseKey(),N_=this.parseMediaAttributes(_h);Fl.push({media:_h,information:Rp,connections:zp,bandwidths:x0,key:Ry,attributes:N_})}return Fl}parseConnections(){const Fl=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===Ll.CONNECTION;)Fl.push(this.parseConnection());return Fl}parseFmt(Fl){const _h=[];for(;;)try{this.consumeSpaceForRecord(Fl),_h.push(this.extract(Fl,this.consumeToken))}catch{break}if(_h.length===0)throw new Error("Invalid fmts");return _h}extract(Fl,_h,...Rp){const zp=_h.call(this,Fl.value,Fl.cur,...Rp),x0=Fl.value.slice(Fl.cur,zp);return Fl.cur=zp,x0}extractOneOrMore(Fl,_h){const Rp=this.consumeOneOrMore(Fl.value,Fl.cur,_h),zp=Fl.value.slice(Fl.cur,Rp);return Fl.cur=Rp,zp}consumeSpaceForRecord(Fl){if(Fl.value[Fl.cur]!==xl)throw new Error("Invalid space at ".concat(Fl.cur,"."));Fl.cur+=1}}class by extends k0{constructor(...Fl){super(...Fl),_y(this,"attributes",void 0),_y(this,"digested",!1)}extractOneOrMore(Fl,_h,Rp){const zp=this.consumeOneOrMore(Fl.attValue,Fl._cur,_h),x0=Fl.attValue.slice(Fl._cur,zp),[Ry,N_]=Rp||[];if(typeof Ry=="number"&&x0.length<Ry)throw new Error("error in length, should be more or equal than ".concat(Ry," characters."));if(typeof N_=="number"&&x0.length>N_)throw new Error("error in length, should be less or equal than ".concat(N_," characters."));return Fl._cur=zp,x0}consumeAttributeSpace(Fl){if(Fl.attValue[Fl._cur]!==xl)throw new Error("Invalid space at ".concat(Fl._cur,"."));Fl._cur+=1}extract(Fl,_h,...Rp){if(!Fl.attValue)throw new Error("Nothing to extract from attValue.");const zp=_h.call(this,Fl.attValue,Fl._cur,...Rp),x0=Fl.attValue.slice(Fl._cur,zp);return Fl._cur=zp,x0}atEnd(Fl){if(!Fl.attValue)throw new Error;return Fl._cur>=Fl.attValue.length}peekChar(Fl){if(!Fl.attValue)throw new Error;return Fl.attValue[Fl._cur]}peek(Fl,_h){if(!Fl.attValue)throw new Error;for(let Rp=0;Rp<_h.length;Rp++)if(_h[Rp]!==Fl.attValue[Fl._cur+Rp])return!1;return!0}parseIceUfrag(Fl){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(Fl,y0,[4,256])}parseIcePwd(Fl){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(Fl,y0,[22,256])}parseIceOptions(Fl){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const _h=[];for(;!this.atEnd(Fl);){_h.push(this.extractOneOrMore(Fl,y0));try{this.consumeAttributeSpace(Fl)}catch(Rp){if(this.atEnd(Fl))break;throw Rp}}this.attributes.iceOptions=_h}parseFingerprint(Fl){const _h=this.extract(Fl,this.consumeToken);this.consumeAttributeSpace(Fl);const Rp=this.extract(Fl,this.consumeTill);this.attributes.fingerprints.push({hashFunction:_h,fingerprint:Rp})}parseExtmap(Fl){const _h=this.extractOneOrMore(Fl,Bl);let Rp;this.peekChar(Fl)==="/"&&(this.extract(Fl,this.consume,"/"),Rp=this.extract(Fl,this.consumeToken)),this.consumeAttributeSpace(Fl);const zp=this.extract(Fl,this.consumeTill,xl),x0=h0(h0({entry:parseInt(_h,10)},Rp&&{direction:Rp}),{},{extensionName:zp});this.peekChar(Fl)===xl&&(this.consumeAttributeSpace(Fl),x0.extensionAttributes=this.extract(Fl,this.consumeTill)),this.attributes.extmaps.push(x0)}parseSetup(Fl){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const _h=this.extract(Fl,this.consumeTill);if(_h!=="active"&&_h!=="passive"&&_h!=="actpass"&&_h!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=_h}}class Xy extends by{constructor(...Fl){super(...Fl),_y(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(Fl){if(this.digested)throw new Error("already digested");try{switch(Fl.attField){case"group":this.parseGroup(Fl);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(Fl);break;case"ice-pwd":this.parseIcePwd(Fl);break;case"ice-options":this.parseIceOptions(Fl);break;case"fingerprint":this.parseFingerprint(Fl);break;case"setup":this.parseSetup(Fl);break;case"tls-id":this.parseTlsId(Fl);break;case"identity":this.parseIdentity(Fl);break;case"extmap":this.parseExtmap(Fl);break;case"msid-semantic":this.parseMsidSemantic(Fl);break;default:Fl.ignored=!0,this.attributes.unrecognized.push(Fl)}}catch(_h){throw console.error("parsing session attribute ".concat(Fl.attField,' error, "a=').concat(Fl.attField,":").concat(Fl.attValue,'"')),_h}if(!Fl.ignored&&Fl.attValue&&!this.atEnd(Fl))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(Fl){const _h=this.extract(Fl,this.consumeToken),Rp=[];for(;!this.atEnd(Fl)&&this.peekChar(Fl)===xl;)this.consumeAttributeSpace(Fl),Rp.push(this.extract(Fl,this.consumeToken));this.attributes.groups.push({semantic:_h,identificationTag:Rp})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(Fl){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(Fl,e0)}parseIdentity(Fl){const _h=this.extractOneOrMore(Fl,r0),Rp=[];for(;!this.atEnd(Fl)&&this.peekChar(Fl)===xl;){this.consumeAttributeSpace(Fl);const zp=this.extract(Fl,this.consumeToken);this.extract(Fl,this.consume,"=");const x0=this.extractOneOrMore(Fl,Ry=>Ry!==xl&&_g(Ry));Rp.push({name:zp,value:x0})}this.attributes.identities.push({assertionValue:_h,extensions:Rp})}parseMsidSemantic(Fl){this.peekChar(Fl)===xl&&this.consumeAttributeSpace(Fl);const _h={semantic:this.extract(Fl,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(Fl)}catch{break}if(this.peekChar(Fl)==="*"){this.extract(Fl,this.consume,"*"),_h.applyForAll=!0;break}{const Rp=this.extract(Fl,this.consumeTill,xl);_h.identifierList.push(Rp)}}this.attributes.msidSemantic=_h}}class P_ extends by{constructor(Fl){super(),_y(this,"attributes",void 0),Fl.protos.indexOf("RTP")!==-1||Fl.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(Fl){if(this.digested)throw new Error("already digested");try{switch(Fl.attField){case"extmap":this.parseExtmap(Fl);break;case"setup":this.parseSetup(Fl);break;case"ice-ufrag":this.parseIceUfrag(Fl);break;case"ice-pwd":this.parseIcePwd(Fl);break;case"ice-options":this.parseIceOptions(Fl);break;case"candidate":this.parseCandidate(Fl);break;case"remote-candidate":this.parseRemoteCandidate(Fl);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(Fl);break;case"rtpmap":this.parseRtpmap(Fl);break;case"ptime":this.parsePtime(Fl);break;case"maxptime":this.parseMaxPtime(Fl);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(Fl);break;case"ssrc":this.parseSSRC(Fl);break;case"fmtp":this.parseFmtp(Fl);break;case"rtcp-fb":this.parseRtcpFb(Fl);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(Fl);break;case"mid":this.parseMid(Fl);break;case"msid":this.parseMsid(Fl);break;case"imageattr":this.parseImageAttr(Fl);break;case"rid":this.parseRid(Fl);break;case"simulcast":this.parseSimulcast(Fl);break;case"sctp-port":this.parseSctpPort(Fl);break;case"max-message-size":this.parseMaxMessageSize(Fl);break;case"ssrc-group":this.parseSSRCGroup(Fl);break;default:Fl.ignored=!0,this.attributes.unrecognized.push(Fl)}}catch(_h){throw console.error("parsing media attribute ".concat(Fl.attField,' error, "a=').concat(Fl.attField,":").concat(Fl.attValue,'"')),_h}if(!Fl.ignored&&Fl.attValue&&!this.atEnd(Fl))throw new Error("attribute parsing error")}parseCandidate(Fl){const _h=this.extractOneOrMore(Fl,y0,[1,32]);this.consumeAttributeSpace(Fl);const Rp=this.extractOneOrMore(Fl,Bl,[1,5]);this.consumeAttributeSpace(Fl);const zp=this.extract(Fl,this.consumeToken);this.consumeAttributeSpace(Fl);const x0=this.extractOneOrMore(Fl,Bl,[1,10]);this.consumeAttributeSpace(Fl);const Ry=this.extract(Fl,this.consumeAddress);this.consumeAttributeSpace(Fl);const N_=this.extract(Fl,this.consumePort);this.consumeAttributeSpace(Fl),this.extract(Fl,this.consume,"typ"),this.consumeAttributeSpace(Fl);const xS={foundation:_h,componentId:Rp,transport:zp,priority:x0,connectionAddress:Ry,port:N_,type:this.extract(Fl,this.consumeToken),extension:{}};for(this.peek(Fl," raddr")&&(this.extract(Fl,this.consume," raddr"),this.consumeAttributeSpace(Fl),xS.relAddr=this.extract(Fl,this.consumeAddress)),this.peek(Fl," rport")&&(this.extract(Fl,this.consume," rport"),this.consumeAttributeSpace(Fl),xS.relPort=this.extract(Fl,this.consumePort));this.peekChar(Fl)===xl;){this.consumeAttributeSpace(Fl);const S1=this.extract(Fl,this.consumeToken);this.consumeAttributeSpace(Fl),xS.extension[S1]=this.extractOneOrMore(Fl,Hl)}this.attributes.candidates.push(xS)}parseRemoteCandidate(Fl){const _h=[];for(;;){const Rp=this.extractOneOrMore(Fl,Bl,[1,5]);this.consumeAttributeSpace(Fl);const zp=this.extract(Fl,this.consumeAddress);this.consumeAttributeSpace(Fl);const x0=this.extract(Fl,this.consumePort);_h.push({componentId:Rp,connectionAddress:zp,port:x0});try{this.consumeAttributeSpace(Fl)}catch{break}}this.attributes.remoteCandidatesList.push(_h)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(Fl){const _h=this.extract(Fl,this.consumeToken);this.consumeAttributeSpace(Fl);const Rp=this.extract(Fl,this.consumeTill,"/");this.extract(Fl,this.consume,"/");const zp={encodingName:Rp,clockRate:this.extractOneOrMore(Fl,Bl)};this.atEnd(Fl)||this.peekChar(Fl)!=="/"||(this.extract(Fl,this.consume,"/"),zp.encodingParameters=parseInt(this.extract(Fl,this.consumeTill),10));const x0=this.attributes.payloads.find(Ry=>Ry.payloadType===parseInt(_h,10));x0?x0.rtpMap=zp:this.attributes.payloads.push({payloadType:parseInt(_h,10),rtpMap:zp,rtcpFeedbacks:[]})}parsePtime(Fl){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(Fl,this.consumeTill)}parseMaxPtime(Fl){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(Fl,this.consumeTill)}parseDirection(Fl){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=Fl.attField}parseSSRC(Fl){const _h=this.extractOneOrMore(Fl,Bl);this.consumeAttributeSpace(Fl);const Rp=this.extract(Fl,this.consumeTill,":");let zp;this.peekChar(Fl)===":"&&(this.extract(Fl,this.consume,":"),zp=this.extract(Fl,this.consumeTill));const x0=this.attributes.ssrcs.find(Ry=>Ry.ssrcId===parseInt(_h,10));x0?x0.attributes[Rp]=zp:this.attributes.ssrcs.push({ssrcId:parseInt(_h,10),attributes:{[Rp]:zp}})}parseFmtp(Fl){const _h=this.extract(Fl,this.consumeTill,xl);this.consumeAttributeSpace(Fl);const Rp=this.extract(Fl,this.consumeTill),zp={};Rp.split(";").forEach(Ry=>{let[N_,xS]=Ry.split("=");N_=N_.trim();const S1=typeof xS=="string"?xS.trim():null;typeof N_=="string"&&N_.length>0&&(zp[N_]=S1)});const x0=this.attributes.payloads.find(Ry=>Ry.payloadType===parseInt(_h,10));x0?x0.fmtp={parameters:zp}:this.attributes.payloads.push({payloadType:parseInt(_h,10),rtcpFeedbacks:[],fmtp:{parameters:zp}})}parseFmtParameters(Fl){const _h={},Rp=this.extract(Fl,this.consumeTill,"=");Fl._cur++;const zp=this.extract(Fl,this.consumeTill,";");for(_h[Rp]=zp;Fl.attValue[Fl._cur]===";";){const x0=this.extract(Fl,this.consumeTill,"=");Fl._cur++;const Ry=this.extract(Fl,this.consumeTill,";");_h[x0]=Ry}return _h}parseRtcpFb(Fl){let _h="";_h=this.peekChar(Fl)==="*"?this.extract(Fl,this.consume,"*"):this.extract(Fl,this.consumeTill,xl),this.consumeAttributeSpace(Fl);const Rp=this.extract(Fl,this.consumeTill,xl);let zp;switch(Rp){case"trr-int":zp={type:Rp,interval:this.extract(Fl,this.consumeTill)};break;case"ack":case"nack":default:{const x0={type:Rp};this.peekChar(Fl)===xl&&(this.consumeAttributeSpace(Fl),x0.parameter=this.extract(Fl,this.consumeToken),this.peekChar(Fl)===xl&&(x0.additional=this.extract(Fl,this.consumeTill))),zp=x0}}if(_h==="*")this.attributes.rtcpFeedbackWildcards.push(zp);else{const x0=this.attributes.payloads.find(Ry=>Ry.payloadType===parseInt(_h,10));x0?x0.rtcpFeedbacks.push(zp):this.attributes.payloads.push({payloadType:parseInt(_h,10),rtcpFeedbacks:[zp]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(Fl){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const _h={port:this.extract(Fl,this.consumePort)};this.peekChar(Fl)===xl&&(this.consumeAttributeSpace(Fl),_h.netType=this.extractOneOrMore(Fl,_f),this.consumeAttributeSpace(Fl),_h.addressType=this.extractOneOrMore(Fl,_f),this.consumeAttributeSpace(Fl),_h.address=this.extract(Fl,this.consumeAddress)),this.attributes.rtcp=_h}parseMsid(Fl){const _h={id:this.extractOneOrMore(Fl,_f,[1,64])};this.peekChar(Fl)===xl&&(this.consumeAttributeSpace(Fl),_h.appdata=this.extractOneOrMore(Fl,_f,[1,64])),this.attributes.msids.push(_h)}parseImageAttr(Fl){this.attributes.imageattr.push(Fl.attValue)}parseRid(Fl){const _h=this.extractOneOrMore(Fl,zp=>Dp(zp)||Bl(zp)||zp==="_"||zp==="-");this.consumeAttributeSpace(Fl);const Rp={id:_h,direction:this.extract(Fl,this.consumeToken),params:[]};if(this.peekChar(Fl)===xl){if(this.consumeAttributeSpace(Fl),this.peek(Fl,"pt=")){this.extract(Fl,this.consume,"pt=");const zp=[];for(;;){const x0=this.extract(Fl,this.consumeToken);zp.push(x0);try{this.extract(Fl,this.consume,",")}catch{break}}Rp.payloads=zp,this.peekChar(Fl)===xl&&this.extract(Fl,this.consume,xl)}for(;;){const zp=this.extract(Fl,this.consumeToken);switch(zp){case"depend":{const x0={type:zp,rids:this.extract(Fl,this.consume,"=").split(",")};Rp.params.push(x0);break}case"max-width":case"height-width":case"max-fps":case"max-fs":case"max-br":case"max-pps":case"max-bpp":default:{const x0={type:zp};this.peekChar(Fl)==="="&&(this.extract(Fl,this.consume,"="),x0.val=this.extract(Fl,this.consumeTill,";")),Rp.params.push(x0)}}try{this.extract(Fl,this.consume,";")}catch{break}}}this.attributes.rids.push(Rp)}parseSimulcast(Fl){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=Fl.attValue,this.extract(Fl,this.consumeTill)}parseSctpPort(Fl){this.attributes.sctpPort=this.extractOneOrMore(Fl,Bl,[1,5])}parseMaxMessageSize(Fl){this.attributes.maxMessageSize=this.extractOneOrMore(Fl,Bl,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(Fl){this.attributes.mid=this.extract(Fl,this.consumeToken)}parseSSRCGroup(Fl){const _h=this.extract(Fl,this.consumeToken),Rp=[];for(;;)try{this.consumeAttributeSpace(Fl);const zp=this.extract(Fl,this.consumeInteger);Rp.push(parseInt(zp,10))}catch{break}this.attributes.ssrcGroups.push({semantic:_h,ssrcIds:Rp})}}function zy(_m,Fl,_h){return Fl in _m?Object.defineProperty(_m,Fl,{value:_h,enumerable:!0,configurable:!0,writable:!0}):_m[Fl]=_h,_m}class RT{constructor(){zy(this,"eol",Ol)}print(Fl,_h){let Rp="";return _h&&(this.eol=_h),Rp+=this.printVersion(Fl.version),Rp+=this.printOrigin(Fl.origin),Rp+=this.printSessionName(Fl.sessionName),Rp+=this.printInformation(Fl.information),Rp+=this.printUri(Fl.uri),Rp+=this.printEmail(Fl.emails),Rp+=this.printPhone(Fl.phones),Rp+=this.printConnection(Fl.connection),Rp+=this.printBandwidth(Fl.bandwidths),Rp+=this.printTimeFields(Fl.timeFields),Rp+=this.printKey(Fl.key),Rp+=this.printSessionAttributes(Fl.attributes),Rp+=this.printMediaDescription(Fl.mediaDescriptions),Rp}printVersion(Fl){return"v=".concat(Fl).concat(this.eol)}printOrigin(Fl){return"o=".concat(Fl.username," ").concat(Fl.sessId," ").concat(Fl.sessVersion," ").concat(Fl.nettype," ").concat(Fl.addrtype," ").concat(Fl.unicastAddress).concat(this.eol)}printSessionName(Fl){return Fl?"s=".concat(Fl).concat(this.eol):""}printInformation(Fl){return Fl?"i=".concat(Fl).concat(this.eol):""}printUri(Fl){return Fl?"u=".concat(Fl).concat(this.eol):""}printEmail(Fl){let _h="";for(const Rp of Fl)_h+="e=".concat(Rp).concat(this.eol);return _h}printPhone(Fl){let _h="";for(const Rp of Fl)_h+="e=".concat(Rp).concat(this.eol);return _h}printConnection(Fl){return Fl?"c=".concat(Fl.nettype," ").concat(Fl.addrtype," ").concat(Fl.address).concat(this.eol):""}printBandwidth(Fl){let _h="";for(const Rp of Fl)_h+="b=".concat(Rp.bwtype,":").concat(Rp.bandwidth).concat(this.eol);return _h}printTimeFields(Fl){let _h="";for(const Rp of Fl){_h+="t=".concat(Rp.time.startTime," ").concat(Rp.time.startTime).concat(this.eol);for(const zp of Rp.repeats)_h+="r=".concat(zp.repeatInterval," ").concat(zp.typedTimes.join(" ")).concat(this.eol);Rp.zoneAdjustments&&(_h+="z=",_h+="z=".concat(Rp.zoneAdjustments.map(zp=>"".concat(zp.time," ").concat(zp.back?"-":""," ").concat(zp.typedTime)).join(" ")).concat(this.eol),_h+=this.eol)}return _h}printKey(Fl){return Fl?"k=".concat(Fl).concat(this.eol):""}printAttributes(Fl){let _h="";for(const Rp of Fl)_h+="a=".concat(Rp.attField).concat(Rp.attValue?":".concat(Rp.attValue):"").concat(this.eol);return _h}printMediaDescription(Fl){let _h="";for(const Rp of Fl)_h+=this.printMedia(Rp.media),_h+=this.printInformation(Rp.information),_h+=this.printConnections(Rp.connections),_h+=this.printBandwidth(Rp.bandwidths),_h+=this.printKey(Rp.key),_h+=this.printMediaAttributes(Rp);return _h}printConnections(Fl){let _h="";for(const Rp of Fl)_h+=this.printConnection(Rp);return _h}printMedia(Fl){return"m=".concat(Fl.mediaType," ").concat(Fl.port," ").concat(Fl.protos.join("/")," ").concat(Fl.fmts.join(" ")).concat(this.eol)}printSessionAttributes(Fl){return new Jp(this.eol).print(Fl)}printMediaAttributes(Fl){return new s0(this.eol).print(Fl)}}class Vp{constructor(Fl){zy(this,"eol",void 0),this.eol=Fl}printIceUfrag(Fl){return Fl===void 0?"":"a=ice-ufrag:".concat(Fl).concat(this.eol)}printIcePwd(Fl){return Fl===void 0?"":"a=ice-pwd:".concat(Fl).concat(this.eol)}printIceOptions(Fl){return Fl===void 0?"":"a=ice-options:".concat(Fl.join(xl)).concat(this.eol)}printFingerprints(Fl){return Fl.length>0?Fl.map(_h=>"a=fingerprint:".concat(_h.hashFunction).concat(xl).concat(_h.fingerprint)).join(this.eol)+this.eol:""}printExtmap(Fl){return Fl.map(_h=>"a=extmap:".concat(_h.entry).concat(_h.direction?"/".concat(_h.direction):"").concat(xl).concat(_h.extensionName).concat(_h.extensionAttributes?"".concat(xl).concat(_h.extensionAttributes):"").concat(this.eol)).join("")}printSetup(Fl){return Fl===void 0?"":"a=setup:".concat(Fl).concat(this.eol)}printUnrecognized(Fl){return Fl.map(_h=>"a=".concat(_h.attField).concat(_h.attValue?":".concat(_h.attValue):"").concat(this.eol)).join("")}}class Jp extends Vp{print(Fl){let _h="";return _h+=this.printGroups(Fl.groups),_h+=this.printMsidSemantic(Fl.msidSemantic),_h+=this.printIceLite(Fl.iceLite),_h+=this.printIceUfrag(Fl.iceUfrag),_h+=this.printIcePwd(Fl.icePwd),_h+=this.printIceOptions(Fl.iceOptions),_h+=this.printFingerprints(Fl.fingerprints),_h+=this.printSetup(Fl.setup),_h+=this.printTlsId(Fl.tlsId),_h+=this.printIdentity(Fl.identities),_h+=this.printExtmap(Fl.extmaps),_h+=this.printUnrecognized(Fl.unrecognized),_h}printGroups(Fl){let _h="";return Fl.length>0&&(_h+=Fl.map(Rp=>"a=group:".concat(Rp.semantic).concat(Rp.identificationTag.map(zp=>"".concat(xl).concat(zp)).join("")).concat(this.eol)).join("")),_h}printIceLite(Fl){return Fl===void 0?"":"a=ice-lite"+this.eol}printTlsId(Fl){return Fl?"a=tls-id:".concat(Fl).concat(this.eol):""}printIdentity(Fl){return Fl.length===0?"":Fl.map(_h=>"a=identity:".concat(_h.assertionValue).concat(_h.extensions.map(Rp=>"".concat(xl).concat(Rp.name).concat(Rp.value?"=".concat(Rp.value):"")))).join(this.eol)+this.eol}printMsidSemantic(Fl){if(!Fl)return"";let _h="a=msid-semantic:".concat(Fl.semantic);return Fl.applyForAll?_h+="".concat(xl,"*"):Fl.identifierList.length>0&&(_h+=Fl.identifierList.map(Rp=>"".concat(xl).concat(Rp))),_h+this.eol}}class s0 extends Vp{print(Fl){const _h=Fl.attributes;let Rp="";return Rp+=this.printRTCP(_h.rtcp),Rp+=this.printIceUfrag(_h.iceUfrag),Rp+=this.printIcePwd(_h.icePwd),Rp+=this.printIceOptions(_h.iceOptions),Rp+=this.printCandidates(_h.candidates),Rp+=this.printRemoteCandidatesList(_h.remoteCandidatesList),Rp+=this.printEndOfCandidates(_h.endOfCandidates),Rp+=this.printFingerprints(_h.fingerprints),Rp+=this.printSetup(_h.setup),Rp+=this.printMid(_h.mid),Rp+=this.printExtmap(_h.extmaps),Rp+=this.printRTPRelated(_h),Rp+=this.printPtime(_h.ptime),Rp+=this.printMaxPtime(_h.maxPtime),Rp+=this.printDirection(_h.direction),Rp+=this.printSSRCGroups(_h.ssrcGroups),Rp+=this.printSSRC(_h.ssrcs),Rp+=this.printRTCPMux(_h.rtcpMux),Rp+=this.printRTCPMuxOnly(_h.rtcpMuxOnly),Rp+=this.printRTCPRsize(_h.rtcpRsize),Rp+=this.printMSId(_h.msids),Rp+=this.printImageattr(_h.imageattr),Rp+=this.printRid(_h.rids),Rp+=this.printSimulcast(_h.simulcast),Rp+=this.printSCTPPort(_h.sctpPort),Rp+=this.printMaxMessageSize(_h.maxMessageSize),Rp+=this.printUnrecognized(_h.unrecognized),Rp}printCandidates(Fl){return Fl.map(_h=>"a=candidate:".concat(_h.foundation).concat(xl).concat(_h.componentId).concat(xl).concat(_h.transport).concat(xl).concat(_h.priority).concat(xl).concat(_h.connectionAddress).concat(xl).concat(_h.port).concat(xl,"typ").concat(xl).concat(_h.type).concat(_h.relAddr?"".concat(xl,"raddr").concat(xl).concat(_h.relAddr):"").concat(_h.relPort?"".concat(xl,"rport").concat(xl).concat(_h.relPort):"").concat(Object.keys(_h.extension).map(Rp=>"".concat(xl).concat(Rp).concat(xl).concat(_h.extension[Rp])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(Fl){return Fl.map(_h=>"a=remote-candidates:".concat(_h.join(xl)).concat(this.eol)).join("")}printEndOfCandidates(Fl){return Fl===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(Fl){if(!Fl.payloads)return"";const _h=Fl.payloads;let Rp="";Rp+=Fl.rtcpFeedbackWildcards.map(zp=>this.printRTCPFeedback("*",zp)).join("");for(const zp of _h)Rp+=this.printRtpMap(zp.payloadType,zp.rtpMap),Rp+=this.printFmtp(zp.payloadType,zp.fmtp),Rp+=zp.rtcpFeedbacks.map(x0=>this.printRTCPFeedback(zp.payloadType,x0)).join("");return Rp}printFmtp(Fl,_h){if(!_h)return"";const Rp=Object.keys(_h.parameters);return Rp.length===1&&_h.parameters[Rp[0]]===null?"a=fmtp:".concat(Fl).concat(xl).concat(Rp[0]).concat(this.eol):"a=fmtp:".concat(Fl).concat(xl).concat(Object.keys(_h.parameters).map(zp=>"".concat(zp,"=").concat(_h.parameters[zp])).join(";")).concat(this.eol)}printRtpMap(Fl,_h){return _h?"a=rtpmap:".concat(Fl).concat(xl).concat(_h.encodingName,"/").concat(_h.clockRate).concat(_h.encodingParameters?"/".concat(_h.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(Fl,_h){let Rp="a=rtcp-fb:".concat(Fl).concat(xl),zp=_h;switch(zp.type){case"trr-int":Rp+="ttr-int".concat(xl).concat(zp.interval);break;case"ack":case"nack":default:zp=zp,Rp+="".concat(zp.type),zp.parameter&&(Rp+="".concat(xl).concat(zp.parameter),zp.additional&&(Rp+="".concat(xl).concat(zp.additional)))}return Rp+this.eol}printPtime(Fl){return Fl===void 0?"":"a=ptime:".concat(Fl).concat(this.eol)}printMaxPtime(Fl){return Fl===void 0?"":"a=maxptime:".concat(Fl).concat(this.eol)}printDirection(Fl){return Fl===void 0?"":"a=".concat(Fl).concat(this.eol)}printSSRC(Fl){return Fl.map(_h=>Object.keys(_h.attributes).map(Rp=>"a=ssrc:".concat(_h.ssrcId.toString(10)).concat(xl).concat(Rp).concat(_h.attributes[Rp]?":".concat(_h.attributes[Rp]):"").concat(this.eol)).join("")).join("")}printRTCPMux(Fl){return Fl===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(Fl){return Fl===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(Fl){return Fl===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(Fl){if(Fl===void 0)return"";let _h="a=rtcp:".concat(Fl.port);return Fl.netType&&(_h+="".concat(xl).concat(Fl.netType)),Fl.addressType&&(_h+="".concat(xl).concat(Fl.addressType)),Fl.address&&(_h+="".concat(xl).concat(Fl.address)),_h+this.eol}printMSId(Fl){return Fl.map(_h=>"a=msid:".concat(_h.id).concat(_h.appdata?"".concat(xl).concat(_h.appdata):"").concat(this.eol)).join("")}printImageattr(Fl){return Fl.map(_h=>"a=imageattr:".concat(_h).concat(this.eol)).join("")}printRid(Fl){return Fl.map(_h=>{let Rp="a=rid:".concat(_h.id).concat(xl).concat(_h.direction);return _h.payloads&&(Rp+="".concat(xl,"pt=").concat(_h.payloads.join(","))),_h.params.length>0&&(Rp+="".concat(xl).concat(_h.params.map(zp=>zp.type==="depend"?"depend=".concat(zp.rids.join(",")):"".concat(zp.type,"=").concat(zp.val)).join(";"))),Rp+this.eol}).join("")}printSimulcast(Fl){return Fl===void 0?"":"a=simulcast:".concat(Fl).concat(this.eol)}printSCTPPort(Fl){return Fl===void 0?"":"a=sctp-port:".concat(Fl).concat(this.eol)}printMaxMessageSize(Fl){return Fl===void 0?"":"a=max-message-size:".concat(Fl).concat(this.eol)}printMid(Fl){return Fl===void 0?"":"a=mid:".concat(Fl).concat(this.eol)}printSSRCGroups(Fl){return Fl.map(_h=>"a=ssrc-group:".concat(_h.semantic).concat(_h.ssrcIds.map(Rp=>"".concat(xl).concat(Rp.toString(10))).join("")).concat(this.eol)).join("")}}function O0(_m){return new Oy().parse(_m)}function Z0(_m,Fl){return new RT().print(_m,Fl)}}},_o={};function _a(_u){if(_o[_u])return _o[_u].exports;var yl=_o[_u]={exports:{}};return _r[_u](yl,yl.exports,_a),yl.exports}return _a.d=(_u,yl)=>{for(var Rl in yl)_a.o(yl,Rl)&&!_a.o(_u,Rl)&&Object.defineProperty(_u,Rl,{enumerable:!0,get:yl[Rl]})},_a.o=(_u,yl)=>Object.prototype.hasOwnProperty.call(_u,yl),_a.r=_u=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(_u,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(_u,"__esModule",{value:!0})},_a(8)})()})(o_);class cre{constructor(_t){Ml(this,"sessionDesc",void 0),Ml(this,"localCapabilities",void 0),Ml(this,"rtpCapabilities",void 0),Ml(this,"candidates",void 0),Ml(this,"iceParameters",void 0),Ml(this,"dtlsParameters",void 0),Ml(this,"setup",void 0),Ml(this,"currentMidIndex",void 0),Ml(this,"cname",void 0),_t=r_(_t);const{remoteIceParameters:_r,remoteDtlsParameters:_o,candidates:_a,remoteRTPCapabilities:_u,remoteSetup:yl,localCapabilities:Rl,sdkCodec:Al,cname:Ol}=_t,xl=o_.exports.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=_u,this.candidates=_a,this.iceParameters=_r,this.dtlsParameters=_o,this.setup=yl,this.localCapabilities=Rl,this.cname=Ol;for(let Ll=0;Ll<xl.mediaDescriptions.length;Ll++){const Bl=xl.mediaDescriptions[Ll];if(Bl.attributes.iceUfrag=_r.iceUfrag,Bl.attributes.icePwd=_r.icePwd,Bl.attributes.fingerprints=_o.fingerprints,Bl.attributes.candidates=_a,Bl.attributes.setup=yl,Bl.media.mediaType==="video"){Bl.media.fmts=_u.videoCodecs.map(up=>up.payloadType.toString(10));const Hl=_u.videoCodecs.filter(up=>{var _f;return(_f=up.rtpMap)===null||_f===void 0?void 0:_f.encodingName.toLowerCase().includes(Al)});if(Hl.length===0)throw new Error("Codec ".concat(Al," not supported by remote SDP."));Bl.attributes.payloads=Hl,Bl.attributes.extmaps=_u.videoExtensions}Bl.media.mediaType==="audio"&&(Bl.media.fmts=_u.audioCodecs.map(Hl=>Hl.payloadType.toString(10)),Bl.attributes.payloads=_u.audioCodecs,Bl.attributes.extmaps=_u.audioExtensions),xl.mediaDescriptions[Ll]=this.mungMediaDesc(Bl)}this.sessionDesc=xl,this.currentMidIndex=xl.mediaDescriptions.length-1}toString(){return o_.exports.print(this.sessionDesc)}send(_t,_r,_o){const{ssrcs:_a,ssrcGroups:_u}=hS(_r,this.cname),yl=this.sessionDesc.mediaDescriptions.find(Ol=>_t===P0.VIDEO?Ol.media.mediaType==="video":Ol.media.mediaType==="audio"),Rl=_a[0].attributes.label,Al=_a[0].attributes.mslabel;return yl.attributes.ssrcs=yl.attributes.ssrcs.concat(_a),yl.attributes.ssrcGroups=yl.attributes.ssrcGroups.concat(_u),{id:Rl,mslabel:Al}}batchSend(_t){return _t.map(_r=>{let{kind:_o,ssrcMsg:_a}=_r;return this.send(_o,_a,void 0)})}stopSending(_t){this.sessionDesc.mediaDescriptions.forEach(_r=>{const _o=[],_a=[],_u=[];_r.attributes.ssrcs.forEach(yl=>{_t.includes(yl.attributes.label||"")?_u.push(yl):_o.push(yl)}),_r.attributes.ssrcGroups.forEach(yl=>{_u.map(Rl=>Rl.ssrcId).includes(yl.ssrcIds[0])||_a.push(yl)}),_r.attributes.ssrcs=_o,_r.attributes.ssrcGroups=_a})}mute(_t){const _r=this.sessionDesc.mediaDescriptions.find(_o=>_o.attributes.mid===_t);if(!_r)throw new Error("mediaDescription not found with ".concat(_t," in remote SDP when calling RemoteSDP.mute."));_r.attributes.direction="inactive"}unmute(_t){const _r=this.sessionDesc.mediaDescriptions.find(_o=>_o.attributes.mid===_t);if(!_r)throw new Error("mediaDescription not found with ".concat(_t," in remote SDP when calling RemoteSDP.unmute."));_r.attributes.direction="sendonly"}receive(_t,_r,_o){_t.forEach((_a,_u)=>{const yl=_a._mediaStreamTrack,Rl=this.sessionDesc.mediaDescriptions.findIndex(Ol=>Ol.attributes.mid===yl.kind),Al=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[Rl],_a);this.sessionDesc.mediaDescriptions[Rl]=Al})}stopReceiving(_t){}restartICE(_t){_t=r_(_t),this.iceParameters=_t,this.sessionDesc.mediaDescriptions.forEach(_r=>{_r.attributes.iceUfrag=_t.iceUfrag,_r.attributes.icePwd=_t.icePwd})}predictReceivingMids(_t){const _r=[];for(let _o=0;_o<_t;_o++)_r.push((this.currentMidIndex+_o+1).toString(10));return _r}mungRecvMediaDsec(_t,_r){const _o=r_(_t);return EN(_o,_r),f$(_o,_r),_o}updateRecvMedia(_t,_r){const _o=this.sessionDesc.mediaDescriptions.findIndex(_a=>_a.attributes.mid===_t);if(_o!==-1){const _a=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[_o],_r);this.sessionDesc.mediaDescriptions[_o]=_a}}bumpMid(_t){this.currentMidIndex+=_t}updateTrackLabel(_t,_r,_o){const _a=this.sessionDesc.mediaDescriptions.find(yl=>_t===P0.VIDEO?yl.attributes.mid==="video":yl.attributes.mid==="audio");if(_a){const yl=_a.attributes.ssrcs.find(Rl=>Rl.attributes.label===_r);var _u;yl&&(yl.attributes.label=_o,(_u=yl.attributes.msid)===null||_u===void 0||_u.replace(_r,_o))}}mungMediaDesc(_t){const _r=r_(_t);return h$(_r),function(_o){const _a=_o.attributes.extmaps.find(_u=>_u.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");_a&&_o.attributes.extmaps.splice(_o.attributes.extmaps.indexOf(_a),1),_o.attributes.payloads.forEach(_u=>{const yl=_u.rtcpFeedbacks.findIndex(Rl=>Rl.type==="transport-cc");yl!==-1&&_u.rtcpFeedbacks.splice(yl,1)})}(_r),_r}getSSRC(_t){for(const _r of this.sessionDesc.mediaDescriptions)for(const _o of _r.attributes.ssrcs)if(_o.attributes.label===_t)return[_o]}}function OS(_e){if(Array.isArray(_e))return _e.map(_r=>_r);if(!_z(_e))return _e;const _t={};for(const _r in _e)_z(_e[_r])||Array.isArray(_e[_r])?_t[_r]=OS(_e[_r]):_t[_r]=_e[_r];return _t}function _z(_e){return!(typeof _e!="object"||Array.isArray(_e)||!_e)}function ure(){const _e=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return _e&&_e[0]?Number(_e[0].split("/")[1]):null}function lre(_e){return window.RTCStatsReport?_e.getStats()instanceof u0:!1}class g${constructor(_t){Ml(this,"input",[]),Ml(this,"size",void 0),this.size=_t}add(_t){this.input.push(_t),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}}const bz={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},R2={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:bz,remoteCandidate:bz}},Az={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0},Iz={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,qpSumPerFrame:0},wz={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0},Cz={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0};class m${constructor(_t,_r){Ml(this,"onFirstVideoReceived",void 0),Ml(this,"onFirstVideoDecoded",void 0),Ml(this,"onFirstAudioReceived",void 0),Ml(this,"onFirstVideoDecodedTimeout",void 0),Ml(this,"onFirstAudioDecoded",void 0),Ml(this,"onSelectedLocalCandidateChanged",void 0),Ml(this,"onSelectedRemoteCandidateChanged",void 0),Ml(this,"videoIsReady",!1),Ml(this,"videoIsReady2",{}),Ml(this,"pc",void 0),Ml(this,"options",void 0),Ml(this,"intervalTimer",void 0),Ml(this,"stats",OS(R2)),Ml(this,"isFirstVideoReceived",{}),Ml(this,"isFirstVideoDecoded",{}),Ml(this,"isFirstAudioReceived",{}),Ml(this,"isFirstAudioDecoded",{}),Ml(this,"isFirstVideoDecodedTimeout",{}),Ml(this,"lossRateWindowStats",[]),this.pc=_t,this.options=_r,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}setVideoIsReady(_t){this.videoIsReady=_t}setVideoIsReady2(_t,_r){this.videoIsReady2[_t]=_r}getVideoIsReady(_t){return this.videoIsReady2[_t]||!1}setIsFirstAudioDecoded(_t){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(_t){this.lossRateWindowStats.push(_t),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const _r=this.lossRateWindowStats.length,_o=["videoSend","audioSend","videoRecv","audioRecv"];let _a=0,_u=0,yl=0,Rl=0;for(const Al of _o)_t[Al].forEach((Ol,xl)=>{if(!this.lossRateWindowStats[_r-1][Al][xl]||!this.lossRateWindowStats[0][Al][xl])return;const Ll=this.lossRateWindowStats[_r-1][Al][xl].packets-this.lossRateWindowStats[0][Al][xl].packets,Bl=this.lossRateWindowStats[_r-1][Al][xl].packetsLost-this.lossRateWindowStats[0][Al][xl].packetsLost;Al==="videoSend"||Al==="audioSend"?(_a+=Ll,yl+=Bl):(_u+=Ll,Rl+=Bl),Number.isNaN(Ll)||Number.isNaN(Ll)?Ol.packetLostRate=0:Ol.packetLostRate=Ll<=0||Bl<=0?0:Bl/(Ll+Bl)});_t.sendPacketLossRate=_a<=0||yl<=0?0:yl/(_a+yl),_t.recvPacketLossRate=_u<=0||Rl<=0?0:Rl/(_u+Rl)}}function xz(_e,_t){var _r=Object.keys(_e);if(Object.getOwnPropertySymbols){var _o=Object.getOwnPropertySymbols(_e);_t&&(_o=_o.filter(function(_a){return Object.getOwnPropertyDescriptor(_e,_a).enumerable})),_r.push.apply(_r,_o)}return _r}function dre(_e){for(var _t=1;_t<arguments.length;_t++){var _r=arguments[_t]!=null?arguments[_t]:{};_t%2?xz(Object(_r),!0).forEach(function(_o){Ml(_e,_o,_r[_o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_e,Object.getOwnPropertyDescriptors(_r)):xz(Object(_r)).forEach(function(_o){Object.defineProperty(_e,_o,Object.getOwnPropertyDescriptor(_r,_o))})}return _e}class hre extends m${constructor(){super(...arguments),Ml(this,"_stats",R2),Ml(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const _t=await this._getStats(),_r=this.statsResponsesToObjects(_t);this._stats=OS(R2);const _o=_r.filter(_u=>_u.type==="ssrc");this.processSSRCStats(_o);const _a=_r.find(_u=>_u.type==="VideoBwe");_a&&this.processBandwidthStats(_a),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(_t){this._stats.bitrate={actualEncoded:Number(_t.googActualEncBitrate),targetEncoded:Number(_t.googTargetEncBitrate),retransmit:Number(_t.googRetransmitBitrate),transmit:Number(_t.googTransmitBitrate)},this._stats.sendBandwidth=Number(_t.googAvailableSendBandwidth)}processSSRCStats(_t){_t.forEach(_r=>{const _o=_r.id.includes("send");switch("".concat(_r.mediaType,"_").concat(_o?"send":"recv")){case"video_send":{const _a=OS(Iz);_a.codec=_r.googCodecName,_a.adaptionChangeReason="none",_r.googCpuLimitedResolution&&(_a.adaptionChangeReason="cpu"),_r.googBandwidthLimitedResolution&&(_a.adaptionChangeReason="bandwidth"),_a.avgEncodeMs=Number(_r.googAvgEncodeMs),_a.inputFrame={width:Number(_r.googFrameWidthInput)||Number(_r.googFrameWidthSent),height:Number(_r.googFrameHeightInput)||Number(_r.googFrameHeightSent),frameRate:Number(_r.googFrameRateInput)},_a.sentFrame={width:Number(_r.googFrameWidthSent),height:Number(_r.googFrameHeightSent),frameRate:Number(_r.googFrameRateInput)},_a.firsCount=Number(_r.googFirReceived),_a.nacksCount=Number(_r.googNacksReceived),_a.plisCount=Number(_r.googPlisReceived),_a.frameCount=Number(_r.framesEncoded),_a.bytes=Number(_r.bytesSent),_a.packets=Number(_r.packetsSent),_a.packetsLost=Number(_r.packetsLost),_a.ssrc=Number(_r.ssrc),_a.rttMs=Number(_r.googRtt||0),this._stats.videoSend.push(_a),this._stats.rtt=_a.rttMs;break}case"video_recv":{const _a=OS(Az),_u=this.lastDecodeVideoReceiverStats.get(Number(_r.ssrc));if(_a.codec=_r.googCodecName,_a.targetDelayMs=Number(_r.googTargetDelayMs),_a.renderDelayMs=Number(_r.googRenderDelayMs),_a.currentDelayMs=Number(_r.googCurrentDelayMs),_a.minPlayoutDelayMs=Number(_r.googMinPlayoutDelayMs),_a.decodeMs=Number(_r.googDecodeMs),_a.maxDecodeMs=Number(_r.googMaxDecodeMs),_a.receivedFrame={width:Number(_r.googFrameWidthReceived),height:Number(_r.googFrameHeightReceived),frameRate:Number(_r.googFrameRateReceived)},_a.decodedFrame={width:Number(_r.googFrameWidthReceived),height:Number(_r.googFrameHeightReceived),frameRate:Number(_r.googFrameRateDecoded)},_a.decodeFrameRate=Number(_r.googFrameRateDecoded),_a.outputFrame={width:Number(_r.googFrameWidthReceived),height:Number(_r.googFrameHeightReceived),frameRate:Number(_r.googFrameRateOutput)},_a.jitterBufferMs=Number(_r.googJitterBufferMs),_a.firsCount=Number(_r.googFirsSent),_a.nacksCount=Number(_r.googNacksSent),_a.plisCount=Number(_r.googPlisSent),_a.framesDecodeCount=Number(_r.framesDecoded),_a.bytes=Number(_r.bytesReceived),_a.packets=Number(_r.packetsReceived),_a.packetsLost=Number(_r.packetsLost),_a.ssrc=Number(_r.ssrc),_a.packets>0&&!this.isFirstVideoReceived[_a.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(_a.ssrc),this.isFirstVideoReceived[_a.ssrc]=!0),_a.framesDecodeCount>0&&!this.isFirstVideoDecoded[_a.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(_a.ssrc,_a.decodedFrame.width,_a.decodedFrame.height),this.isFirstVideoDecoded[_a.ssrc]=!0),_u){const yl=_u.stats,Rl=Date.now()-_u.lts;_a.framesDecodeFreezeTime=yl.framesDecodeFreezeTime,_a.framesDecodeInterval=yl.framesDecodeInterval,_a.framesDecodeCount>yl.framesDecodeCount&&this.isFirstVideoDecoded[_a.ssrc]?(_u.lts=Date.now(),_a.framesDecodeInterval=Rl,_a.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(_r.ssrc,10))?_a.framesDecodeFreezeTime+=_a.framesDecodeInterval:this.setVideoIsReady2(parseInt(_r.ssrc,10),!0))):_a.framesDecodeCount<_u.stats.framesDecodeCount&&(_a.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(_a.ssrc,{stats:dre({},_a),lts:Date.now()}),this._stats.videoRecv.push(_a);break}case"audio_recv":{const _a=OS(Cz);_a.codec=_r.googCodecName,_a.outputLevel=Math.abs(Number(_r.audioOutputLevel))/32767,_a.decodingCNG=Number(_r.googDecodingCNG),_a.decodingCTN=Number(_r.googDecodingCTN),_a.decodingCTSG=Number(_r.googDecodingCTSG),_a.decodingNormal=Number(_r.googDecodingNormal),_a.decodingPLC=Number(_r.googDecodingPLC),_a.decodingPLCCNG=Number(_r.googDecodingPLCCNG),_a.expandRate=Number(_r.googExpandRate),_a.accelerateRate=Number(_r.googAccelerateRate),_a.preemptiveExpandRate=Number(_r.googPreemptiveExpandRate),_a.secondaryDecodedRate=Number(_r.googSecondaryDecodedRate),_a.speechExpandRate=Number(_r.googSpeechExpandRate),_a.preferredJitterBufferMs=Number(_r.googPreferredJitterBufferMs),_a.jitterBufferMs=Number(_r.googJitterBufferMs),_a.jitterMs=Number(_r.googJitterReceived),_a.bytes=Number(_r.bytesReceived),_a.packets=Number(_r.packetsReceived),_a.packetsLost=Number(_r.packetsLost),_a.ssrc=Number(_r.ssrc),_a.receivedFrames=Number(_r.googDecodingCTN)||Number(_r.packetsReceived),_a.droppedFrames=Number(_r.googDecodingPLC)+Number(_r.googDecodingPLCCNG)||Number(_r.packetsLost),_a.receivedFrames>0&&!this.isFirstAudioReceived[_a.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(_a.ssrc),this.isFirstAudioReceived[_a.ssrc]=!0),_a.decodingNormal>0&&!this.isFirstAudioDecoded[_a.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(_a.ssrc),this.isFirstAudioDecoded[_a.ssrc]=!0),this._stats.audioRecv.push(_a);break}case"audio_send":{const _a=OS(wz);_a.codec=_r.googCodecName,_a.inputLevel=Math.abs(Number(_r.audioInputLevel))/32767,_a.aecReturnLoss=Number(_r.googEchoCancellationReturnLoss||0),_a.aecReturnLossEnhancement=Number(_r.googEchoCancellationReturnLossEnhancement||0),_a.residualEchoLikelihood=Number(_r.googResidualEchoLikelihood||0),_a.residualEchoLikelihoodRecentMax=Number(_r.googResidualEchoLikelihoodRecentMax||0),_a.bytes=Number(_r.bytesSent),_a.packets=Number(_r.packetsSent),_a.packetsLost=Number(_r.packetsLost),_a.ssrc=Number(_r.ssrc),_a.rttMs=Number(_r.googRtt||0),this._stats.rtt=_a.rttMs,this._stats.audioSend.push(_a);break}}})}_getStats(){return new u0((_t,_r)=>{this.pc.getStats(_t,_r)})}statsResponsesToObjects(_t){const _r=[];return _t.result().forEach(_o=>{const _a={id:_o.id,timestamp:_o.timestamp.valueOf().toString(),type:_o.type};_o.names().forEach(_u=>{_a[_u]=_o.stat(_u)}),_r.push(_a)}),_r}}function kz(_e,_t){var _r=Object.keys(_e);if(Object.getOwnPropertySymbols){var _o=Object.getOwnPropertySymbols(_e);_t&&(_o=_o.filter(function(_a){return Object.getOwnPropertyDescriptor(_e,_a).enumerable})),_r.push.apply(_r,_o)}return _r}function A2(_e){for(var _t=1;_t<arguments.length;_t++){var _r=arguments[_t]!=null?arguments[_t]:{};_t%2?kz(Object(_r),!0).forEach(function(_o){Ml(_e,_o,_r[_o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_e,Object.getOwnPropertyDescriptors(_r)):kz(Object(_r)).forEach(function(_o){Object.defineProperty(_e,_o,Object.getOwnPropertyDescriptor(_r,_o))})}return _e}class Lz extends m${constructor(){super(...arguments),Ml(this,"_stats",R2),Ml(this,"report",void 0),Ml(this,"lastDecodeVideoReceiverStats",new Map),Ml(this,"lastVideoFramesRecv",new Map),Ml(this,"lastVideoFramesSent",new Map),Ml(this,"lastVideoFramesDecode",new Map),Ml(this,"lastVideoJBDelay",new Map),Ml(this,"lastAudioJBDelay",new Map),Ml(this,"mediaBytesSent",new Map),Ml(this,"mediaBytesRetransmit",new Map),Ml(this,"mediaBytesTargetEncode",new Map),Ml(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=OS(R2),this.report.forEach(_t=>{switch(_t.type){case bS.OUTBOUND:_t.mediaType==="audio"?this.processAudioOutboundStats(_t):_t.mediaType==="video"&&this.processVideoOutboundStats(_t);break;case bS.INBOUND:_t.mediaType==="audio"?this.processAudioInboundStats(_t):_t.mediaType==="video"&&this.processVideoInboundStats(_t);break;case bS.TRANSPORT:{const _r=this.report.get(_t.selectedCandidatePairId);_r&&this.processCandidatePairStats(_r);break}case bS.CANDIDATE_PAIR:_t.selected&&this.processCandidatePairStats(_t)}}),this.updateSendBitrate(),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processCandidatePairStats(_t){if(this._stats.sendBandwidth=_t.availableOutgoingBitrate||0,_t.currentRoundTripTime&&(this._stats.rtt=1e3*_t.currentRoundTripTime),this._stats.videoSend.forEach(_r=>{_t.currentRoundTripTime&&(_r.rttMs=1e3*_t.currentRoundTripTime)}),this._stats.audioSend.forEach(_r=>{_t.currentRoundTripTime&&(_r.rttMs=1e3*_t.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=_t.id,_t.localCandidateId){const _r=this.report.get(_t.localCandidateId);_r&&this.processCandidateStats(_r)}if(_t.remoteCandidateId){const _r=this.report.get(_t.remoteCandidateId);_r&&this.processCandidateStats(_r)}}processCandidateStats(_t){let _r;_t.type===bS.LOCAL_CANDIDATE&&(_r=this._stats.selectedCandidatePair.localCandidate),_t.type===bS.REMOTE_CANDIDATE&&(_r=this._stats.selectedCandidatePair.remoteCandidate),_r&&(_r.type=_t.type,_r.id=_t.id,_t.address&&(_r.address=_t.address),_t.candidateType&&(_r.candidateType=_t.candidateType),_t.port&&(_r.port=_t.port),_t.priority&&(_r.priority=_t.priority),_t.protocol&&(_r.protocol=_t.protocol),_t.relayProtocol&&(_r.relayProtocol=_t.relayProtocol),_t.type===bS.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==_r.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(A2({},_r),A2({},this.stats.selectedCandidatePair.localCandidate)),_t.type===bS.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==_r.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(A2({},_r),A2({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(_t){let _r=this._stats.audioRecv.find(_o=>_o.ssrc===_t.ssrc);_r||(_r=OS(Cz),this._stats.audioRecv.push(_r)),_r.ssrc=_t.ssrc,_r.packets=_t.packetsReceived,_r.packetsLost=_t.packetsLost,_r.bytes=_t.bytesReceived,_r.jitterMs=1e3*_t.jitter,this.processAudioTrackReceiverStats(_t,_t.trackId,_r),_t.codecId&&(_r.codec=this.getCodecFromCodecStats(_t.codecId)),_r.receivedFrames||(_r.receivedFrames=_t.packetsReceived),_r.droppedFrames||(_r.droppedFrames=_t.packetsLost),_r.receivedFrames>0&&!this.isFirstAudioReceived[_r.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(_r.ssrc),this.isFirstAudioReceived[_r.ssrc]=!0),_r.outputLevel&&_r.outputLevel>0&&!this.isFirstAudioDecoded[_r.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(_r.ssrc),this.isFirstAudioDecoded[_r.ssrc]=!0),typeof _t.concealedSamples=="number"&&(_r.concealedSamples=_t.concealedSamples)}processVideoInboundStats(_t){let _r=this._stats.videoRecv.find(yl=>yl.ssrc===_t.ssrc);_r||(_r=OS(Az),this._stats.videoRecv.push(_r)),_r.ssrc=_t.ssrc,_r.packets=_t.packetsReceived,_r.packetsLost=_t.packetsLost,_r.bytes=_t.bytesReceived,_r.firsCount=_t.firCount,_r.nacksCount=_t.nackCount,_r.plisCount=_t.pliCount,_r.framesDecodeCount=_t.framesDecoded,_r.totalInterFrameDelay=_t.totalInterFrameDelay,_r.totalSquaredInterFrameDelay=_t.totalSquaredInterFrameDelay;const _o=this.lastDecodeVideoReceiverStats.get(_r.ssrc),_a=this.lastVideoFramesDecode.get(_r.ssrc),_u=Date.now();if(_r.framesDecodeCount>0&&!this.isFirstVideoDecoded[_r.ssrc]){const yl=_r.decodedFrame?_r.decodedFrame.width:0,Rl=_r.decodedFrame?_r.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(_r.ssrc,yl,Rl),this.isFirstVideoDecoded[_r.ssrc]=!0}if(_o){const yl=_o.stats,Rl=_u-_o.lts;_r.framesDecodeFreezeTime=yl.framesDecodeFreezeTime,_r.framesDecodeInterval=yl.framesDecodeInterval,!this.isFirstVideoDecoded[_r.ssrc]&&Rl>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[_r.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(_r.ssrc),this.isFirstVideoDecodedTimeout[_r.ssrc]=!0),_r.framesDecodeCount>yl.framesDecodeCount&&this.isFirstVideoDecoded[_r.ssrc]?(_o.lts=Date.now(),_r.framesDecodeInterval=Rl,_r.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(_t.ssrc))?_r.framesDecodeFreezeTime+=_r.framesDecodeInterval:this.setVideoIsReady2(parseInt(_t.ssrc,10),!0))):_r.framesDecodeCount<yl.framesDecodeCount&&(_r.framesDecodeInterval=0),_t.framesDecoded&&_t.qpSum&&(_o.stats.framesDecodeCount>_t.framesDecoded?_r.qpSumPerFrame=_t.qpSum/_t.framesDecoded:_r.qpSumPerFrame=(_t.qpSum-_o.qpSum)/(_t.framesDecoded-_o.stats.framesDecodeCount))}_a&&_u-_a.lts>=800?(_r.decodeFrameRate=Math.round((_r.framesDecodeCount-_a.count)/((_u-_a.lts)/1e3)),this.lastVideoFramesDecode.set(_r.ssrc,{count:_r.framesDecodeCount,lts:_u,rate:_r.decodeFrameRate})):_a?_r.decodeFrameRate=_a.rate:this.lastVideoFramesDecode.set(_r.ssrc,{count:_r.framesDecodeCount,lts:_u,rate:0}),_t.totalDecodeTime&&(_r.decodeMs=1e3*_t.totalDecodeTime),this.processVideoTrackReceiverStats(_t,_t.trackId,_r),_t.codecId&&(_r.codec=this.getCodecFromCodecStats(_t.codecId)),_t.framerateMean&&(_r.framesRateFirefox=_t.framerateMean),_r.packets>0&&!this.isFirstVideoReceived[_r.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(_r.ssrc),this.isFirstVideoReceived[_r.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(_r.ssrc,{stats:A2({},_r),lts:_o?_o.lts:Date.now(),qpSum:_t.qpSum})}processVideoOutboundStats(_t){let _r=this._stats.videoSend.find(_a=>_a.ssrc===_t.ssrc);_r||(_r=OS(Iz),this._stats.videoSend.push(_r));const _o=this.mediaBytesSent.get(_t.ssrc);if(_o)_o.add(_t.bytesSent);else{const _a=new g$(10);_a.add(_t.bytesSent),this.mediaBytesSent.set(_t.ssrc,_a)}if(_t.retransmittedBytesSent!==void 0){const _a=this.mediaBytesRetransmit.get(_t.ssrc);if(_a)_a.add(_t.retransmittedBytesSent);else{const _u=new g$(10);_u.add(_t.retransmittedBytesSent),this.mediaBytesRetransmit.set(_t.ssrc,_u)}}if(_t.totalEncodedBytesTarget){const _a=this.mediaBytesTargetEncode.get(_t.ssrc);if(_a)_a.add(_t.totalEncodedBytesTarget);else{const _u=new g$(10);_u.add(_t.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(_t.ssrc,_u)}}if(_r.ssrc=_t.ssrc,_r.bytes=_t.bytesSent,_r.packets=_t.packetsSent,_r.firsCount=_t.firCount,_r.nacksCount=_t.nackCount,_r.plisCount=_t.pliCount,_r.frameCount=_t.framesEncoded,_r.adaptionChangeReason=_t.qualityLimitationReason,_t.totalEncodeTime&&_t.framesEncoded){const _a=this.lastEncoderMs.get(_t.ssrc);if(!_a||_a.lastFrameCount>_t.framesEncoded)_r.avgEncodeMs=1e3*_t.totalEncodeTime/_t.framesEncoded;else{const _u=_t.framesEncoded-_a.lastFrameCount,yl=_t.totalEncodeTime-_a.lastEncoderTime;_r.avgEncodeMs=1e3*yl/_u}}if(_t.framesEncoded&&_t.qpSum){const _a=this.lastEncoderMs.get(_t.ssrc);!_a||_a.lastFrameCount>_t.framesEncoded?_r.qpSumPerFrame=_t.qpSum/_t.framesEncoded:_r.qpSumPerFrame=(_t.qpSum-_a.lastQpSum)/(_t.framesEncoded-_a.lastFrameCount)}if(this.lastEncoderMs.set(_t.ssrc,{lastFrameCount:_t.framesEncoded,lastEncoderTime:_t.totalEncodeTime,lastQpSum:_t.qpSum,lts:Date.now()}),_t.codecId&&(_r.codec=this.getCodecFromCodecStats(_t.codecId)),_t.mediaSourceId&&this.processVideoMediaSource(_t.mediaSourceId,_r),this.processVideoTrackSenderStats(_t,_t.trackId,_r),_t.remoteId)this.processRemoteInboundStats(_t.remoteId,_r);else{const _a=this.findRemoteStatsId(_t.ssrc,bS.REMOTE_INBOUND);_a&&this.processRemoteInboundStats(_a,_r)}}processAudioOutboundStats(_t){let _r=this._stats.audioSend.find(_o=>_o.ssrc===_t.ssrc);if(_r||(_r=OS(wz),this._stats.audioSend.push(_r)),_r.ssrc=_t.ssrc,_r.packets=_t.packetsSent,_r.bytes=_t.bytesSent,_t.mediaSourceId&&this.processAudioMediaSource(_t.mediaSourceId,_r),_t.codecId&&(_r.codec=this.getCodecFromCodecStats(_t.codecId)),this.processAudioTrackSenderStats(_t,_t.trackId,_r),_t.remoteId)this.processRemoteInboundStats(_t.remoteId,_r);else{const _o=this.findRemoteStatsId(_t.ssrc,bS.REMOTE_INBOUND);_o&&this.processRemoteInboundStats(_o,_r)}}findRemoteStatsId(_t,_r){var _o;const _a=Array.from(sR(_o=this.report).call(_o)).find(_u=>_u.type===_r&&_u.ssrc===_t);return _a?_a.id:null}processVideoMediaSource(_t,_r){const _o=this.report.get(_t);_o&&_o.width&&_o.height&&_o.framesPerSecond&&(_r.inputFrame={width:_o.width,height:_o.height,frameRate:_o.framesPerSecond})}processAudioMediaSource(_t,_r){const _o=this.report.get(_t);_o&&(_r.inputLevel=_o.audioLevel)}processVideoTrackSenderStats(_t,_r,_o){var _a,_u,yl;const Rl=_r?this.report.get(_r):void 0,Al=(_a=Rl==null?void 0:Rl.framesSent)!==null&&_a!==void 0?_a:_t.framesSent;let Ol=(_u=Rl==null?void 0:Rl.frameWidth)!==null&&_u!==void 0?_u:_t.frameWidth,xl=(yl=Rl==null?void 0:Rl.frameHeight)!==null&&yl!==void 0?yl:_t.frameHeight;if(typeof Al!="number")return;Al!==0||typeof Ol=="number"&&typeof xl=="number"||(Ol=0,xl=0);let Ll=0;const Bl=Date.now(),Hl=this.lastVideoFramesSent.get(_o.ssrc);Hl&&Bl-Hl.lts>=800?(Ll=Math.round((Al-Hl.count)/((Bl-Hl.lts)/1e3)),this.lastVideoFramesSent.set(_o.ssrc,{count:Al,lts:Bl,rate:Ll})):Hl?Ll=Hl.rate:this.lastVideoFramesSent.set(_o.ssrc,{count:Al,lts:Bl,rate:0}),_o.sentFrame={width:Ol,height:xl,frameRate:Math.max(0,Ll)}}processVideoTrackReceiverStats(_t,_r,_o){var _a,_u,yl,Rl,Al;const Ol=_r?this.report.get(_r):void 0,xl=(_a=Ol==null?void 0:Ol.framesReceived)!==null&&_a!==void 0?_a:_t.framesReceived,Ll=(_u=Ol==null?void 0:Ol.frameWidth)!==null&&_u!==void 0?_u:_t.frameWidth,Bl=(yl=Ol==null?void 0:Ol.frameHeight)!==null&&yl!==void 0?yl:_t.frameHeight,Hl=(Rl=Ol==null?void 0:Ol.jitterBufferDelay)!==null&&Rl!==void 0?Rl:_t.jitterBufferDelay,up=(Al=Ol==null?void 0:Ol.jitterBufferEmittedCount)!==null&&Al!==void 0?Al:_t.jitterBufferEmittedCount;if(typeof xl=="number"){const _f=this.lastVideoFramesRecv.get(_o.ssrc),vp=Date.now();_o.framesReceivedCount=xl;let Dp=0;_f&&vp-_f.lts>=800?(Dp=Math.round((xl-_f.count)/((vp-_f.lts)/1e3)),this.lastVideoFramesRecv.set(_o.ssrc,{count:xl,lts:vp,rate:Dp})):_f?Dp=_f.rate:this.lastVideoFramesRecv.set(_o.ssrc,{count:xl,lts:vp,rate:0}),_o.receivedFrame={width:Ll||0,height:Bl||0,frameRate:Dp||0},_o.decodedFrame={width:Ll||0,height:Bl||0,frameRate:_o.decodeFrameRate||0},_o.outputFrame={width:Ll||0,height:Bl||0,frameRate:_o.decodeFrameRate||0}}if(Hl&&up){let _f=this.lastVideoJBDelay.get(_o.ssrc);this.lastVideoJBDelay.set(_o.ssrc,{jitterBufferDelay:Hl,jitterBufferEmittedCount:up}),_f||(_f={jitterBufferDelay:0,jitterBufferEmittedCount:0});const vp=1e3*(Hl-_f.jitterBufferDelay)/(up-_f.jitterBufferEmittedCount);_o.jitterBufferMs=vp,_o.currentDelayMs=Math.round(vp)}}processAudioTrackSenderStats(_t,_r,_o){var _a,_u,yl,Rl;const Al=_r?this.report.get(_r):void 0,Ol=(_a=(_u=Al==null?void 0:Al.echoReturnLoss)!==null&&_u!==void 0?_u:_t.echoReturnLoss)!==null&&_a!==void 0?_a:0,xl=(yl=(Rl=Al==null?void 0:Al.echoReturnLossEnhancement)!==null&&Rl!==void 0?Rl:_t.echoReturnLossEnhancement)!==null&&yl!==void 0?yl:0;_o.aecReturnLoss=Ol,_o.aecReturnLossEnhancement=xl}processAudioTrackReceiverStats(_t,_r,_o){var _a,_u,yl,Rl,Al,Ol,xl;const Ll=_r?this.report.get(_r):void 0,Bl=(_a=Ll==null?void 0:Ll.removedSamplesForAcceleration)!==null&&_a!==void 0?_a:_t.removedSamplesForAcceleration,Hl=(_u=Ll==null?void 0:Ll.totalSamplesReceived)!==null&&_u!==void 0?_u:_t.totalSamplesReceived,up=(yl=Ll==null?void 0:Ll.jitterBufferDelay)!==null&&yl!==void 0?yl:_t.jitterBufferDelay,_f=(Rl=Ll==null?void 0:Ll.jitterBufferEmittedCount)!==null&&Rl!==void 0?Rl:_t.jitterBufferEmittedCount,vp=(Al=Ll==null?void 0:Ll.audioLevel)!==null&&Al!==void 0?Al:_t==null?void 0:_t.audioLevel,Dp=(Ol=Ll==null?void 0:Ll.totalSamplesDuration)!==null&&Ol!==void 0?Ol:_t==null?void 0:_t.totalSamplesDuration,Bp=(xl=Ll==null?void 0:Ll.concealedSamples)!==null&&xl!==void 0?xl:_t.concealedSamples;if(Bl&&Hl&&(_o.accelerateRate=Bl/Hl),up&&_f){let y0=this.lastAudioJBDelay.get(_o.ssrc);this.lastAudioJBDelay.set(_o.ssrc,{jitterBufferDelay:up,jitterBufferEmittedCount:_f}),y0||(y0={jitterBufferDelay:0,jitterBufferEmittedCount:0});const e0=1e3*(up-y0.jitterBufferDelay)/(_f-y0.jitterBufferEmittedCount);_o.jitterBufferMs=Math.round(e0)}_o.outputLevel=vp;let _g=1920;Dp&&Hl&&(_g=Hl/Dp/50,_o.receivedFrames=Math.round(Hl/_g)),Bp&&(_o.droppedFrames=Math.round(Bp/_g))}processRemoteInboundStats(_t,_r){const _o=this.report.get(_t);_o&&(_r.packetsLost=_o.packetsLost,_o.roundTripTime&&(_r.rttMs=1e3*_o.roundTripTime))}getCodecFromCodecStats(_t){const _r=this.report.get(_t);if(!_r)return"";const _o=_r.mimeType.match(/\/(.*)$/);return _o&&_o[1]?_o[1]:""}updateSendBitrate(){let _t=0,_r=null,_o=null;this.mediaBytesSent.forEach(_u=>{_t+=_u.diffMean()}),this.mediaBytesRetransmit.forEach(_u=>{_r=_r===null?_u.diffMean():_r+_u.diffMean()}),this.mediaBytesTargetEncode.forEach(_u=>{_o=_o===null?_u.diffMean():_o+_u.diffMean()});const _a=_r!==null?_t-_r:_t;this._stats.bitrate={actualEncoded:8*_a/(this.options.updateInterval/1e3),transmit:8*_t/(this.options.updateInterval/1e3)},_r!==null&&(this._stats.bitrate.retransmit=8*_r/(this.options.updateInterval/1e3)),_o!==null&&(this._stats.bitrate.targetEncoded=8*_o/(this.options.updateInterval/1e3))}}class fre extends m${updateStats(){return u0.resolve()}}function y$(_e){let _t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,_r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,_o=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,_a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const _u=ure();return _u?_u<76?new hre(_e,{updateInterval:_t,lossRateInterval:_r,freezeRateLimit:_o,firstVideoDecodedTimeout:_a}):new Lz(_e,{updateInterval:_t,lossRateInterval:_r,freezeRateLimit:_o,firstVideoDecodedTimeout:_a}):lre(_e)?new Lz(_e,{updateInterval:_t,lossRateInterval:_r,freezeRateLimit:_o,firstVideoDecodedTimeout:_a}):new fre(_e,{updateInterval:_t,lossRateInterval:_r,freezeRateLimit:_o,firstVideoDecodedTimeout:_a})}var my;function Dz(_e,_t){var _r=Object.keys(_e);if(Object.getOwnPropertySymbols){var _o=Object.getOwnPropertySymbols(_e);_t&&(_o=_o.filter(function(_a){return Object.getOwnPropertyDescriptor(_e,_a).enumerable})),_r.push.apply(_r,_o)}return _r}function Mz(_e){for(var _t=1;_t<arguments.length;_t++){var _r=arguments[_t]!=null?arguments[_t]:{};_t%2?Dz(Object(_r),!0).forEach(function(_o){Ml(_e,_o,_r[_o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_e,Object.getOwnPropertyDescriptors(_r)):Dz(Object(_r)).forEach(function(_o){Object.defineProperty(_e,_o,Object.getOwnPropertyDescriptor(_r,_o))})}return _e}let I2=(Yp((my=class x2 extends K5{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}constructor(_t,_r){super(_t,_r),Ml(this,"store",void 0),Ml(this,"peerConnection",void 0),Ml(this,"remoteSDP",void 0),Ml(this,"initialOffer",void 0),Ml(this,"statsFilter",void 0),Ml(this,"useRTX",!1),Ml(this,"localCapabilities",void 0),Ml(this,"localCandidateCount",0),Ml(this,"allCandidatesReceived",!1),Ml(this,"establishPromise",void 0),Ml(this,"mutex",new iT("P2PConnection-mutex")),this.store=_r,this.peerConnection=new RTCPeerConnection(x2.resolvePCConfiguration(_t),{optional:[{googDscp:!0}]}),this.statsFilter=y$(this.peerConnection,void 0,void 0,Wy()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const _t=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!_t.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const _r=pO(_t.sdp),_o=d$(_t.sdp,!this.useRTX,Pp("FILTER_VIDEO_FEC"),Pp("FILTER_AUDIO_FEC"),["opus"]);return this.localCapabilities=_o,this.initialOffer=_t,Mz(Mz({},_r),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:_o},offerSDP:_t.sdp})}catch(_t){throw new Tp(Ql.GET_LOCAL_CONNECTION_PARAMS_FAILED,_t.toString())}}async connect(_t,_r,_o,_a,_u,yl){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new cre({remoteIceParameters:_t,remoteDtlsParameters:_r,candidates:_o,remoteRTPCapabilities:_a.send,remoteSetup:_u,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec,cname:yl});const Rl=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:Rl})}catch(Rl){throw new Tp(Ql.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(Rl.toString()))}}send(_t,_r){var _o=this;return wS(function*(){const _a=yield H0(_o.mutex.lock());try{if(!_o.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const _u=_t.map(Bl=>_o.peerConnection.addTrack(Bl._mediaStreamTrack)),yl=yield H0(_o.peerConnection.createOffer()),Rl=o_.exports.parse(yl.sdp),Al=_t.map(Bl=>{const Hl=Bl._mediaStreamTrack,up=Rl.mediaDescriptions.find(_f=>_f.attributes.mid===Hl.kind);if(!up)throw new Error("Cannot extract ssrc from mediaDescription.");return function(_f,vp,Dp){const Bp=_f.attributes.ssrcs.filter(y0=>y0.attributes.label===vp),_g=_f.attributes.ssrcGroups;if(Bp.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(_g&&Bp.length>1){const y0=_g.find(e0=>e0.ssrcIds.indexOf(Bp[0].ssrcId)!==-1);return y0?[{ssrcId:y0.ssrcIds[0],rtx:Dp?y0.ssrcIds[1]:void 0}]:[{ssrcId:Bp[0].ssrcId}]}return[{ssrcId:Bp[0].ssrcId}]}(up,Hl.id,_o.useRTX)});let Ol;try{Ol=yield Al}catch(Bl){throw _u.forEach(Hl=>{_b()&&Hl.replaceTrack(null),_o.peerConnection.removeTrack(Hl)}),Bl}const xl=_o.mungSendOfferSDP(yl.sdp,_t);_o.remoteSDP.receive(_t,_r,Ol);const Ll=_o.remoteSDP.toString();return yield H0(_o.peerConnection.setLocalDescription({type:"offer",sdp:xl})),yield H0(_o.applySendEncodings(_u,_t)),yield H0(_o.peerConnection.setRemoteDescription({type:"answer",sdp:Ll})),_t.map((Bl,Hl)=>{const up=Bl._mediaStreamTrack.id;return{localSSRC:Al[Hl],id:up}})}catch(_u){throw new Tp(Ql.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(_u.toString()))}finally{_a()}})()}async stopSending(_t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const _r=this.peerConnection.getSenders().filter(_u=>{var yl;return _t.indexOf(((yl=_u.track)===null||yl===void 0?void 0:yl.id)||"")!==-1});if(_r.length!==_t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");_r.map(_u=>{_b()&&_u.replaceTrack(null),this.peerConnection.removeTrack(_u)});const _o=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(_o),this.remoteSDP.stopReceiving(_t);const _a=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:_a})}catch(_r){throw new Tp(Ql.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(_r.toString()))}}async receive(_t,_r,_o,_a){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(_t," before remoteSDP created."));const{id:_u,mslabel:yl}=this.remoteSDP.send(_t,_r,_a),Rl=new u0((xl,Ll)=>{const Bl=setTimeout(()=>{Ll(new Error("Cannot receive track, id: ".concat(_u)))},1e4),Hl=up=>{const _f=gy();if((_f.name==="Safari"&&Number(_f.version)===11||eT())&&up.track.id!==_u&&up.streams[0].id===yl){var vp;const Dp=up.streams[0].getTracks()[0];return(vp=this.remoteSDP)===null||vp===void 0||vp.updateTrackLabel(_t,_u,up.track.id),this.peerConnection.removeEventListener("track",Hl),clearTimeout(Bl),void xl(Dp)}if(up.track.id===_u)return this.peerConnection.removeEventListener("track",Hl),clearTimeout(Bl),void xl(up.track)};this.peerConnection.addEventListener("track",Hl)}),Al=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:Al});const Ol=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(Ol),{track:await Rl,id:_u}}catch(_u){throw new Tp(Ql.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(_u.toString()))}}async stopReceiving(_t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(_t);const _r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:_r});const _o=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(_o)}catch(_r){throw new Tp(Ql.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(_r.toString()))}}async muteRemote(_t){}async unmuteRemote(_t){}async muteLocal(_t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const _r=this.peerConnection.getSenders().filter(_o=>{var _a;return _t.indexOf(((_a=_o.track)===null||_a===void 0?void 0:_a.id)||"")!==-1});if(_r.length!==_t.length)throw new Error("sender' length doesn't match mids' length.");_r.map(_o=>{if(_b()&&_o.track)_o.track.enabled=!1;else{const _a=_o.getParameters();_a.encodings.forEach(_u=>_u.active=!1),_o.setParameters(_a)}})}catch(_r){throw new Tp(Ql.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(_r.toString()))}}async unmuteLocal(_t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const _r=this.peerConnection.getSenders().filter(_u=>{var yl;return _t.indexOf(((yl=_u.track)===null||yl===void 0?void 0:yl.id)||"")!==-1});if(_r.length!==_t.length)throw new Error("Senders' length doesn't match mids' length.");_r.map(async _u=>{if(_b()&&_u.track)_u.track.enabled=!0;else{const yl=_u.getParameters();yl.encodings.forEach(Rl=>Rl.active=!0),await _u.setParameters(yl)}});const _o=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(_o);const _a=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:_a})}catch(_r){throw new Tp(Ql.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(_r.toString()))}}restartICE(){var _t=this;return wS(function*(){const _r=yield H0(_t.mutex.lock("From P2PConnection.restartICE"));try{const _o=yield H0(_t.peerConnection.createOffer({iceRestart:!0}));if(!_o.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const _a=pO(_o.sdp),{remoteIceParameters:_u}=yield _a.iceParameters;if(!_t.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");_t.remoteSDP.restartICE(_u);const yl=_t.remoteSDP.toString();yield H0(_t.peerConnection.setLocalDescription(_o)),yield H0(_t.peerConnection.setRemoteDescription({type:"answer",sdp:yl}))}catch(_o){Vl.warning("restart ICE failed, abort operation",_o)}finally{_r()}})()}close(){var _t;this.peerConnection.close(),(_t=this.onConnectionStateChange)===null||_t===void 0||_t.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(_t){return this.statsFilter.getVideoIsReady(_t)}async updateEncoderConfig(_t,_r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const _o=await this.peerConnection.createOffer(),_a=this.mungSendOfferSDP(_o.sdp,[_r]);this.remoteSDP.updateRecvMedia(_r._mediaStreamTrack.kind,_r);const _u=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:_a}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:_u})}catch(_o){throw new Tp(Ql.EXCHANGE_SDP_FAILED,_o.toString())}}async updateSendParameters(_t,_r){const _o=this.peerConnection.getSenders().filter(_a=>{var _u;return((_u=_a.track)===null||_u===void 0?void 0:_u.id)===_t});_o.length===1&&await this.applySendEncodings(_o,[_r])}setStatsRemoteVideoIsReady(_t,_r){this.statsFilter.setVideoIsReady2(_t,_r)}async replaceTrack(_t,_r){const _o=this.peerConnection.getSenders().find(_a=>{var _u;return((_u=_a.track)===null||_u===void 0?void 0:_u.id)===_r});_o&&await _o.replaceTrack(_t._mediaStreamTrack)}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var _t;(_t=this.onICEConnectionStateChange)===null||_t===void 0||_t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var _t;(_t=this.onConnectionStateChange)===null||_t===void 0||_t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=_t=>{_t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,Vl.debug("[pc-".concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,Vl.debug("[pc-".concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},Pp("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(_t){const _r={iceServers:[],sdpSemantics:"plan-b"};return _t.iceServers?_r.iceServers=_t.iceServers:_t.turnServer&&_t.turnServer.mode!=="off"&&(a2(_t.turnServer.servers)?_r.iceServers=_t.turnServer.servers:(_r.iceServers&&_r.iceServers.push(...x2.turnServerConfigToIceServers(_t.turnServer.servers)),Pp("USE_TURN_SERVER_OF_GATEWAY")&&_r.iceServers&&_t.turnServer.serversFromGateway&&_r.iceServers.push(...x2.turnServerConfigToIceServers(_t.turnServer.serversFromGateway)),_t.turnServer.servers.concat(_t.turnServer.serversFromGateway||[]).forEach(_o=>{_o.forceturn&&(_r.iceTransportPolicy="relay")}))),_r}static turnServerConfigToIceServers(_t){const _r=[];return _t.forEach(_o=>{_o.security?_o.tcpport&&_r.push({username:_o.username,credential:_o.password,credentialType:"password",urls:"turns:".concat(_o.turnServerURL,":").concat(_o.tcpport,"?transport=tcp")}):(_o.udpport&&_r.push({username:_o.username,credential:_o.password,credentialType:"password",urls:"turn:".concat(_o.turnServerURL,":").concat(_o.udpport,"?transport=udp")}),_o.tcpport&&_r.push({username:_o.username,credential:_o.password,credentialType:"password",urls:"turn:".concat(_o.turnServerURL,":").concat(_o.tcpport,"?transport=tcp")}))}),_r}async applySendEncodings(_t,_r){try{if(!R_().supportSetRtpSenderParameters||_t.length!==_r.length)return;for(let _a=0;_a<_t.length;_a++){var _o;const _u=_t[_a],yl=_r[_a];if(!yl)continue;const Rl={},Al={};if(yl instanceof i_)switch(yl._optimizationMode){case"motion":Rl.degradationPreference="maintain-framerate";break;case"detail":Rl.degradationPreference="maintain-resolution";break;default:Rl.degradationPreference="balanced"}if(Pp("DSCP_TYPE")&&eO()){const Ll=Pp("DSCP_TYPE");["very-low","low","medium","high"].includes(Ll)&&(Al.networkPriority=Ll)}const Ol=_u.getParameters(),xl=(_o=Ol.encodings)===null||_o===void 0?void 0:_o[0];xl&&Object.assign(xl,Al),Object.assign(Ol,Rl),await _u.setParameters(Ol)}}catch{Vl.debug("Apply RTPSendEncodings failed.")}}mungSendOfferSDP(_t,_r){const _o=o_.exports.parse(_t);return _r.forEach((_a,_u)=>{const yl=_a._mediaStreamTrack,Rl=_o.mediaDescriptions.find(Al=>Al.attributes.mid===yl.kind);Rl&&EN(Rl,_a)}),o_.exports.print(_o)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=_t=>{var _r;(_r=this.onFirstAudioReceived)===null||_r===void 0||_r.call(this,_t)},this.statsFilter.onFirstVideoReceived=_t=>{var _r;(_r=this.onFirstVideoReceived)===null||_r===void 0||_r.call(this,_t)},this.statsFilter.onFirstAudioDecoded=_t=>{var _r;(_r=this.onFirstAudioDecoded)===null||_r===void 0||_r.call(this,_t)},this.statsFilter.onFirstVideoDecoded=(_t,_r,_o)=>{var _a;(_a=this.onFirstVideoDecoded)===null||_a===void 0||_a.call(this,_t,_r,_o)},this.statsFilter.onSelectedLocalCandidateChanged=(_t,_r)=>{var _o;(_o=this.onSelectedLocalCandidateChanged)===null||_o===void 0||_o.call(this,_t,_r)},this.statsFilter.onSelectedRemoteCandidateChanged=(_t,_r)=>{var _o;(_o=this.onSelectedRemoteCandidateChanged)===null||_o===void 0||_o.call(this,_t,_r)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(_t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const _r=this.remoteSDP.batchSend(_t).map((_u,yl)=>{let{id:Rl,mslabel:Al}=_u;const{kind:Ol}=_t[yl];return new u0((xl,Ll)=>{const Bl=setTimeout(()=>{Ll(new Error("Cannot receive track, id: ".concat(Rl)))},1e4),Hl=up=>{const _f=gy();if(_f.name==="Safari"&&Number(_f.version)===11&&up.track.id!==Rl&&up.streams[0].id===Al){var vp;const Dp=up.streams[0].getTracks()[0];return(vp=this.remoteSDP)===null||vp===void 0||vp.updateTrackLabel(Ol,Rl,up.track.id),this.peerConnection.removeEventListener("track",Hl),clearTimeout(Bl),void xl({track:Dp,id:Rl})}if(up.track.id===Rl)return this.peerConnection.removeEventListener("track",Hl),clearTimeout(Bl),void xl({track:up.track,id:Rl})};this.peerConnection.addEventListener("track",Hl)})}),_o=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:_o});const _a=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(_a),await u0.all(_r)}catch(_r){throw new Tp(Ql.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(_r.toString()))}}async getRemoteSSRC(_t){if(!this.remoteSDP)return;const _r=this.remoteSDP.getSSRC(_t);return _r==null?void 0:_r[0].ssrcId}setConfiguration(_t){if(R_().supportPCSetConfiguration){const _r=x2.resolvePCConfiguration(_t);this.peerConnection.setConfiguration(_r)}}}).prototype,"connect",[fS],Object.getOwnPropertyDescriptor(my.prototype,"connect"),my.prototype),Yp(my.prototype,"stopSending",[fS],Object.getOwnPropertyDescriptor(my.prototype,"stopSending"),my.prototype),Yp(my.prototype,"receive",[fS],Object.getOwnPropertyDescriptor(my.prototype,"receive"),my.prototype),Yp(my.prototype,"stopReceiving",[fS],Object.getOwnPropertyDescriptor(my.prototype,"stopReceiving"),my.prototype),Yp(my.prototype,"muteRemote",[fS],Object.getOwnPropertyDescriptor(my.prototype,"muteRemote"),my.prototype),Yp(my.prototype,"unmuteRemote",[fS],Object.getOwnPropertyDescriptor(my.prototype,"unmuteRemote"),my.prototype),Yp(my.prototype,"muteLocal",[fS],Object.getOwnPropertyDescriptor(my.prototype,"muteLocal"),my.prototype),Yp(my.prototype,"unmuteLocal",[fS],Object.getOwnPropertyDescriptor(my.prototype,"unmuteLocal"),my.prototype),Yp(my.prototype,"close",[fS],Object.getOwnPropertyDescriptor(my.prototype,"close"),my.prototype),Yp(my.prototype,"updateEncoderConfig",[fS],Object.getOwnPropertyDescriptor(my.prototype,"updateEncoderConfig"),my.prototype),Yp(my.prototype,"updateSendParameters",[fS],Object.getOwnPropertyDescriptor(my.prototype,"updateSendParameters"),my.prototype),Yp(my.prototype,"replaceTrack",[fS],Object.getOwnPropertyDescriptor(my.prototype,"replaceTrack"),my.prototype),Yp(my.prototype,"getRemoteSSRC",[fS],Object.getOwnPropertyDescriptor(my.prototype,"getRemoteSSRC"),my.prototype),my);function fS(_e,_t,_r){const _o=_e[_t];if(typeof _o!="function")throw new Error("Cannot use mutex on object property.");return _r.value=async function(){const _a=this.mutex,_u=await _a.lock("Locking from P2PConnection.".concat(_t));try{for(var yl=arguments.length,Rl=new Array(yl),Al=0;Al<yl;Al++)Rl[Al]=arguments[Al];return await _o.apply(this,Rl)}finally{_u()}},_r}const gU="9",jz=4e4;class pre{get localCapabilities(){return r_(this._localCapabilities)}get rtpCapabilities(){return r_(this._rtpCapabilities)}get candidates(){return r_(this._candidates)}get iceParameters(){return r_(this._iceParameters)}get dtlsParameters(){return r_(this._dtlsParameters)}constructor(_t){Ml(this,"sessionDesc",void 0),Ml(this,"_localCapabilities",void 0),Ml(this,"_rtpCapabilities",void 0),Ml(this,"_candidates",void 0),Ml(this,"_iceParameters",void 0),Ml(this,"_dtlsParameters",void 0),Ml(this,"setup",void 0),Ml(this,"currentMidIndex",void 0),Ml(this,"cname",void 0),Ml(this,"firefoxSsrcMidMap",new Map),_t=r_(_t);const{remoteIceParameters:_r,remoteDtlsParameters:_o,candidates:_a,remoteRTPCapabilities:_u,remoteSetup:yl,localCapabilities:Rl,cname:Al}=_t,Ol=o_.exports.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`);this._rtpCapabilities=_u,this._candidates=_a,this._iceParameters=_r,this._dtlsParameters=_o,this._localCapabilities=Rl,this.setup=yl,this.cname=Al;const xl=this.rtpCapabilities.send;for(const Ll of Ol.mediaDescriptions){if(Ll.attributes.iceUfrag=_r.iceUfrag,Ll.attributes.icePwd=_r.icePwd,Ll.attributes.fingerprints=_o.fingerprints,Ll.attributes.candidates=_a,Ll.attributes.setup=yl,Ll.media.mediaType==="video"&&(Ll.media.fmts=xl.videoCodecs.map(Bl=>Bl.payloadType.toString(10)),Ll.attributes.payloads=xl.videoCodecs,Ll.attributes.extmaps=xl.videoExtensions,Pp("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:Bl,ssrcGroups:Hl}=hS([{ssrcId:jz,rtx:Pp("USE_RTX")?40001:void 0}],this.cname);Ll.attributes.ssrcs=Bl,Ll.attributes.ssrcGroups=Hl}if(Ll.media.mediaType==="audio"&&(Ll.media.fmts=xl.audioCodecs.map(Bl=>Bl.payloadType.toString(10)),Ll.attributes.payloads=xl.audioCodecs,Ll.attributes.extmaps=xl.audioExtensions,v1(Ll),Pp("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:Bl,ssrcGroups:Hl}=hS([{ssrcId:2e4}],this.cname);Ll.attributes.ssrcs=Bl,Ll.attributes.ssrcGroups=Hl}}this.sessionDesc=Ol,this.currentMidIndex=Ol.mediaDescriptions.length-1}preloadRemoteMedia(){const _t=Pp("PRELOAD_MEDIA_COUNT");this.rtpCapabilities;const _r=this.candidates,_o=this.dtlsParameters,_a=this.iceParameters,_u=this.rtpCapabilities.send;for(let yl=1;yl<_t;yl++){const Rl=2*yl+2e4,Al=2*yl+jz,{ssrcs:Ol,ssrcGroups:xl}=hS([{ssrcId:Rl}],this.cname),{ssrcs:Ll,ssrcGroups:Bl}=hS([{ssrcId:Al,rtx:Pp("USE_RTX")?Al+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:gU,protos:["UDP","TLS","RTP","SAVPF"],fmts:_u.videoCodecs.map(Hl=>Hl.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:_a.iceUfrag,icePwd:_a.icePwd,unrecognized:[],candidates:_r,extmaps:_u.videoExtensions,fingerprints:_o.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:Ll,ssrcGroups:Bl,rtcpFeedbackWildcards:[],payloads:_u.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*yl)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:gU,protos:["UDP","TLS","RTP","SAVPF"],fmts:_u.audioCodecs.map(Hl=>Hl.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:_a.iceUfrag,icePwd:_a.icePwd,unrecognized:[],candidates:_r,extmaps:_u.audioExtensions,fingerprints:_o.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:Ol,ssrcGroups:xl,rtcpFeedbackWildcards:[],payloads:_u.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*yl+1)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return o_.exports.print(this.sessionDesc)}send(_t,_r,_o,_a){const{ssrcs:_u,ssrcGroups:yl}=hS(_r,this.cname,Pp("AV_SYNC")?_o:void 0),Rl=this.findPreloadMediaDesc(_u);if(Rl){if(Wy()&&this.firefoxSsrcMidMap.set(_u[0].ssrcId,Rl.attributes.mid),_a&&(_a.twcc||_a.remb)){const Al=this.sessionDesc.mediaDescriptions.indexOf(Rl);return this.sessionDesc.mediaDescriptions[Al]=this.mungSendMediaDesc(Rl,_a),{mid:Rl.attributes.mid,needExchangeSDP:!0}}return{mid:Rl.attributes.mid,needExchangeSDP:!1}}{const Al=this.findAvailableMediaIndex(_t,_u);let Ol;return Al===-1||Al===1&&(_b()||ZV())||e8()?(Ol=this.createOrRecycleSendMedia(_t,_u,yl,"sendonly",_a),this.updateBundleMids()):(Ol=r_(this.sessionDesc.mediaDescriptions[Al]),Ol.attributes.direction="sendonly",Ol.attributes.ssrcs=_u,Ol.attributes.ssrcGroups=yl,this.sessionDesc.mediaDescriptions[Al]=this.mungSendMediaDesc(Ol,_a)),Wy()&&this.firefoxSsrcMidMap.set(_u[0].ssrcId,Ol.attributes.mid),{mid:Ol.attributes.mid,needExchangeSDP:!0}}}batchSend(_t){const _r=_t.map(_u=>{let{kind:yl,ssrcMsg:Rl,mslabel:Al}=_u;return this.send(yl,Rl,Al)}),_o=[];let _a=!1;return _r.forEach(_u=>{let{mid:yl,needExchangeSDP:Rl}=_u;Rl&&(_a=!0),_o.push(yl)}),{mids:_o,needExchangeSDP:_a}}stopSending(_t){const _r=this.sessionDesc.mediaDescriptions.filter(_o=>_o.attributes.mid&&_t.indexOf(_o.attributes.mid)!==-1);if(_r.length!==_t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");_r.forEach(_o=>{_o.attributes.mid==="0"||Wy()||e8()?_o.attributes.ssrcs=[]:(_o.attributes.ssrcs=[],_o.attributes.direction="inactive",_o.media.port="0")}),this.updateBundleMids()}mute(_t){const _r=this.sessionDesc.mediaDescriptions.find(_o=>_o.attributes.mid===_t);if(!_r)throw new Error("mediaDescription not found with ".concat(_t," in remote SDP when calling RemoteSDP.mute."));_r.attributes.direction="inactive"}unmute(_t){const _r=this.sessionDesc.mediaDescriptions.find(_o=>_o.attributes.mid===_t);if(!_r)throw new Error("mediaDescription not found with ".concat(_t," in remote SDP when calling RemoteSDP.unmute."));_r.attributes.direction="sendonly"}muteRemote(_t){const _r=this.sessionDesc.mediaDescriptions.filter(_o=>_t.includes(_o.attributes.mid||""));if(_r.length!==_t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");_r.forEach(_o=>{_o.attributes.direction="inactive"})}unmuteRemote(_t){const _r=this.sessionDesc.mediaDescriptions.filter(_o=>_t.includes(_o.attributes.mid||""));if(_r.length!==_t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");_r.forEach(_o=>{_o.attributes.direction="recvonly"})}receive(_t,_r,_o,_a){_t.forEach((_u,yl)=>{this.createOrRecycleRecvMedia(_u,[],"recvonly",_r,_o,_a[yl])}),this.updateBundleMids()}stopReceiving(_t){const _r=this.sessionDesc.mediaDescriptions.filter(_o=>_t.indexOf(_o.attributes.mid)!==-1);if(_r.length!==_t.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");_r.forEach(_o=>{_o.media.port="0",_o.attributes.direction="inactive"}),this.updateBundleMids()}restartICE(_t){_t=r_(_t),this._iceParameters=_t,this.sessionDesc.mediaDescriptions.forEach(_r=>{_r.attributes.iceUfrag=_t.iceUfrag,_r.attributes.icePwd=_t.icePwd})}predictReceivingMids(_t){const _r=[];for(let _o=0;_o<_t;_o++)_r.push((this.currentMidIndex+_o+1).toString(10));return _r}findAvailableMediaIndex(_t,_r){return this.sessionDesc.mediaDescriptions.findIndex(_o=>{const _a=_o.media.mediaType===_t&&_o.media.port!=="0"&&(_o.attributes.direction==="sendonly"||_o.attributes.direction==="sendrecv")&&_o.attributes.ssrcs.length===0;if(Wy()){if(_a){const _u=this.firefoxSsrcMidMap.get(_r[0].ssrcId);return!(_u||_o.attributes.mid!=="0"&&_o.attributes.mid!=="1")||!(!_u||_u!==_o.attributes.mid)}return!1}return _a})}createOrRecycleRecvMedia(_t,_r,_o,_a,_u,yl){const Rl=_t._mediaStreamTrack.kind,Al=this.rtpCapabilities.recv,Ol=this.localCapabilities.send;let xl=[];if(Rl===P0.VIDEO){var Ll,Bl;if(Pp("H264_PROFILE_LEVEL_ID")&&_a==="h264"&&(xl=Al.videoCodecs.filter(Dp=>{var Bp,_g;return(((Bp=Dp.rtpMap)===null||Bp===void 0?void 0:Bp.encodingName.toLowerCase())||"").includes(_a)&&(Dp==null||(_g=Dp.fmtp)===null||_g===void 0?void 0:_g.parameters["profile-level-id"])===Pp("H264_PROFILE_LEVEL_ID")})),!xl||((Ll=xl)===null||Ll===void 0?void 0:Ll.length)===0){const Dp=Ol.videoCodecs.filter(Bp=>{var _g;return(((_g=Bp.rtpMap)===null||_g===void 0?void 0:_g.encodingName.toLowerCase())||"").includes(_a)});Dp.length!==0&&(xl=Al.videoCodecs.filter(Bp=>Dp.some(_g=>_g.payloadType===Bp.payloadType)))}if(Pp("USE_RTX")){const Dp=xl.map(_g=>_g.payloadType.toString()),Bp=Al.videoCodecs.filter(_g=>{var y0,e0;return((y0=_g.rtpMap)===null||y0===void 0?void 0:y0.encodingName)==="rtx"&&Dp.includes(((e0=_g.fmtp)===null||e0===void 0?void 0:e0.parameters.apt)||"")});xl=[...xl,...Bp]}xl.length===0&&(Vl.warning("codec ".concat(_a," not included in rtpCapabilities, fallback to default payloads: ").concat((Bl=Al.videoCodecs[0].rtpMap)===null||Bl===void 0?void 0:Bl.encodingName)),xl=Al.videoCodecs)}else xl=Al.audioCodecs.filter(Dp=>{var Bp;return(((Bp=Dp.rtpMap)===null||Bp===void 0?void 0:Bp.encodingName.toLowerCase())||"").includes(_u)}),xl.length===0&&(Vl.warning("codec ".concat(_u," not included in rtpCapabilities, fallback to opus")),xl=Al.audioCodecs.filter(Dp=>{var Bp;return(((Bp=Dp.rtpMap)===null||Bp===void 0?void 0:Bp.encodingName.toLowerCase())||"").includes("opus")}));const Hl=Rl===P0.VIDEO?Al.videoExtensions:Al.audioExtensions;this.currentMidIndex+=1;const up="".concat(this.currentMidIndex);let _f={media:{mediaType:Rl,port:gU,protos:["UDP","TLS","RTP","SAVPF"],fmts:xl.map(Dp=>Dp.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:Hl,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:_r,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:xl,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:_o,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(up)}};_f=this.mungRecvMediaDsec(_f,_t,yl);const vp=this.findFirstClosedMedia(Rl);if(vp){const Dp=this.sessionDesc.mediaDescriptions.indexOf(vp);this.sessionDesc.mediaDescriptions[Dp]=_f}else this.sessionDesc.mediaDescriptions.push(_f);return _f}createOrRecycleSendMedia(_t,_r,_o,_a,_u){const yl=this.rtpCapabilities.send,Rl=_t===P0.VIDEO?yl.videoCodecs:yl.audioCodecs,Al=_t===P0.VIDEO?yl.videoExtensions:yl.audioExtensions;this.currentMidIndex+=1;const Ol="".concat(this.currentMidIndex);let xl={media:{mediaType:_t,port:gU,protos:["UDP","TLS","RTP","SAVPF"],fmts:Rl.map(Bl=>Bl.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:Al,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:_r,ssrcGroups:_o,rtcpFeedbackWildcards:[],payloads:Rl,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:_a,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(Ol)}};xl=this.mungSendMediaDesc(xl,_u);const Ll=this.findFirstClosedMedia(_t);if(Ll){const Bl=this.sessionDesc.mediaDescriptions.indexOf(Ll);this.sessionDesc.mediaDescriptions[Bl]=xl}else this.sessionDesc.mediaDescriptions.push(xl);return xl}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(_t=>_t.media.port!=="0").map(_t=>_t.attributes.mid)}mungRecvMediaDsec(_t,_r,_o){const _a=r_(_t);return h$(_a),EN(_a,_r),f$(_a,_r),yz(_a),fU(_a,_o,this.localCapabilities.send),_a}mungSendMediaDesc(_t,_r){const _o=r_(_t);return fU(_o,_r,this.localCapabilities.recv),v1(_o),_o}updateRecvMedia(_t,_r){const _o=this.sessionDesc.mediaDescriptions.findIndex(_a=>_a.attributes.mid===_t);if(_o!==-1){const _a=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[_o],_r);this.sessionDesc.mediaDescriptions[_o]=_a}}bumpMid(_t){this.currentMidIndex+=_t}findFirstClosedMedia(_t){return this.sessionDesc.mediaDescriptions.find(_r=>Wy()?_r.media.port==="0"&&_r.media.mediaType===_t:_r.media.port==="0")}findPreloadMediaDesc(_t){return this.sessionDesc.mediaDescriptions.find(_r=>{var _o,_a;return((_o=_r.attributes)===null||_o===void 0||(_a=_o.ssrcs[0])===null||_a===void 0?void 0:_a.ssrcId)===_t[0].ssrcId})}getSSRC(_t){var _r;return(_r=this.sessionDesc.mediaDescriptions.find(_o=>_o.attributes.mid===_t))===null||_r===void 0?void 0:_r.attributes.ssrcs}}var yy;function Fz(_e,_t){var _r=Object.keys(_e);if(Object.getOwnPropertySymbols){var _o=Object.getOwnPropertySymbols(_e);_t&&(_o=_o.filter(function(_a){return Object.getOwnPropertyDescriptor(_e,_a).enumerable})),_r.push.apply(_r,_o)}return _r}function Bz(_e){for(var _t=1;_t<arguments.length;_t++){var _r=arguments[_t]!=null?arguments[_t]:{};_t%2?Fz(Object(_r),!0).forEach(function(_o){Ml(_e,_o,_r[_o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_e,Object.getOwnPropertyDescriptors(_r)):Fz(Object(_r)).forEach(function(_o){Object.defineProperty(_e,_o,Object.getOwnPropertyDescriptor(_r,_o))})}return _e}let w2=(Yp((yy=class k2 extends K5{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}constructor(_t,_r){super(_t,_r),Ml(this,"store",void 0),Ml(this,"peerConnection",void 0),Ml(this,"remoteSDP",void 0),Ml(this,"initialOffer",void 0),Ml(this,"transportEventReceiver",void 0),Ml(this,"statsFilter",void 0),Ml(this,"useRTX",Pp("USE_RTX")),Ml(this,"localCapabilities",void 0),Ml(this,"localCandidateCount",0),Ml(this,"allCandidatesReceived",!1),Ml(this,"establishPromise",void 0),Ml(this,"mutex",new iT("P2PConnection-mutex")),this.store=_r,this.peerConnection=new RTCPeerConnection(k2.resolvePCConfiguration(_t),{optional:[{googDscp:!0}]}),this.statsFilter=y$(this.peerConnection,void 0,void 0,Wy()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const _t=await this.peerConnection.createOffer();if(!_t.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const _r=pO(_t.sdp),_o=await Ez(!this.useRTX,Pp("FILTER_VIDEO_FEC"),Pp("FILTER_AUDIO_FEC"));return this.localCapabilities=p$(_o),this.initialOffer=_t,Bz(Bz({},_r),{},{rtpCapabilities:_o,offerSDP:_t.sdp})}catch(_t){throw new Tp(Ql.GET_LOCAL_CONNECTION_PARAMS_FAILED,_t.toString())}}async connect(_t,_r,_o,_a,_u,yl){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new pre({remoteIceParameters:_t,remoteDtlsParameters:_r,candidates:_o,remoteRTPCapabilities:_a,remoteSetup:_u,localCapabilities:this.localCapabilities,cname:yl});const Rl=this.remoteSDP.toString(),Al=o_.exports.parse(this.initialOffer.sdp),Ol=Al.mediaDescriptions.find(Hl=>Hl.media.mediaType==="audio");Ol&&v1(Ol);const xl=o_.exports.print(Al),Ll=this.logSDPExchange(xl||"","offer","local","connect");await this.peerConnection.setLocalDescription({type:"offer",sdp:xl}),Ll==null||Ll(Rl),await this.peerConnection.setRemoteDescription({type:"answer",sdp:Rl});const Bl=this.peerConnection.getTransceivers()[0];if(Bl!=null&&Bl.receiver&&this.tryBindTransportEvents(Bl.receiver),Pp("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia();const Hl=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:Hl});const up=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(up)}}catch(Rl){throw new Tp(Ql.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(Rl.toString()))}}send(_t,_r,_o){var _a=this;return wS(function*(){const _u=yield H0(_a.mutex.lock("From P2PConnection.send"));try{if(!_a.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const yl=[];_t.forEach(_f=>{const vp=_a.peerConnection.addTransceiver(_f._mediaStreamTrack,{direction:"sendonly"});yl.push(vp)}),Wy()&&Pp("SIMULCAST")===!0&&(yield H0(_a.applySimulcastForFirefox(yl,_t)));const Rl=yield H0(_a.peerConnection.createOffer()),Al=_a.remoteSDP.predictReceivingMids(_t.length),Ol=_a.mungSendOfferSDP(Rl.sdp,_t,Al),xl=o_.exports.parse(Ol),Ll=Al.map(_f=>{const vp=xl.mediaDescriptions.find(Dp=>Dp.attributes.mid===_f);if(!vp)throw new Error("Cannot extract ssrc from mediaDescription.");return gz(vp,_a.useRTX)});let Bl;try{Bl=yield Ll}catch(_f){Bl=[],_a.remoteSDP.receive(_t,_r,_o,Bl);const vp=_a.remoteSDP.toString();throw yield H0(_a.peerConnection.setLocalDescription({type:"offer",sdp:Ol})),yield H0(_a.peerConnection.setRemoteDescription({type:"answer",sdp:vp})),yield H0(_a.stopSending(Al,!0)),_f}_a.remoteSDP.receive(_t,_r,_o,Bl);const Hl=_a.remoteSDP.toString(),up=_a.logSDPExchange(Ol,"offer","local","send");return yield H0(_a.peerConnection.setLocalDescription({type:"offer",sdp:Ol})),yield H0(_a.applySimulcastEncodings(yl,_t)),yield H0(_a.applySendEncodings(yl,_t)),up==null||up(Hl),yield H0(_a.peerConnection.setRemoteDescription({type:"answer",sdp:Hl})),yl.map((_f,vp)=>{const Dp=Al[vp];return{localSSRC:Ll[vp],id:Dp,transceiver:_f}})}catch(yl){throw yl instanceof Tp?yl:new Tp(Ql.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(yl.toString()))}finally{_u()}})()}async stopSending(_t,_r){const _o=_r?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const _a=this.peerConnection.getTransceivers().filter(Al=>_t.indexOf(Al.mid)!==-1);if(_a.length!==_t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");_a.map(Al=>{var Ol;Al.direction="inactive",(Ol=Al.stop)===null||Ol===void 0||Ol.call(Al)});const _u=await this.peerConnection.createOffer(),yl=this.logSDPExchange(_u.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(_u),this.remoteSDP.stopReceiving(_t);const Rl=this.remoteSDP.toString();yl==null||yl(Rl),await this.peerConnection.setRemoteDescription({type:"answer",sdp:Rl})}catch(_a){throw new Tp(Ql.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(_a.toString()))}finally{_o&&_o()}}async receive(_t,_r,_o,_a){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(_t," before remoteSDP created."));const{mid:_u,needExchangeSDP:yl}=this.remoteSDP.send(_t,_r,_o,_a);if(yl){const Al=this.remoteSDP.toString(),Ol=this.logSDPExchange(Al,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:Al});const xl=await this.peerConnection.createAnswer(),Ll=this.mungReceiveAnswerSDP(xl.sdp,_u,_t);Ol==null||Ol(Ll||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:Ll}),Vl.debug("[P2PConnection] receive ".concat(_t," by exchanging SDP."))}else Vl.debug("[P2PConnection] receive ".concat(_t," no need to exchange SDP."));const Rl=this.peerConnection.getTransceivers().find(Al=>Al.mid===_u);if(!Rl)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:Rl.receiver.track,id:_u}}catch(_u){throw new Tp(Ql.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(_u.toString()))}}async batchReceive(_t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:_r,needExchangeSDP:_o}=this.remoteSDP.batchSend(_t);if(_o){const _a=this.remoteSDP.toString(),_u=this.logSDPExchange(_a,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:_a});const yl=await this.peerConnection.createAnswer();_u==null||_u(yl.sdp||""),await this.peerConnection.setLocalDescription(yl),Vl.debug("[P2PConnection] batchReceive by exchanging SDP.")}else Vl.debug("[P2PConnection] batchReceive no need to exchange SDP.");return _r.map(_a=>{const _u=this.peerConnection.getTransceivers().find(yl=>yl.mid===_a);if(!_u)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:_u.receiver.track,id:_a}})}catch(_r){throw new Tp(Ql.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(_r.toString()))}}async stopReceiving(_t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(_t);const _r=this.remoteSDP.toString(),_o=this.logSDPExchange(_r,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:_r});const _a=await this.peerConnection.createAnswer();_o==null||_o(_a.sdp||""),await this.peerConnection.setLocalDescription(_a)}catch(_r){throw new Tp(Ql.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(_r.toString()))}}async muteRemote(_t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(_t," before remote SDP created."));this.remoteSDP.mute(_t);const _r=this.remoteSDP.toString(),_o=this.logSDPExchange(_r,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:_r});const _a=await this.peerConnection.createAnswer();_o==null||_o(_a.sdp||""),await this.peerConnection.setLocalDescription(_a)}catch(_r){throw new Tp(Ql.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(_r.toString()))}}async unmuteRemote(_t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(_t," before remote SDP created."));this.remoteSDP.unmute(_t);const _r=this.remoteSDP.toString(),_o=this.logSDPExchange(_r,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:_r});const _a=await this.peerConnection.createAnswer();_o==null||_o(_a.sdp||""),await this.peerConnection.setLocalDescription(_a)}catch(_r){throw new Tp(Ql.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(_r.toString()))}}async muteLocal(_t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const _r=this.peerConnection.getTransceivers().filter(yl=>yl.mid&&_t.indexOf(yl.mid)!==-1);if(_r.length!==_t.length)throw new Error("Transceivers' length doesn't match mids' length.");_r.map(yl=>{yl.direction="inactive"});const _o=await this.peerConnection.createOffer(),_a=this.logSDPExchange(_o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(_o),this.remoteSDP.muteRemote(_t);const _u=this.remoteSDP.toString();_a==null||_a(_u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:_u})}catch(_r){throw new Tp(Ql.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(_r.toString()))}}async unmuteLocal(_t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const _r=this.peerConnection.getTransceivers().filter(yl=>yl.mid&&_t.indexOf(yl.mid)!==-1);if(_r.length!==_t.length)throw new Error("Transceivers' length doesn't match mids' length.");_r.map(async(yl,Rl)=>{yl.direction="sendonly"});const _o=await this.peerConnection.createOffer(),_a=this.logSDPExchange(_o.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(_o),this.remoteSDP.unmuteRemote(_t);const _u=this.remoteSDP.toString();_a==null||_a(_u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:_u})}catch(_r){throw new Tp(Ql.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(_r.toString()))}}restartICE(){var _t=this;return wS(function*(){const _r=yield H0(_t.mutex.lock("From P2PConnection.restartICE"));try{const _o=yield H0(_t.peerConnection.createOffer({iceRestart:!0}));if(!_o.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const _a=pO(_o.sdp),{remoteIceParameters:_u}=yield _a.iceParameters;if(!_t.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");_t.remoteSDP.restartICE(_u);const yl=_t.remoteSDP.toString(),Rl=_t.logSDPExchange(_o.sdp||"","offer","local","restartICE");yield H0(_t.peerConnection.setLocalDescription(_o)),Rl==null||Rl(yl),yield H0(_t.peerConnection.setRemoteDescription({type:"answer",sdp:yl}))}catch(_o){Vl.warning("restart ICE failed, abort operation",_o)}finally{_r()}})()}close(){var _t;this.peerConnection.close(),(_t=this.onConnectionStateChange)===null||_t===void 0||_t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(_t){return this.statsFilter.getVideoIsReady(_t)}async updateEncoderConfig(_t,_r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const _o=await this.peerConnection.createOffer(),_a=this.mungSendOfferSDP(_o.sdp,[_r],[_t]);this.remoteSDP.updateRecvMedia(_t,_r);const _u=this.remoteSDP.toString(),yl=this.logSDPExchange(_a,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:_a}),yl==null||yl(_u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:_u})}catch(_o){throw new Tp(Ql.EXCHANGE_SDP_FAILED,_o.toString())}}async updateSendParameters(_t,_r){const _o=this.peerConnection.getTransceivers().filter(_a=>_a.mid===_t);_o.length===1&&(this.isVP8Simulcast(_r)?Wy()||await this.applySimulcastEncodings(_o,[_r]):await this.applySendEncodings(_o,[_r]))}setStatsRemoteVideoIsReady(_t,_r){this.statsFilter.setVideoIsReady2(_t,_r)}async replaceTrack(_t,_r){const _o=this.peerConnection.getTransceivers().find(_a=>_a.mid===_r);_o&&await _o.sender.replaceTrack(_t._mediaStreamTrack)}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var _t;(_t=this.onICEConnectionStateChange)===null||_t===void 0||_t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var _t;(_t=this.onConnectionStateChange)===null||_t===void 0||_t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=_t=>{_t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,Vl.debug("[pc-".concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,Vl.debug("[pc-".concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},Pp("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(_t){const _r={iceServers:[]};return _t.iceServers?_r.iceServers=_t.iceServers:_t.turnServer&&_t.turnServer.mode!=="off"&&(a2(_t.turnServer.servers)?_r.iceServers=_t.turnServer.servers:(_r.iceServers&&_r.iceServers.push(...k2.turnServerConfigToIceServers(_t.turnServer.servers)),Pp("USE_TURN_SERVER_OF_GATEWAY")&&_r.iceServers&&_t.turnServer.serversFromGateway&&_r.iceServers.push(...k2.turnServerConfigToIceServers(_t.turnServer.serversFromGateway)),Pp("FORCE_TURN_TCP")?_r.iceTransportPolicy="relay":_t.turnServer.servers.concat(_t.turnServer.serversFromGateway||[]).forEach(_o=>{_o.forceturn&&(_r.iceTransportPolicy="relay")}))),_r}static turnServerConfigToIceServers(_t){const _r=[];return _t.forEach(_o=>{_o.security?_o.tcpport&&_r.push({username:_o.username,credential:_o.password,credentialType:"password",urls:"turns:".concat(eU(_o.turnServerURL),":").concat(_o.tcpport,"?transport=tcp")}):(_o.udpport&&!Pp("FORCE_TURN_TCP")&&_r.push({username:_o.username,credential:_o.password,credentialType:"password",urls:"turn:".concat(_o.turnServerURL,":").concat(_o.udpport,"?transport=udp")}),_o.tcpport&&_r.push({username:_o.username,credential:_o.password,credentialType:"password",urls:"turn:".concat(_o.turnServerURL,":").concat(_o.tcpport,"?transport=tcp")}))}),_r}tryBindTransportEvents(_t){_t.transport&&(this.transportEventReceiver=_t,_t.transport.onstatechange=()=>{var _r,_o;(_r=_t.transport)!==null&&_r!==void 0&&_r.state&&((_o=this.onDTLSTransportStateChange)===null||_o===void 0||_o.call(this,_t.transport.state))},_t.transport.onerror=_r=>{var _o;(_o=this.onDTLSTransportError)===null||_o===void 0||_o.call(this,_r.error)},_t.transport.iceTransport&&(_t.transport.iceTransport.onstatechange=()=>{var _r;const _o=(_r=_t.transport)===null||_r===void 0?void 0:_r.iceTransport.state;var _a;_o&&((_a=this.onICETransportStateChange)===null||_a===void 0||_a.call(this,_o))}))}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async applySendEncodings(_t,_r){try{if(!R_().supportSetRtpSenderParameters||_t.length!==_r.length)return;for(let Ol=0;Ol<_t.length;Ol++){const xl=_t[Ol],Ll=_r[Ol];if(Ll&&Ll instanceof i_){var _o,_a;if(this.isVP8Simulcast(Ll))continue;const Bl={},Hl={};switch(Ll._optimizationMode){case"motion":Bl.degradationPreference="maintain-framerate";break;case"detail":Bl.degradationPreference="maintain-resolution";break;default:Bl.degradationPreference="balanced"}var _u,yl,Rl,Al;if((_o=Ll._encoderConfig)!==null&&_o!==void 0&&_o.bitrateMax&&(Hl.maxBitrate=1e3*((_u=Ll._encoderConfig)===null||_u===void 0?void 0:_u.bitrateMax)),Ll._hints.includes(f_.LOW_STREAM)&&((yl=Ll._encoderConfig)!==null&&yl!==void 0&&yl.frameRate&&(Hl.maxFramerate=MR(Ll._encoderConfig.frameRate)),(Rl=Ll._encoderConfig)!==null&&Rl!==void 0&&Rl.scaleResolutionDownBy&&((Al=Ll._encoderConfig)===null||Al===void 0?void 0:Al.scaleResolutionDownBy)>1&&(Hl.scaleResolutionDownBy=Ll._encoderConfig.scaleResolutionDownBy)),Pp("DSCP_TYPE")&&eO()){const vp=Pp("DSCP_TYPE");["very-low","low","medium","high"].includes(vp)&&(Hl.networkPriority=vp)}const up=xl.sender.getParameters(),_f=(_a=up.encodings)===null||_a===void 0?void 0:_a[0];Wy()&&!_f&&(Bl.encodings=[Hl]),_f&&Object.assign(_f,Hl),Object.assign(up,Bl),await xl.sender.setParameters(up)}}}catch{Vl.debug("Apply RTPSendEncodings failed.")}}mungSendOfferSDP(_t,_r,_o){const _a=o_.exports.parse(_t);return _r.forEach((_u,yl)=>{const Rl=_o[yl],Al=_a.mediaDescriptions.find(Ol=>Ol.attributes.mid===Rl);Al&&(EN(Al,_u),vz(Al,_u,this.store.codec))}),o_.exports.print(_a)}mungReceiveAnswerSDP(_t,_r,_o){const _a=o_.exports.parse(_t),_u=_a.mediaDescriptions.find(yl=>yl.attributes.mid===_r);return _u&&_o===P0.AUDIO&&_u.media.mediaType==="audio"&&v1(_u),o_.exports.print(_a)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=_t=>{var _r;(_r=this.onFirstAudioReceived)===null||_r===void 0||_r.call(this,_t)},this.statsFilter.onFirstVideoReceived=_t=>{var _r;(_r=this.onFirstVideoReceived)===null||_r===void 0||_r.call(this,_t)},this.statsFilter.onFirstAudioDecoded=_t=>{var _r;(_r=this.onFirstAudioDecoded)===null||_r===void 0||_r.call(this,_t)},this.statsFilter.onFirstVideoDecoded=(_t,_r,_o)=>{var _a;(_a=this.onFirstVideoDecoded)===null||_a===void 0||_a.call(this,_t,_r,_o)},this.statsFilter.onSelectedLocalCandidateChanged=(_t,_r)=>{var _o;(_o=this.onSelectedLocalCandidateChanged)===null||_o===void 0||_o.call(this,_t,_r)},this.statsFilter.onSelectedRemoteCandidateChanged=(_t,_r)=>{var _o;(_o=this.onSelectedRemoteCandidateChanged)===null||_o===void 0||_o.call(this,_t,_r)},this.statsFilter.onFirstVideoDecodedTimeout=_t=>{var _r;(_r=this.onFirstVideoDecodedTimeout)===null||_r===void 0||_r.call(this,_t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(_t,_r){if(_t.length===_r.length)for(let Rl=0;Rl<_t.length;Rl++){var _o,_a,_u,yl;const Al=_t[Rl],Ol=_r[Rl];if(Ol instanceof i_&&!Ol._hints.includes(f_.LOW_STREAM)&&(_o=Ol._encoderConfig)!==null&&_o!==void 0&&_o.bitrateMax&&((_a=Ol._encoderConfig)===null||_a===void 0?void 0:_a.bitrateMax)>200&&(_u=Ol._scalabiltyMode)!==null&&_u!==void 0&&_u.numSpatialLayers&&((yl=Ol._scalabiltyMode)===null||yl===void 0?void 0:yl.numSpatialLayers)>1&&this.store.codec==="vp8"){const xl={},Ll={high:1e3*(Ol._encoderConfig.bitrateMax-50),medium:5e4};xl.encodings=[{rid:"m",active:!0,maxBitrate:Ll.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:Ll.high}];const Bl=Al.sender.getParameters();await Al.sender.setParameters(Object.assign(Bl,xl))}}}async applySimulcastEncodings(_t,_r){if(!Wy()&&_t.length===_r.length)for(let _o=0;_o<_t.length;_o++){const _a=_r[_o];if(_a instanceof i_&&this.isVP8Simulcast(_a)){const _u=_t[_o],yl={},Rl={high:1e3*(_a._encoderConfig.bitrateMax-50),medium:5e4};yl.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:Rl.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:Rl.medium,scaleResolutionDownBy:4}];const Al=_u.sender.getParameters();await _u.sender.setParameters(Object.assign(Al,yl))}}}isVP8Simulcast(_t){var _r,_o,_a,_u;return!!(_t instanceof i_&&Pp("SIMULCAST")&&this.store.codec==="vp8"&&!_t._hints.includes(f_.LOW_STREAM)&&(_r=_t._encoderConfig)!==null&&_r!==void 0&&_r.bitrateMax&&((_o=_t._encoderConfig)===null||_o===void 0?void 0:_o.bitrateMax)>200&&(_a=_t._scalabiltyMode)!==null&&_a!==void 0&&_a.numSpatialLayers&&((_u=_t._scalabiltyMode)===null||_u===void 0?void 0:_u.numSpatialLayers)>1)}logSDPExchange(_t,_r,_o,_a){if(Pp("SDP_LOGGING"))return Vl.upload("exchanging ".concat(_o," ").concat(_r," SDP during P2PConnection.").concat(_a,`
`),_t),_r==="offer"?_u=>{this.logSDPExchange(_u,"answer",_o==="local"?"remote":"local",_a)}:void 0}async getRemoteSSRC(_t){if(!this.remoteSDP)return;const _r=this.remoteSDP.getSSRC(_t);return _r==null?void 0:_r[0].ssrcId}setConfiguration(_t){if(R_().supportPCSetConfiguration){const _r=k2.resolvePCConfiguration(_t);this.peerConnection.setConfiguration(_r)}}}).prototype,"connect",[pS],Object.getOwnPropertyDescriptor(yy.prototype,"connect"),yy.prototype),Yp(yy.prototype,"receive",[pS],Object.getOwnPropertyDescriptor(yy.prototype,"receive"),yy.prototype),Yp(yy.prototype,"batchReceive",[pS],Object.getOwnPropertyDescriptor(yy.prototype,"batchReceive"),yy.prototype),Yp(yy.prototype,"stopReceiving",[pS],Object.getOwnPropertyDescriptor(yy.prototype,"stopReceiving"),yy.prototype),Yp(yy.prototype,"muteRemote",[pS],Object.getOwnPropertyDescriptor(yy.prototype,"muteRemote"),yy.prototype),Yp(yy.prototype,"unmuteRemote",[pS],Object.getOwnPropertyDescriptor(yy.prototype,"unmuteRemote"),yy.prototype),Yp(yy.prototype,"muteLocal",[pS],Object.getOwnPropertyDescriptor(yy.prototype,"muteLocal"),yy.prototype),Yp(yy.prototype,"unmuteLocal",[pS],Object.getOwnPropertyDescriptor(yy.prototype,"unmuteLocal"),yy.prototype),Yp(yy.prototype,"close",[pS],Object.getOwnPropertyDescriptor(yy.prototype,"close"),yy.prototype),Yp(yy.prototype,"updateEncoderConfig",[pS],Object.getOwnPropertyDescriptor(yy.prototype,"updateEncoderConfig"),yy.prototype),Yp(yy.prototype,"updateSendParameters",[pS],Object.getOwnPropertyDescriptor(yy.prototype,"updateSendParameters"),yy.prototype),Yp(yy.prototype,"replaceTrack",[pS],Object.getOwnPropertyDescriptor(yy.prototype,"replaceTrack"),yy.prototype),Yp(yy.prototype,"getRemoteSSRC",[pS],Object.getOwnPropertyDescriptor(yy.prototype,"getRemoteSSRC"),yy.prototype),yy);function pS(_e,_t,_r){const _o=_e[_t];if(typeof _o!="function")throw new Error("Cannot use mutex on object property.");return _r.value=async function(){const _a=this.mutex,_u=await _a.lock("From P2PConnection.".concat(_t));try{for(var yl=arguments.length,Rl=new Array(yl),Al=0;Al<yl;Al++)Rl[Al]=arguments[Al];return await _o.apply(this,Rl)}finally{_u()}},_r}function Gz(_e,_t){let _r=document.createElement("video"),_o=document.createElement("canvas");_r.setAttribute("style","display:none"),_o.setAttribute("style","display:none"),_r.setAttribute("muted",""),_r.muted=!0,_r.setAttribute("autoplay",""),_r.autoplay=!0,_r.setAttribute("playsinline",""),_o.width=MR(_t.width),_o.height=MR(_t.height);const _a=MR(_t.framerate||15);document.body.append(_r),document.body.append(_o);let _u=_e._mediaStreamTrack;_r.srcObject=new MediaStream([_u]),_r.play();const yl=_o.getContext("2d");if(!yl)throw new Tp(Ql.UNEXPECTED_ERROR,"can not get canvas context");const Rl=R_(),Al=_o.captureStream(Rl.supportRequestFrame?0:_a).getVideoTracks()[0],Ol=P7(()=>(()=>{if(_r.paused&&_r.play(),_r.videoHeight>2&&_r.videoWidth>2){const Ll=_r.videoWidth,Bl=_r.videoHeight/Ll,Hl=_o.width*Bl;Math.abs(Hl-_o.height)>=2&&(Vl.debug("adjust low stream resolution","".concat(_o.width,"x").concat(_o.height," -> ").concat(_o.width,"x").concat(Hl)),_o.height=Hl)}yl.drawImage(_r,0,0,_o.width,_o.height),Al.requestFrame&&Al.requestFrame(),_u!==_e._mediaStreamTrack&&(_u=_e._mediaStreamTrack,_r.srcObject=new MediaStream([_u]))})(),_a),xl=Al.stop;return Al.stop=()=>{xl.call(Al),Ol(),_r&&(_r.remove(),_r=null),_o&&(_o.width=0,_o.remove(),_o=null),Vl.debug("clean low stream renderer")},Al}var Hz,Kz,qz,zz,gS,Jz,eY,tY,nY,rY,iY,X_;function oY(_e,_t){var _r=Object.keys(_e);if(Object.getOwnPropertySymbols){var _o=Object.getOwnPropertySymbols(_e);_t&&(_o=_o.filter(function(_a){return Object.getOwnPropertyDescriptor(_e,_a).enumerable})),_r.push.apply(_r,_o)}return _r}function mU(_e){for(var _t=1;_t<arguments.length;_t++){var _r=arguments[_t]!=null?arguments[_t]:{};_t%2?oY(Object(_r),!0).forEach(function(_o){Ml(_e,_o,_r[_o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_e,Object.getOwnPropertyDescriptors(_r)):oY(Object(_r)).forEach(function(_o){Object.defineProperty(_e,_o,Object.getOwnPropertyDescriptor(_r,_o))})}return _e}class sY extends O7{getUserId(){return this._userId}constructor(_t,_r,_o,_a){super(_t,"track-".concat(_t.kind,"-").concat(_r,"-").concat(_a.clientId,"_").concat(Ny(5,""))),Ml(this,"_userId",void 0),Ml(this,"_uintId",void 0),Ml(this,"_isDestroyed",!1),Ml(this,"store",void 0),Ml(this,"processor",void 0),Ml(this,"processorContext",void 0),this._userId=_r,this._uintId=_o,this.store=_a}_updateOriginMediaStreamTrack(_t){this._originMediaStreamTrack=_t,this._mediaStreamTrack=_t,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,Vl.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let yU=(Hz=_0({argsMap:(_e,_t,_r)=>[_e.getTrackId(),typeof _t=="string"?_t:_t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",_r]}),Kz=_0({argsMap:_e=>[_e.getTrackId()]}),qz=_0({argsMap:(_e,_t)=>[_e.getTrackId(),_t.name]}),zz=_0({argsMap:_e=>[_e.getTrackId()]}),Yp((gS=class extends sY{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==j_.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(_e,_t,_r,_o){super(_e,_t,_r,_o),Ml(this,"_videoVisibleTimer",null),Ml(this,"_previousVideoVisibleStatus",void 0),Ml(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),Ml(this,"trackMediaType","video"),Ml(this,"_videoWidth",void 0),Ml(this,"_videoHeight",void 0),Ml(this,"_player",void 0),Ml(this,"processorDestination",void 0),Ml(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new G7(this.getTrackId(),"remote"),this.processorDestination=new V7(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return l2(()=>{Vl.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),cR(this,w0.GET_STATS)||mU({},s7)}play(_e){let _t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof _e=="string"){const _o=document.getElementById(_e);_o?_e=_o:(Vl.warning("[".concat(this.getTrackId(),'] can not find "#').concat(_e,'" element, use document.body')),_e=document.body)}Vl.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(_e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(_t));const _r=mU(mU({fit:"cover"},_t),{},{trackId:this.getTrackId(),element:_e});this._player?this._player.updateConfig(_r):(_e instanceof HTMLVideoElement?this._player=new q4(_r):this._player=new kq(_r),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.emit(aN.FIRST_FRAME_DECODED)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const _o=this.getVideoElementVisibleStatus();this.emit(aN.VIDEO_ELEMENT_VISIBLE_STATUS,_o)}catch{}},Pp("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,Vl.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){UW(this._originMediaStreamTrack).then(_e=>{let[_t,_r]=_e;this._videoHeight=_r,this._videoWidth=_t}).catch(nU)}_updatePlayerSource(){Vl.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var _e,_t;const _r=this==null||(_e=this._player)===null||_e===void 0?void 0:_e.getContainerElement(),_o={track:this,element:this==null||(_t=this._player)===null||_t===void 0?void 0:_t.getVideoElement(),slot:_r==null?void 0:_r.parentElement},{element:_a,slot:_u}=_o;if(this.isPlaying&&_a instanceof HTMLVideoElement&&_u instanceof HTMLElement){const yl=P9.checkOneElementVisible(_a),Rl=Object.assign({},yl);if(Rl.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=Rl.visible;const Al=g0.reportApiInvoke(null,{tag:jy.TRACER,name:c_.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});Rl.visible?Al.onSuccess("Video is visible"):Al.onSuccess("Invisible because of ".concat(Rl.reason))}return Rl}return}catch(_r){throw new Tp(Ql.GET_VIDEO_ELEMENT_VISIBLE_ERROR,_r.message)}}pipe(_e){if(this.processor===_e)return _e;if(_e._source)throw new Tp(Ql.INVALID_OPERATION,"Processor ".concat(_e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=_e,this.processor._source=this,_e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),_e}unpipe(){if(!this.processor)return;const _e=this.processor;this.processor._source=void 0,this.processor=void 0,_e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on($_.ON_TRACK,async _e=>{_e?_e!==this._mediaStreamTrack&&(this._mediaStreamTrack=_e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners($_.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}}).prototype,"play",[Hz],Object.getOwnPropertyDescriptor(gS.prototype,"play"),gS.prototype),Yp(gS.prototype,"stop",[Kz],Object.getOwnPropertyDescriptor(gS.prototype,"stop"),gS.prototype),Yp(gS.prototype,"pipe",[qz],Object.getOwnPropertyDescriptor(gS.prototype,"pipe"),gS.prototype),Yp(gS.prototype,"unpipe",[zz],Object.getOwnPropertyDescriptor(gS.prototype,"unpipe"),gS.prototype),gS),vU=(Jz=_0({argsMap:(_e,_t)=>[_e.getTrackId(),_t],throttleTime:300}),eY=_0({argsMap:(_e,_t)=>[_e.getTrackId(),_t]}),tY=_0({argsMap:_e=>[_e.getTrackId()]}),nY=_0({argsMap:_e=>[_e.getTrackId()]}),rY=_0({argsMap:(_e,_t)=>[_e.getTrackId(),_t.name]}),iY=_0({argsMap:_e=>[_e.getTrackId()]}),Yp((X_=class extends sY{get isPlaying(){return this._useAudioElement?kT.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(_e,_t,_r,_o){super(_e,_t,_r,_o),Ml(this,"trackMediaType","audio"),Ml(this,"_source",void 0),Ml(this,"_useAudioElement",!0),Ml(this,"_volume",100),Ml(this,"processorContext",void 0),Ml(this,"processorDestination",void 0),Ml(this,"_played",!1),Ml(this,"_bypassWebAudio",!1),Pp("DISABLE_WEBAUDIO")?(this._source=new P4,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new C4(_e,!0),Pp("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(_T.RECEIVE_TRACK_BUFFER,()=>{this.emit(aN.FIRST_FRAME_DECODED)}),this.processorContext=new H7(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new W7(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(_T.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(_e){let _t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!_e)return this._source.removeAllListeners(_T.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(_t),this._source.removeAllListeners(_T.ON_AUDIO_BUFFER),this._source.on(_T.ON_AUDIO_BUFFER,_r=>_e(_r))}setVolume(_e){this._volume=_e,this._useAudioElement?kT.setVolume(this.getTrackId(),_e):this._source.setVolume(_e/100)}async setPlaybackDevice(_e){if(!this._useAudioElement)throw new Tp(Ql.NOT_SUPPORTED,"your browser does not support setting the audio output device");await kT.setSinkID(this.getTrackId(),_e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return l2(()=>{Vl.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),cR(this,w0.GET_STATS)||mU({},o7)}play(){Vl.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(Vl.debug("[".concat(this.getTrackId(),"] use audio element to play")),kT.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){Vl.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?kT.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let _e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];Vl.debug("[".concat(this.getTrackId(),"] update player source track")),_e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&kT.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(_e){if(this._bypassWebAudio)throw new Tp(Ql.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===_e)return _e;if(_e._source)throw new Tp(Ql.INVALID_OPERATION,"Processor ".concat(_e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=_e,this.processor._source=this,_e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),_e}unpipe(){var _e;if(this._bypassWebAudio)throw new Tp(Ql.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const _t=this.processor;(_e=this._source.processSourceNode)===null||_e===void 0||_e.disconnect(),this.processor._source=!1,this.processor=void 0,_t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on($_.ON_TRACK,async _e=>{_e?_e!==this._mediaStreamTrack&&(this._mediaStreamTrack=_e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(_e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on($_.ON_NODE,_e=>{this._source.processedNode=_e;const _t=!_e;this._useAudioElement!==_t&&(this._played?(this.stop(),this._useAudioElement=_t,this.play()):this._useAudioElement=_t)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners($_.ON_TRACK),this.processorDestination.removeAllListeners($_.ON_NODE)}}).prototype,"setVolume",[Jz],Object.getOwnPropertyDescriptor(X_.prototype,"setVolume"),X_.prototype),Yp(X_.prototype,"setPlaybackDevice",[eY],Object.getOwnPropertyDescriptor(X_.prototype,"setPlaybackDevice"),X_.prototype),Yp(X_.prototype,"play",[tY],Object.getOwnPropertyDescriptor(X_.prototype,"play"),X_.prototype),Yp(X_.prototype,"stop",[nY],Object.getOwnPropertyDescriptor(X_.prototype,"stop"),X_.prototype),Yp(X_.prototype,"pipe",[rY],Object.getOwnPropertyDescriptor(X_.prototype,"pipe"),X_.prototype),Yp(X_.prototype,"unpipe",[iY],Object.getOwnPropertyDescriptor(X_.prototype,"unpipe"),X_.prototype),X_);function aY(_e,_t){var _r=Object.keys(_e);if(Object.getOwnPropertySymbols){var _o=Object.getOwnPropertySymbols(_e);_t&&(_o=_o.filter(function(_a){return Object.getOwnPropertyDescriptor(_e,_a).enumerable})),_r.push.apply(_r,_o)}return _r}function cY(_e){for(var _t=1;_t<arguments.length;_t++){var _r=arguments[_t]!=null?arguments[_t]:{};_t%2?aY(Object(_r),!0).forEach(function(_o){Ml(_e,_o,_r[_o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_e,Object.getOwnPropertyDescriptors(_r)):aY(Object(_r)).forEach(function(_o){Object.defineProperty(_e,_o,Object.getOwnPropertyDescriptor(_r,_o))})}return _e}class gre extends Hy{constructor(){super(),Ml(this,"uplinkStatsUploadInterval",void 0),Ml(this,"uplinkStatsUploadSlowInterval",void 0),Ml(this,"uplinkRelatedStatsUploadInterval",void 0),Ml(this,"uplinkDenoiserStatsUploadInterval",void 0),Ml(this,"transportStatsUploadInterval",void 0),Ml(this,"uplinkExtensionStatsUploadInterval",void 0),Ml(this,"downlinkExtensionStatsUploadInterval",void 0),Ml(this,"extensionUsageStatsUploadInterval",void 0),Ml(this,"downlinkStatsUploadInterval",void 0),Ml(this,"downlinkStatsUploadSlowInterval",void 0),Ml(this,"downlinkRelatedStatsUploadInterval",void 0),Ml(this,"lastStats",void 0),Ml(this,"uploadUnplinkStarted",!1),Ml(this,"uploadDownlinkStarted",!1),Ml(this,"uploadTransportStarted",!1),Ml(this,"uploadExtensionUsageStarted",!1),Ml(this,"requestStats",void 0),Ml(this,"requestLocalMedia",void 0),Ml(this,"requestRemoteMedia",void 0),Ml(this,"requestAllTracks",void 0),Ml(this,"requestVideoIsReady",void 0),Ml(this,"requestUpload",void 0)}startUploadTransportStats(){this.uploadTransportStarted||(this.uploadTransportStarted=!0,this.transportStatsUploadInterval&&window.clearInterval(this.transportStatsUploadInterval),this.transportStatsUploadInterval=window.setInterval(()=>{var _t;const _r=(_t=this.requestStats)===null||_t===void 0?void 0:_t.call(this);_r&&this.uploadTransportStats(_r)},1e3))}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.extensionUsageStatsUploadInterval&&window.clearInterval(this.extensionUsageStatsUploadInterval);const _t=new Map;this.extensionUsageStatsUploadInterval=window.setInterval(async()=>{var _r,_o,_a;const _u=Date.now(),yl={connectionInterval:Pp("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:_u};let Rl=[];const Al=((_r=this.requestAllTracks)===null||_r===void 0?void 0:_r.call(this))||[];for(const Bl of Al)!Bl.muted&&Bl.enabled&&(Rl=Rl.concat(await Bl.getProcessorUsage()));const Ol=((_o=this.requestRemoteMedia)===null||_o===void 0?void 0:_o.call(this))||[];for(const[Bl,Hl]of Ol)Hl.has(P0.VIDEO)&&Bl.videoTrack&&(Rl=Rl.concat(await Bl.videoTrack.getProcessorUsage())),Hl.has(P0.AUDIO)&&Bl.audioTrack&&(Rl=Rl.concat(await Bl.audioTrack.getProcessorUsage()));if(Rl.length===0)return;yl.details=function(Bl,Hl){const up={};for(const{id:Bp,value:_g,level:y0,direction:e0}of Bl){var _f;const r0=(_f=Hl.get(Bp))!==null&&_f!==void 0?_f:0,Zp=_g===2?r0+Pp("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:r0;var vp,Dp;Hl.set(Bp,Zp),up[Bp]?(_g===2&&(up[Bp].value=_g),y0>up[Bp].level&&(up[Bp].level=y0),e0==="remote"&&(up[Bp].remoteUidCount+=1),up[Bp].totalTs=(vp=Hl.get(Bp))!==null&&vp!==void 0?vp:0):up[Bp]={value:_g,level:y0,remoteUidCount:e0==="local"?0:1,totalTs:(Dp=Hl.get(Bp))!==null&&Dp!==void 0?Dp:0}}return Object.keys(up).map(Bp=>{const{level:_g,value:y0,totalTs:e0}=up[Bp];return{id:Bp,level:_g,value:y0,totalTs:e0}})}(Rl,_t);const xl=Date.now(),Ll=xl>_u?xl:_u+1;(_a=this.requestUpload)===null||_a===void 0||_a.call(this,ET.EXTENSION_USAGE_STATS,{usageStats:yl,sendTs:Ll})},Pp("EXTENSION_USAGE_UPLOAD_INTERVAL"))}startUploadUplinkStats(){this.uploadUnplinkStarted||(this.uploadUnplinkStarted=!0,this.uplinkStatsUploadInterval&&window.clearInterval(this.uplinkStatsUploadInterval),this.uplinkStatsUploadInterval=window.setInterval(()=>{var _t;const _r=(_t=this.requestStats)===null||_t===void 0?void 0:_t.call(this);_r&&(this.uploadUplinkStats(_r),this.lastStats=_r)},3e3),this.uplinkStatsUploadSlowInterval&&window.clearInterval(this.uplinkStatsUploadSlowInterval),this.uplinkStatsUploadSlowInterval=window.setInterval(()=>{var _t;const _r=(_t=this.requestStats)===null||_t===void 0?void 0:_t.call(this);_r&&this.uploadSlowUplinkStats(_r)},6e4),this.uplinkRelatedStatsUploadInterval&&window.clearInterval(this.uplinkRelatedStatsUploadInterval),this.uplinkRelatedStatsUploadInterval=window.setInterval(()=>{var _t;const _r=(_t=this.requestStats)===null||_t===void 0?void 0:_t.call(this);_r&&this.uploadRelatedUplinkStats(_r,this.lastStats),this.lastStats=_r},1e3),this.uplinkDenoiserStatsUploadInterval&&window.clearInterval(this.uplinkDenoiserStatsUploadInterval),this.uplinkDenoiserStatsUploadInterval=window.setInterval(()=>{var _t;const _r=(_t=this.requestAllTracks)===null||_t===void 0?void 0:_t.call(this);_r&&this.uploadDenoiserStats(_r)},2e3),this.uplinkExtensionStatsUploadInterval&&window.clearInterval(this.uplinkExtensionStatsUploadInterval),this.uplinkExtensionStatsUploadInterval=window.setInterval(()=>{var _t;const _r=(_t=this.requestAllTracks)===null||_t===void 0?void 0:_t.call(this);_r&&this.uploadExtensionStats(_r)},2e3))}uploadTransportStats(_t){IS(()=>{var _r;(_r=this.requestUpload)===null||_r===void 0||_r.call(this,ET.TRANSPORT_STATS,function(_o){const _a={connectionType:100,googRtt:_o.rtt};if(_o.selectedCandidatePair.localCandidate.candidateType==="relay"){const _u=_o.selectedCandidatePair.localCandidate.relayProtocol;_u==="udp"&&(_a.connectionType=101),_u==="tcp"&&(_a.connectionType=103),_u==="tls"&&(_a.connectionType=104)}return _a}(_t))})}uploadUplinkStats(_t){var _r;(((_r=this.requestLocalMedia)===null||_r===void 0?void 0:_r.call(this))||[]).forEach(_o=>{let[_a,{track:_u,ssrcs:yl}]=_o;switch(_a){case l0.LocalVideoLowTrack:case l0.LocalVideoTrack:{const Rl=function(xl,Ll,Bl){var Hl;const up=Ll.videoSend.find(vp=>vp.ssrc===xl);if(!up)return null;const _f={id:Ny(10,""),timestamp:new Date(Ll.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:up.ssrc.toString()};switch(_f.A_vstd=Bl._originMediaStreamTrack&&!Bl._originMediaStreamTrack.enabled||Bl._mediaStreamTrack&&!Bl._mediaStreamTrack.enabled?"1":"0",up.sentFrame&&(_f.A_fhs=up.sentFrame.height.toString(),_f.A_frs=up.sentFrame.frameRate.toString(),_f.A_fws=up.sentFrame.width.toString()),up.adaptionChangeReason){case"none":_f.A_ac="0";break;case"cpu":_f.A_ac="1";break;case"bandwidth":_f.A_ac="2";break;case"other":_f.A_ac="3"}return _f.A_lvps=u4[Bl._player?Bl._player.videoElementStatus:"uninit"].toString(),_f.A_nr=(Hl=up.nacksCount)===null||Hl===void 0?void 0:Hl.toString(),up.avgEncodeMs&&(_f.A_aem=up.avgEncodeMs.toFixed(0).toString()),_f}(yl[0].ssrcId,_t,_u),Al=_a===l0.LocalVideoTrack?LW(yl[0].ssrcId,_t,_u):null;Rl&&IS(()=>{var xl;return(xl=this.requestUpload)===null||xl===void 0?void 0:xl.call(this,ET.PUBLISH_STATS,{stream_type:_a===l0.LocalVideoLowTrack?"low":"high",stats:cY(cY({},Rl),Al)})});const Ol=function(xl){const Ll={id:"bweforvideo",timestamp:new Date(xl.timestamp).toISOString(),type:"VideoBwe"};return xl.bitrate.retransmit&&(Ll.A_rb=xl.bitrate.retransmit.toString()),xl.bitrate.targetEncoded&&(Ll.A_teb=xl.bitrate.targetEncoded.toString()),Ll.A_aeb=xl.bitrate.actualEncoded.toString(),Ll.A_tb=xl.bitrate.transmit.toString(),xl.sendBandwidth!==void 0&&(Ll.A_asb=xl.sendBandwidth.toString()),Ll}(_t);Ol&&setTimeout(()=>{var xl;return(xl=this.requestUpload)===null||xl===void 0?void 0:xl.call(this,ET.PUBLISH_STATS,{stream_type:_a===l0.LocalVideoLowTrack?"low":"high",stats:Ol})},1e3);break}case l0.LocalAudioTrack:{const Rl=function(Al,Ol,xl){const Ll=Ol.audioSend.find(Hl=>Hl.ssrc===Al);if(!Ll)return null;const Bl={id:Ny(10,""),timestamp:new Date(Ol.timestamp).toISOString(),mediaType:"audio",type:"ssrc",ssrc:Ll.ssrc.toString()};return Bl.A_astd=xl._originMediaStreamTrack.enabled&&xl._mediaStreamTrack.enabled?"0":"1",Ll.inputLevel?Bl.A_ail=Math.round(100*Ll.inputLevel).toString():Bl.A_ail=Math.round(100*xl._source.getAccurateVolumeLevel()).toString(),Bl.A_apil=Math.round(100*xl._source.getAccurateVolumeLevel()).toString(),Ll.aecReturnLoss&&(Bl.A_ecrl=Math.round(Ll.aecReturnLoss).toString()),Ll.aecReturnLossEnhancement&&(Bl.A_ecrle=Math.round(Ll.aecReturnLossEnhancement).toString()),Bl}(yl[0].ssrcId,_t,_u);Rl&&IS(()=>{var Al;return(Al=this.requestUpload)===null||Al===void 0?void 0:Al.call(this,ET.PUBLISH_STATS,{stream_type:"high",stats:Rl})});break}}})}uploadSlowUplinkStats(_t){var _r;(((_r=this.requestLocalMedia)===null||_r===void 0?void 0:_r.call(this))||[]).filter(_o=>{let[_a]=_o;return _a===l0.LocalVideoLowTrack||_a===l0.LocalVideoTrack}).forEach(_o=>{let[_a,{ssrcs:_u}]=_o;const yl=LW(_u[0].ssrcId,_t);yl&&IS(()=>{var Rl;return(Rl=this.requestUpload)===null||Rl===void 0?void 0:Rl.call(this,ET.PUBLISH_STATS,{stream_type:_a===l0.LocalVideoLowTrack?"low":"high",stats:yl})})})}uploadRelatedUplinkStats(_t,_r){var _o;(((_o=this.requestLocalMedia)===null||_o===void 0?void 0:_o.call(this))||[]).filter(_a=>{let[_u]=_a;return _u===l0.LocalVideoLowTrack||_u===l0.LocalVideoTrack}).forEach(_a=>{let[_u,{ssrcs:yl}]=_a;const Rl=function(Al,Ol){const xl=Ol.videoSend.find(Ll=>Ll.ssrc===Al);return xl?{mediaType:"video",isVideoMute:!1,frameRateInput:xl.inputFrame&&xl.inputFrame.frameRate.toString(),frameRateSent:xl.sentFrame&&xl.sentFrame.frameRate.toString(),googRtt:xl.rttMs.toString(),qpSumPerFrame:Math.floor(xl.qpSumPerFrame).toString()}:null}(yl[0].ssrcId,_t);Rl&&IS(()=>{var Al;(Al=this.requestUpload)===null||Al===void 0||Al.call(this,ET.PUBLISH_RELATED_STATS,{stream_type:_u===l0.LocalVideoLowTrack?"low":"high",stats:Rl})})})}uploadDenoiserStats(_t){for(let _u=0;_u<_t.length;_u++){const yl=_t[_u];if(yl instanceof Q5){var _r,_o,_a;const Rl=(_r=(_o=yl._external).getDenoiserStats)===null||_r===void 0?void 0:_r.call(_o);return void(Rl&&((_a=this.requestUpload)===null||_a===void 0||_a.call(this,ET.DENOISER_STATS,Rl)))}}}uploadExtensionStats(_t){for(let _r=0;_r<_t.length;_r++)_t[_r].getProcessorStats().forEach(_o=>{var _a;(_a=this.requestUpload)===null||_a===void 0||_a.call(this,_o.type,_o.stats)})}stopUploadUplinkStats(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStatsUploadInterval&&window.clearInterval(this.uplinkStatsUploadInterval),this.uplinkRelatedStatsUploadInterval&&window.clearInterval(this.uplinkRelatedStatsUploadInterval),this.uplinkDenoiserStatsUploadInterval&&window.clearInterval(this.uplinkDenoiserStatsUploadInterval),this.uplinkStatsUploadInterval=void 0,this.uplinkRelatedStatsUploadInterval=void 0,this.uplinkDenoiserStatsUploadInterval=void 0)}startUploadDownlinkStats(){if(this.uploadDownlinkStarted)return;let _t;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);let _r=!1;this.downlinkStatsUploadInterval=window.setInterval(()=>{var _o;const _a=(_o=this.requestStats)===null||_o===void 0?void 0:_o.call(this);_a&&(this.uploadDownlinkStats(_a,_r,_t),_t=_a),_r=!_r},3e3),this.downlinkStatsUploadSlowInterval&&window.clearInterval(this.downlinkStatsUploadSlowInterval),this.downlinkStatsUploadSlowInterval=window.setInterval(()=>{var _o;const _a=(_o=this.requestStats)===null||_o===void 0?void 0:_o.call(this);_a&&this.uploadSlowDownlinkStats(_a)},6e4),this.downlinkRelatedStatsUploadInterval&&window.clearInterval(this.downlinkRelatedStatsUploadInterval),this.downlinkRelatedStatsUploadInterval=window.setInterval(()=>{var _o;const _a=(_o=this.requestStats)===null||_o===void 0?void 0:_o.call(this);_a&&(this.uploadRelatedDownlinkStats(_a,this.lastStats),this.lastStats=_a)},1e3),this.downlinkExtensionStatsUploadInterval&&window.clearInterval(this.downlinkExtensionStatsUploadInterval),this.downlinkExtensionStatsUploadInterval=window.setInterval(()=>{var _o;const _a=(_o=this.requestRemoteMedia)===null||_o===void 0?void 0:_o.call(this);_a&&this.uploadDownlinkExtensionStats(_a)},2e3)}uploadDownlinkStats(_t,_r,_o){var _a;(((_a=this.requestRemoteMedia)===null||_a===void 0?void 0:_a.call(this))||[]).forEach(_u=>{let[yl,Rl]=_u;if(Rl.has(P0.VIDEO)&&yl.videoTrack){const Al=yl.videoTrack?function(Ol,xl,Ll,Bl,Hl){const up=xl.videoRecv.find(Bp=>Bp.ssrc===Ol);if(!up)return null;const _f={id:Ny(10,""),timestamp:new Date(xl.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:up.ssrc.toString()};var vp,Dp;if(_f.bytesReceived=up.bytes.toString(),_f.packetsLost=up.packetsLost.toString(),_f.packetsReceived=up.packets.toString(),up.framesRateFirefox&&(_f.A_frr=up.framesRateFirefox.toString()),up.receivedFrame?(_f.A_frr=up.receivedFrame.frameRate.toString(),_f.A_fhr=up.receivedFrame.height.toString(),_f.A_fwr=up.receivedFrame.width.toString()):(_f.A_fhr=(vp=Bl._videoHeight)===null||vp===void 0?void 0:vp.toString(),_f.A_fwr=(Dp=Bl._videoWidth)===null||Dp===void 0?void 0:Dp.toString()),_f.A_frd=up.decodeFrameRate.toString(),up.outputFrame&&(_f.A_fro=up.outputFrame.frameRate.toString()),up.jitterBufferMs!==void 0&&(_f.A_jbm=Math.floor(up.jitterBufferMs).toString()),up.currentDelayMs!==void 0&&(_f.A_cdm=Math.floor(up.currentDelayMs).toString()),_f.A_fs=up.firsCount.toString(),_f.A_ns=up.nacksCount.toString(),_f.A_ps=up.plisCount.toString(),Bl&&(_f.A_vrtd=Bl._originMediaStreamTrack.enabled&&Bl._mediaStreamTrack.enabled?"0":"1"),Bl._player&&Bl._player.freezeTimeCounterList.length>0&&(_f.A_vrft=Math.round(Bl._player.freezeTimeCounterList.splice(0,1)[0]).toString()),Hl&&Bl._player&&DR.visibility==="visible"){const Bp=Math.min(6e3,Bl._player.renderFreezeAccTime);_f.A_vrrft=Math.round(Bp).toString(),Bl._player.renderFreezeAccTime=Math.max(0,Bl._player.renderFreezeAccTime-Bp)}if(_f.A_rvps=u4[Bl._player?Bl._player.videoElementStatus:"uninit"].toString(),Ll){const Bp=Ll.videoRecv.find(_g=>_g.ssrc===Ol);if(Bp&&up.totalInterFrameDelay!==void 0&&up.totalSquaredInterFrameDelay!==void 0&&Bp.totalInterFrameDelay!==void 0&&Bp.totalSquaredInterFrameDelay!==void 0){const _g=up.totalInterFrameDelay-Bp.totalInterFrameDelay,y0=up.totalSquaredInterFrameDelay-Bp.totalSquaredInterFrameDelay,e0=up.framesDecodeCount-Bp.framesDecodeCount,r0=_g/e0*1e3,Zp=Math.round(1e3*Math.sqrt((y0-Math.pow(_g,2)/e0)/e0));!isNaN(Zp)&&r0+Zp>Math.max(3*r0,r0+150)&&(_f.A_ifdsd=Zp.toString())}}return _f}(yl._videoSSRC,_t,_o,yl.videoTrack,_r):void 0;Al&&IS(()=>{var Ol;return(Ol=this.requestUpload)===null||Ol===void 0?void 0:Ol.call(this,ET.SUBSCRIBE_STATS,{stream_id:yl.uid,stats:Al})})}if(Rl.has(P0.AUDIO)&&yl.audioTrack){const Al=yl.audioTrack?function(Ol,xl,Ll,Bl){const Hl=xl.audioRecv.find(_f=>_f.ssrc===Ol);if(!Hl)return null;const up={id:Ny(10,""),timestamp:new Date(xl.timestamp).toISOString(),mediaType:"audio",type:"ssrc",ssrc:Hl.ssrc.toString()};if(up.bytesReceived=Hl.bytes.toString(),up.packetsLost=Hl.packetsLost.toString(),up.packetsReceived=Hl.packets.toString(),Hl.outputLevel?up.A_aol=Math.round(100*Hl.outputLevel).toString():up.A_aol=Math.round(100*Bl._source.getAccurateVolumeLevel()).toString(),up.A_apol=Math.round(100*Bl._source.getAccurateVolumeLevel()).toString(),Bl&&(up.A_artd=Bl._originMediaStreamTrack.enabled&&Bl._mediaStreamTrack.enabled?"0":"1"),up.A_jr=Hl.jitterMs.toString(),up.A_jbm=Math.floor(Hl.jitterBufferMs).toString(),up.A_cdm=Math.floor(Hl.jitterBufferMs).toString(),up.A_raps=u4[kT.getPlayerState(Bl.getTrackId())].toString(),Ll){const _f=Ll.audioRecv.find(vp=>vp.ssrc===Ol);if(_f){const vp=Hl.concealedSamples-_f.concealedSamples;vp>0&&(up.A_cs=Math.round(vp).toString())}}return up}(yl._audioSSRC,_t,_o,yl.audioTrack):void 0;Al&&IS(()=>{var Ol;return(Ol=this.requestUpload)===null||Ol===void 0?void 0:Ol.call(this,ET.SUBSCRIBE_STATS,{stream_id:yl.uid,stats:Al})})}})}uploadSlowDownlinkStats(_t){}uploadRelatedDownlinkStats(_t,_r){var _o;(((_o=this.requestRemoteMedia)===null||_o===void 0?void 0:_o.call(this))||[]).forEach(_a=>{let[_u,yl]=_a;if(yl.has(P0.VIDEO)&&_u.videoTrack){var Rl;const Al=(_u._videoSSRC&&((Rl=this.requestVideoIsReady)===null||Rl===void 0?void 0:Rl.call(this,_u._videoSSRC))||!1)===!0,Ol=function(xl,Ll,Bl,Hl,up,_f){const vp=Bl.videoRecv.find(y0=>y0.ssrc===xl),Dp=up?up.videoRecv.find(y0=>y0.ssrc===xl):void 0;if(!vp)return null;const Bp=hN.isRemoteVideoFreeze(_f,vp,Dp)&&Ll,_g={mediaType:"video",isVideoMute:!1,peerId:Hl,frameRateReceived:vp.receivedFrame&&vp.receivedFrame.frameRate.toString(),frameRateDecoded:vp.decodedFrame&&vp.decodedFrame.frameRate.toString(),isFreeze:Bp,bytesReceived:vp.bytes.toString(),packetsReceived:vp.packets.toString(),packetsLost:vp.packetsLost.toString(),qpSumPerFrame:Math.floor(vp.qpSumPerFrame).toString()};return vp.framesRateFirefox&&(_g.frameRateDecoded=vp.framesRateFirefox.toString(),_g.frameRateReceived=vp.framesRateFirefox.toString()),_g}(_u._videoSSRC,Al,_t,_u.uid,_r,_u.videoTrack);Ol&&IS(()=>{var xl;(xl=this.requestUpload)===null||xl===void 0||xl.call(this,ET.SUBSCRIBE_RELATED_STATS,{stream_id:_u.uid,stats:Ol})})}if(yl.has(P0.AUDIO)&&_u.audioTrack){const Al=function(Ol,xl,Ll,Bl){const Hl=xl.audioRecv.find(_f=>_f.ssrc===Ol);if(!Hl)return null;const up=hN.isRemoteAudioFreeze(Bl);return{mediaType:"audio",isAudioMute:!1,peerId:Ll,googJitterReceived:Hl.jitterMs.toString(),isFreeze:up,bytesReceived:Hl.bytes.toString(),packetsReceived:Hl.packets.toString(),packetsLost:Hl.packetsLost.toString(),frameReceived:Hl.receivedFrames.toString(),frameDropped:Hl.droppedFrames.toString()}}(_u._audioSSRC,_t,_u.uid,_u.audioTrack);Al&&IS(()=>{var Ol;(Ol=this.requestUpload)===null||Ol===void 0||Ol.call(this,ET.SUBSCRIBE_RELATED_STATS,{stream_id:_u.uid,stats:Al})})}})}stopUploadDownlinkStats(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval),this.downlinkRelatedStatsUploadInterval&&window.clearInterval(this.downlinkRelatedStatsUploadInterval),this.downlinkStatsUploadInterval=void 0,this.downlinkRelatedStatsUploadInterval=void 0)}stopUploadTransportStats(){this.uploadTransportStarted&&(this.uploadTransportStarted=!1,this.transportStatsUploadInterval&&window.clearInterval(this.transportStatsUploadInterval),this.transportStatsUploadInterval=void 0)}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.extensionUsageStatsUploadInterval&&window.clearInterval(this.extensionUsageStatsUploadInterval),this.extensionUsageStatsUploadInterval=void 0)}uploadDownlinkExtensionStats(_t){_t.forEach(_r=>{let[_o,_a]=_r;_a.has(P0.VIDEO)&&_o.videoTrack&&_o.videoTrack.getProcessorStats().forEach(_u=>{var yl;(yl=this.requestUpload)===null||yl===void 0||yl.call(this,_u.type,_u.stats)}),_a.has(P0.AUDIO)&&_o.audioTrack&&_o.audioTrack.getProcessorStats().forEach(_u=>{var yl;(yl=this.requestUpload)===null||yl===void 0||yl.call(this,_u.type,_u.stats)})})}}const uY=`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0
a=msid-semantic: WMS
a=ice-lite
m=application 9 UDP/DTLS/SCTP webrtc-datachannel
c=IN IP4 127.0.0.1
a=mid:0
`,EU="9",v$=2e4,E$=4e4;class mre{get localCapabilities(){return r_(this._localCapabilities)}get rtpCapabilities(){return r_(this._rtpCapabilities)}get candidates(){return r_(this._candidates)}get iceParameters(){return r_(this._iceParameters)}get dtlsParameters(){return r_(this._dtlsParameters)}constructor(_t){Ml(this,"sessionDesc",void 0),Ml(this,"_localCapabilities",void 0),Ml(this,"_rtpCapabilities",void 0),Ml(this,"_candidates",void 0),Ml(this,"_iceParameters",void 0),Ml(this,"_dtlsParameters",void 0),Ml(this,"setup",void 0),Ml(this,"currentMidIndex",void 0),Ml(this,"cname",void 0),Ml(this,"firefoxSsrcMidMap",new Map),_t=r_(_t);const{remoteIceParameters:_r,remoteDtlsParameters:_o,candidates:_a,remoteRTPCapabilities:_u,remoteSetup:yl,localCapabilities:Rl,cname:Al}=_t,Ol=o_.exports.parse(uY);this._rtpCapabilities=_u,this._candidates=_a,this._iceParameters=_r,this._dtlsParameters=_o,this._localCapabilities=Rl,this.setup=yl,this.cname=Al;const xl=this.rtpCapabilities.send;for(const Ll of Ol.mediaDescriptions){if(Ll.attributes.iceUfrag=_r.iceUfrag,Ll.attributes.icePwd=_r.icePwd,Ll.attributes.fingerprints=_o.fingerprints,Ll.attributes.candidates=_a,Ll.attributes.setup=yl,Ll.media.mediaType==="application"&&(Ll.attributes.sctpPort="5000"),Ll.media.mediaType==="video"&&(Ll.media.fmts=xl.videoCodecs.map(Bl=>Bl.payloadType.toString(10)),Ll.attributes.payloads=xl.videoCodecs,Ll.attributes.extmaps=xl.videoExtensions,Pp("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:Bl,ssrcGroups:Hl}=hS([{ssrcId:E$,rtx:Pp("USE_RTX")?40001:void 0}],this.cname);Ll.attributes.ssrcs=Bl,Ll.attributes.ssrcGroups=Hl}if(Ll.media.mediaType==="audio"&&(Ll.media.fmts=xl.audioCodecs.map(Bl=>Bl.payloadType.toString(10)),Ll.attributes.payloads=xl.audioCodecs,Ll.attributes.extmaps=xl.audioExtensions,v1(Ll),Pp("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:Bl,ssrcGroups:Hl}=hS([{ssrcId:v$}],this.cname);Ll.attributes.ssrcs=Bl,Ll.attributes.ssrcGroups=Hl}}this.sessionDesc=Ol,this.currentMidIndex=Ol.mediaDescriptions.length-1}updateRemoteRTPCapabilities(_t){const _r=o_.exports.parse(uY);this._rtpCapabilities=_t;const _o=this.rtpCapabilities.send;for(const _a of _r.mediaDescriptions){if(_a.attributes.iceUfrag=this._iceParameters.iceUfrag,_a.attributes.icePwd=this._iceParameters.icePwd,_a.attributes.fingerprints=this._dtlsParameters.fingerprints,_a.attributes.candidates=this._candidates,_a.attributes.setup=this.setup,_a.media.mediaType==="application"&&(_a.attributes.sctpPort="5000"),_a.media.mediaType==="video"&&(_a.media.fmts=_o.videoCodecs.map(_u=>_u.payloadType.toString(10)),_a.attributes.payloads=_o.videoCodecs,_a.attributes.extmaps=_o.videoExtensions,Pp("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:_u,ssrcGroups:yl}=hS([{ssrcId:E$,rtx:Pp("USE_RTX")?40001:void 0}],this.cname);_a.attributes.ssrcs=_u,_a.attributes.ssrcGroups=yl}if(_a.media.mediaType==="audio"&&(_a.media.fmts=_o.audioCodecs.map(_u=>_u.payloadType.toString(10)),_a.attributes.payloads=_o.audioCodecs,_a.attributes.extmaps=_o.audioExtensions,Pp("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:_u,ssrcGroups:yl}=hS([{ssrcId:v$}],this.cname);_a.attributes.ssrcs=_u,_a.attributes.ssrcGroups=yl}}this.sessionDesc=_r,this.currentMidIndex=_r.mediaDescriptions.length-1}preloadRemoteMedia(_t){this.rtpCapabilities;const _r=this.candidates,_o=this.dtlsParameters,_a=this.iceParameters,_u=this.rtpCapabilities.send;for(let yl=1;yl<_t;yl++){const Rl=2*yl+v$,Al=2*yl+E$,{ssrcs:Ol,ssrcGroups:xl}=hS([{ssrcId:Rl}],this.cname),{ssrcs:Ll,ssrcGroups:Bl}=hS([{ssrcId:Al,rtx:Pp("USE_RTX")?Al+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:EU,protos:["UDP","TLS","RTP","SAVPF"],fmts:_u.videoCodecs.map(Hl=>Hl.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:_a.iceUfrag,icePwd:_a.icePwd,unrecognized:[],candidates:_r,extmaps:_u.videoExtensions,fingerprints:_o.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:Ll,ssrcGroups:Bl,rtcpFeedbackWildcards:[],payloads:_u.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*yl-1)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:EU,protos:["UDP","TLS","RTP","SAVPF"],fmts:_u.audioCodecs.map(Hl=>Hl.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:_a.iceUfrag,icePwd:_a.icePwd,unrecognized:[],candidates:_r,extmaps:_u.audioExtensions,fingerprints:_o.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:Ol,ssrcGroups:xl,rtcpFeedbackWildcards:[],payloads:_u.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*yl)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return o_.exports.print(this.sessionDesc)}send(_t,_r,_o,_a){const{ssrcs:_u,ssrcGroups:yl}=hS(_r,this.cname,Pp("AV_SYNC")?_o:void 0),Rl=this.findPreloadMediaDesc(_u);if(Rl){if(Wy()&&this.firefoxSsrcMidMap.set(_u[0].ssrcId,Rl.attributes.mid),_a&&(_a.twcc||_a.remb)){const Al=this.sessionDesc.mediaDescriptions.indexOf(Rl);return this.sessionDesc.mediaDescriptions[Al]=this.mungSendMediaDesc(Rl,_a),{mid:Rl.attributes.mid,needExchangeSDP:!0}}return{mid:Rl.attributes.mid,needExchangeSDP:!1}}{const Al=this.findAvailableMediaIndex(_t,_u);let Ol;return Al===-1||_b()||eT()||ZV()?(Ol=this.createOrRecycleSendMedia(_t,_u,yl,"sendonly",_a),this.updateBundleMids()):(Ol=r_(this.sessionDesc.mediaDescriptions[Al]),Ol.attributes.direction="sendonly",Ol.attributes.ssrcs=_u,Ol.attributes.ssrcGroups=yl,this.sessionDesc.mediaDescriptions[Al]=this.mungSendMediaDesc(Ol,_a)),Wy()&&this.firefoxSsrcMidMap.set(_u[0].ssrcId,Ol.attributes.mid),{mid:Ol.attributes.mid,needExchangeSDP:!0}}}batchSend(_t){const _r=_t.map(_u=>{let{kind:yl,ssrcMsg:Rl,mslabel:Al}=_u;return this.send(yl,Rl,Al)}),_o=[];let _a=!1;return _r.forEach(_u=>{let{mid:yl,needExchangeSDP:Rl}=_u;Rl&&(_a=!0),_o.push(yl)}),{mids:_o,needExchangeSDP:_a}}stopSending(_t){const _r=this.sessionDesc.mediaDescriptions.filter(_o=>_o.attributes.mid&&_t.indexOf(_o.attributes.mid)!==-1);if(_r.length!==_t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");_r.forEach(_o=>{_o.attributes.mid==="0"||Wy()||_b()||eT()?_o.attributes.ssrcs=[]:(_o.attributes.ssrcs=[],_o.attributes.direction="inactive",_o.media.port="0")}),this.updateBundleMids()}mute(_t){const _r=this.sessionDesc.mediaDescriptions.find(_o=>_o.attributes.mid===_t);if(!_r)throw new Error("mediaDescription not found with ".concat(_t," in remote SDP when calling RemoteSDP.mute."));_r.attributes.direction="inactive"}unmute(_t){const _r=this.sessionDesc.mediaDescriptions.find(_o=>_o.attributes.mid===_t);if(!_r)throw new Error("mediaDescription not found with ".concat(_t," in remote SDP when calling RemoteSDP.unmute."));_r.attributes.direction="sendonly"}muteRemote(_t){const _r=this.sessionDesc.mediaDescriptions.filter(_o=>_t.includes(_o.attributes.mid||""));if(_r.length!==_t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");_r.forEach(_o=>{_o.attributes.direction="inactive"})}unmuteRemote(_t){const _r=this.sessionDesc.mediaDescriptions.filter(_o=>_t.includes(_o.attributes.mid||""));if(_r.length!==_t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");_r.forEach(_o=>{_o.attributes.direction="recvonly"})}receive(_t,_r,_o,_a){_t.forEach((_u,yl)=>{this.createOrRecycleRecvMedia(_u,[],"recvonly",_r,_o,_a[yl])}),this.updateBundleMids()}stopReceiving(_t){const _r=this.sessionDesc.mediaDescriptions.filter(_o=>_t.indexOf(_o.attributes.mid)!==-1);if(_r.length!==_t.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");_r.forEach(_o=>{_o.media.port="0",_o.attributes.direction="inactive"}),this.updateBundleMids()}restartICE(_t){_t=r_(_t),this._iceParameters=_t,this.sessionDesc.mediaDescriptions.forEach(_r=>{_r.attributes.iceUfrag=_t.iceUfrag,_r.attributes.icePwd=_t.icePwd})}predictReceivingMids(_t){const _r=[];for(let _o=0;_o<_t;_o++)_r.push((this.currentMidIndex+_o+1).toString(10));return _r}findAvailableMediaIndex(_t,_r){return this.sessionDesc.mediaDescriptions.findIndex(_o=>{const _a=_o.media.mediaType===_t&&_o.media.port!=="0"&&(_o.attributes.direction==="sendonly"||_o.attributes.direction==="sendrecv")&&_o.attributes.ssrcs.length===0;if(Wy()){if(_a){const _u=this.firefoxSsrcMidMap.get(_r[0].ssrcId);return!(_u||_o.attributes.mid!=="0"&&_o.attributes.mid!=="1")||!(!_u||_u!==_o.attributes.mid)}return!1}return _a})}createOrRecycleRecvMedia(_t,_r,_o,_a,_u,yl){const Rl=_t._mediaStreamTrack.kind,Al=this.rtpCapabilities.recv,Ol=this.localCapabilities.send;let xl=[];if(Rl===P0.VIDEO){var Ll,Bl;if(Pp("H264_PROFILE_LEVEL_ID")&&_a==="h264"&&(xl=Al.videoCodecs.filter(Dp=>{var Bp,_g;return(((Bp=Dp.rtpMap)===null||Bp===void 0?void 0:Bp.encodingName.toLowerCase())||"").includes(_a)&&(Dp==null||(_g=Dp.fmtp)===null||_g===void 0?void 0:_g.parameters["profile-level-id"])===Pp("H264_PROFILE_LEVEL_ID")})),!xl||((Ll=xl)===null||Ll===void 0?void 0:Ll.length)===0){const Dp=Ol.videoCodecs.filter(Bp=>{var _g;return(((_g=Bp.rtpMap)===null||_g===void 0?void 0:_g.encodingName.toLowerCase())||"").includes(_a)});Dp.length!==0&&(xl=Al.videoCodecs.filter(Bp=>Dp.some(_g=>_g.payloadType===Bp.payloadType)))}if(Pp("USE_RTX")){const Dp=xl.map(_g=>_g.payloadType.toString()),Bp=Al.videoCodecs.filter(_g=>{var y0,e0;return((y0=_g.rtpMap)===null||y0===void 0?void 0:y0.encodingName)==="rtx"&&Dp.includes(((e0=_g.fmtp)===null||e0===void 0?void 0:e0.parameters.apt)||"")});xl=[...xl,...Bp]}xl.length===0&&(Vl.warning("codec ".concat(_a," not included in rtpCapabilities, fallback to default payloads: ").concat((Bl=Al.videoCodecs[0].rtpMap)===null||Bl===void 0?void 0:Bl.encodingName)),xl=Al.videoCodecs)}else xl=Al.audioCodecs.filter(Dp=>{var Bp;return(((Bp=Dp.rtpMap)===null||Bp===void 0?void 0:Bp.encodingName.toLowerCase())||"").includes(_u)}),xl.length===0&&(Vl.warning("codec ".concat(_u," not included in rtpCapabilities, fallback to opus")),xl=Al.audioCodecs.filter(Dp=>{var Bp;return(((Bp=Dp.rtpMap)===null||Bp===void 0?void 0:Bp.encodingName.toLowerCase())||"").includes("opus")}));const Hl=Rl===P0.VIDEO?Al.videoExtensions:Al.audioExtensions;this.currentMidIndex+=1;const up="".concat(this.currentMidIndex);let _f={media:{mediaType:Rl,port:EU,protos:["UDP","TLS","RTP","SAVPF"],fmts:xl.map(Dp=>Dp.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:Hl,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:_r,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:xl,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:_o,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(up)}};_f=this.mungRecvMediaDsec(_f,_t,yl);const vp=this.findFirstClosedMedia(Rl);if(vp){const Dp=this.sessionDesc.mediaDescriptions.indexOf(vp);this.sessionDesc.mediaDescriptions[Dp]=_f}else this.sessionDesc.mediaDescriptions.push(_f);return _f}createOrRecycleSendMedia(_t,_r,_o,_a,_u){const yl=this.rtpCapabilities.send,Rl=_t===P0.VIDEO?yl.videoCodecs:yl.audioCodecs,Al=_t===P0.VIDEO?yl.videoExtensions:yl.audioExtensions;this.currentMidIndex+=1;const Ol="".concat(this.currentMidIndex);let xl={media:{mediaType:_t,port:EU,protos:["UDP","TLS","RTP","SAVPF"],fmts:Rl.map(Bl=>Bl.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:Al,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:_r,ssrcGroups:_o,rtcpFeedbackWildcards:[],payloads:Rl,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:_a,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(Ol)}};xl=this.mungSendMediaDesc(xl,_u);const Ll=this.findFirstClosedMedia(_t);if(Ll){const Bl=this.sessionDesc.mediaDescriptions.indexOf(Ll);this.sessionDesc.mediaDescriptions[Bl]=xl}else this.sessionDesc.mediaDescriptions.push(xl);return xl}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(_t=>_t.media.port!=="0").map(_t=>_t.attributes.mid)}mungRecvMediaDsec(_t,_r,_o){const _a=r_(_t);return h$(_a),EN(_a,_r),f$(_a,_r),yz(_a),fU(_a,_o,this.localCapabilities.send),_a}mungSendMediaDesc(_t,_r){const _o=r_(_t);return fU(_o,_r,this.localCapabilities.recv),v1(_o),_o}updateRecvMedia(_t,_r){const _o=this.sessionDesc.mediaDescriptions.findIndex(_a=>_a.attributes.mid===_t);if(_o!==-1){const _a=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[_o],_r);this.sessionDesc.mediaDescriptions[_o]=_a}}bumpMid(_t){this.currentMidIndex+=_t}findFirstClosedMedia(_t){return this.sessionDesc.mediaDescriptions.find(_r=>Wy()?_r.media.port==="0"&&_r.media.mediaType===_t:_r.media.port==="0")}findPreloadMediaDesc(_t){return this.sessionDesc.mediaDescriptions.find(_r=>{var _o,_a;return((_o=_r.attributes)===null||_o===void 0||(_a=_o.ssrcs[0])===null||_a===void 0?void 0:_a.ssrcId)===_t[0].ssrcId})}getSSRC(_t){var _r;return(_r=this.sessionDesc.mediaDescriptions.find(_o=>_o.attributes.mid===_t))===null||_r===void 0?void 0:_r.attributes.ssrcs}}var ly;function lY(_e,_t){var _r=Object.keys(_e);if(Object.getOwnPropertySymbols){var _o=Object.getOwnPropertySymbols(_e);_t&&(_o=_o.filter(function(_a){return Object.getOwnPropertyDescriptor(_e,_a).enumerable})),_r.push.apply(_r,_o)}return _r}function _U(_e){for(var _t=1;_t<arguments.length;_t++){var _r=arguments[_t]!=null?arguments[_t]:{};_t%2?lY(Object(_r),!0).forEach(function(_o){Ml(_e,_o,_r[_o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_e,Object.getOwnPropertyDescriptors(_r)):lY(Object(_r)).forEach(function(_o){Object.defineProperty(_e,_o,Object.getOwnPropertyDescriptor(_r,_o))})}return _e}let yre=(Yp((ly=class AU extends K5{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}constructor(_t,_r,_o){super(_t,_r),Ml(this,"store",void 0),Ml(this,"peerConnection",void 0),Ml(this,"remoteSDP",void 0),Ml(this,"initialOffer",void 0),Ml(this,"transportEventReceiver",void 0),Ml(this,"statsFilter",void 0),Ml(this,"useRTX",Pp("USE_RTX")),Ml(this,"localCapabilities",void 0),Ml(this,"localCandidateCount",0),Ml(this,"allCandidatesReceived",!1),Ml(this,"establishPromise",void 0),Ml(this,"mutex",new iT("NVExtentionsConnection-mutex")),Ml(this,"rtcMedia",void 0),this.store=_r,this.peerConnection=_o,this.statsFilter=y$(this.peerConnection,void 0,void 0,Wy()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(_t){try{const _r=await this.peerConnection.createOffer();if(!_r.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const _o=pO(_r.sdp),_a=await Ez(!this.useRTX,Pp("FILTER_VIDEO_FEC"),Pp("FILTER_AUDIO_FEC"));return this.localCapabilities=_a,this.initialOffer=_r,_U(_U({},_o),{},{rtpCapabilities:_a,offerSDP:_r.sdp})}catch(_r){throw new Tp(Ql.GET_LOCAL_CONNECTION_PARAMS_FAILED,_r.toString())}}async connect(_t,_r,_o,_a,_u,yl){try{if(!this.initialOffer)throw new Error("Cannot establish NVConnection without initial offer.");this.remoteSDP=new mre({remoteIceParameters:_t,remoteDtlsParameters:_r,candidates:_o,remoteRTPCapabilities:_a,remoteSetup:_u,localCapabilities:p$(this.localCapabilities),cname:yl});const Rl=this.remoteSDP.toString(),Al=o_.exports.parse(this.initialOffer.sdp),Ol=Al.mediaDescriptions.find(Bl=>Bl.media.mediaType==="audio");Ol&&v1(Ol);const xl=o_.exports.print(Al),Ll=this.logSDPExchange(xl||"","offer","local","connect");await this.peerConnection.setLocalDescription({type:"offer",sdp:xl}),Ll==null||Ll(Rl),await this.peerConnection.setRemoteDescription({type:"answer",sdp:Rl})}catch(Rl){throw new Tp(Ql.EXCHANGE_SDP_FAILED,"NV.connect failed; ".concat(Rl.toString()))}}async updateRemoteConnect(_t){var _r,_o,_a;(_r=this.remoteSDP)===null||_r===void 0||_r.updateRemoteRTPCapabilities(_t),(_o=this.remoteSDP)===null||_o===void 0||_o.preloadRemoteMedia(2);const _u=(_a=this.remoteSDP)===null||_a===void 0?void 0:_a.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:_u});const yl=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(yl),Vl.debug("[NVExtentionsConnection] updateRemoteRTPCapabilities by exchanging SDP.")}send(_t,_r,_o){var _a=this;return wS(function*(){const _u=yield H0(_a.mutex.lock("From NVExtentionsConnection.send"));try{if(!_a.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.send before remote SDP created");const yl=[];_t.forEach(_f=>{const vp=_a.peerConnection.addTransceiver(_f._mediaStreamTrack,{direction:"sendonly"});yl.push(vp)}),Wy()&&Pp("SIMULCAST")===!0&&(yield H0(_a.applySimulcastForFirefox(yl,_t)));const Rl=yield H0(_a.peerConnection.createOffer()),Al=_a.remoteSDP.predictReceivingMids(_t.length),Ol=_a.mungSendOfferSDP(Rl.sdp,_t,Al),xl=o_.exports.parse(Ol),Ll=Al.map(_f=>{const vp=xl.mediaDescriptions.find(Dp=>Dp.attributes.mid===_f);if(!vp)throw new Error("Cannot extract ssrc from mediaDescription.");return gz(vp,_a.useRTX)});let Bl;try{Bl=yield Ll}catch(_f){Bl=[],_a.remoteSDP.receive(_t,_r,_o,Bl);const vp=_a.remoteSDP.toString();throw yield H0(_a.peerConnection.setLocalDescription({type:"offer",sdp:Ol})),yield H0(_a.peerConnection.setRemoteDescription({type:"answer",sdp:vp})),yield H0(_a.stopSending(Al,!0)),_f}_a.remoteSDP.receive(_t,_r,_o,Bl);const Hl=_a.remoteSDP.toString(),up=_a.logSDPExchange(Ol,"offer","local","send");return yield H0(_a.peerConnection.setLocalDescription({type:"offer",sdp:Ol})),yield H0(_a.applySimulcastEncodings(yl,_t)),yield H0(_a.applySendEncodings(yl,_t)),up==null||up(Hl),yield H0(_a.peerConnection.setRemoteDescription({type:"answer",sdp:Hl})),yl.map((_f,vp)=>{const Dp=Al[vp];return{localSSRC:Ll[vp],id:Dp,transceiver:_f}})}catch(yl){throw yl instanceof Tp?yl:new Tp(Ql.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.send failed; ".concat(yl.toString()))}finally{_u()}})()}async stopSending(_t,_r){const _o=_r?void 0:await this.mutex.lock("From NVExtentionsConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.stopSending before remote SDP created");const _a=this.peerConnection.getTransceivers().filter(Al=>_t.indexOf(Al.mid)!==-1);if(_a.length!==_t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call NVExtentionsConnection.stopSending.");_a.map(Al=>{var Ol;Al.direction="inactive",(Ol=Al.stop)===null||Ol===void 0||Ol.call(Al)});const _u=await this.peerConnection.createOffer(),yl=this.logSDPExchange(_u.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(_u),this.remoteSDP.stopReceiving(_t);const Rl=this.remoteSDP.toString();yl==null||yl(Rl),await this.peerConnection.setRemoteDescription({type:"answer",sdp:Rl})}catch(_a){throw new Tp(Ql.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.stopSending failed; ".concat(_a.toString()))}finally{_o&&_o()}}async receive(_t,_r,_o,_a){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.receive ".concat(_t," before remoteSDP created."));const{mid:_u,needExchangeSDP:yl}=this.remoteSDP.send(_t,_r,_o,_a);if(yl){const Al=this.remoteSDP.toString(),Ol=this.logSDPExchange(Al,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:Al});const xl=await this.peerConnection.createAnswer(),Ll=this.mungReceiveAnswerSDP(xl.sdp,_u,_t);Ol==null||Ol(Ll||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:Ll}),Vl.debug("[NVExtentionsConnection] receive ".concat(_t," by exchanging SDP."))}else Vl.debug("[NVExtentionsConnection] receive ".concat(_t," no need to exchange SDP."));const Rl=this.peerConnection.getTransceivers().find(Al=>Al.mid===_u);if(!Rl)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:Rl.receiver.track,id:_u}}catch(_u){throw new Tp(Ql.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.receive failed; ".concat(_u.toString()))}}async batchReceive(_t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.batchReceive before remoteSDP created.");const{mids:_r,needExchangeSDP:_o}=this.remoteSDP.batchSend(_t);if(_o){const _a=this.remoteSDP.toString(),_u=this.logSDPExchange(_a,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:_a});const yl=await this.peerConnection.createAnswer();_u==null||_u(yl.sdp||""),await this.peerConnection.setLocalDescription(yl),Vl.debug("[NVExtentionsConnection] batchReceive by exchanging SDP.")}else Vl.debug("[NVExtentionsConnection] batchReceive no need to exchange SDP.");return _r.map(_a=>{const _u=this.peerConnection.getTransceivers().find(yl=>yl.mid===_a);if(!_u)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:_u.receiver.track,id:_a}})}catch(_r){throw new Tp(Ql.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.receive failed; ".concat(_r.toString()))}}async stopReceiving(_t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(_t);const _r=this.remoteSDP.toString(),_o=this.logSDPExchange(_r,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:_r});const _a=await this.peerConnection.createAnswer();_o==null||_o(_a.sdp||""),await this.peerConnection.setLocalDescription(_a)}catch(_r){throw new Tp(Ql.EXCHANGE_SDP_FAILED,"NVExtentionsConnection stopReceiving failed; ".concat(_r.toString()))}}async muteRemote(_t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.muteRemote mid=".concat(_t," before remote SDP created."));this.remoteSDP.mute(_t);const _r=this.remoteSDP.toString(),_o=this.logSDPExchange(_r,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:_r});const _a=await this.peerConnection.createAnswer();_o==null||_o(_a.sdp||""),await this.peerConnection.setLocalDescription(_a)}catch(_r){throw new Tp(Ql.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.muteRemote failed; ".concat(_r.toString()))}}async unmuteRemote(_t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.unmuteRemote mid=".concat(_t," before remote SDP created."));this.remoteSDP.unmute(_t);const _r=this.remoteSDP.toString(),_o=this.logSDPExchange(_r,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:_r});const _a=await this.peerConnection.createAnswer();_o==null||_o(_a.sdp||""),await this.peerConnection.setLocalDescription(_a)}catch(_r){throw new Tp(Ql.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.unmuteRemote failed; ".concat(_r.toString()))}}async muteLocal(_t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.muteLocal before remote SDP created.");const _r=this.peerConnection.getTransceivers().filter(yl=>yl.mid&&_t.indexOf(yl.mid)!==-1);if(_r.length!==_t.length)throw new Error("Transceivers' length doesn't match mids' length.");_r.map(yl=>{yl.direction="inactive"});const _o=await this.peerConnection.createOffer(),_a=this.logSDPExchange(_o.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(_o),this.remoteSDP.muteRemote(_t);const _u=this.remoteSDP.toString();_a==null||_a(_u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:_u})}catch(_r){throw new Tp(Ql.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.muteLocal failed; ".concat(_r.toString()))}}async unmuteLocal(_t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.unmuteLocal before remote SDP created.");const _r=this.peerConnection.getTransceivers().filter(yl=>yl.mid&&_t.indexOf(yl.mid)!==-1);if(_r.length!==_t.length)throw new Error("Transceivers' length doesn't match mids' length.");_r.map(async(yl,Rl)=>{yl.direction="sendonly"});const _o=await this.peerConnection.createOffer(),_a=this.logSDPExchange(_o.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(_o),this.remoteSDP.unmuteRemote(_t);const _u=this.remoteSDP.toString();_a==null||_a(_u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:_u})}catch(_r){throw new Tp(Ql.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.unmuteLocal failed; ".concat(_r.toString()))}}restartICE(){var _t=this;return wS(function*(){const _r=yield H0(_t.mutex.lock("From NVExtentionsConnection.restartICE"));try{const _o=yield H0(_t.peerConnection.createOffer({iceRestart:!0}));if(!_o.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const _a=pO(_o.sdp),{remoteIceParameters:_u}=yield _a.iceParameters;if(!_t.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");_t.remoteSDP.restartICE(_u);const yl=_t.remoteSDP.toString(),Rl=_t.logSDPExchange(_o.sdp||"","offer","local","restartICE");yield H0(_t.peerConnection.setLocalDescription(_o)),Rl==null||Rl(yl),yield H0(_t.peerConnection.setRemoteDescription({type:"answer",sdp:yl}))}catch(_o){Vl.warning("restart ICE failed, abort operation",_o)}finally{_r()}})()}close(){var _t;(_t=this.onConnectionStateChange)===null||_t===void 0||_t.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(_t){return this.statsFilter.getVideoIsReady(_t)}async updateEncoderConfig(_t,_r){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.updateEncoderConfig before remote SDP created.");const _o=await this.peerConnection.createOffer(),_a=this.mungSendOfferSDP(_o.sdp,[_r],[_t]);this.remoteSDP.updateRecvMedia(_t,_r);const _u=this.remoteSDP.toString(),yl=this.logSDPExchange(_a,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:_a}),yl==null||yl(_u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:_u})}catch(_o){throw new Tp(Ql.EXCHANGE_SDP_FAILED,_o.toString())}}async updateSendParameters(_t,_r){const _o=this.peerConnection.getTransceivers().filter(_a=>_a.mid===_t);_o.length===1&&(this.isVP8Simulcast(_r)?Wy()||await this.applySimulcastEncodings(_o,[_r]):await this.applySendEncodings(_o,[_r]))}setStatsRemoteVideoIsReady(_t,_r){this.statsFilter.setVideoIsReady2(_t,_r)}async replaceTrack(_t,_r){const _o=this.peerConnection.getTransceivers().find(_a=>_a.mid===_r);_o&&await _o.sender.replaceTrack(_t._mediaStreamTrack)}getP2PConnectionParams(){var _t;if((_t=this.peerConnection.currentLocalDescription)===null||_t===void 0||!_t.sdp||!this.localCapabilities)throw new Error;return _U(_U({},pO(this.peerConnection.currentLocalDescription.sdp)),{},{rtpCapabilities:this.localCapabilities})}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var _t;(_t=this.onICEConnectionStateChange)===null||_t===void 0||_t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var _t;(_t=this.onConnectionStateChange)===null||_t===void 0||_t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=_t=>{_t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,Vl.debug("[pc-".concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,Vl.debug("[pc-".concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},Pp("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(_t){const _r={iceServers:[]};return _t.iceServers?_r.iceServers=_t.iceServers:_t.turnServer&&_t.turnServer.mode!=="off"&&(a2(_t.turnServer.servers)?_r.iceServers=_t.turnServer.servers:(_r.iceServers&&_r.iceServers.push(...AU.turnServerConfigToIceServers(_t.turnServer.servers)),Pp("USE_TURN_SERVER_OF_GATEWAY")&&_r.iceServers&&_t.turnServer.serversFromGateway&&_r.iceServers.push(...AU.turnServerConfigToIceServers(_t.turnServer.serversFromGateway)),Pp("FORCE_TURN_TCP")?_r.iceTransportPolicy="relay":_t.turnServer.servers.concat(_t.turnServer.serversFromGateway||[]).forEach(_o=>{_o.forceturn&&(_r.iceTransportPolicy="relay")}))),_r}static turnServerConfigToIceServers(_t){const _r=[];return _t.forEach(_o=>{_o.security?_o.tcpport&&_r.push({username:_o.username,credential:_o.password,credentialType:"password",urls:"turns:".concat(eU(_o.turnServerURL),":").concat(_o.tcpport,"?transport=tcp")}):(_o.udpport&&!Pp("FORCE_TURN_TCP")&&_r.push({username:_o.username,credential:_o.password,credentialType:"password",urls:"turn:".concat(_o.turnServerURL,":").concat(_o.udpport,"?transport=udp")}),_o.tcpport&&_r.push({username:_o.username,credential:_o.password,credentialType:"password",urls:"turn:".concat(_o.turnServerURL,":").concat(_o.tcpport,"?transport=tcp")}))}),_r}async applySendEncodings(_t,_r){try{if(!R_().supportSetRtpSenderParameters||_t.length!==_r.length)return;for(let Ol=0;Ol<_t.length;Ol++){const xl=_t[Ol],Ll=_r[Ol];if(Ll&&Ll instanceof i_){var _o,_a;if(this.isVP8Simulcast(Ll))continue;const Bl={},Hl={};switch(Ll._optimizationMode){case"motion":Bl.degradationPreference="maintain-framerate";break;case"detail":Bl.degradationPreference="maintain-resolution";break;default:Bl.degradationPreference="balanced"}var _u,yl,Rl,Al;if((_o=Ll._encoderConfig)!==null&&_o!==void 0&&_o.bitrateMax&&(Hl.maxBitrate=1e3*((_u=Ll._encoderConfig)===null||_u===void 0?void 0:_u.bitrateMax)),Ll._hints.includes(f_.LOW_STREAM)&&((yl=Ll._encoderConfig)!==null&&yl!==void 0&&yl.frameRate&&(Hl.maxFramerate=MR(Ll._encoderConfig.frameRate)),(Rl=Ll._encoderConfig)!==null&&Rl!==void 0&&Rl.scaleResolutionDownBy&&((Al=Ll._encoderConfig)===null||Al===void 0?void 0:Al.scaleResolutionDownBy)>1&&(Hl.scaleResolutionDownBy=Ll._encoderConfig.scaleResolutionDownBy)),Pp("DSCP_TYPE")&&eO()){const vp=Pp("DSCP_TYPE");["very-low","low","medium","high"].includes(vp)&&(Hl.networkPriority=vp)}const up=xl.sender.getParameters(),_f=(_a=up.encodings)===null||_a===void 0?void 0:_a[0];Wy()&&!_f&&(Bl.encodings=[Hl]),_f&&Object.assign(_f,Hl),Object.assign(up,Bl),await xl.sender.setParameters(up)}}}catch{Vl.debug("Apply RTPSendEncodings failed.")}}mungSendOfferSDP(_t,_r,_o){const _a=o_.exports.parse(_t);return _r.forEach((_u,yl)=>{const Rl=_o[yl],Al=_a.mediaDescriptions.find(Ol=>Ol.attributes.mid===Rl);Al&&(EN(Al,_u),vz(Al,_u,this.store.codec))}),o_.exports.print(_a)}mungReceiveAnswerSDP(_t,_r,_o){const _a=o_.exports.parse(_t),_u=_a.mediaDescriptions.find(yl=>yl.attributes.mid===_r);return _u&&_o===P0.AUDIO&&_u.media.mediaType==="audio"&&v1(_u),o_.exports.print(_a)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=_t=>{var _r;(_r=this.onFirstAudioReceived)===null||_r===void 0||_r.call(this,_t)},this.statsFilter.onFirstVideoReceived=_t=>{var _r;(_r=this.onFirstVideoReceived)===null||_r===void 0||_r.call(this,_t)},this.statsFilter.onFirstAudioDecoded=_t=>{var _r;(_r=this.onFirstAudioDecoded)===null||_r===void 0||_r.call(this,_t)},this.statsFilter.onFirstVideoDecoded=(_t,_r,_o)=>{var _a;(_a=this.onFirstVideoDecoded)===null||_a===void 0||_a.call(this,_t,_r,_o)},this.statsFilter.onSelectedLocalCandidateChanged=(_t,_r)=>{var _o;(_o=this.onSelectedLocalCandidateChanged)===null||_o===void 0||_o.call(this,_t,_r)},this.statsFilter.onSelectedRemoteCandidateChanged=(_t,_r)=>{var _o;(_o=this.onSelectedRemoteCandidateChanged)===null||_o===void 0||_o.call(this,_t,_r)},this.statsFilter.onFirstVideoDecodedTimeout=_t=>{var _r;(_r=this.onFirstVideoDecodedTimeout)===null||_r===void 0||_r.call(this,_t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(_t,_r){if(_t.length===_r.length)for(let Rl=0;Rl<_t.length;Rl++){var _o,_a,_u,yl;const Al=_t[Rl],Ol=_r[Rl];if(Ol instanceof i_&&!Ol._hints.includes(f_.LOW_STREAM)&&(_o=Ol._encoderConfig)!==null&&_o!==void 0&&_o.bitrateMax&&((_a=Ol._encoderConfig)===null||_a===void 0?void 0:_a.bitrateMax)>200&&(_u=Ol._scalabiltyMode)!==null&&_u!==void 0&&_u.numSpatialLayers&&((yl=Ol._scalabiltyMode)===null||yl===void 0?void 0:yl.numSpatialLayers)>1&&this.store.codec==="vp8"){const xl={},Ll={high:1e3*(Ol._encoderConfig.bitrateMax-50),medium:5e4};xl.encodings=[{rid:"m",active:!0,maxBitrate:Ll.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:Ll.high}];const Bl=Al.sender.getParameters();await Al.sender.setParameters(Object.assign(Bl,xl))}}}async applySimulcastEncodings(_t,_r){if(!Wy()&&_t.length===_r.length)for(let _o=0;_o<_t.length;_o++){const _a=_r[_o];if(_a instanceof i_&&this.isVP8Simulcast(_a)){const _u=_t[_o],yl={},Rl={high:1e3*(_a._encoderConfig.bitrateMax-50),medium:5e4};yl.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:Rl.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:Rl.medium,scaleResolutionDownBy:4}];const Al=_u.sender.getParameters();await _u.sender.setParameters(Object.assign(Al,yl))}}}isVP8Simulcast(_t){var _r,_o,_a,_u;return!!(_t instanceof i_&&Pp("SIMULCAST")&&this.store.codec==="vp8"&&!_t._hints.includes(f_.LOW_STREAM)&&(_r=_t._encoderConfig)!==null&&_r!==void 0&&_r.bitrateMax&&((_o=_t._encoderConfig)===null||_o===void 0?void 0:_o.bitrateMax)>200&&(_a=_t._scalabiltyMode)!==null&&_a!==void 0&&_a.numSpatialLayers&&((_u=_t._scalabiltyMode)===null||_u===void 0?void 0:_u.numSpatialLayers)>1)}logSDPExchange(_t,_r,_o,_a){if(Pp("SDP_LOGGING"))return Vl.upload("exchanging ".concat(_o," ").concat(_r," SDP during NVExtentionsConnection.").concat(_a,`
`),_t),_r==="offer"?_u=>{this.logSDPExchange(_u,"answer",_o==="local"?"remote":"local",_a)}:void 0}async getRemoteSSRC(_t){if(!this.remoteSDP)return;const _r=this.remoteSDP.getSSRC(_t);return _r==null?void 0:_r[0].ssrcId}setConfiguration(_t){if(R_().supportPCSetConfiguration){const _r=AU.resolvePCConfiguration(_t);this.peerConnection.setConfiguration(_r)}}}).prototype,"connect",[XT],Object.getOwnPropertyDescriptor(ly.prototype,"connect"),ly.prototype),Yp(ly.prototype,"updateRemoteConnect",[XT],Object.getOwnPropertyDescriptor(ly.prototype,"updateRemoteConnect"),ly.prototype),Yp(ly.prototype,"receive",[XT],Object.getOwnPropertyDescriptor(ly.prototype,"receive"),ly.prototype),Yp(ly.prototype,"batchReceive",[XT],Object.getOwnPropertyDescriptor(ly.prototype,"batchReceive"),ly.prototype),Yp(ly.prototype,"stopReceiving",[XT],Object.getOwnPropertyDescriptor(ly.prototype,"stopReceiving"),ly.prototype),Yp(ly.prototype,"muteRemote",[XT],Object.getOwnPropertyDescriptor(ly.prototype,"muteRemote"),ly.prototype),Yp(ly.prototype,"unmuteRemote",[XT],Object.getOwnPropertyDescriptor(ly.prototype,"unmuteRemote"),ly.prototype),Yp(ly.prototype,"muteLocal",[XT],Object.getOwnPropertyDescriptor(ly.prototype,"muteLocal"),ly.prototype),Yp(ly.prototype,"unmuteLocal",[XT],Object.getOwnPropertyDescriptor(ly.prototype,"unmuteLocal"),ly.prototype),Yp(ly.prototype,"close",[XT],Object.getOwnPropertyDescriptor(ly.prototype,"close"),ly.prototype),Yp(ly.prototype,"updateEncoderConfig",[XT],Object.getOwnPropertyDescriptor(ly.prototype,"updateEncoderConfig"),ly.prototype),Yp(ly.prototype,"updateSendParameters",[XT],Object.getOwnPropertyDescriptor(ly.prototype,"updateSendParameters"),ly.prototype),Yp(ly.prototype,"replaceTrack",[XT],Object.getOwnPropertyDescriptor(ly.prototype,"replaceTrack"),ly.prototype),Yp(ly.prototype,"getRemoteSSRC",[XT],Object.getOwnPropertyDescriptor(ly.prototype,"getRemoteSSRC"),ly.prototype),ly);function XT(_e,_t,_r){const _o=_e[_t];if(typeof _o!="function")throw new Error("Cannot use mutex on object property.");return _r.value=async function(){const _a=this.mutex,_u=await _a.lock("From NVExtentionsConnection.".concat(_t));try{for(var yl=arguments.length,Rl=new Array(yl),Al=0;Al<yl;Al++)Rl[Al]=arguments[Al];return await _o.apply(this,Rl)}finally{_u()}},_r}var Sy;function dY(_e){var _t,_r,_o,_a=2;for(typeof Symbol<"u"&&(_r=hz,_o=Symbol.iterator);_a--;){if(_r&&(_t=_e[_r])!=null)return _t.call(_e);if(_o&&(_t=_e[_o])!=null)return new _$(_t.call(_e));_r="@@asyncIterator",_o="@@iterator"}throw new TypeError("Object is not async iterable")}function _$(_e){function _t(_r){if(Object(_r)!==_r)return u0.reject(new TypeError(_r+" is not an object."));var _o=_r.done;return u0.resolve(_r.value).then(function(_a){return{value:_a,done:_o}})}return(_$=function(_r){this.s=_r,this.n=_r.next}).prototype={s:null,n:null,next:function(){return _t(this.n.apply(this.s,arguments))},return:function(_r){var _o=this.s.return;return _o===void 0?u0.resolve({value:_r,done:!0}):_t(_o.apply(this.s,arguments))},throw:function(_r){var _o=this.s.return;return _o===void 0?u0.reject(_r):_t(_o.apply(this.s,arguments))}},new _$(_e)}let E1=(Yp((Sy=class IU extends K5{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}constructor(_t,_r){super(_t,_r),Ml(this,"store",void 0),Ml(this,"peerConnection",void 0),Ml(this,"cname",void 0),Ml(this,"mutex",new iT("DataChannelConnection-mutex")),Ml(this,"dataChannel",void 0),Ml(this,"_p2pConnection",void 0),Ml(this,"establishPromise",void 0),Ml(this,"_nvMedia",void 0),this.store=_r,this.store.dcId=this.store.dcId+1,this.peerConnection=new RTCPeerConnection(IU.resolvePCConfiguration(_t),{optional:[{googDscp:!0}]}),this.dataChannel=this.peerConnection.createDataChannel("agora-signal",{ordered:!1,maxPacketLifeTime:50}),this.dataChannel.binaryType="arraybuffer",this._p2pConnection=new yre(_t,_r,this.peerConnection),this.bindPCEvents(),this.establishPromise=this._p2pConnection.establishPromise}async establish(){var _t;const _r=(_t=this._nvMedia)===null||_t===void 0?void 0:_t.getLocalRtpCapabilities();return await this._p2pConnection.establish(_r)}getP2PConnectionParams(){return this._p2pConnection.getP2PConnectionParams()}async connect(_t,_r,_o,_a,_u,yl){return this.cname=yl,await this._p2pConnection.connect(_t,_r,_o,_a,_u,yl),await new u0((Rl,Al)=>{const Ol=setTimeout(()=>{this.closeSignal(),Al(new Tp(Ql.DATACHANNEL_CONNECTION_TIMEOUT,"Datachannel connection timed out, candidates: ".concat(JSON.stringify(_o))))},2e3);this.dataChannel.onopen=()=>{if(this.dataChannel.readyState==="open")return clearTimeout(Ol),void Rl()},this.dataChannel.onerror=xl=>{this.closeSignal(),Al(xl)}}),{transmitter:this.dataChannel,close:this.closeSignal.bind(this)}}send(_t,_r,_o){var _a=this;return wS(function*(){const _u=yield H0(_a.mutex.lock("From DataChannelConnection.send"));try{return yield*S2(dY(_a._p2pConnection.send(_t,_r,_o)),H0)}finally{_u()}})()}async stopSending(_t,_r){return this._p2pConnection.stopSending(_t,_r)}async receive(_t,_r,_o,_a){return this._nvMedia?(Vl.debug("[DataChannelConnection] receive ".concat(_t," by DataChannel.")),await this._nvMedia.reveiveByRTCMedia(_t,_r,this.cname)):(Vl.debug("[DataChannelConnection] receive ".concat(_t," by WebRTC.")),await this._p2pConnection.receive(_t,_r,_o,_a))}async batchReceive(_t){return[...await this._p2pConnection.batchReceive(_t)]}async stopReceiving(_t){return await this._p2pConnection.stopReceiving(_t)}async muteRemote(_t){return await this._p2pConnection.muteRemote(_t)}async unmuteRemote(_t){return await this._p2pConnection.unmuteRemote(_t)}async muteLocal(_t){return await this._p2pConnection.muteLocal(_t)}async unmuteLocal(_t){return await this._p2pConnection.unmuteLocal(_t)}restartICE(){var _t=this;return wS(function*(){return yield*S2(dY(_t._p2pConnection.restartICE()),H0)})()}close(){var _t;(_t=this._nvMedia)===null||_t===void 0||_t.close(),this._p2pConnection.close(),this.unbindConnectionEvents(this._p2pConnection)}getStats(){return this._p2pConnection.getStats()}getRemoteVideoIsReady(_t){return this._p2pConnection.getRemoteVideoIsReady(_t)}updateRemoteConnect(_t){var _r;(_r=this._nvMedia)===null||_r===void 0||_r.setRemoteRtpCapabilities(_t),this._p2pConnection.updateRemoteConnect(_t)}async updateEncoderConfig(_t,_r){return await this._p2pConnection.updateEncoderConfig(_t,_r)}async updateSendParameters(_t,_r){return await this._p2pConnection.updateSendParameters(_t,_r)}setStatsRemoteVideoIsReady(_t,_r){this._p2pConnection.setStatsRemoteVideoIsReady(_t,_r)}async replaceTrack(_t,_r){return await this._p2pConnection.replaceTrack(_t,_r)}async getRemoteSSRC(_t){return this._p2pConnection.getRemoteSSRC(_t)}logSDPExchange(_t,_r,_o,_a){if(Pp("SDP_LOGGING"))return Vl.upload("exchanging ".concat(_o," ").concat(_r," SDP during DataChannelConnection.").concat(_a,`
`),_t),_r==="offer"?_u=>{this.logSDPExchange(_u,"answer",_o==="local"?"remote":"local",_a)}:void 0}static resolvePCConfiguration(_t){const _r={iceServers:[]};return _t.iceServers?_r.iceServers=_t.iceServers:_t.turnServer&&_t.turnServer.mode!=="off"&&(a2(_t.turnServer.servers)?_r.iceServers=_t.turnServer.servers:(_r.iceServers&&_r.iceServers.push(...IU.turnServerConfigToIceServers(_t.turnServer.servers)),Pp("USE_TURN_SERVER_OF_GATEWAY")&&_r.iceServers&&_t.turnServer.serversFromGateway&&_r.iceServers.push(...IU.turnServerConfigToIceServers(_t.turnServer.serversFromGateway)),Pp("FORCE_TURN_TCP")?_r.iceTransportPolicy="relay":_t.turnServer.servers.concat(_t.turnServer.serversFromGateway||[]).forEach(_o=>{_o.forceturn&&(_r.iceTransportPolicy="relay")}))),_r}static turnServerConfigToIceServers(_t){const _r=[];return _t.forEach(_o=>{_o.security?_o.tcpport&&_r.push({username:_o.username,credential:_o.password,credentialType:"password",urls:"turns:".concat(eU(_o.turnServerURL),":").concat(_o.tcpport,"?transport=tcp")}):(_o.udpport&&!Pp("FORCE_TURN_TCP")&&_r.push({username:_o.username,credential:_o.password,credentialType:"password",urls:"turn:".concat(_o.turnServerURL,":").concat(_o.udpport,"?transport=udp")}),_o.tcpport&&_r.push({username:_o.username,credential:_o.password,credentialType:"password",urls:"turn:".concat(_o.turnServerURL,":").concat(_o.tcpport,"?transport=tcp")}))}),_r}bindPCEvents(){this._p2pConnection.onICEConnectionStateChange=_t=>{var _r;return(_r=this.onICEConnectionStateChange)===null||_r===void 0?void 0:_r.call(this,_t)},this._p2pConnection.onConnectionStateChange=_t=>{var _r;return(_r=this.onConnectionStateChange)===null||_r===void 0?void 0:_r.call(this,_t)},this._p2pConnection.onDTLSTransportStateChange=_t=>{var _r;return(_r=this.onDTLSTransportStateChange)===null||_r===void 0?void 0:_r.call(this,_t)},this._p2pConnection.onDTLSTransportError=_t=>{var _r;return(_r=this.onDTLSTransportError)===null||_r===void 0?void 0:_r.call(this,_t)},this._p2pConnection.onICETransportStateChange=_t=>{var _r;return(_r=this.onICETransportStateChange)===null||_r===void 0?void 0:_r.call(this,_t)},this._p2pConnection.onFirstAudioReceived=_t=>{var _r;return(_r=this.onFirstAudioReceived)===null||_r===void 0?void 0:_r.call(this,_t)},this._p2pConnection.onFirstVideoReceived=_t=>{var _r;return(_r=this.onFirstVideoReceived)===null||_r===void 0?void 0:_r.call(this,_t)},this._p2pConnection.onFirstAudioDecoded=_t=>{var _r;return(_r=this.onFirstAudioDecoded)===null||_r===void 0?void 0:_r.call(this,_t)},this._p2pConnection.onFirstVideoDecoded=(_t,_r,_o)=>{var _a;return(_a=this.onFirstVideoDecoded)===null||_a===void 0?void 0:_a.call(this,_t,_r,_o)},this._p2pConnection.onFirstVideoDecodedTimeout=_t=>{var _r;return(_r=this.onFirstVideoDecodedTimeout)===null||_r===void 0?void 0:_r.call(this,_t)},this._p2pConnection.onSelectedLocalCandidateChanged=(_t,_r)=>{var _o;return(_o=this.onSelectedLocalCandidateChanged)===null||_o===void 0?void 0:_o.call(this,_t,_r)},this._p2pConnection.onSelectedRemoteCandidateChanged=(_t,_r)=>{var _o;return(_o=this.onSelectedRemoteCandidateChanged)===null||_o===void 0?void 0:_o.call(this,_t,_r)}}closeSignal(){this.dataChannel.close(),this.peerConnection.close()}unbindConnectionEvents(_t){_t.onConnectionStateChange=void 0,_t.onICEConnectionStateChange=void 0,_t.onICETransportStateChange=void 0,_t.onDTLSTransportStateChange=void 0,_t.onDTLSTransportError=void 0,_t.onFirstAudioDecoded=void 0,_t.onFirstAudioReceived=void 0,_t.onFirstVideoDecoded=void 0,_t.onFirstVideoReceived=void 0,_t.onSelectedLocalCandidateChanged=void 0,_t.onSelectedRemoteCandidateChanged=void 0,_t.onFirstVideoDecodedTimeout=void 0}setConfiguration(_t){this._p2pConnection.setConfiguration(_t)}}).prototype,"connect",[CS],Object.getOwnPropertyDescriptor(Sy.prototype,"connect"),Sy.prototype),Yp(Sy.prototype,"receive",[CS],Object.getOwnPropertyDescriptor(Sy.prototype,"receive"),Sy.prototype),Yp(Sy.prototype,"stopReceiving",[CS],Object.getOwnPropertyDescriptor(Sy.prototype,"stopReceiving"),Sy.prototype),Yp(Sy.prototype,"muteRemote",[CS],Object.getOwnPropertyDescriptor(Sy.prototype,"muteRemote"),Sy.prototype),Yp(Sy.prototype,"unmuteRemote",[CS],Object.getOwnPropertyDescriptor(Sy.prototype,"unmuteRemote"),Sy.prototype),Yp(Sy.prototype,"muteLocal",[CS],Object.getOwnPropertyDescriptor(Sy.prototype,"muteLocal"),Sy.prototype),Yp(Sy.prototype,"unmuteLocal",[CS],Object.getOwnPropertyDescriptor(Sy.prototype,"unmuteLocal"),Sy.prototype),Yp(Sy.prototype,"close",[CS],Object.getOwnPropertyDescriptor(Sy.prototype,"close"),Sy.prototype),Yp(Sy.prototype,"updateEncoderConfig",[CS],Object.getOwnPropertyDescriptor(Sy.prototype,"updateEncoderConfig"),Sy.prototype),Yp(Sy.prototype,"updateSendParameters",[CS],Object.getOwnPropertyDescriptor(Sy.prototype,"updateSendParameters"),Sy.prototype),Yp(Sy.prototype,"replaceTrack",[CS],Object.getOwnPropertyDescriptor(Sy.prototype,"replaceTrack"),Sy.prototype),Yp(Sy.prototype,"getRemoteSSRC",[CS],Object.getOwnPropertyDescriptor(Sy.prototype,"getRemoteSSRC"),Sy.prototype),Sy);function CS(_e,_t,_r){const _o=_e[_t];if(typeof _o!="function")throw new Error("Cannot use mutex on object property.");return _r.value=async function(){const _a=this.mutex,_u=await _a.lock("From DataChannelConnection.".concat(_t));try{for(var yl=arguments.length,Rl=new Array(yl),Al=0;Al<yl;Al++)Rl[Al]=arguments[Al];return await _o.apply(this,Rl)}finally{_u()}},_r}var ny;function hY(_e,_t){var _r=Object.keys(_e);if(Object.getOwnPropertySymbols){var _o=Object.getOwnPropertySymbols(_e);_t&&(_o=_o.filter(function(_a){return Object.getOwnPropertyDescriptor(_e,_a).enumerable})),_r.push.apply(_r,_o)}return _r}function _1(_e){for(var _t=1;_t<arguments.length;_t++){var _r=arguments[_t]!=null?arguments[_t]:{};_t%2?hY(Object(_r),!0).forEach(function(_o){Ml(_e,_o,_r[_o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_e,Object.getOwnPropertyDescriptors(_r)):hY(Object(_r)).forEach(function(_o){Object.defineProperty(_e,_o,Object.getOwnPropertyDescriptor(_r,_o))})}return _e}function b$(_e){var _t,_r,_o,_a=2;for(typeof Symbol<"u"&&(_r=hz,_o=Symbol.iterator);_a--;){if(_r&&(_t=_e[_r])!=null)return _t.call(_e);if(_o&&(_t=_e[_o])!=null)return new T$(_t.call(_e));_r="@@asyncIterator",_o="@@iterator"}throw new TypeError("Object is not async iterable")}function T$(_e){function _t(_r){if(Object(_r)!==_r)return u0.reject(new TypeError(_r+" is not an object."));var _o=_r.done;return u0.resolve(_r.value).then(function(_a){return{value:_a,done:_o}})}return(T$=function(_r){this.s=_r,this.n=_r.next}).prototype={s:null,n:null,next:function(){return _t(this.n.apply(this.s,arguments))},return:function(_r){var _o=this.s.return;return _o===void 0?u0.resolve({value:_r,done:!0}):_t(_o.apply(this.s,arguments))},throw:function(_r){var _o=this.s.return;return _o===void 0?u0.reject(_r):_t(_o.apply(this.s,arguments))}},new T$(_e)}let vre=(Yp((ny=class extends Hy{get state(){return this._state}set state(_e){const _t=this._state;this._state=_e,this.emit(ty.StateChange,_t,this._state)}constructor(_e,_t){super(),Ml(this,"store",void 0),Ml(this,"statsUploader",void 0),Ml(this,"connection",void 0),Ml(this,"localTrackMap",new Map),Ml(this,"remoteUserMap",new Map),Ml(this,"pendingLocalTracks",[]),Ml(this,"pendingRemoteTracks",[]),Ml(this,"statsCollector",void 0),Ml(this,"isPlanB",!1),Ml(this,"shouldForwardP2PCreation",void 0),Ml(this,"iceFailedCount",0),Ml(this,"dtlsFailedCount",0),Ml(this,"mutex",new iT("P2PChannel-mutex")),Ml(this,"_state",p_.Disconnected),Ml(this,"handleMuteLocalTrack",async(_r,_o,_a)=>{const _u=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==p_.Connected)return void _a(new Tp(Ql.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const yl=this.filterTobeMutedTracks(_r);if(yl.length===0)return void _o();const Rl=yl.find(Ol=>Ol[0]==="videoLowTrack");Rl&&Rl[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(yl.map(Ol=>{let[,{id:xl}]=Ol;return xl}));const Al=this.createMuteMessage(yl);await $y(this,ty.RequestMuteLocal,Al),_o()}catch(yl){_a(yl)}finally{_u()}}),Ml(this,"handleUnmuteLocalTrack",async(_r,_o,_a)=>{const _u=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==p_.Connected)return void _a(new Tp(Ql.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const yl=this.filterTobeUnmutedTracks(_r);if(yl.length===0)return void _o();const Rl=yl.find(Ol=>Ol[0]==="videoLowTrack");if(Rl){const Ol=Rl[1];if(Ol.track._originMediaStreamTrack.stop(),R_().supportDualStreamEncoding){const xl=_r._mediaStreamTrack.clone();Ol.track._mediaStreamTrack=xl,Ol.track._originMediaStreamTrack=xl}else{const xl=Gz(_r,dO(this,ty.RequestLowStreamParameter));Ol.track._mediaStreamTrack=xl,Ol.track._originMediaStreamTrack=xl}await new u0((xl,Ll)=>{this.handleReplaceTrack(Ol.track,xl,Ll,!0)})}await this.connection.unmuteLocal(yl.map(Ol=>{let[,{id:xl}]=Ol;return xl}));const Al=this.createUnmuteMessage(yl);await $y(this,ty.RequestUnmuteLocal,Al),_o()}catch(yl){_a(yl)}finally{_u()}}),Ml(this,"handleUpdateVideoEncoder",async(_r,_o,_a)=>{const _u=await this.mutex.lock("Locking from P2PChannel.handleSetVideoEncoder");try{const yl=this.localTrackMap.get(l0.LocalVideoTrack);if(!this.connection||!yl||yl.track!==_r||this.state!==p_.Connected)return void _o();const{id:Rl,track:Al}=yl;await this.connection.updateSendParameters(Rl,Al),await this.connection.updateEncoderConfig(Rl,Al),this.emit(ty.UpdateVideoEncoder,Al),_o()}catch(yl){_a(yl)}finally{_u()}}),Ml(this,"handleSetOptimizationMode",async(_r,_o,_a)=>{const _u=await this.mutex.lock("Locking from P2PChannel.handleSetOptimizationMode");try{const yl=this.localTrackMap.get(l0.LocalVideoTrack);if(!this.connection||!yl||yl.track!==_r||this.state!==p_.Connected)return;const{id:Rl,track:Al}=yl;await this.connection.updateSendParameters(Rl,Al),_o()}catch(yl){_a(yl)}finally{_u()}}),Ml(this,"handleReplaceTrack",async(_r,_o,_a,_u)=>{let yl;Vl.debug("P2PChannel handleReplaceTrack for [track-id-".concat(_r.getTrackId(),"]")),typeof _u=="boolean"&&_u||(yl=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var Rl;const Ol=Array.from(this.localTrackMap.entries()).find(xl=>{let[,{track:Ll}]=xl;return _r===Ll});if(!this.connection||!Ol||this.state!==p_.Connected)return void _o();if(await((Rl=this.connection)===null||Rl===void 0?void 0:Rl.replaceTrack(_r,Ol[1].id)),this.isPlanB){const xl=Ol[1];xl.id=_r._mediaStreamTrack.id,this.localTrackMap.set(Ol[0],xl)}if(Ol[0]===l0.LocalVideoTrack&&R_().supportDualStreamEncoding){const xl=this.localTrackMap.get(l0.LocalVideoLowTrack);if(xl){const Ll=_r._mediaStreamTrack.clone();xl.track._originMediaStreamTrack.stop(),xl.track._mediaStreamTrack=Ll,xl.track._originMediaStreamTrack=Ll,await new u0((Bl,Hl)=>{this.handleReplaceTrack(xl.track,Bl,Hl,!0)})}}_o()}catch(Ol){_a(Ol)}finally{var Al;(Al=yl)===null||Al===void 0||Al()}}),Ml(this,"handleGetLocalVideoStats",_r=>{_r(this.statsCollector.getLocalVideoTrackStats())}),Ml(this,"handleGetLocalAudioStats",_r=>{_r(this.statsCollector.getLocalAudioTrackStats())}),Ml(this,"handleGetRemoteVideoStats",_r=>this.statsCollector.getRemoteVideoTrackStats(_r.uid)[_r.uid]),Ml(this,"handleGetRemoteAudioStats",_r=>this.statsCollector.getRemoteAudioTrackStats(_r.uid)[_r.uid]),this.store=_e,this.statsCollector=_t,this.statsCollector.addP2PChannel(this),this.statsUploader=new gre,this.bindStatsUploaderEvents(),this.isPlanB=!R_().supportUnifiedPlan||Pp("CHROME_FORCE_PLAN_B")&&eO(),this.shouldForwardP2PCreation=Pp("FORWARD_P2P_CREATION")&&R_().supportPCSetConfiguration,this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new E1({},this.store):this.isPlanB?new I2({},this.store):new w2({},this.store),this.bindConnectionEvents(this.connection))}async startP2PConnection(_e,_t){if(this.state=p_.New,this.shouldForwardP2PCreation||(this.connection=this.store.useDataChannel?new E1(_e,this.store):this.isPlanB?new I2(_e,this.store):new w2(_e,this.store),this.bindConnectionEvents(this.connection)),!this.connection)throw new Tp(Ql.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this.connection.setConfiguration(_e),this.connection.establishPromise}async connect(_e,_t,_r,_o,_a,_u){if(!this.connection)throw new Tp(Ql.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");this.connection instanceof E1?this.connection.updateRemoteConnect(_o):(this.store.peerConnectionStart(),await this.connection.connect(_e,_t,_r,_o,_a,_u),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=p_.Connected)}async preConnect(_e,_t,_r,_o,_a,_u){if(!this.connection)throw new Tp(Ql.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");this.store.peerConnectionStart();const yl=await this.connection.connect(_e,_t,_r,_o,_a,_u);return this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=p_.Connected,yl}getEstablishParams(){if(this.connection instanceof E1)return this.connection.getP2PConnectionParams();throw new Error("Only DataChannelConnection needs to obtain establishParams")}publish(_e,_t,_r){var _o=this;return wS(function*(){const _a=yield H0(_o.mutex.lock("From P2PChannel.publish"));try{if(!_o.connection||_o.state!==p_.Connected){if(_o.state===p_.Disconnected)throw new Tp(Ql.UNEXPECTED_ERROR,"PeerConnection already disconnected.");_o.throwIfTrackTypeNotMatch(_e);const yl=_e.filter(Rl=>_o.pendingLocalTracks.indexOf(Rl)===-1);return void(_o.pendingLocalTracks=_o.pendingLocalTracks.concat(yl))}_o.store.pubId=_o.store.pubId+1,uS.markPublishStart(_o.store.clientId,_o.store.pubId);const _u=_o.filterTobePublishedTracks(_e,_t,_r);if(_u.length===0)return void(yield H0(_o.tryToUnmuteAudio(_e)));yield*S2(b$(_o.doPublish(_o.connection,_u)),H0)}finally{_a()}})()}doPublish(_e,_t){var _r=this;return wS(function*(){_t.forEach(Ol=>{let{track:xl,type:Ll}=Ol;const Bl=Date.now();_r.store.publish(xl.getTrackId(),Ll===l0.LocalAudioTrack?"audio":"video",Bl)}),_r.bindLocalTrackEvents(_t);const _o=yield H0(_e.send(_t.map(Ol=>{let{track:xl}=Ol;return xl}),_r.store.codec,_r.store.audioCodec)),_a=(yield H0(_o.next())).value,_u=_r.createGatewayPublishMessage(_t,_a);let yl;try{yl=yield _u}catch(Ol){throw _o.throw(Ol),(Ol==null?void 0:Ol.code)===Ql.WS_ABORT&&_t.forEach(xl=>{let{track:Ll}=xl;_r.pendingLocalTracks.indexOf(Ll)===-1&&_r.pendingLocalTracks.push(Ll)}),_r.unbindLocalTrackEvents(_t),Ol}const Rl=_r.mapPubResToRemoteConfig(_u,yl),Al=(yield H0(_o.next(Rl))).value;_t.forEach(Ol=>{let{type:xl}=Ol;_r.statsCollector.addLocalStats(xl)}),_r.assignLocalTracks(_t,Al),_r.statsUploader.startUploadUplinkStats(),_t.forEach(Ol=>{let{track:xl,type:Ll}=Ol;const Bl=Date.now();_r.store.publish(xl.getTrackId(),Ll===l0.LocalAudioTrack?"audio":"video",void 0,Bl)})})()}publishLowStream(_e){var _t=this;return wS(function*(){if(!_t.connection||_t.state!==p_.Connected)return;const _r=yield H0(_t.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const _a=_t.localTrackMap.get(l0.LocalVideoTrack);if(!_a)throw new Tp(Ql.UNEXPECTED_ERROR,"Could not find high stream");if(_t.localTrackMap.has(l0.LocalVideoLowTrack))throw new Tp(Ql.UNEXPECTED_ERROR,"[".concat(_t.store.clientId,"] Can't publish low stream when stream already publish"));const _u=[{track:_t.getLowVideoTrack(_a.track,_e),type:l0.LocalVideoLowTrack}];if(yield*S2(b$(_t.doPublish(_t.connection,_u)),H0),_a.track.muted||!_a.track.enabled){var _o;const yl=(_o=_t.localTrackMap.get(l0.LocalVideoLowTrack))===null||_o===void 0?void 0:_o.id;yl!==void 0&&(yield H0(_t.connection.muteLocal([yl])))}}finally{_r()}})()}async republish(){this.pendingLocalTracks.length>0&&(Vl.debug("Emit P2PChannelEvents.RequestRePublish to republish tracks."),await W_(this,ty.RequestRePublish,this.pendingLocalTracks),this.emit(ty.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async reSubscribe(_e){for(let _t=this.pendingRemoteTracks.length-1;_t>=0;_t--){const{user:_r,kind:_o}=this.pendingRemoteTracks[_t];(_o!==P0.AUDIO||_r._audio_added_&&_r._audioSSRC)&&(_o!==P0.VIDEO||_r._video_added_&&_r._videoSSRC)||this.pendingRemoteTracks.splice(_t,1)}if(_e)await W_(this,ty.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:_t,kind:_r}of this.pendingRemoteTracks)await this.subscribe(_t,_r,_r===P0.VIDEO?_t._videoSSRC:_t._audioSSRC);this.pendingRemoteTracks.forEach(_t=>{let{user:_r}=_t;this.emit(ty.MediaReconnectEnd,_r.uid)}),this.pendingRemoteTracks=[]}async unpublish(_e){if(!this.connection||this.state!==p_.Connected)return void _e.forEach(_o=>{const _a=this.pendingLocalTracks.indexOf(_o);_a!==-1&&this.pendingLocalTracks.splice(_a,1)});const _t=this.filterTobeUnpublishedTracks(_e);if(_t.length===0)return;const _r=_t.find(_o=>_o[0]==="videoLowTrack");return _r&&_r[1].track.close(),this.doUnpublish(this.connection,_t)}async unpublishLowStream(){if(!this.connection||this.state!==p_.Connected)return;const _e=this.localTrackMap.get(l0.LocalVideoLowTrack);if(!_e)return;_e.track.close();const _t=[[l0.LocalVideoLowTrack,_e]];return this.doUnpublish(this.connection,_t)}async doUnpublish(_e,_t){const _r=this.createGatewayUnpublishMessage(_t);return await _e.stopSending(_t.map(_o=>{let[,{id:_a}]=_o;return _a})),this.withdrawLocalTracks(_t),this.unbindLocalTrackEvents(_t.map(_o=>{let[_a,{track:_u}]=_o;return{type:_a,track:_u}})),_t.forEach(_o=>{let[_a]=_o;this.statsCollector.removeLocalStats(_a)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadUplinkStats(),_r}async subscribe(_e,_t,_r,_o,_a){var _u;if(!this.connection||this.state!==p_.Connected)throw new Tp(Ql.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((_u=this.remoteUserMap.get(_e))!==null&&_u!==void 0&&_u.has(_t))return;let yl,Rl;if(_a){const xl=_a.find(Bl=>{let{stream_type:Hl}=Bl;return Hl===_t});if(!xl)throw new Tp(Ql.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(_t," for user: ").concat(_e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(_t,"."));const Ll=await this.connection.receive(_t,xl.ssrcs,String(_e._uintid),xl.attributes);yl=Ll.track,Rl=Ll.id}else{const xl=await this.connection.receive(_t,[{ssrcId:_r,rtx:_o}],String(_e._uintid),void 0);yl=xl.track,Rl=xl.id}_t===P0.AUDIO?(_e._audioTrack?_e._audioTrack._updateOriginMediaStreamTrack(yl):(_e._audioTrack=new vU(yl,_e.uid,_e._uintid,this.store),Vl.info("[".concat(this.store.p2pId,"] create remote audio track: ").concat(_e._audioTrack.getTrackId()))),this.bindRemoteTrackEvents(_e,_e._audioTrack)):(_e._videoTrack?_e._videoTrack._updateOriginMediaStreamTrack(yl):(_e._videoTrack=new yU(yl,_e.uid,_e._uintid,this.store),Vl.info("[".concat(this.store.p2pId,"] create remote video track: ").concat(_e._videoTrack.getTrackId()))),this.bindRemoteTrackEvents(_e,_e._videoTrack));const Al=this.remoteUserMap.get(_e);Al?Al.set(_t,Rl):this.remoteUserMap.set(_e,new Map([[_t,Rl]])),this.statsCollector.addRemoteStats(_e.uid),this.statsUploader.startUploadDownlinkStats();const Ol=this.pendingRemoteTracks.findIndex(xl=>{let{user:Ll,kind:Bl}=xl;return Ll.uid===_e.uid&&_t===Bl});Ol!==-1&&(this.pendingRemoteTracks.splice(Ol,1),this.emit(ty.MediaReconnectEnd,_e.uid))}async massSubscribe(_e){return this.massSubscribeNoLock(_e)}async massSubscribeNoLock(_e){if(!this.connection||this.state!==p_.Connected)throw new Tp(Ql.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");_e=_e.filter(_r=>{var _o;let{user:_a,mediaType:_u}=_r;return!((_o=this.remoteUserMap.get(_a))!==null&&_o!==void 0&&_o.has(_u))});const _t=await this.connection.batchReceive(_e.map(_r=>{let{user:_o,mediaType:_a,ssrcId:_u,rtxSsrcId:yl}=_r;return{kind:_a,ssrcMsg:[{ssrcId:_u,rtx:yl}],mslabel:String(_o._uintid)}}));_e.forEach((_r,_o)=>{let{user:_a,mediaType:_u}=_r;const{track:yl,id:Rl}=_t[_o];_u===P0.AUDIO?(_a._audioTrack?_a._audioTrack._updateOriginMediaStreamTrack(yl):(_a._audioTrack=new vU(yl,_a.uid,_a._uintid,this.store),Vl.info("[".concat(this.store.p2pId,"] create remote audio track: ").concat(_a._audioTrack.getTrackId()))),this.bindRemoteTrackEvents(_a,_a._audioTrack)):(_a._videoTrack?_a._videoTrack._updateOriginMediaStreamTrack(yl):(_a._videoTrack=new yU(yl,_a.uid,_a._uintid,this.store),Vl.info("[".concat(this.store.p2pId,"] create remote video track: ").concat(_a._videoTrack.getTrackId()))),this.bindRemoteTrackEvents(_a,_a._videoTrack));const Al=this.remoteUserMap.get(_a);Al?Al.set(_u,Rl):this.remoteUserMap.set(_a,new Map([[_u,Rl]])),this.statsCollector.addRemoteStats(_a.uid),this.statsUploader.startUploadDownlinkStats();const Ol=this.pendingRemoteTracks.findIndex(xl=>{let{user:Ll,kind:Bl}=xl;return Ll.uid===_a.uid&&_u===Bl});Ol!==-1&&(this.pendingRemoteTracks.splice(Ol,1),this.emit(ty.MediaReconnectEnd,_a.uid))})}async unsubscribe(_e,_t,_r){const _o=this.pendingRemoteTracks.filter(yl=>{let{user:Rl,kind:Al}=yl;return _t!==void 0?Rl.uid===_e.uid&&_t===Al:Rl.uid===_e.uid});if(_o.forEach(yl=>{const Rl=this.pendingRemoteTracks.indexOf(yl);this.pendingRemoteTracks.splice(Rl,1)}),this.connection&&this.state===p_.Connected||_r||_o.forEach(yl=>{let{kind:Rl}=yl;var Al;if(Rl===P0.AUDIO)(Al=_e._audioTrack)===null||Al===void 0||Al._destroy(),_e._audioTrack=void 0;else if(Rl===P0.VIDEO){var Ol;(Ol=_e._videoTrack)===null||Ol===void 0||Ol._destroy(),_e._videoTrack=void 0}}),!this.connection||this.state!==p_.Connected)return;const _a=this.filterTobeUnSubscribedTracks(_e,_t);if(_a.length===0)return;await this.connection.stopReceiving(_a.map(yl=>{let[,{id:Rl}]=yl;return Rl}));const _u=this.createUnsubscribeMessage(_a);return this.withdrawRemoteTracks(_a),this.remoteUserMap.size===0&&this.statsUploader.stopUploadDownlinkStats(),_a.forEach(yl=>{let[Rl,{kind:Al}]=yl;var Ol,xl;if(Al===P0.VIDEO&&Rl._videoSSRC&&((Ol=this.connection)===null||Ol===void 0||Ol.setStatsRemoteVideoIsReady(Rl._videoSSRC,!1)),Al===P0.VIDEO)this.unbindRemoteTrackEvents(Rl._videoTrack),_r||((xl=Rl._videoTrack)===null||xl===void 0||xl._destroy(),Rl._videoTrack=void 0);else if(Al===P0.AUDIO){var Ll;this.unbindRemoteTrackEvents(Rl._audioTrack),!_r&&((Ll=Rl._audioTrack)===null||Ll===void 0||Ll._destroy(),Rl._audioTrack=void 0)}}),_u}async massUnsubscribe(_e){return this.massUnsubscribeNoLock(_e)}async massUnsubscribeNoLock(_e){let _t=[];for(const{user:_a,mediaType:_u}of _e){const yl=this.pendingRemoteTracks.filter(Rl=>{let{user:Al,kind:Ol}=Rl;return _u!==void 0?Al.uid===_a.uid&&_u===Ol:Al.uid===_a.uid});yl.forEach(Rl=>{const Al=this.pendingRemoteTracks.indexOf(Rl);this.pendingRemoteTracks.splice(Al,1)}),_t=_t.concat(yl)}if(!this.connection||this.state!==p_.Connected)return void _t.forEach(_a=>{let{user:_u,kind:yl}=_a;var Rl;if(yl===P0.AUDIO)(Rl=_u._audioTrack)===null||Rl===void 0||Rl._destroy(),_u._audioTrack=void 0;else if(yl===P0.VIDEO){var Al;(Al=_u._videoTrack)===null||Al===void 0||Al._destroy(),_u._videoTrack=void 0}});const _r=nS(_e).call(_e,(_a,_u)=>{let{user:yl,mediaType:Rl}=_u;const Al=this.filterTobeUnSubscribedTracks(yl,Rl);return _a.concat(Al)},[]);if(_r.length===0)return;await this.connection.stopReceiving(_r.map(_a=>{let[,{id:_u}]=_a;return _u}));const _o=this.createUnsubscribeAllMessage(_r);return this.withdrawRemoteTracks(_r),this.remoteUserMap.size===0&&this.statsUploader.stopUploadDownlinkStats(),_r.forEach(_a=>{let[_u,{kind:yl}]=_a;var Rl,Al;if(yl===P0.VIDEO&&_u._videoSSRC&&((Rl=this.connection)===null||Rl===void 0||Rl.setStatsRemoteVideoIsReady(_u._videoSSRC,!1)),yl===P0.VIDEO)this.unbindRemoteTrackEvents(_u._videoTrack),(Al=_u._videoTrack)===null||Al===void 0||Al._destroy(),_u._videoTrack=void 0;else if(yl===P0.AUDIO){var Ol;this.unbindRemoteTrackEvents(_u._audioTrack),(Ol=_u._audioTrack)===null||Ol===void 0||Ol._destroy(),_u._audioTrack=void 0}}),_o}async muteRemote(_e,_t){if(!this.connection)return;const _r=this.remoteUserMap.get(_e);if(!_r)return void Vl.warning("P2PChannel.muteRemote has no remote user ".concat(_e.uid,"."));if(!_r.get(_t))return void Vl.warning("P2PChannel.muteRemote has no remote user ".concat(_e.uid," media type ").concat(_t,"."));const _o=_t===P0.VIDEO?_e._videoSSRC:_e._audioSSRC;_o!==void 0&&this.connection.setStatsRemoteVideoIsReady(_o,!1)}async unmuteRemote(_e,_t){return this.unmuteRemoteNoLock(_e,_t)}async unmuteRemoteNoLock(_e,_t){if(!this.connection)return;const _r=this.remoteUserMap.get(_e);if(!_r)return void Vl.warning("P2PChannel.unmuteRemote has no remote user ".concat(_e.uid,"."));_r.get(_t)||Vl.warning("P2PChannel.unmuteRemote has no remote user ".concat(_e.uid," media type ").concat(_t,"."))}getAllTracks(_e){const _t=this.localTrackMap.get(l0.LocalAudioTrack);if((_t==null?void 0:_t.track)instanceof cS){const _r=_t.track;return Array.from(this.localTrackMap.entries()).filter(_o=>{let[_a]=_o;return _a!==l0.LocalAudioTrack}).filter(_o=>{let[_a]=_o;return!(_e&&_a===l0.LocalVideoLowTrack)}).map(_o=>{let[,{track:_a}]=_o;return _a}).concat(_r.trackList)}return Array.from(this.localTrackMap.entries()).filter(_r=>{let[_o]=_r;return!(_e&&_o===l0.LocalVideoLowTrack)}).map(_r=>{let[,{track:_o}]=_r;return _o})}reportPublishEvent(_e,_t,_r,_o,_a){if(_e){const yl=this.localTrackMap.get(l0.LocalAudioTrack),Rl=_o?this.localTrackMap.get(l0.LocalVideoLowTrack):this.localTrackMap.get(l0.LocalVideoTrack);g0.publish(this.store.sessionId,{eventElapse:uS.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:_e,ec:_t,audioName:yl==null?void 0:yl.track.getTrackLabel(),videoName:Rl==null?void 0:Rl.track.getTrackLabel(),screenshare:(Rl==null?void 0:Rl.track._hints.indexOf(f_.SCREEN_TRACK))!==-1,audio:!!yl,video:!!Rl,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:_a})}else{var _u;_r||(_r=[]);const yl=_r.find(Al=>Al instanceof V_),Rl=_o?(_u=this.localTrackMap.get(l0.LocalVideoTrack))===null||_u===void 0?void 0:_u.track:_r.find(Al=>Al instanceof i_);g0.publish(this.store.sessionId,{eventElapse:uS.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:_e,ec:_t,audioName:yl==null?void 0:yl.getTrackLabel(),videoName:Rl==null?void 0:Rl.getTrackLabel(),screenshare:(Rl==null?void 0:Rl._hints.indexOf(f_.SCREEN_TRACK))!==-1,audio:!!yl,video:!!Rl,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:_a})}}reportSubscribeEvent(_e,_t,_r,_o){const _a=_o===P0.VIDEO?_r._videoSSRC:_r._audioSSRC;_a&&g0.subscribe(this.store.sessionId,{succ:_e,ec:_t,video:_o===P0.VIDEO,audio:_o===P0.AUDIO,peerid:_r.uid,subscribeRequestid:_o===P0.VIDEO?_r._videoSSRC:_r._audioSSRC,p2pid:this.store.p2pId,eventElapse:uS.measureFromSubscribeStart(this.store.clientId,_a)})}reset(){Vl.debug("P2PChannel.reset"),this.mutex=new iT("P2PChannel-mutex"),this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new E1({},this.store):this.isPlanB?new I2({},this.store):new w2({},this.store),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadUplinkStats(),this.statsUploader.stopUploadDownlinkStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.state=p_.Disconnected}getStats(){var _e;return(_e=this.connection)===null||_e===void 0?void 0:_e.getStats()}getRemoteVideoIsReady(_e){var _t;return((_t=this.connection)===null||_t===void 0?void 0:_t.getRemoteVideoIsReady(_e))||!1}getLocalAudioVolume(){const _e=this.localTrackMap.get(l0.LocalAudioTrack);if(_e)return _e.track.getVolumeLevel()}getLocalVideoSize(){const _e=this.localTrackMap.get(l0.LocalVideoTrack);if(_e)return{width:_e.track._videoWidth||0,height:_e.track._videoHeight||0}}getEncoderConfig(_e){const _t=this.localTrackMap.get(_e);return _t&&_t.track instanceof i_||_t&&_t.track instanceof V_?_t.track._encoderConfig:void 0}getLocalMedia(_e){return this.localTrackMap.get(_e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(_e,_t){if(!_e)return this.remoteUserMap.size>0;const _r=this.remoteUserMap.get(_e);return!!_r&&(!_t||_r.has(_t))}async hasRemoteMediaWithLock(_e,_t){if(!_e)return this.remoteUserMap.size>0;const _r=this.remoteUserMap.get(_e);return!!_r&&(!_t||_r.has(_t))}getRemoteMedia(_e){var _t;const _r=Array.from(aO(_t=this.remoteUserMap).call(_t)).find(_o=>_o.uid===_e);return _r?{audioTrack:_r.audioTrack,audioSSRC:_r._audioSSRC,videoTrack:_r.videoTrack,videoSSRC:_r._videoSSRC}:{}}getAudioLevels(){let _e=Array.from(this.remoteUserMap.entries()).map(_r=>{let[_o]=_r;return{uid:_o.uid,level:_o.audioTrack?100*_o.audioTrack._source.getAccurateVolumeLevel():0}});const _t=this.localTrackMap.get(l0.LocalAudioTrack);return _t&&_e.push({level:100*_t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),_e=o4(_e).call(_e,(_r,_o)=>_r.level-_o.level),_e}async disconnectForReconnect(){this.connection&&(Vl.debug("P2PChannel.disconnectForReconnect closing P2PConnection"),this.state=p_.Reconnecting,Pp("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(_e=>{var _t,_r,_o,_a;let[_u]=_e;(_t=_u._videoTrack)===null||_t===void 0||(_r=_t._player)===null||_r===void 0||(_o=_r.getVideoElement())===null||_o===void 0||_o.pause(),(_a=_u._videoTrack)===null||_a===void 0||_a._originMediaStreamTrack.stop()}),this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new E1({},this.store):this.isPlanB?new I2({},this.store):new w2({},this.store),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(_e=>{let[_t,{track:_r}]=_e;switch(_t){case l0.LocalVideoTrack:_r._hints.includes(f_.LOW_STREAM)?_r.close():this.pendingLocalTracks.push(_r);break;case l0.LocalAudioTrack:_r instanceof cS?this.pendingLocalTracks=this.pendingLocalTracks.concat(_r.trackList):this.pendingLocalTracks.push(_r);break;case l0.LocalVideoLowTrack:}}),this.emit(ty.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(_e=>{let[_t,_r]=_e;Array.from(aO(_r).call(_r)).forEach(_o=>{this.setPendingRemoteMedia(_t,_o)}),this.emit(ty.MediaReconnectStart,_t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.statsUploader.stopUploadUplinkStats(),this.statsUploader.stopUploadDownlinkStats(),this.statsUploader.stopUploadTransportStats(),Vl.debug("P2PChannel disconnected, waiting to reconnect."))}hasPendingRemoteMedia(_e,_t){for(const _r of this.pendingRemoteTracks){const{user:_o,kind:_a}=_r;if((_e instanceof z4?_e.uid:_e)===_o.uid&&_t===_a)return!0}return!1}setPendingRemoteMedia(_e,_t){this.hasPendingRemoteMedia(_e,_t)||this.pendingRemoteTracks.push({user:_e,kind:_t})}restartICE(){var _e=this;return wS(function*(){if(!_e.connection||_e.state!==p_.Connected||_e.connection instanceof E1)return;const _t=yield H0(_e.mutex.lock("From P2PChannel.restartICE"));try{yield*S2(b$(_e.connection.restartICE()),H0)}finally{_t()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const _e=this.connection.getStats(),_t=this.localTrackMap.get(l0.LocalVideoTrack),_r=this.localTrackMap.get(l0.LocalAudioTrack),_o=_e.videoSend.find(Hl=>Hl.ssrc===(_t==null?void 0:_t.ssrcs[0].ssrcId)),_a=_e.audioSend.find(Hl=>Hl.ssrc===(_r==null?void 0:_r.ssrcs[0].ssrcId));if(!_o||!_a)return 1;const _u=cR(this,ty.NeedSignalRTT),yl=_o?_o.rttMs:void 0,Rl=_a?_a.rttMs:void 0,Al=yl&&Rl?(yl+Rl)/2:yl||Rl,Ol=(Al&&_u?(Al+_u)/2:Al||_u)||0,xl=100*_e.sendPacketLossRate*.7/50+.3*Ol/1500,Ll=xl<.17?1:xl<.36?2:xl<.59?3:xl<.1?4:5,Bl=_t==null?void 0:_t.track;if(Bl&&Bl._encoderConfig&&Bl._hints.indexOf(f_.SCREEN_TRACK)===-1){const Hl=Bl._encoderConfig.bitrateMax,up=_e.bitrate.actualEncoded;if(Hl&&up){const _f=(1e3*Hl-up)/(1e3*Hl);return qZ[_f<.15?0:_f<.3?1:_f<.45?2:_f<.6?3:4][Ll]}}return Ll}getDownlinkNetworkQuality(){if(!this.connection)return 0;const _e=this.connection.getStats();let _t=0;return Array.from(this.remoteUserMap.entries()).forEach(_r=>{let[_o]=_r;const _a=_o._audioSSRC,_u=_o._videoSSRC,yl=_e.audioRecv.find(up=>up.ssrc===_a),Rl=_e.videoRecv.find(up=>up.ssrc===_u);if(!yl&&!Rl)return void(_t+=1);const Al=cR(this,ty.NeedSignalRTT),Ol=_e.rtt,xl=(Ol&&Al?(Ol+Al)/2:Ol||Al)||0,Ll=yl?yl.jitterMs:void 0,Bl=_e.recvPacketLossRate;let Hl=.7*Bl*100/50+.3*xl/1500;Ll&&(Hl=.6*Bl*100/50+.2*xl/1500+.2*Ll/400),_t+=Hl<.1?1:Hl<.17?2:Hl<.36?3:Hl<.59?4:5}),this.remoteUserMap.size>0?Math.round(_t/this.remoteUserMap.size):_t}async muteLocalTrack(_e){return new u0((_t,_r)=>{this.handleMuteLocalTrack(_e,_t,_r)})}filterTobePublishedTracks(_e,_t,_r){const _o=[],_a=R_(),_u=this.getAllTracks();_e=jW(_e=_e.filter(Al=>_u.indexOf(Al)===-1));let yl=!1,Rl=!1;for(const Al of _e){if(Al instanceof i_&&(this.localTrackMap.has(l0.LocalVideoTrack)||yl?new Tp(Ql.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(_o.push({track:Al,type:l0.LocalVideoTrack}),yl=!0),_t)){const Ol=this.getLowVideoTrack(Al,_r);_o.push({track:Ol,type:l0.LocalVideoLowTrack})}if(Al instanceof V_){const Ol=this.localTrackMap.get(l0.LocalAudioTrack);if(Ol){if(!(Ol.track instanceof cS))throw new Tp(Ql.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(Al._bypassWebAudio)throw new Tp(Ql.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");Ol.track.addAudioTrack(Al),this.bindLocalAudioTrackEvents(Al,!0)}else if(Rl){const xl=_o.find(Ll=>{let{type:Bl}=Ll;return Bl===l0.LocalAudioTrack});if(!(xl.track instanceof cS))throw new Tp(Ql.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(Al._bypassWebAudio)throw new Tp(Ql.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");xl.track.addAudioTrack(Al)}else{if(!_a.webAudioMediaStreamDest||Al instanceof cS||Al._bypassWebAudio)_o.push({track:Al,type:l0.LocalAudioTrack});else{const xl=new cS;xl.addAudioTrack(Al),_o.push({track:xl,type:l0.LocalAudioTrack})}Rl=!0}}}return _o}filterTobeUnpublishedTracks(_e){const _t=[],_r=this.getAllTracks();_e=jW(_e=_e.filter(_o=>_r.indexOf(_o)!==-1));for(const _o of _e){if(_o instanceof V_){const _a=this.localTrackMap.get(l0.LocalAudioTrack);if(!_a)continue;_a.track instanceof cS?(_a.track.removeAudioTrack(_o),this.unbindLocalAudioTrackEvents(_o),_a.track.trackList.length===0&&(_t.push([l0.LocalAudioTrack,_a]),_a.track.close())):_t.push([l0.LocalAudioTrack,_a])}if(_o instanceof i_){const _a=this.localTrackMap.get(l0.LocalVideoTrack);if(!_a)continue;_t.push([l0.LocalVideoTrack,_a]);const _u=this.localTrackMap.get(l0.LocalVideoLowTrack);_u&&_t.push([l0.LocalVideoLowTrack,_u])}}return _t}bindLocalTrackEvents(_e){_e.forEach(_t=>{let{track:_r,type:_o}=_t;switch(_o){case l0.LocalVideoTrack:_r.addListener(w0.GET_STATS,this.handleGetLocalVideoStats),_r.addListener(w0.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),_r.addListener(w0.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),_r.addListener(w0.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),_r.addListener(w0.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),_r.addListener(w0.NEED_REPLACE_TRACK,this.handleReplaceTrack),_r.addListener(w0.NEED_MUTE_TRACK,this.handleMuteLocalTrack),_r.addListener(w0.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case l0.LocalAudioTrack:this.bindLocalAudioTrackEvents(_r);break;case l0.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(_e,_t){_e instanceof cS?_e.trackList.forEach(_r=>{_r.addListener(w0.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),_r.addListener(w0.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),_r.addListener(w0.GET_STATS,this.handleGetLocalAudioStats),_r.addListener(w0.NEED_MUTE_TRACK,this.handleMuteLocalTrack),_r.addListener(w0.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(_e.addListener(w0.GET_STATS,this.handleGetLocalAudioStats),_e.addListener(w0.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),_e.addListener(w0.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),_e.addListener(w0.NEED_MUTE_TRACK,this.handleMuteLocalTrack),_e.addListener(w0.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),_t||_e.addListener(w0.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(_e){_e||(_e=Array.from(this.localTrackMap.entries()).map(_t=>{let[_r,{track:_o}]=_t;return{track:_o,type:_r}})),_e.forEach(_t=>{let{track:_r,type:_o}=_t;switch(_o){case l0.LocalVideoTrack:_r.off(w0.GET_STATS,this.handleGetLocalVideoStats),_r.off(w0.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),_r.off(w0.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),_r.off(w0.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),_r.off(w0.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),_r.off(w0.NEED_REPLACE_TRACK,this.handleReplaceTrack),_r.off(w0.NEED_MUTE_TRACK,this.handleMuteLocalTrack),_r.off(w0.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case l0.LocalAudioTrack:this.unbindLocalAudioTrackEvents(_r);break;case l0.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(_e){_e instanceof cS?_e.trackList.forEach(_t=>{_t.off(w0.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),_t.off(w0.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),_t.off(w0.GET_STATS,this.handleGetLocalAudioStats),_t.off(w0.NEED_MUTE_TRACK,this.handleMuteLocalTrack),_t.off(w0.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(_e.off(w0.GET_STATS,this.handleGetLocalAudioStats),_e.off(w0.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),_e.off(w0.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),_e.off(w0.NEED_REPLACE_TRACK,this.handleReplaceTrack),_e.off(w0.NEED_MUTE_TRACK,this.handleMuteLocalTrack),_e.off(w0.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(_e,_t){_t instanceof yU&&_t.addListener(w0.GET_STATS,_r=>{_r(this.handleGetRemoteVideoStats(_e))}),_t instanceof vU&&_t.addListener(w0.GET_STATS,_r=>{_r(this.handleGetRemoteAudioStats(_e))})}unbindRemoteTrackEvents(_e){_e&&_e.removeAllListeners(w0.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(_e=>{let[_t,_r]=_e;_r.has(P0.AUDIO)&&this.unbindRemoteTrackEvents(_t._audioTrack),_r.has(P0.VIDEO)&&this.unbindRemoteTrackEvents(_t._videoTrack)})}createGatewayPublishMessage(_e,_t){return _e.map((_r,_o)=>{let _a,_u,{track:yl,type:Rl}=_r;switch(Rl){case l0.LocalAudioTrack:_a=l_.Audio,_u={dtx:yl instanceof Q5&&yl._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case l0.LocalVideoTrack:_a=yl._hints.includes(f_.SCREEN_TRACK)?l_.Screen:l_.High,_u=_1(_1({},NW(yl)),{},{codec:this.store.codec});break;case l0.LocalVideoLowTrack:_a=l_.Low,_u=_1(_1({},NW(yl)),{},{codec:this.store.codec})}return{stream_type:_a,attributes:_u,ssrcs:_t[_o]}})}createGatewayUnpublishMessage(_e){return _e.map(_t=>{let _r,[_o,{track:_a,ssrcs:_u,id:yl}]=_t;switch(_o){case l0.LocalVideoTrack:_r=_a._hints.includes(f_.SCREEN_TRACK)?l_.Screen:l_.High;break;case l0.LocalAudioTrack:_r=l_.Audio;break;case l0.LocalVideoLowTrack:_r=l_.Low}return{stream_type:_r,ssrcs:_u,mid:yl}})}assignLocalTracks(_e,_t){_e.forEach((_r,_o)=>{let{track:_a,type:_u}=_r;this.localTrackMap.set(_u,{track:_a,id:_t[_o].id,ssrcs:_t[_o].localSSRC})})}withdrawLocalTracks(_e){_e.forEach(_t=>{let[_r]=_t;this.localTrackMap.delete(_r)})}bindConnectionEvents(_e){_e.onConnectionStateChange=async _t=>{if(Vl.info("[p2pId: ".concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(_t,")")),this.emit(ty.PeerConnectionStateChange,_t),_t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),_t==="disconnected"&&_e.iceConnectionState==="disconnected")return setTimeout(()=>{_e.iceConnectionState==="disconnected"&&Pp("ICE_RESTART")&&cR(this,ty.QueryClientConnectionState)==="CONNECTED"&&this.emit(ty.RequestRestartICE)},800),void setTimeout(()=>{_e.peerConnectionState==="disconnected"&&(Vl.debug("P2PConnection disconnected timeout 4000ms, force reconnect"),setTimeout(()=>this.emit(ty.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);_t==="failed"&&(Vl.debug("P2PConnection state failed, force reconnect"),setTimeout(()=>this.emit(ty.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())},_e.onICEConnectionStateChange=_t=>{_t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),Vl.info("[p2pId: ".concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(_t,")")),g0.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:_t,tag:jy.TRACER}).onSuccess(),this.emit(ty.IceConnectionStateChange,_t)},_e.onICETransportStateChange=_t=>{Vl.info("[p2pId: ".concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(_t,")"))},_e.onDTLSTransportStateChange=_t=>{Vl.info("[p2pId: ".concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(_t,")"))},_e.onDTLSTransportError=_t=>{Vl.info("[p2pId: ".concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(_t,")"))},_e.onFirstAudioDecoded=_t=>{var _r;const _o=Array.from(aO(_r=this.remoteUserMap).call(_r)).find(_u=>_u._audioSSRC===_t);var _a;_o&&(this.store.subscribe(_o.uid,"audio",void 0,void 0,void 0,Date.now()),(_a=_o.audioTrack)===null||_a===void 0||_a.emit(aN.FIRST_FRAME_DECODED),g0.firstRemoteFrame(this.store.sessionId,F_.FIRST_AUDIO_DECODE,Fy.FIRST_AUDIO_DECODE,{peer:_o._uintid,subscribeElapse:uS.measureFromSubscribeStart(this.store.clientId,_t),subscribeRequestid:_t,p2pid:this.store.p2pId}))},_e.onFirstAudioReceived=_t=>{var _r;const _o=Array.from(aO(_r=this.remoteUserMap).call(_r)).find(_a=>_a._audioSSRC===_t);_o&&g0.firstRemoteFrame(this.store.sessionId,F_.FIRST_AUDIO_RECEIVED,Fy.FIRST_AUDIO_RECEIVED,{peer:_o._uintid,subscribeElapse:uS.measureFromSubscribeStart(this.store.clientId,_t),subscribeRequestid:_t,p2pid:this.store.p2pId})},_e.onFirstVideoDecoded=(_t,_r,_o)=>{this.reportVideoFirstFrameDecoded(_t,_r,_o)},_e.onFirstVideoReceived=_t=>{var _r;const _o=Array.from(aO(_r=this.remoteUserMap).call(_r)).find(_a=>_a._videoSSRC===_t);_o&&g0.firstRemoteFrame(this.store.sessionId,F_.FIRST_VIDEO_RECEIVED,Fy.FIRST_VIDEO_RECEIVED,{peer:_o._uintid,subscribeElapse:uS.measureFromSubscribeStart(this.store.clientId,_t),subscribeRequestid:_t,p2pid:this.store.p2pId})},_e.onSelectedLocalCandidateChanged=(_t,_r)=>{const _o=_t.candidateType==="relay",_a=_r.candidateType==="relay";_r.candidateType!=="unknown"&&_o===_a||this.emit(ty.ConnectionTypeChange,_o),Vl.info("[p2pId: ".concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(tU(_r))," -> ").concat(JSON.stringify(tU(_t)),")"))},_e.onSelectedRemoteCandidateChanged=(_t,_r)=>{Vl.info("[p2pId: ".concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(tU(_r))," -> ").concat(JSON.stringify(tU(_t)),")"))},_e.onFirstVideoDecodedTimeout=_t=>{this.reportVideoFirstFrameDecoded(_t,void 0,void 0,!0)}}unbindConnectionEvents(_e){_e.onConnectionStateChange=void 0,_e.onICEConnectionStateChange=void 0,_e.onICETransportStateChange=void 0,_e.onDTLSTransportStateChange=void 0,_e.onDTLSTransportError=void 0,_e.onFirstAudioDecoded=void 0,_e.onFirstAudioReceived=void 0,_e.onFirstVideoDecoded=void 0,_e.onFirstVideoReceived=void 0,_e.onSelectedLocalCandidateChanged=void 0,_e.onSelectedRemoteCandidateChanged=void 0,_e.onFirstVideoDecodedTimeout=void 0}filterTobeMutedTracks(_e){const _t=[];if(this.getAllTracks().indexOf(_e)===-1)return _t;const _r=this.localTrackMap.get(l0.LocalAudioTrack);if(_e instanceof V_&&(_r==null?void 0:_r.track)instanceof cS)return _r.track.isActive||_t.push([l0.LocalAudioTrack,_r]),_t;const _o=Array.from(this.localTrackMap.entries()).find(_a=>{let[,{track:_u}]=_a;return _e===_u});if(_o&&(_t.push(_o),_o[0]===l0.LocalVideoTrack)){const _a=this.localTrackMap.get(l0.LocalVideoLowTrack);_a&&_t.push([l0.LocalVideoLowTrack,_a])}return _t}filterTobeUnmutedTracks(_e){const _t=[],_r=this.localTrackMap.get(l0.LocalAudioTrack);if(_e instanceof V_&&(_r==null?void 0:_r.track)instanceof cS)return _r.track.isActive&&_t.push([l0.LocalAudioTrack,_r]),_t;const _o=Array.from(this.localTrackMap.entries()).find(_a=>{let[,{track:_u}]=_a;return _e===_u});if(_o)if(_o[0]===l0.LocalVideoTrack){_t.push(_o);const _a=this.localTrackMap.get(l0.LocalVideoLowTrack);_a&&_t.push([l0.LocalVideoLowTrack,_a])}else _t.push(_o);return _t}createMuteMessage(_e){return _e.map(_t=>{let _r,[_o,{track:_a,ssrcs:_u,id:yl}]=_t;switch(_o){case l0.LocalAudioTrack:_r=l_.Audio;break;case l0.LocalVideoTrack:_r=_a._hints.includes(f_.SCREEN_TRACK)?l_.Screen:l_.High;break;case l0.LocalVideoLowTrack:_r=l_.Low}return{stream_type:_r,ssrcs:_u,mid:yl}})}createUnmuteMessage(_e){return _e.map(_t=>{let _r,[_o,{track:_a,ssrcs:_u,id:yl}]=_t;switch(_o){case l0.LocalAudioTrack:_r=l_.Audio;break;case l0.LocalVideoTrack:_r=_a._hints.includes(f_.SCREEN_TRACK)?l_.Screen:l_.High;break;case l0.LocalVideoLowTrack:_r=l_.Low}return{stream_type:_r,ssrcs:_u,mid:yl}})}filterTobeUnSubscribedTracks(_e,_t){const _r=[],_o=this.remoteUserMap.get(_e);if(!_o)return _r;if(_t){const _a=_o.get(_t);if(!_a)return _r;_r.push([_e,{kind:_t,id:_a}])}else Array.from(_o.entries()).forEach(_a=>{let[_u,yl]=_a;_r.push([_e,{kind:_u,id:yl}])});return _r}createUnsubscribeMessage(_e){const _t=[];return _e.forEach(_r=>{let[_o,{kind:_a,id:_u}]=_r;switch(_a){case P0.VIDEO:return void(_o._videoSSRC&&_t.push({stream_type:P0.VIDEO,ssrcId:_o._videoSSRC}));case P0.AUDIO:return void(_o._audioSSRC&&_t.push({stream_type:P0.AUDIO,ssrcId:_o._audioSSRC}))}}),_t}createUnsubscribeAllMessage(_e){const _t=new Map;return _e.forEach(_r=>{let[_o,{kind:_a}]=_r;if(_t.has(_o)){let _u=_t.get(_o);_a===P0.VIDEO?_u|=t_.Video:_u|=t_.Audio,_t.set(_o,_u)}else _a===P0.VIDEO?_t.set(_o,t_.Video):_t.set(_o,t_.Audio)}),{users:Array.from(_t.entries()).map(_r=>{let[_o,_a]=_r;return{stream_id:_o.uid,stream_type:_a}})}}withdrawRemoteTracks(_e){_e.forEach(_t=>{let[_r,{kind:_o}]=_t;const _a=this.remoteUserMap.get(_r);_a&&(_a.delete(_o),Array.from(_a.entries()).length===0&&this.remoteUserMap.delete(_r))})}async updateBitrateLimit(_e){const _t=this.localTrackMap.get(l0.LocalVideoTrack),_r=this.localTrackMap.get(l0.LocalVideoLowTrack);_t&&await _t.track.setBitrateLimit(_e.uplink),_r&&_e.low_stream_uplink&&await _r.track.setBitrateLimit({max_bitrate:_e.low_stream_uplink.bitrate,min_bitrate:_e.low_stream_uplink.bitrate||0})}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}mapPubResToRemoteConfig(_e,_t){return _e.map((_r,_o)=>{var _a;let{stream_type:_u}=_r;return(_a=_t.find(yl=>{let{stream_type:Rl}=yl;return _u===Rl}))===null||_a===void 0?void 0:_a.attributes})}async tryToUnmuteAudio(_e){for(let _r=0;_r<_e.length;_r++)if(_e[_r]instanceof V_){var _t;const _o=this.filterTobeUnmutedTracks(_e[_r]);if(_o.length===0)continue;await((_t=this.connection)===null||_t===void 0?void 0:_t.unmuteLocal(_o.map(_u=>{let[,{id:yl}]=_u;return yl})));const _a=this.createUnmuteMessage(_o);return void await $y(this,ty.RequestUnmuteLocal,_a)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=_e=>{var _t;return!((_t=this.connection)===null||_t===void 0||!_t.getRemoteVideoIsReady(_e))},this.statsUploader.requestUpload=(_e,_t)=>this.emit(ty.RequestUploadStats,_e,_t),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await G_(Y6(this.dtlsFailedCount,h_)),this.emit(ty.RequestReconnect)}async reconnectP2P(){const _e=Array.from(this.localTrackMap.entries()),_t=this.createGatewayUnpublishMessage(_e);Array.from(this.remoteUserMap.entries()),_t.length>0&&await W_(this,ty.RequestUnpublishForReconnectPC,_t),this.disconnectForReconnect(),this.emit(ty.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(l0.LocalVideoTrack)||this.pendingLocalTracks.some(_e=>_e instanceof i_)}throwIfTrackTypeNotMatch(_e){if(_e.filter(_t=>_t instanceof i_).length>1)throw new Tp(Ql.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(_e.filter(_t=>_t instanceof V_).length>1&&(_e.some(_t=>_t instanceof V_&&_t._bypassWebAudio)||!R_().webAudioMediaStreamDest))throw new Tp(Ql.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const _t of _e){if(_t instanceof i_&&this.pendingLocalTracks.some(_r=>_r instanceof i_))throw new Tp(Ql.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(_t instanceof V_&&this.pendingLocalTracks.some(_r=>_r instanceof V_)&&(!R_().webAudioMediaStreamDest||_t._bypassWebAudio||this.pendingLocalTracks.some(_r=>_r instanceof V_&&_r._bypassWebAudio)))throw new Tp(Ql.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(_e,_t){const _r=R_().supportDualStreamEncoding,_o=_1(_1({},{width:160,height:120,framerate:15,bitrate:50}),_t);let _a;_a=_r?_e._mediaStreamTrack.clone():Gz(_e,_o);const _u=Ny(8,"track-low-"),yl=new i_(_a,_1(_1({},_r&&{scaleResolutionDownBy:Xte(_o,_e)}),{},{frameRate:_o.framerate,bitrateMax:_o.bitrate,bitrateMin:_o.bitrate}),void 0,void 0,_u);return yl._hints.push(f_.LOW_STREAM),_e.addListener(w0.NEED_CLOSE,()=>{yl.close()}),yl}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}reportVideoFirstFrameDecoded(_e,_t,_r,_o){var _a;const _u=Array.from(aO(_a=this.remoteUserMap).call(_a)).find(yl=>yl._videoSSRC===_e);if(_u){_o||this.store.subscribe(_u.uid,"video",void 0,void 0,void 0,void 0,Date.now());const yl=this.store.keyMetrics,Rl=yl.subscribe.find(Al=>Al.userId===_u.uid&&Al.type==="video");g0.firstRemoteVideoDecode(this.store.sessionId,F_.FIRST_VIDEO_DECODE,Fy.FIRST_VIDEO_DECODE,{peer:_u._uintid,videowidth:_t,videoheight:_r,subscribeElapse:uS.measureFromSubscribeStart(this.store.clientId,_e),subscribeRequestid:_e,p2pid:this.store.p2pId,apEnd:yl.requestAPEnd||0,apStart:yl.requestAPStart||0,joinGwEnd:yl.joinGatewayEnd||0,joinGwStart:yl.joinGatewayStart||0,pcEnd:yl.peerConnectionEnd||0,pcStart:yl.peerConnectionStart||0,subscriberEnd:(Rl==null?void 0:Rl.subscribeEnd)||0,subscriberStart:(Rl==null?void 0:Rl.subscribeStart)||0,videoAddNotify:(Rl==null?void 0:Rl.streamAdded)||0,state:_o?1:0})}}async remoteMediaSsrcChanged(_e,_t,_r){if(!this.connection)return!1;const _o=this.remoteUserMap.get(_e);if(!_o)return!1;const _a=_o.get(_t);if(!_a)return!1;const _u=await this.connection.getRemoteSSRC(_a);return _u!==void 0&&_u!==_r}resetConnection(_e){Vl.debug("[P2PChannel] reset connection to ".concat(_e)),this.state===p_.Connected?(Vl.debug("[P2PChannel] fallback to websocket but P2PChannel state still connected, disconnect first"),this.disconnectForReconnect()):(this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=_e===W5.datachannel?new E1({},this.store):this.isPlanB?new I2({},this.store):new w2({},this.store),this.bindConnectionEvents(this.connection)))}}).prototype,"startP2PConnection",[PT],Object.getOwnPropertyDescriptor(ny.prototype,"startP2PConnection"),ny.prototype),Yp(ny.prototype,"connect",[PT],Object.getOwnPropertyDescriptor(ny.prototype,"connect"),ny.prototype),Yp(ny.prototype,"preConnect",[PT],Object.getOwnPropertyDescriptor(ny.prototype,"preConnect"),ny.prototype),Yp(ny.prototype,"unpublish",[PT],Object.getOwnPropertyDescriptor(ny.prototype,"unpublish"),ny.prototype),Yp(ny.prototype,"unpublishLowStream",[PT],Object.getOwnPropertyDescriptor(ny.prototype,"unpublishLowStream"),ny.prototype),Yp(ny.prototype,"subscribe",[PT],Object.getOwnPropertyDescriptor(ny.prototype,"subscribe"),ny.prototype),Yp(ny.prototype,"massSubscribe",[PT],Object.getOwnPropertyDescriptor(ny.prototype,"massSubscribe"),ny.prototype),Yp(ny.prototype,"unsubscribe",[PT],Object.getOwnPropertyDescriptor(ny.prototype,"unsubscribe"),ny.prototype),Yp(ny.prototype,"massUnsubscribe",[PT],Object.getOwnPropertyDescriptor(ny.prototype,"massUnsubscribe"),ny.prototype),Yp(ny.prototype,"muteRemote",[PT],Object.getOwnPropertyDescriptor(ny.prototype,"muteRemote"),ny.prototype),Yp(ny.prototype,"unmuteRemote",[PT],Object.getOwnPropertyDescriptor(ny.prototype,"unmuteRemote"),ny.prototype),Yp(ny.prototype,"hasRemoteMediaWithLock",[PT],Object.getOwnPropertyDescriptor(ny.prototype,"hasRemoteMediaWithLock"),ny.prototype),Yp(ny.prototype,"disconnectForReconnect",[PT],Object.getOwnPropertyDescriptor(ny.prototype,"disconnectForReconnect"),ny.prototype),Yp(ny.prototype,"updateBitrateLimit",[PT],Object.getOwnPropertyDescriptor(ny.prototype,"updateBitrateLimit"),ny.prototype),Yp(ny.prototype,"remoteMediaSsrcChanged",[PT],Object.getOwnPropertyDescriptor(ny.prototype,"remoteMediaSsrcChanged"),ny.prototype),ny);function PT(_e,_t,_r){const _o=_e[_t];if(typeof _o!="function")throw new Error("Cannot use mutex on object property.");return _r.value=async function(){const _a=this.mutex,_u=await _a.lock("From P2PChannel.".concat(_t));try{for(var yl=arguments.length,Rl=new Array(yl),Al=0;Al<yl;Al++)Rl[Al]=arguments[Al];return await _o.apply(this,Rl)}finally{_u()}},_r}function fY(_e,_t){var _r=Object.keys(_e);if(Object.getOwnPropertySymbols){var _o=Object.getOwnPropertySymbols(_e);_t&&(_o=_o.filter(function(_a){return Object.getOwnPropertyDescriptor(_e,_a).enumerable})),_r.push.apply(_r,_o)}return _r}function m0(_e){for(var _t=1;_t<arguments.length;_t++){var _r=arguments[_t]!=null?arguments[_t]:{};_t%2?fY(Object(_r),!0).forEach(function(_o){Ml(_e,_o,_r[_o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_e,Object.getOwnPropertyDescriptors(_r)):fY(Object(_r)).forEach(function(_o){Object.defineProperty(_e,_o,Object.getOwnPropertyDescriptor(_r,_o))})}return _e}var K0;(function(_e){_e.SET_SESSION_ID="SET_SESSION_ID",_e.SET_P2P_ID="SET_P2P_id",_e.SET_DC_ID="SET_DC_id",_e.SET_UID="SET_UID",_e.SET_PUB_ID="SET_PUB_ID",_e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",_e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",_e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",_e.AVOID_JOIN_START="AVOID_JOIN_START",_e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",_e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",_e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",_e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",_e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",_e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",_e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",_e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",_e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",_e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",_e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",_e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",_e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",_e.RESET_KEY_METRICS="RESET_KEY_METRICS",_e.SET_USE_DATACHANNEL="SET_USE_DATACHANNEL"})(K0||(K0={}));class Ere{constructor(_t,_r,_o,_a){Ml(this,"state",void 0),this.state={codec:_t,audioCodec:_r,mode:_o,clientId:_a,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useDataChannel:!1}}dispatch(_t){this.state=function(_r,_o){switch(_o.type){case K0.SET_SESSION_ID:return m0(m0({},_r),{},{sessionId:_o.sessionId});case K0.SET_P2P_ID:return m0(m0({},_r),{},{p2pId:_o.p2pId});case K0.SET_UID:return m0(m0({},_r),{},{uid:_o.uid});case K0.SET_PUB_ID:return m0(m0({},_r),{},{pubId:_o.pubId});case K0.KEY_METRIC_CLIENT_CREATED:return m0(m0({},_r),{},{keyMetrics:m0(m0({},_r.keyMetrics),{},{clientCreated:_o.metric})});case K0.KEY_METRIC_JOIN_START:return m0(m0({},_r),{},{keyMetrics:m0(m0({},_r.keyMetrics),{},{joinStart:_o.metric})});case K0.AVOID_JOIN_START:return m0(m0({},_r),{},{avoidJoinStart:_o.avoidJoinStart});case K0.KEY_METRIC_JOIN_END:return m0(m0({},_r),{},{keyMetrics:m0(m0({},_r.keyMetrics),{},{joinEnd:_o.metric})});case K0.KEY_METRIC_REQUEST_AP_START:return m0(m0({},_r),{},{keyMetrics:m0(m0({},_r.keyMetrics),{},{requestAPStart:_o.metric})});case K0.KEY_METRIC_REQUEST_AP_END:return m0(m0({},_r),{},{keyMetrics:m0(m0({},_r.keyMetrics),{},{requestAPEnd:_o.metric})});case K0.KEY_METRIC_JOIN_GATEWAY_START:return m0(m0({},_r),{},{keyMetrics:m0(m0({},_r.keyMetrics),{},{joinGatewayStart:_o.metric})});case K0.KEY_METRIC_JOIN_GATEWAY_END:return m0(m0({},_r),{},{keyMetrics:m0(m0({},_r.keyMetrics),{},{joinGatewayEnd:_o.metric})});case K0.KEY_METRIC_PEER_CONNECTION_START:return m0(m0({},_r),{},{keyMetrics:m0(m0({},_r.keyMetrics),{},{peerConnectionStart:_o.metric})});case K0.KEY_METRIC_PEER_CONNECTION_END:return m0(m0({},_r),{},{keyMetrics:m0(m0({},_r.keyMetrics),{},{peerConnectionEnd:_o.metric})});case K0.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return m0(m0({},_r),{},{keyMetrics:m0(m0({},_r.keyMetrics),{},{signalChannelOpen:_o.metric})});case K0.KEY_METRIC_ICE_CONNECTION_END:return m0(m0({},_r),{},{keyMetrics:m0(m0({},_r.keyMetrics),{},{iceConnectionEnd:_o.metric})});case K0.KEY_METRIC_PUBLISH:{const _a=_r.keyMetrics.publish,_u=_a.findIndex(yl=>yl.trackId===_o.metric.trackId);return _u!==-1?(_a[_u]=m0(m0({},_a[_u]),_o.metric),m0(m0({},_r),{},{keyMetrics:m0(m0({},_r.keyMetrics),{},{publish:[..._a]})})):m0(m0({},_r),{},{keyMetrics:m0(m0({},_r.keyMetrics),{},{publish:[..._r.keyMetrics.publish,_o.metric]})})}case K0.KEY_METRIC_SUBSCRIBE:{const _a=_r.keyMetrics.subscribe,_u=_a.findIndex(yl=>yl.userId===_o.metric.userId&&yl.type===_o.metric.type);return _u!==-1?(_a[_u]=m0(m0({},_a[_u]),_o.metric),m0(m0({},_r),{},{keyMetrics:m0(m0({},_r.keyMetrics),{},{subscribe:[..._a]})})):m0(m0({},_r),{},{keyMetrics:m0(m0({},_r.keyMetrics),{},{subscribe:[..._r.keyMetrics.subscribe,_o.metric]})})}case K0.SET_CLOUD_PROXY_SERVER_MODE:return _r.cloudProxyServerMode=_o.mode,_r;case K0.RECORD_JOIN_CHANNEL_SERVICE:return typeof _o.index!="number"?_r.joinChannelServiceRecords=[..._r.joinChannelServiceRecords,_o.record]:(_r.joinChannelServiceRecords[_o.index]=m0(m0({},_r.joinChannelServiceRecords[_o.index]),_o.record),_r.joinChannelServiceRecords=[..._r.joinChannelServiceRecords]),_r;case K0.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return _r.joinChannelServiceRecords=[],_r;case K0.RESET_KEY_METRICS:return _r.keyMetrics={publish:[],subscribe:[]},_r;case K0.SET_USE_DATACHANNEL:return m0(m0({},_r),{},{useDataChannel:_o.val});default:return _r}}(this.state,_t)}set sessionId(_t){this.dispatch({type:K0.SET_SESSION_ID,sessionId:_t})}get sessionId(){return this.state.sessionId}get codec(){return this.state.codec}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(_t){this.dispatch({type:K0.SET_P2P_ID,p2pId:_t})}get p2pId(){return this.state.p2pId}set dcId(_t){this.dispatch({type:K0.SET_DC_ID,dcId:_t})}get dcId(){return this.state.dcId}set uid(_t){this.dispatch({type:K0.SET_UID,uid:_t})}get uid(){return this.state.uid}set pubId(_t){this.dispatch({type:K0.SET_PUB_ID,pubId:_t})}get pubId(){return this.state.pubId}set cloudProxyServerMode(_t){this.dispatch({type:K0.SET_CLOUD_PROXY_SERVER_MODE,mode:_t})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useDataChannel(_t){this.dispatch({type:K0.SET_USE_DATACHANNEL,val:_t})}get useDataChannel(){return this.state.useDataChannel}clientCreated(){this.dispatch({type:K0.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:K0.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:K0.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:K0.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:K0.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:K0.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:K0.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:K0.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:K0.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:K0.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:K0.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(_t,_r,_o,_a){this.dispatch({type:K0.KEY_METRIC_PUBLISH,metric:m0(m0({trackId:_t,type:_r},_o&&{publishStart:_o}),_a&&{publishEnd:_a})})}subscribe(_t,_r,_o,_a,_u,yl,Rl){this.dispatch({type:K0.KEY_METRIC_SUBSCRIBE,metric:m0(m0(m0(m0(m0({userId:_t,type:_r},_o&&{subscribeStart:_o}),_a&&{subscribeEnd:_a}),_u&&{firstFrame:_u}),yl&&{streamAdded:yl}),Rl&&{firstDecoded:Rl})})}massSubscribe(_t,_r,_o,_a){_t.forEach(_u=>{this.dispatch({type:K0.KEY_METRIC_SUBSCRIBE,metric:m0(m0(m0({userId:_u.userId,type:_u.type},_r&&{subscribeStart:_r}),_o&&{subscribeEnd:_o}),_a&&{firstFrame:_a})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(_t,_r){_t.service==="gateway"&&Array.isArray(_t.urls)&&(_t.urls=_t.urls.map(_o=>_o.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof _r!="number"?(this.dispatch({type:K0.RECORD_JOIN_CHANNEL_SERVICE,record:m0(m0({},_t),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(_r<0||_r>=this.state.joinChannelServiceRecords.length||this.dispatch({type:K0.RECORD_JOIN_CHANNEL_SERVICE,record:_t,index:_r}),_r)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:K0.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:K0.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(_t){this.dispatch({type:K0.AVOID_JOIN_START,avoidJoinStart:_t})}}let bU;const _re=()=>(bU||bU||(bU=(window.location.protocol.split(":")[0]||"").toUpperCase(),bU))==="HTTPS",pY=()=>window.isSecureContext!==void 0;function bre(_e){let _t=yY();return function(_r,_o){let _a=_r.appId;_a!==void 0&&(oy(_o,10),lR(_o,_a));let _u=_r.cid;_u!==void 0&&(oy(_o,16),oy(_o,_u));let yl=_r.cname;yl!==void 0&&(oy(_o,26),lR(_o,yl));let Rl=_r.deviceId;Rl!==void 0&&(oy(_o,34),lR(_o,Rl));let Al=_r.elapse;Al!==void 0&&(oy(_o,40),T1(_o,Al));let Ol=_r.fileSize;Ol!==void 0&&(oy(_o,48),T1(_o,_N(Ol)));let xl=_r.height;xl!==void 0&&(oy(_o,56),T1(_o,_N(xl)));let Ll=_r.jpg;Ll!==void 0&&(oy(_o,66),oy(_o,Ll.length),function(RT,Vp){let Jp=bN(RT,Vp.length);RT.bytes.set(Vp,Jp)}(_o,Ll));let Bl=_r.networkType;Bl!==void 0&&(oy(_o,72),T1(_o,_N(Bl)));let Hl=_r.osType;Hl!==void 0&&(oy(_o,80),T1(_o,_N(Hl)));let up=_r.requestId;up!==void 0&&(oy(_o,90),lR(_o,up));let _f=_r.sdkVersion;_f!==void 0&&(oy(_o,98),lR(_o,_f));let vp=_r.sequence;vp!==void 0&&(oy(_o,104),T1(_o,_N(vp)));let Dp=_r.sid;Dp!==void 0&&(oy(_o,114),lR(_o,Dp));let Bp=_r.timestamp;Bp!==void 0&&(oy(_o,120),T1(_o,Bp));let _g=_r.uid;_g!==void 0&&(oy(_o,128),oy(_o,_g));let y0=_r.vid;y0!==void 0&&(oy(_o,136),oy(_o,y0));let e0=_r.width;e0!==void 0&&(oy(_o,144),T1(_o,_N(e0)));let r0=_r.service;r0!==void 0&&(oy(_o,152),oy(_o,r0));let Zp=_r.callbackData;Zp!==void 0&&(oy(_o,162),lR(_o,Zp));let h0=_r.jpgEncryption;h0!==void 0&&(oy(_o,168),oy(_o,h0));let _y=_r.requestType;_y!==void 0&&(oy(_o,176),oy(_o,_y));let k0=_r.scorePorn;k0!==void 0&&(oy(_o,185),w$(_o,k0));let Oy=_r.scoreSexy;Oy!==void 0&&(oy(_o,193),w$(_o,Oy));let by=_r.scoreNeutral;by!==void 0&&(oy(_o,201),w$(_o,by));let Xy=_r.scene;Xy!==void 0&&(oy(_o,208),oy(_o,Xy));let P_=_r.ossFilePrefix;P_!==void 0&&(oy(_o,218),lR(_o,P_));let zy=_r.serviceVendor;if(zy!==void 0)for(let RT of zy){oy(_o,226);let Vp=yY();Rre(RT,Vp),oy(_o,Vp.limit),Ore(_o,Vp),wre(Vp)}}(_e,_t),function(_r){let _o=_r.bytes,_a=_r.limit;return _o.length===_a?_o:_o.subarray(0,_a)}(_t)}function Tre(_e){return function(_r){let _o={};e:for(;!vY(_r);){let _a=dR(_r);switch(_a>>>3){case 0:break e;case 1:_o.code=dR(_r);break;case 2:_o.msg=EY(_r,dR(_r));break;case 3:{let _u=Are(_r);_o.data=Sre(_r),_r.limit=_u;break}default:gY(_r,7&_a)}}return _o}({bytes:_t=_e,offset:0,limit:_t.length});var _t}function Sre(_e){let _t={};e:for(;!vY(_e);){let _r=dR(_e);switch(_r>>>3){case 0:break e;case 1:_t.requestId=EY(_e,dR(_e));break;case 2:_t.requestType=dR(_e)>>>0;break;case 3:_t.scorePorn=I$(_e);break;case 4:_t.scoreSexy=I$(_e);break;case 5:_t.scoreNeutral=I$(_e);break;case 6:_t.requestScene=dR(_e)>>>0;break;case 7:_t.scene=dR(_e)>>>0;break;default:gY(_e,7&_r)}}return _t}function Rre(_e,_t){let _r=_e.service;_r!==void 0&&(oy(_t,8),oy(_t,_r));let _o=_e.vendor;_o!==void 0&&(oy(_t,16),oy(_t,_o));let _a=_e.token;_a!==void 0&&(oy(_t,26),lR(_t,_a));let _u=_e.callbackUrl;_u!==void 0&&(oy(_t,34),lR(_t,_u))}function Are(_e){let _t=dR(_e),_r=_e.limit;return _e.limit=_e.offset+_t,_r}function gY(_e,_t){switch(_t){case 0:for(;128&_Y(_e););break;case 2:R$(_e,dR(_e));break;case 5:R$(_e,4);break;case 1:R$(_e,8);break;default:throw new Error("Unimplemented type: "+_t)}}let Ire=new Float32Array(1);new Uint8Array(Ire.buffer);let S$=new Float64Array(1),ST=new Uint8Array(S$.buffer);function _N(_e){return{low:_e|=0,high:_e>>31,unsigned:_e>=0}}let mY=[];function yY(){const _e=mY.pop();return _e?(_e.offset=_e.limit=0,_e):{bytes:new Uint8Array(64),offset:0,limit:0}}function wre(_e){mY.push(_e)}function R$(_e,_t){if(_e.offset+_t>_e.limit)throw new Error("Skip past limit");_e.offset+=_t}function vY(_e){return _e.offset>=_e.limit}function bN(_e,_t){let _r=_e.bytes,_o=_e.offset,_a=_e.limit,_u=_o+_t;if(_u>_r.length){let yl=new Uint8Array(2*_u);yl.set(_r),_e.bytes=yl}return _e.offset=_u,_u>_a&&(_e.limit=_u),_o}function A$(_e,_t){let _r=_e.offset;if(_r+_t>_e.limit)throw new Error("Read past limit");return _e.offset+=_t,_r}function EY(_e,_t){let _r=A$(_e,_t),_o=String.fromCharCode,_a=_e.bytes,_u="�",yl="";for(let Rl=0;Rl<_t;Rl++){let Al,Ol,xl,Ll,Bl=_a[Rl+_r];128&Bl?(224&Bl)==192?Rl+1>=_t?yl+=_u:(Al=_a[Rl+_r+1],(192&Al)!=128?yl+=_u:(Ll=(31&Bl)<<6|63&Al,Ll<128?yl+=_u:(yl+=_o(Ll),Rl++))):(240&Bl)==224?Rl+2>=_t?yl+=_u:(Al=_a[Rl+_r+1],Ol=_a[Rl+_r+2],(49344&(Al|Ol<<8))!=32896?yl+=_u:(Ll=(15&Bl)<<12|(63&Al)<<6|63&Ol,Ll<2048||Ll>=55296&&Ll<=57343?yl+=_u:(yl+=_o(Ll),Rl+=2))):(248&Bl)==240?Rl+3>=_t?yl+=_u:(Al=_a[Rl+_r+1],Ol=_a[Rl+_r+2],xl=_a[Rl+_r+3],(12632256&(Al|Ol<<8|xl<<16))!=8421504?yl+=_u:(Ll=(7&Bl)<<18|(63&Al)<<12|(63&Ol)<<6|63&xl,Ll<65536||Ll>1114111?yl+=_u:(Ll-=65536,yl+=_o(55296+(Ll>>10),56320+(1023&Ll)),Rl+=3))):yl+=_u:yl+=_o(Bl)}return yl}function lR(_e,_t){let _r=_t.length,_o=0;for(let yl=0;yl<_r;yl++){let Rl=_t.charCodeAt(yl);Rl>=55296&&Rl<=56319&&yl+1<_r&&(Rl=(Rl<<10)+_t.charCodeAt(++yl)-56613888),_o+=Rl<128?1:Rl<2048?2:Rl<65536?3:4}oy(_e,_o);let _a=bN(_e,_o),_u=_e.bytes;for(let yl=0;yl<_r;yl++){let Rl=_t.charCodeAt(yl);Rl>=55296&&Rl<=56319&&yl+1<_r&&(Rl=(Rl<<10)+_t.charCodeAt(++yl)-56613888),Rl<128?_u[_a++]=Rl:(Rl<2048?_u[_a++]=Rl>>6&31|192:(Rl<65536?_u[_a++]=Rl>>12&15|224:(_u[_a++]=Rl>>18&7|240,_u[_a++]=Rl>>12&63|128),_u[_a++]=Rl>>6&63|128),_u[_a++]=63&Rl|128)}}function Ore(_e,_t){let _r=bN(_e,_t.limit),_o=_e.bytes,_a=_t.bytes;for(let _u=0,yl=_t.limit;_u<yl;_u++)_o[_u+_r]=_a[_u]}function _Y(_e){return _e.bytes[A$(_e,1)]}function bY(_e,_t){let _r=bN(_e,1);_e.bytes[_r]=_t}function I$(_e){let _t=A$(_e,8),_r=_e.bytes;return ST[0]=_r[_t++],ST[1]=_r[_t++],ST[2]=_r[_t++],ST[3]=_r[_t++],ST[4]=_r[_t++],ST[5]=_r[_t++],ST[6]=_r[_t++],ST[7]=_r[_t++],S$[0]}function w$(_e,_t){let _r=bN(_e,8),_o=_e.bytes;S$[0]=_t,_o[_r++]=ST[0],_o[_r++]=ST[1],_o[_r++]=ST[2],_o[_r++]=ST[3],_o[_r++]=ST[4],_o[_r++]=ST[5],_o[_r++]=ST[6],_o[_r++]=ST[7]}function dR(_e){let _t,_r=0,_o=0;do _t=_Y(_e),_r<32&&(_o|=(127&_t)<<_r),_r+=7;while(128&_t);return _o}function oy(_e,_t){for(_t>>>=0;_t>=128;)bY(_e,127&_t|128),_t>>>=7;bY(_e,_t)}function T1(_e,_t){let _r=_t.low>>>0,_o=(_t.low>>>28|_t.high<<4)>>>0,_a=_t.high>>>24,_u=_a===0?_o===0?_r<16384?_r<128?1:2:_r<1<<21?3:4:_o<16384?_o<128?5:6:_o<1<<21?7:8:_a<128?9:10,yl=bN(_e,_u),Rl=_e.bytes;switch(_u){case 10:Rl[yl+9]=_a>>>7&1;case 9:Rl[yl+8]=_u!==9?128|_a:127&_a;case 8:Rl[yl+7]=_u!==8?_o>>>21|128:_o>>>21&127;case 7:Rl[yl+6]=_u!==7?_o>>>14|128:_o>>>14&127;case 6:Rl[yl+5]=_u!==6?_o>>>7|128:_o>>>7&127;case 5:Rl[yl+4]=_u!==5?128|_o:127&_o;case 4:Rl[yl+3]=_u!==4?_r>>>21|128:_r>>>21&127;case 3:Rl[yl+2]=_u!==3?_r>>>14|128:_r>>>14&127;case 2:Rl[yl+1]=_u!==2?_r>>>7|128:_r>>>7&127;case 1:Rl[yl]=_u!==1?128|_r:127&_r}}const Cre=async(_e,_t,_r)=>{const _o=function(yl){const Rl=[];for(let Al=0;Al<yl.length;Al+=2)Rl.push(parseInt(yl.slice(Al,Al+2),16));return Uint8Array.from(Rl)}(function(yl){const Rl="0123456789abcdef";function Al(_y){let k0,Oy="";for(k0=0;k0<=3;k0++)Oy+=Rl.charAt(_y>>8*k0+4&15)+Rl.charAt(_y>>8*k0&15);return Oy}function Ol(_y,k0){const Oy=(65535&_y)+(65535&k0);return(_y>>16)+(k0>>16)+(Oy>>16)<<16|65535&Oy}function xl(_y,k0,Oy,by,Xy,P_){return Ol(function(zy,RT){return zy<<RT|zy>>>32-RT}(Ol(Ol(k0,_y),Ol(by,P_)),Xy),Oy)}function Ll(_y,k0,Oy,by,Xy,P_,zy){return xl(k0&Oy|~k0&by,_y,k0,Xy,P_,zy)}function Bl(_y,k0,Oy,by,Xy,P_,zy){return xl(k0&by|Oy&~by,_y,k0,Xy,P_,zy)}function Hl(_y,k0,Oy,by,Xy,P_,zy){return xl(k0^Oy^by,_y,k0,Xy,P_,zy)}function up(_y,k0,Oy,by,Xy,P_,zy){return xl(Oy^(k0|~by),_y,k0,Xy,P_,zy)}const _f=function(_y){let k0;const Oy=1+(_y.length+8>>6),by=new Array(16*Oy);for(k0=0;k0<16*Oy;k0++)by[k0]=0;for(k0=0;k0<_y.length;k0++)by[k0>>2]|=_y.charCodeAt(k0)<<k0%4*8;return by[k0>>2]|=128<<k0%4*8,by[16*Oy-2]=8*_y.length,by}(yl);let vp,Dp,Bp,_g,y0,e0=1732584193,r0=-271733879,Zp=-1732584194,h0=271733878;for(vp=0;vp<_f.length;vp+=16)Dp=e0,Bp=r0,_g=Zp,y0=h0,e0=Ll(e0,r0,Zp,h0,_f[vp+0],7,-680876936),h0=Ll(h0,e0,r0,Zp,_f[vp+1],12,-389564586),Zp=Ll(Zp,h0,e0,r0,_f[vp+2],17,606105819),r0=Ll(r0,Zp,h0,e0,_f[vp+3],22,-1044525330),e0=Ll(e0,r0,Zp,h0,_f[vp+4],7,-176418897),h0=Ll(h0,e0,r0,Zp,_f[vp+5],12,1200080426),Zp=Ll(Zp,h0,e0,r0,_f[vp+6],17,-1473231341),r0=Ll(r0,Zp,h0,e0,_f[vp+7],22,-45705983),e0=Ll(e0,r0,Zp,h0,_f[vp+8],7,1770035416),h0=Ll(h0,e0,r0,Zp,_f[vp+9],12,-1958414417),Zp=Ll(Zp,h0,e0,r0,_f[vp+10],17,-42063),r0=Ll(r0,Zp,h0,e0,_f[vp+11],22,-1990404162),e0=Ll(e0,r0,Zp,h0,_f[vp+12],7,1804603682),h0=Ll(h0,e0,r0,Zp,_f[vp+13],12,-40341101),Zp=Ll(Zp,h0,e0,r0,_f[vp+14],17,-1502002290),r0=Ll(r0,Zp,h0,e0,_f[vp+15],22,1236535329),e0=Bl(e0,r0,Zp,h0,_f[vp+1],5,-165796510),h0=Bl(h0,e0,r0,Zp,_f[vp+6],9,-1069501632),Zp=Bl(Zp,h0,e0,r0,_f[vp+11],14,643717713),r0=Bl(r0,Zp,h0,e0,_f[vp+0],20,-373897302),e0=Bl(e0,r0,Zp,h0,_f[vp+5],5,-701558691),h0=Bl(h0,e0,r0,Zp,_f[vp+10],9,38016083),Zp=Bl(Zp,h0,e0,r0,_f[vp+15],14,-660478335),r0=Bl(r0,Zp,h0,e0,_f[vp+4],20,-405537848),e0=Bl(e0,r0,Zp,h0,_f[vp+9],5,568446438),h0=Bl(h0,e0,r0,Zp,_f[vp+14],9,-1019803690),Zp=Bl(Zp,h0,e0,r0,_f[vp+3],14,-187363961),r0=Bl(r0,Zp,h0,e0,_f[vp+8],20,1163531501),e0=Bl(e0,r0,Zp,h0,_f[vp+13],5,-1444681467),h0=Bl(h0,e0,r0,Zp,_f[vp+2],9,-51403784),Zp=Bl(Zp,h0,e0,r0,_f[vp+7],14,1735328473),r0=Bl(r0,Zp,h0,e0,_f[vp+12],20,-1926607734),e0=Hl(e0,r0,Zp,h0,_f[vp+5],4,-378558),h0=Hl(h0,e0,r0,Zp,_f[vp+8],11,-2022574463),Zp=Hl(Zp,h0,e0,r0,_f[vp+11],16,1839030562),r0=Hl(r0,Zp,h0,e0,_f[vp+14],23,-35309556),e0=Hl(e0,r0,Zp,h0,_f[vp+1],4,-1530992060),h0=Hl(h0,e0,r0,Zp,_f[vp+4],11,1272893353),Zp=Hl(Zp,h0,e0,r0,_f[vp+7],16,-155497632),r0=Hl(r0,Zp,h0,e0,_f[vp+10],23,-1094730640),e0=Hl(e0,r0,Zp,h0,_f[vp+13],4,681279174),h0=Hl(h0,e0,r0,Zp,_f[vp+0],11,-358537222),Zp=Hl(Zp,h0,e0,r0,_f[vp+3],16,-722521979),r0=Hl(r0,Zp,h0,e0,_f[vp+6],23,76029189),e0=Hl(e0,r0,Zp,h0,_f[vp+9],4,-640364487),h0=Hl(h0,e0,r0,Zp,_f[vp+12],11,-421815835),Zp=Hl(Zp,h0,e0,r0,_f[vp+15],16,530742520),r0=Hl(r0,Zp,h0,e0,_f[vp+2],23,-995338651),e0=up(e0,r0,Zp,h0,_f[vp+0],6,-198630844),h0=up(h0,e0,r0,Zp,_f[vp+7],10,1126891415),Zp=up(Zp,h0,e0,r0,_f[vp+14],15,-1416354905),r0=up(r0,Zp,h0,e0,_f[vp+5],21,-57434055),e0=up(e0,r0,Zp,h0,_f[vp+12],6,1700485571),h0=up(h0,e0,r0,Zp,_f[vp+3],10,-1894986606),Zp=up(Zp,h0,e0,r0,_f[vp+10],15,-1051523),r0=up(r0,Zp,h0,e0,_f[vp+1],21,-2054922799),e0=up(e0,r0,Zp,h0,_f[vp+8],6,1873313359),h0=up(h0,e0,r0,Zp,_f[vp+15],10,-30611744),Zp=up(Zp,h0,e0,r0,_f[vp+6],15,-1560198380),r0=up(r0,Zp,h0,e0,_f[vp+13],21,1309151649),e0=up(e0,r0,Zp,h0,_f[vp+4],6,-145523070),h0=up(h0,e0,r0,Zp,_f[vp+11],10,-1120210379),Zp=up(Zp,h0,e0,r0,_f[vp+2],15,718787259),r0=up(r0,Zp,h0,e0,_f[vp+9],21,-343485551),e0=Ol(e0,Dp),r0=Ol(r0,Bp),Zp=Ol(Zp,_g),h0=Ol(h0,y0);return Al(e0)+Al(r0)+Al(Zp)+Al(h0)}(""+_t+_r)).slice(0,16),_a=_o.slice(0,12),_u=await window.crypto.subtle.importKey("raw",_o,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:_a},_u,_e))};function TY(_e,_t){var _r=Object.keys(_e);if(Object.getOwnPropertySymbols){var _o=Object.getOwnPropertySymbols(_e);_t&&(_o=_o.filter(function(_a){return Object.getOwnPropertyDescriptor(_e,_a).enumerable})),_r.push.apply(_r,_o)}return _r}const xre=new Map([["moderation",1],["supervise",2]]);class TU extends Hy{get connectionState(){return this._connectionState}set connectionState(_t){if(this._connectionState===_t)return;const _r=this._connectionState;this._connectionState=_t,this.emit(d_.CONNECTION_STATE_CHANGE,_r,_t)}get inspectType(){return this._inspectType}set inspectType(_t){var _r;this._inspectMode=nS(_r=_t.map(_o=>xre.get(_o)||0)).call(_r,(_o,_a)=>_o+_a),this._inspectType=_t}get quality(){return this._quality}set quality(_t){this._quality=_t>1?1:_t<.1?.1:_t,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(_t){super(),Ml(this,"name","AgoraRTCVideoContentInspect"),Ml(this,"_connectionState",WT.CONNECTING),Ml(this,"_innerConnectionState",void 0),Ml(this,"sequence",0),Ml(this,"inspectStartTime",void 0),Ml(this,"workerManagerConnection",void 0),Ml(this,"workerConnection",void 0),Ml(this,"workerMessageLengthLimit",void 0),Ml(this,"inspectIntervalMinimum",void 0),Ml(this,"qualityRatio",void 0),Ml(this,"_connectInfo",void 0),Ml(this,"_cancelTokenSource",TS.CancelToken.source()),Ml(this,"_retryConfig",void 0),Ml(this,"wmSequence",0),Ml(this,"inspectInterval",void 0),Ml(this,"inspectTimer",null),Ml(this,"ossFilePrefix",void 0),Ml(this,"extraInfo",void 0),Ml(this,"_inspectType",void 0),Ml(this,"_inspectMode",void 0),Ml(this,"_quality",1),Ml(this,"qualityTimer",null),Ml(this,"_inspectId",void 0),Ml(this,"_needWorkUrlOnly",!1),Ml(this,"inspectImage",()=>{if(this.connectionState!==WT.CONNECTED)throw new Tp(Ql.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===WT.CONNECTED?this.requestToInspectImage():Vl.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=Ny(5,"inspect-"),this.workerMessageLengthLimit=Pp("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=Pp("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=Pp("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=_t.interval,this.ossFilePrefix=_t.ossFilePrefix,this.extraInfo=_t.extraInfo,this.inspectType=_t.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new gN("worker-manager-"+this._inspectId,h_),this.on(d_.STATE_CHANGE,(_r,_o)=>{this._innerConnectionState=_r,Vl.debug("[".concat(this._inspectId,"] Inspect operation :").concat(HT[_r]," ").concat(_o||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new gN("worker-"+this._inspectId,h_),this.handleWorkerEvents()}async init(_t,_r){this.emit(d_.STATE_CHANGE,HT.CONNECT_AP),this._connectInfo=_t;const _o=this._cancelTokenSource.token;return this._retryConfig=_r,new u0((_a,_u)=>{this.on(d_.CONNECTION_STATE_CHANGE,(yl,Rl)=>{Rl===WT.CONNECTED&&_a()}),this.requestAP(_t,_o,_r).then(yl=>{this.connectWorkerManager(yl)}).catch(yl=>{_u(yl)})})}async requestAP(_t,_r,_o){const _a=Pp("WEBCS_DOMAIN").map(Rl=>"https://".concat(Rl,"/api/v1")),_u=await function(Rl,Al,Ol,xl){let{appId:Ll,areaCode:Bl,cname:Hl,sid:up,token:_f,uid:vp}=Al;W4++;const Dp="image_moderation_api",Bp={service_name:Dp,json_body:JSON.stringify({appId:Ll,areaCode:Bl,cname:Hl,command:"allocateEdge",requestId:W4,seq:W4,sid:up,token:_f,ts:Date.now(),uid:vp+""})};let _g,y0,e0=Rl[0];return iR(async()=>{_g=Date.now();const r0=await VS(e0,{data:Bp,cancelToken:Ol,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(y0=Date.now()-_g,r0.code!==0){const k0=new Tp(Ql.UNEXPECTED_RESPONSE,"image inspect ap error, code"+r0.code,{retry:!0,responseTime:y0});throw Vl.error(k0.toString()),k0}const Zp=JSON.parse(r0.json_body);if(Zp.code!==200){const k0=new Tp(Ql.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(Zp.code,", reason: ").concat(Zp.reason),{code:Zp.code,responseTime:y0});throw Vl.error(k0.toString()),k0}if(!Zp.servers||!Array.isArray(Zp.servers)||Zp.servers.length===0){const k0=new Tp(Ql.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:Zp.code,responseTime:y0});throw Vl.error(k0.toString()),k0}const h0=Pp("VIDEO_INSPECT_WORKER_MANAGER_HOST"),_y=Pp("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:Zp.servers.map(k0=>{let{address:Oy,wss:by}=k0;if(Oy&&by)return"wss://".concat(Oy.replace(/\./g,"-"),".").concat(h0,":").concat(_y||by)}).filter(k0=>!!k0),workerToken:Zp.workerToken,vid:Zp.vid,responseTime:y0}},(r0,Zp)=>(g0.apworkerEvent(up,{success:!0,sc:200,serviceName:Dp,responseDetail:JSON.stringify(r0.addressList),firstSuccess:Zp===0,responseTime:y0,serverIp:Rl[Zp%Rl.length]}),!1),(r0,Zp)=>(g0.apworkerEvent(up,{success:!1,sc:r0.data&&r0.data.code||200,serviceName:Dp,responseTime:y0,serverIp:Rl[Zp%Rl.length]}),!!(r0.code!==Ql.OPERATION_ABORTED&&r0.code!==Ql.UNEXPECTED_RESPONSE||r0.data&&r0.data.retry)&&(e0=Rl[(Zp+1)%Rl.length],!0)),xl)}(_a,_t,_r,_o);this.emit(d_.STATE_CHANGE,HT.AP_CONNECTED);const{addressList:yl}=_u;return this.wmSequence++,yl}async connectWorkerManager(_t){let _r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=_r,this.emit(d_.STATE_CHANGE,HT.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(_t,1e4)}async connectWorker(_t){await this.workerConnection.init([_t])}handleWorkerManagerEvents(){this.workerManagerConnection.on(N0.CONNECTED,async()=>{this.emit(d_.STATE_CHANGE,HT.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.17.1",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(N0.CLOSED,()=>{this._innerConnectionState<HT.GET_WORKER_MANAGER_RESPONSE&&Vl.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(N0.FAILED,()=>{this._innerConnectionState<HT.GET_WORKER_MANAGER_RESPONSE&&Vl.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(N0.RECONNECTING,()=>{this._innerConnectionState<HT.GET_WORKER_MANAGER_RESPONSE&&Vl.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(N0.ON_MESSAGE,async _t=>{this.emit(d_.STATE_CHANGE,HT.GET_WORKER_MANAGER_RESPONSE);const _r=this.workerManagerConnection.url;this.workerManagerConnection.close();const _o=JSON.parse(_t.data);if(_o.code!==200)throw Vl.error("[".concat(this._inspectId,"] Unexpected code ").concat(_o.code," from worker manager")),new Tp(Ql.UNEXPECTED_RESPONSE,"response code of worker is unexpected",_o);if(!(_o.serverResponse&&_o.serverResponse.portWss&&_r))throw Vl.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(_o))),new Tp(Ql.UNEXPECTED_RESPONSE,"response content of worker is unexpected",_o);{const _a=Pp("VIDEO_INSPECT_WORKER_PORT")||_o.serverResponse.portWss,_u=_r.replace(/:\d+\/?$/,":".concat(_a));this.emit(d_.STATE_CHANGE,HT.CONNECT_WORKER,_u),this._needWorkUrlOnly?this.emit(d_.REQUEST_NEW_WORKER_URL,_u):await this.connectWorker(_u)}}),this.workerManagerConnection.on(N0.WILL_RECONNECT,(_t,_r)=>{_r(_t)}),this.workerManagerConnection.on(N0.REQUEST_NEW_URLS,(_t,_r)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(_t).catch(_r)})}handleWorkerEvents(){this.workerConnection.on(N0.CONNECTED,async()=>{this.emit(d_.STATE_CHANGE,HT.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=WT.CONNECTED}),this.workerConnection.on(N0.ON_MESSAGE,async _t=>{if(_t.data instanceof ArrayBuffer){const _o=Tre(new Uint8Array(_t.data));if(Pp("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&Vl.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(_o)),_o.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(d_.INSPECT_RESULT,void 0,void 0);if(_o.data&&_o.data.scorePorn&&_o.data.scoreSexy&&_o.data.scoreNeutral){var _r;const _a={porn:_o.data.scorePorn,sexy:_o.data.scoreSexy,neutral:_o.data.scoreNeutral},_u=nS(_r=Object.keys(_a)).call(_r,(Rl,Al)=>_a[Rl]>_a[Al]?Rl:Al,"porn"),yl=Object.keys(_a).find(Rl=>Rl===_u);this.emit(d_.INSPECT_RESULT,yl)}else this.emit(d_.INSPECT_RESULT,void 0,new Tp(Ql.UNEXPECTED_RESPONSE,_o.code+"","There is an unexpected data on message"))}else this.emit(d_.INSPECT_RESULT,void 0,new Tp(Ql.UNEXPECTED_RESPONSE,_o.code+"",_o.msg))}else Vl.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(d_.INSPECT_RESULT,void 0,new Tp(Ql.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(N0.CLOSED,()=>{this.connectionState=WT.CLOSED}),this.workerConnection.on(N0.FAILED,()=>{this.connectionState=WT.CLOSED}),this.workerConnection.on(N0.RECONNECTING,()=>{this.connectionState=this.connectionState===WT.CONNECTED?WT.RECONNECTING:WT.CONNECTING}),this.workerConnection.on(N0.WILL_RECONNECT,(_t,_r)=>{_t==="recover"&&_r(_t),_r("tryNext")}),this.workerConnection.on(N0.REQUEST_NEW_URLS,(_t,_r)=>{this.workerManagerConnection.close(),this.once(d_.REQUEST_NEW_WORKER_URL,_o=>{_t([_o])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(_o=>{this.connectWorkerManager(_o,!0)}).catch(_o=>{_r(_o)})})}static intToLong(_t){return{low:_t|=0,high:_t>>31,unsigned:_t>=0}}async requestToInspectImage(){this.sequence++;const _t=cR(this,d_.CLIENT_LOCAL_VIDEO_TRACK),_r={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(_t){if(!_t.isPlaying)return void this.emit(d_.INSPECT_RESULT,void 0,new Tp(Ql.INVALID_OPERATION,"Only the track being played can be inspected"));const _o=await this.generateRequestData(_t,_r);this.workerConnection.sendMessage(_o,!0,!0)}else this.emit(d_.INSPECT_RESULT,void 0,new Tp(Ql.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(_t,_r){let{appId:_o,cname:_a,cid:_u,vid:yl,sid:Rl,uid:Al}=_r;const Ol=Date.now(),xl=await _t.getCurrentFrameImage("image/jpeg",this.quality),Ll=await(async(_f,vp,Dp)=>await Cre(_f.buffer,vp,Dp))(xl,_o,_a),Bl=this.sequence+"-"+_u+"-"+Al+"-"+Ol+"-"+Ny(12,""),Hl={appId:_o,cid:_u,cname:_a,deviceId:"",elapse:TU.intToLong(Number(Ol-this.inspectStartTime)),fileSize:Ll.byteLength,jpgEncryption:2,height:xl.height,width:xl.width,jpg:Ll,networkType:6,osType:7,requestId:Bl,sdkVersion:"4.17.1",sequence:this.sequence,sid:Rl,timestamp:TU.intToLong(Ol),uid:Al,vid:yl,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};this.extraInfo===void 0&&delete Hl.callbackData,this.ossFilePrefix===void 0&&delete Hl.ossFilePrefix;const up=bre(Hl);if(up.byteLength<this.workerMessageLengthLimit){if(Pp("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const _f=function(vp){for(var Dp=1;Dp<arguments.length;Dp++){var Bp=arguments[Dp]!=null?arguments[Dp]:{};Dp%2?TY(Object(Bp),!0).forEach(function(_g){Ml(vp,_g,Bp[_g])}):Object.getOwnPropertyDescriptors?Object.defineProperties(vp,Object.getOwnPropertyDescriptors(Bp)):TY(Object(Bp)).forEach(function(_g){Object.defineProperty(vp,_g,Object.getOwnPropertyDescriptor(Bp,_g))})}return vp}({},Hl);delete _f.jpg,Vl.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(_f))}return up}{const _f=this.quality*this.qualityRatio;return this.quality=_f,await this.generateRequestData(_t,{appId:_o,cname:_a,cid:_u,vid:yl,sid:Rl,uid:Al})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=TS.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=WT.CLOSED,this.emit(d_.STATE_CHANGE,HT.CLOSED)}}var SY,RY,AY,IY,wY,OY,CY,xY,kY,PY,NY,LY,DY,MY,UY,jY,FY,BY,$Y,VY,GY,WY,HY,KY,qY,zY,YY,XY,JY,QY,ZY,eX,tX,nX,rX,iX,oX,sX,o0;function aX(_e,_t){var _r=Object.keys(_e);if(Object.getOwnPropertySymbols){var _o=Object.getOwnPropertySymbols(_e);_t&&(_o=_o.filter(function(_a){return Object.getOwnPropertyDescriptor(_e,_a).enumerable})),_r.push.apply(_r,_o)}return _r}function O2(_e){for(var _t=1;_t<arguments.length;_t++){var _r=arguments[_t]!=null?arguments[_t]:{};_t%2?aX(Object(_r),!0).forEach(function(_o){Ml(_e,_o,_r[_o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_e,Object.getOwnPropertyDescriptors(_r)):aX(Object(_r)).forEach(function(_o){Object.defineProperty(_e,_o,Object.getOwnPropertyDescriptor(_r,_o))})}return _e}let kre=(SY=_0(),RY=_0({argsMap:(_e,_t)=>(Array.isArray(_t)||(_t=[_t]),_t.map(_r=>_r?Object(_r).toString():"null"))}),AY=_0({argsMap:(_e,_t)=>(_t||(_t=[]),Array.isArray(_t)||(_t=[_t]),_t.map(_r=>_r.getTrackId()))}),IY=_0({argsMap:(_e,_t,_r)=>[_t.uid,_r]}),wY=_0({argsMap:(_e,_t)=>_t.map(_r=>{let{user:_o,mediaType:_a}=_r;return[_o==null?void 0:_o.uid,_a]})}),OY=_0({argsMap:(_e,_t,_r)=>[_t.uid,_r]}),CY=_0({argsMap:(_e,_t)=>_t.map(_r=>{let{user:_o,mediaType:_a}=_r;return{uid:_o==null?void 0:_o.uid,mediaType:_a}})}),xY=_0(),kY=_0(),PY=_0(),NY=_0(),LY=_0(),DY=_0(),MY=_0(),UY=_0(),jY=_0(),FY=_0(),BY=_0(),$Y=_0(),VY=_0(),GY=_0(),WY=_0({argsMap:(_e,_t)=>[_t]}),HY=_0(),KY=_0(),qY=_0(),zY=_0(),YY=_0(),XY=_0(),JY=_0(),QY=_0(),ZY=_0(),eX=_0(),tX=_0({argsMap:(_e,_t)=>(Array.isArray(_t)||(_t=[_t]),[JSON.stringify(_t)])}),nX=_0(),rX=_0(),iX=_0(),oX=_0({reportResult:!0}),sX=_0(),Yp((o0=class extends Hy{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(_e){let _t;if(super(),Ml(this,"store",void 0),Ml(this,"_uid",void 0),Ml(this,"_channelName",void 0),Ml(this,"_uintUid",void 0),Ml(this,"_users",[]),Ml(this,"_codec",void 0),Ml(this,"_mode",void 0),Ml(this,"_config",void 0),Ml(this,"_clientId",void 0),Ml(this,"_appId",void 0),Ml(this,"_sessionId",null),Ml(this,"_key",void 0),Ml(this,"_joinInfo",void 0),Ml(this,"_gateway",void 0),Ml(this,"_statsCollector",void 0),Ml(this,"_configDistribute",void 0),Ml(this,"_leaveMutex",new iT("client-leave")),Ml(this,"_publishMutex",new iT("client-publish")),Ml(this,"_renewTokenMutex",new iT("client-renewtoken")),Ml(this,"_subscribeMutex",new iT("client-subscribe")),Ml(this,"_encryptionMode","none"),Ml(this,"_encryptionSecret",null),Ml(this,"_encryptionSalt",null),Ml(this,"_proxyServer",void 0),Ml(this,"_turnServer",{servers:[],mode:"auto"}),Ml(this,"_cloudProxyServerMode","disabled"),Ml(this,"_isDualStreamEnabled",!1),Ml(this,"_defaultStreamFallbackType",void 0),Ml(this,"_lowStreamParameter",void 0),Ml(this,"_streamFallbackTypeCacheMap",new Map),Ml(this,"_remoteStreamTypeCacheMap",new Map),Ml(this,"_axiosCancelSource",TS.CancelToken.source()),Ml(this,"_audioVolumeIndicationInterval",void 0),Ml(this,"_networkQualityInterval",void 0),Ml(this,"_userOfflineTimeout",void 0),Ml(this,"_streamRemovedTimeout",void 0),Ml(this,"_injectStreamingClient",void 0),Ml(this,"_liveTranscodeStreamingClient",void 0),Ml(this,"_liveRawStreamingClient",void 0),Ml(this,"_channelMediaRelayClient",void 0),Ml(this,"_networkQualitySensitivity","normal"),Ml(this,"_p2pChannel",void 0),Ml(this,"_useLocalAccessPoint",!1),Ml(this,"_setLocalAPVersion",void 0),Ml(this,"_joinAndNotLeaveYet",!1),Ml(this,"_numberOfJoinCount",0),Ml(this,"_remoteDefaultVideoStreamType",void 0),Ml(this,"_inspect",void 0),Ml(this,"_license",void 0),Ml(this,"_handleLocalTrackEnable",(_r,_o,_a)=>{this.publish(_r,!1).then(_o).catch(_a)}),Ml(this,"_handleLocalTrackDisable",(_r,_o,_a)=>{this.unpublish(_r).then(_o).catch(_a)}),Ml(this,"_handleUserOnline",_r=>{if(Pp("BLOCK_LOCAL_CLIENT")&&oO(_r.uid,this.channelName))return void Vl.debug("[".concat(_r.uid,"] will be ignored in local"));this.isStringUID&&typeof _r.uid!="string"&&Vl.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const _o=this._users.find(_a=>_a.uid===_r.uid);if(_o)_o._trust_in_room_=!0;else{const _a=new z4(_r.uid,_r.uint_id||_r.uid);this._users.push(_a),Vl.debug("[".concat(this._clientId,"] user online"),_r.uid),this.emit(W0.USER_JOINED,_a)}}),Ml(this,"_handleUserOffline",_r=>{if(Pp("BLOCK_LOCAL_CLIENT")&&oO(_r.uid,this.channelName))return;const _o=this._users.find(_a=>_a.uid===_r.uid);_o&&(this._handleRemoveStream(_r),U4(this._users,_o),this._remoteStreamTypeCacheMap.delete(_o.uid),this._streamFallbackTypeCacheMap.delete(_o.uid),Vl.debug("[".concat(this._clientId,"] user offline"),_r.uid,"reason:",_r.reason),this.emit(W0.USER_LEAVED,_o,_r.reason))}),Ml(this,"_handleAddAudioOrVideoStream",(_r,_o,_a,_u,yl,Rl,Al)=>{if(Pp("BLOCK_LOCAL_CLIENT")&&oO(_o,this.channelName))return;const Ol=this._users.find(Ll=>Ll.uid===_o);if(!Ol)return void Vl.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));Vl.debug("[".concat(this._clientId,"] stream added with uid ").concat(_o,", type ").concat(_r)),this.store.subscribe(Ol.uid,_r,void 0,void 0,void 0,Date.now());const xl=_r==="audio"?Ol.hasAudio:Ol.hasVideo;Ol._uintid||(Ol._uintid=yl||_o),_r==="audio"?Ol._trust_audio_stream_added_state_=!0:Ol._trust_video_stream_added_state_=!0,_r==="audio"?(Ol._audio_added_=!0,_a!==void 0&&(Ol._audioSSRC=_a),_u!==void 0&&(Ol._cname=_u),Rl&&(Ol._audioOrtc=Rl)):(Ol._video_added_=!0,_a!==void 0&&(Ol._videoSSRC=_a),_u!==void 0&&(Ol._cname=_u),Al!==void 0&&(Ol._rtxSsrcId=Al),Rl&&(Ol._videoOrtc=Rl)),(_r==="audio"?Ol.hasAudio:Ol.hasVideo)&&!xl&&(Vl.info("[".concat(this._clientId,"] remote user ").concat(Ol.uid," published ").concat(_r)),this.emit(W0.USER_PUBLISHED,Ol,_r)),_r==="video"?g0.onGatewayStream(this._sessionId,F_.ON_ADD_VIDEO_STREAM,Fy.ON_ADD_VIDEO_STREAM,{peer:yl||_o}):g0.onGatewayStream(this._sessionId,F_.ON_ADD_AUDIO_STREAM,Fy.ON_ADD_AUDIO_STREAM,{peer:yl||_o}),this._p2pChannel.remoteMediaSsrcChanged(Ol,_r,_a).then(Ll=>{if(Ll)return Vl.debug("[".concat(this._clientId,"] resubscribe ").concat(_r," for user ").concat(Ol.uid," after rejoin because SSRC id changed.")),this._p2pChannel.unsubscribe(Ol,_r,!0).then(()=>this._subscribe(Ol,_r,!0).catch(Bl=>{Vl.error("[".concat(this._clientId,"] resubscribe error"),Bl.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(Ol,_r)&&(Vl.debug("[".concat(this._clientId,"] resubscribe ").concat(_r," for user ").concat(Ol.uid," after reconnect.")),this._subscribe(Ol,_r,!0).catch(Ll=>{Vl.error("[".concat(this._clientId,"] resubscribe error"),Ll.toString())}))}),Ml(this,"_handleRemoveStream",_r=>{if(Pp("BLOCK_LOCAL_CLIENT")&&oO(_r.uid,this.channelName))return;const _o=this._users.find(_u=>_u.uid===_r.uid);if(!_o)return void Vl.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));Vl.debug("[".concat(this._clientId,"] stream removed with uid ").concat(_r.uid));let _a=()=>{};_o.hasAudio&&_o.hasVideo?_a=()=>{Vl.info("[".concat(this._clientId,"] remote user ").concat(_o.uid," unpublished audio track")),this.emit(W0.USER_UNPUBLISHED,_o,"audio"),Vl.info("[".concat(this._clientId,"] remote user ").concat(_o.uid," unpublished video track")),this.emit(W0.USER_UNPUBLISHED,_o,"video")}:_o.hasVideo?_a=()=>{Vl.info("[".concat(this._clientId,"] remote user ").concat(_o.uid," unpublished video track")),this.emit(W0.USER_UNPUBLISHED,_o,"video")}:_o.hasAudio&&(_a=()=>{Vl.info("[".concat(this._clientId,"] remote user ").concat(_o.uid," unpublished audio track")),this.emit(W0.USER_UNPUBLISHED,_o,"audio")}),_o._trust_audio_stream_added_state_=!0,_o._trust_video_stream_added_state_=!0,_o._audio_added_=!1,_o._video_added_=!1,this._p2pChannel.unsubscribe(_o).then(_u=>{if(_u)return this._gateway.unsubscribe(_u,_o.uid)}),_o._audioSSRC=void 0,_o._videoSSRC=void 0,_o._audioOrtc=void 0,_o._videoOrtc=void 0,_o._rtxSsrcId=void 0,g0.onGatewayStream(this._sessionId,F_.ON_REMOVE_STREAM,Fy.ON_REMOVE_STREAM,{peer:_r.uint_id||_r.uid}),_a()}),Ml(this,"_handleSetStreamLocalEnable",(_r,_o,_a)=>{if(Pp("BLOCK_LOCAL_CLIENT")&&oO(_o,this.channelName))return;const _u=this._users.find(Al=>Al.uid===_o);if(!_u)return void Vl.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));Vl.debug("[".concat(this._clientId,"] local ").concat(_r," ").concat(_a?"enabled":"disabled"," with uid ").concat(_o));const yl=_r==="audio"?_u.hasAudio:_u.hasVideo;if(_r==="audio"){_u._trust_audio_enabled_state_=!0;const Al=_u._audio_enabled_;if(_u._audio_enabled_=_a,_u._audio_enabled_===Al)return;{const Ol=_u._audio_enabled_?"enable-local-audio":"disable-local-audio";Vl.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(_o,", msg: ").concat(Ol)),this.emit(W0.USER_INFO_UPDATED,_o,Ol)}}else{_u._trust_video_enabled_state_=!0;const Al=_u._video_enabled_;if(_u._video_enabled_=_a,_u._video_enabled_===Al)return;{const Ol=_u._video_enabled_?"enable-local-video":"disable-local-video";Vl.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(_o,", msg: ").concat(Ol)),this.emit(W0.USER_INFO_UPDATED,_o,Ol)}}const Rl=_r==="audio"?_u.hasAudio:_u.hasVideo;return yl!==Rl?!yl&&Rl?(Vl.info("[".concat(this._clientId,"] remote user ").concat(_o," published ").concat(_r)),void this.emit(W0.USER_PUBLISHED,_u,_r)):(_r==="video"&&_u._videoTrack&&_u._videoTrack._destroy(),_r==="audio"&&_u._audioTrack,this._p2pChannel.muteRemote(_u,_r),Vl.info("[".concat(this._clientId,"] remote user ").concat(_o," unpublished ").concat(_r)),void this.emit(W0.USER_UNPUBLISHED,_u,_r)):void 0}),Ml(this,"_handleMuteStream",(_r,_o,_a)=>{if(Pp("BLOCK_LOCAL_CLIENT")&&oO(_r,this.channelName))return;Vl.debug("[".concat(this._clientId,"] receive mute message"),_r,_o,_a);const _u=this._users.find(Al=>Al.uid===_r);if(!_u)return void Vl.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(_r));const yl=_o==="audio"?_u.hasAudio:_u.hasVideo;if(_o==="audio"){_u._trust_audio_mute_state_=!0;const Al=_u._audio_muted_;if(_u._audio_muted_=_a,_u._audio_muted_===Al)return;{const Ol=_u._audio_muted_?"mute-audio":"unmute-audio";Vl.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(_r,", msg: ").concat(Ol)),this.emit(W0.USER_INFO_UPDATED,_r,Ol)}}else{_u._trust_video_mute_state_=!0;const Al=_u._video_muted_;if(_u._video_muted_=_a,_u._video_muted_===Al)return;{const Ol=_u._video_muted_?"mute-video":"unmute-video";Vl.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(_r,", msg: ").concat(Ol)),this.emit(W0.USER_INFO_UPDATED,_r,Ol)}}const Rl=_o==="audio"?_u.hasAudio:_u.hasVideo;if(yl!==Rl){if(!yl&&Rl)return(_o==="audio"?_u._audioSSRC:_u._videoSSRC)?(Vl.info("[".concat(this._clientId,"] remote user ").concat(_r," published ").concat(_o)),void this.emit(W0.USER_PUBLISHED,_u,_o)):void Vl.warning("[".concat(this._clientId,"] remote user ").concat(_r," receive ").concat(_o," unmute message  before add stream message, ").concat(_o," SSRC doesn't exist yet."));_o==="video"&&_u._videoTrack&&_u._videoTrack._destroy(),_o==="audio"&&_u._audioTrack,this._p2pChannel.muteRemote(_u,_o),Vl.info("[".concat(this._clientId,"] remote user ").concat(_r," unpublished ").concat(_o)),this.emit(W0.USER_UNPUBLISHED,_u,_o)}}),Ml(this,"_handleP2PLost",async _r=>{Vl.debug("[".concat(this._clientId,"] receive p2p lost"),_r),parseInt(_r.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():Vl.warning("P2PLost stream not found",_r)}),Ml(this,"_handleTokenWillExpire",()=>{Vl.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.emit(W0.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),Ml(this,"_handleBeforeUnload",_r=>{_r.type==="beforeunload"&&_r.returnValue!==void 0&&_r.returnValue!==""||(this.leave(),Vl.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),Ml(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.emit(W0.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const _r={downlinkNetworkQuality:0,uplinkNetworkQuality:0};_r.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),_r.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.emit(W0.NETWORK_QUALITY,_r)}),this._codec=_e.codec,this._mode=_e.mode,this._clientId=Ny(5,"client-"),this.store=new Ere(_e.codec,_e.audioCodec,_e.mode,this._clientId),this.store.clientCreated(),_e.proxyServer&&this.setProxyServer(_e.proxyServer,!0),_e.turnServer&&this.setTurnServer(_e.turnServer,!0),Vl.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(aS," build: ").concat(J6,", mode: ").concat(this._mode,", codec: ").concat(this._codec)),_e.clientRoleOptions)try{i7(_e.clientRoleOptions),_t=Object.assign({},_e.clientRoleOptions)}catch(_r){Vl.warning("[".concat(this._clientId,"] ").concat(_r.toString()))}this._statsCollector=new hN(this.store),this._statsCollector.onStatsException=(_r,_o,_a)=>{Vl.debug("[".concat(this._clientId,"] receive exception msg, code: ").concat(_r,", msg: ").concat(_o,", uid: ").concat(_a)),this.emit(W0.EXCEPTION,{code:_r,msg:_o,uid:_a})},this._statsCollector.onUploadPublishDuration=(_r,_o,_a,_u)=>{const yl=this._users.find(Rl=>Rl.uid===_r);yl&&g0.peerPublishStatus(this._sessionId,{subscribeElapse:_u,audioPublishDuration:_o,videoPublishDuration:_a,peer:yl._uintid})},this.store.useDataChannel=R_().supportDataChannel&&Pp("SIGNAL_CHANNEL"),this._gateway=new nne(this.store,{clientId:this._clientId,mode:this._mode,codec:this._codec,websocketRetryConfig:_e.websocketRetryConfig||h_,httpRetryConfig:_e.httpRetryConfig||h_,forceWaitGatewayResponse:_e.forceWaitGatewayResponse===void 0||_e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:_e.role,clientRoleOptions:_t}),this._config=_e,this._configDistribute=new hne,this._p2pChannel=new vre(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async join(_e,_t,_r,_o,_a){const _u=++this._numberOfJoinCount;this.store.joinStart(),_o&&(this.store.uid=_o);const yl=_re(),Rl=pY()?window.isSecureContext:"Browser Not Support";if(!pY()&&!yl||!window.isSecureContext){const Hl="The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser";Vl.warning(Hl)}const Al=M4();this.connectionState==="DISCONNECTED"&&(this.store.avoidJoinStart=Math.round(Date.now()),Vl.debug("[".concat(this._clientId,"] set avoidJoinStart to ").concat(this.store.avoidJoinStart)));const Ol=g0.reportApiInvoke(Al,{name:c_.JOIN,options:[_e,_t,_r,_o],states:{isHttps:yl,isSecureContext:Rl},tag:jy.TRACER});g0.setAppId(_e);try{if(!_r&&_r!==null)throw new Tp(Ql.INVALID_PARAMS,"Invalid token: ".concat(_r,". If you don not use token, set it to null"));_r&&U_(_r,"token",1,2047),U_(_e,"appid",1,2047),a4(_t),_o&&c4(_o),_a&&U_(_a,"optionalInfo",1,2047)}catch(Hl){throw Ol.onError(Hl),Hl}if(Vl.info("[".concat(this._clientId,"] start join channel ").concat(_t,", join number: ").concat(_u)),this._leaveMutex.isLocked&&(Vl.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),Vl.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const Hl=new Tp(Ql.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw Ol.onError(Hl),Hl}this._sessionId||(this._sessionId=Al,this.store.sessionId=this._sessionId),this._gateway.state="CONNECTING";const xl=O2({clientId:this._clientId,appId:_e,sid:this._sessionId,cname:_t,uid:typeof _o!="string"?_o:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:_r||_e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:_a,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType});if(this._useLocalAccessPoint&&(xl.setLocalAPVersion=this._setLocalAPVersion),typeof _o=="string"&&(xl.stringUid=_o,this._uintUid?(xl.uid=this._uintUid,this._uintUid=void 0):xl.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(xl.aesmode=this._encryptionMode,xl.aespassword=await(async Hl=>{const up=j4(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),_f=await window.crypto.subtle.importKey("spki",up,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),vp=I4(Hl),Dp=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},_f,vp);return rU(new Uint8Array(Dp))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new Tp(Ql.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(xl.aessalt=this._encryptionSalt)}this._startSession(this._sessionId,{channel:_t,appId:_e});const Ll=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&Ll===this._sessionId&&g0.joinChannelTimeout(this._sessionId,5)},5e3);try{let Hl;const up=xl.cloudProxyServer;if(["proxy3","proxy4","proxy5"].includes(up)){const Bp=Pp("PROXY_SERVER_TYPE3");Array.isArray(Bp)?xl.proxyServer=Bp[0]:xl.proxyServer=Bp}if(g0.setProxyServer(xl.proxyServer),Vl.setProxyServer(xl.proxyServer),this.store.requestAPStart(),xl.stringUid&&!xl.uid){const Bp=await aq(xl.stringUid,xl,this._axiosCancelSource.token,this._config.httpRetryConfig||h_,this.store);Vl.debug("getUserAccount Success ".concat(xl.stringUid," => ").concat(Bp)),xl.uid=Bp,Hl=await sq(xl,this._axiosCancelSource.token,this._config.httpRetryConfig||h_,!0,this.store)}else Hl=await sq(xl,this._axiosCancelSource.token,this._config.httpRetryConfig||h_,!0,this.store);if(!this._joinAndNotLeaveYet)throw new Tp(Ql.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(xl,this._axiosCancelSource.token),this._configDistribute.on(c2.UPDATE_BITRATE_LIMIT,Bp=>{this._p2pChannel.updateBitrateLimit(Bp)})},0),this._key=_r||_e;const _f=Hl.gatewayInfo;this._joinInfo=O2(O2({},xl),{},{cid:_f.cid,uid:xl.uid?xl.uid:_f.uid,vid:_f.vid,apResponse:_f.res,uni_lbs_ip:_f.uni_lbs_ip,gatewayAddrs:_f.gatewayAddrs});const vp=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new Tp(Ql.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));Ol.onSuccess(vp),this._appId=_e,this._channelName=xl.cname,this._uid=vp,this.store.uid=vp,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(_b()?"beforeunload":"pagehide",this._handleBeforeUnload)},0);const Dp=xl.stringUid?"string uid: ".concat(xl.stringUid,",uid: ").concat(xl.uid):"uid: ".concat(this._uid);return Vl.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(_t,",").concat(Dp)),setTimeout(()=>{Vl.startUpload()},5e3),this.store.joinEnd(),Bl=this,iO.includes(Bl)||iO.push(Bl),vp}catch(Hl){const up=Array.isArray(Hl)?Hl[0]:Hl;throw Vl.error("[".concat(this._clientId,"] join number: ").concat(_u,", Joining channel failed, rollback"),up),up.code!==Ql.OPERATION_ABORTED&&this._numberOfJoinCount===_u&&(this._gateway.state="DISCONNECTED",this._reset()),Ol.onError(up),up}var Bl}_joinGateway(){if(!this._joinInfo||!this._key)throw new Tp(Ql.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!Pp("JOIN_WITH_FALLBACK_SIGNAL_PROXY"))).then(_e=>_e).catch(_e=>{if(_e.code===Ql.INIT_WEBSOCKET_TIMEOUT)return this._gateway.leave(!0,cy.FALLBACK),_e;if(_e.code===Ql.INIT_DATACHANNEL_TIMEOUT)return this._gateway.leave(!0,cy.FALLBACK),_e;throw _e}).then(_e=>{if(_e instanceof Tp){if(_e.code===Ql.INIT_WEBSOCKET_TIMEOUT){if(Vl.info("[".concat(this._clientId,"] join timeout, fallback to proxy")),!this._joinInfo||!this._key)throw new Tp(Ql.INVALID_OPERATION);this._joinInfo.cloudProxyServer="fallback",this._cloudProxyServerMode="fallback",this.store.cloudProxyServerMode="fallback";const _t=Pp("PROXY_SERVER_TYPE3");if(Array.isArray(_t))if(this._joinInfo.apUrl){const _o=/^https?:\/\/(.+?)(\/.*)?$/.exec(this._joinInfo.apUrl)[1].split("."),_a=_o.slice(_o.length-2).join(".");_t.forEach(_u=>{this._joinInfo&&_u.includes(_a)&&(this._joinInfo.proxyServer=_u)}),this._joinInfo.proxyServer||(this._joinInfo.proxyServer=_t[0])}else this._joinInfo.proxyServer=_t[0];else this._joinInfo.proxyServer=_t;const _r=Pp("LOG_UPLOAD_SERVER").match(/.+:(\d{1,5})$/);return _r&&_r[1]&&_r[1]!=="443"&&Vl.setProxyServer(this._joinInfo.proxyServer),Pp("STATS_COLLECTOR_PORT").toString()!=="443"&&g0.setProxyServer(this._joinInfo.proxyServer),g0.reportApiInvoke(this._sessionId,{name:c_.JOIN_FALLBACK_TO_PROXY,options:[this._joinInfo.proxyServer],tag:jy.TRACER}).onSuccess(),this.emit(W0.JOIN_FALLBACK_TO_PROXY,this._joinInfo.proxyServer),Pp("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&this._joinInfo.turnServer.servers.forEach(_o=>{"forceturn"in _o&&(_o.forceturn=!0)}),this._gateway.join(this._joinInfo,this._key)}if(Vl.info("[".concat(this._clientId,"] join by datachannel timeout, fallback to websocket")),!this._joinInfo||!this._key)throw new Tp(Ql.INVALID_OPERATION);return g0.reportApiInvoke(this._sessionId,{name:c_.DATACHANNEL_FAILBACK,options:[this.store.clientId],tag:jy.TRACER}).onSuccess(),this._joinGateway()}return _e}).then(_e=>_e)}async leave(){Vl.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(_b()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(_t){const _r=iO.indexOf(_t);_r!==-1&&iO.splice(_r,1)}(this);const _e=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return Vl.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void _e();await this._gateway.leave(this.connectionState!=="CONNECTED"),Vl.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),_e()}async publish(_e){let _t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(Array.isArray(_e)||(_e=[_e]),_e.length===0)throw new Tp(Ql.INVALID_PARAMS,"track list is empty");if(this._gateway.role==="audience")throw new Tp(Ql.INVALID_OPERATION,"audience can not publish stream");for(const _o of _e){if(!(_o instanceof w4))throw new Tp(Ql.INVALID_PARAMS,"parameter is not local track");if(!_o._enabled&&_t)throw new Tp(Ql.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(_o.getTrackId()))}Vl.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(_e.map(_o=>"".concat(_o.getTrackId()," ")))),await this._configDistribute.awaitConfigDistributeComplete(),_t&&_e.forEach(_o=>{const _a=this._configDistribute.getBitrateLimit();_o instanceof i_&&_a&&_o.setBitrateLimit(_a.uplink)});const _r=await this._publishMutex.lock();try{await this._publishHighStream(_e),Vl.info("[".concat(this._clientId,"] Publish success, id ").concat(_e.map(_o=>"".concat(_o.getTrackId()," "))))}catch(_o){throw Vl.error("[".concat(this._clientId,"] publish error"),_o.toString()),_o}finally{_r()}}async unpublish(_e){if(!this._joinInfo||this._uid===void 0)throw new Tp(Ql.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");_e?Array.isArray(_e)||(_e=[_e]):_e=this._p2pChannel.getAllTracks(!0),Vl.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(_e.map(_r=>"".concat(_r.getTrackId()," "))," "));const _t=await this._publishMutex.lock();try{const _r=await this._p2pChannel.unpublish(_e);_r&&await this._gateway.unpublish(_r,this._uid),Vl.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(_e.map(_o=>"".concat(_o.getTrackId()))))}catch(_r){throw Vl.error("[".concat(this._clientId,"] unpublish error"),_r.toString()),_r}finally{_t&&_t()}}async subscribe(_e,_t){return this._subscribe(_e,_t)}async _subscribe(_e,_t,_r){if(__(_t,"mediaType",["audio","video"]),!this._joinInfo)throw new Tp(Ql.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Tp(Ql.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(Al=>Al===_e)){const Al=new Tp(Ql.INVALID_REMOTE_USER,"user is not in the channel");throw Vl.error("[".concat(this._clientId,"] can not subscribe ").concat(_e.uid,", this user is not in the channel")),Al}if(!_e.hasAudio&&!_e.hasVideo){const Al=new Tp(Ql.INVALID_REMOTE_USER,"user is not published");throw Vl.error("[".concat(this._clientId,"] can not subscribe ").concat(_e.uid,", user is not published")),Al}if(!(_r||(_t!=="audio"||_e.hasAudio&&_e._audioSSRC!==void 0)&&(_t!=="video"||_e.hasVideo&&_e._videoSSRC!==void 0))){const Al=new Tp(Ql.REMOTE_USER_IS_NOT_PUBLISHED);throw Vl.error("[".concat(this._clientId,"] can not subscribe ").concat(_e.uid," with mediaType ").concat(_t,", remote track is not published")),Al}const _o=_t==="audio"?_e._audioSSRC:_e._videoSSRC,_a=_t==="audio"?_e._audioOrtc:_e._videoOrtc,_u=_t==="video"?_e._rtxSsrcId:void 0,yl={stream_type:_t==="audio"?P0.AUDIO:P0.VIDEO,ssrcId:_o},Rl=await this._subscribeMutex.lock();Vl.info("[".concat(this._clientId,"] subscribe user ").concat(_e.uid,", mediaType: ").concat(_t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(_e,_t))await this._p2pChannel.unmuteRemote(_e,_t);else try{uS.markSubscribeStart(this.store.clientId,_o),this.store.subscribe(_e.uid,_t,Date.now()),await this._p2pChannel.subscribe(_e,_t,_o,_u,_a);try{await this._gateway.subscribe(_e.uid,yl,!0)}catch(Ol){if((Ol==null?void 0:Ol.code)!==Ql.WS_ABORT)throw await this._p2pChannel.unsubscribe(_e,_t),Ol;await this._p2pChannel.unsubscribe(_e,_t,!0),this._p2pChannel.setPendingRemoteMedia(_e,_t)}this.store.subscribe(_e.uid,_t,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,_e,_t)}catch(Ol){throw this._p2pChannel.reportSubscribeEvent(!1,Ol==null?void 0:Ol.code,_e,_t),Ol}Vl.info("[".concat(this._clientId,"] subscribe success user ").concat(_e.uid,", mediaType: ").concat(_t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(_e.uid,this._defaultStreamFallbackType).catch(Ol=>{Vl.warning("[".concat(this._clientId,"] auto set fallback failed"),Ol)});const Al=_t==="audio"?_e._audioTrack:_e._videoTrack;if(!Al)throw new Tp(Ql.UNEXPECTED_ERROR,"can not find remote track in user object");return Al}catch(Al){throw Vl.error("[".concat(this._clientId,"] subscribe user ").concat(_e.uid," error"),Al),Al}finally{Rl()}}async massSubscribe(_e){if(NR(_e,"subscribeList"),!this._joinInfo)throw new Tp(Ql.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Tp(Ql.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const _t=Date.now(),_r=new Map,_o=await this._subscribeMutex.lock();Vl.info("[".concat(this._clientId,"]start massSubscribe user ").concat(_e.map(Rl=>{let{user:Al,mediaType:Ol}=Rl;return"user: ".concat(Al==null?void 0:Al.uid,", mediaType: ").concat(Ol)}).join("; ")));const _a=(_e=[..._e]).map(Rl=>{let{user:Al,mediaType:Ol}=Rl;return{user:Al,mediaType:Ol}}),_u=await this._p2pChannel.globalLock();try{var yl;for(let Al=_e.length-1;Al>=0;Al--){const Ol=_e[Al],{user:xl,mediaType:Ll}=Ol;if(__(Ll,"mediaType",["audio","video"]),!xl){const up=new Tp(Ql.INVALID_PARAMS,"user property does not exist in subscribeList item");throw Vl.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),up}if(!this._users.find(up=>up===xl)){const up=new Tp(Ql.INVALID_REMOTE_USER,"user is not in the channel");Vl.error("[".concat(this._clientId,"] can not massSubscribe ").concat(xl.uid,", this user is not in the channel")),_a[Al].error=up,_e.splice(Al,1);continue}if(Ll==="audio"&&(!xl.hasAudio||xl._audioSSRC===void 0)||Ll==="video"&&(!xl.hasVideo||xl._videoSSRC===void 0)){const up=new Tp(Ql.REMOTE_USER_IS_NOT_PUBLISHED);Vl.error("[".concat(this._clientId,"] can not subscribe ").concat(xl.uid," with mediaType ").concat(Ll,", remote user is not published")),_a[Al].error=up,_e.splice(Al,1);continue}const Bl=t_.Video|t_.LwoVideo,Hl=_r.get(xl);if(Hl){if(Ll==="video"?Hl&Bl:Hl&t_.Audio){_e.splice(Al,1),Vl.warning("repeat massSubscribe user:".concat(xl.uid,", mediaType:").concat(Ll," twice"));continue}_r.set(xl,Hl|(Ll==="video"?Bl:t_.Audio))}else _r.set(xl,Ll==="video"?Bl:t_.Audio)}for(let Al=_e.length-1;Al>=0;Al--){const Ol=_e[Al],{user:xl,mediaType:Ll}=Ol,Bl=t_.Video|t_.LwoVideo;if(this._p2pChannel.hasRemoteMedia(xl,Ll)){await this._p2pChannel.unmuteRemoteNoLock(xl,Ll);const Hl=_r.get(xl);_r.set(xl,Ll==="video"?Hl^Bl:Hl^t_.Audio),_e.splice(Al,1)}}this.store.massSubscribe(_e.map(Al=>({userId:Al.user.uid,type:Al.mediaType})),_t);const Rl=nS(yl=Array.from(_r.entries())).call(yl,(Al,Ol)=>{let[xl,Ll]=Ol;if(Ll===0)return Al;const Bl={stream_id:xl.uid,stream_type:Ll};return Ll&t_.Audio&&(Bl.audio_ssrc=xl._audioSSRC),Ll&t_.Video&&(Bl.video_ssrc=xl._videoSSRC),Al.push(Bl),Al},[]);try{_e.length>0&&await this._p2pChannel.massSubscribeNoLock(_e.map(Ol=>{let{user:xl,mediaType:Ll}=Ol;return{user:xl,mediaType:Ll,ssrcId:Ll===P0.VIDEO?xl._videoSSRC:xl._audioSSRC,rtxSsrcId:xl._rtxSsrcId}}));const Al=new Map;if(Rl.length>0){const Ol=await this._gateway.subscribeAll(Rl,!0);((Ol==null?void 0:Ol.users)||[]).forEach(xl=>{let{stream_id:Ll,video_error_code:Bl,audio_error_code:Hl,error_code:up}=xl;(Bl||Hl||up)&&Al.set(Ll,{video_error_code:Bl,audio_error_code:Hl,error_code:up})})}if(Array.from(Al.entries()).length>0){const Ol=Array.from(Al.entries()).map(xl=>{let Ll,[Bl,Hl]=xl;return Hl.error_code||Hl.video_error_code&&Hl.audio_error_code?Ll=void 0:Hl.video_error_code?Ll=P0.VIDEO:Hl.audio_error_code&&(Ll=P0.AUDIO),{user:this.remoteUsers.find(up=>up.uid===Bl),mediaType:Ll}});await this._p2pChannel.massUnsubscribeNoLock(Ol)}for(const Ol of _a){const xl=Al.get(Ol.user.uid);if(xl){const Ll=xl.error_code||Ol.mediaType==="audio"&&xl.audio_error_code||Ol.mediaType==="video"&&xl.video_error_code;if(Ll){const Bl=h2(Ll);Vl.error("user:".concat(Ol.user.uid," mediaType:").concat(Ol.mediaType," has massSubscribe error ").concat(Bl.desc)),Ol.error=new Tp(Ql.SUBSCRIBE_FAILED,"code ".concat(Ll,": ").concat(Bl.desc))}}Ol.error||(Ol.mediaType==="video"?Ol.track=Ol.user.videoTrack:Ol.track=Ol.user.audioTrack)}return this.store.massSubscribe(_a.filter(Ol=>!Ol.error).map(Ol=>({userId:Ol.user.uid,type:Ol.mediaType})),void 0,Date.now()),_a.forEach(Ol=>{var xl;g0.subscribe(this.store.sessionId,{succ:!!Ol.error,ec:((xl=Ol.error)===null||xl===void 0?void 0:xl.code)||null,video:Ol.mediaType===P0.VIDEO,audio:Ol.mediaType===P0.AUDIO,peerid:Ol.user.uid,subscribeRequestid:Ol.mediaType===P0.VIDEO?Ol.user._videoSSRC:Ol.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-_t)},!0)}),Vl.info("[".concat(this._clientId,"] massSubscribe success ").concat(_e.map(Ol=>{let{user:xl,mediaType:Ll}=Ol;return"user: ".concat(xl==null?void 0:xl.uid,", mediaType: ").concat(Ll)}).join("; "))),_a}catch(Al){throw await this._p2pChannel.massUnsubscribeNoLock(_e),Al}}finally{_u(),_o()}}async unsubscribe(_e,_t){if(_t&&__(_t,"mediaType",["audio","video"]),!this._joinInfo)throw new Tp(Ql.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(_r=>_r===_e)){const _r=new Tp(Ql.INVALID_REMOTE_USER,"user is not in the channel");throw Vl.error("[".concat(this._clientId,"] can not unsubscribe ").concat(_e.uid,", user is not in the channel")),_r}Vl.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(_e.uid,", mediaType: ").concat(_t));try{const _r=await this._p2pChannel.unsubscribe(_e,_t);_r&&await this._gateway.unsubscribe(_r,_e.uid),Vl.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(_e.uid,", mediaType: ").concat(_t))}catch(_r){if(_r.code===Ql.DISCONNECT_P2P)return void Vl.warning("disconnecting p2p, abort unsubscribe request.");throw Vl.error("[".concat(this._clientId,"] unsubscribe user ").concat(_e.uid," error"),_r.toString()),_r}}async massUnsubscribe(_e){if(NR(_e,"unsubscribeList"),!this._joinInfo)throw new Tp(Ql.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");Vl.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(_e.map(_r=>{let{user:_o,mediaType:_a}=_r;return"user: ".concat(_o==null?void 0:_o.uid,", mediaType: ").concat(_a,";")}).join())),_e=[..._e];const _t=new Map;for(let _r=_e.length-1;_r>=0;_r--){const{user:_o,mediaType:_a}=_e[_r];if(!_o){const yl=new Tp(Ql.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw Vl.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),yl}if(__(_a,"mediaType",["video","audio",void 0]),!this._users.find(yl=>yl===_o)){Vl.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(_o.uid,", user is not in the channel")),_e.splice(_r,1);continue}const _u=t_.Video|t_.LwoVideo;if(_t.has(_o)){const yl=_t.get(_o);let Rl;switch(_a){case"video":Rl=yl&_u;break;case"audio":Rl=yl&t_.Audio;break;default:Rl=yl&(t_.Audio|_u)}if(Rl){Vl.warning("repeat massUnsubscribe user:".concat(_o.uid,",mediaType:").concat(_a," twice.")),_e.splice(_r,1);continue}_a?_a==="audio"?_t.set(_o,yl|t_.Audio):_a==="video"&&_t.set(_o,yl|_u):_t.set(_o,yl|t_.Audio|_u)}else _a?_a==="audio"?_t.set(_o,t_.Audio):_a==="video"&&_t.set(_o,_u):_t.set(_o,t_.Audio|_u)}try{const _r=await this._p2pChannel.massUnsubscribe(_e);_r&&await this._gateway.massUnsubscribe(_r),Vl.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(_e.map(_o=>{let{user:_a,mediaType:_u}=_o;return"user: ".concat(_a==null?void 0:_a.uid,", mediaType: ").concat(_u,";")}).join()))}catch(_r){if(_r.code===Ql.DISCONNECT_P2P)return void Vl.warning("disconnecting p2p, abort unsubscribe request.");throw Vl.error("[".concat(this._clientId,"] massUnsubscribe error"),_r.toString()),_r}}setLowStreamParameter(_e){(function(_r){if(!_r)throw new Tp(Ql.INVALID_PARAMS);Py(_r.width)||s4(_r.width,"streamParameter.width"),Py(_r.height)||s4(_r.height,"streamParameter.height"),Py(_r.framerate)||s4(_r.framerate,"streamParameter.framerate"),Py(_r.bitrate)||wy(_r.bitrate,"streamParameter.bitrate")})(_e),(!_e.width&&_e.height||_e.width&&!_e.height)&&Vl.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),Vl.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(_e));const _t=this._configDistribute.getLowStreamConfigDistribute();_t&&_t.bitrate&&_e.bitrate&&_t.bitrate<_e.bitrate&&(_e.bitrate=_t.bitrate),this._lowStreamParameter=_e}async enableDualStream(){if(!R_().supportDualStream)throw g0.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new Tp(Ql.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new Tp(Ql.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(_e){throw g0.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),_e}this._isDualStreamEnabled=!0,g0.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),Vl.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new Tp(Ql.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(l0.LocalVideoLowTrack))try{const _e=await this._p2pChannel.unpublishLowStream();_e&&await this._gateway.unpublish(_e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(_e){throw g0.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),_e}this._isDualStreamEnabled=!1,g0.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),Vl.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(_e,_t){if(function(_r){__(_r,"role",["audience","host"])}(_e),_t&&i7(_t),this._mode==="rtc")throw Vl.warning("[".concat(this._clientId,"]rtc mode can not use setClientRole")),new Tp(Ql.INVALID_OPERATION,"rtc mode can not use setClientRole");if(_t&&_t.level&&_e==="host")throw new Tp(Ql.INVALID_OPERATION,"host mode can not set audience latency level");if(_e==="audience"&&this._p2pChannel.hasLocalMedia())throw new Tp(Ql.INVALID_OPERATION,"can not set client role to audience when publishing stream");await this._gateway.setClientRole(_e,_t),Vl.info("[".concat(this._clientId,"] set client role to ").concat(_e,", level: ").concat(_t&&_t.level))}setProxyServer(_e,_t){if(U_(_e,"proxyServer"),!_t){if(this.connectionState!=="DISCONNECTED")throw new Tp(Ql.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new Tp(Ql.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=_e,g0.setProxyServer(this._proxyServer),Vl.setProxyServer(this._proxyServer),Vl.info("[".concat(this._clientId,"] Set proxy server ").concat(_t?"by initialize call":""," success."))}setTurnServer(_e,_t){if(Array.isArray(_e)||(_e=[_e]),!_t){if(this.connectionState!=="DISCONNECTED")throw new Tp(Ql.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new Tp(Ql.INVALID_OPERATION,"You have already set the proxy")}if(a2(_e))return this._turnServer={servers:_e,mode:"original-manual"},void Vl.info("[".concat(this._clientId,"] Set original turnserver ").concat(_t?"by initialize call":""," success: ").concat(_e.map(_r=>_r.urls).join(","),"."));_e.forEach(_r=>r7(_r)),this._turnServer={servers:_e,mode:"manual"},Vl.info("[".concat(this._clientId,"] Set turnserver ").concat(_t?"by initialize call":""," success."))}setLicense(_e){if(this.connectionState!=="DISCONNECTED")throw new Tp(Ql.INVALID_OPERATION,"you should set license before join channel");if(U_(_e,"license",32,32),!/^[A-Za-z\d]+$/.test(_e))throw new Tp(Ql.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=_e,Vl.info("[".concat(this._clientId,"] set license success"),_e)}startProxyServer(_e){if(this.connectionState!=="DISCONNECTED")throw new Tp(Ql.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new Tp(Ql.INVALID_OPERATION,"You have already set the proxy");const _t=[3,4,5];let _r;switch(_e===void 0&&(_e=3),_e){case 1:case 2:throw new Tp(Ql.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:_r="proxy3";break;case 4:_r="proxy4";break;case 5:_r="proxy5";break;default:throw new Tp(Ql.INVALID_PARAMS,"proxy server mode must be ".concat(_t.join("|")))}this._cloudProxyServerMode=_r,this.store.cloudProxyServerMode=_r,Vl.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new Tp(Ql.INVALID_OPERATION,"Stop proxy server after leave channel");g0.setProxyServer(),Vl.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",Vl.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(_e){if(!_e.accessPoints)throw new Tp(Ql.INVALID_PARAMS,"accessPoints is required.");NR(_e.accessPoints.serverList,"accessPoints.serverList"),U_(_e.accessPoints.domain,"accessPoints.domain");const _t=(Bl,Hl)=>{wy(Bl,Hl,0,65535,!0)};let _r=443;if(_e.accessPoints.port&&(_t(_e.accessPoints.port,"accessPoints.port"),_r=_e.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new Tp(Ql.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");Pp("CLOSE_AFB_FOR_LOCAL_AP")&&(Ey("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),Ey("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const _o=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,_a=_e.accessPoints.domain,_u=_e.accessPoints.serverList.map(Bl=>_o.test(Bl)?"".concat(Bl.replace(/\./g,"-"),".").concat(_a):Bl),yl=_u.map(Bl=>"".concat(Bl,":").concat(_r));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,Ey("WEBCS_DOMAIN",yl),Ey("WEBCS_DOMAIN_BACKUP_LIST",yl),Ey("GATEWAY_DOMAINS",[_a]),_e.report&&_e.report.hostname&&Array.isArray(_e.report.hostname)&&_e.report.hostname.length?(NR(_e.report.hostname,"report.hostname"),Ey("EVENT_REPORT_DOMAIN",_e.report.hostname[0]),Ey("EVENT_REPORT_BACKUP_DOMAIN",_e.report.hostname[1]||_e.report.hostname[0])):(Ey("EVENT_REPORT_DOMAIN",_u[0]),Ey("EVENT_REPORT_BACKUP_DOMAIN",_u[1]||_u[0]));let Rl=6443;_e.report&&_e.report.port&&(_t(_e.report.port,"report.port"),Rl=_e.report.port),Ey("STATS_COLLECTOR_PORT",Rl),_e.report?Ey("ENABLE_EVENT_REPORT",!0):Ey("ENABLE_EVENT_REPORT",!1);let Al="";_e.log&&_e.log.hostname&&Array.isArray(_e.log.hostname)&&_e.log.hostname.length?(NR(_e.log.hostname,"log.hostname"),Al=_e.log.hostname[0]):Al=_u[0];let Ol=6444;_e.log&&_e.log.port&&(_t(_e.log.port,"log.port"),Ol=_e.log.port),Ey("LOG_UPLOAD_SERVER","".concat(Al,":").concat(Ol));let xl=[];_e.cds&&_e.cds.hostname&&Array.isArray(_e.cds.hostname)&&_e.cds.hostname.length?(NR(_e.cds.hostname,"cds.hostname"),xl=_e.cds.hostname):xl=_u;let Ll=443;_e.cds&&_e.cds.port&&(_t(_e.cds.port,"cds.port"),Ll=_e.cds.port),Ey("CDS_AP",xl.map(Bl=>"".concat(Bl,":").concat(Ll))),_e.cds?Ey("ENABLE_CONFIG_DISTRIBUTE",!0):Ey("ENABLE_CONFIG_DISTRIBUTE",!1),Vl.info("set local access point v2 success")}setLocalAccessPoints(_e,_t){if(NR(_e,"serverList"),U_(_t,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new Tp(Ql.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const _r=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;_e=_e.map(_o=>_r.test(_o)?"".concat(_o.replace(/\./g,"-"),".").concat(_t):_o),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,Ey("WEBCS_DOMAIN",_e),Ey("WEBCS_DOMAIN_BACKUP_LIST",_e),Ey("GATEWAY_DOMAINS",[_t]),Ey("EVENT_REPORT_DOMAIN",_e[0]),Ey("EVENT_REPORT_BACKUP_DOMAIN",_e[1]||_e[0]),Ey("LOG_UPLOAD_SERVER","".concat(_e[0],":6444")),Vl.info("set local access point success")}async setRemoteDefaultVideoStreamType(_e){if(__(_e,"streamType",[0,1]),this._remoteDefaultVideoStreamType=_e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(_e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(_t){throw Vl.error("[".concat(this._clientId,"] set default remote video stream type error"),_t.toString()),_t}else Vl.debug("haven't joined yet, cache remoteDefaultVideoStreamType ".concat(_e))}async setRemoteVideoStreamType(_e,_t){__(_t,"streamType",[0,1]);try{await this._gateway.setRemoteVideoStreamType(_e,_t),setTimeout(()=>{const _r=this._users.find(_o=>_o.uid===_e);_r&&_r.videoTrack&&_r.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(_r){throw Vl.error("[".concat(this._clientId,"] set remote video stream type error"),_r.toString()),_r}Vl.info("[".concat(this._clientId,"] set remote ").concat(_e," video stream type to ").concat(_t)),this._remoteStreamTypeCacheMap.set(_e,_t)}async setStreamFallbackOption(_e,_t){__(_t,"fallbackType",[0,1,2]);try{await this._gateway.setStreamFallbackOption(_e,_t)}catch(_r){throw Vl.error("[".concat(this._clientId,"] set stream fallback option"),_r.toString()),_r}Vl.info("[".concat(this._clientId,"] set remote ").concat(_e," stream fallback type to ").concat(_t)),this._streamFallbackTypeCacheMap.set(_e,_t)}setEncryptionConfig(_e,_t,_r){if(function(_o){__(_o,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])}(_e),U_(_t,"secret"),["aes-128-gcm2","aes-256-gcm2"].includes(_e)){if(!_r||!(_r instanceof Uint8Array&&_r.length===32))throw new Tp(Ql.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(_r)throw new Tp(Ql.INVALID_PARAMS,"current encrypt mode does not need salt");new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(_t)||Vl.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=_e,this._encryptionSecret=_t,_r&&(this._encryptionSalt=rU(_r))}async renewToken(_e){if(U_(_e,"token",1,2047),!this._key||!this._joinInfo)throw new Tp(Ql.INVALID_OPERATION,"renewToken should not be called before user join");const _t=this._key;this._key=_e,this._joinInfo&&(this._joinInfo.token=_e);const _r=await this._renewTokenMutex.lock();try{if(Pp("USE_NEW_TOKEN")){Vl.debug("start renew token with ticket from unilbs");const _o=await dne(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||h_);Vl.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:_e,ticket:_o})}else Vl.debug("start renew token without ticket"),await this._gateway.renewToken({token:_e});Vl.debug("[".concat(this._clientId,"] renewToken success"))}catch(_o){throw this._key=_t,this._joinInfo.token=_t,Vl.error("[".concat(this._clientId,"] renewToken failed"),_o.toString()),_o}finally{_r()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?Vl.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const _e=this._p2pChannel.getAudioLevels();this.emit(W0.VOLUME_INDICATOR,_e)},Pp("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const _e=this._statsCollector.getRTCStats(),_t=this._gateway.getInChannelInfo();return _e.Duration=Math.round(_t.duration/1e3),_e}async startLiveStreaming(_e,_t){if(!_t){if(this._codec!=="h264")throw new Tp(Ql.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new Tp(Ql.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(_e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(_e))throw new Tp(Ql.LIVE_STREAMING_TASK_CONFLICT);const _r=_t?u_.TRANSCODE:u_.RAW;return this._createLiveStreamingClient(_r).startLiveStreamingTask(_e,_r)}setLiveTranscoding(_e){return this._createLiveStreamingClient(u_.TRANSCODE).setTranscodingConfig(_e)}async stopLiveStreaming(_e){const _t=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(_r=>_r&&_r.hasUrl(_e));if(!_t.length)throw new Tp(Ql.INVALID_PARAMS,"can not find live streaming url to stop");await u0.all(_t.map(_r=>_r&&_r.stopLiveStreamingTask(_e)))}async addInjectStreamUrl(_e,_t){if(!this._joinInfo)throw new Tp(Ql.INVALID_OPERATION,"can not addInjectStreamUrl, no joininfo");const _r=this._createLiveStreamingClient(u_.INJECT);_r.setInjectStreamConfig(_t,0),await _r.startLiveStreamingTask(_e,u_.INJECT)}async removeInjectStreamUrl(){var _e;const _t=this._createLiveStreamingClient(u_.INJECT),_r=Array.from(sR(_e=_t.streamingTasks).call(_e)).find(_o=>_o.mode===u_.INJECT);if(!this._joinInfo||!_r)throw new Tp(Ql.INVALID_OPERATION,"can remove addInjectStreamUrl, no joininfo or inject task");await _t.stopLiveStreamingTask(_r.url)}async startChannelMediaRelay(_e){gq(_e),await this._createChannelMediaRelayClient().startChannelMediaRelay(_e)}async updateChannelMediaRelay(_e){gq(_e),await this._createChannelMediaRelayClient().updateChannelMediaRelay(_e)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay()}sendStreamMessage(_e){let _t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new Tp(Ql.INVALID_OPERATION,"can not send data stream, not joined");if(typeof _e=="string"&&(_e=new TextEncoder().encode(_e)),new Blob([_e]).size>1024)throw new Tp(Ql.INVALID_PARAMS,"stream message out of range.");return this._gateway.signal.request(I0.DATA_STREAM,{payload:rU(_e)},!_t)}sendMetadata(_e){if(!this._joinInfo)throw new Tp(Ql.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([_e]).size>1024)throw new Tp(Ql.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(I0.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:rU(_e)})}async sendCustomReportMessage(_e){if(Array.isArray(_e)||(_e=[_e]),_e.forEach(Ree),!this._joinInfo)throw new Tp(Ql.INVALID_OPERATION,"can not send custom report, not joined");await g0.sendCustomReportMessage(this._joinInfo.sid,_e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(_e,_t){__(_t.spatialLayer,"spatialLayer",[0,1,2,3]),__(_t.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(_e,_t)}catch(_r){throw Vl.error("[".concat(this._clientId,"] pick SVC layer failed"),_r.toString()),_r}}_reset(){if(Vl.debug("[".concat(this._clientId,"] reset client")),this._axiosCancelSource.cancel(),this._axiosCancelSource=TS.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._users.forEach(_e=>{_e._audioTrack&&_e._audioTrack._destroy(),_e._videoTrack&&_e._videoTrack._destroy()}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new iT("client-publish"),this._subscribeMutex=new iT("client-subscribe"),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._injectStreamingClient&&(this._injectStreamingClient.terminate(),this._injectStreamingClient.removeAllListeners(),this._injectStreamingClient=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}}_startSession(_e,_t){const _r=_e||M4();_e?Vl.debug("[".concat(this._clientId,"] new Session ").concat(_r)):Vl.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(_r)),this._sessionId=_r,this.store.sessionId=_r,_t?g0.sessionInit(this._sessionId,{lts:new Date().getTime(),cname:_t.channel,appid:_t.appId,mode:this._mode}):this._joinInfo?g0.sessionInit(this._sessionId,{lts:new Date().getTime(),cname:this._joinInfo.cname,appid:this._joinInfo.appId,mode:this._mode}):this._gateway.joinInfo&&g0.sessionInit(this._sessionId,{lts:new Date().getTime(),cname:this._gateway.joinInfo.cname,appid:this._gateway.joinInfo.appId,mode:this._mode}),this._joinInfo&&(this._joinInfo.sid=_r),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=_r)}async _publishHighStream(_e){if(!this._joinInfo||this._uid===void 0)throw new Tp(Ql.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Tp(Ql.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&Pp("FORCE_TURN")&&!Pp("TURN_ENABLE_TCP")&&!Pp("TURN_ENABLE_UDP"))throw new Tp(Ql.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");Vl.debug("[".concat(this._clientId,"] publish high stream"));try{const _r=await this._p2pChannel.publish(_e,this._isDualStreamEnabled,this._lowStreamParameter),_o=(await _r.next()).value;if(_o){var _t;let _a;try{_a=await this._gateway.publish(this._uid,_o,!0)}catch(_u){if(_u.code!==Ql.DISCONNECT_P2P)throw _r.throw(_u),_u}await _r.next(((_t=_a)===null||_t===void 0?void 0:_t.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const _a of _e)_a instanceof i_&&_a._encoderConfig&&this._gateway.setVideoProfile(_a._encoderConfig),!_a.muted&&_a.enabled||await this._p2pChannel.muteLocalTrack(_a)}catch(_r){if(this._p2pChannel.reportPublishEvent(!1,_r==null?void 0:_r.code,_e),(_r==null?void 0:_r.code)===Ql.WS_ABORT)return;throw _r}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new Tp(Ql.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new Tp(Ql.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));Vl.debug("[".concat(this._clientId,"] publish low stream"));const _e=this._configDistribute.getLowStreamConfigDistribute();_e&&_e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&_e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=_e.bitrate));try{const _r=await this._p2pChannel.publishLowStream(this._lowStreamParameter),_o=(await _r.next()).value;if(_o){var _t;let _a;try{_a=await this._gateway.publish(this._uid,_o,!0)}catch(_u){if(_u.code!==Ql.DISCONNECT_P2P)throw _r.throw(_u),_u}_r.next(((_t=_a)===null||_t===void 0?void 0:_t.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(_r){if(this._p2pChannel.reportPublishEvent(!1,_r==null?void 0:_r.code,void 0,!0),(_r==null?void 0:_r.code)===Ql.WS_ABORT)return;throw _r}}_createLiveStreamingClient(_e){if(!this._joinInfo||!this._appId)return new Tp(Ql.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const _t=()=>new pne(this._joinInfo,this._config.websocketRetryConfig||h_,this._config.httpRetryConfig||h_),_r=_o=>{_o.onLiveStreamError=(_a,_u)=>{g0.reportApiInvoke(this._sessionId,{name:c_.ON_LIVE_STREAM_ERROR,options:[_a,_u],tag:jy.TRACER}).onSuccess(),this.emit(W0.LIVE_STREAMING_ERROR,_a,_u)},_o.onLiveStreamWarning=(_a,_u)=>{g0.reportApiInvoke(this._sessionId,{name:c_.ON_LIVE_STREAM_WARNING,options:[_a,_u],tag:jy.TRACER}).onSuccess(),this.emit(W0.LIVE_STREAMING_WARNING,_a,_u)},_o.on(sN.REQUEST_WORKER_MANAGER_LIST,(_a,_u,yl)=>{if(!this._joinInfo)return yl(new Tp(Ql.INVALID_OPERATION,"can not find join info to get worker manager"));uq(_a,this._joinInfo,this._axiosCancelSource.token,h_).then(_u).catch(yl)})};switch(_e){case u_.RAW:return this._liveRawStreamingClient||(this._liveRawStreamingClient=_t(),_r(this._liveRawStreamingClient)),this._liveRawStreamingClient;case u_.TRANSCODE:return this._liveTranscodeStreamingClient||(this._liveTranscodeStreamingClient=_t(),_r(this._liveTranscodeStreamingClient)),this._liveTranscodeStreamingClient;case u_.INJECT:return this._injectStreamingClient||(this._injectStreamingClient=_t(),this._injectStreamingClient.on(sN.REQUEST_WORKER_MANAGER_LIST,(_o,_a,_u)=>{if(!this._joinInfo)return _u(new Tp(Ql.INVALID_OPERATION,"can not find join info to get worker manager"));uq(_o,this._joinInfo,this._axiosCancelSource.token,h_).then(_a).catch(_u)}),this._injectStreamingClient.onInjectStatusChange=(_o,_a,_u)=>{this.emit(W0.INJECT_STREAM_STATUS,_o,_a,_u)}),this._injectStreamingClient}}_createChannelMediaRelayClient(){return this._joinInfo?(this._channelMediaRelayClient||(this._channelMediaRelayClient=new mne(this._joinInfo,this._clientId,this._config.websocketRetryConfig||h_,this._config.httpRetryConfig||h_),this._channelMediaRelayClient.on("state",_e=>{_e===lT.RELAY_STATE_FAILURE&&this._channelMediaRelayClient&&this._channelMediaRelayClient.dispose(),this.emit(W0.CHANNEL_MEDIA_RELAY_STATE,_e)}),this._channelMediaRelayClient.on("event",_e=>{this.emit(W0.CHANNEL_MEDIA_RELAY_EVENT,_e)})),this._channelMediaRelayClient):new Tp(Ql.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw()}_handleGatewayEvents(){this._gateway.on(Dy.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(Dy.CONNECTION_STATE_CHANGE,(_e,_t,_r)=>{var _o;if(_r===cy.FALLBACK)return;const _a=()=>{this.emit(W0.CONNECTION_STATE_CHANGE,_e,_t,_r)};if(g0.reportApiInvoke(this._sessionId||((_o=this._gateway.joinInfo)===null||_o===void 0?void 0:_o.sid)||null,{name:c_.CONNECTION_STATE_CHANGE,options:[_e,_t,_r],tag:jy.TRACER}).onSuccess(JSON.stringify({cur:_e,prev:_t,reason:_r})),Vl.info("[".concat(this._clientId,"] connection state change: ").concat(_t," -> ").concat(_e)),_e==="DISCONNECTED")return this._reset(),void _a();if(_e==="RECONNECTING")this._users.forEach(yl=>{yl._trust_in_room_=!1,yl._trust_audio_enabled_state_=!1,yl._trust_video_enabled_state_=!1,yl._trust_audio_mute_state_=!1,yl._trust_video_mute_state_=!1,yl._trust_audio_stream_added_state_=!1,yl._trust_video_stream_added_state_=!1,yl._audioSSRC=void 0,yl._videoSSRC=void 0,yl._videoOrtc=void 0,yl._audioOrtc=void 0,yl._cname=void 0,yl._rtxSsrcId=void 0}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(_e==="CONNECTED"){var _u;this._streamFallbackTypeCacheMap.forEach((yl,Rl)=>{this._gateway.setStreamFallbackOption(Rl,yl).catch(Al=>{Vl.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),Al)})}),this._remoteStreamTypeCacheMap.forEach((yl,Rl)=>{this._gateway.setRemoteVideoStreamType(Rl,yl).catch(Al=>{Vl.warning("[".concat(this._clientId,"] auto set remote stream type failed"),Al)})}),this._remoteDefaultVideoStreamType!==void 0&&((_u=this._joinInfo)===null||_u===void 0?void 0:_u.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{Vl.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(yl=>{Vl.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(yl))}),this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(yl=>!yl._trust_in_room_).forEach(yl=>{Vl.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(yl.uid)),this._handleUserOffline({uid:yl.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(yl=>{yl._trust_audio_mute_state_||(Vl.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(yl.uid)),this._handleMuteStream(yl.uid,"audio",!1)),yl._trust_video_mute_state_||(Vl.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(yl.uid)),this._handleMuteStream(yl.uid,"video",!1)),yl._trust_audio_enabled_state_||(Vl.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(yl.uid)),this._handleSetStreamLocalEnable("audio",yl.uid,!0)),yl._trust_video_enabled_state_||(Vl.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(yl.uid)),this._handleSetStreamLocalEnable("video",yl.uid,!0)),yl._trust_video_stream_added_state_||(Vl.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(yl.uid)),this._handleResetAddStream(yl,"video")),yl._trust_audio_stream_added_state_||(Vl.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(yl.uid)),this._handleResetAddStream(yl,"audio")),yl._video_added_||yl._audio_added_||(Vl.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(yl.uid)),this._handleRemoveStream({uid:yl.uid,uint_id:yl._uintid}))}))},1e3)}_a()}),this._gateway.on(Dy.REQUEST_NEW_GATEWAY_LIST,(_e,_t)=>{if(!this._joinInfo)return _t(new Tp(Ql.UNEXPECTED_ERROR,"can not recover, no join info"));H4(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||h_,this.store).then(_r=>{this._joinInfo&&(this._joinInfo.apResponse=_r.gatewayInfo.res,this._joinInfo.gatewayAddrs=_r.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=_r.gatewayInfo.uni_lbs_ip),_e(_r.gatewayInfo.gatewayAddrs.map(_o=>{if(this._joinInfo&&this._joinInfo.proxyServer){const _a=_o.address.split(":");return"wss://".concat(this._joinInfo.proxyServer,"/ws/?h=").concat(_a[0],"&p=").concat(_a[1])}return"wss://".concat(_o.address)}))}).catch(_t)}),this._gateway.on(Dy.NETWORK_QUALITY,_e=>{this._networkQualitySensitivity==="normal"&&this.emit(W0.NETWORK_QUALITY,_e)}),this._gateway.on(Dy.STREAM_TYPE_CHANGE,(_e,_t)=>{this.emit(W0.STREAM_TYPE_CHANGED,_e,_t),g0.reportApiInvoke(this._sessionId,{name:c_.STREAM_TYPE_CHANGE,options:[_e,_t],tag:jy.TRACER}).onSuccess(JSON.stringify({uid:_e,streamType:_t}))}),this._gateway.on(Dy.IS_P2P_DISCONNECTED,_e=>{this._p2pChannel.isP2PDisconnected()?_e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?_e(!1):_e(!0)}),this._gateway.on(Dy.NEED_RENEW_SESSION,()=>{this._startSession()}),this._gateway.on(Dy.REQUEST_P2P_CONNECTION_PARAMS,async(_e,_t,_r)=>{try{_t(await this._p2pChannel.startP2PConnection(_e))}catch(_o){_r(_o)}}),this._gateway.on(Dy.JOIN_RESPONSE,(_e,_t)=>{const{dtlsParameters:_r,iceParameters:_o,candidates:_a,rtpCapabilities:_u,setup:yl,cname:Rl}=mz(_e.ortc,_t);this._p2pChannel.connect(_o,_r,_a,_u,yl,Rl)}),this._gateway.on(Dy.REQUEST_DC_CONNECTION_PARAMS,_e=>{_e(this._p2pChannel.getEstablishParams())}),this._gateway.on(Dy.RESET_SIGNAL,_e=>{this._p2pChannel.resetConnection(_e),this._handleGatewaySignalEvents()}),this._gateway.on(Dy.DATACHANNEL_FAILBACK,()=>{this._joinGateway()}),this._gateway.on(Dy.DATACHANNEL_PRECONNECT,async(_e,_t,_r,_o)=>{var _a,_u,yl,Rl,Al,Ol;await this._p2pChannel.startP2PConnection({turnServer:(_a=this._joinInfo)===null||_a===void 0?void 0:_a.turnServer},!0);const xl=function(Ll,Bl){let Hl;return Bl&&Bl.ip&&typeof Bl.port=="number"?(Hl=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:Bl.ip,port:Bl.port.toString(),type:"host",extension:{}}],Vl.debug("Using remote candidate from AP ".concat(Bl.ip,":").concat(Bl.port)),Bl.ip6&&(Hl.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:Bl.ip6,port:Bl.port.toString(),type:"host",extension:{}}),Vl.debug("Using IPV6 remote candidate from AP ".concat(Bl.ip6,":").concat(Bl.port)))):Hl=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:Ll.ip,port:Ll.port.toString(),type:"host",extension:{}}],Hl}(_e,_t);return this._p2pChannel.preConnect({iceUfrag:"".concat((_u=this._joinInfo)===null||_u===void 0?void 0:_u.apResponse.cid,"_").concat((yl=this._joinInfo)===null||yl===void 0?void 0:yl.apResponse.cert),icePwd:"".concat((Rl=this._joinInfo)===null||Rl===void 0?void 0:Rl.apResponse.cid,"_").concat((Al=this._joinInfo)===null||Al===void 0?void 0:Al.apResponse.cert)},{fingerprints:[{hashFunction:"sha-256",fingerprint:(Ol=Pp("FINGERPRINT"))!==null&&Ol!==void 0?Ol:_e.fingerprint}]},xl,{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},"active","o/i14u9pJrxRKAsu").then(_r).catch(_o)})}_handleGatewaySignalEvents(){this._gateway.signal.on(U0.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(U0.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(U0.ON_ADD_AUDIO_STREAM,_e=>this._handleAddAudioOrVideoStream("audio",_e.uid,_e.ssrcId,_e.cname,_e.uint_id,_e.ortc)),this._gateway.signal.on(U0.ON_ADD_VIDEO_STREAM,_e=>this._handleAddAudioOrVideoStream("video",_e.uid,_e.ssrcId,_e.cname,_e.uint_id,_e.ortc,_e.rtxSsrcId)),this._gateway.signal.on(U0.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(U0.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(U0.MUTE_AUDIO,_e=>this._handleMuteStream(_e.uid,"audio",!0)),this._gateway.signal.on(U0.UNMUTE_AUDIO,_e=>this._handleMuteStream(_e.uid,"audio",!1)),this._gateway.signal.on(U0.MUTE_VIDEO,_e=>this._handleMuteStream(_e.uid,"video",!0)),this._gateway.signal.on(U0.UNMUTE_VIDEO,_e=>this._handleMuteStream(_e.uid,"video",!1)),this._gateway.signal.on(U0.RECEIVE_METADATA,_e=>{const _t=j4(_e.metadata);this.emit(W0.RECEIVE_METADATA,_e.uid,_t)}),this._gateway.signal.on(U0.ON_DATA_STREAM,_e=>{_e.seq&&delete _e.seq,_e.payload=j4(_e.payload),this.emit(W0.STREAM_MESSAGE,_e.uid,_e.payload),this.onStreamMessage&&this.onStreamMessage(_e)}),this._gateway.signal.on(U0.ON_CRYPT_ERROR,()=>{l2(()=>{Vl.warning("[".concat(this._clientId,"] on crypt error")),this.emit(W0.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(U0.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(U0.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{Vl.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0),this.emit(W0.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(U0.ON_STREAM_FALLBACK_UPDATE,_e=>{Vl.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(_e.stream_id,", attr: ").concat(_e.stream_type)),this.emit(W0.STREAM_FALLBACK,_e.stream_id,_e.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(U0.ON_PUBLISH_STREAM,_e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:_e.proxy})),Vl.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(_e))))}),this._gateway.signal.on(U0.ENABLE_LOCAL_VIDEO,_e=>{this._handleSetStreamLocalEnable("video",_e.uid,!0)}),this._gateway.signal.on(U0.DISABLE_LOCAL_VIDEO,_e=>{this._handleSetStreamLocalEnable("video",_e.uid,!1)}),this._gateway.signal.on(p0.REQUEST_TIMEOUT,(_e,_t)=>{if(this._joinInfo)switch(_e){case I0.PUBLISH:{if(!_t)return;const yl=(_t=_t).ortc;if(yl){var _r,_o,_a,_u;const Rl=yl.some(xl=>{let{stream_type:Ll}=xl;return Ll===l_.Audio}),Al=yl.some(xl=>{let{stream_type:Ll}=xl;return Ll!==l_.Audio}),Ol=yl.some(xl=>{let{stream_type:Ll}=xl;return Ll===l_.Screen||Ll===l_.ScreenLow});_t.state==="offer"&&g0.publish(this._joinInfo.sid,{eventElapse:uS.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:Ql.TIMEOUT,audio:Rl,video:Al,p2pid:_t.p2p_id,publishRequestid:this.store.pubId,screenshare:Ol,audioName:Rl?(_r=yl.find(xl=>{let{stream_type:Ll}=xl;return Ll===l_.Audio}))===null||_r===void 0||(_o=_r.ssrcs[0])===null||_o===void 0?void 0:_o.ssrcId.toString():void 0,videoName:Al?(_a=yl.find(xl=>{let{stream_type:Ll}=xl;return Ll!==l_.Audio}))===null||_a===void 0||(_u=_a.ssrcs[0])===null||_u===void 0?void 0:_u.ssrcId.toString():void 0})}break}case I0.SUBSCRIBE:(_t=_t)&&g0.subscribe(this._joinInfo.sid,{succ:!1,ec:Ql.TIMEOUT,audio:_t.stream_type===P0.AUDIO,video:_t.stream_type===P0.VIDEO,peerid:_t.stream_id,subscribeRequestid:_t.ssrcId,p2pid:this.store.p2pId,eventElapse:uS.measureFromSubscribeStart(this.store.clientId,_t.ssrcId)})}}),this._gateway.signal.on(U0.ON_P2P_OK,_e=>{this.uid,this._uid}),this._gateway.signal.on(U0.ON_PUBLISHED_USER_LIST,_e=>{if(_e==null||!_e.users)return;Pp("BLOCK_LOCAL_CLIENT")&&(_e.users=_e.users.filter(_o=>!oO(_o.audio_ssrc,this.channelName)));const _t=[],_r=[];for(const _o of _e.users){let _a=this._users.find(Ol=>Ol.uid===_o.stream_id);_a?_a._trust_in_room_=!0:(_a=new z4(_o.stream_id,_o.stream_id),this._users.push(_a),this.getListeners(W0.PUBLISHED_USER_LIST).length===0&&(Vl.debug("[".concat(this._clientId,"] user online"),_o.stream_id),this.emit(W0.USER_JOINED,_a)));const _u=t_.Audio&_o.stream_type,yl=(t_.Video|t_.LwoVideo)&_o.stream_type,Rl=_u&&_a.hasAudio,Al=yl&&_a.hasVideo;yl&&(_a._trust_video_stream_added_state_=!0,_a._video_added_=!0,_a._videoSSRC=_o.video_ssrc),_u&&(_a._trust_audio_stream_added_state_=!0,_a._audio_added_=!0,_a._audioSSRC=_o.audio_ssrc),_u&&!Rl&&this.getListeners(W0.PUBLISHED_USER_LIST).length===0&&(Vl.info("[".concat(this._clientId,"] remote user ").concat(_a.uid," published audio")),this.emit(W0.USER_PUBLISHED,_a,"audio")),yl&&!Al&&this.getListeners(W0.PUBLISHED_USER_LIST).length===0&&(Vl.info("[".concat(this._clientId,"] remote user ").concat(_a.uid," published video")),this.emit(W0.USER_PUBLISHED,_a,"video")),(_u&&!Rl||yl&&!Al)&&_t.push(_a),yl&&this._p2pChannel.hasPendingRemoteMedia(_a,"video")&&_r.push({user:_a,mediaType:"video"}),_u&&this._p2pChannel.hasPendingRemoteMedia(_a,"audio")&&_r.push({user:_a,mediaType:"audio"})}_r.length>0&&(Vl.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(_r.map(_o=>"user: ".concat(_o.user.uid,", mediaType: ").concat(_o.mediaType)).join("; ")," ")),this.massSubscribe(_r).catch(_o=>{Vl.error("[".concat(this._clientId,"] mass resubscribe error"),_o.toString())})),this.getListeners(W0.PUBLISHED_USER_LIST).length>0?(Vl.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(_t.map(_o=>_o.uid).join(", "))),this.emit(W0.PUBLISHED_USER_LIST,_t)):Vl.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(_t.map(_o=>_o.uid).join(", ")))})}_handleP2PChannelEvents(){this._p2pChannel.on(ty.RequestMuteLocal,async(_e,_t,_r)=>{if(this._joinInfo)try{await this._gateway.muteLocal(_e,this._joinInfo.stringUid||this._joinInfo.uid),_t()}catch(_o){_o.code===Ql.DISCONNECT_P2P?_t():_r(_o)}else _t()}),this._p2pChannel.on(ty.RequestUnmuteLocal,async(_e,_t,_r)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(_e,this._joinInfo.stringUid||this._joinInfo.uid),_t()}catch(_o){_o.code===Ql.DISCONNECT_P2P?_t():_r(_o)}else _t()}),this._p2pChannel.on(ty.RequestRePublish,(_e,_t,_r)=>{this.publish(_e,!1).then(_t).catch(_r)}),this._p2pChannel.on(ty.RequestReSubscribe,async(_e,_t,_r)=>{try{for(const{user:_o,kind:_a}of _e)_a===P0.VIDEO?await this.subscribe(_o,"video"):await this.subscribe(_o,"audio");_t()}catch(_o){_r(_o)}}),this._p2pChannel.on(ty.RequestUploadStats,(_e,_t)=>{this._gateway.uploadStats(_e,_t)}),this._p2pChannel.on(ty.MediaReconnectStart,_e=>{this.emit(W0.MEDIA_RECONNECT_START,_e)}),this._p2pChannel.on(ty.MediaReconnectEnd,_e=>{this.emit(W0.MEDIA_RECONNECT_END,_e)}),this._p2pChannel.on(ty.NeedSignalRTT,_e=>{_e(this._gateway.getSignalRTT())}),this._p2pChannel.on(ty.RequestRestartICE,async()=>{const _e=await this._p2pChannel.restartICE(),_t=await _e.next();if(_t.done)return;const _r=_t.value;let _o;try{_o=await this._gateway.restartICE({iceParameters:_r})}catch(_u){return void _e.throw(_u)}const{iceParameters:_a}=function(_u){const yl=_u.iceParameters;return{iceParameters:{iceUfrag:yl.iceUfrag,icePwd:yl.icePwd}}}(_o);await _e.next({remoteIceParameters:_a})}),this._p2pChannel.on(ty.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(ty.RequestReconnectPC,async()=>{var _e;const{iceParameters:_t,dtlsParameters:_r,rtpCapabilities:_o}=await this._p2pChannel.startP2PConnection({turnServer:(_e=this._joinInfo)===null||_e===void 0?void 0:_e.turnServer}),{gatewayEstablishParams:_a,gatewayAddress:_u}=await this._gateway.reconnectPC({iceParameters:_t,dtlsParameters:_r,rtpCapabilities:_o}),{dtlsParameters:yl,iceParameters:Rl,candidates:Al,rtpCapabilities:Ol,setup:xl,cname:Ll}=mz(_a,_u);await this._p2pChannel.connect(Rl,yl,Al,Ol,xl,Ll),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(ty.RequestUnpublishForReconnectPC,async(_e,_t,_r)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(_e,this._uid),_t()):_r()}),this._p2pChannel.on(ty.P2PLost,()=>{this.emit(W0.P2P_LOST,this.store.uid)}),this._p2pChannel.on(ty.UpdateVideoEncoder,_e=>{_e._encoderConfig&&this._gateway.setVideoProfile(_e._encoderConfig)}),this._p2pChannel.on(ty.ConnectionTypeChange,_e=>{this.emit(W0.IS_USING_CLOUD_PROXY,_e)}),this._p2pChannel.on(ty.RequestLowStreamParameter,_e=>{_e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(ty.QueryClientConnectionState,_e=>{_e(this.connectionState)})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(_e){if(this.connectionState!=="CONNECTED"||!this._joinInfo)throw new Tp(Ql.INVALID_OPERATION,"[".concat(this._clientId,"] Client did not join channel"));if(this._inspect)throw new Tp(Ql.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));if(!_e)throw new Tp(Ql.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig is necessary"));if(!_e.inspectType||!Array.isArray(_e.inspectType))throw new Tp(Ql.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig.inspectType is necessary and is an instance of Array."));{const _t=[...new Set(_e.inspectType)];_t.forEach(_r=>{if(!["supervise","moderation"].includes(_r))throw new Tp(Ql.INVALID_PARAMS,"[".concat(this._clientId,"] ").concat(_r," is not a valid inspect type."))}),_e.inspectType=_t}if(_e&&_e.extraInfo&&_e.extraInfo.length>1024)throw new Tp(Ql.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig.extraInfo length cannot exceed 1024 bytes"));try{const _t=new TU(_e);this._inspect=_t,this.handleVideoInspectEvents(this._inspect),await _t.init({appId:this._joinInfo.appId,areaCode:"",cname:this._joinInfo.cname,sid:this._joinInfo.sid,token:this._joinInfo.token,uid:this._joinInfo.uid,cid:this._joinInfo.cid,vid:this._joinInfo.vid?Number(this._joinInfo.vid):0},h_)}catch(_t){throw Array.isArray(_t)?_t[0]:_t}}async disableContentInspect(){if(!this._inspect)throw new Tp(Ql.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(_e){throw Array.isArray(_e)?_e[0]:_e}}handleVideoInspectEvents(_e){_e.on(d_.CONNECTION_STATE_CHANGE,(_t,_r)=>{switch(this.emit(W0.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,_t,_r),_r){case WT.CONNECTED:if(this.connectionState!=="CONNECTED")return void this.emit(W0.CONTENT_INSPECT_ERROR,new Tp(Ql.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));_e.inspectImage()}}),_e.on(d_.INSPECT_RESULT,(_t,_r)=>{var _o;if((_r==null?void 0:_r.code)===Ql.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return Vl.debug("Stop inspect content because that has left channel"),this==null||(_o=this._inspect)===null||_o===void 0||_o.close(),void(this._inspect=void 0);this.emit(W0.CONTENT_INSPECT_RESULT,_t,_r)}),_e.on(d_.CLIENT_LOCAL_VIDEO_TRACK,_t=>{_t(this.localTracks.filter(_r=>_r.trackMediaType==="video")[0])})}getJoinChannelServiceRecords(){return Vl.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(_e){o2(_e,"enabled"),Ey("ENABLE_PUBLISH_AUDIO_FILTER",_e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(_e)}_handleResetAddStream(_e,_t){switch(_t){case"audio":_e._audio_added_=!1,_e._trust_audio_stream_added_state_=!0;break;case"video":_e._video_added_=!1,_e._trust_video_stream_added_state_=!0}}}).prototype,"leave",[SY],Object.getOwnPropertyDescriptor(o0.prototype,"leave"),o0.prototype),Yp(o0.prototype,"publish",[RY],Object.getOwnPropertyDescriptor(o0.prototype,"publish"),o0.prototype),Yp(o0.prototype,"unpublish",[AY],Object.getOwnPropertyDescriptor(o0.prototype,"unpublish"),o0.prototype),Yp(o0.prototype,"subscribe",[IY],Object.getOwnPropertyDescriptor(o0.prototype,"subscribe"),o0.prototype),Yp(o0.prototype,"massSubscribe",[wY],Object.getOwnPropertyDescriptor(o0.prototype,"massSubscribe"),o0.prototype),Yp(o0.prototype,"unsubscribe",[OY],Object.getOwnPropertyDescriptor(o0.prototype,"unsubscribe"),o0.prototype),Yp(o0.prototype,"massUnsubscribe",[CY],Object.getOwnPropertyDescriptor(o0.prototype,"massUnsubscribe"),o0.prototype),Yp(o0.prototype,"setLowStreamParameter",[xY],Object.getOwnPropertyDescriptor(o0.prototype,"setLowStreamParameter"),o0.prototype),Yp(o0.prototype,"enableDualStream",[kY],Object.getOwnPropertyDescriptor(o0.prototype,"enableDualStream"),o0.prototype),Yp(o0.prototype,"disableDualStream",[PY],Object.getOwnPropertyDescriptor(o0.prototype,"disableDualStream"),o0.prototype),Yp(o0.prototype,"setClientRole",[NY],Object.getOwnPropertyDescriptor(o0.prototype,"setClientRole"),o0.prototype),Yp(o0.prototype,"setProxyServer",[LY],Object.getOwnPropertyDescriptor(o0.prototype,"setProxyServer"),o0.prototype),Yp(o0.prototype,"setTurnServer",[DY],Object.getOwnPropertyDescriptor(o0.prototype,"setTurnServer"),o0.prototype),Yp(o0.prototype,"setLicense",[MY],Object.getOwnPropertyDescriptor(o0.prototype,"setLicense"),o0.prototype),Yp(o0.prototype,"startProxyServer",[UY],Object.getOwnPropertyDescriptor(o0.prototype,"startProxyServer"),o0.prototype),Yp(o0.prototype,"stopProxyServer",[jY],Object.getOwnPropertyDescriptor(o0.prototype,"stopProxyServer"),o0.prototype),Yp(o0.prototype,"setLocalAccessPointsV2",[FY],Object.getOwnPropertyDescriptor(o0.prototype,"setLocalAccessPointsV2"),o0.prototype),Yp(o0.prototype,"setLocalAccessPoints",[BY],Object.getOwnPropertyDescriptor(o0.prototype,"setLocalAccessPoints"),o0.prototype),Yp(o0.prototype,"setRemoteDefaultVideoStreamType",[$Y],Object.getOwnPropertyDescriptor(o0.prototype,"setRemoteDefaultVideoStreamType"),o0.prototype),Yp(o0.prototype,"setRemoteVideoStreamType",[VY],Object.getOwnPropertyDescriptor(o0.prototype,"setRemoteVideoStreamType"),o0.prototype),Yp(o0.prototype,"setStreamFallbackOption",[GY],Object.getOwnPropertyDescriptor(o0.prototype,"setStreamFallbackOption"),o0.prototype),Yp(o0.prototype,"setEncryptionConfig",[WY],Object.getOwnPropertyDescriptor(o0.prototype,"setEncryptionConfig"),o0.prototype),Yp(o0.prototype,"renewToken",[HY],Object.getOwnPropertyDescriptor(o0.prototype,"renewToken"),o0.prototype),Yp(o0.prototype,"enableAudioVolumeIndicator",[KY],Object.getOwnPropertyDescriptor(o0.prototype,"enableAudioVolumeIndicator"),o0.prototype),Yp(o0.prototype,"startLiveStreaming",[qY],Object.getOwnPropertyDescriptor(o0.prototype,"startLiveStreaming"),o0.prototype),Yp(o0.prototype,"setLiveTranscoding",[zY],Object.getOwnPropertyDescriptor(o0.prototype,"setLiveTranscoding"),o0.prototype),Yp(o0.prototype,"stopLiveStreaming",[YY],Object.getOwnPropertyDescriptor(o0.prototype,"stopLiveStreaming"),o0.prototype),Yp(o0.prototype,"addInjectStreamUrl",[XY],Object.getOwnPropertyDescriptor(o0.prototype,"addInjectStreamUrl"),o0.prototype),Yp(o0.prototype,"removeInjectStreamUrl",[JY],Object.getOwnPropertyDescriptor(o0.prototype,"removeInjectStreamUrl"),o0.prototype),Yp(o0.prototype,"startChannelMediaRelay",[QY],Object.getOwnPropertyDescriptor(o0.prototype,"startChannelMediaRelay"),o0.prototype),Yp(o0.prototype,"updateChannelMediaRelay",[ZY],Object.getOwnPropertyDescriptor(o0.prototype,"updateChannelMediaRelay"),o0.prototype),Yp(o0.prototype,"stopChannelMediaRelay",[eX],Object.getOwnPropertyDescriptor(o0.prototype,"stopChannelMediaRelay"),o0.prototype),Yp(o0.prototype,"sendCustomReportMessage",[tX],Object.getOwnPropertyDescriptor(o0.prototype,"sendCustomReportMessage"),o0.prototype),Yp(o0.prototype,"pickSVCLayer",[nX],Object.getOwnPropertyDescriptor(o0.prototype,"pickSVCLayer"),o0.prototype),Yp(o0.prototype,"enableContentInspect",[rX],Object.getOwnPropertyDescriptor(o0.prototype,"enableContentInspect"),o0.prototype),Yp(o0.prototype,"disableContentInspect",[iX],Object.getOwnPropertyDescriptor(o0.prototype,"disableContentInspect"),o0.prototype),Yp(o0.prototype,"getJoinChannelServiceRecords",[oX],Object.getOwnPropertyDescriptor(o0.prototype,"getJoinChannelServiceRecords"),o0.prototype),Yp(o0.prototype,"setPublishAudioFilterEnabled",[sX],Object.getOwnPropertyDescriptor(o0.prototype,"setPublishAudioFilterEnabled"),o0.prototype),o0);class Pre extends L7{set currentState(_t){_t!==this._currentState&&(this._currentState=_t,this.emit(_T.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(_t){let _r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),Ml(this,"audioBuffer",void 0),Ml(this,"sourceNode",void 0),Ml(this,"startPlayTime",0),Ml(this,"startPlayOffset",0),Ml(this,"pausePlayTime",0),Ml(this,"options",void 0),Ml(this,"currentLoopCount",0),Ml(this,"_currentState","stopped"),this.audioBuffer=_t,this.options=_r,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer.duration}get currentTime(){return this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:(this.context.currentTime-this.startPlayTime+this.startPlayOffset)%this.audioBuffer.duration}updateOptions(_t){this.currentState==="stopped"?(this.options=_t,this.startPlayOffset=this.options.startPlayTime||0):Vl.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(_t){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=_t,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=_t))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const _t=this.context.createBufferSource();return _t.buffer=this.audioBuffer,_t.loop=!!this.options.loop,_t.connect(this.outputNode),_t}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const cX=new Map;async function Nre(_e,_t){let _r=null;if(typeof _e=="string"){const _a=cX.get(_e);if(_a)return Vl.debug("use cached audio resource: ",_e),_a;try{_r=(await iR(()=>TS.get(_e,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(_u){throw new Tp(Ql.FETCH_AUDIO_FILE_FAILED,_u.toString())}}else _r=await new u0((_u,yl)=>{const Rl=new FileReader;Rl.onload=Al=>{Al.target?_u(Al.target.result):yl(new Tp(Ql.READ_LOCAL_AUDIO_FILE_ERROR))},Rl.onerror=()=>{yl(new Tp(Ql.READ_LOCAL_AUDIO_FILE_ERROR))},Rl.readAsArrayBuffer(_e)});const _o=await function(_a){const _u=uN();return new u0((yl,Rl)=>{_u.decodeAudioData(_a,Al=>{yl(Al)},Al=>{Rl(new Tp(Ql.DECODE_AUDIO_FILE_FAILED,Al.toString()))})})}(_r);return typeof _e=="string"&&_t&&cX.set(_e,_o),_o}function uX(_e,_t){var _r=Object.keys(_e);if(Object.getOwnPropertySymbols){var _o=Object.getOwnPropertySymbols(_e);_t&&(_o=_o.filter(function(_a){return Object.getOwnPropertyDescriptor(_e,_a).enumerable})),_r.push.apply(_r,_o)}return _r}function SU(_e){for(var _t=1;_t<arguments.length;_t++){var _r=arguments[_t]!=null?arguments[_t]:{};_t%2?uX(Object(_r),!0).forEach(function(_o){Ml(_e,_o,_r[_o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_e,Object.getOwnPropertyDescriptors(_r)):uX(Object(_r)).forEach(function(_o){Object.defineProperty(_e,_o,Object.getOwnPropertyDescriptor(_r,_o))})}return _e}function O$(_e,_t,_r,_o){_r.optimizationMode&&(_o&&_o.width&&_o.height?(_r.encoderConfig=SU(SU({},_o),{},{bitrateMin:_o.bitrateMin,bitrateMax:_o.bitrateMax}),_r.optimizationMode!=="motion"&&_r.optimizationMode!=="detail"||(_t.contentHint=_r.optimizationMode,_t.contentHint===_r.optimizationMode?Vl.debug("[".concat(_e,"] set content hint to"),_r.optimizationMode):Vl.debug("[".concat(_e,"] set content hint failed")))):Vl.warning("[".concat(_e,"] can not apply optimization mode bitrate config, no encoderConfig")))}const Lre=gy().name;function Dre(_e,_t,_r,_o){let _a,_u=0,yl=null;return new u0((Rl,Al)=>{setTimeout(()=>{_a&&(_a(),Rl(_u))},_t),_a=P7(()=>{(function(){_u>_o&&_a&&(_a(),Rl(_u));const Ol=_r.getContext("2d");if(!Ol){const Bl=new Tp(Ql.UNEXPECTED_ERROR,"can not get canvas 2d context.");return Vl.error(Bl.toString()),void Al(Bl)}Ol.drawImage(_e,0,0,160,120);const xl=Ol.getImageData(0,0,_r.width,_r.height),Ll=Math.floor(xl.data.length/3);if(yl){for(let Bl=0;Bl<Ll;Bl+=3)if(xl.data[Bl]!==yl[Bl])return _u+=1,void(yl=xl.data);yl=xl.data}else yl=xl.data})()},30)})}class C2{constructor(_t,_r){Ml(this,"id",0),Ml(this,"element",void 0),Ml(this,"peerPair",void 0),Ml(this,"context",void 0),Ml(this,"audioPlayerElement",void 0),Ml(this,"audioTrack",void 0),C2.count+=1,this.id=C2.count,this.element=_t,this.context=_r}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=_t=>{const _r=document.createElement("audio");_r.srcObject=new MediaStream([_t.track]),_r.play(),this.audioPlayerElement=_r}}async switchSdp(){if(!this.peerPair)return;const _t=async(_o,_a)=>{const _u=_a==="offer"?await _o.createOffer():await _o.createAnswer();return await _o.setLocalDescription(_u),_o.iceGatheringState==="complete"?_o.localDescription:new u0(yl=>{_o.onicegatheringstatechange=()=>{_o.iceGatheringState==="complete"&&yl(_o.localDescription)}})},_r=async(_o,_a)=>await _o.setRemoteDescription(_a);try{const _o=await _t(this.peerPair[0],"offer");await _r(this.peerPair[1],_o);const _a=await _t(this.peerPair[1],"answer");await _r(this.peerPair[0],_a)}catch(_o){throw new Tp(Ql.LOCAL_AEC_ERROR,_o.toString()).print()}}async getTracksFromMediaElement(_t){if(this.audioTrack)return this.audioTrack;let _r;try{_t instanceof HTMLVideoElement&&(_t.captureStream?_t.captureStream():_t.mozCaptureStream()),_r=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(_t).connect(_r)}catch(_a){throw new Tp(Ql.LOCAL_AEC_ERROR,_a.toString()).print()}if(!_r)throw new Tp(Ql.LOCAL_AEC_ERROR,"no dest node when local aec").print();const _o=_r.stream.getAudioTracks()[0];return this.audioTrack=_o,_o}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const _t=this.element,_r=await this.getTracksFromMediaElement(_t);this.peerPair&&this.peerPair[0].addTrack(_r),await this.switchSdp()}close(){Vl.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(_t=>{_t.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var lX,RU;Ml(C2,"count",0);const Mre=window.AudioContext||window.webkitAudioContext,Ure=new(lX=_0({report:g0}),Yp((RU=class{constructor(){Ml(this,"units",[]),Ml(this,"context",void 0)}processExternalMediaAEC(_e){if(!this._doesEnvironmentNeedAEC())return Vl.debug("the system does not need to process local aec"),-1;this.context||(this.context=new Mre);let _t=this.units.find(_r=>_r&&_r.getElement()===_e);return _t||(_t=new C2(_e,this.context),this.units.push(_t)),_t.startEchoCancellation(),Vl.debug("start processing local audio echo cancellation, id is",_t.id),_t.id}_doesEnvironmentNeedAEC(){return gy().name!==fy.SAFARI}}).prototype,"processExternalMediaAEC",[lX],Object.getOwnPropertyDescriptor(RU.prototype,"processExternalMediaAEC"),RU.prototype),RU);Ey("PROCESS_ID","process-".concat(Ny(8,""),"-").concat(Ny(4,""),"-").concat(Ny(4,""),"-").concat(Ny(4,""),"-").concat(Ny(12,""))),function(){const _e=gy();rT.getDisplayMedia=function(_t){return!!(navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia)}(),rT.getStreamFromExtension=_e.name===fy.CHROME&&Number(_e.version)>34,rT.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const _t=new RTCPeerConnection;let _r=!1;try{_t.addTransceiver("audio"),_r=!0}catch{}return _t.close(),_r}(),rT.supportMinBitrate=_e.name===fy.CHROME||_e.name===fy.EDGE,rT.supportSetRtpSenderParameters=function(){const _t=gy();return!window.RTCRtpSender||!window.RTCRtpSender.prototype.setParameters||!window.RTCRtpSender.prototype.getParameters?!1:!!eO()||!(!_b()&&!k5())||_t.name===fy.FIREFOX&&Number(_t.version)>=64}(),_e.name===fy.SAFARI&&(Number(_e.version)>=14?rT.supportDualStream=!0:rT.supportDualStream=!1),rT.webAudioMediaStreamDest=function(){const _t=gy();return!(_t.name===fy.SAFARI&&Number(_t.version)<12)}(),rT.supportReplaceTrack=function(){return window.RTCRtpSender?typeof RTCRtpSender.prototype.replaceTrack=="function":!1}(),rT.supportWebGL=typeof WebGLRenderingContext<"u",rT.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,eO()||(rT.webAudioWithAEC=!0),rT.supportShareAudio=function(){const _t=gy();return(_t.os===z_.WIN_10||_t.os===z_.WIN_81||_t.os===z_.WIN_7||_t.os===z_.LINUX||_t.os===z_.MAC_OS)&&_t.name===fy.CHROME&&Number(_t.version)>=74}(),rT.supportDualStreamEncoding=function(){const _t=gy();return Pp("DISABLE_WEBAUDIO")?!0:_t.name==="Safari"&&Number(_t.version)>=14||!!(_t.name==="Chrome"&&/Windows/i.test(_t.os||"")&&Number(_t.version)>=100&&Pp("CHROME_DUAL_STREAM_USE_ENCODING"))}(),rT.supportDataChannel=function(){return!!(k6(76)||function(_t){const _r=gy();return!(_r.name!==fy.FIREFOX||!_r.osVersion)&&Number(_r.version)>=_t}(68)||function(_t){const _r=gy();return!(_r.name!==fy.SAFARI||!_r.osVersion)&&Number(_r.version)>=_t}(14))}(),rT.supportPCSetConfiguration=!Wy()&&!!RTCPeerConnection.prototype.setConfiguration,Vl.info("browser compatibility",JSON.stringify(rT),JSON.stringify(_e))}(),function(){let _e;try{_e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(_t){return void Vl.error("Error loading sdk config",_t.message)}if(_e)try{const _t=JSON.parse(window.atob(_e)),_r=Date.now();Vl.debug("Loading global parameters from cache",_t),Object.keys(_t).forEach(_o=>{if(Object.prototype.hasOwnProperty.call(vT,_o)){const{value:_a,expires:_u}=_t[_o];if(_u&&_u<=_r)return;rO[_o]=_a,vT[_o]=_a}})}catch(_t){Vl.error("Error loading mutableParamsCache: ".concat(_e),_t.message)}}(),Array.isArray(rO.AREAS)&&rO.AREAS.length>0&&$4(rO.AREAS,!0);const hT={__CLIENT_LIST__:iO,__TRACK_LIST__:i2,VERSION:aS,BUILD:J6,setParameter:(_e,_t,_r)=>{Vl.debug("setParameter key:".concat(_e,", value:").concat(JSON.stringify(_t))),Ey(_e,_t,_r)},getParameter:Pp,getSupportedCodec:async function(){let _e={audio:[],video:[]};try{let _t=new RTCPeerConnection;_t.addTransceiver("video",{direction:"recvonly"}),_t.addTransceiver("audio",{direction:"recvonly"});const _r=(await _t.createOffer()).sdp;if(!_r)return _e;_t.close(),_t=null,_e=function(_o){const _a={video:[],audio:[]};return _o.match(/ VP8/i)&&_a.video.push("VP8"),_o.match(/ VP9/i)&&_a.video.push("VP9"),_o.match(/ AV1/i)&&_a.video.push("AV1"),_o.match(/ H264/i)&&_a.video.push("H264"),_o.match(/ opus/i)&&_a.audio.push("OPUS"),_o.match(/ PCMU/i)&&_a.audio.push("PCMU"),_o.match(/ PCMA/i)&&_a.audio.push("PCMA"),_o.match(/ G722/i)&&_a.audio.push("G722"),_a}(_r)}catch(_t){throw new Tp(Ql.CREATE_OFFER_FAILED,_t.toString&&_t.toString()).print()}return _e},checkSystemRequirements:function(){const _e=g0.reportApiInvoke(null,{name:c_.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:jy.TRACER});let _t=!1;try{const _u=window.RTCPeerConnection,yl=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,Rl=window.WebSocket;_t=!!(_u&&yl&&Rl)}catch(_u){return Vl.error("check system requirement failed: ",_u),!1}let _r=!1;const _o=gy();_o.name===fy.CHROME&&Number(_o.version)>=58&&(!JQ()||XQ())&&(_r=!0),_o.name===fy.FIREFOX&&Number(_o.version)>=56&&(_r=!0),_o.name===fy.OPERA&&Number(_o.version)>=45&&(_r=!0),_o.name===fy.SAFARI&&Number(_o.version)>=11&&(_r=!0),(r8()||gy().name===fy.QQ)&&(_r=!0),Vl.debug("checkSystemRequirements, api:",_t,"browser",_r);const _a=_t&&_r;return _e.onSuccess(_a),_a},getDevices:function(_e){return zT.enumerateDevices(!0,!0,_e)},getMicrophones:function(_e){return zT.getRecordingDevices(_e)},getCameras:function(_e){return zT.getCamerasDevices(_e)},getElectronScreenSources:M7,getPlaybackDevices:function(_e){return zT.getSpeakers(_e)},createClient:function(){let _e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const _t=g0.reportApiInvoke(null,{name:c_.CREATE_CLIENT,options:[_e],tag:jy.TRACER});try{Iee(_e)}catch(_r){throw _t.onError(_r),_r}return _e.audioCodec===void 0&&(_e.audioCodec="opus"),_t.onSuccess(),new kre(O2(O2({forceWaitGatewayResponse:!0},_e),{},{role:_e.mode==="rtc"?"host":_e.role}))},createCameraVideoTrack:async function(){let _e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const _t=g0.reportApiInvoke(null,{tag:jy.TRACER,name:c_.CREATE_CAM_VIDEO_TRACK,options:[SU({},_e)]}),_r=aU(_e),_o=Ny(8,"track-cam-");let _a=null;Vl.info("start create camera video track with config",JSON.stringify(_e),"trackId",_o);try{_a=(await AS({video:_r},_o)).getVideoTracks()[0]||null}catch(yl){throw _t.onError(yl),yl}if(!_a){const yl=new Tp(Ql.UNEXPECTED_ERROR,"can not find track in media stream");return _t.onError(yl),yl.throw()}_e.optimizationMode&&O$(_o,_a,_e,nO(_e.encoderConfig));const _u=new L9(_a,_e,_r,_e.scalabiltyMode?V5(_e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},_e.optimizationMode,_o);return _t.onSuccess(_u.getTrackId()),Vl.info("create camera video success, trackId:",_o),_u},createCustomVideoTrack:function(_e){const _t=g0.reportApiInvoke(null,{tag:jy.TRACER,name:c_.CREATE_CUSTOM_VIDEO_TRACK,options:[_e]}),_r=new i_(_e.mediaStreamTrack,{width:_e.width,height:_e.height,frameRate:_e.frameRate,bitrateMax:_e.bitrateMax,bitrateMin:_e.bitrateMin},_e.scalabiltyMode?V5(_e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},_e.optimizationMode,Ny(8,"track-cus-"),[f_.CUSTOM_TRACK]);return _t.onSuccess(_r.getTrackId()),Vl.info("create custom video track success with config",_e,"trackId",_r.getTrackId()),_r},createScreenVideoTrack:async function(){let _e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},_t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const _r=g0.reportApiInvoke(null,{tag:jy.TRACER,name:c_.CREATE_SCREEN_VIDEO_TRACK,options:[SU({},_e),_t]});_e.encoderConfig?typeof _e.encoderConfig=="string"||_e.encoderConfig.width&&_e.encoderConfig.height||(_e.encoderConfig.width={max:1920},_e.encoderConfig.height={max:1080}):_e.encoderConfig="1080p_2";const _o=yne(_e),_a=Ny(8,"track-scr-v-");let _u=null,yl=null;const Rl=R_();if(!Rl.supportShareAudio&&_t==="enable"){const xl=new Tp(Ql.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return _r.onError(xl),xl.throw()}Vl.info("start create screen video track with config",_e,"withAudio",_t,"trackId",_a);try{const xl=await AS({screen:_o,screenAudio:_t==="auto"?Rl.supportShareAudio:_t==="enable"},_a);_u=xl.getVideoTracks()[0]||null,yl=xl.getAudioTracks()[0]||null}catch(xl){throw _r.onError(xl),xl}if(!_u){const xl=new Tp(Ql.UNEXPECTED_ERROR,"can not find track in media stream");return _r.onError(xl),xl.throw()}if(!yl&&_t==="enable"){_u&&_u.stop();const xl=new Tp(Ql.SHARE_AUDIO_NOT_ALLOWED);return _r.onError(xl),xl.throw()}_e.optimizationMode||(_e.optimizationMode="detail"),_e.optimizationMode&&(O$(_a,_u,_e,_e.encoderConfig&&Z6(_e.encoderConfig)),_e.encoderConfig&&typeof _e.encoderConfig!="string"&&(_e.encoderConfig.bitrateMin=_e.encoderConfig.bitrateMax));const Al=new i_(_u,_e.encoderConfig?Z6(_e.encoderConfig):{},_e.scalabiltyMode?V5(_e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},_e.optimizationMode,_a,[f_.SCREEN_TRACK]);if(!yl)return _r.onSuccess(Al.getTrackId()),Vl.info("create screen video track success","video:",Al.getTrackId()),Al;const Ol=new V_(yl,void 0,Ny(8,"track-scr-a-"),!1,!0);return _r.onSuccess([Al.getTrackId(),Ol.getTrackId()]),Vl.info("create screen video track success","video:",Al.getTrackId(),"audio:",Ol.getTrackId()),[Al,Ol]},createMicrophoneAndCameraTracks:async function(){let _e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},_t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const _r=g0.reportApiInvoke(null,{tag:jy.TRACER,name:c_.CREATE_MIC_AND_CAM_TRACKS,options:[_e,_t]}),_o=aU(_t),_a=jq(_e),_u=Ny(8,"track-mic-"),yl=Ny(8,"track-cam-");let Rl=null,Al=null;Vl.info("start create camera video track(".concat(yl,") and microphone audio track(").concat(_u,") with config, audio: ").concat(JSON.stringify(_e),", video: ").concat(JSON.stringify(_t)));try{const Ll=await AS({audio:_a,video:_o},"".concat(_u,"-").concat(yl));Rl=Ll.getAudioTracks()[0],Al=Ll.getVideoTracks()[0]}catch(Ll){throw _r.onError(Ll),Ll}if(!Rl||!Al){const Ll=new Tp(Ql.UNEXPECTED_ERROR,"can not find tracks in media stream");return _r.onError(Ll),Ll.throw()}_t.optimizationMode&&O$(yl,Al,_t,nO(_t.encoderConfig));const Ol=new Q5(Rl,_e,_a,_u),xl=new L9(Al,_t,_o,_t.scalabiltyMode?V5(_t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},_t.optimizationMode,yl);return _r.onSuccess([Ol.getTrackId(),xl.getTrackId()]),Vl.info("create camera video track(".concat(yl,") and microphone audio track(").concat(_u,") success")),[Ol,xl]},createMicrophoneAudioTrack:async function(){let _e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const _t=g0.reportApiInvoke(null,{tag:jy.TRACER,name:c_.CREATE_MIC_AUDIO_TRACK,options:[_e]}),_r=jq(_e),_o=Ny(8,"track-mic-");let _a=null;Vl.info("start create microphone audio track with config",JSON.stringify(_e),"trackId",_o);try{_a=(await AS({audio:_r},_o)).getAudioTracks()[0]||null}catch(yl){throw _t.onError(yl),yl}if(!_a){const yl=new Tp(Ql.UNEXPECTED_ERROR,"can not find track in media stream");return _t.onError(yl),yl.throw()}const _u=new Q5(_a,_e,_r,_o);return _t.onSuccess(_u.getTrackId()),Vl.info("create microphone audio track success, trackId:",_o),_u},createCustomAudioTrack:function(_e){const _t=g0.reportApiInvoke(null,{tag:jy.TRACER,name:c_.CREATE_CUSTOM_AUDIO_TRACK,options:[_e]}),_r=new V_(_e.mediaStreamTrack,_e.encoderConfig?G5(_e.encoderConfig):{},Ny(8,"track-cus-"),!1,!0);return Vl.info("create custom audio track success with config",_e,"trackId",_r.getTrackId()),_t.onSuccess(_r.getTrackId()),_r},createBufferSourceAudioTrack:async function(_e){const _t=g0.reportApiInvoke(null,{tag:jy.TRACER,name:c_.CREATE_BUFFER_AUDIO_TRACK,options:[_e]});if(Pp("DISABLE_WEBAUDIO"))throw new Tp(Ql.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");const _r=Ny(8,"track-buf-");Vl.info("start create buffer source audio track with config",JSON.stringify(_e),"trackId",_r);const _o=_e.source;if(!(_e.source instanceof AudioBuffer))try{_e.source=await Nre(_e.source,_e.cacheOnlineFile)}catch(yl){return _t.onError(yl),yl.throw()}const _a=new Pre(_e.source),_u=new qte(_o,_a,_e.encoderConfig?G5(_e.encoderConfig):{},_r);return Vl.info("create buffer source audio track success, trackId:",_r),_t.onSuccess(_u.getTrackId()),_u},setAppType:function(_e){if(Vl.debug("setAppType: ".concat(_e)),!(Number.isInteger(_e)&&_e>=0))throw Vl.debug("Invalid appType"),new Tp(Ql.INVALID_PARAMS,"invalid app type",_e);Ey("APP_TYPE",Math.floor(_e))},setLogLevel:function(_e){Vl.setLogLevel(_e)},enableLogUpload:function(){Pp("USE_NEW_LOG")?Ey("UPLOAD_LOG",!0):Vl.enableLogUpload()},disableLogUpload:function(){Pp("USE_NEW_LOG")?Ey("UPLOAD_LOG",!1):Vl.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new pq},checkAudioTrackIsActive:async function(_e){let _t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const _r=g0.reportApiInvoke(null,{tag:jy.TRACER,name:c_.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[_t]});if(!(_e instanceof V_||_e instanceof vU)){const Al=new Tp(Ql.INVALID_TRACK,"the parameter is not a audio track");return _r.onError(Al),Al.throw()}_t&&_t<1e3&&(_t=1e3);const _o=_e instanceof V_?_e.getTrackLabel():"remote_track",_a=_e.getVolumeLevel();let _u=_a,yl=_a;const Rl=Date.now();return new u0(Al=>{const Ol=setInterval(()=>{const xl=_e.getVolumeLevel();_u=xl>_u?xl:_u,yl=xl<yl?xl:yl;const Ll=_u-yl>1e-4,Bl=Date.now()-Rl;if(Ll||Bl>_t){clearInterval(Ol);const Hl=Ll,up={duration:Bl,deviceLabel:_o,maxVolumeLevel:_u,result:Hl};Vl.info("[track-".concat(_e.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(up))),_r.onSuccess(up),Al(Hl)}},200)})},checkVideoTrackIsActive:async function(_e){let _t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const _r=g0.reportApiInvoke(null,{tag:jy.TRACER,name:c_.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[_t]});if(!(_e instanceof i_||_e instanceof yU)){const Bl=new Tp(Ql.INVALID_TRACK,"the parameter is not a video track");return _r.onError(Bl),Bl.throw()}const _o=4;_t&&_t<1e3&&(_t=1e3);const _a=_e instanceof i_?_e.getTrackLabel():"remote_track",_u=_e.getMediaStreamTrack(!0),yl=document.createElement("video");yl.style.width="1px",yl.style.height="1px",yl.setAttribute("muted",""),yl.muted=!0,yl.setAttribute("playsinline",""),yl.controls=!1,(_b()||k5())&&(yl.style.opacity="0.01",yl.style.position="fixed",yl.style.left="0",yl.style.top="0",document.body.appendChild(yl)),yl.srcObject=new MediaStream([_u]),yl.play();const Rl=document.createElement("canvas");Rl.width=160,Rl.height=120;let Al=0,Ol=0;try{const Bl=Date.now();Al=await Dre(yl,_t,Rl,_o),Ol=Date.now()-Bl}catch(Bl){throw _r.onError(Bl),Bl}Lre===fy.SAFARI&&(yl.pause(),yl.remove()),yl.srcObject=null;const xl=Al>_o,Ll={duration:Ol,changedPicNum:Al,deviceLabel:_a,result:xl};return Vl.info("[track-".concat(_e.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(Ll))),_r.onSuccess(Ll),xl},setArea:$4,audioElementPlayCenter:kT,processExternalMediaAEC:function(_e){Ure.processExternalMediaAEC(_e)},registerExtensions:function(_e){_e.forEach(_t=>{const _r=_t;_r.__registered__=!0,_r.logger.hookLog=Vl.extLog,_r.reporter.hookApiInvoke=g0.extApiInvoke,_r.parameters&&Object.keys(_r.parameters).forEach(_o=>{_r.parameters[_o]=Pp(_o)})})},ChannelMediaRelayError:h1,ChannelMediaRelayEvent:$S,ChannelMediaRelayState:lT,RemoteStreamFallbackType:y4,RemoteStreamType:m4,ConnectionDisconnectedReason:cy,AudienceLatencyLevelType:d4,AREAS:Y0},C$=window||document;return Object.defineProperties(hT,{onAudioAutoplayFailed:{get:()=>KT.onAudioAutoplayFailed,set:_e=>{KT.onAudioAutoplayFailed=_e}},onAutoplayFailed:{get:()=>KT.onAutoplayFailed,set:_e=>{KT.onAutoplayFailed=_e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>hT._onSecurityPolicyViolation,set(_e){if(hT._onSecurityPolicyViolation=_e,!C$)return;const _t=_o=>{if(!(_o&&_o.blockedURI&&hT.onSecurityPolicyViolation))return;const _a=_o.blockedURI;Pp("CSP_DETECTED_HOSTNAME_LIST").some(_u=>_a.includes(_u))&&hT.onSecurityPolicyViolation&&typeof hT.onSecurityPolicyViolation=="function"&&hT.onSecurityPolicyViolation(_o)},_r=hT._cspEventHandlerPointer;_r&&C$.removeEventListener("securitypolicyviolation",_r),_e&&typeof _e=="function"&&C$.addEventListener("securitypolicyviolation",_t),hT._cspEventHandlerPointer=_t}}}),zT.on(LR.CAMERA_DEVICE_CHANGED,_e=>{Vl.info("camera device changed",JSON.stringify(_e)),hT.onCameraChanged&&hT.onCameraChanged(_e)}),zT.on(LR.RECORDING_DEVICE_CHANGED,_e=>{Vl.info("microphone device changed",JSON.stringify(_e)),hT.onMicrophoneChanged&&hT.onMicrophoneChanged(_e)}),zT.on(LR.PLAYOUT_DEVICE_CHANGED,_e=>{Vl.debug("playout device changed",JSON.stringify(_e)),hT.onPlaybackDeviceChanged&&hT.onPlaybackDeviceChanged(_e)}),kT.onAutoplayFailed=()=>{Vl.info("detect audio element autoplay failed"),KT.onAudioAutoplayFailed&&KT.onAudioAutoplayFailed()},X0.on("autoplay-failed",()=>{Vl.info("detect webaudio autoplay failed"),KT.onAudioAutoplayFailed&&KT.onAudioAutoplayFailed()}),window&&(window.__ARTC__=hT),hT})})(AgoraRTC_NProduction);const AgoraRTC=getDefaultExportFromCjs$1(AgoraRTC_NProductionExports),BASEURL="http://localhost:5000",getResourceID=async(h,i)=>{const g=await fetch(`${BASEURL}/record/getResourceID/${h}/${i}`,{method:"GET"});return JSON.parse(await g.json()).resourceId},startRecording=async(h,i,g,_,j)=>{const $=await fetch(`${BASEURL}/record/start/${h}/${i}`,{method:"POST",headers:{Accept:"application/json, text/plain","Content-Type":"application/json;charset=UTF-8","Access-Control-Allow-Origin":"*"},mode:"cors",body:JSON.stringify({rid:g,uid:_,ctype:1,token:j})}),_n=JSON.parse(await $.json());return await fetch(`${BASEURL}/liveLecture/createRecording/${h}/${_n.sid}/${_n.uid}/${g}`,{method:"POST",headers:{Accept:"application/json, text/plain","Content-Type":"application/json;charset=UTF-8","Access-Control-Allow-Origin":"*"}}),_n},stopRecording=async(h,i,g,_)=>{const j=await fetch(`${BASEURL}/record/stop/${h}/${i}/${g}/${_}`,{method:"POST",headers:{Accept:"application/json, text/plain","Content-Type":"application/json;charset=UTF-8","Access-Control-Allow-Origin":"*"},mode:"cors"});return JSON.parse(await j.json())},sendRecordingInfo=async(h,i,g,_)=>await sendRequest(`/liveLecture/createRecording/${h}/${_}/${i}/${g}`,"POST",{}),setUrl=async(h,i,g)=>await sendRequest(`/liveLecture/endRecording/${i}`,"POST",{url:g}),getLectureInfo=async()=>await sendRequest("/liveLecture/getAll","GET"),mutedIcon="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAACXBIWXMAAAsTAAALEwEAmpwYAAABXElEQVR4nO2Wz0rEMBDGc1pPevAgiz6RHgRBLz7Bwq6vudRD832BgWpBkBVfQI8rrERTKCXNZpv+8eAHc0iTzvzIn5lR6l81AViKyFxNIQArkjsAxSQQIjK3wUMQWusrAG92jc/snDHmcjAIBILXIDYqRSTPSIpz9pzn+Xlt7idI4N/gfDIExwJogxgVwHcnRgdo7sQkAM2dsNaWJwYD2Pc6RgGIgegdgB6Hh+SJZCA2HBhjbkMZc3AAkl9a6/vYPDEEwI7kNjZPJAMA+LQOiqI4bhSjre84nL1X3x3YRwpA5pzc2LEttbbahSAAvNixPSq3bt0ZgOSDc/okIqehtZ7jeHUAi84AZVkekUTVbAC4y7LsJAbC2aOIzFSKAFxUEAFrO45+2jsRmbmecV1dzBaI68EgfAo9s5jakayI8twvBPc0pIfWjlEAeofoqsbFXKkpJL8Qy0mCq7+qb4yphTRmeJ+UAAAAAElFTkSuQmCC",CommsButtons=({toggleMute:h,isMuted:i,toggleVideo:g,isVideoOff:_,toggleScreenShare:j,isScreenSharing:$,joinRTC:_n,isJoined:_i,handleRecording:_s,isRecording:ga,toggleChat:ba,isLecturer:xa})=>jsx("div",{className:"w3-bottom w3-center",children:jsxs("div",{className:"w3-bar w3-round w3-grey w3-padding w3-card",children:[jsx("button",{className:`w3-button w3-round ${_i?"w3-red":"w3-green"}`,onClick:_n,children:_i?"Leave Call":"Join Call"}),jsx("button",{className:`w3-button w3-round ${i?"w3-light-red":"w3-light-green"}`,onClick:h,disabled:!_i,children:i?"Unmute":"Mute"}),jsx("button",{className:`w3-button w3-round ${_?"w3-light-red":"w3-light-green"}`,onClick:g,disabled:!_i,children:_?"Turn On Video":"Turn Off Video"}),jsx("button",{className:`w3-button w3-round ${$?"w3-light-red":"w3-light-green"}`,onClick:j,disabled:!_i,children:$?"Stop Sharing Screen":"Share Screen"}),xa=="host"?jsx("button",{className:`w3-button w3-round ${ga?"w3-light-red":"w3-light-green"}`,onClick:_s,disabled:!_i,children:ga?"Stop Recording":"Start Recording"}):jsx(Fragment$1,{}),jsx("button",{className:"w3-button w3-round w3-gray",onClick:ba,children:"Toggle Chat"})]})});function e(h){this.message=h}e.prototype=new Error,e.prototype.name="InvalidCharacterError";var r=typeof window<"u"&&window.atob&&window.atob.bind(window)||function(h){var i=String(h).replace(/=+$/,"");if(i.length%4==1)throw new e("'atob' failed: The string to be decoded is not correctly encoded.");for(var g,_,j=0,$=0,_n="";_=i.charAt($++);~_&&(g=j%4?64*g+_:_,j++%4)?_n+=String.fromCharCode(255&g>>(-2*j&6)):0)_="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(_);return _n};function t(h){var i=h.replace(/-/g,"+").replace(/_/g,"/");switch(i.length%4){case 0:break;case 2:i+="==";break;case 3:i+="=";break;default:throw"Illegal base64url string!"}try{return function(g){return decodeURIComponent(r(g).replace(/(.)/g,function(_,j){var $=j.charCodeAt(0).toString(16).toUpperCase();return $.length<2&&($="0"+$),"%"+$}))}(i)}catch{return r(i)}}function n(h){this.message=h}function o(h,i){if(typeof h!="string")throw new n("Invalid token specified");var g=(i=i||{}).header===!0?0:1;try{return JSON.parse(t(h.split(".")[g]))}catch(_){throw new n("Invalid token specified: "+_.message)}}n.prototype=new Error,n.prototype.name="InvalidTokenError";const getTags=async()=>sendRequest("/tags","GET"),decodetoken=h=>o(h),createSession=async h=>await sendRequest(`/liveLecture/create/${h}`,"GET"),joinSession=async h=>await sendRequest(`/liveLecture/${h}/userJoin`,"POST",{}),getSessionInfo=async h=>await sendRequest(`/liveLecture/get/${h}`,"GET"),getUser=async h=>await sendRequest(`/users/${h}`,"GET"),uploadChatMessage=async(h,i)=>await sendRequest(`/liveLecture/${h}/chat/addMessage`,"POST",i),LiveChat=({isOpen:h,setIsOpen:i,chatMessages:g,sendChatMessage:_})=>{const j=reactExports.useRef(null),$=()=>{i(!h)},_n=()=>{var _i;(_i=j.current)==null||_i.scrollIntoView({behavior:"smooth"})};return reactExports.useEffect(()=>{_n()},[g]),jsxs("div",{className:`w3-sidebar w3-bar-block w3-card w3-animate-bottom ${h?"w3-show":"w3-hide"}`,style:{width:"300px",right:0,position:"fixed",zIndex:9999},children:[h&&jsx("button",{className:"w3-bar-item w3-button w3-right-align",onClick:$,children:"(-)"}),!h&&jsx("div",{className:"w3-bar",children:jsx("button",{className:"w3-bar-item w3-button",onClick:$,style:{width:"30px"},children:"+"})}),jsx("div",{className:"w3-container w3-border-bottom",style:{marginBottom:"10px"},children:jsx("h4",{children:"Chat"})}),jsxs("div",{className:"w3-container",style:{minHeight:"400px",overflowY:"scroll"},children:[g.map(_i=>jsxs("p",{style:{textAlign:"left"},children:[jsx("span",{style:{fontWeight:"bold"},children:_i.sender}),":",_i.text]},_i.timestamp.getTime())),jsx("div",{ref:j})]}),jsx("div",{className:`w3-container w3-border-top w3-bottom
        w3-padding `,children:jsx("input",{type:"text",className:"w3-input w3-border w3-round w3-margin-top w3-margin-bottom",placeholder:"Type your message...",onKeyPress:_i=>{_i.key==="Enter"&&(_(_i.currentTarget.value),_i.currentTarget.value="")}})})]})};var agoraRtmSdkExports={},agoraRtmSdk={get exports(){return agoraRtmSdkExports},set exports(h){agoraRtmSdkExports=h}};/*
 @preserve
 AgoraRTM Web SDK 1.6.0-205 - commit: v1.5.1-67-g0f6d3600
 Copyright (C) 2018-2022 Agora Lab.
 This file is licensed under the AGORA, INC. SDK LICENSE AGREEMENT
 A copy of this license may be found at https://www.agora.io/en/sdk-license-agreement/
*/(function(module,exports){(function(h,i){module.exports=i()})(commonjsGlobal,function(){function Jg(h,i){var g=Object.keys(h);if(Object.getOwnPropertySymbols){var _=Object.getOwnPropertySymbols(h);i&&(_=_.filter(function(j){return Object.getOwnPropertyDescriptor(h,j).enumerable})),g.push.apply(g,_)}return g}function tb(h){for(var i=1;i<arguments.length;i++){var g=arguments[i]!=null?arguments[i]:{};i%2?Jg(Object(g),!0).forEach(function(_){E(h,_,g[_])}):Object.getOwnPropertyDescriptors?Object.defineProperties(h,Object.getOwnPropertyDescriptors(g)):Jg(Object(g)).forEach(function(_){Object.defineProperty(h,_,Object.getOwnPropertyDescriptor(g,_))})}return h}function Ia(h){return(Ia=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i})(h)}function Zq(h,i,g,_,j,$,_n){try{var _i=h[$](_n),_s=_i.value}catch(ga){return void g(ga)}_i.done?i(_s):Promise.resolve(_s).then(_,j)}function za(h){return function(){var i=this,g=arguments;return new Promise(function(_,j){function $(_s){Zq(_i,_,j,$,_n,"next",_s)}function _n(_s){Zq(_i,_,j,$,_n,"throw",_s)}var _i=h.apply(i,g);$(void 0)})}}function ab(h,i){if(!(h instanceof i))throw new TypeError("Cannot call a class as a function")}function $q(h,i){for(var g=0;g<i.length;g++){var _=i[g];_.enumerable=_.enumerable||!1,_.configurable=!0,"value"in _&&(_.writable=!0),Object.defineProperty(h,_.key,_)}}function Qb(h,i,g){return i&&$q(h.prototype,i),g&&$q(h,g),h}function E(h,i,g){return i in h?Object.defineProperty(h,i,{value:g,enumerable:!0,configurable:!0,writable:!0}):h[i]=g,h}function nb(h,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");h.prototype=Object.create(i&&i.prototype,{constructor:{value:h,writable:!0,configurable:!0}}),i&&ci(h,i)}function Tf(h){return(Tf=Object.setPrototypeOf?Object.getPrototypeOf:function(i){return i.__proto__||Object.getPrototypeOf(i)})(h)}function ci(h,i){return(ci=Object.setPrototypeOf||function(g,_){return g.__proto__=_,g})(h,i)}function ar(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function dm(h,i,g){return(dm=ar()?Reflect.construct:function(_,j,$){var _n=[null];return _n.push.apply(_n,j),_=new(Function.bind.apply(_,_n)),$&&ci(_,$.prototype),_}).apply(null,arguments)}function di(h){var i=typeof Map=="function"?new Map:void 0;return(di=function(g){function _(){return dm(g,arguments,Tf(this).constructor)}if(g===null||Function.toString.call(g).indexOf("[native code]")===-1)return g;if(typeof g!="function")throw new TypeError("Super expression must either be null or a function");if(i!==void 0){if(i.has(g))return i.get(g);i.set(g,_)}return _.prototype=Object.create(g.prototype,{constructor:{value:_,enumerable:!1,writable:!0,configurable:!0}}),ci(_,g)})(h)}function em(h,i){if(h==null)return{};if(h==null)var g={};else{g={};var _,j=Object.keys(h);for(_=0;_<j.length;_++){var $=j[_];0<=i.indexOf($)||(g[$]=h[$])}}if(Object.getOwnPropertySymbols)for(_=Object.getOwnPropertySymbols(h),$=0;$<_.length;$++)j=_[$],0<=i.indexOf(j)||Object.prototype.propertyIsEnumerable.call(h,j)&&(g[j]=h[j]);return g}function L(h){if(h===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return h}function ob(h){var i=ar();return function(){var g=Tf(h);if(i){var _=Tf(this).constructor;g=Reflect.construct(g,arguments,_)}else g=g.apply(this,arguments);return g=!g||typeof g!="object"&&typeof g!="function"?L(this):g}}function fm(h,i,g){return(fm=typeof Reflect<"u"&&Reflect.get?Reflect.get:function(_,j,$){for(;!Object.prototype.hasOwnProperty.call(_,j)&&(_=Tf(_))!==null;);if(_)return(j=Object.getOwnPropertyDescriptor(_,j)).get?j.get.call($):j.value})(h,i,g||h)}function Lb(h,i){var g=Array.isArray(h)?h:void 0;if(!g)if((g=h&&(typeof Symbol<"u"&&h[Symbol.iterator]||h["@@iterator"]))==null)g=void 0;else{var _,j=[],$=!0,_n=!1;try{for(g=g.call(h);!($=(_=g.next()).done)&&(j.push(_.value),!i||j.length!==i);$=!0);}catch(_s){_n=!0;var _i=_s}finally{try{$||g.return==null||g.return()}finally{if(_n)throw _i}}g=j}if(!(h=g||br(h,i)))throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`);return h}function ra(h){var i=Array.isArray(h)?gm(h):void 0;if(i||(i=typeof Symbol<"u"&&h[Symbol.iterator]!=null||h["@@iterator"]!=null?Array.from(h):void 0),!(h=i||br(h)))throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`);return h}function br(h,i){if(h){if(typeof h=="string")return gm(h,i);var g=Object.prototype.toString.call(h).slice(8,-1);if(g==="Object"&&h.constructor&&(g=h.constructor.name),g==="Map"||g==="Set")return Array.from(h);if(g==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(g))return gm(h,i)}}function gm(h,i){(i==null||i>h.length)&&(i=h.length);for(var g=0,_=Array(i);g<i;g++)_[g]=h[g];return _}function Na(h,i,g,_,j){var $={};return Object.keys(_).forEach(function(_n){$[_n]=_[_n]}),$.enumerable=!!$.enumerable,$.configurable=!!$.configurable,("value"in $||$.initializer)&&($.writable=!0),$=g.slice().reverse().reduce(function(_n,_i){return _i(h,i,_n)||_n},$),j&&$.initializer!==void 0&&($.value=$.initializer?$.initializer.call(j):void 0,$.initializer=void 0),$.initializer===void 0&&(Object.defineProperty(h,i,$),$=null),$}function kc(h){var i={exports:{}};return h(i,i.exports),i.exports}function Kg(h){h||(h={});var i=h.ua;if(i||typeof navigator>"u"||(i=navigator.userAgent),i&&i.headers&&typeof i.headers["user-agent"]=="string"&&(i=i.headers["user-agent"]),typeof i!="string")return!1;var g=JA.test(i)&&!KA.test(i)||!!h.tablet&&LA.test(i);return!g&&h.tablet&&h.featureDetect&&navigator&&1<navigator.maxTouchPoints&&i.indexOf("Macintosh")!==-1&&i.indexOf("Safari")!==-1&&(g=!0),g}function cr(h,i){var g,_=3>arguments.length?h:arguments[2];return ub(h)===_?h[i]:(g=pd.f(h,i))?Fa(g,"value")?g.value:g.get===void 0?void 0:g.get.call(_):fb(g=Md(h))?cr(g,i,_):void 0}function MA(h){var i=h.charCodeAt(0)<<24,g=0|NA(~i),_=0,j=0|h.length,$="";if(5>g&&j>=g){for(i=i<<g>>>24+g,_=1;_<g;_=_+1|0)i=i<<6|63&h.charCodeAt(_);65535>=i?$+=Uf(i):1114111>=i?$+=Uf(55296+((i=i-65536|0)>>10)|0,56320+(1023&i)|0):_=0}for(;_<j;_=_+1|0)$+="�";return $}function dr(){}function OA(h){var i=0|h.charCodeAt(0);if(55296<=i&&56319>=i){var g=0|h.charCodeAt(1);if(!(g==g&&56320<=g&&57343>=g))return Uf(239,191,189);if(65535<(i=(i-55296<<10)+g-56320+65536|0))return Uf(240|i>>>18,128|i>>>12&63,128|i>>>6&63,128|63&i)}return 127>=i?h:2047>=i?Uf(192|i>>>6,128|63&i):Uf(224|i>>>12,128|i>>>6&63,128|63&i)}function er(){}function kb(){kb.init.call(this)}function Cj(h){if(typeof h!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+Ia(h))}function fr(h,i,g,_){Cj(g);var j=h._events;if(j===void 0)j=h._events=Object.create(null),h._eventsCount=0;else{j.newListener!==void 0&&(h.emit("newListener",i,g.listener?g.listener:g),j=h._events);var $=j[i]}return $===void 0?(j[i]=g,++h._eventsCount):(typeof $=="function"?$=j[i]=_?[g,$]:[$,g]:_?$.unshift(g):$.push(g),0<(g=h._maxListeners===void 0?kb.defaultMaxListeners:h._maxListeners)&&$.length>g&&!$.warned&&($.warned=!0,(g=Error("Possible EventEmitter memory leak detected. "+$.length+" "+String(i)+" listeners added. Use emitter.setMaxListeners() to increase limit")).name="MaxListenersExceededWarning",g.emitter=h,g.type=i,g.count=$.length,console&&console.warn&&console.warn(g))),h}function PA(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function gr(h,i,g){return h={fired:!1,wrapFn:void 0,target:h,type:i,listener:g},(i=PA.bind(h)).listener=g,h.wrapFn=i}function hr(h,i,g){if((h=h._events)===void 0)return[];if((i=h[i])===void 0)return[];if(typeof i=="function")return g?[i.listener||i]:[i];if(g)for(g=Array(i.length),h=0;h<g.length;++h)g[h]=i[h].listener||i[h];else g=ir(i,i.length);return g}function jr(h){var i=this._events;if(i!==void 0){if(typeof(h=i[h])=="function")return 1;if(h!==void 0)return h.length}return 0}function ir(h,i){for(var g=Array(i),_=0;_<i;++_)g[_]=h[_];return g}function QA(h,i,g){typeof h.on=="function"&&kr(h,"error",i,g)}function kr(h,i,g,_){if(typeof h.on=="function")_.once?h.once(i,g):h.on(i,g);else{if(typeof h.addEventListener!="function")throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+Ia(h));h.addEventListener(i,function j($){_.once&&h.removeEventListener(i,j),g($)})}}function RA(h){return h?ra(h):SA(function(){return[]},function(i,g){return i.push(g),i})}function lr(h,i){var g,_,j,$;return W.wrap(function(_n){for(;;)switch(_n.prev=_n.next){case 0:g=mr(h)([nr,nr,function(_i,_s){return _s}])[2],_=0;case 2:if(!(_<i.length)){_n.next=17;break}if(j=i[_],!(($=g(hm,j))instanceof Dj)){_n.next=11;break}if(($=im($.deref()))===hm){_n.next=10;break}return _n.next=10,$;case 10:return _n.abrupt("return");case 11:if($===hm){_n.next=14;break}return _n.next=14,$;case 14:_++,_n.next=2;break;case 17:case"end":return _n.stop()}},TA)}function Ej(h,i){return i!=null&&typeof i[Symbol.iterator]=="function"?lr(Ej(h),i):function(g){var _=g[2];return UA(g,function(j,$){return _(j,h($))})}}function Be(h){return Object.prototype.toString.call(h).slice(8,-1)}function Lg(h){return Be(h)==="Object"&&h.constructor===Object&&Object.getPrototypeOf(h)===Object.prototype}function or(h){var i;return(i=Be(h)==="Boolean"||Be(h)==="Null"||Be(h)==="Undefined")||(i=Be(h)==="Number"&&!isNaN(h)),i||Be(h)==="String"||Be(h)==="Symbol"}function Vf(h){var i=-1,g=h==null?0:h.length;for(this.clear();++i<g;){var _=h[i];this.set(_[0],_[1])}}function Mg(h){var i=-1,g=h==null?0:h.length;for(this.clear();++i<g;){var _=h[i];this.set(_[0],_[1])}}function Ng(h){var i=-1,g=h==null?0:h.length;for(this.clear();++i<g;){var _=h[i];this.set(_[0],_[1])}}function ei(h){var i=-1,g=h==null?0:h.length;for(this.__data__=new Fj;++i<g;)this.add(h[i])}function Og(h){this.size=(this.__data__=new Gj(h)).size}function Pg(h,i,g,_,j,$){var _n,_i=1&i,_s=2&i,ga=4&i;if(g&&(_n=j?g(h,_,j,$):g(h)),_n!==void 0)return _n;if(!Kc(h))return h;if(_=lc(h)){if(_n=VA(h),!_i)return jm(h,_n)}else{var ba=fi(h),xa=ba=="[object Function]"||ba=="[object GeneratorFunction]";if(gi(h))return pr(h,_i);if(ba=="[object Object]"||ba=="[object Arguments]"||xa&&!j){if(_n=_s||xa?{}:qr(h),!_i)return _s?WA(h,XA(_n,h)):YA(h,ZA(_n,h))}else{if(!zb[ba])return j?h:{};_n=$A(h,ba,_i)}}if($||($=new Qg),j=$.get(h))return j;$.set(h,_n),aB(h)?h.forEach(function(Tl){_n.add(Pg(Tl,i,g,Tl,h,$))}):bB(h)&&h.forEach(function(Tl,Sl){_n.set(Sl,Pg(Tl,i,g,Sl,h,$))}),_s=ga?_s?rr:km:_s?hi:Wf;var El=_?void 0:_s(h);return cB(El||h,function(Tl,Sl){El&&(Tl=h[Sl=Tl]),sr(_n,Sl,Pg(Tl,i,g,Sl,h,$))}),_n}function lm(h,i){if(typeof h!="function"||i!=null&&typeof i!="function")throw new TypeError("Expected a function");var g=function _(){var j=arguments,$=i?i.apply(this,j):j[0],_n=_.cache;return _n.has($)?_n.get($):(j=h.apply(this,j),_.cache=_n.set($,j)||_n,j)};return g.cache=new(lm.Cache||Fj),g}function tr(h){if(typeof h=="string")return h;if(lc(h))return Rg(h,tr)+"";if(Sg(h))return ur?ur.call(h):"";var i=h+"";return i=="0"&&1/h==-dB?"-0":i}function mm(h,i,g,_,j){var $=-1,_n=h.length;for(g||(g=eB),j||(j=[]);++$<_n;){var _i=h[$];0<i&&g(_i)?1<i?mm(_i,i-1,g,_,j):nm(j,_i):_||(j[j.length]=_i)}return j}function Tg(h,i,g,_,j){if(h===i)i=!0;else if(h==null||i==null||!ee(h)&&!ee(i))i=h!=h&&i!=i;else e:{var $=lc(h),_n=lc(i),_i=$?"[object Array]":fi(h),_s=_n?"[object Array]":fi(i),ga=(_i=_i=="[object Arguments]"?"[object Object]":_i)=="[object Object]";if(_n=(_s=_s=="[object Arguments]"?"[object Object]":_s)=="[object Object]",(_s=_i==_s)&&gi(h)){if(!gi(i)){i=!1;break e}$=!0,ga=!1}if(_s&&!ga)j||(j=new Qg),i=$||om(h)?vr(h,i,g,_,Tg,j):fB(h,i,_i,g,_,Tg,j);else{if(!(1&g)&&($=ga&&wr.call(h,"__wrapped__"),_i=_n&&wr.call(i,"__wrapped__"),$||_i)){h=$?h.value():h,i=_i?i.value():i,j||(j=new Qg),i=Tg(h,i,g,_,j);break e}if(_s)t:if(j||(j=new Qg),$=1&g,_i=km(h),_n=_i.length,_s=km(i).length,_n==_s||$){for(_s=_n;_s--;){var ba=_i[_s];if(!($?ba in i:gB.call(i,ba))){i=!1;break t}}if(ga=j.get(h),ba=j.get(i),ga&&ba)i=ga==i&&ba==h;else{ga=!0,j.set(h,i),j.set(i,h);for(var xa=$;++_s<_n;){var El=h[ba=_i[_s]],Tl=i[ba];if(_)var Sl=$?_(Tl,El,ba,i,h,j):_(El,Tl,ba,h,i,j);if(Sl===void 0?El!==Tl&&!Tg(El,Tl,g,_,j):!Sl){ga=!1;break}xa||(xa=ba=="constructor")}ga&&!xa&&(g=h.constructor)!=(_=i.constructor)&&"constructor"in h&&"constructor"in i&&!(typeof g=="function"&&g instanceof g&&typeof _=="function"&&_ instanceof _)&&(ga=!1),j.delete(h),j.delete(i),i=ga}}else i=!1;else i=!1}}return i}function Ab(h,i,g){this.low=0|h,this.high=0|i,this.unsigned=!!g}function Lc(h){return(h&&h.__isLong__)===!0}function Xf(h,i){var g;if(i){if((i=0<=(h>>>=0)&&256>h)&&(g=xr[h]))return g;g=Bb(h,0>(0|h)?-1:0,!0),i&&(xr[h]=g)}else{if((i=-128<=(h|=0)&&128>h)&&(g=yr[h]))return g;g=Bb(h,0>h?-1:0,!1),i&&(yr[h]=g)}return g}function qd(h,i){if(isNaN(h))return i?Yf:rd;if(i){if(0>h)return Yf;if(h>=zr)return Ar}else{if(h<=-Br)return Mc;if(h+1>=Br)return Cr}return 0>h?qd(-h,i).neg():Bb(h%Ug|0,h/Ug|0,i)}function Bb(h,i,g){return new Ab(h,i,g)}function pm(h,i,g){if(h.length===0)throw Error("empty string");if(h==="NaN"||h==="Infinity"||h==="+Infinity"||h==="-Infinity")return rd;if(typeof i=="number"?(g=i,i=!1):i=!!i,2>(g=g||10)||36<g)throw RangeError("radix");var _;if(0<(_=h.indexOf("-")))throw Error("interior hyphen");if(_===0)return pm(h.substring(1),i,g).neg();_=qd(Hj(g,8));for(var j=rd,$=0;$<h.length;$+=8){var _n=Math.min(8,h.length-$),_i=parseInt(h.substring($,$+_n),g);8>_n?(_n=qd(Hj(g,_n)),j=j.mul(_n).add(qd(_i))):j=(j=j.mul(_)).add(qd(_i))}return j.unsigned=i,j}function Nd(h,i){return typeof h=="number"?qd(h,i):typeof h=="string"?pm(h,i):Bb(h.low,h.high,typeof i=="boolean"?i:h.unsigned)}function Ca(h,i){function g(){this.constructor=h}qm(h,i),h.prototype=i===null?Object.create(i):(g.prototype=i.prototype,new g)}function Vg(h){return typeof h=="function"}function Wg(h){setTimeout(function(){throw h},0)}function rm(h){return h!==null&&Ia(h)==="object"}function Dr(h){return h.reduce(function(i,g){return i.concat(g instanceof ii?g.errors:g)},[])}function sm(h){for(;h;){var i=h.destination,g=h.isStopped;if(h.closed||g)return!1;h=i&&i instanceof hb?i:null}return!0}function jf(h){return h}function tm(){for(var h=[],i=0;i<arguments.length;i++)h[i]=arguments[i];return Er(h)}function Er(h){return h.length===0?jf:h.length===1?h[0]:function(i){return h.reduce(function(g,_){return _(g)},i)}}function Fr(h){if(h||(h=sd.Promise||Promise),!h)throw Error("no Promise impl found");return h}function Gr(){return function(h){return h.lift(new hB(h))}}function ji(h){return h?iB(h):$c}function iB(h){return new Za(function(i){return h.schedule(function(){return i.complete()})})}function Ce(h){return h&&typeof h.schedule=="function"}function um(h,i){return new Za(function(g){var _=new dc,j=0;return _.add(i.schedule(function(){j===h.length?g.complete():(g.next(h[j++]),g.closed||_.add(this.schedule()))})),_})}function ki(h,i){return i?um(h,i):new Za(Hr(h))}function Wb(){for(var h=[],i=0;i<arguments.length;i++)h[i]=arguments[i];return Ce(i=h[h.length-1])?(h.pop(),um(h,i)):ki(h)}function Va(h,i){return new Za(i?function(g){return i.schedule(jB,0,{error:h,subscriber:g})}:function(g){return g.error(h)})}function jB(h){h.subscriber.error(h.error)}function kB(h,i){return i===void 0&&(i=0),function(g){return g.lift(new lB(h,i))}}function Ir(h){return h in vm&&(delete vm[h],!0)}function fe(){}function Wa(h,i){return function(g){if(typeof h!="function")throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return g.lift(new mB(h,i))}}function Jr(h,i,g){if(i){if(!Ce(i))return function(){for(var _=[],j=0;j<arguments.length;j++)_[j]=arguments[j];return Jr(h,g).apply(void 0,_).pipe(Wa(function($){return td($)?i.apply(void 0,$):i($)}))};g=i}return function(){for(var _=[],j=0;j<arguments.length;j++)_[j]=arguments[j];var $,_n=this,_i={context:_n,subject:$,callbackFunc:h,scheduler:g};return new Za(function(_s){if(g)return g.schedule(nB,0,{args:_,subscriber:_s,params:_i});if(!$){$=new li;try{h.apply(_n,_.concat([function(){for(var ga=[],ba=0;ba<arguments.length;ba++)ga[ba]=arguments[ba];$.next(1>=ga.length?ga[0]:ga),$.complete()}]))}catch(ga){sm($)?$.error(ga):console.warn(ga)}}return $.subscribe(_s)})}}function nB(h){var i=this,g=h.args,_=h.subscriber,j=h.params;h=j.callbackFunc;var $=j.context,_n=j.scheduler,_i=j.subject;if(!_i){_i=j.subject=new li,j=function(){for(var _s=[],ga=0;ga<arguments.length;ga++)_s[ga]=arguments[ga];i.add(_n.schedule(oB,0,{value:1>=_s.length?_s[0]:_s,subject:_i}))};try{h.apply($,g.concat([j]))}catch(_s){_i.error(_s)}}this.add(_i.subscribe(_))}function oB(h){var i=h.subject;i.next(h.value),i.complete()}function Kr(h,i,g){if(i){if(!Ce(i))return function(){for(var _=[],j=0;j<arguments.length;j++)_[j]=arguments[j];return Kr(h,g).apply(void 0,_).pipe(Wa(function($){return td($)?i.apply(void 0,$):i($)}))};g=i}return function(){for(var _=[],j=0;j<arguments.length;j++)_[j]=arguments[j];var $={subject:void 0,args:_,callbackFunc:h,scheduler:g,context:this};return new Za(function(_n){var _i=$.context,_s=$.subject;if(g)return g.schedule(pB,0,{params:$,subscriber:_n,context:_i});if(!_s){_s=$.subject=new li;try{h.apply(_i,_.concat([function(){for(var ga=[],ba=0;ba<arguments.length;ba++)ga[ba]=arguments[ba];(ba=ga.shift())?_s.error(ba):(_s.next(1>=ga.length?ga[0]:ga),_s.complete())}]))}catch(ga){sm(_s)?_s.error(ga):console.warn(ga)}}return _s.subscribe(_n)})}}function pB(h){var i=this,g=h.params,_=h.subscriber;h=h.context;var j=g.callbackFunc,$=g.args,_n=g.scheduler,_i=g.subject;if(!_i){_i=g.subject=new li,g=function(){for(var _s=[],ga=0;ga<arguments.length;ga++)_s[ga]=arguments[ga];(ga=_s.shift())?i.add(_n.schedule(Lr,0,{err:ga,subject:_i})):i.add(_n.schedule(qB,0,{value:1>=_s.length?_s[0]:_s,subject:_i}))};try{j.apply(h,$.concat([g]))}catch(_s){this.add(_n.schedule(Lr,0,{err:_s,subject:_i}))}}this.add(_i.subscribe(_))}function qB(h){var i=h.subject;i.next(h.value),i.complete()}function Lr(h){h.subject.error(h.err)}function Mr(h){return!!h&&typeof h.subscribe!="function"&&typeof h.then=="function"}function wm(h,i,g,_,j){if(j===void 0&&(j=new rB(h,g,_)),!j.closed)return i instanceof Za?i.subscribe(j):mi(i)(j)}function sB(h,i){return new Za(function(g){var _=new dc;return _.add(i.schedule(function(){var j=h[Xg]();_.add(j.subscribe({next:function($){_.add(i.schedule(function(){return g.next($)}))},error:function($){_.add(i.schedule(function(){return g.error($)}))},complete:function(){_.add(i.schedule(function(){return g.complete()}))}}))})),_})}function tB(h,i){return new Za(function(g){var _=new dc;return _.add(i.schedule(function(){return h.then(function(j){_.add(i.schedule(function(){g.next(j),_.add(i.schedule(function(){return g.complete()}))}))},function(j){_.add(i.schedule(function(){return g.error(j)}))})})),_})}function uB(h,i){if(!h)throw Error("Iterable cannot be null");return new Za(function(g){var _,j=new dc;return j.add(function(){_&&typeof _.return=="function"&&_.return()}),j.add(i.schedule(function(){_=h[kf](),j.add(i.schedule(function(){if(!g.closed){try{var $=_.next(),_n=$.value,_i=$.done}catch(_s){return void g.error(_s)}_i?g.complete():(g.next(_n),this.schedule())}}))})),j})}function Nr(h,i){if(h!=null){if(h&&typeof h[Xg]=="function")return sB(h,i);if(Mr(h))return tB(h,i);if(Or(h))return um(h,i);if(h&&typeof h[kf]=="function"||typeof h=="string")return uB(h,i)}throw new TypeError((h!==null&&Ia(h)||h)+" is not observable")}function ge(h,i){return i?Nr(h,i):h instanceof Za?h:new Za(mi(h))}function De(h,i){if(!i.closed){if(h instanceof Za)return h.subscribe(i);try{var g=mi(h)(i)}catch(_){i.error(_)}return g}}function Ac(h,i,g){return g===void 0&&(g=Number.POSITIVE_INFINITY),typeof i=="function"?function(_){return _.pipe(Ac(function(j,$){return ge(h(j,$)).pipe(Wa(function(_n,_i){return i(j,_n,$,_i)}))},g))}:(typeof i=="number"&&(g=i),function(_){return _.lift(new vB(h,g))})}function Ij(h){return h===void 0&&(h=Number.POSITIVE_INFINITY),Ac(jf,h)}function Pr(){for(var h=[],i=0;i<arguments.length;i++)h[i]=arguments[i];return Ij(1)(Wb.apply(void 0,h))}function lf(h){return new Za(function(i){try{var g=h()}catch(_){return void i.error(_)}return(g?ge(g):ji()).subscribe(i)})}function Jj(h,i){return new Za(function(g){var _=h.length;if(_===0)g.complete();else for(var j=Array(_),$=0,_n=0,_i=function(ga){var ba=ge(h[ga]),xa=!1;g.add(ba.subscribe({next:function(El){xa||(xa=!0,_n++),j[ga]=El},error:function(El){return g.error(El)},complete:function(){++$!==_&&xa||(_n===_&&g.next(i?i.reduce(function(El,Tl,Sl){return El[Tl]=j[Sl],El},{}):j),g.complete())}}))},_s=0;_s<_;_s++)_i(_s)})}function Bc(h,i,g,_){return Vg(g)&&(_=g,g=void 0),_?Bc(h,i,g).pipe(Wa(function(j){return td(j)?_.apply(void 0,j):_(j)})):new Za(function(j){Qr(h,i,function($){1<arguments.length?j.next(Array.prototype.slice.call(arguments)):j.next($)},j,g)})}function Qr(h,i,g,_,j){if(h&&typeof h.addEventListener=="function"&&typeof h.removeEventListener=="function"){h.addEventListener(i,g,j);var $=function(){return h.removeEventListener(i,g,j)}}else if(h&&typeof h.on=="function"&&typeof h.off=="function")h.on(i,g),$=function(){return h.off(i,g)};else if(h&&typeof h.addListener=="function"&&typeof h.removeListener=="function")h.addListener(i,g),$=function(){return h.removeListener(i,g)};else{if(!h||!h.length)throw new TypeError("Invalid event target");for(var _n=0,_i=h.length;_n<_i;_n++)Qr(h[_n],i,g,_,j)}_.add($)}function Rr(h,i,g){return g?Rr(h,i).pipe(Wa(function(_){return td(_)?g.apply(void 0,_):g(_)})):new Za(function(_){var j=function(){for(var _n=[],_i=0;_i<arguments.length;_i++)_n[_i]=arguments[_i];return _.next(_n.length===1?_n[0]:_n)};try{var $=h(j)}catch(_n){return void _.error(_n)}if(Vg(i))return function(){return i(j,$)}})}function wB(h){var i=h.subscriber,g=h.condition;if(!i.closed){if(h.needIterate)try{h.state=h.iterate(h.state)}catch($){return void i.error($)}else h.needIterate=!0;if(g){var _=void 0;try{_=g(h.state)}catch($){return void i.error($)}if(!_)return void i.complete();if(i.closed)return}try{var j=h.resultSelector(h.state)}catch($){return void i.error($)}if(!i.closed&&(i.next(j),!i.closed))return this.schedule(h)}}function xm(h){return!td(h)&&0<=h-parseFloat(h)+1}function Yg(h,i){return h===void 0&&(h=0),i===void 0&&(i=Ee),(!xm(h)||0>h)&&(h=0),i&&typeof i.schedule=="function"||(i=Ee),new Za(function(g){return g.add(i.schedule(xB,h,{subscriber:g,counter:0,period:h})),g})}function xB(h){var i=h.subscriber,g=h.counter;h=h.period,i.next(g),this.schedule({subscriber:i,counter:g+1,period:h},h)}function Nc(){for(var h=[],i=0;i<arguments.length;i++)h[i]=arguments[i];i=Number.POSITIVE_INFINITY;var g=null,_=h[h.length-1];return Ce(_)?(g=h.pop(),1<h.length&&typeof h[h.length-1]=="number"&&(i=h.pop())):typeof _=="number"&&(i=h.pop()),g===null&&h.length===1&&h[0]instanceof Za?h[0]:Ij(i)(ki(h,g))}function ym(){for(var h=[],i=0;i<arguments.length;i++)h[i]=arguments[i];if(h.length===0)return $c;var g=h[0],_=h.slice(1);return h.length===1&&td(g)?ym.apply(void 0,g):new Za(function(j){var $=function(){return j.add(ym.apply(void 0,_).subscribe(j))};return ge(g).subscribe({next:function(_n){j.next(_n)},error:$,complete:$})})}function yB(h){var i=h.keys,g=h.index,_=h.subscriber,j=h.subscription;if(h=h.obj,!_.closed)if(g<i.length){var $=i[g];_.next([$,h[$]]),j.add(this.schedule({keys:i,index:g+1,subscriber:_,subscription:j,obj:h}))}else _.complete()}function zB(h,i){function g(){return!g.pred.apply(g.thisArg,arguments)}return g.pred=h,g.thisArg=i,g}function sc(h,i){return function(g){return g.lift(new AB(h,i))}}function bb(){for(var h=[],i=0;i<arguments.length;i++)h[i]=arguments[i];if(h.length===1){if(!td(h[0]))return h[0];h=h[0]}return ki(h,void 0).lift(new BB)}function CB(h){var i=h.start,g=h.index,_=h.subscriber;g>=h.count?_.complete():(_.next(i),_.closed||(h.index=g+1,h.start=i+1,this.schedule(h)))}function Fe(h,i,g){h===void 0&&(h=0);var _=-1;return xm(i)?_=1>Number(i)?1:Number(i):Ce(i)&&(g=i),Ce(g)||(g=Ee),new Za(function(j){var $=xm(h)?h:+h-g.now();return g.schedule(DB,$,{index:0,period:_,subscriber:j})})}function DB(h){var i=h.index,g=h.period,_=h.subscriber;if(_.next(i),!_.closed){if(g===-1)return _.complete();h.index=i+1,this.schedule(h,g)}}function zm(){for(var h=[],i=0;i<arguments.length;i++)h[i]=arguments[i];return typeof(i=h[h.length-1])=="function"&&h.pop(),ki(h,void 0).lift(new EB(i))}function Kj(h){var i=arguments.length,g=Ee;Ce(arguments[arguments.length-1])&&(g=arguments[arguments.length-1],i--);var _=null;2<=i&&(_=arguments[1]);var j=Number.POSITIVE_INFINITY;return 3<=i&&(j=arguments[2]),function($){return $.lift(new FB(h,_,j,g))}}function Sr(h){var i=h.subscriber,g=h.context;g&&i.closeContext(g),i.closed||(h.context=i.openContext(),h.context.closeAction=this.schedule(h,h.bufferTimeSpan))}function GB(h){var i=h.bufferCreationInterval,g=h.bufferTimeSpan,_=h.subscriber,j=h.scheduler,$=_.openContext();_.closed||(_.add($.closeAction=j.schedule(Tr,g,{subscriber:_,context:$})),this.schedule(h,i))}function Tr(h){h.subscriber.closeContext(h.context)}function Rb(h){return function(i){var g=new HB(h);return i=i.lift(g),g.caught=i}}function Am(h,i){return Ac(h,i,1)}function Ur(h){return h===void 0&&(h=null),function(i){return i.lift(new IB(h))}}function mf(h,i){i===void 0&&(i=Ee);var g=h instanceof Date&&!isNaN(+h)?+h-i.now():Math.abs(h);return function(_){return _.lift(new JB(g,i))}}function Vr(h,i){return function(g){return g.lift(new KB(h,i))}}function Zf(h){return h===void 0&&(h=LB),function(i){return i.lift(new MB(h))}}function LB(){return new Lj}function Xb(h){return function(i){return h===0?ji():i.lift(new NB(h))}}function Mj(h){return function(i){return i.lift(new OB(h))}}function La(h,i){var g=2<=arguments.length;return function(_){return _.pipe(h?sc(function(j,$){return h(j,$,_)}):jf,Xb(1),g?Ur(i):Zf(function(){return new Lj}))}}function PB(){return function(h){return h.lift(new QB)}}function Wr(h){return function(i){return h===0?ji():i.lift(new RB(h))}}function ni(h){return function(i){return i.lift(new SB(h))}}function Nj(h,i){var g=!1;return 2<=arguments.length&&(g=!0),function(_){return _.lift(new TB(h,i,g))}}function Xr(h,i){return 2<=arguments.length?function(g){return tm(Nj(h,i),Wr(1),Ur(i))(g)}:function(g){return tm(Nj(function(_,j,$){return h(_,j,$+1)}),Wr(1))(g)}}function UB(h,i){return function(g){var _=typeof h=="function"?h:function(){return h};if(typeof i=="function")return g.lift(new VB(_,i));var j=Object.create(g,WB);return j.source=g,j.subjectFactory=_,j}}function Zg(h){return function(i){return i.lift(new XB(h,i))}}function YB(){return new ec}function $g(){return function(h){return Gr()(UB(YB)(h))}}function Yr(h,i,g){var _=h&&Ia(h)==="object"?h:{bufferSize:h,windowTime:i,refCount:!1,scheduler:g};return function(j){return j.lift(ZB(_))}}function ZB(h){var i,g,_=h.bufferSize,j=_===void 0?Number.POSITIVE_INFINITY:_,$=(_=h.windowTime)===void 0?Number.POSITIVE_INFINITY:_,_n=h.refCount,_i=h.scheduler,_s=0,ga=!1,ba=!1;return function(xa){if(_s++,!i||ga){ga=!1;var El=(i=new ah(j,$,_i)).subscribe(this);g=xa.subscribe({next:function(Tl){i.next(Tl)},error:function(Tl){ga=!0,i.error(Tl)},complete:function(){ba=!0,g=void 0,i.complete()}}),ba&&(g=void 0)}else El=i.subscribe(this);this.add(function(){_s--,El.unsubscribe(),El=void 0,g&&!ba&&_n&&_s===0&&(g.unsubscribe(),i=g=void 0)})}}function Cc(h,i){return typeof i=="function"?function(g){return g.pipe(Cc(function(_,j){return ge(h(_,j)).pipe(Wa(function($,_n){return i(_,$,j,_n)}))}))}:function(g){return g.lift(new $B(h))}}function he(h){return function(i){return i.lift(new aC(h))}}function Ka(h,i,g){return function(_){return _.lift(new bC(h,i,g))}}function cC(h,i,g){return i===void 0&&(i=Ee),g===void 0&&(g=dC),function(_){return _.lift(new eC(h,i,g.leading,g.trailing))}}function fC(h){h.subscriber.clearThrottle()}function gC(h,i,g){return g===void 0&&(g=Ee),function(_){var j=h instanceof Date&&!isNaN(+h),$=j?+h-g.now():Math.abs(h);return _.lift(new hC($,j,i,g))}}function Oc(h,i){return i===void 0&&(i=Ee),gC(h,Va(new ad),i)}function iC(){for(var h=[],i=0;i<arguments.length;i++)h[i]=arguments[i];return function(g){var _;return typeof h[h.length-1]=="function"&&(_=h.pop()),g.lift(new jC(h,_))}}function Zr(h){(Bm||h)&&($r.abort(),h&&($r=new AbortController),Bm=h)}function as(h,i,g,_,j){h!==i&&bs(i,function($,_n){if(j||(j=new Qg),Kc($)){$=j;var _i=Cm(h,_n),_s=Cm(i,_n),ga=$.get(_s);if(ga)Dm(h,_n,ga);else{var ba=(ga=_?_(_i,_s,_n+"",h,i,$):void 0)===void 0;if(ba){var xa=lc(_s),El=!xa&&gi(_s),Tl=!xa&&!El&&om(_s);ga=_s,xa||El||Tl?lc(_i)?ga=_i:ee(_i)&&$f(_i)?ga=jm(_i):El?(ba=!1,ga=pr(_s,!0)):Tl?(ba=!1,ga=cs(_s,!0)):ga=[]:ds(_s)||oi(_s)?(ga=_i,oi(_i)?ga=bh(_i,hi(_i)):Kc(_i)&&!Em(_i)||(ga=qr(_s))):ba=!1}ba&&($.set(_s,ga),as(ga,_s,g,_,$),$.delete(_s)),Dm(h,_n,ga)}}else(_i=_?_(Cm(h,_n),$,_n+"",h,i,j):void 0)===void 0&&(_i=$),Dm(h,_n,_i)},hi)}function kC(h){var i=1,g=Fm;(1>=arguments.length?0:arguments.length-1)==1?typeof(1>=arguments.length?void 0:arguments[1])=="number"?i=1>=arguments.length?void 0:arguments[1]:g=1>=arguments.length?void 0:arguments[1]:(1>=arguments.length?0:arguments.length-1)==2&&(i=1>=arguments.length?void 0:arguments[1],g=2>=arguments.length?void 0:arguments[2]);var _=i||1;return function(j){return j.pipe(Nj(function($,_n){var _i=g.now(),_s=_i-h;if(($=$.filter(function(xa){return xa.until>_s})).length>=_){var ga=$[$.length-1],ba=$[0].until+h*Math.floor($.length/_);$.push({delay:ga.until<_i?ba-_i:ba-ga.until,until:ba,value:_n})}else $.push({delay:0,until:_i,value:_n});return $},[]),Wa(function($){return $[$.length-1]}),Am(function($){var _n=Wb($.value);return $.delay?_n.pipe(mf($.delay,g)):_n}))}}function lC(h,i){var g=(i=i===void 0?{protocols:es,makeWebSocket:fs}:i).protocols,_=g===void 0?es:g,j=(i=i.makeWebSocket)===void 0?fs:i;return new Za(function($){var _n,_i=new ec,_s=j(h,_),ga=!1,ba=!1,xa=!1,El=function(Tl){if(_n)throw ga=!0,Tl=Error("Web socket message factory function called more than once"),$.error(Tl),Tl;return _n=Tl.subscribe(function(Sl){_s.send(Sl)}),_i};return _s.onopen=function(){xa=!0,ba?(ga=!0,_s.close()):$.next(El)},_s.onmessage=function(Tl){_i.next(Tl.data)},_s.onerror=function(Tl){ga=!0,$.error(Error(Tl.message))},_s.onclose=function(Tl){ga||(ga=!0,ba?($.complete(),_i.complete()):$.error(Error(Tl.code===1e3?"Normal closure":Tl.reason)))},function(){ba=!0,_n&&_n.unsubscribe(),ga||(ga=!0,xa&&_s.close())}})}function Oj(){this._listeners={}}function gs(h){return typeof Float32Array<"u"?function(){function i(_s,ga,ba){$[0]=_s,ga[ba]=_n[0],ga[ba+1]=_n[1],ga[ba+2]=_n[2],ga[ba+3]=_n[3]}function g(_s,ga,ba){$[0]=_s,ga[ba]=_n[3],ga[ba+1]=_n[2],ga[ba+2]=_n[1],ga[ba+3]=_n[0]}function _(_s,ga){return _n[0]=_s[ga],_n[1]=_s[ga+1],_n[2]=_s[ga+2],_n[3]=_s[ga+3],$[0]}function j(_s,ga){return _n[3]=_s[ga],_n[2]=_s[ga+1],_n[1]=_s[ga+2],_n[0]=_s[ga+3],$[0]}var $=new Float32Array([-0]),_n=new Uint8Array($.buffer),_i=_n[3]===128;h.writeFloatLE=_i?i:g,h.writeFloatBE=_i?g:i,h.readFloatLE=_i?_:j,h.readFloatBE=_i?j:_}():function(){function i(_,j,$,_n){var _i=0>j?1:0;if(_i&&(j=-j),j===0)_(0<1/j?0:2147483648,$,_n);else if(isNaN(j))_(2143289344,$,_n);else if(34028234663852886e22<j)_((_i<<31|2139095040)>>>0,$,_n);else if(11754943508222875e-54>j)_((_i<<31|Math.round(j/1401298464324817e-60))>>>0,$,_n);else{var _s=Math.floor(Math.log(j)/Math.LN2);_((_i<<31|_s+127<<23|8388607&Math.round(j*Math.pow(2,-_s)*8388608))>>>0,$,_n)}}function g(_,j,$){return $=_(j,$),_=2*($>>31)+1,j=$>>>23&255,$&=8388607,j===255?$?NaN:1/0*_:j===0?1401298464324817e-60*_*$:_*Math.pow(2,j-150)*($+8388608)}h.writeFloatLE=i.bind(null,hs),h.writeFloatBE=i.bind(null,is),h.readFloatLE=g.bind(null,js),h.readFloatBE=g.bind(null,ks)}(),typeof Float64Array<"u"?function(){function i(_s,ga,ba){$[0]=_s,ga[ba]=_n[0],ga[ba+1]=_n[1],ga[ba+2]=_n[2],ga[ba+3]=_n[3],ga[ba+4]=_n[4],ga[ba+5]=_n[5],ga[ba+6]=_n[6],ga[ba+7]=_n[7]}function g(_s,ga,ba){$[0]=_s,ga[ba]=_n[7],ga[ba+1]=_n[6],ga[ba+2]=_n[5],ga[ba+3]=_n[4],ga[ba+4]=_n[3],ga[ba+5]=_n[2],ga[ba+6]=_n[1],ga[ba+7]=_n[0]}function _(_s,ga){return _n[0]=_s[ga],_n[1]=_s[ga+1],_n[2]=_s[ga+2],_n[3]=_s[ga+3],_n[4]=_s[ga+4],_n[5]=_s[ga+5],_n[6]=_s[ga+6],_n[7]=_s[ga+7],$[0]}function j(_s,ga){return _n[7]=_s[ga],_n[6]=_s[ga+1],_n[5]=_s[ga+2],_n[4]=_s[ga+3],_n[3]=_s[ga+4],_n[2]=_s[ga+5],_n[1]=_s[ga+6],_n[0]=_s[ga+7],$[0]}var $=new Float64Array([-0]),_n=new Uint8Array($.buffer),_i=_n[7]===128;h.writeDoubleLE=_i?i:g,h.writeDoubleBE=_i?g:i,h.readDoubleLE=_i?_:j,h.readDoubleBE=_i?j:_}():function(){function i(_,j,$,_n,_i,_s){var ga=0>_n?1:0;if(ga&&(_n=-_n),_n===0)_(0,_i,_s+j),_(0<1/_n?0:2147483648,_i,_s+$);else if(isNaN(_n))_(0,_i,_s+j),_(2146959360,_i,_s+$);else if(17976931348623157e292<_n)_(0,_i,_s+j),_((ga<<31|2146435072)>>>0,_i,_s+$);else if(22250738585072014e-324>_n)_((_n/=5e-324)>>>0,_i,_s+j),_((ga<<31|_n/4294967296)>>>0,_i,_s+$);else{var ba=Math.floor(Math.log(_n)/Math.LN2);ba===1024&&(ba=1023),_(4503599627370496*(_n*=Math.pow(2,-ba))>>>0,_i,_s+j),_((ga<<31|ba+1023<<20|1048576*_n&1048575)>>>0,_i,_s+$)}}function g(_,j,$,_n,_i){return j=_(_n,_i+j),_n=_(_n,_i+$),_=2*(_n>>31)+1,j=4294967296*(1048575&_n)+j,($=_n>>>20&2047)===2047?j?NaN:1/0*_:$===0?5e-324*_*j:_*Math.pow(2,$-1075)*(j+4503599627370496)}h.writeDoubleLE=i.bind(null,hs,0,4),h.writeDoubleBE=i.bind(null,is,4,0),h.readDoubleLE=g.bind(null,js,0,4),h.readDoubleBE=g.bind(null,ks,4,0)}(),h}function hs(h,i,g){i[g]=255&h,i[g+1]=h>>>8&255,i[g+2]=h>>>16&255,i[g+3]=h>>>24}function is(h,i,g){i[g]=h>>>24,i[g+1]=h>>>16&255,i[g+2]=h>>>8&255,i[g+3]=255&h}function js(h,i){return(h[i]|h[i+1]<<8|h[i+2]<<16|h[i+3]<<24)>>>0}function ks(h,i){return(h[i]<<24|h[i+1]<<16|h[i+2]<<8|h[i+3])>>>0}function mc(h,i){this.lo=h>>>0,this.hi=i>>>0}function pi(h,i,g){this.fn=h,this.len=i,this.next=void 0,this.val=g}function Gm(){}function mC(h){this.head=h.head,this.tail=h.tail,this.len=h.len,this.next=h.states}function ib(){this.len=0,this.tail=this.head=new pi(Gm,0,0),this.states=null}function Hm(h,i,g){i[g]=255&h}function Im(h,i){this.len=h,this.next=void 0,this.val=i}function Jm(h,i,g){for(;h.hi;)i[g++]=127&h.lo|128,h.lo=(h.lo>>>7|h.hi<<25)>>>0,h.hi>>>=7;for(;127<h.lo;)i[g++]=127&h.lo|128,h.lo>>>=7;i[g++]=h.lo}function Km(h,i,g){i[g]=255&h,i[g+1]=h>>>8&255,i[g+2]=h>>>16&255,i[g+3]=h>>>24}function ie(){Lm.call(this)}function nC(h,i,g){40>h.length?Ra.utf8.write(h,i,g):i.utf8Write?i.utf8Write(h,g):i.write(h,g)}function Od(h,i){return RangeError("index out of range: "+h.pos+" + "+(i||1)+" > "+h.len)}function Yb(h){this.buf=h,this.pos=0,this.len=h.length}function Mm(){var h=new ls(0,0),i=0;if(!(4<this.len-this.pos)){for(;3>i;++i){if(this.pos>=this.len)throw Od(this);if(h.lo=(h.lo|(127&this.buf[this.pos])<<7*i)>>>0,128>this.buf[this.pos++])return h}return h.lo=(h.lo|(127&this.buf[this.pos++])<<7*i)>>>0,h}for(;4>i;++i)if(h.lo=(h.lo|(127&this.buf[this.pos])<<7*i)>>>0,128>this.buf[this.pos++])return h;if(h.lo=(h.lo|(127&this.buf[this.pos])<<28)>>>0,h.hi=(h.hi|(127&this.buf[this.pos])>>4)>>>0,128>this.buf[this.pos++])return h;if(i=0,4<this.len-this.pos){for(;5>i;++i)if(h.hi=(h.hi|(127&this.buf[this.pos])<<7*i+3)>>>0,128>this.buf[this.pos++])return h}else for(;5>i;++i){if(this.pos>=this.len)throw Od(this);if(h.hi=(h.hi|(127&this.buf[this.pos])<<7*i+3)>>>0,128>this.buf[this.pos++])return h}throw Error("invalid varint encoding")}function Pj(h,i){return(h[i-4]|h[i-3]<<8|h[i-2]<<16|h[i-1]<<24)>>>0}function ms(){if(this.pos+8>this.len)throw Od(this,8);return new ls(Pj(this.buf,this.pos+=4),Pj(this.buf,this.pos+=4))}function ag(h){Nm.call(this,h)}function qi(h,i,g){if(typeof h!="function")throw TypeError("rpcImpl must be a function");Ra.EventEmitter.call(this),this.rpcImpl=h,this.requestDelimited=!!i,this.responseDelimited=!!g}function yb(h){return typeof h=="string"&&/^[\s\w!#$%&()+,.:;<=>?@[\]^{|}~-]{1,64}$/.test(h)&&h!=="null"}function ns(h){try{var i=h.split(".").map(function(_){return Number(_)})}catch{return!1}if(i.length!==4||i[0]===0)return!1;for(h=0;h<i.length;h++){var g=i[h];if(!Number.isInteger(g)||0>g||255<g)return!1}return!0}function os(h,i){if(!Array.isArray(i)||i.length===0||32<i.length||i.some(function(g){return g.length===0||32<g.length}))throw new ja("arguments is not valid",Ub);if(!yb(h))throw new ja("ID is invalid",Ub)}function ri(h){var i=h.attributes,g=h.attrSizeMap,_=h.maxAttrsCount,j=h.maxAttrValueSize;if(h=h.maxTotalSize,!Lg(i))throw new ja("attributes must be an object",Ub);if(Object.keys(i).length>_)throw new Dc("Exceed the limit of ".concat(_," attributes"),ch);if(Object.keys(i).length===0)throw new ja("The attributes is an empty object",Ub);var $=0,_n=0;for(i=Object.entries(i);_n<i.length;_n++){var _i=Lb(i[_n],2),_s=_i[1];_i=new Blob([_i[0]]).size;var ga=new Blob([_s]).size;if(_i===0||32<_i)throw new ja("Invalid attribute key",Ub);if(ga>j)throw new Dc("Invalid attribute value, over the limit of ".concat(j," bytes"),ch);if(typeof _s!="string"||_s.length===0)throw new ja("Invalid attribute value",Ub);$+=_i,$+=ga}if($>h)throw new Dc("The attributes size overflow",ch);if(g!==void 0){if(Object.keys(g).length>_)throw new Dc("Exceed the limit of ".concat(_," attributes"),ch);for($=_=0,g=Object.entries(g);$<g.length;$++){if(_n=(i=Lb(g[$],2))[1],(i=new Blob([i[0]]).size)===0)throw new ja("Invalid attribute key",Ub);if(_n>j)throw new Dc("Invalid attribute value, over the limit of ".concat(j," bytes"),ch);_+=i,_+=_n}if(_>h)throw new Dc("The attributes size overflow",ch)}}function nf(h){var i=h.items,g=h.maxMetaDataCount,_=h.maxMetaValueSize;if(h=h.type,!Array.isArray(i))throw new ja("params must be an MetadataItem array",Mb);var j=i.map(function(ga){return[ga.getKey(),ga.getValue()]});if(j.length>g)throw new Dc("Exceed the limit of ".concat(g," metadata items"),Om);if(j.length===0)throw new ja("The metadata is empty ",Mb);if((h==="Update"||h==="Delete")&&i.map(function(ga){return ga.getRevision()}).includes(0))throw new ja("The operation limit metadata revision can not set 0 ",of);for(g=0;g<j.length;g++){var $=Lb(j[g],2),_n=$[0];$=$[1];var _i=new Blob([_n??""]).size,_s=new Blob([$??""]).size;if((_n==null?void 0:_n[0])==="_")throw new ja("Invalid metaData key",Mb);if(_i===0||32<_i)throw new ja("Invalid metaData key",Om);if(typeof $!="string")throw new ja("Invalid metadata value",Mb);if(h!=="Delete"&&_s>_)throw new Dc("Invalid metadata value, over the limit of ".concat(_," bytes"),Om)}if(new Set(i.map(function(ga){return ga.getKey()})).size!==i.map(function(ga){return ga.getKey()}).length)throw new ja("meta data params key must be key must be unique",oC)}function Qj(h,i){return Math.floor(Math.random()*(Math.floor(i)-Math.ceil(h)+1))+h}function Rj(){var h=Qj(0,4294967295),i=Qj(1,4294967295);return new D(h,i,!0)}function fc(h){return h.toString().padEnd(32,"0")}function ps(h,i){return new TypeError("Unexpected ".concat(h,": ").concat(i))}function qs(h,i){return h=h.split(".").map(function(g){return Number(g)}),i=i.split(".").map(function(g){return Number(g)}),Math.sqrt(1e3*Math.pow(h[0]-i[0],2)+100*Math.pow(h[1]-i[1],2)+10*Math.pow(h[2]-i[2],2)+1*Math.pow(h[3]-i[3],2))}function rs(h){return h.lessThanOrEqual(Number.MAX_SAFE_INTEGER)?h.toNumber():h.toString()}function Pm(h,i){i="".concat(h).concat(i||"");var g=ss.get(i)||1;return ss.set(i,g+1),"".concat(h).concat(g)}function ts(h,i){var g=typeof i=="number"?i:i!==void 0&&typeof i!="string"?i.code:void 0;return i=typeof i!="number"&&typeof i!="string"&&i!==void 0&&i.serverCode!==void 0?i.serverCode:void 0,g="".concat(g!==void 0?" Error Code ".concat(g):"").concat(i!==void 0?", server Code ".concat(i):""),h=typeof h=="string"&&h?Sj(h):Array.isArray(h)&&typeof h[0]=="string"&&h[0]?Sj(us.apply(void 0,[h[0]].concat(ra(h.slice(1))))):"","".concat(g===""?"":"".concat(g," - ")).concat(h)}function pC(h,i){return Qm.apply(this,arguments)}function Qm(){return(Qm=za(W.mark(function h(i,g){return W.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:if(!g||!g.aborted){_.next=2;break}return _.abrupt("return");case 2:return _.abrupt("return",new Promise(function(j){setTimeout(j,i),g==null||g.addEventListener("abort",j)}));case 3:case"end":return _.stop()}},h)}))).apply(this,arguments)}function Tj(h,i,g){return Rm.apply(this,arguments)}function Rm(){return(Rm=za(W.mark(function h(i,g,_){var j,$,_n,_i,_s,ga,ba,xa,El,Tl,Sl,Il,Cl,Nl,Dl,Ul,Kl,Jl,Ep,_p,Ip,Up,yp,Ap,Cp,Mp;return W.wrap(function(wp){for(;;)switch(wp.prev=wp.next){case 0:if(j=g.body,$=g.headers,_n=$===void 0?{}:$,_i=g.timeout,_s=_i===void 0?1e4:_i,ga=g.signal,ba=g.withCredentials,xa=ba!==void 0&&ba,El=(_||{}).useBinaryResponse,Tl=El!==void 0&&El,(Sl=new XMLHttpRequest).open("POST",i,!0),Sl.responseType=Tl?"arraybuffer":"text",Sl.withCredentials=xa,Sl.timeout=_s,Il=j instanceof FormData,Cl=j instanceof Uint8Array,!(1<(Nl=Object.keys(_n).filter(function(Np){return Np.toLowerCase()==="content-type"})).length)){wp.next=14;break}throw new RangeError("multiple content-type");case 14:Nl.length===0&&(Cl?_n["Content-Type"]="application/octet-stream":Il||(_n["Content-Type"]="application/json"));case 15:if("setRequestHeader"in Sl){wp.next=46;break}return Sl.abort(),wp.next=19,fetch(i,{body:Il||Cl?j:JSON.stringify(j),cache:"no-cache",credentials:xa?"include":"same-origin",headers:_n,method:"POST",mode:"cors",referrer:"no-referrer",signal:ga});case 19:if(Dl=wp.sent,!(200<=(Ul=Dl.status)&&300>Ul||Ul===304)){wp.next=31;break}if(!Tl){wp.next=27;break}return wp.next=25,Dl.arrayBuffer();case 25:return Kl=wp.sent,wp.abrupt("return",{status:Ul,responseData:Kl});case 27:return wp.next=29,Dl.text();case 29:return Jl=wp.sent,wp.abrupt("return",{status:Ul,responseText:Jl});case 31:return Ep=new Pa(["Post XHR failure, status %d",Ul]),wp.prev=32,wp.next=35,Dl.text();case 35:throw _p=wp.sent,Ep.statusCode=Ul,Ep.message=_p||"Request failed, status ".concat(Ul),Ep;case 41:throw wp.prev=41,wp.t0=wp.catch(32),Ep.statusCode=Ul,Ep.message="Request failed, status ".concat(Ul),Ep;case 46:if(Object.keys(_n).length!==0)for(Ip=0,Up=Object.entries(_n);Ip<Up.length;Ip++)yp=Lb(Up[Ip],2),Ap=yp[0],Cp=yp[1],Sl.setRequestHeader(Ap,Cp);return ga!==void 0&&(Mp=function Np(){Sl.abort(),ga.removeEventListener("abort",Np)},ga.addEventListener("abort",Mp)),Il||Cl?Sl.send(j):Sl.send(JSON.stringify(j)),wp.abrupt("return",new Promise(function(Np,Fp){Sl.onload=function(){var Hp=Sl.status;if(200<=Hp&&300>Hp||Hp===304)Np(Tl?{status:Hp,responseData:Sl.response}:{status:Hp,responseText:Sl.responseText});else{var xp=new Pa(["Post XHR failure, status %d",Hp]);xp.statusCode=Hp,xp.message=Sl.response||"Request failed, status ".concat(Sl.status),Fp(xp)}},Sl.ontimeout=function(Hp){Fp(new Pc(["XHR request timed out after %d ms",_s],{originalError:Hp}))},Sl.onerror=function(){var Hp=new Pa(["Post XHR failure, status %d",Sl.status]);Hp.statusCode=Sl.status,Hp.message=Sl.response||"Request failed, status ".concat(Sl.status),Fp(Hp)},Sl.onabort=function(){try{Fp(new DOMException("The request aborted.","AbortError"))}catch{var Hp=Error("The request aborted.");Hp.name="AbortError",Fp(Hp)}}}));case 50:case"end":return wp.stop()}},h,null,[[32,41]])}))).apply(this,arguments)}function vs(h,i){if(!Lg(h))throw new ja("message object is not a plain object",i);if(h.messageType===void 0)if(h.rawMessage instanceof Uint8Array){if(h.messageType="RAW",h.text!==void 0)throw new ja("Raw messages cannot have text property. Use description instead",i)}else{if(typeof h.text!="string")throw new ja("messageType is undefined",i);if(h.messageType="TEXT",h.rawMessage!==void 0)throw new ja("Text messages cannot have rawMessage property",i)}}function Uj(h){return Sm.apply(this,arguments)}function Sm(){return(Sm=za(W.mark(function h(i){var g,_,j,$,_n,_i,_s,ga,ba,xa,El,Tl,Sl,Il,Cl,Nl,Dl,Ul,Kl,Jl,Ep;return W.wrap(function(_p){for(;;)switch(_p.prev=_p.next){case 0:if(g=i.message,_=i.peerId,j=i.toPeer,$=i.session,_n=i.errorCodes,_i=i.diff,_s=i.logger,$!==void 0){_p.next=3;break}throw new ia("The client is not logged in. Cannot do the operation",_n.NOT_LOGGED_IN);case 3:if(ga=!1,ba=j?g.messageType==="TEXT"?vb.P2pSMsgNoOfflineFlag:vb.P2pRMsgNoOfflineFlag:g.messageType==="TEXT"?vb.ChannelSMsg:vb.ChannelRMsg,g.messageType!=="TEXT"||!g.text.startsWith("AgoraRTMLegacyEndcallCompatibleMessagePrefix")||!j){_p.next=14;break}if(xa=g.text.split("_"),El=Lb(xa,3),Tl=El[0],Sl=El[1],El[2]!==void 0&&yb(Sl)&&Tl==="AgoraRTMLegacyEndcallCompatibleMessagePrefix"){_p.next=13;break}throw $.emit("messageCount",{messageCategory:ba,type:"common",key:"sentcount"}),$.emit("messageCount",{messageCategory:ba,type:"common",key:"invalidmessagecount"}),new ja("Message is not valid",si);case 13:ga=!0;case 14:if(Il=Date.now(),Cl=$.messageSentTimes.length-1,!((Nl=$.messageSentTimes[Cl])&&Nl+3e3<Il)){_p.next=21;break}$.messageSentTimes=[Il],_p.next=34;break;case 21:Dl=Cl;case 22:if(!(0<=Dl)){_p.next=33;break}if(!($.messageSentTimes[Dl]+3e3<Il)){_p.next=26;break}return $.messageSentTimes=$.messageSentTimes.slice(Dl+1,Cl+1),_p.abrupt("break",33);case 26:if(!(180<=Cl-Dl+1)){_p.next=30;break}throw $.emit("messageCount",{messageCategory:ba,type:"common",key:"sentcount"}),$.emit("messageCount",{messageCategory:ba,type:"common",key:"toooftencount"}),new Dc("Message sent failed, exceeded the 180 message in 3 seconds",_n.TOO_OFTEN);case 30:Dl--,_p.next=22;break;case 33:$.messageSentTimes.push(Il);case 34:_p.t0=g.messageType,_p.next=_p.t0==="TEXT"?37:_p.t0==="RAW"?42:44;break;case 37:if(!ga){_p.next=41;break}return Ul=g.text.split("_"),Kl=Lb(Ul,3),Jl=Kl[1],Ep=Kl[2],_s.info("[rtm-API] EndCall message send api is called"),_p.abrupt("return",$.sendInvitationMessage({peerId:_,type:"CallCancel",extra:Ep,channelId:Jl,callId:"0"}));case 41:return _p.abrupt("return",$.sendTextMessage(g.text,_,j,1e4-_i));case 42:return g.description===void 0&&(g.description=""),_p.abrupt("return",$.sendRawMessage(g.rawMessage,g.description,_,j,1e4-_i));case 44:throw $.emit("messageCount",{messageCategory:ba,type:"common",key:"sentcount"}),$.emit("messageCount",{messageCategory:ba,type:"common",key:"invalidmessagecount"}),new ja("Invalid message type",si);case 47:case"end":return _p.stop()}},h)}))).apply(this,arguments)}function qC(h){var i=!(1<arguments.length&&arguments[1]!==void 0)||arguments[1],g=h.replace(/(https?:\/\/)?(www.)?/i,"");return i||(g=g.split(".").slice(h.length-2).join(".")),g.indexOf("/")!==-1?g.split("/")[0]:g}function wb(h){if(typeof h!="string")return"[Sensitive Info]";var i=Math.floor(.7*h.length),g=h.length;return ws(h,i,g,"*".repeat(g-i))}function xs(h,i,g){function _(j){if(h===void 0)return h;if(or(j))return j;if(Array.isArray(j))return j.map(_);var $={},_n=0;for(j=Vj(j);_n<j.length;_n++){var _i=Lb(j[_n],2),_s=_i[0];if(typeof(_i=_i[1])=="string"&&g.includes(_s)){$[_s]=typeof _i=="string"?wb(_i):"[Sensitive Info]";break}i.includes(_s)?$[_s]="[Hidden Info]":$[_s]=_i==null?_i:g.includes(_s)?"[Sensitive Info]":_(_i)}return $}return Array.isArray(h)?h.map(_):_(h)}function ys(h){return Object.getOwnPropertyNames(h).forEach(function(i){Ia(i=h[i])=="object"&&i!==null&&ys(i)}),Object.freeze(h)}function ti(h){return new TextDecoder("utf-8").decode(h.buffer.slice(h.byteOffset,h.byteOffset+h.byteLength))}function Wj(h){return new TextEncoder().encode(h).length}function zs(){for(var h=0,i=arguments.length,g=Array(i),_=0;_<i;_++)g[_]=arguments[_];for(i=0;i<g.length;i++)h+=g[i].length;for(h=new Uint8Array(h),_=i=0;_<g.length;_++){var j=g[_];h.set(j,i),i+=j.length}return h}function dh(h,i,g){var _=h.match(/([^?#]+)(\?[^#]*)?(#.*)?/);if(h=_==null?void 0:_[1],_=_==null?void 0:_[2]){var j;for(_=_.substr(1).split("&"),j=0;j<_.length;j++)if(_[j].split("=")[0]==i){_[j]=i+"="+encodeURIComponent(g);break}return j==_.length&&_.push(i+"="+encodeURIComponent(g)),h+"?"+_.join("&")}return h+"?"+i+"="+encodeURIComponent(g)}function ws(h,i,g,_){return typeof h!="string"?"[Sensitive Info]":h.substring(0,i)+_+h.substring(g)}function ui(h){return typeof h=="string"&&h.length!==0&&h!=="false"&&h!=="null"&&h!=="undefined"}function As(h){var i=[];return function g(_){if(_===null||Ia(_)!=="object")return _;if(i.indexOf(_)!==-1)return"[Circular]";if(i.push(_),typeof _.toJSON=="function")try{var j=g(_.toJSON());return i.pop(),j}catch($){return"[Throws: "+($?$.message:"?")+"]"}return Array.isArray(_)?(j=_.map(g),i.pop(),j):(j=Object.keys(_).reduce(function($,_n){e:{if(rC.call(_,_n))try{var _i=_[_n];break e}catch(_s){_i="[Throws: "+(_s?_s.message:"?")+"]";break e}_i=_[_n]}return $[_n]=g(_i),$},{}),i.pop(),j)}(h)}function sC(h){if(!(100<(h=String(h)).length)&&(h=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(h))){var i=parseFloat(h[1]);switch((h[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*i;case"weeks":case"week":case"w":return 6048e5*i;case"days":case"day":case"d":return 864e5*i;case"hours":case"hour":case"hrs":case"hr":case"h":return 36e5*i;case"minutes":case"minute":case"mins":case"min":case"m":return 6e4*i;case"seconds":case"second":case"secs":case"sec":case"s":return 1e3*i;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return i}}}function Xj(h,i,g,_){return Math.round(h/g)+" "+_+(i>=1.5*g?"s":"")}function tC(h){var i=h.areas,g=h.excludedArea;if(i.length===1&&i[0]===oa.GLOBAL&&g===oa.CHINA)return eh([oa.OVERSEA]);if(i.includes(oa.GLOBAL)){if(h=vi(Yj).filter(function($){return $!==oa.GLOBAL&&$!==oa.OVERSEA}),g in wi){i=wi[g];var _=[].concat(ra(i??[]),[g]);return eh(h.filter(function($){return!_.includes($)}))}if(Bs(g)){var j=uC(g);return eh(h.filter(function($){return $!==g&&$!==j}))}}if(Bs(g)||g in wi)return eh(i);throw new ja("Invalid excludedArea area config")}function gb(h,i,g){g===void 0&&(g=Object.getOwnPropertyDescriptor(h,i));var _=g.value;return g.value=function(){for(var j=this,$=arguments.length,_n=Array($),_i=0;_i<$;_i++)_n[_i]=arguments[_i];this.invokeTracker.apply(this,["%s: ".concat(0<_n.length?"%s with args: ".concat(_n.map(function(){return"%o"})):"%s"),this.name,i].concat(ra(_n.map(fh))));try{var _s=_.apply(this,_n)}catch(ba){throw this.logError.apply(this,["".concat(ba.code!==void 0?"Error Code ".concat(ba.code,": "):"","%s failed").concat(0<_n.length?" with args: ".concat(_n.map(function(){return"%o"})):""),i].concat(ra(_n.map(fh)))),ba.originalError&&this.logError(ba.originalError),this.errorTracker(ba),ba}var ga=Date.now();return za(W.mark(function ba(){var xa,El;return W.wrap(function(Tl){for(;;)switch(Tl.prev=Tl.next){case 0:return Tl.prev=0,Tl.next=3,_s;case 3:xa=Tl.sent,Tl.next=12;break;case 6:return Tl.prev=6,Tl.t0=Tl.catch(0),j.logError.apply(j,["".concat(Tl.t0.code!==void 0?"Error Code ".concat(Tl.t0.code,": "):"","%s failed").concat(0<_n.length?" with args: ".concat(_n.map(function(){return"%o"})):""),i].concat(ra(_n.map(fh)))),Tl.t0.originalError&&j.logError(Tl.t0.originalError),j.errorTracker(Tl.t0),Tl.abrupt("return");case 12:xa!==_s?xa===void 0?j.resultTracker("%s promise resolves after %dms",i,Date.now()-ga):j.resultTracker("%s promise resolves after %dms, result is %o",i,Date.now()-ga,fh(xa)):Be(xa)!=="Object"||Lg(xa)?j.resultTracker("%s result is %o",i,fh(xa)):j.resultTracker("%s result is %s",i,xa.name||((El=xa.constructor)===null||El===void 0?void 0:El.name));case 13:case"end":return Tl.stop()}},ba,null,[[0,6]])}))(),_s},g}function je(h,i,g){g===void 0&&(g=Object.getOwnPropertyDescriptor(h,i));var _=g.value;return g.value=function(){for(var j=this,$=arguments.length,_n=Array($),_i=0;_i<$;_i++)_n[_i]=arguments[_i];this.invokeTracker.apply(this,["%s: ".concat(0<_n.length?"%s with args: ".concat(_n.map(function(){return"%o"})):"%s"),this.name,i].concat(_n));try{var _s=_.apply(this,_n)}catch(ba){throw this.logError.apply(this,["".concat(ba.code!==void 0?"Error Code ".concat(ba.code,": "):"","%s failed").concat(0<_n.length?" with args: ".concat(_n.map(function(){return"%o"})):""),i].concat(_n)),ba.originalError&&this.logError(ba.originalError),this.errorTracker(ba),ba}var ga=Date.now();return za(W.mark(function ba(){var xa,El;return W.wrap(function(Tl){for(;;)switch(Tl.prev=Tl.next){case 0:return Tl.prev=0,Tl.next=3,_s;case 3:xa=Tl.sent,Tl.next=12;break;case 6:return Tl.prev=6,Tl.t0=Tl.catch(0),j.logError.apply(j,["".concat(Tl.t0.code!==void 0?"Error Code ".concat(Tl.t0.code,": "):"","%s failed").concat(0<_n.length?" with args: ".concat(_n.map(function(){return"%o"})):""),i].concat(_n)),Tl.t0.originalError&&j.logError(Tl.t0.originalError),j.errorTracker(Tl.t0),Tl.abrupt("return");case 12:xa!==_s?xa===void 0?j.resultTracker("%s promise resolves after %dms",i,Date.now()-ga):j.resultTracker("%s promise resolves after %dms, result is %o",i,Date.now()-ga,xa):Be(xa)!=="Object"||Lg(xa)?j.resultTracker("%s result is %o",i,xa):j.resultTracker("%s result is %s",i,xa.name||((El=xa.constructor)===null||El===void 0?void 0:El.name));case 13:case"end":return Tl.stop()}},ba,null,[[0,6]])}))(),_s},g}function vC(h,i){var g="".concat(h,"Uri");if(typeof(g=Tm[g])!="number"||g===0)throw new TypeError("Got Unknown URI Name");return i=new(h=Cs[h])(i),i=h.encode(i).finish(),new wC({uri:g,data:i})}function Ds(h,i){var g=ui(null);return"".concat(h.split(".").join("-"),".edge.").concat(g?null:i?"sd-rtn.com":"agora.io")}function $a(h,i,g){return Um.apply(this,arguments)}function Um(){return(Um=za(W.mark(function h(i,g,_){var j,$,_n,_i=arguments;return W.wrap(function(_s){for(;;)switch(_s.prev=_s.next){case 0:return j=3<_i.length&&_i[3]!==void 0&&_i[3],$=xC[i].encode(g).finish(),_n=function(){var ga=za(W.mark(function ba(xa){var El,Tl,Sl,Il=arguments;return W.wrap(function(Cl){for(;;)switch(Cl.prev=Cl.next){case 0:if(!(3<(Tl=1<Il.length&&Il[1]!==void 0?Il[1]:0))){Cl.next=3;break}return Cl.abrupt("return");case 3:if(Sl=dh(Sl=_?"https://".concat((El=Ba==null?void 0:Ba.PROXY_NGINX[0])!==null&&El!==void 0?El:"webrtc-cloud-proxy.sd-rtn.com","/rs/?h=").concat(xa,"&p=443&d=events/proto-raw"):"https://".concat(xa,"/events/proto-raw"),"sentTs",Math.ceil(Date.now()/1e3).toString()),Sl=dh(Sl,"id",yC[i].toString()),!j){Cl.next=9;break}return Cl.next=9,pC(1e4);case 9:return Cl.next=11,Tj(Sl,{body:$,timeout:2e4,headers:{"Content-Type":"application/octet-stream"}}).catch(function(Nl){return _n(xa,Tl+1)});case 11:case"end":return Cl.stop()}},ba)}));return function(ba){return ga.apply(this,arguments)}}(),_s.prev=3,_s.next=6,_n((Ba==null?void 0:Ba.EVENT_REPORT_DOMAIN[0])||ui(null)&&null||"webcollector-rtm.agora.io");case 6:_s.next=12;break;case 8:return _s.prev=8,_s.t0=_s.catch(3),_s.next=12,_n(Ba&&Es(1<(Ba==null?void 0:Ba.EVENT_REPORT_DOMAIN.length)?Ba==null?void 0:Ba.EVENT_REPORT_DOMAIN.slice(1):Ba==null?void 0:Ba.EVENT_REPORT_DOMAIN)||"rtm.statscollector.sd-rtn.com");case 12:case"end":return _s.stop()}},h,null,[[3,8]])}))).apply(this,arguments)}function Nb(h){return h===void 0?D.fromNumber(0):D.fromNumber(Date.now()-h)}function Zj(h,i){return D.fromValue(h).eq(i)}function ak(h,i){var g=i===void 0?h.val:i,_=h.isBoolean;i=h.isNumber;var j=h.oneof,$=h.len;if([_,i,j].filter(function(_n){return!_n}).length!==2)throw new TypeError("invalid field type");if(g!==void 0&&(h=!1,j!==void 0&&(j=Vm(j),zC(j,Zj).length===j.length&&AC(j,function(_n){return Zj(g,_n)})!==void 0&&(h=!0)),_=_!==void 0&&(g===0||g===1)&&$===1,i=i!==void 0&&g.toString(2).length<=$,!(h||_||i)))throw Error("invalid field value")}function pf(h,i){i=E({},Ge.STATE_REVISION,i!==void 0&&0<=i?i:void 0);for(var g=0;g<h.length;g++){var _=h[g];i[_.getKey()]=_.getValue(),i["".concat(Ge.STATE_REVISION_KEY_PREFIX).concat(_.getKey())]=0<=_.getRevision()||_.getRevision()===-2?_.getRevision():void 0}return Pd.omitBy(i,Pd.isUndefined)}function Wm(h){var i=JSON.parse(h);h={majorRevision:i[Ge.STATE_REVISION],items:[]};var g=Pd.omit(i,Ge.STATE_REVISION);return i=Object.keys(g).filter(function(_){return _[0]!=="_"}),h.items=i.map(function(_){return new Fs({key:_,value:g[_],revision:g["".concat(Ge.STATE_REVISION_KEY_PREFIX).concat(_)],updateTs:g["".concat(Ge.STATE_TIMESTAMP_PREFIX).concat(_)],authorUserId:g["".concat(Ge.STATE_AUTHOR_PREFIX).concat(_)]})}),h}function ud(h){var i=bd;return h!==bg.StateOk&&h!==bg.DuplicatedOperation&&(i=h===bg.OutdateRevision?of:h===bg.TimeOutError?cd:h===bg.ArgumentError?Mb:He),i}function Gs(h){return h.reduce(function(i,g){return i.concat(g instanceof bk.UnsubscriptionError?g.errors:g)},[])}function BC(h,i){do xi==2147483647?xi=0:xi++;while(gh.hasOwnProperty(xi));var g=xi;return gh[g]={callback:h,parameters:Array.prototype.slice.call(arguments,2)},Xm.postMessage({name:"setInterval",fakeId:g,time:i}),g}function Hs(h){return function(){var i=h();if(!i)throw new ia("Client is not logged in. Cannot do the operation");return i}}var qb=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof commonjsGlobal<"u"?commonjsGlobal:typeof self<"u"?self:{},ck=function(h){return h&&h.Math==Math&&h},na=ck(typeof globalThis=="object"&&globalThis)||ck(typeof window=="object"&&window)||ck(typeof self=="object"&&self)||ck(typeof qb=="object"&&qb)||function(){return this}()||Function("return this")(),Ga=function(h){try{return!!h()}catch{return!0}},cb=!Ga(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),Is={}.propertyIsEnumerable,Js=Object.getOwnPropertyDescriptor,yi=Js&&!Is.call({1:2},1)?function(h){return!!(h=Js(this,h))&&h.enumerable}:Is,ke=function(h,i){return{enumerable:!(1&h),configurable:!(2&h),writable:!(4&h),value:i}},CC={}.toString,Qd=function(h){return CC.call(h).slice(8,-1)},DC="".split,zi=Ga(function(){return!Object("z").propertyIsEnumerable(0)})?function(h){return Qd(h)=="String"?DC.call(h,""):Object(h)}:Object,Ec=function(h){if(h==null)throw TypeError("Can't call method on "+h);return h},Qc=function(h){return zi(Ec(h))},fb=function(h){return typeof h=="object"?h!==null:typeof h=="function"},le=function(h,i){if(!fb(h))return h;var g,_;if(i&&typeof(g=h.toString)=="function"&&!fb(_=g.call(h))||typeof(g=h.valueOf)=="function"&&!fb(_=g.call(h))||!i&&typeof(g=h.toString)=="function"&&!fb(_=g.call(h)))return _;throw TypeError("Can't convert object to primitive value")},Zb=function(h){return Object(Ec(h))},EC={}.hasOwnProperty,Fa=function(h,i){return EC.call(Zb(h),i)},hh=na.document,dk=fb(hh)&&fb(hh.createElement),Ks=!cb&&!Ga(function(){return Object.defineProperty(dk?hh.createElement("div"):{},"a",{get:function(){return 7}}).a!=7}),Ls=Object.getOwnPropertyDescriptor,pd={f:cb?Ls:function(h,i){if(h=Qc(h),i=le(i,!0),Ks)try{return Ls(h,i)}catch{}if(Fa(h,i))return ke(!yi.call(h,i),h[i])}},ub=function(h){if(!fb(h))throw TypeError(String(h)+" is not an object");return h},Ms=Object.defineProperty,$b={f:cb?Ms:function(h,i,g){if(ub(h),i=le(i,!0),ub(g),Ks)try{return Ms(h,i,g)}catch{}if("get"in g||"set"in g)throw TypeError("Accessors not supported");return"value"in g&&(h[i]=g.value),h}},ac=cb?function(h,i,g){return $b.f(h,i,ke(1,g))}:function(h,i,g){return h[i]=g,h},Ym=function(h,i){try{ac(na,h,i)}catch{na[h]=i}return i},qf=na["__core-js_shared__"]||Ym("__core-js_shared__",{}),FC=Function.toString;typeof qf.inspectSource!="function"&&(qf.inspectSource=function(h){return FC.call(h)});var Zm=qf.inspectSource,Ns=na.WeakMap,GC=typeof Ns=="function"&&/native code/.test(Zm(Ns)),rf=kc(function(h){(h.exports=function(i,g){return qf[i]||(qf[i]=g!==void 0?g:{})})("versions",[]).push({version:"3.12.1",mode:"global",copyright:"© 2021 Denis Pushkarev (zloirock.ru)"})}),HC=0,IC=Math.random(),ih=function(h){return"Symbol("+String(h===void 0?"":h)+")_"+(++HC+IC).toString(36)},Os=rf("keys"),ek=function(h){return Os[h]||(Os[h]=ih(h))},jh={},JC=na.WeakMap;if(GC||qf.state)var cg=qf.state||(qf.state=new JC),KC=cg.get,Ps=cg.has,LC=cg.set,$m=function(h,i){if(Ps.call(cg,h))throw new TypeError("Object already initialized");return i.facade=h,LC.call(cg,h,i),i},fk=function(h){return KC.call(cg,h)||{}},an=function(h){return Ps.call(cg,h)};else{var kh=ek("state");jh[kh]=!0,$m=function(h,i){if(Fa(h,kh))throw new TypeError("Object already initialized");return i.facade=h,ac(h,kh,i),i},fk=function(h){return Fa(h,kh)?h[kh]:{}},an=function(h){return Fa(h,kh)}}var Sb={set:$m,get:fk,has:an,enforce:function(h){return an(h)?fk(h):$m(h,{})},getterFor:function(h){return function(i){var g;if(!fb(i)||(g=fk(i)).type!==h)throw TypeError("Incompatible receiver, "+h+" required");return g}}},Ob=kc(function(h){var i=Sb.get,g=Sb.enforce,_=String(String).split("String");(h.exports=function(j,$,_n,_i){var _s=!!_i&&!!_i.unsafe,ga=!!_i&&!!_i.enumerable;if(_i=!!_i&&!!_i.noTargetGet,typeof _n=="function"){typeof $!="string"||Fa(_n,"name")||ac(_n,"name",$);var ba=g(_n);ba.source||(ba.source=_.join(typeof $=="string"?$:""))}j===na?ga?j[$]=_n:Ym($,_n):(_s?!_i&&j[$]&&(ga=!0):delete j[$],ga?j[$]=_n:ac(j,$,_n))})(Function.prototype,"toString",function(){return typeof this=="function"&&i(this).source||Zm(this)})}),Qs=function(h){return typeof h=="function"?h:void 0},me=function(h,i){return 2>arguments.length?Qs(na[h])||Qs(na[h]):na[h]&&na[h][i]||na[h]&&na[h][i]},MC=Math.ceil,NC=Math.floor,Rd=function(h){return isNaN(h=+h)?0:(0<h?NC:MC)(h)},OC=Math.min,xb=function(h){return 0<h?OC(Rd(h),9007199254740991):0},PC=Math.max,QC=Math.min,dd=function(h,i){return 0>(h=Rd(h))?PC(h+i,0):QC(h,i)},Rs=function(h){return function(i,g,_){i=Qc(i);var j=xb(i.length);if(_=dd(_,j),h&&g!=g){for(;j>_;)if((g=i[_++])!=g)return!0}else for(;j>_;_++)if((h||_ in i)&&i[_]===g)return h||_||0;return!h&&-1}},Ss=Rs(!0),bn=Rs(!1),Ts=function(h,i){h=Qc(h);var g,_=0,j=[];for(g in h)!Fa(jh,g)&&Fa(h,g)&&j.push(g);for(;i.length>_;)Fa(h,g=i[_++])&&(~bn(j,g)||j.push(g));return j},gk="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" "),RC=gk.concat("length","prototype"),dg={f:Object.getOwnPropertyNames||function(h){return Ts(h,RC)}},Ai={f:Object.getOwnPropertySymbols},Us=me("Reflect","ownKeys")||function(h){var i=dg.f(ub(h)),g=Ai.f;return g?i.concat(g(h)):i},Vs=function(h,i){for(var g=Us(i),_=$b.f,j=pd.f,$=0;$<g.length;$++){var _n=g[$];Fa(h,_n)||_(h,_n,j(i,_n))}},SC=/#|\.prototype\./,ne=function(h,i){return(h=TC[UC(h)])==VC||h!=WC&&(typeof i=="function"?Ga(i):!!i)},UC=ne.normalize=function(h){return String(h).replace(SC,".").toLowerCase()},TC=ne.data={},WC=ne.NATIVE="N",VC=ne.POLYFILL="P",XC=pd.f,wa=function(h,i){var g,_,j,$=h.target,_n=h.global,_i=h.stat;if(_=_n?na:_i?na[$]||Ym($,{}):(na[$]||{}).prototype)for(j in i){var _s=i[j],ga=h.noTargetGet?(g=XC(_,j))&&g.value:_[j];if(!(g=ne(_n?j:$+(_i?".":"#")+j,h.forced))&&ga!==void 0){if(typeof _s==typeof ga)continue;Vs(_s,ga)}(h.sham||ga&&ga.sham)&&ac(_s,"sham",!0);try{Ob(_,j,_s,h)}catch{}}},hk=function(){var h=ub(this),i="";return h.global&&(i+="g"),h.ignoreCase&&(i+="i"),h.multiline&&(i+="m"),h.dotAll&&(i+="s"),h.unicode&&(i+="u"),h.sticky&&(i+="y"),i},Sd=Ga(function(){var h=/a/y;return h.lastIndex=2,h.exec("abcd")!=null}),YC=Ga(function(){var h=/^r/gy;return h.lastIndex=2,h.exec("str")!=null}),ik=RegExp.prototype.exec,ZC=rf("native-string-replace",String.prototype.replace),Ws=ik,cn=(d=/a/,b=/b*/g,ik.call(d,"a"),ik.call(b,"a"),d.lastIndex!==0||b.lastIndex!==0),Xs=Sd||YC,dn=/()??/.exec("")[1]!==void 0,d,b;(cn||dn||Xs)&&(Ws=function(h){var i,g=Xs&&this.sticky,_=hk.call(this),j=this.source,$=0,_n=h;if(g){(_=_.replace("y","")).indexOf("g")===-1&&(_+="g"),_n=String(h).slice(this.lastIndex),0<this.lastIndex&&(!this.multiline||this.multiline&&h[this.lastIndex-1]!==`
`)&&(j="(?: "+j+")",_n=" "+_n,$++);var _i=new RegExp("^(?:"+j+")",_)}if(dn&&(_i=new RegExp("^"+j+"$(?!\\s)",_)),cn)var _s=this.lastIndex;var ga=ik.call(g?_i:this,_n);return g?ga?(ga.input=ga.input.slice($),ga[0]=ga[0].slice($),ga.index=this.lastIndex,this.lastIndex+=ga[0].length):this.lastIndex=0:cn&&ga&&(this.lastIndex=this.global?ga.index+ga[0].length:_s),dn&&ga&&1<ga.length&&ZC.call(ga[0],_i,function(){for(i=1;i<arguments.length-2;i++)arguments[i]===void 0&&(ga[i]=void 0)}),ga});var Bi=Ws;wa({target:"RegExp",proto:!0,forced:/./.exec!==Bi},{exec:Bi});var lh=me("navigator","userAgent")||"",Ys=na.process,Zs=Ys&&Ys.versions,$s=Zs&&Zs.v8;if($s)var sf=$s.split("."),en=4>sf[0]?1:sf[0]+sf[1];else lh&&(sf=lh.match(/Edge\/(\d+)/),(!sf||74<=sf[1])&&(sf=lh.match(/Chrome\/(\d+)/))&&(en=sf[1]));var oe=en&&+en,pe=!!Object.getOwnPropertySymbols&&!Ga(function(){return!String(Symbol())||!Symbol.sham&&oe&&41>oe}),at=pe&&!Symbol.sham&&typeof Symbol.iterator=="symbol",Ci=rf("wks"),Di=na.Symbol,$C=at?Di:Di&&Di.withoutSetter||ih,mb=function(h){return Fa(Ci,h)&&(pe||typeof Ci[h]=="string")||(pe&&Fa(Di,h)?Ci[h]=Di[h]:Ci[h]=$C("Symbol."+h)),Ci[h]},aD=mb("species"),fn=RegExp.prototype,bD=!Ga(function(){var h=/./;return h.exec=function(){var i=[];return i.groups={a:"7"},i},"".replace(h,"$<a>")!=="7"}),bt="a".replace(/./,"$0")==="$0",ct=mb("replace"),dt=!!/./[ct]&&/./[ct]("a","$0")==="",cD=!Ga(function(){var h=/(?:)/,i=h.exec;return h.exec=function(){return i.apply(this,arguments)},(h="ab".split(h)).length!==2||h[0]!=="a"||h[1]!=="b"}),jk=function(h,i,g,_){var j=mb(h),$=!Ga(function(){var ga={};return ga[j]=function(){return 7},""[h](ga)!=7}),_n=$&&!Ga(function(){var ga=!1,ba=/a/;return h==="split"&&((ba={constructor:{}}).constructor[aD]=function(){return ba},ba.flags="",ba[j]=/./[j]),ba.exec=function(){return ga=!0,null},ba[j](""),!ga});if(!$||!_n||h==="replace"&&(!bD||!bt||dt)||h==="split"&&!cD){var _i=/./[j],_s=(g=g(j,""[h],function(ga,ba,xa,El,Tl){var Sl=ba.exec;return Sl===Bi||Sl===fn.exec?$&&!Tl?{done:!0,value:_i.call(ba,xa,El)}:{done:!0,value:ga.call(xa,ba,El)}:{done:!1}},{REPLACE_KEEPS_$0:bt,REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE:dt}))[1];Ob(String.prototype,h,g[0]),Ob(fn,j,i==2?function(ga,ba){return _s.call(ga,this,ba)}:function(ga){return _s.call(ga,this)})}_&&ac(fn[j],"sham",!0)},dD=mb("match"),gn=function(h){var i;return fb(h)&&((i=h[dD])!==void 0?!!i:Qd(h)=="RegExp")},Rc=function(h){if(typeof h!="function")throw TypeError(String(h)+" is not a function");return h},eD=mb("species"),eg=function(h,i){var g;return(h=ub(h).constructor)===void 0||(g=ub(h)[eD])==null?i:Rc(g)},et=function(h){return function(i,g){i=String(Ec(i)),g=Rd(g);var _,j=i.length;if(0>g||g>=j)return h?"":void 0;var $=i.charCodeAt(g);return 55296>$||56319<$||g+1===j||56320>(_=i.charCodeAt(g+1))||57343<_?h?i.charAt(g):$:h?i.slice(g,g+2):_-56320+($-55296<<10)+65536}},fD=et(!1),ft=et(!0),hn=function(h,i,g){return i+(g?ft(h,i).length:1)},mh=function(h,i){var g=h.exec;if(typeof g=="function"){if(typeof(h=g.call(h,i))!="object")throw TypeError("RegExp exec method returned something other than an Object or null");return h}if(Qd(h)!=="RegExp")throw TypeError("RegExp#exec called on incompatible receiver");return Bi.call(h,i)},gD=[].push,hD=Math.min;jk("split",2,function(h,i,g){var _="abbc".split(/(b)*/)[1]=="c"||"test".split(/(?:)/,-1).length!=4||"ab".split(/(?:ab)*/).length!=2||".".split(/(.?)(.?)/).length!=4||1<".".split(/()()/).length||"".split(/.?/).length?function(j,$){var _n=String(Ec(this));if(($=$===void 0?4294967295:$>>>0)===0)return[];if(j===void 0)return[_n];if(!gn(j))return i.call(_n,j,$);var _i,_s,ga,ba=[],xa=0;for(j=new RegExp(j.source,(j.ignoreCase?"i":"")+(j.multiline?"m":"")+(j.unicode?"u":"")+(j.sticky?"y":"")+"g");(_i=Bi.call(j,_n))&&!((_s=j.lastIndex)>xa&&(ba.push(_n.slice(xa,_i.index)),1<_i.length&&_i.index<_n.length&&gD.apply(ba,_i.slice(1)),ga=_i[0].length,xa=_s,ba.length>=$));)j.lastIndex===_i.index&&j.lastIndex++;return xa===_n.length?(ga||!j.test(""))&&ba.push(""):ba.push(_n.slice(xa)),ba.length>$?ba.slice(0,$):ba}:"0".split(void 0,0).length?function(j,$){return j===void 0&&$===0?[]:i.call(this,j,$)}:i;return[function(j,$){var _n=Ec(this),_i=j==null?void 0:j[h];return _i!==void 0?_i.call(j,_n,$):_.call(String(_n),j,$)},function(j,$){var _n=g(_,j,this,$,_!==i);if(_n.done)return _n.value;var _i=ub(j);j=String(this);var _s=eg(_i,RegExp);if(_n=_i.unicode,_i=new _s(Sd?"^(?:"+_i.source+")":_i,(_i.ignoreCase?"i":"")+(_i.multiline?"m":"")+(_i.unicode?"u":"")+(Sd?"g":"y")),($=$===void 0?4294967295:$>>>0)===0)return[];if(j.length===0)return mh(_i,j)===null?[j]:[];var ga=0,ba=0;for(_s=[];ba<j.length;){_i.lastIndex=Sd?0:ba;var xa,El=mh(_i,Sd?j.slice(ba):j);if(El===null||(xa=hD(xb(_i.lastIndex+(Sd?ba:0)),j.length))===ga)ba=hn(j,ba,_n);else{if(_s.push(j.slice(ga,ba)),_s.length===$)return _s;for(ga=1;ga<=El.length-1;ga++)if(_s.push(El[ga]),_s.length===$)return _s;ba=ga=xa}}return _s.push(j.slice(ga)),_s}]},Sd);var iD=/^[\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff][\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff]*/,jD=/[\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff][\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff]*$/,jn=function(h){return function(i){return i=String(Ec(i)),1&h&&(i=i.replace(iD,"")),2&h&&(i=i.replace(jD,"")),i}},kD=jn(1),lD=jn(2),kk=jn(3),lk=na.parseInt,mD=/^[+-]?0[Xx]/,gt=lk(`	
\v\f\r                　\u2028\u2029\uFEFF08`)!==8||lk(`	
\v\f\r                　\u2028\u2029\uFEFF0x16`)!==22?function(h,i){return h=kk(String(h)),lk(h,i>>>0||(mD.test(h)?16:10))}:lk;wa({global:!0,forced:parseInt!=gt},{parseInt:gt});var tf=function(h,i,g){if(Rc(h),i===void 0)return h;switch(g){case 0:return function(){return h.call(i)};case 1:return function(_){return h.call(i,_)};case 2:return function(_,j){return h.call(i,_,j)};case 3:return function(_,j,$){return h.call(i,_,j,$)}}return function(){return h.apply(i,arguments)}},uf=Array.isArray||function(h){return Qd(h)=="Array"},nD=mb("species"),Ei=function(h,i){if(uf(h)){var g=h.constructor;typeof g!="function"||g!==Array&&!uf(g.prototype)?fb(g)&&(g=g[nD])===null&&(g=void 0):g=void 0}return new(g===void 0?Array:g)(i===0?0:i)},ht=[].push,vf=function(h){var i=h==1,g=h==2,_=h==3,j=h==4,$=h==6,_n=h==7,_i=h==5||$;return function(_s,ga,ba,xa){var El=Zb(_s),Tl=zi(El);ga=tf(ga,ba,3),ba=xb(Tl.length);var Sl,Il=0;for(xa=xa||Ei,_s=i?xa(_s,ba):g||_n?xa(_s,0):void 0;ba>Il;Il++)if((_i||Il in Tl)&&(Sl=ga(xa=Tl[Il],Il,El),h))if(i)_s[Il]=Sl;else if(Sl)switch(h){case 3:return!0;case 5:return xa;case 6:return Il;case 2:ht.call(_s,xa)}else switch(h){case 4:return!1;case 7:ht.call(_s,xa)}return $?-1:_||j?j:_s}},fg=vf(0),it=vf(1),jt=vf(2),oD=vf(3),pD=vf(4),kt=vf(5),lt=vf(6),qD=mb("species"),Fi=function(h){return 51<=oe||!Ga(function(){var i=[];return(i.constructor={})[qD]=function(){return{foo:1}},i[h](Boolean).foo!==1})},rD=Fi("filter");wa({target:"Array",proto:!0,forced:!rD},{filter:function(h){return jt(this,h,1<arguments.length?arguments[1]:void 0)}});var Ie=Object.keys||function(h){return Ts(h,gk)},sD=Ga(function(){Ie(1)});wa({target:"Object",stat:!0,forced:sD},{keys:function(h){return Ie(Zb(h))}});var gg=function(h,i){var g=[][h];return!!g&&Ga(function(){g.call(null,i||function(){throw 1},1)})},tD=[].join,uD=zi!=Object,vD=gg("join",",");wa({target:"Array",proto:!0,forced:uD||!vD},{join:function(h){return tD.call(Qc(this),h===void 0?",":h)}});var wD=Fi("map");wa({target:"Array",proto:!0,forced:!wD},{map:function(h){return it(this,h,1<arguments.length?arguments[1]:void 0)}});var kn=function(h){var i=h.return;if(i!==void 0)return ub(i.call(h)).value},nh={},xD=mb("iterator"),yD=Array.prototype,ln=function(h){return h!==void 0&&(nh.Array===h||yD[xD]===h)},oh=function(h,i,g){(i=le(i))in h?$b.f(h,i,ke(0,g)):h[i]=g},zD=mb("toStringTag"),mt={};mt[zD]="z";var mn=String(mt)==="[object z]",AD=mb("toStringTag"),BD=Qd(function(){return arguments}())=="Arguments",ph=mn?Qd:function(h){var i;if(h===void 0)var g="Undefined";else{if(h===null)var _="Null";else{e:{var j=h=Object(h);try{_=j[AD];break e}catch{}_=void 0}_=typeof(g=_)=="string"?g:BD?Qd(h):(i=Qd(h))=="Object"&&typeof h.callee=="function"?"Arguments":i}g=_}return g},CD=mb("iterator"),Gi=function(h){if(h!=null)return h[CD]||h["@@iterator"]||nh[ph(h)]},hg=function(h){var i,g=Zb(h),_=typeof this=="function"?this:Array,j=arguments.length,$=1<j?arguments[1]:void 0,_n=$!==void 0,_i=Gi(g),_s=0;if(_n&&($=tf($,2<j?arguments[2]:void 0,2)),_i==null||_==Array&&ln(_i)){var ga=xb(g.length);for(_=new _(ga);ga>_s;_s++)_i=_n?$(g[_s],_s):g[_s],oh(_,_s,_i)}else for(j=(g=_i.call(g)).next,_=new _;!(i=j.call(g)).done;_s++){if(_n){_i=g;var ba=$;i=[i.value,_s];try{ga=ba(ub(i)[0],i[1])}catch(xa){throw kn(_i),xa}}else ga=i.value;oh(_,_s,_i=ga)}return _.length=_s,_},nt=mb("iterator"),ot=!1;try{var DD=0,pt={next:function(){return{done:!!DD++}},return:function(){ot=!0}};pt[nt]=function(){return this},Array.from(pt,function(){throw 2})}catch(h){}var mk=function(h,i){if(!i&&!ot)return!1;var g=!1;try{(i={})[nt]=function(){return{next:function(){return{done:g=!0}}}},h(i)}catch{}return g},ED=!mk(function(h){Array.from(h)});wa({target:"Array",stat:!0,forced:ED},{from:hg});var qt=!Ga(function(){function h(){}return h.prototype.constructor=null,Object.getPrototypeOf(new h)!==h.prototype}),rt=ek("IE_PROTO"),FD=Object.prototype,Md=qt?Object.getPrototypeOf:function(h){return h=Zb(h),Fa(h,rt)?h[rt]:typeof h.constructor=="function"&&h instanceof h.constructor?h.constructor.prototype:h instanceof Object?FD:null},nn=mb("iterator"),st=!1,GD=function(){return this},ig;if([].keys){var tt=[].keys();if("next"in tt){var ut=Md(Md(tt));ut!==Object.prototype&&(ig=ut)}else st=!0}(ig==null||Ga(function(){var h={};return ig[nn].call(h)!==h}))&&(ig={}),Fa(ig,nn)||ac(ig,nn,GD);var nk=ig,ok=st,vt=cb?Object.defineProperties:function(h,i){ub(h);for(var g,_=Ie(i),j=_.length,$=0;j>$;)$b.f(h,g=_[$++],i[g]);return h},on=me("document","documentElement"),wt=ek("IE_PROTO"),pn=function(){},qn,pk=function(){try{qn=document.domain&&new ActiveXObject("htmlfile")}catch{}if(qn){var h=qn;h.write("<script><\/script>"),h.close(),h=h.parentWindow.Object}else(h=dk?hh.createElement("iframe"):{}).style.display="none",on.appendChild(h),h.src="javascript:",(h=h.contentWindow.document).open(),h.write("<script>document.F=Object<\/script>"),h.close(),h=h.F;for(pk=h,h=gk.length;h--;)delete pk.prototype[gk[h]];return pk()};jh[wt]=!0;var vd=Object.create||function(h,i){if(h!==null){pn.prototype=ub(h);var g=new pn;pn.prototype=null,g[wt]=h}else g=pk();return i===void 0?g:vt(g,i)},HD=$b.f,xt=mb("toStringTag"),Td=function(h,i,g){h&&!Fa(h=g?h:h.prototype,xt)&&HD(h,xt,{configurable:!0,value:i})},ID=function(){return this},yt=function(h,i,g){return i+=" Iterator",h.prototype=vd(nk,{next:ke(1,g)}),Td(h,i,!1),nh[i]=ID,h},gc=Object.setPrototypeOf||("__proto__"in{}?function(){var h=!1,i={};try{var g=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set;g.call(i,[]),h=i instanceof Array}catch{}return function(_,j){if(ub(_),!fb(j)&&j!==null)throw TypeError("Can't set "+String(j)+" as a prototype");return h?g.call(_,j):_.__proto__=j,_}}():void 0),Hi=mb("iterator"),JD=function(){return this},rn=function(h,i,g,_,j,$,_n){yt(g,i,_),_=function(Il){if(Il===j&&El)return El;if(!ok&&Il in ba)return ba[Il];switch(Il){case"keys":case"values":case"entries":return function(){return new g(this,Il)}}return function(){return new g(this)}};var _i,_s=i+" Iterator",ga=!1,ba=h.prototype,xa=ba[Hi]||ba["@@iterator"]||j&&ba[j],El=!ok&&xa||_(j),Tl=i=="Array"&&ba.entries||xa;if(Tl&&(h=Md(Tl.call(new h)),nk!==Object.prototype&&h.next&&(Md(h)!==nk&&(gc?gc(h,nk):typeof h[Hi]!="function"&&ac(h,Hi,JD)),Td(h,_s,!0))),j=="values"&&xa&&xa.name!=="values"&&(ga=!0,El=function(){return xa.call(this)}),ba[Hi]!==El&&ac(ba,Hi,El),nh[i]=El,j){var Sl={values:_("values"),keys:$?El:_("keys"),entries:_("entries")};if(_n)for(_i in Sl)!ok&&!ga&&_i in ba||Ob(ba,_i,Sl[_i]);else wa({target:i,proto:!0,forced:ok||ga},Sl)}return Sl},KD=Sb.set,LD=Sb.getterFor("String Iterator");rn(String,"String",function(h){KD(this,{type:"String Iterator",string:String(h),index:0})},function(){var h=LD(this),i=h.string,g=h.index;return g>=i.length?{value:void 0,done:!0}:(i=ft(i,g),h.index+=i.length,{value:i,done:!1})});var sn=mb("unscopables"),tn=Array.prototype;tn[sn]==null&&$b.f(tn,sn,{configurable:!0,value:vd(null)});var wf=function(h){tn[sn][h]=!0},zt=!0;"find"in[]&&Array(1).find(function(){zt=!1}),wa({target:"Array",proto:!0,forced:zt},{find:function(h){return kt(this,h,1<arguments.length?arguments[1]:void 0)}}),wf("find");var At=function(h){var i=String(Ec(this)),g="";if(0>(h=Rd(h))||1/0==h)throw RangeError("Wrong number of repetitions");for(;0<h;(h>>>=1)&&(i+=i))1&h&&(g+=i);return g};wa({target:"String",proto:!0},{repeat:At});var Bt=[].indexOf,Ct=!!Bt&&0>1/[1].indexOf(1,-0),MD=gg("indexOf");wa({target:"Array",proto:!0,forced:Ct||!MD},{indexOf:function(h){return Ct?Bt.apply(this,arguments)||0:bn(this,h,1<arguments.length?arguments[1]:void 0)}});var JA=/(android|bb\d+|meego).+mobile|armv7l|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series[46]0|samsungbrowser|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i,KA=/CrOS/,LA=/android|ipad|playbook|silk/i;Kg.isMobile=Kg,Kg.default=Kg,wa({target:"Number",stat:!0},{MAX_SAFE_INTEGER:9007199254740991}),wa({target:"Number",stat:!0},{isNaN:function(h){return h!=h}}),na.Number.isNaN;var ND=mn?{}.toString:function(){return"[object "+ph(this)+"]"};mn||Ob(Object.prototype,"toString",ND,{unsafe:!0});var qk=na.Promise,qh=function(h,i,g){for(var _ in i)Ob(h,_,i[_],g);return h},Dt=mb("species"),Ii=function(h){h=me(h);var i=$b.f;cb&&h&&!h[Dt]&&i(h,Dt,{configurable:!0,get:function(){return this}})},Ud=function(h,i,g){if(!(h instanceof i))throw TypeError("Incorrect "+(g?g+" ":"")+"invocation");return h},Ji=function(h,i){this.stopped=h,this.result=i},rk=function(h,i,g){var _,j=!(!g||!g.AS_ENTRIES),$=!(!g||!g.IS_ITERATOR),_n=!(!g||!g.INTERRUPTED),_i=tf(i,g&&g.that,1+j+_n),_s=function(ba){return ga&&kn(ga),new Ji(!0,ba)};if(i=function(ba){return j?(ub(ba),_n?_i(ba[0],ba[1],_s):_i(ba[0],ba[1])):_n?_i(ba,_s):_i(ba)},$)var ga=h;else{if(typeof($=Gi(h))!="function")throw TypeError("Target is not iterable");if(ln($)){for($=0,g=xb(h.length);g>$;$++)if((_=i(h[$]))&&_ instanceof Ji)return _;return new Ji(!1)}ga=$.call(h)}for(h=ga.next;!($=h.call(ga)).done;){try{_=i($.value)}catch(ba){throw kn(ga),ba}if(typeof _=="object"&&_&&_ instanceof Ji)return _}return new Ji(!1)},Et=/(?:iphone|ipod|ipad).*applewebkit/i.test(lh),qe=Qd(na.process)=="process",sk=na.location,un=na.setImmediate,Ft=na.clearImmediate,OD=na.process,Gt=na.MessageChannel,vn=na.Dispatch,wn=0,Ki={},xn=function(h){if(Ki.hasOwnProperty(h)){var i=Ki[h];delete Ki[h],i()}},yn=function(h){return function(){xn(h)}},Ht=function(h){xn(h.data)},It=function(h){na.postMessage(h+"",sk.protocol+"//"+sk.host)};if(!un||!Ft)if(un=function(h){for(var i=[],g=1;arguments.length>g;)i.push(arguments[g++]);return Ki[++wn]=function(){(typeof h=="function"?h:Function(h)).apply(void 0,i)},Li(wn),wn},Ft=function(h){delete Ki[h]},qe)var Li=function(h){OD.nextTick(yn(h))};else if(vn&&vn.now)Li=function(h){vn.now(yn(h))};else if(Gt&&!Et){var Jt=new Gt,Kt=Jt.port2;Jt.port1.onmessage=Ht,Li=tf(Kt.postMessage,Kt,1)}else na.addEventListener&&typeof postMessage=="function"&&!na.importScripts&&sk&&sk.protocol!=="file:"&&!Ga(It)?(Li=It,na.addEventListener("message",Ht,!1)):Li="onreadystatechange"in(dk?hh.createElement("script"):{})?function(h){on.appendChild(dk?hh.createElement("script"):{}).onreadystatechange=function(){on.removeChild(this),xn(h)}}:function(h){setTimeout(yn(h),0)};var zn=un,PD=/web0s(?!.*chrome)/i.test(lh),QD=pd.f,Lt=na.MutationObserver||na.WebKitMutationObserver,Mt=na.document,Nt=na.process,tk=na.Promise,Ot=QD(na,"queueMicrotask"),Pt=Ot&&Ot.value,jg,Mi;if(!Pt){var vk=function(){var h;for(qe&&(h=Nt.domain)&&h.exit();jg;){var i=jg.fn;jg=jg.next;try{i()}catch(g){throw jg?uk():Mi=void 0,g}}Mi=void 0,h&&h.enter()};if(Et||qe||PD||!Lt||!Mt)if(tk&&tk.resolve){var An=tk.resolve(void 0);An.constructor=tk;var RD=An.then,uk=function(){RD.call(An,vk)}}else uk=qe?function(){Nt.nextTick(vk)}:function(){zn.call(na,vk)};else{var Qt=!0,Rt=Mt.createTextNode("");new Lt(vk).observe(Rt,{characterData:!0}),uk=function(){Rt.data=Qt=!Qt}}}var St=Pt||function(h){h={fn:h,next:void 0},Mi&&(Mi.next=h),jg||(jg=h,uk()),Mi=h},SD=function(h){var i,g;this.promise=new h(function(_,j){if(i!==void 0||g!==void 0)throw TypeError("Bad Promise constructor");i=_,g=j}),this.resolve=Rc(i),this.reject=Rc(g)},Bn={f:function(h){return new SD(h)}},TD=function(h,i){var g=na.console;g&&g.error&&(arguments.length===1?g.error(h):g.error(h,i))},Cn=function(h){try{return{error:!1,value:h()}}catch(i){return{error:!0,value:i}}},UD=typeof window=="object",VD=mb("species"),Tt=Sb.get,WD=Sb.set,XD=Sb.getterFor("Promise"),kg=qk&&qk.prototype,ed=qk,wk=kg,Ut=na.TypeError,Dn=na.document,En=na.process,rh=Bn.f,YD=rh,ZD=!!(Dn&&Dn.createEvent&&na.dispatchEvent),Vt=typeof PromiseRejectionEvent=="function",Wt=!1,Ni=ne("Promise",function(){var h=Zm(ed)!==String(ed);if(!h&&oe===66)return!0;if(51<=oe&&/native code/.test(ed))return!1;var i=new ed(function(_){_(1)}),g=function(_){_(function(){},function(){})};return(i.constructor={})[VD]=g,!(Wt=i.then(function(){})instanceof g)||!h&&UD&&!Vt}),$D=Ni||!mk(function(h){ed.all(h).catch(function(){})}),Xt=function(h){var i;return!(!fb(h)||typeof(i=h.then)!="function")&&i},Fn=function(h,i){if(!h.notified){h.notified=!0;var g=h.reactions;St(function(){for(var _=h.value,j=h.state==1,$=0;g.length>$;){var _n,_i=g[$++],_s=j?_i.ok:_i.fail,ga=_i.resolve,ba=_i.reject,xa=_i.domain;try{if(_s){if(j||(h.rejection===2&&aE(h),h.rejection=1),_s===!0)var El=_;else if(xa&&xa.enter(),El=_s(_),xa){xa.exit();var Tl=!0}El===_i.promise?ba(Ut("Promise-chain cycle")):(_n=Xt(El))?_n.call(El,ga,ba):ga(El)}else ba(_)}catch(Sl){xa&&!Tl&&xa.exit(),ba(Sl)}}h.reactions=[],h.notified=!1,i&&!h.rejection&&bE(h)})}},Yt=function(h,i,g){var _;if(ZD){var j=Dn.createEvent("Event");j.promise=i,j.reason=g,j.initEvent(h,!1,!0),na.dispatchEvent(j)}else j={promise:i,reason:g};!Vt&&(_=na["on"+h])?_(j):h==="unhandledrejection"&&TD("Unhandled promise rejection",g)},bE=function(h){zn.call(na,function(){var i=h.facade,g=h.value;if(h.rejection!==1&&!h.parent){var _=Cn(function(){qe?En.emit("unhandledRejection",g,i):Yt("unhandledrejection",i,g)});if(h.rejection=qe||h.rejection!==1&&!h.parent?2:1,_.error)throw _.value}})},aE=function(h){zn.call(na,function(){var i=h.facade;qe?En.emit("rejectionHandled",i):Yt("rejectionhandled",i,h.value)})},sh=function(h,i,g){return function(_){h(i,_,g)}},th=function(h,i,g){h.done||(h.done=!0,g&&(h=g),h.value=i,h.state=2,Fn(h,!0))},Gn=function(h,i,g){if(!h.done){h.done=!0,g&&(h=g);try{if(h.facade===i)throw Ut("Promise can't be resolved itself");var _=Xt(i);_?St(function(){var j={done:!1};try{_.call(i,sh(Gn,j,h),sh(th,j,h))}catch($){th(j,$,h)}}):(h.value=i,h.state=1,Fn(h,!1))}catch(j){th({done:!1},j,h)}}};if(Ni){ed=function(h){Ud(this,ed,"Promise"),Rc(h),Hn.call(this);var i=Tt(this);try{h(sh(Gn,i),sh(th,i))}catch(g){th(i,g)}},wk=ed.prototype;var Hn=function(h){WD(this,{type:"Promise",done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})};Hn.prototype=qh(wk,{then:function(h,i){var g=XD(this),_=rh(eg(this,ed));return _.ok=typeof h!="function"||h,_.fail=typeof i=="function"&&i,_.domain=qe?En.domain:void 0,g.parent=!0,g.reactions.push(_),g.state!=0&&Fn(g,!1),_.promise},catch:function(h){return this.then(void 0,h)}});var cE=function(){var h=new Hn,i=Tt(h);this.promise=h,this.resolve=sh(Gn,i),this.reject=sh(th,i)};if(Bn.f=rh=function(h){return h===ed||h===dE?new cE(h):YD(h)},typeof qk=="function"&&kg!==Object.prototype){var eE=kg.then;Wt||(Ob(kg,"then",function(h,i){var g=this;return new ed(function(_,j){eE.call(g,_,j)}).then(h,i)},{unsafe:!0}),Ob(kg,"catch",wk.catch,{unsafe:!0}));try{delete kg.constructor}catch{}gc&&gc(kg,wk)}}wa({global:!0,wrap:!0,forced:Ni},{Promise:ed}),Td(ed,"Promise",!1),Ii("Promise");var dE=me("Promise");wa({target:"Promise",stat:!0,forced:Ni},{reject:function(h){var i=rh(this);return i.reject.call(void 0,h),i.promise}}),wa({target:"Promise",stat:!0,forced:Ni},{resolve:function(h){if(ub(this),!fb(h)||h.constructor!==this){var i=Bn.f(this);(0,i.resolve)(h),h=i.promise}return h}}),wa({target:"Promise",stat:!0,forced:$D},{all:function(h){var i=this,g=rh(i),_=g.resolve,j=g.reject,$=Cn(function(){var _n=Rc(i.resolve),_i=[],_s=0,ga=1;rk(h,function(ba){var xa=_s++,El=!1;_i.push(void 0),ga++,_n.call(i,ba).then(function(Tl){El||(El=!0,_i[xa]=Tl,--ga||_(_i))},j)}),--ga||_(_i)});return $.error&&j($.value),g.promise},race:function(h){var i=this,g=rh(i),_=g.reject,j=Cn(function(){var $=Rc(i.resolve);rk(h,function(_n){$.call(i,_n).then(g.resolve,_)})});return j.error&&_(j.value),g.promise}});var fE=Math.floor,gE="".replace,hE=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,iE=/\$([$&'`]|\d{1,2})/g,jE=function(h,i,g,_,j,$){var _n=g+h.length,_i=_.length,_s=iE;return j!==void 0&&(j=Zb(j),_s=hE),gE.call($,_s,function(ga,ba){switch(ba.charAt(0)){case"$":return"$";case"&":return h;case"`":return i.slice(0,g);case"'":return i.slice(_n);case"<":ga=j[ba.slice(1,-1)];break;default:var xa=+ba;if(xa===0)return ga;if(xa>_i)return(xa=fE(xa/10))===0?ga:xa<=_i?_[xa-1]===void 0?ba.charAt(1):_[xa-1]+ba.charAt(1):ga;ga=_[xa-1]}return ga===void 0?"":ga})},kE=Math.max,lE=Math.min;jk("replace",2,function(h,i,g,_){var j=_.REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE,$=_.REPLACE_KEEPS_$0,_n=j?"$":"$0";return[function(_i,_s){var ga=Ec(this),ba=_i==null?void 0:_i[h];return ba!==void 0?ba.call(_i,ga,_s):i.call(String(ga),_i,_s)},function(_i,_s){if(!j&&$||typeof _s=="string"&&_s.indexOf(_n)===-1){var ga=g(i,_i,this,_s);if(ga.done)return ga.value}var ba=ub(_i);_i=String(this),(ga=typeof _s=="function")||(_s=String(_s));var xa=ba.global;if(xa){var El=ba.unicode;ba.lastIndex=0}for(var Tl=[];;){var Sl=mh(ba,_i);if(Sl===null||(Tl.push(Sl),!xa))break;String(Sl[0])===""&&(ba.lastIndex=hn(_i,xb(ba.lastIndex),El))}for(El="",xa=ba=0;xa<Tl.length;xa++){Sl=Tl[xa];for(var Il=String(Sl[0]),Cl=kE(lE(Rd(Sl.index),_i.length),0),Nl=[],Dl=1;Dl<Sl.length;Dl++){var Ul=Nl,Kl=Sl[Dl];Ul.push.call(Ul,Kl===void 0?Kl:String(Kl))}Sl=Sl.groups,ga?(Nl=[Il].concat(Nl,Cl,_i),Sl!==void 0&&Nl.push(Sl),Sl=String(_s.apply(void 0,Nl))):Sl=jE(Il,_i,Cl,Nl,Sl,_s),Cl>=ba&&(El+=_i.slice(ba,Cl)+Sl,ba=Cl+Il.length)}return El+_i.slice(ba)}]});var mE=Fi("slice"),nE=mb("species"),oE=[].slice,pE=Math.max;wa({target:"Array",proto:!0,forced:!mE},{slice:function(h,i){var g=Qc(this),_=xb(g.length);if(h=dd(h,_),i=dd(i===void 0?_:i,_),uf(g)){var j=g.constructor;if(typeof j!="function"||j!==Array&&!uf(j.prototype)?fb(j)&&(j=j[nE])===null&&(j=void 0):j=void 0,j===Array||j===void 0)return oE.call(g,h,i)}for(j=new(j===void 0?Array:j)(pE(i-h,0)),_=0;h<i;h++,_++)h in g&&oh(j,_,g[h]);return j.length=_,j}});var qE=Sb.set,rE=Sb.getterFor("Array Iterator"),xf=rn(Array,"Array",function(h,i){qE(this,{type:"Array Iterator",target:Qc(h),index:0,kind:i})},function(){var h=rE(this),i=h.target,g=h.kind,_=h.index++;return!i||_>=i.length?(h.target=void 0,{value:void 0,done:!0}):g=="keys"?{value:_,done:!1}:g=="values"?{value:i[_],done:!1}:{value:[_,i[_]],done:!1}},"values");nh.Arguments=nh.Array,wf("keys"),wf("values"),wf("entries");var Zt=typeof ArrayBuffer<"u"&&typeof DataView<"u",uh=function(h){if(h===void 0)return 0;h=Rd(h);var i=xb(h);if(h!==i)throw RangeError("Wrong length or index");return i},sE=Math.abs,Je=Math.pow,tE=Math.floor,uE=Math.log,vE=Math.LN2,In=function(h){var i=Zb(this),g=xb(i.length),_=arguments.length,j=dd(1<_?arguments[1]:void 0,g);for(g=(_=2<_?arguments[2]:void 0)===void 0?g:dd(_,g);g>j;)i[j++]=h;return i},wE=dg.f,xE=$b.f,vh=Sb.get,$t=Sb.set,Vd=na.ArrayBuffer,fd=Vd,Wd=na.DataView,xk=Wd&&Wd.prototype,au=Object.prototype,yk=na.RangeError,bu=function(h,i,g){var _,j=Array(g),$=(1<<(g=8*g-i-1))-1,_n=$>>1,_i=i===23?Je(2,-24)-Je(2,-77):0,_s=0>h||h===0&&0>1/h?1:0,ga=0;if((h=sE(h))!=h||1/0===h){h=h!=h?1:0;var ba=$}else ba=tE(uE(h)/vE),1>h*(_=Je(2,-ba))&&(ba--,_*=2),2<=(h=1<=ba+_n?h+_i/_:h+_i*Je(2,1-_n))*_&&(ba++,_/=2),ba+_n>=$?(h=0,ba=$):1<=ba+_n?(h=(h*_-1)*Je(2,i),ba+=_n):(h=h*Je(2,_n-1)*Je(2,i),ba=0);for(;8<=i;j[ga++]=255&h,h/=256,i-=8);for(ba=ba<<i|h,g+=i;0<g;j[ga++]=255&ba,ba/=256,g-=8);return j[--ga]|=128*_s,j},cu=function(h,i){var g=h.length,_=8*g-i-1,j=(1<<_)-1,$=j>>1;_-=7,--g;var _n=h[g--],_i=127&_n;for(_n>>=7;0<_;_i=256*_i+h[g],g--,_-=8);var _s=_i&(1<<-_)-1;for(_i>>=-_,_+=i;0<_;_s=256*_s+h[g],g--,_-=8);if(_i===0)_i=1-$;else{if(_i===j)return _s?NaN:_n?-1/0:1/0;_s+=Je(2,i),_i-=$}return(_n?-1:1)*_s*Je(2,_i-i)},du=function(h){return[255&h]},eu=function(h){return[255&h,h>>8&255]},fu=function(h){return[255&h,h>>8&255,h>>16&255,h>>24&255]},gu=function(h){return h[3]<<24|h[2]<<16|h[1]<<8|h[0]},yE=function(h){return bu(h,23,4)},zE=function(h){return bu(h,52,8)},zk=function(h,i){xE(h.prototype,i,{get:function(){return vh(this)[i]}})},yf=function(h,i,g,_){g=uh(g);var j=vh(h);if(g+i>j.byteLength)throw yk("Wrong index");return h=vh(j.buffer).bytes,g+=j.byteOffset,i=h.slice(g,g+i),_?i:i.reverse()},zf=function(h,i,g,_,j,$){g=uh(g);var _n=vh(h);if(g+i>_n.byteLength)throw yk("Wrong index");for(h=vh(_n.buffer).bytes,g+=_n.byteOffset,_=_(+j),j=0;j<i;j++)h[g+j]=_[$?j:i-j-1]};if(Zt){if(!Ga(function(){Vd(1)})||!Ga(function(){new Vd(-1)})||Ga(function(){return new Vd,new Vd(1.5),new Vd(NaN),Vd.name!="ArrayBuffer"})){fd=function(h){return Ud(this,fd),new Vd(uh(h))};for(var AE=fd.prototype=Vd.prototype,hu=wE(Vd),iu=0,Jn;hu.length>iu;)(Jn=hu[iu++])in fd||ac(fd,Jn,Vd[Jn]);AE.constructor=fd}gc&&Md(xk)!==au&&gc(xk,au);var Ak=new Wd(new fd(2)),ju=xk.setInt8;Ak.setInt8(0,2147483648),Ak.setInt8(1,2147483649),!Ak.getInt8(0)&&Ak.getInt8(1)||qh(xk,{setInt8:function(h,i){ju.call(this,h,i<<24>>24)},setUint8:function(h,i){ju.call(this,h,i<<24>>24)}},{unsafe:!0})}else fd=function(h){Ud(this,fd,"ArrayBuffer"),h=uh(h),$t(this,{bytes:In.call(Array(h),0),byteLength:h}),cb||(this.byteLength=h)},Wd=function(h,i,g){Ud(this,Wd,"DataView"),Ud(h,fd,"DataView");var _=vh(h).byteLength;if(0>(i=Rd(i))||i>_)throw yk("Wrong offset");if(i+(g=g===void 0?_-i:xb(g))>_)throw yk("Wrong length");$t(this,{buffer:h,byteLength:g,byteOffset:i}),cb||(this.buffer=h,this.byteLength=g,this.byteOffset=i)},cb&&(zk(fd,"byteLength"),zk(Wd,"buffer"),zk(Wd,"byteLength"),zk(Wd,"byteOffset")),qh(Wd.prototype,{getInt8:function(h){return yf(this,1,h)[0]<<24>>24},getUint8:function(h){return yf(this,1,h)[0]},getInt16:function(h){var i=yf(this,2,h,1<arguments.length?arguments[1]:void 0);return(i[1]<<8|i[0])<<16>>16},getUint16:function(h){var i=yf(this,2,h,1<arguments.length?arguments[1]:void 0);return i[1]<<8|i[0]},getInt32:function(h){return gu(yf(this,4,h,1<arguments.length?arguments[1]:void 0))},getUint32:function(h){return gu(yf(this,4,h,1<arguments.length?arguments[1]:void 0))>>>0},getFloat32:function(h){return cu(yf(this,4,h,1<arguments.length?arguments[1]:void 0),23)},getFloat64:function(h){return cu(yf(this,8,h,1<arguments.length?arguments[1]:void 0),52)},setInt8:function(h,i){zf(this,1,h,du,i)},setUint8:function(h,i){zf(this,1,h,du,i)},setInt16:function(h,i){zf(this,2,h,eu,i,2<arguments.length?arguments[2]:void 0)},setUint16:function(h,i){zf(this,2,h,eu,i,2<arguments.length?arguments[2]:void 0)},setInt32:function(h,i){zf(this,4,h,fu,i,2<arguments.length?arguments[2]:void 0)},setUint32:function(h,i){zf(this,4,h,fu,i,2<arguments.length?arguments[2]:void 0)},setFloat32:function(h,i){zf(this,4,h,yE,i,2<arguments.length?arguments[2]:void 0)},setFloat64:function(h,i){zf(this,8,h,zE,i,2<arguments.length?arguments[2]:void 0)}});Td(fd,"ArrayBuffer"),Td(Wd,"DataView");var Oi={ArrayBuffer:fd,DataView:Wd},Kn=Oi.ArrayBuffer,ku=Oi.DataView,lu=Kn.prototype.slice,BE=Ga(function(){return!new Kn(2).slice(1,void 0).byteLength});wa({target:"ArrayBuffer",proto:!0,unsafe:!0,forced:BE},{slice:function(h,i){if(lu!==void 0&&i===void 0)return lu.call(ub(this),h);var g=ub(this).byteLength;h=dd(h,g),i=dd(i===void 0?g:i,g),g=new(eg(this,Kn))(xb(i-h));for(var _=new ku(this),j=new ku(g),$=0;h<i;)j.setUint8($++,_.getUint8(h++));return g}});var CE=$b.f,Bk=na.Int8Array,Ln=Bk&&Bk.prototype,mu=na.Uint8ClampedArray,nu=mu&&mu.prototype,re=Bk&&Md(Bk),Xd=Ln&&Md(Ln),ou=Object.prototype,pu=ou.isPrototypeOf,qu=mb("toStringTag"),Mn=ih("TYPED_ARRAY_TAG"),Ke=Zt&&!!gc&&ph(na.opera)!=="Opera",ru=!1,gd,se={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},DE={BigInt64Array:8,BigUint64Array:8},Ck=function(h){return!!fb(h)&&(h=ph(h),Fa(se,h)||Fa(DE,h))};for(gd in se)na[gd]||(Ke=!1);if((!Ke||typeof re!="function"||re===Function.prototype)&&(re=function(){throw TypeError("Incorrect invocation")},Ke))for(gd in se)na[gd]&&gc(na[gd],re);if((!Ke||!Xd||Xd===ou)&&(Xd=re.prototype,Ke))for(gd in se)na[gd]&&gc(na[gd].prototype,Xd);if(Ke&&Md(nu)!==Xd&&gc(nu,Xd),cb&&!Fa(Xd,qu))for(gd in ru=!0,CE(Xd,qu,{get:function(){return fb(this)?this[Mn]:void 0}}),se)na[gd]&&ac(na[gd],Mn,gd);var Pi=Ke,su=ru&&Mn,Gb=function(h){if(Ck(h))return h;throw TypeError("Target is not a typed array")},wh=function(h){if(gc){if(pu.call(re,h))return h}else for(var i in se)if(Fa(se,gd)){var g=na[i];if(g&&(h===g||pu.call(g,h)))return h}throw TypeError("Target is not a typed array constructor")},Cb=function(h,i,g){if(cb){if(g)for(var _ in se){var j=na[_];if(j&&Fa(j.prototype,h))try{delete j.prototype[h]}catch{}}Xd[h]&&!g||Ob(Xd,h,g?i:Ke&&Ln[h]||i)}},tu=function(h,i,g){var _,j;if(cb){if(gc){if(g){for(_ in se)if((j=na[_])&&Fa(j,h))try{delete j[h]}catch{}}if(re[h]&&!g)return;try{return Ob(re,h,g?i:Ke&&re[h]||i)}catch{}}for(_ in se)!(j=na[_])||j[h]&&!g||Ob(j,h,i)}},uu=re,Qi=Xd,EE=na.ArrayBuffer,lg=na.Int8Array,Nn=!Pi||!Ga(function(){lg(1)})||!Ga(function(){new lg(-1)})||!mk(function(h){new lg,new lg(null),new lg(1.5),new lg(h)},!0)||Ga(function(){return new lg(new EE(2),1,void 0).length!==1}),Dk=function(h,i){if(0>(h=Rd(h)))throw RangeError("The argument can't be less than 0");if(h%i)throw RangeError("Wrong offset");return h},On=function(h){var i=Zb(h),g=arguments.length,_=1<g?arguments[1]:void 0,j=_!==void 0,$=Gi(i);if($!=null&&!ln($)){var _n=$.call(i),_i=_n.next;for(i=[];!($=_i.call(_n)).done;)i.push($.value)}for(j&&2<g&&(_=tf(_,arguments[2],2)),$=xb(i.length),_n=new(wh(this))($),g=0;$>g;g++)_n[g]=j?_(i[g],g):i[g];return _n},Ek=function(h,i,g){var _,j;return gc&&typeof(_=i.constructor)=="function"&&_!==g&&fb(j=_.prototype)&&j!==g.prototype&&gc(h,j),h},Ri=kc(function(h){var i=dg.f,g=Sb.get,_=Sb.set,j=$b.f,$=pd.f,_n=Math.round,_i=na.RangeError,_s=Oi.ArrayBuffer,ga=Oi.DataView,ba=function(Cl,Nl){var Dl=0,Ul=Nl.length;for(Cl=new(wh(Cl))(Ul);Ul>Dl;)Cl[Dl]=Nl[Dl++];return Cl},xa=function(Cl,Nl){j(Cl,Nl,{get:function(){return g(this)[Nl]}})},El=function(Cl){var Nl;return Cl instanceof _s||(Nl=ph(Cl))=="ArrayBuffer"||Nl=="SharedArrayBuffer"},Tl=function(Cl,Nl){return Ck(Cl)&&typeof Nl!="symbol"&&Nl in Cl&&String(+Nl)==String(Nl)},Sl=function(Cl,Nl){return Tl(Cl,Nl=le(Nl,!0))?ke(2,Cl[Nl]):$(Cl,Nl)},Il=function(Cl,Nl,Dl){return!(Tl(Cl,Nl=le(Nl,!0))&&fb(Dl)&&Fa(Dl,"value"))||Fa(Dl,"get")||Fa(Dl,"set")||Dl.configurable||Fa(Dl,"writable")&&!Dl.writable||Fa(Dl,"enumerable")&&!Dl.enumerable?j(Cl,Nl,Dl):(Cl[Nl]=Dl.value,Cl)};cb?(Pi||(pd.f=Sl,$b.f=Il,xa(Qi,"buffer"),xa(Qi,"byteOffset"),xa(Qi,"byteLength"),xa(Qi,"length")),wa({target:"Object",stat:!0,forced:!Pi},{getOwnPropertyDescriptor:Sl,defineProperty:Il}),h.exports=function(Cl,Nl,Dl){var Ul=Cl.match(/\d+$/)[0]/8,Kl=Cl+(Dl?"Clamped":"")+"Array",Jl="get"+Cl,Ep="set"+Cl,_p=na[Kl],Ip=_p;Cl=Ip&&Ip.prototype;var Up={},yp=function(Ap,Cp){j(Ap,Cp,{get:function(){var Mp=g(this);return Mp.view[Jl](Cp*Ul+Mp.byteOffset,!0)},set:function(Mp){var wp=g(this);Dl&&(Mp=0>(Mp=_n(Mp))?0:255<Mp?255:255&Mp),wp.view[Ep](Cp*Ul+wp.byteOffset,Mp,!0)},enumerable:!0})};Pi?Nn&&(Ip=Nl(function(Ap,Cp,Mp,wp){return Ud(Ap,Ip,Kl),Ek(fb(Cp)?El(Cp)?wp!==void 0?new _p(Cp,Dk(Mp,Ul),wp):Mp!==void 0?new _p(Cp,Dk(Mp,Ul)):new _p(Cp):Ck(Cp)?ba(Ip,Cp):On.call(Ip,Cp):new _p(uh(Cp)),Ap,Ip)}),gc&&gc(Ip,uu),fg(i(_p),function(Ap){Ap in Ip||ac(Ip,Ap,_p[Ap])}),Ip.prototype=Cl):(Ip=Nl(function(Ap,Cp,Mp,wp){Ud(Ap,Ip,Kl);var Np=0,Fp=0;if(fb(Cp)){if(!El(Cp))return Ck(Cp)?ba(Ip,Cp):On.call(Ip,Cp);var Hp=Cp;if(Fp=Dk(Mp,Ul),Cp=Cp.byteLength,wp===void 0){if(Cp%Ul||0>(wp=Cp-Fp))throw _i("Wrong length")}else if((wp=xb(wp)*Ul)+Fp>Cp)throw _i("Wrong length");Cp=wp/Ul}else Cp=uh(Cp),Hp=new _s(wp=Cp*Ul);for(_(Ap,{buffer:Hp,byteOffset:Fp,byteLength:wp,length:Cp,view:new ga(Hp)});Np<Cp;)yp(Ap,Np++)}),gc&&gc(Ip,uu),Cl=Ip.prototype=vd(Qi)),Cl.constructor!==Ip&&ac(Cl,"constructor",Ip),su&&ac(Cl,su,Kl),Up[Kl]=Ip,wa({global:!0,forced:Ip!=_p,sham:!Pi},Up),"BYTES_PER_ELEMENT"in Ip||ac(Ip,"BYTES_PER_ELEMENT",Ul),"BYTES_PER_ELEMENT"in Cl||ac(Cl,"BYTES_PER_ELEMENT",Ul),Ii(Kl)}):h.exports=function(){}});Ri("Uint8",function(h){return function(i,g,_){return h(this,i,g,_)}});var FE=Math.min,GE=[].copyWithin||function(h,i){var g=Zb(this),_=xb(g.length),j=dd(h,_),$=dd(i,_),_n=2<arguments.length?arguments[2]:void 0;for(_=FE((_n===void 0?_:dd(_n,_))-$,_-j),_n=1,$<j&&j<$+_&&(_n=-1,$+=_-1,j+=_-1);0<_--;)$ in g?g[j]=g[$]:delete g[j],j+=_n,$+=_n;return g};Cb("copyWithin",function(h,i){return GE.call(Gb(this),h,i,2<arguments.length?arguments[2]:void 0)}),Cb("every",function(h){return pD(Gb(this),h,1<arguments.length?arguments[1]:void 0)}),Cb("fill",function(h){return In.apply(Gb(this),arguments)}),Cb("filter",function(h){var i=jt(Gb(this),h,1<arguments.length?arguments[1]:void 0),g=eg(this,this.constructor),_=0,j=i.length;for(g=new(wh(g))(j);j>_;)g[_]=i[_++];return g}),Cb("find",function(h){return kt(Gb(this),h,1<arguments.length?arguments[1]:void 0)}),Cb("findIndex",function(h){return lt(Gb(this),h,1<arguments.length?arguments[1]:void 0)}),Cb("forEach",function(h){fg(Gb(this),h,1<arguments.length?arguments[1]:void 0)}),Cb("includes",function(h){return Ss(Gb(this),h,1<arguments.length?arguments[1]:void 0)}),Cb("indexOf",function(h){return bn(Gb(this),h,1<arguments.length?arguments[1]:void 0)});var vu=mb("iterator"),wu=na.Uint8Array,HE=xf.values,IE=xf.keys,JE=xf.entries,Pn=wu&&wu.prototype[vu],xu=!!Pn&&(Pn.name=="values"||Pn.name==null),yu=function(){return HE.call(Gb(this))};Cb("entries",function(){return JE.call(Gb(this))}),Cb("keys",function(){return IE.call(Gb(this))}),Cb("values",yu,!xu),Cb(vu,yu,!xu);var KE=[].join;Cb("join",function(h){return KE.apply(Gb(this),arguments)});var LE=Math.min,Qn=[].lastIndexOf,zu=!!Qn&&0>1/[1].lastIndexOf(1,-0),ME=gg("lastIndexOf"),Rn=zu||!ME?function(h){if(zu)return Qn.apply(this,arguments)||0;var i=Qc(this),g=xb(i.length),_=g-1;for(1<arguments.length&&(_=LE(_,Rd(arguments[1]))),0>_&&(_=g+_);0<=_;_--)if(_ in i&&i[_]===h)return _||0;return-1}:Qn;Cb("lastIndexOf",function(h){return Rn.apply(Gb(this),arguments)}),Cb("map",function(h){return it(Gb(this),h,1<arguments.length?arguments[1]:void 0,function(i,g){return new(wh(eg(i,i.constructor)))(g)})});var Au=function(h){return function(i,g,_,j){Rc(g),i=Zb(i);var $=zi(i),_n=xb(i.length),_i=h?_n-1:0,_s=h?-1:1;if(2>_)for(;;){if(_i in $){j=$[_i],_i+=_s;break}if(_i+=_s,h?0>_i:_n<=_i)throw TypeError("Reduce of empty array with no initial value")}for(;h?0<=_i:_n>_i;_i+=_s)_i in $&&(j=g(j,$[_i],_i,i));return j}},Bu=Au(!1),Cu=Au(!0);Cb("reduce",function(h){return Bu(Gb(this),h,arguments.length,1<arguments.length?arguments[1]:void 0)}),Cb("reduceRight",function(h){return Cu(Gb(this),h,arguments.length,1<arguments.length?arguments[1]:void 0)});var NE=Math.floor;Cb("reverse",function(){for(var h,i=Gb(this).length,g=NE(i/2),_=0;_<g;)h=this[_],this[_++]=this[--i],this[i]=h;return this});var OE=Ga(function(){new Int8Array(1).set({})});Cb("set",function(h){Gb(this);var i=Dk(1<arguments.length?arguments[1]:void 0,1),g=this.length,_=Zb(h),j=xb(_.length),$=0;if(j+i>g)throw RangeError("Wrong length");for(;$<j;)this[i+$]=_[$++]},OE);var PE=[].slice,QE=Ga(function(){new Int8Array(1).slice()});Cb("slice",function(h,i){h=PE.call(Gb(this),h,i);var g=eg(this,this.constructor);i=0;var _=h.length;for(g=new(wh(g))(_);_>i;)g[i]=h[i++];return g},QE),Cb("some",function(h){return oD(Gb(this),h,1<arguments.length?arguments[1]:void 0)});var RE=[].sort;Cb("sort",function(h){return RE.call(Gb(this),h)}),Cb("subarray",function(h,i){var g=Gb(this),_=g.length;return h=dd(h,_),new(eg(g,g.constructor))(g.buffer,g.byteOffset+h*g.BYTES_PER_ELEMENT,xb((i===void 0?_:dd(i,_))-h))});var Fk=na.Int8Array,Du=[].toLocaleString,SE=[].slice,TE=!!Fk&&Ga(function(){Du.call(new Fk(1))}),UE=Ga(function(){return[1,2].toLocaleString()!=new Fk([1,2]).toLocaleString()})||!Ga(function(){Fk.prototype.toLocaleString.call([1,2])});Cb("toLocaleString",function(){return Du.apply(TE?SE.call(Gb(this)):Gb(this),arguments)},UE);var Eu=na.Uint8Array,VE=Eu&&Eu.prototype||{},Gk=[].toString,WE=[].join;Ga(function(){Gk.call({})})&&(Gk=function(){return WE.call(this)}),Cb("toString",Gk,VE.toString!=Gk);var Fu=Oi.ArrayBuffer;wa({global:!0,forced:na.ArrayBuffer!==Fu},{ArrayBuffer:Fu}),Ii("ArrayBuffer");var XE=$b.f,Sn=Function.prototype,YE=Sn.toString,ZE=/^\s*function ([^ (]*)/;!cb||"name"in Sn||XE(Sn,"name",{configurable:!0,get:function(){try{return YE.call(this).match(ZE)[1]}catch{return""}}});var Gu=RegExp.prototype,Hu=Gu.toString,$E=Ga(function(){return Hu.call({source:"a",flags:"b"})!="/a/b"}),aF=Hu.name!="toString";($E||aF)&&Ob(RegExp.prototype,"toString",function(){var h=ub(this),i=String(h.source),g=h.flags;return"/"+i+"/"+(h=String(g===void 0&&h instanceof RegExp&&!("flags"in Gu)?hk.call(h):g))},{unsafe:!0});var bF=Fi("splice"),cF=Math.max,dF=Math.min;wa({target:"Array",proto:!0,forced:!bF},{splice:function(h,i){var g,_,j=Zb(this),$=xb(j.length),_n=dd(h,$),_i=arguments.length;if(_i===0?_i=g=0:_i===1?(_i=0,g=$-_n):(_i-=2,g=dF(cF(Rd(i),0),$-_n)),9007199254740991<$+_i-g)throw TypeError("Maximum allowed length exceeded");var _s=Ei(j,g);for(_=0;_<g;_++){var ga=_n+_;ga in j&&oh(_s,_,j[ga])}if(_s.length=g,_i<g){for(_=_n;_<$-g;_++){var ba=_+_i;(ga=_+g)in j?j[ba]=j[ga]:delete j[ba]}for(_=$;_>$-g+_i;_--)delete j[_-1]}else if(_i>g)for(_=$-g;_>_n;_--)ba=_+_i-1,(ga=_+g-1)in j?j[ba]=j[ga]:delete j[ba];for(_=0;_<_i;_++)j[_+_n]=arguments[_+2];return j.length=$-g+_i,_s}});var Tn={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Un=mb("iterator"),Iu=mb("toStringTag"),Vn=xf.values,Hk;for(Hk in Tn){var Ju=na[Hk],Le=Ju&&Ju.prototype;if(Le){if(Le[Un]!==Vn)try{ac(Le,Un,Vn)}catch{Le[Un]=Vn}if(Le[Iu]||ac(Le,Iu,Hk),Tn[Hk]){for(var xh in xf)if(Le[xh]!==xf[xh])try{ac(Le,xh,xf[xh])}catch{Le[xh]=xf[xh]}}}}var Ku=Object.is||function(h,i){return h===i?h!==0||1/h==1/i:h!=h&&i!=i};jk("search",1,function(h,i,g){return[function(_){var j=Ec(this),$=_==null?void 0:_[h];return $!==void 0?$.call(_,j):new RegExp(_)[h](String(j))},function(_){var j=g(i,_,this);if(j.done)return j.value;_=ub(_);var $=String(this);return j=_.lastIndex,Ku(j,0)||(_.lastIndex=0),$=mh(_,$),Ku(_.lastIndex,j)||(_.lastIndex=j),$===null?-1:$.index}]}),kc(function(h){(function(i,g){h.exports?h.exports=g(i):g(i)})(typeof self<"u"?self:qb,function(i){function g(yp){return btoa(yp).replace(/=+$/,"").replace(/\+/g,"-").replace(/\//g,"_")}function _(yp){return yp=(yp+="===").slice(0,-yp.length%4),atob(yp.replace(/-/g,"+").replace(/_/g,"/"))}function j(yp){for(var Ap=new Uint8Array(yp.length),Cp=0;Cp<yp.length;Cp++)Ap[Cp]=yp.charCodeAt(Cp);return Ap}function $(yp){return yp instanceof ArrayBuffer&&(yp=new Uint8Array(yp)),String.fromCharCode.apply(String,yp)}function _n(yp){var Ap={name:(yp.name||yp||"").toUpperCase().replace("V","v")};switch(Ap.name){case"SHA-1":case"SHA-256":case"SHA-384":case"SHA-512":break;case"AES-CBC":case"AES-GCM":case"AES-KW":yp.length&&(Ap.length=yp.length);break;case"HMAC":yp.hash&&(Ap.hash=_n(yp.hash)),yp.length&&(Ap.length=yp.length);break;case"RSAES-PKCS1-v1_5":yp.publicExponent&&(Ap.publicExponent=new Uint8Array(yp.publicExponent)),yp.modulusLength&&(Ap.modulusLength=yp.modulusLength);break;case"RSASSA-PKCS1-v1_5":case"RSA-OAEP":yp.hash&&(Ap.hash=_n(yp.hash)),yp.publicExponent&&(Ap.publicExponent=new Uint8Array(yp.publicExponent)),yp.modulusLength&&(Ap.modulusLength=yp.modulusLength);break;default:throw new SyntaxError("Bad algorithm name")}return Ap}function _i(yp){return{HMAC:{"SHA-1":"HS1","SHA-256":"HS256","SHA-384":"HS384","SHA-512":"HS512"},"RSASSA-PKCS1-v1_5":{"SHA-1":"RS1","SHA-256":"RS256","SHA-384":"RS384","SHA-512":"RS512"},"RSAES-PKCS1-v1_5":{"":"RSA1_5"},"RSA-OAEP":{"SHA-1":"RSA-OAEP","SHA-256":"RSA-OAEP-256"},"AES-KW":{128:"A128KW",192:"A192KW",256:"A256KW"},"AES-GCM":{128:"A128GCM",192:"A192GCM",256:"A256GCM"},"AES-CBC":{128:"A128CBC",192:"A192CBC",256:"A256CBC"}}[yp.name][(yp.hash||{}).name||yp.length||""]}function _s(yp){(yp instanceof ArrayBuffer||yp instanceof Uint8Array)&&(yp=JSON.parse(decodeURIComponent(escape($(yp)))));var Ap={kty:yp.kty,alg:yp.alg,ext:yp.ext||yp.extractable};switch(Ap.kty){case"oct":Ap.k=yp.k;case"RSA":"n e d p q dp dq qi oth".split(" ").forEach(function(Cp){Cp in yp&&(Ap[Cp]=yp[Cp])});break;default:throw new TypeError("Unsupported key type")}return Ap}function ga(yp){return yp=_s(yp),Jl&&(yp.extractable=yp.ext,delete yp.ext),j(unescape(encodeURIComponent(JSON.stringify(yp)))).buffer}function ba(yp){var Ap=xa(yp),Cp=!1;switch(2<Ap.length&&(Cp=!0,Ap.shift()),yp={ext:!0},Ap[0][0]){case"1.2.840.113549.1.1.1":var Mp="n e d p q dp dq qi".split(" ");for(Ap=xa(Ap[1]),Cp&&Ap.shift(),Cp=0;Cp<Ap.length;Cp++)Ap[Cp][0]||(Ap[Cp]=Ap[Cp].subarray(1)),yp[Mp[Cp]]=g($(Ap[Cp]));yp.kty="RSA";break;default:throw new TypeError("Unsupported key type")}return yp}function xa(yp,Ap){if(yp instanceof ArrayBuffer&&(yp=new Uint8Array(yp)),Ap||(Ap={pos:0,end:yp.length}),2>Ap.end-Ap.pos||Ap.end>yp.length)throw new RangeError("Malformed DER");var Cp=yp[Ap.pos++],Mp=yp[Ap.pos++];if(128<=Mp){if(Mp&=127,Ap.end-Ap.pos<Mp)throw new RangeError("Malformed DER");for(var wp=0;Mp--;)wp<<=8,wp|=yp[Ap.pos++];Mp=wp}if(Ap.end-Ap.pos<Mp)throw new RangeError("Malformed DER");switch(Cp){case 2:Cp=yp.subarray(Ap.pos,Ap.pos+=Mp);break;case 3:if(yp[Ap.pos++])throw Error("Unsupported bit string");Mp--;case 4:Cp=new Uint8Array(yp.subarray(Ap.pos,Ap.pos+=Mp)).buffer;break;case 5:Cp=null;break;case 6:if(!((yp=btoa($(yp.subarray(Ap.pos,Ap.pos+=Mp))))in _p))throw Error("Unsupported OBJECT ID "+yp);Cp=_p[yp];break;case 48:for(Cp=[],Mp=Ap.pos+Mp;Ap.pos<Mp;)Cp.push(xa(yp,Ap));break;default:throw Error("Unsupported DER tag 0x"+Cp.toString(16))}return Cp}function El(yp,Ap){Ap||(Ap=[]);var Cp=Ap.length+2;if(Ap.push(0,0),yp instanceof Uint8Array)for(var Mp=2,wp=yp.length,Np=0;Np<wp;Np++)Ap.push(yp[Np]);else if(yp instanceof ArrayBuffer)for(Mp=4,wp=yp.byteLength,yp=new Uint8Array(yp),Np=0;Np<wp;Np++)Ap.push(yp[Np]);else if(yp===null)Mp=5,wp=0;else if(typeof yp=="string"&&yp in Ip)for(Mp=6,wp=(yp=j(atob(Ip[yp]))).length,Np=0;Np<wp;Np++)Ap.push(yp[Np]);else if(yp instanceof Array){for(Np=0;Np<yp.length;Np++)El(yp[Np],Ap);Mp=48,wp=Ap.length-Cp}else{if(!(Ia(yp)==="object"&&yp.tag===3&&yp.value instanceof ArrayBuffer))throw Error("Unsupported DER value "+yp);for(Mp=3,wp=(yp=new Uint8Array(yp.value)).byteLength,Ap.push(0),Np=0;Np<wp;Np++)Ap.push(yp[Np]);wp++}if(128<=wp){for(Np=wp,wp=4,Ap.splice(Cp,0,Np>>24&255,Np>>16&255,Np>>8&255,255&Np);1<wp&&!(Np>>24);)Np<<=8,wp--;4>wp&&Ap.splice(Cp,4-wp),wp|=128}return Ap.splice(Cp-2,2,Mp,wp),Ap}function Tl(yp,Ap,Cp,Mp){Object.defineProperties(this,{_key:{value:yp},type:{value:yp.type,enumerable:!0},extractable:{value:Cp===void 0?yp.extractable:Cp,enumerable:!0},algorithm:{value:Ap===void 0?yp.algorithm:Ap,enumerable:!0},usages:{value:Mp===void 0?yp.usages:Mp,enumerable:!0}})}function Sl(yp){return yp==="verify"||yp==="encrypt"||yp==="wrapKey"}function Il(yp){return yp==="sign"||yp==="decrypt"||yp==="unwrapKey"}if(typeof Promise!="function")throw"Promise support required";var Cl=i.crypto||i.msCrypto;if(Cl){var Nl=Cl.subtle||Cl.webkitSubtle;if(Nl){var Dl=i.Crypto||Cl.constructor||Object,Ul=i.SubtleCrypto||Nl.constructor||Object;i.CryptoKey||i.Key;var Kl=-1<i.navigator.userAgent.indexOf("Edge/"),Jl=!!i.msCrypto&&!Kl,Ep=!Cl.subtle&&!!Cl.webkitSubtle;if(Jl||Ep){var _p={KoZIhvcNAQEB:"1.2.840.113549.1.1.1"},Ip={"1.2.840.113549.1.1.1":"KoZIhvcNAQEB"};if(["generateKey","importKey","unwrapKey"].forEach(function(yp){var Ap=Nl[yp];Nl[yp]=function(Cp,Mp,wp){var Np=[].slice.call(arguments);switch(yp){case"generateKey":var Fp=_n(Cp),Hp=Mp,xp=wp;break;case"importKey":Fp=_n(wp),Hp=Np[3],xp=Np[4],Cp==="jwk"&&((Mp=_s(Mp)).alg||(Mp.alg=_i(Fp)),Mp.key_ops||(Mp.key_ops=Mp.kty!=="oct"?"d"in Mp?xp.filter(Il):xp.filter(Sl):xp.slice()),Np[1]=ga(Mp));break;case"unwrapKey":Fp=Np[4],Hp=Np[5],xp=Np[6],Np[2]=wp._key}if(yp==="generateKey"&&Fp.name==="HMAC"&&Fp.hash)return Fp.length=Fp.length||{"SHA-1":512,"SHA-256":512,"SHA-384":1024,"SHA-512":1024}[Fp.hash.name],Nl.importKey("raw",Cl.getRandomValues(new Uint8Array(Fp.length+7>>3)),Fp,Hp,xp);if(Ep&&yp==="generateKey"&&Fp.name==="RSASSA-PKCS1-v1_5"&&(!Fp.modulusLength||2048<=Fp.modulusLength))return(Cp=_n(Cp)).name="RSAES-PKCS1-v1_5",delete Cp.hash,Nl.generateKey(Cp,!0,["encrypt","decrypt"]).then(function($p){return Promise.all([Nl.exportKey("jwk",$p.publicKey),Nl.exportKey("jwk",$p.privateKey)])}).then(function($p){return $p[0].alg=$p[1].alg=_i(Fp),$p[0].key_ops=xp.filter(Sl),$p[1].key_ops=xp.filter(Il),Promise.all([Nl.importKey("jwk",$p[0],Fp,!0,$p[0].key_ops),Nl.importKey("jwk",$p[1],Fp,Hp,$p[1].key_ops)])}).then(function($p){return{publicKey:$p[0],privateKey:$p[1]}});if((Ep||Jl&&(Fp.hash||{}).name==="SHA-1")&&yp==="importKey"&&Cp==="jwk"&&Fp.name==="HMAC"&&Mp.kty==="oct")return Nl.importKey("raw",j(_(Mp.k)),wp,Np[3],Np[4]);if(Ep&&yp==="importKey"&&(Cp==="spki"||Cp==="pkcs8"))return Nl.importKey("jwk",ba(Mp),wp,Np[3],Np[4]);if(Jl&&yp==="unwrapKey")return Nl.decrypt(Np[3],wp,Mp).then(function($p){return Nl.importKey(Cp,$p,Np[4],Np[5],Np[6])});try{var Gp=Ap.apply(Nl,Np)}catch($p){return Promise.reject($p)}return Jl&&(Gp=new Promise(function($p,c0){Gp.onabort=Gp.onerror=function(n0){c0(n0)},Gp.oncomplete=function(n0){$p(n0.target.result)}})),Gp=Gp.then(function($p){return Fp.name!=="HMAC"||Fp.length||(Fp.length=8*$p.algorithm.length),Fp.name.search("RSA")==0&&(Fp.modulusLength||(Fp.modulusLength=($p.publicKey||$p).algorithm.modulusLength),Fp.publicExponent||(Fp.publicExponent=($p.publicKey||$p).algorithm.publicExponent)),$p.publicKey&&$p.privateKey?{publicKey:new Tl($p.publicKey,Fp,Hp,xp.filter(Sl)),privateKey:new Tl($p.privateKey,Fp,Hp,xp.filter(Il))}:new Tl($p,Fp,Hp,xp)})}}),["exportKey","wrapKey"].forEach(function(yp){var Ap=Nl[yp];Nl[yp]=function(Cp,Mp,wp){var Np=[].slice.call(arguments);switch(yp){case"exportKey":Np[1]=Mp._key;break;case"wrapKey":Np[1]=Mp._key,Np[2]=wp._key}if((Ep||Jl&&(Mp.algorithm.hash||{}).name==="SHA-1")&&yp==="exportKey"&&Cp==="jwk"&&Mp.algorithm.name==="HMAC"&&(Np[0]="raw"),!Ep||yp!=="exportKey"||Cp!=="spki"&&Cp!=="pkcs8"||(Np[0]="jwk"),Jl&&yp==="wrapKey")return Nl.exportKey(Cp,Mp).then(function(Hp){return Cp==="jwk"&&(Hp=j(unescape(encodeURIComponent(JSON.stringify(_s(Hp)))))),Nl.encrypt(Np[3],wp,Hp)});try{var Fp=Ap.apply(Nl,Np)}catch(Hp){return Promise.reject(Hp)}return Jl&&(Fp=new Promise(function(Hp,xp){Fp.onabort=Fp.onerror=function(Gp){xp(Gp)},Fp.oncomplete=function(Gp){Hp(Gp.target.result)}})),yp==="exportKey"&&Cp==="jwk"&&(Fp=Fp.then(function(Hp){return(Ep||Jl&&(Mp.algorithm.hash||{}).name==="SHA-1")&&Mp.algorithm.name==="HMAC"?{kty:"oct",alg:_i(Mp.algorithm),key_ops:Mp.usages.slice(),ext:!0,k:g($(Hp))}:((Hp=_s(Hp)).alg||(Hp.alg=_i(Mp.algorithm)),Hp.key_ops||(Hp.key_ops=Mp.type==="public"?Mp.usages.filter(Sl):Mp.type==="private"?Mp.usages.filter(Il):Mp.usages.slice()),Hp)})),!Ep||yp!=="exportKey"||Cp!=="spki"&&Cp!=="pkcs8"||(Fp=Fp.then(function(Hp){var xp=[["",null]],Gp=!1;switch((Hp=_s(Hp)).kty){case"RSA":for(var $p="n e d p q dp dq qi".split(" "),c0=[],n0=0;n0<$p.length&&$p[n0]in Hp;n0++){var C0=c0[n0]=j(_(Hp[$p[n0]]));128&C0[0]&&(c0[n0]=new Uint8Array(C0.length+1),c0[n0].set(C0,1))}2<c0.length&&(Gp=!0,c0.unshift(new Uint8Array([0]))),xp[0][0]="1.2.840.113549.1.1.1";break;default:throw new TypeError("Unsupported key type")}return xp.push(new Uint8Array(El(c0)).buffer),Gp?xp.unshift(new Uint8Array([0])):xp[1]={tag:3,value:xp[1]},new Uint8Array(El(xp)).buffer})),Fp}}),["encrypt","decrypt","sign","verify"].forEach(function(yp){var Ap=Nl[yp];Nl[yp]=function(Cp,Mp,wp,Np){if(Jl&&(!wp.byteLength||Np&&!Np.byteLength))throw Error("Empty input is not allowed");var Fp=[].slice.call(arguments),Hp=_n(Cp);if(!Jl||yp!=="sign"&&yp!=="verify"||Cp!=="RSASSA-PKCS1-v1_5"&&Cp!=="HMAC"||(Fp[0]={name:Cp}),Jl&&Mp.algorithm.hash&&(Fp[0].hash=Fp[0].hash||Mp.algorithm.hash),Jl&&yp==="decrypt"&&Hp.name==="AES-GCM"){var xp=Cp.tagLength>>3;Fp[2]=(wp.buffer||wp).slice(0,wp.byteLength-xp),Cp.tag=(wp.buffer||wp).slice(wp.byteLength-xp)}Jl&&Hp.name==="AES-GCM"&&Fp[0].tagLength===void 0&&(Fp[0].tagLength=128),Fp[1]=Mp._key;try{var Gp=Ap.apply(Nl,Fp)}catch($p){return Promise.reject($p)}return Jl&&(Gp=new Promise(function($p,c0){Gp.onabort=Gp.onerror=function(n0){c0(n0)},Gp.oncomplete=function(n0){if(n0=n0.target.result,yp==="encrypt"&&n0 instanceof AesGcmEncryptResult){var C0=n0.ciphertext,Op=n0.tag;(n0=new Uint8Array(C0.byteLength+Op.byteLength)).set(new Uint8Array(C0),0),n0.set(new Uint8Array(Op),C0.byteLength),n0=n0.buffer}$p(n0)}})),Gp}}),Jl){var Up=Nl.digest;Nl.digest=function(yp,Ap){if(!Ap.byteLength)throw Error("Empty input is not allowed");try{var Cp=Up.call(Nl,yp,Ap)}catch(Mp){return Promise.reject(Mp)}return Cp=new Promise(function(Mp,wp){Cp.onabort=Cp.onerror=function(Np){wp(Np)},Cp.oncomplete=function(Np){Mp(Np.target.result)}})},i.crypto=Object.create(Cl,{getRandomValues:{value:function(yp){return Cl.getRandomValues(yp)}},subtle:{value:Nl}}),i.CryptoKey=Tl}Ep&&(Cl.subtle=Nl,i.Crypto=Dl,i.SubtleCrypto=Ul,i.CryptoKey=Tl)}}}})}),function(h){h.console||(h.console={}),h=h.console;for(var i,g=function(){},_=["memory"],j="assert clear count debug dir dirxml error exception group groupCollapsed groupEnd info log markTimeline profile profiles profileEnd show table time timeEnd timeline timelineEnd timeStamp trace warn".split(" ");i=_.pop();)h[i]||(h[i]={});for(;i=j.pop();)h[i]||(h[i]=g)}(typeof window>"u"?qb:window),wa({target:"Object",stat:!0},{setPrototypeOf:gc});var eF=Ga(function(){Md(1)});wa({target:"Object",stat:!0,forced:eF,sham:!qt},{getPrototypeOf:function(h){return Md(Zb(h))}});var Lu=[].slice,Wn={},fF=Function.bind||function(h){var i=Rc(this),g=Lu.call(arguments,1),_=function(){var j=g.concat(Lu.call(arguments));if(this instanceof _){var $=j.length;if(!($ in Wn)){for(var _n=[],_i=0;_i<$;_i++)_n[_i]="a["+_i+"]";Wn[$]=Function("C,a","return new C("+_n.join(",")+")")}j=Wn[$](i,j)}else j=i.apply(h,j);return j};return fb(i.prototype)&&(_.prototype=i.prototype),_},Xn=me("Reflect","construct"),Mu=Ga(function(){function h(){}return!(Xn(function(){},[],h)instanceof h)}),Nu=!Ga(function(){Xn(function(){})}),Ou=Mu||Nu;wa({target:"Reflect",stat:!0,forced:Ou,sham:Ou},{construct:function(h,i){Rc(h),ub(i);var g=3>arguments.length?h:Rc(arguments[2]);if(Nu&&!Mu)return Xn(h,i,g);if(h==g){switch(i.length){case 0:return new h;case 1:return new h(i[0]);case 2:return new h(i[0],i[1]);case 3:return new h(i[0],i[1],i[2]);case 4:return new h(i[0],i[1],i[2],i[3])}return(g=[null]).push.apply(g,i),new(fF.apply(h,g))}g=g.prototype,g=vd(fb(g)?g:Object.prototype);var _=Function.apply.call(h,g,i);return fb(_)?_:g}}),wa({target:"Reflect",stat:!0},{get:cr});var Pu=pd.f,gF=Ga(function(){Pu(1)});wa({target:"Object",stat:!0,forced:!cb||gF,sham:!cb},{getOwnPropertyDescriptor:function(h,i){return Pu(Qc(h),i)}});var Qu=dg.f,hF={}.toString,Ru=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],Yn=function(h){if(Ru&&hF.call(h)=="[object Window]")try{var i=Qu(h)}catch{i=Ru.slice()}else i=Qu(Qc(h));return i},Su={f:mb},iF=$b.f,Ik=function(h){var i=na.Symbol||(na.Symbol={});Fa(i,h)||iF(i,h,{value:Su.f(h)})},Sc=ek("hidden"),Tu=mb("toPrimitive"),jF=Sb.set,Uu=Sb.getterFor("Symbol"),wd=Object.prototype,Tc=na.Symbol,Si=me("JSON","stringify"),Vu=pd.f,Af=$b.f,Wu=Yn,kF=yi,Me=rf("symbols"),Ti=rf("op-symbols"),Zn=rf("string-to-symbol-registry"),$n=rf("symbol-to-string-registry"),lF=rf("wks"),ao=na.QObject,bo=!ao||!ao.prototype||!ao.prototype.findChild,co=cb&&Ga(function(){return vd(Af({},"a",{get:function(){return Af(this,"a",{value:7}).a}})).a!=7})?function(h,i,g){var _=Vu(wd,i);_&&delete wd[i],Af(h,i,g),_&&h!==wd&&Af(wd,i,_)}:Af,eo=function(h,i){var g=Me[h]=vd(Tc.prototype);return jF(g,{type:"Symbol",tag:h,description:i}),cb||(g.description=i),g},fo=at?function(h){return typeof h=="symbol"}:function(h){return Object(h)instanceof Tc},Jk=function(h,i,g){return h===wd&&Jk(Ti,i,g),ub(h),i=le(i,!0),ub(g),Fa(Me,i)?(g.enumerable?(Fa(h,Sc)&&h[Sc][i]&&(h[Sc][i]=!1),g=vd(g,{enumerable:ke(0,!1)})):(Fa(h,Sc)||Af(h,Sc,ke(1,{})),h[Sc][i]=!0),co(h,i,g)):Af(h,i,g)},Xu=function(h,i){ub(h);var g=Qc(i);return i=Ie(g).concat(go(g)),fg(i,function(_){cb&&!ho.call(g,_)||Jk(h,_,g[_])}),h},ho=function(h){h=le(h,!0);var i=kF.call(this,h);return!(this===wd&&Fa(Me,h)&&!Fa(Ti,h))&&(!(i||!Fa(this,h)||!Fa(Me,h)||Fa(this,Sc)&&this[Sc][h])||i)},Yu=function(h,i){if(h=Qc(h),i=le(i,!0),h!==wd||!Fa(Me,i)||Fa(Ti,i)){var g=Vu(h,i);return!g||!Fa(Me,i)||Fa(h,Sc)&&h[Sc][i]||(g.enumerable=!0),g}},Zu=function(h){h=Wu(Qc(h));var i=[];return fg(h,function(g){Fa(Me,g)||Fa(jh,g)||i.push(g)}),i},go=function(h){var i=h===wd;h=Wu(i?Ti:Qc(h));var g=[];return fg(h,function(_){!Fa(Me,_)||i&&!Fa(wd,_)||g.push(Me[_])}),g};if(pe||(Tc=function(){if(this instanceof Tc)throw TypeError("Symbol is not a constructor");var h=arguments.length&&arguments[0]!==void 0?String(arguments[0]):void 0,i=ih(h),g=function(_){this===wd&&g.call(Ti,_),Fa(this,Sc)&&Fa(this[Sc],i)&&(this[Sc][i]=!1),co(this,i,ke(1,_))};return cb&&bo&&co(wd,i,{configurable:!0,set:g}),eo(i,h)},Ob(Tc.prototype,"toString",function(){return Uu(this).tag}),Ob(Tc,"withoutSetter",function(h){return eo(ih(h),h)}),yi=ho,$b.f=Jk,pd.f=Yu,dg.f=Yn=Zu,Ai.f=go,Su.f=function(h){return eo(mb(h),h)},cb&&(Af(Tc.prototype,"description",{configurable:!0,get:function(){return Uu(this).description}}),Ob(wd,"propertyIsEnumerable",ho,{unsafe:!0}))),wa({global:!0,wrap:!0,forced:!pe,sham:!pe},{Symbol:Tc}),fg(Ie(lF),function(h){Ik(h)}),wa({target:"Symbol",stat:!0,forced:!pe},{for:function(h){if(h=String(h),Fa(Zn,h))return Zn[h];var i=Tc(h);return Zn[h]=i,$n[i]=h,i},keyFor:function(h){if(!fo(h))throw TypeError(h+" is not a symbol");if(Fa($n,h))return $n[h]},useSetter:function(){bo=!0},useSimple:function(){bo=!1}}),wa({target:"Object",stat:!0,forced:!pe,sham:!cb},{create:function(h,i){return i===void 0?vd(h):Xu(vd(h),i)},defineProperty:Jk,defineProperties:Xu,getOwnPropertyDescriptor:Yu}),wa({target:"Object",stat:!0,forced:!pe},{getOwnPropertyNames:Zu,getOwnPropertySymbols:go}),wa({target:"Object",stat:!0,forced:Ga(function(){Ai.f(1)})},{getOwnPropertySymbols:function(h){return Ai.f(Zb(h))}}),Si){var mF=!pe||Ga(function(){var h=Tc();return Si([h])!="[null]"||Si({a:h})!="{}"||Si(Object(h))!="{}"});wa({target:"JSON",stat:!0,forced:mF},{stringify:function(h,i,g){for(var _,j=[h],$=1;arguments.length>$;)j.push(arguments[$++]);if(_=i,(fb(i)||h!==void 0)&&!fo(h))return uf(i)||(i=function(_n,_i){if(typeof _=="function"&&(_i=_.call(this,_n,_i)),!fo(_i))return _i}),j[1]=i,Si.apply(null,j)}})}Tc.prototype[Tu]||ac(Tc.prototype,Tu,Tc.prototype.valueOf),Td(Tc,"Symbol"),jh[Sc]=!0;var nF=$b.f,Ne=na.Symbol;if(cb&&typeof Ne=="function"&&(!("description"in Ne.prototype)||Ne().description!==void 0)){var $u={},Ui=function(){var h=1>arguments.length||arguments[0]===void 0?void 0:String(arguments[0]),i=this instanceof Ui?new Ne(h):h===void 0?Ne():Ne(h);return h===""&&($u[i]=!0),i};Vs(Ui,Ne);var io=Ui.prototype=Ne.prototype;io.constructor=Ui;var oF=io.toString,pF=String(Ne("test"))=="Symbol(test)",qF=/^Symbol\((.*)\)[^)]+$/;nF(io,"description",{configurable:!0,get:function(){var h=fb(this)?this.valueOf():this,i=oF.call(h);return Fa($u,h)?"":(h=pF?i.slice(7,-1):i.replace(qF,"$1"))===""?void 0:h}}),wa({global:!0,forced:!0},{Symbol:Ui})}Ik("toStringTag"),Td(na.JSON,"JSON",!0),Td(Math,"Math",!0),function(){function h(xa,El){if(!(xa instanceof El))throw new TypeError("Cannot call a class as a function")}function i(xa,El){for(var Tl=0;Tl<El.length;Tl++){var Sl=El[Tl];Sl.enumerable=Sl.enumerable||!1,Sl.configurable=!0,"value"in Sl&&(Sl.writable=!0),Object.defineProperty(xa,Sl.key,Sl)}}function g(xa,El,Tl){return El&&i(xa.prototype,El),Tl&&i(xa,Tl),xa}function _(xa){return(_=Object.setPrototypeOf?Object.getPrototypeOf:function(El){return El.__proto__||Object.getPrototypeOf(El)})(xa)}function j(xa,El){return(j=Object.setPrototypeOf||function(Tl,Sl){return Tl.__proto__=Sl,Tl})(xa,El)}function $(xa){if(xa===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return xa}function _n(xa){var El=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var Tl=_(xa);if(El){var Sl=_(this).constructor;Tl=Reflect.construct(Tl,arguments,Sl)}else Tl=Tl.apply(this,arguments);return Tl=!Tl||Ia(Tl)!=="object"&&typeof Tl!="function"?$(this):Tl}}function _i(xa,El,Tl){return(_i=typeof Reflect<"u"&&Reflect.get?Reflect.get:function(Sl,Il,Cl){for(;!Object.prototype.hasOwnProperty.call(Sl,Il)&&(Sl=_(Sl))!==null;);if(Sl)return(Il=Object.getOwnPropertyDescriptor(Sl,Il)).get?Il.get.call(Cl):Il.value})(xa,El,Tl||xa)}var _s=function(){function xa(){h(this,xa),Object.defineProperty(this,"listeners",{value:{},writable:!0,configurable:!0})}return g(xa,[{key:"addEventListener",value:function(El,Tl,Sl){El in this.listeners||(this.listeners[El]=[]),this.listeners[El].push({callback:Tl,options:Sl})}},{key:"removeEventListener",value:function(El,Tl){if(El in this.listeners){for(var Sl=0,Il=(El=this.listeners[El]).length;Sl<Il;Sl++)if(El[Sl].callback===Tl){El.splice(Sl,1);break}}}},{key:"dispatchEvent",value:function(El){if(El.type in this.listeners){for(var Tl=this.listeners[El.type].slice(),Sl=0,Il=Tl.length;Sl<Il;Sl++){var Cl=Tl[Sl];try{Cl.callback.call(this,El)}catch(Nl){Promise.resolve().then(function(){throw Nl})}Cl.options&&Cl.options.once&&this.removeEventListener(El.type,Cl.callback)}return!El.defaultPrevented}}}]),xa}(),ga=function(xa){function El(){h(this,El);var Sl=Tl.call(this);return Sl.listeners||_s.call($(Sl)),Object.defineProperty($(Sl),"aborted",{value:!1,writable:!0,configurable:!0}),Object.defineProperty($(Sl),"onabort",{value:null,writable:!0,configurable:!0}),Sl}(function(Sl,Il){if(typeof Il!="function"&&Il!==null)throw new TypeError("Super expression must either be null or a function");Sl.prototype=Object.create(Il&&Il.prototype,{constructor:{value:Sl,writable:!0,configurable:!0}}),Il&&j(Sl,Il)})(El,xa);var Tl=_n(El);return g(El,[{key:"toString",value:function(){return"[object AbortSignal]"}},{key:"dispatchEvent",value:function(Sl){Sl.type==="abort"&&(this.aborted=!0,typeof this.onabort=="function"&&this.onabort.call(this,Sl)),_i(_(El.prototype),"dispatchEvent",this).call(this,Sl)}}]),El}(_s),ba=function(){function xa(){h(this,xa),Object.defineProperty(this,"signal",{value:new ga,writable:!0,configurable:!0})}return g(xa,[{key:"abort",value:function(){try{var El=new Event("abort")}catch{typeof document<"u"?document.createEvent?(El=document.createEvent("Event")).initEvent("abort",!1,!1):(El=document.createEventObject()).type="abort":El={type:"abort",bubbles:!1,cancelable:!1}}this.signal.dispatchEvent(El)}},{key:"toString",value:function(){return"[object AbortController]"}}]),xa}();typeof Symbol<"u"&&Symbol.toStringTag&&(ba.prototype[Symbol.toStringTag]="AbortController",ga.prototype[Symbol.toStringTag]="AbortSignal"),function(xa){if(xa.__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL){console.log("__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL=true is set, will force install polyfill");var El=!0}else El=typeof xa.Request=="function"&&!xa.Request.prototype.hasOwnProperty("signal")||!xa.AbortController;El&&(xa.AbortController=ba,xa.AbortSignal=ga)}(typeof self<"u"?self:qb)}();var rF=Math.floor,sF=Math.log,tF=Math.LOG2E;wa({target:"Math",stat:!0},{clz32:function(h){return(h>>>=0)?31-rF(sF(h+.5)*tF):32}});var uF=Math.log,vF=Math.LN2,NA=Math.clz32||function(h){return 31-uF(h>>>0)/vF|0},Uf=String.fromCharCode,av={}.toString,jo=window.Uint8Array,ko=jo||Array,wF=av.call((window.ArrayBuffer||ko).prototype),lo;dr.prototype.decode=function(h){if(h=h&&h.buffer||h,av.call(h)!==wF)throw Error("Failed to execute 'decode' on 'TextDecoder': The provided value is not of type '(ArrayBuffer or ArrayBufferView)'");for(var i="",g=0,_=0|(h=jo?new ko(h):h).length;g<_;g=g+32768|0)i+=Uf.apply(0,h[jo?"slice":"subarray"](g,g+32768|0));return i.replace(/[\xc0-\xff][\x80-\xbf]*/g,MA)},window.TextDecoder||(window.TextDecoder=dr),er.prototype.encode=function(h){for(var i=0|(h=h===void 0?"":(""+h).replace(/[\x80-\uD7ff\uDC00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]?/g,OA)).length,g=new ko(i),_=0;_<i;_=_+1|0)g[_]=h.charCodeAt(_);return g},window.TextEncoder||(window.TextEncoder=er),function(h){var i,g,_,j,$,_n,_i,_s,ga,ba,xa,El,Tl;(g=i||(i={})).LOGIN="LOGIN",g.LOGIN_SUCCESS="LOGIN_SUCCESS",g.LOGIN_FAILURE="LOGIN_FAILURE",g.LOGIN_TIMEOUT="LOGIN_TIMEOUT",g.INTERRUPTED="INTERRUPTED",g.LOGOUT="LOGOUT",g.BANNED_BY_SERVER="BANNED_BY_SERVER",g.REMOTE_LOGIN="REMOTE_LOGIN",g.TOKEN_EXPIRED="TOKEN_EXPIRED",h.ConnectionChangeReason=i,function(Sl){Sl.DISCONNECTED="DISCONNECTED",Sl.CONNECTING="CONNECTING",Sl.CONNECTED="CONNECTED",Sl.RECONNECTING="RECONNECTING",Sl.ABORTED="ABORTED"}(_||(_={})),h.ConnectionState=_,function(Sl){Sl.IDLE="IDLE",Sl.SENT_TO_REMOTE="SENT_TO_REMOTE",Sl.RECEIVED_BY_REMOTE="RECEIVED_BY_REMOTE",Sl.ACCEPTED_BY_REMOTE="ACCEPTED_BY_REMOTE",Sl.REFUSED_BY_REMOTE="REFUSED_BY_REMOTE",Sl.CANCELED="CANCELED",Sl.FAILURE="FAILURE"}(j||(j={})),h.LocalInvitationState=j,function(Sl){Sl.INVITATION_RECEIVED="INVITATION_RECEIVED",Sl.ACCEPT_SENT_TO_LOCAL="ACCEPT_SENT_TO_LOCAL",Sl.REFUSED="REFUSED",Sl.ACCEPTED="ACCEPTED",Sl.CANCELED="CANCELED",Sl.FAILURE="FAILURE"}($||($={})),h.RemoteInvitationState=$,function(Sl){Sl.UNKNOWN="UNKNOWN",Sl.PEER_NO_RESPONSE="PEER_NO_RESPONSE",Sl.INVITATION_EXPIRE="INVITATION_EXPIRE",Sl.PEER_OFFLINE="PEER_OFFLINE",Sl.NOT_LOGGEDIN="NOT_LOGGEDIN"}(_n||(_n={})),h.LocalInvitationFailureReason=_n,function(Sl){Sl.UNKNOWN="UNKNOWN",Sl.PEER_OFFLINE="PEER_OFFLINE",Sl.ACCEPT_FAILURE="ACCEPT_FAILURE",Sl.INVITATION_EXPIRE="INVITATION_EXPIRE"}(_i||(_i={})),h.RemoteInvitationFailureReason=_i,function(Sl){Sl.ONLINE="ONLINE",Sl.UNREACHABLE="UNREACHABLE",Sl.OFFLINE="OFFLINE"}(_s||(_s={})),h.PeerOnlineState=_s,function(Sl){Sl.UNSUBSCRIBED="UNSUBSCRIBED",Sl.SUBSCRIBED="SUBSCRIBED"}(ga||(ga={})),h.subscribedState=ga,(ba||(ba={})).ONLINE_STATUS="ONLINE_STATUS",h.PeerSubscriptionOption=ba,function(Sl){Sl.TEXT="TEXT",Sl.RAW="RAW"}(xa||(xa={})),h.MessageType=xa,function(Sl){Sl.CN="CN",Sl.NA="NA",Sl.EU="EU",Sl.AS="AS",Sl.JP="JP",Sl.IN="IN",Sl.GLOB="GLOB",Sl.OC="OC",Sl.SA="SA",Sl.AF="AF",Sl.OVS="OVS"}(El||(El={})),h.LegacyAreaCode=El,function(Sl){Sl.GLOBAL="GLOBAL",Sl.INDIA="INDIA",Sl.JAPAN="JAPAN",Sl.ASIA="ASIA",Sl.EUROPE="EUROPE",Sl.CHINA="CHINA",Sl.NORTH_AMERICA="NORTH_AMERICA"}(Tl||(Tl={})),h.AreaCode=Tl}(lo||(lo={}));var Oa=lo;wa({target:"Array",proto:!0},{includes:function(h){return Ss(this,h,1<arguments.length?arguments[1]:void 0)}}),wf("includes");var mo=function(h){if(gn(h))throw TypeError("The method doesn't accept regular expressions");return h},xF=mb("match"),no=function(h){var i=/./;try{"/./"[h](i)}catch{try{return i[xF]=!1,"/./"[h](i)}catch{}}return!1};wa({target:"String",proto:!0,forced:!no("includes")},{includes:function(h){return!!~String(Ec(this)).indexOf(mo(h),1<arguments.length?arguments[1]:void 0)}});var Yd={RECONNECTING_AP_INTERVAL:2500,RECONNECTING_AP_NUM:2,DISABLE_MESSAGE_COMPRESSION:!1,LOG_UPLOAD_INTERVAL:3e3,LOG_HANDLER:void 0,ENABLE_EDGE_AUTO_FALLBACK:!0};Ik("iterator"),Ik("asyncIterator");var oo=gg("forEach")?[].forEach:function(h){return fg(this,h,1<arguments.length?arguments[1]:void 0)},bv;for(bv in Tn){var cv=na[bv],Kk=cv&&cv.prototype;if(Kk&&Kk.forEach!==oo)try{ac(Kk,"forEach",oo)}catch{Kk.forEach=oo}}var yF=[].reverse,dv=[1,2];wa({target:"Array",proto:!0,forced:String(dv)===String(dv.reverse())},{reverse:function(){return uf(this)&&(this.length=this.length),yF.call(this)}});var W=kc(function(h){h=function(i){function g(wp,Np,Fp){return Object.defineProperty(wp,Np,{value:Fp,enumerable:!0,configurable:!0,writable:!0}),wp[Np]}function _(wp,Np,Fp,Hp){return Np=Object.create((Np&&Np.prototype instanceof $?Np:$).prototype),Hp=new Tl(Hp||[]),Np._invoke=function(xp,Gp,$p){var c0=_p;return function(n0,C0){if(c0===Up)throw Error("Generator is already running");if(c0===yp){if(n0==="throw")throw C0;return Il()}for($p.method=n0,$p.arg=C0;;){if((n0=$p.delegate)&&(n0=ba(n0,$p))){if(n0===Ap)continue;return n0}if($p.method==="next")$p.sent=$p._sent=$p.arg;else if($p.method==="throw"){if(c0===_p)throw c0=yp,$p.arg;$p.dispatchException($p.arg)}else $p.method==="return"&&$p.abrupt("return",$p.arg);if(c0=Up,(n0=j(xp,Gp,$p)).type==="normal"){if(c0=$p.done?yp:Ip,n0.arg===Ap)continue;return{value:n0.arg,done:$p.done}}n0.type==="throw"&&(c0=yp,$p.method="throw",$p.arg=n0.arg)}}}(wp,Fp,Hp),Np}function j(wp,Np,Fp){try{return{type:"normal",arg:wp.call(Np,Fp)}}catch(Hp){return{type:"throw",arg:Hp}}}function $(){}function _n(){}function _i(){}function _s(wp){["next","throw","return"].forEach(function(Np){g(wp,Np,function(Fp){return this._invoke(Np,Fp)})})}function ga(wp,Np){function Fp(xp,Gp,$p,c0){if((xp=j(wp[xp],wp,Gp)).type!=="throw"){var n0=xp.arg;return(xp=n0.value)&&Ia(xp)==="object"&&Dl.call(xp,"__await")?Np.resolve(xp.__await).then(function(C0){Fp("next",C0,$p,c0)},function(C0){Fp("throw",C0,$p,c0)}):Np.resolve(xp).then(function(C0){n0.value=C0,$p(n0)},function(C0){return Fp("throw",C0,$p,c0)})}c0(xp.arg)}var Hp;this._invoke=function(xp,Gp){function $p(){return new Np(function(c0,n0){Fp(xp,Gp,c0,n0)})}return Hp=Hp?Hp.then($p,$p):$p()}}function ba(wp,Np){var Fp=wp.iterator[Np.method];if(Fp===Cl){if(Np.delegate=null,Np.method==="throw"){if(wp.iterator.return&&(Np.method="return",Np.arg=Cl,ba(wp,Np),Np.method==="throw"))return Ap;Np.method="throw",Np.arg=new TypeError("The iterator does not provide a 'throw' method")}return Ap}return(Fp=j(Fp,wp.iterator,Np.arg)).type==="throw"?(Np.method="throw",Np.arg=Fp.arg,Np.delegate=null,Ap):(Fp=Fp.arg)?Fp.done?(Np[wp.resultName]=Fp.value,Np.next=wp.nextLoc,Np.method!=="return"&&(Np.method="next",Np.arg=Cl),Np.delegate=null,Ap):Fp:(Np.method="throw",Np.arg=new TypeError("iterator result is not an object"),Np.delegate=null,Ap)}function xa(wp){var Np={tryLoc:wp[0]};1 in wp&&(Np.catchLoc=wp[1]),2 in wp&&(Np.finallyLoc=wp[2],Np.afterLoc=wp[3]),this.tryEntries.push(Np)}function El(wp){var Np=wp.completion||{};Np.type="normal",delete Np.arg,wp.completion=Np}function Tl(wp){this.tryEntries=[{tryLoc:"root"}],wp.forEach(xa,this),this.reset(!0)}function Sl(wp){if(wp){var Np=wp[Kl];if(Np)return Np.call(wp);if(typeof wp.next=="function")return wp;if(!isNaN(wp.length)){var Fp=-1;return(Np=function Hp(){for(;++Fp<wp.length;)if(Dl.call(wp,Fp))return Hp.value=wp[Fp],Hp.done=!1,Hp;return Hp.value=Cl,Hp.done=!0,Hp}).next=Np}}return{next:Il}}function Il(){return{value:Cl,done:!0}}var Cl,Nl=Object.prototype,Dl=Nl.hasOwnProperty,Ul=typeof Symbol=="function"?Symbol:{},Kl=Ul.iterator||"@@iterator",Jl=Ul.asyncIterator||"@@asyncIterator",Ep=Ul.toStringTag||"@@toStringTag";try{g({},"")}catch{g=function(Np,Fp,Hp){return Np[Fp]=Hp}}i.wrap=_;var _p="suspendedStart",Ip="suspendedYield",Up="executing",yp="completed",Ap={};g(Ul={},Kl,function(){return this});var Cp=Object.getPrototypeOf;(Cp=Cp&&Cp(Cp(Sl([]))))&&Cp!==Nl&&Dl.call(Cp,Kl)&&(Ul=Cp);var Mp=_i.prototype=$.prototype=Object.create(Ul);return _n.prototype=_i,g(Mp,"constructor",_i),g(_i,"constructor",_n),_n.displayName=g(_i,Ep,"GeneratorFunction"),i.isGeneratorFunction=function(wp){return!!(wp=typeof wp=="function"&&wp.constructor)&&(wp===_n||(wp.displayName||wp.name)==="GeneratorFunction")},i.mark=function(wp){return Object.setPrototypeOf?Object.setPrototypeOf(wp,_i):(wp.__proto__=_i,g(wp,Ep,"GeneratorFunction")),wp.prototype=Object.create(Mp),wp},i.awrap=function(wp){return{__await:wp}},_s(ga.prototype),g(ga.prototype,Jl,function(){return this}),i.AsyncIterator=ga,i.async=function(wp,Np,Fp,Hp,xp){xp===void 0&&(xp=Promise);var Gp=new ga(_(wp,Np,Fp,Hp),xp);return i.isGeneratorFunction(Np)?Gp:Gp.next().then(function($p){return $p.done?$p.value:Gp.next()})},_s(Mp),g(Mp,Ep,"Generator"),g(Mp,Kl,function(){return this}),g(Mp,"toString",function(){return"[object Generator]"}),i.keys=function(wp){var Np,Fp=[];for(Np in wp)Fp.push(Np);return Fp.reverse(),function Hp(){for(;Fp.length;){var xp=Fp.pop();if(xp in wp)return Hp.value=xp,Hp.done=!1,Hp}return Hp.done=!0,Hp}},i.values=Sl,Tl.prototype={constructor:Tl,reset:function(wp){if(this.next=this.prev=0,this.sent=this._sent=Cl,this.done=!1,this.delegate=null,this.method="next",this.arg=Cl,this.tryEntries.forEach(El),!wp)for(var Np in this)Np.charAt(0)==="t"&&Dl.call(this,Np)&&!isNaN(+Np.slice(1))&&(this[Np]=Cl)},stop:function(){this.done=!0;var wp=this.tryEntries[0].completion;if(wp.type==="throw")throw wp.arg;return this.rval},dispatchException:function(wp){function Np(n0,C0){return Gp.type="throw",Gp.arg=wp,Fp.next=n0,C0&&(Fp.method="next",Fp.arg=Cl),!!C0}if(this.done)throw wp;for(var Fp=this,Hp=this.tryEntries.length-1;0<=Hp;--Hp){var xp=this.tryEntries[Hp],Gp=xp.completion;if(xp.tryLoc==="root")return Np("end");if(xp.tryLoc<=this.prev){var $p=Dl.call(xp,"catchLoc"),c0=Dl.call(xp,"finallyLoc");if($p&&c0){if(this.prev<xp.catchLoc)return Np(xp.catchLoc,!0);if(this.prev<xp.finallyLoc)return Np(xp.finallyLoc)}else if($p){if(this.prev<xp.catchLoc)return Np(xp.catchLoc,!0)}else{if(!c0)throw Error("try statement without catch or finally");if(this.prev<xp.finallyLoc)return Np(xp.finallyLoc)}}}},abrupt:function(wp,Np){for(var Fp=this.tryEntries.length-1;0<=Fp;--Fp){var Hp=this.tryEntries[Fp];if(Hp.tryLoc<=this.prev&&Dl.call(Hp,"finallyLoc")&&this.prev<Hp.finallyLoc){var xp=Hp;break}}return xp&&(wp==="break"||wp==="continue")&&xp.tryLoc<=Np&&Np<=xp.finallyLoc&&(xp=null),(Fp=xp?xp.completion:{}).type=wp,Fp.arg=Np,xp?(this.method="next",this.next=xp.finallyLoc,Ap):this.complete(Fp)},complete:function(wp,Np){if(wp.type==="throw")throw wp.arg;return wp.type==="break"||wp.type==="continue"?this.next=wp.arg:wp.type==="return"?(this.rval=this.arg=wp.arg,this.method="return",this.next="end"):wp.type==="normal"&&Np&&(this.next=Np),Ap},finish:function(wp){for(var Np=this.tryEntries.length-1;0<=Np;--Np){var Fp=this.tryEntries[Np];if(Fp.finallyLoc===wp)return this.complete(Fp.completion,Fp.afterLoc),El(Fp),Ap}},catch:function(wp){for(var Np=this.tryEntries.length-1;0<=Np;--Np){var Fp=this.tryEntries[Np];if(Fp.tryLoc===wp){if((wp=Fp.completion).type==="throw"){var Hp=wp.arg;El(Fp)}return Hp}}throw Error("illegal catch attempt")},delegateYield:function(wp,Np,Fp){return this.delegate={iterator:Sl(wp),resultName:Np,nextLoc:Fp},this.method==="next"&&(this.arg=Cl),Ap}},i}(h.exports);try{regeneratorRuntime=h}catch{(typeof globalThis>"u"?"undefined":Ia(globalThis))==="object"?globalThis.regeneratorRuntime=h:Function("r","regeneratorRuntime = r")(h)}}),ev=!Ga(function(){return Object.isExtensible(Object.preventExtensions({}))}),po=kc(function(h){var i=$b.f,g=ih("meta"),_=0,j=Object.isExtensible||function(){return!0},$=function(_i){i(_i,g,{value:{objectID:"O"+ ++_,weakData:{}}})},_n=h.exports={REQUIRED:!1,fastKey:function(_i,_s){if(!fb(_i))return typeof _i=="symbol"?_i:(typeof _i=="string"?"S":"P")+_i;if(!Fa(_i,g)){if(!j(_i))return"F";if(!_s)return"E";$(_i)}return _i[g].objectID},getWeakData:function(_i,_s){if(!Fa(_i,g)){if(!j(_i))return!0;if(!_s)return!1;$(_i)}return _i[g].weakData},onFreeze:function(_i){return ev&&_n.REQUIRED&&j(_i)&&!Fa(_i,g)&&$(_i),_i}};jh[g]=!0}),fv=function(h,i,g){var _=h.indexOf("Map")!==-1,j=h.indexOf("Weak")!==-1,$=_?"set":"add",_n=na[h],_i=_n&&_n.prototype,_s=_n,ga={},ba=function(Cl){var Nl=_i[Cl];Ob(_i,Cl,Cl=="add"?function(Dl){return Nl.call(this,Dl===0?0:Dl),this}:Cl=="delete"?function(Dl){return!(j&&!fb(Dl))&&Nl.call(this,Dl===0?0:Dl)}:Cl=="get"?function(Dl){return j&&!fb(Dl)?void 0:Nl.call(this,Dl===0?0:Dl)}:Cl=="has"?function(Dl){return!(j&&!fb(Dl))&&Nl.call(this,Dl===0?0:Dl)}:function(Dl,Ul){return Nl.call(this,Dl===0?0:Dl,Ul),this})};if(ne(h,typeof _n!="function"||!(j||_i.forEach&&!Ga(function(){new _n().entries().next()}))))_s=g.getConstructor(i,h,_,$),po.REQUIRED=!0;else if(ne(h,!0)){var xa=new _s,El=xa[$](j?{}:-0,1)!=xa,Tl=Ga(function(){xa.has(1)}),Sl=mk(function(Cl){new _n(Cl)}),Il=!j&&Ga(function(){for(var Cl=new _n,Nl=5;Nl--;)Cl[$](Nl,Nl);return!Cl.has(-0)});Sl||((_s=i(function(Cl,Nl){return Ud(Cl,_s,h),Cl=Ek(new _n,Cl,_s),Nl!=null&&rk(Nl,Cl[$],{that:Cl,AS_ENTRIES:_}),Cl})).prototype=_i,_i.constructor=_s),(Tl||Il)&&(ba("delete"),ba("has"),_&&ba("get")),(Il||El)&&ba($),j&&_i.clear&&delete _i.clear}return ga[h]=_s,wa({global:!0,forced:_s!=_n},ga),Td(_s,h),j||g.setStrong(_s,h,_),_s},zF=$b.f,gv=po.fastKey,hv=Sb.set,qo=Sb.getterFor,iv={getConstructor:function(h,i,g,_){var j=h(function(_s,ga){Ud(_s,j,i),hv(_s,{type:i,index:vd(null),first:void 0,last:void 0,size:0}),cb||(_s.size=0),ga!=null&&rk(ga,_s[_],{that:_s,AS_ENTRIES:g})}),$=qo(i),_n=function(_s,ga,ba){var xa,El=$(_s),Tl=_i(_s,ga);return Tl?Tl.value=ba:(El.last=Tl={index:xa=gv(ga,!0),key:ga,value:ba,previous:ga=El.last,next:void 0,removed:!1},El.first||(El.first=Tl),ga&&(ga.next=Tl),cb?El.size++:_s.size++,xa!=="F"&&(El.index[xa]=Tl)),_s},_i=function(_s,ga){_s=$(_s);var ba=gv(ga);if(ba!=="F")return _s.index[ba];for(_s=_s.first;_s;_s=_s.next)if(_s.key==ga)return _s};return qh(j.prototype,{clear:function(){for(var _s=$(this),ga=_s.index,ba=_s.first;ba;)ba.removed=!0,ba.previous&&(ba.previous=ba.previous.next=void 0),delete ga[ba.index],ba=ba.next;_s.first=_s.last=void 0,cb?_s.size=0:this.size=0},delete:function(_s){var ga=$(this);if(_s=_i(this,_s)){var ba=_s.next,xa=_s.previous;delete ga.index[_s.index],_s.removed=!0,xa&&(xa.next=ba),ba&&(ba.previous=xa),ga.first==_s&&(ga.first=ba),ga.last==_s&&(ga.last=xa),cb?ga.size--:this.size--}return!!_s},forEach:function(_s){for(var ga,ba=$(this),xa=tf(_s,1<arguments.length?arguments[1]:void 0,3);ga=ga?ga.next:ba.first;)for(xa(ga.value,ga.key,this);ga&&ga.removed;)ga=ga.previous},has:function(_s){return!!_i(this,_s)}}),qh(j.prototype,g?{get:function(_s){return(_s=_i(this,_s))&&_s.value},set:function(_s,ga){return _n(this,_s===0?0:_s,ga)}}:{add:function(_s){return _n(this,_s=_s===0?0:_s,_s)}}),cb&&zF(j.prototype,"size",{get:function(){return $(this).size}}),j},setStrong:function(h,i,g){var _=i+" Iterator",j=qo(i),$=qo(_);rn(h,i,function(_n,_i){hv(this,{type:_,target:_n,state:j(_n),kind:_i,last:void 0})},function(){for(var _n=$(this),_i=_n.kind,_s=_n.last;_s&&_s.removed;)_s=_s.previous;return _n.target&&(_n.last=_s=_s?_s.next:_n.state.first)?_i=="keys"?{value:_s.key,done:!1}:_i=="values"?{value:_s.value,done:!1}:{value:[_s.key,_s.value],done:!1}:(_n.target=void 0,{value:void 0,done:!0})},g?"entries":"values",!g,!0),Ii(i)}};fv("Set",function(h){return function(){return h(this,arguments.length?arguments[0]:void 0)}},iv);var AF=yi,jv=function(h){return function(i){i=Qc(i);for(var g,_=Ie(i),j=_.length,$=0,_n=[];j>$;)g=_[$++],cb&&!AF.call(i,g)||_n.push(h?[g,i[g]]:i[g]);return _n}},BF=jv(!0),CF=jv(!1);wa({target:"Object",stat:!0},{values:function(h){return CF(h)}});var ro=me("Reflect","apply"),DF=Function.apply,EF=!Ga(function(){ro(function(){})});wa({target:"Reflect",stat:!0,forced:EF},{apply:function(h,i,g){return Rc(h),ub(g),ro?ro(h,i,g):DF.call(h,i,g)}}),wa({target:"Reflect",stat:!0},{ownKeys:Us});var kv=mb("isConcatSpreadable"),FF=51<=oe||!Ga(function(){var h=[];return h[kv]=!1,h.concat()[0]!==h}),GF=Fi("concat");wa({target:"Array",proto:!0,forced:!FF||!GF},{concat:function(h){var i,g=Zb(this),_=Ei(g,0),j=0,$=-1;for(i=arguments.length;$<i;$++){var _n=$===-1?g:arguments[$],_i=_n;if(fb(_i)){var _s=_i[kv];_i=_s!==void 0?!!_s:uf(_i)}else _i=!1;if(_i){if(9007199254740991<j+(_s=xb(_n.length)))throw TypeError("Maximum allowed index exceeded");for(_i=0;_i<_s;_i++,j++)_i in _n&&oh(_,j,_n[_i])}else{if(9007199254740991<=j)throw TypeError("Maximum allowed index exceeded");oh(_,j++,_n)}}return _.length=j,_}});var HF=Yn,IF=Ga(function(){return!Object.getOwnPropertyNames(1)});wa({target:"Object",stat:!0,forced:IF},{getOwnPropertyNames:HF});var JF=dg.f,KF=pd.f,LF=$b.f,Bf=na.Number,Lk=Bf.prototype,MF=Qd(vd(Lk))=="Number",lv=function(h){var i,g=le(h,!1);if(typeof g=="string"&&2<g.length){if((h=(g=kk(g)).charCodeAt(0))===43||h===45){if((h=g.charCodeAt(2))===88||h===120)return NaN}else if(h===48){switch(g.charCodeAt(1)){case 66:case 98:h=2;var _=49;break;case 79:case 111:h=8,_=55;break;default:return+g}var j=(g=g.slice(2)).length;for(i=0;i<j;i++){var $=g.charCodeAt(i);if(48>$||$>_)return NaN}return parseInt(g,h)}}return+g};if(ne("Number",!Bf(" 0o1")||!Bf("0b1")||Bf("+0x1"))){for(var mg=function(h){var i=1>arguments.length?0:h,g=this;return g instanceof mg&&(MF?Ga(function(){Lk.valueOf.call(g)}):Qd(g)!="Number")?Ek(new Bf(lv(i)),g,mg):lv(i)},mv=cb?JF(Bf):"MAX_VALUE MIN_VALUE NaN NEGATIVE_INFINITY POSITIVE_INFINITY EPSILON isFinite isInteger isNaN isSafeInteger MAX_SAFE_INTEGER MIN_SAFE_INTEGER parseFloat parseInt isInteger fromString range".split(" "),so=0,Mk;mv.length>so;so++)Fa(Bf,Mk=mv[so])&&!Fa(mg,Mk)&&LF(mg,Mk,KF(Bf,Mk));mg.prototype=Lk,Lk.constructor=mg,Ob(na,"Number",mg)}var yh=(typeof Reflect>"u"?"undefined":Ia(Reflect))==="object"?Reflect:null,nv=yh&&typeof yh.apply=="function"?yh.apply:function(h,i,g){return Function.prototype.apply.call(h,i,g)},NF=yh&&typeof yh.ownKeys=="function"?yh.ownKeys:Object.getOwnPropertySymbols?function(h){return Object.getOwnPropertyNames(h).concat(Object.getOwnPropertySymbols(h))}:function(h){return Object.getOwnPropertyNames(h)},ov=Number.isNaN||function(h){return h!=h};kb.EventEmitter=kb,kb.prototype._events=void 0,kb.prototype._eventsCount=0,kb.prototype._maxListeners=void 0;var pv=10;Object.defineProperty(kb,"defaultMaxListeners",{enumerable:!0,get:function(){return pv},set:function(h){if(typeof h!="number"||0>h||ov(h))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+h+".");pv=h}}),kb.init=function(){this._events!==void 0&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},kb.prototype.setMaxListeners=function(h){if(typeof h!="number"||0>h||ov(h))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+h+".");return this._maxListeners=h,this},kb.prototype.getMaxListeners=function(){return this._maxListeners===void 0?kb.defaultMaxListeners:this._maxListeners},kb.prototype.emit=function(h){for(var i=[],g=1;g<arguments.length;g++)i.push(arguments[g]);g=h==="error";var _=this._events;if(_!==void 0)g=g&&_.error===void 0;else if(!g)return!1;if(g){var j;throw 0<i.length&&(j=i[0]),j instanceof Error?j:((i=Error("Unhandled error."+(j?" ("+j.message+")":""))).context=j,i)}if((g=_[h])===void 0)return!1;if(typeof g=="function")nv(g,this,i);else for(_=ir(g,j=g.length),g=0;g<j;++g)nv(_[g],this,i);return!0},kb.prototype.addListener=function(h,i){return fr(this,h,i,!1)},kb.prototype.on=kb.prototype.addListener,kb.prototype.prependListener=function(h,i){return fr(this,h,i,!0)},kb.prototype.once=function(h,i){return Cj(i),this.on(h,gr(this,h,i)),this},kb.prototype.prependOnceListener=function(h,i){return Cj(i),this.prependListener(h,gr(this,h,i)),this},kb.prototype.removeListener=function(h,i){var g;Cj(i);var _=this._events;if(_===void 0)return this;var j=_[h];if(j===void 0)return this;if(j===i||j.listener===i)--this._eventsCount==0?this._events=Object.create(null):(delete _[h],_.removeListener&&this.emit("removeListener",h,j.listener||i));else if(typeof j!="function"){var $=-1;for(g=j.length-1;0<=g;g--)if(j[g]===i||j[g].listener===i){var _n=j[g].listener;$=g;break}if(0>$)return this;if($===0)j.shift();else{for(;$+1<j.length;$++)j[$]=j[$+1];j.pop()}j.length===1&&(_[h]=j[0]),_.removeListener!==void 0&&this.emit("removeListener",h,_n||i)}return this},kb.prototype.off=kb.prototype.removeListener,kb.prototype.removeAllListeners=function(h){var i=this._events;if(i===void 0)return this;if(i.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):i[h]!==void 0&&(--this._eventsCount==0?this._events=Object.create(null):delete i[h]),this;if(arguments.length===0){var g=Object.keys(i);for(i=0;i<g.length;++i){var _=g[i];_!=="removeListener"&&this.removeAllListeners(_)}return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(typeof(g=i[h])=="function")this.removeListener(h,g);else if(g!==void 0)for(i=g.length-1;0<=i;i--)this.removeListener(h,g[i]);return this},kb.prototype.listeners=function(h){return hr(this,h,!0)},kb.prototype.rawListeners=function(h){return hr(this,h,!1)},kb.listenerCount=function(h,i){return typeof h.listenerCount=="function"?h.listenerCount(i):jr.call(h,i)},kb.prototype.listenerCount=jr,kb.prototype.eventNames=function(){return 0<this._eventsCount?NF(this._events):[]},kb.once=function(h,i){return new Promise(function(g,_){function j(_n){h.removeListener(i,$),_(_n)}function $(){typeof h.removeListener=="function"&&h.removeListener("error",j),g([].slice.call(arguments))}kr(h,i,$,{once:!0}),i!=="error"&&QA(h,j,{once:!0})})};var zh=Object.assign,qv=Object.defineProperty,Vi=!zh||Ga(function(){if(cb&&zh({b:1},zh(qv({},"a",{enumerable:!0,get:function(){qv(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var h={},i={},g=Symbol();return h[g]=7,"abcdefghijklmnopqrst".split("").forEach(function(_){i[_]=_}),zh({},h)[g]!=7||Ie(zh({},i)).join("")!="abcdefghijklmnopqrst"})?function(h,i){for(var g=Zb(h),_=arguments.length,j=1,$=Ai.f,_n=yi;_>j;)for(var _i,_s=zi(arguments[j++]),ga=$?Ie(_s).concat($(_s)):Ie(_s),ba=ga.length,xa=0;ba>xa;)_i=ga[xa++],(!cb||_n.call(_s,_i))&&(g[_i]=_s[_i]);return g}:zh;wa({target:"Object",stat:!0,forced:Object.assign!==Vi},{assign:Vi}),fv("Map",function(h){return function(){return h(this,arguments.length?arguments[0]:void 0)}},iv);var OF=Math.log,PF=Math.LN2;wa({target:"Math",stat:!0},{log2:function(h){return OF(h)/PF}});var QF=$b.f,RF=dg.f,SF=Sb.enforce,TF=mb("match"),te=na.RegExp,to=te.prototype,Wi=/a/g,uo=/a/g,vo=new te(Wi)!==Wi;if(cb&&ne("RegExp",!vo||Sd||Ga(function(){return uo[TF]=!1,te(Wi)!=Wi||te(uo)==uo||te(Wi,"i")!="/a/i"}))){for(var Oe=function(h,i){var g,_=this instanceof Oe,j=gn(h),$=i===void 0;return!_&&j&&h.constructor===Oe&&$||(vo?j&&!$&&(h=h.source):h instanceof Oe&&($&&(i=hk.call(h)),h=h.source),Sd&&(g=!!i&&-1<i.indexOf("y"))&&(i=i.replace(/y/g,"")),h=Ek(vo?new te(h,i):te(h,i),_?this:to,Oe),Sd&&g&&(SF(h).sticky=!0)),h},UF=function(h){h in Oe||QF(Oe,h,{configurable:!0,get:function(){return te[h]},set:function(i){te[h]=i}})},rv=RF(te),sv=0;rv.length>sv;)UF(rv[sv++]);to.constructor=Oe,Oe.prototype=to,Ob(na,"RegExp",Oe)}Ii("RegExp"),Ri("Float32",function(h){return function(i,g,_){return h(this,i,g,_)}}),Ri("Float64",function(h){return function(i,g,_){return h(this,i,g,_)}}),Ri("Uint32",function(h){return function(i,g,_){return h(this,i,g,_)}}),Ri("Uint16",function(h){return function(i,g,_){return h(this,i,g,_)}});var wo=function(h,i){return h===i?0:h==null?i==null?0:-1:i==null?h==null?0:1:typeof h.compare=="function"?h.compare(i):typeof i.compare=="function"?-i.compare(h):h<i?-1:h>i?1:0},xo=[],tv=xo.sort,VF=Ga(function(){xo.sort(void 0)}),WF=Ga(function(){xo.sort(null)}),XF=gg("sort");wa({target:"Array",proto:!0,forced:VF||!WF||!XF},{sort:function(h){return h===void 0?tv.call(Zb(this)):tv.call(Zb(this),Rc(h))}});var uv=Object.getPrototypeOf({}),Xi=function(h,i){var g;return h===i||(h==null?h==i:Ia(h.equiv)==="function"?h.equiv(i):i==null?h==i:Ia(i.equiv)==="function"?i.equiv(h):Ia(h)!=="string"&&Ia(i)!=="string"&&((g=Object.getPrototypeOf(h))!=null&&g!==uv||(g=Object.getPrototypeOf(i))!=null&&g!==uv?Ia(h)!=="function"&&h.length!==void 0&&Ia(i)!=="function"&&i.length!==void 0?ZF(h,i):h instanceof Set&&i instanceof Set?$F(h,i):h instanceof Map&&i instanceof Map?aG(h,i):h instanceof Date&&i instanceof Date?h.getTime()===i.getTime():h instanceof RegExp&&i instanceof RegExp?h.toString()===i.toString():h!=h&&i!=i:YF(h,i)))},ZF=function(h,i){var g=2<arguments.length&&arguments[2]!==void 0?arguments[2]:Xi,_=h.length;if(_===i.length)for(;0<=--_&&g(h[_],i[_]););return 0>_},$F=function(h,i){var g=2<arguments.length&&arguments[2]!==void 0?arguments[2]:Xi;return h.size===i.size&&g(ra(h.keys()).sort(),ra(i.keys()).sort())},aG=function(h,i){var g=2<arguments.length&&arguments[2]!==void 0?arguments[2]:Xi;return h.size===i.size&&g(ra(h).sort(),ra(i).sort())},YF=function(h,i){var g=2<arguments.length&&arguments[2]!==void 0?arguments[2]:Xi;if(Object.keys(h).length!==Object.keys(i).length)return!1;for(var _ in h)if(!i.hasOwnProperty(_)||!g(h[_],i[_]))return!1;return!0},vv=function(h){var i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:function(g){return g!==void 0?": "+g:""};return function(g){function _($){return ab(this,_),j.call(this,h($)+i($))}nb(_,g);var j=ob(_);return _}(di(Error))},bG=vv(function(){return"illegal argument(s)"}),Nk=function(h){throw new bG(h)},yo=vv(function(){return"index out of bounds"}),wv=1/4294967295,cG=function(){function h(){ab(this,h)}return Qb(h,[{key:"float",value:function(){var i=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1;return this.int()*wv*i}},{key:"norm",value:function(){var i=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1;return 2*(this.int()*wv-.5)*i}},{key:"minmax",value:function(i,g){return this.float()*(g-i)+i}}]),h}(),zo=Math.random,dG=new(function(h){function i(){return ab(this,i),g.apply(this,arguments)}nb(i,h);var g=ob(i);return Qb(i,[{key:"int",value:function(){return 4294967296*zo()>>>0}},{key:"float",value:function(){var _=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1;return zo()*_}},{key:"norm",value:function(){var _=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1;return 2*(zo()-.5)*_}}]),i}(cG)),hm=Symbol(),nr=function(){},eG=po.onFreeze,Ao=Object.freeze,fG=Ga(function(){Ao(1)});wa({target:"Object",stat:!0,forced:fG,sham:!ev},{freeze:function(h){return Ao&&fb(h)?Ao(eG(h)):h}});var gG=gg("reduce"),hG=!qe&&79<oe&&83>oe;wa({target:"Array",proto:!0,forced:!gG||hG},{reduce:function(h){return Bu(this,h,arguments.length,1<arguments.length?arguments[1]:void 0)}});var mr=function(h){return h!=null&&typeof h.xform=="function"?h.xform():h},Dj=function(){function h(i){ab(this,h),this.value=i}return Qb(h,[{key:"deref",value:function(){return this.value}}]),h}(),im=function(h){return h instanceof Dj?h.deref():h},SA=function(h,i){return[h,function(g){return g},i]},iG=W.mark(function(h,i){var g,_,j,$,_n,_i;return W.wrap(function(_s){for(;;)switch(_s.prev=_s.next){case 0:g=mr(h)(RA()),_=g[1],j=g[2],$=0;case 4:if(!($<i.length)){_s.next=15;break}if(_n=i[$],!((_i=j([],_n))instanceof Dj)){_s.next=10;break}return _s.delegateYield(im(_(_i.deref())),"t0",9);case 9:return _s.abrupt("return");case 10:if(!_i.length){_s.next=12;break}return _s.delegateYield(_i,"t1",12);case 12:$++,_s.next=4;break;case 15:return _s.delegateYield(im(_([])),"t2",16);case 16:case"end":return _s.stop()}},iG)}),TA=W.mark(lr),UA=function(h,i){return[h[0],h[1],i]},xv=!0;"findIndex"in[]&&Array(1).findIndex(function(){xv=!1}),wa({target:"Array",proto:!0,forced:xv},{findIndex:function(h){return lt(this,h,1<arguments.length?arguments[1]:void 0)}}),wf("findIndex"),wa({target:"Array",proto:!0},{fill:In}),wf("fill");var jG=function(){function h(i){ab(this,h),this._length=0,i&&this.into(i)}return Qb(h,[{key:"length",get:function(){return this._length}},{key:"copy",value:function(){return new h(this)}},{key:"empty",value:function(){return new h}},{key:"clear",value:function(){this.release()}},{key:"release",value:function(){for(var i,g=this.head;g;)i=g.next,delete g.value,delete g.prev,delete g.next,g=i;return delete this.head,delete this.tail,this._length=0,!0}},{key:"compare",value:function(i){var g=this._length;if(g<i._length)return-1;if(g>i._length)return 1;if(g===0)return 0;g=this.head,i=i.head;for(var _=0;g&&_==0;)_=wo(g.value,i.value),g=g.next,i=i.next;return _}},{key:"equiv",value:function(i){if(!(i instanceof h||i!=null&&typeof i!="function"&&i.length!==void 0)||this._length!==i.length)return!1;if(!this._length||this===i)return!0;for(var g=this.head,_=0;_<i.length;_++){if(!Xi(g.value,i[_]))return!1;g=g.next}return!0}},{key:Symbol.iterator,value:W.mark(function i(){var g;return W.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:g=this.head;case 1:if(!g){_.next=7;break}return _.next=4,g.value;case 4:g=g.next,_.next=1;break;case 7:case"end":return _.stop()}},i,this)})},{key:"seq",value:function(){var i=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0,g=1<arguments.length&&arguments[1]!==void 0?arguments[1]:this.length;if(!(i>=g||0>i)){i=this.nthCell(i);var _=this.nthCell(g-1);return g=function j($){return{first:function(){return $.value},next:function(){return $!==_&&$.next?j($.next):void 0}}},i?g(i):void 0}}},{key:"cycle",value:W.mark(function i(){return W.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.delegateYield(this,"t0",2);case 2:g.next=0;break;case 4:case"end":return g.stop()}},i,this)})},{key:"$reduce",value:function(i,g){for(var _=this.head;_&&!(g instanceof Dj);)g=i(g,_.value),_=_.next;return g}},{key:"drop",value:function(){var i=this.head;if(i)return(this.head=i.next)?delete this.head.prev:delete this.tail,this._length--,i.value}},{key:"cons",value:function(i){return i={value:i,next:this.head},this.head?this.head.prev=i:this.tail=i,this.head=i,this._length++,this}},{key:"insertBefore",value:function(i,g){return i||Nk("cell is undefined"),g={value:g,next:i,prev:i.prev},i.prev?i.prev.next=g:this.head=g,i.prev=g,this._length++,this}},{key:"insertAfter",value:function(i,g){return i||Nk("cell is undefined"),g={value:g,next:i.next,prev:i},i.next?i.next.prev=g:this.tail=g,i.next=g,this._length++,this}},{key:"insertBeforeNth",value:function(i,g){if(0>i&&(i+=this._length),0>=i)return this.cons(g);if(0>i||i>=this._length)throw new yo(i);return this.insertBefore(this.nthCellUnsafe(i),g)}},{key:"insertAfterNth",value:function(i,g){if(0>i&&(i+=this._length),i>=this._length-1)return this.push(g);if(0>i||i>=this._length)throw new yo(i);return this.insertAfter(this.nthCellUnsafe(i),g)}},{key:"insertSorted",value:function(i,g){g=g||wo;for(var _=this.head;_;){if(0>=g(i,_.value))return this.insertBefore(_,i);_=_.next}return this.push(i)}},{key:"find",value:function(i){for(var g=this.head;g;){if(g.value===i)return g;g=g.next}}},{key:"findWith",value:function(i){for(var g=this.head;g;){if(i(g.value))return g;g=g.next}}},{key:"concat",value:function(){for(var i=this.copy(),g=arguments.length,_=Array(g),j=0;j<g;j++)_[j]=arguments[j];for(g=0;g<_.length;g++)i.into(_[g]);return i}},{key:"into",value:function(i){for(var g=0;g<i.length;g++)this.push(i[g])}},{key:"slice",value:function(){var i=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0,g=1<arguments.length&&arguments[1]!==void 0?arguments[1]:this.length;i=0>i?i+this._length:i,g=0>g?g+this._length:g,(0>i||0>g)&&Nk("invalid indices: ${from} / ${to}");for(var _=new h,j=this.nthCell(i);j&&++i<=g;)_.push(j.value),j=j.next;return _}},{key:"splice",value:function(i){var g=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0,_=2<arguments.length?arguments[2]:void 0;if(typeof i=="number"){if(0>i&&(i+=this._length),0>i||i>=this._length)throw new yo(i);var j=this.nthCellUnsafe(i)}else j=i;var $=new h;if(0<g)for(;j&&0<g--;)this.remove(j),$.push(j.value),j=j.next;else j&&(j=j.next);if(_)if(j)for(g=0;g<_.length;g++)this.insertBefore(j,_[g]);else for(j=0;j<_.length;j++)this.push(_[j]);return $}},{key:"remove",value:function(i){return i.prev?i.prev.next=i.next:this.head=i.next,i.next?i.next.prev=i.prev:this.tail=i.prev,this._length--,this}},{key:"swap",value:function(i,g){if(i!==g){var _=i.value;i.value=g.value,g.value=_}return this}},{key:"push",value:function(i){return this.tail?(i={value:i,prev:this.tail},this.tail=this.tail.next=i,this._length++,this):this.cons(i)}},{key:"pop",value:function(){var i=this.tail;if(i)return(this.tail=i.prev)?delete this.tail.next:delete this.head,this._length--,i.value}},{key:"first",value:function(){return this.head&&this.head.value}},{key:"peek",value:function(){return this.tail&&this.tail.value}},{key:"setHead",value:function(i){return this.head?(this.head.value=i,this):this.cons(i)}},{key:"setTail",value:function(i){return this.tail?(this.tail.value=i,this):this.push(i)}},{key:"setNth",value:function(i,g){var _=this.nthCell(i);return!_&&Nk("index out of bounds: ".concat(i)),_.value=g,this}},{key:"nth",value:function(i,g){return(i=this.nthCell(i))?i.value:g}},{key:"nthCell",value:function(i){if(0>i&&(i+=this._length),!(0>i||i>=this._length))return this.nthCellUnsafe(i)}},{key:"rotateLeft",value:function(){switch(this._length){case 0:case 1:return this;case 2:return this.swap(this.head,this.tail);default:return this.push(this.drop())}}},{key:"rotateRight",value:function(){switch(this._length){case 0:case 1:return this;case 2:return this.swap(this.head,this.tail);default:var i=this.peek();return this.pop(),this.cons(i)}}},{key:"map",value:function(i){for(var g=new h,_=this.head;_;)g.push(i(_.value)),_=_.next;return g}},{key:"filter",value:function(i){for(var g=new h,_=this.head;_;)i(_.value)&&g.push(_.value),_=_.next;return g}},{key:"reduce",value:function(i,g){for(var _=this.head;_;)g=i(g,_.value),_=_.next;return g}},{key:"shuffle",value:function(i){var g=1<arguments.length&&arguments[1]!==void 0?arguments[1]:dG;if(2>this._length)return this;for(i=i??Math.ceil(1.5*Math.log2(this._length));0<i;i--)for(var _=this.head;_;){var j=_.next;.5>g.float()?this.asHead(_):this.asTail(_),_=j}return this}},{key:"sort",value:function(){var i=0<arguments.length&&arguments[0]!==void 0?arguments[0]:wo;if(!this._length)return this;for(var g=1;;){var _=this.head;this.tail=this.head=void 0;for(var j=0;_;){j++;for(var $=_,_n=0,_i=0;_i<g&&(_n++,$=$.next);_i++);for(_i=g;0<_n||0<_i&&$;){if(_n===0){var _s=$;$=$.next,_i--}else $&&_i!==0?0>=i(_.value,$.value)?(_s=_,_=_.next,_n--):(_s=$,$=$.next,_i--):(_s=_,_=_.next,_n--);this.tail?this.tail.next=_s:this.head=_s,_s.prev=this.tail,this.tail=_s}_=$}if(this.tail.next=void 0,1>=j)return this;g*=2}}},{key:"reverse",value:function(){for(var i=this.head,g=this.tail,_=(this._length>>>1)+(1&this._length);i&&g&&0<_;){var j=i.value;i.value=g.value,g.value=j,i=i.next,g=g.prev,_--}return this}},{key:"asHead",value:function(i){return i===this.head||(this.remove(i),this.head.prev=i,i.next=this.head,i.prev=void 0,this.head=i,this._length++),this}},{key:"asTail",value:function(i){return i===this.tail||(this.remove(i),this.tail.next=i,i.prev=this.tail,i.next=void 0,this.tail=i,this._length++),this}},{key:"toString",value:function(){for(var i=[],g=this.head;g;)i.push(String(g.value)),g=g.next;return i.join(", ")}},{key:"toJSON",value:function(){return ra(this)}},{key:"nthCellUnsafe",value:function(i){if(i<=this._length>>1)var g=this.head,_="next";else g=this.tail,_="prev",i=this._length-i-1;for(;0<i--&&g;)g=g[_];return g}}]),h}(),ue=function(){function h(i,g){ab(this,h),g=Object.assign({maxlen:1/0,maxsize:1/0,map:function(){return new Map},ksize:function(){return 0},vsize:function(){return 0}},g),this.map=g.map(),this.items=new jG,this._size=0,this.opts=g,i&&this.into(i)}return Qb(h,[{key:"length",get:function(){return this.items.length}},{key:"size",get:function(){return this._size}},{key:Symbol.iterator,value:function(){return this.entries()}},{key:"entries",value:function(){return Ej(function(i){return[i.k,i]},this.items)}},{key:"keys",value:function(){return Ej(function(i){return i.k},this.items)}},{key:"values",value:function(){return Ej(function(i){return i.v},this.items)}},{key:"copy",value:function(){var i=this.empty();i.items=this.items.copy();for(var g=i.items.head;g;)i.map.set(g.value.k,g),g=g.next;return i}},{key:"empty",value:function(){return new h(null,this.opts)}},{key:"release",value:function(){this._size=0,this.map.clear();var i=this.opts.release;if(i){for(var g;g=this.items.drop();)i(g.k,g.v);return!0}return this.items.release()}},{key:"has",value:function(i){return this.map.has(i)}},{key:"get",value:function(i,g){return(i=this.map.get(i))?this.resetEntry(i):g}},{key:"set",value:function(i,g){var _=this.opts.ksize(i)+this.opts.vsize(g),j=this.map.get(i);return this._size+=Math.max(0,_-(j?j.value.s:0)),this.ensureSize()&&this.doSetEntry(j,i,g,_),g}},{key:"into",value:function(i){for(var g=0;g<i.length;g++){var _=i[g];this.set(_[0],_[1])}return this}},{key:"getSet",value:function(i,g){var _=this,j=this.map.get(i);return j?Promise.resolve(this.resetEntry(j)):g().then(function($){return _.set(i,$)})}},{key:"delete",value:function(i){return!!(i=this.map.get(i))&&(this.removeEntry(i),!0)}},{key:"resetEntry",value:function(i){return this.items.asTail(i),i.value.v}},{key:"ensureSize",value:function(){for(var i=this.opts.release,g=this.opts.maxsize,_=this.opts.maxlen;this._size>g||this.length>=_;){var j=this.items.drop();if(!j)return!1;this.map.delete(j.k),i&&i(j.k,j.v),this._size-=j.s}return!0}},{key:"removeEntry",value:function(i){var g=i.value;this.map.delete(g.k),this.items.remove(i),this.opts.release&&this.opts.release(g.k,g.v),this._size-=g.s}},{key:"doSetEntry",value:function(i,g,_,j){i?(i.value.v=_,i.value.s=j,this.items.asTail(i)):(this.items.push({k:g,v:_,s:j}),this.map.set(g,this.items.tail))}}]),h}(),kG=function(h){function i(_,j){return ab(this,i),j=Object.assign({ttl:36e5},j),g.call(this,_,j)}nb(i,h);var g=ob(i);return Qb(i,[{key:"empty",value:function(){return new i(null,this.opts)}},{key:"has",value:function(_){return this.get(_)!==void 0}},{key:"get",value:function(_,j){if(_=this.map.get(_)){if(_.value.t>=Date.now())return this.resetEntry(_);this.removeEntry(_)}return j}},{key:"set",value:function(_,j){var $=2<arguments.length&&arguments[2]!==void 0?arguments[2]:this.opts.ttl,_n=this.opts.ksize(_)+this.opts.vsize(j),_i=this.map.get(_);return this._size+=Math.max(0,_n-(_i?_i.value.s:0)),this.ensureSize()&&($=Date.now()+$,_i?(_i.value.v=j,_i.value.s=_n,_i.value.t=$,this.items.asTail(_i)):(this.items.push({k:_,v:j,s:_n,t:$}),this.map.set(_,this.items.tail))),j}},{key:"getSet",value:function(_,j){var $=this,_n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:this.opts.ttl,_i=this.get(_);return _i?Promise.resolve(_i):j().then(function(_s){return $.set(_,_s,_n)})}},{key:"prune",value:function(){for(var _=Date.now(),j=this.items.head;j;)j.value.t<_&&this.removeEntry(j),j=j.next}},{key:"ensureSize",value:function(){for(var _=this.opts.maxsize,j=this.opts.maxlen,$=Date.now(),_n=this.items.head;_n&&(this._size>_||this.length>=j);)_n.value.t<$&&this.removeEntry(_n),_n=_n.next;return fm(Tf(i.prototype),"ensureSize",this).call(this)}}]),i}(ue),yv=Ia(qb)=="object"&&qb&&qb.Object===Object&&qb,lG=(typeof self>"u"?"undefined":Ia(self))=="object"&&self&&self.Object===Object&&self,hd=yv||lG||Function("return this")(),xd=hd.Symbol,zv=Object.prototype,mG=zv.hasOwnProperty,nG=zv.toString,Yi=xd?xd.toStringTag:void 0,oG=Object.prototype.toString,Av=xd?xd.toStringTag:void 0,ng=function(h){if(h==null)h=h===void 0?"[object Undefined]":"[object Null]";else if(Av&&Av in Object(h)){var i=mG.call(h,Yi),g=h[Yi];try{h[Yi]=void 0;var _=!0}catch{}var j=nG.call(h);_&&(i?h[Yi]=g:delete h[Yi]),h=j}else h=oG.call(h);return h},Kc=function(h){var i=Ia(h);return h!=null&&(i=="object"||i=="function")},Em=function(h){return!!Kc(h)&&((h=ng(h))=="[object Function]"||h=="[object GeneratorFunction]"||h=="[object AsyncFunction]"||h=="[object Proxy]")},Bo=hd["__core-js_shared__"],Bv=function(){var h=/[^.]+$/.exec(Bo&&Bo.keys&&Bo.keys.IE_PROTO||"");return h?"Symbol(src)_1."+h:""}(),pG=Function.prototype.toString,og=function(h){if(h!=null){try{return pG.call(h)}catch{}return h+""}return""},qG=/^\[object .+?Constructor\]$/,rG=RegExp("^"+Function.prototype.toString.call(Object.prototype.hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),pg=function(h,i){return h=h==null?void 0:h[i],!Kc(h)||Bv&&Bv in h||!(Em(h)?rG:qG).test(og(h))?void 0:h},Zi=pg(Object,"create"),sG=Object.prototype.hasOwnProperty,tG=Object.prototype.hasOwnProperty;Vf.prototype.clear=function(){this.__data__=Zi?Zi(null):{},this.size=0},Vf.prototype.delete=function(h){return h=this.has(h)&&delete this.__data__[h],this.size-=h?1:0,h},Vf.prototype.get=function(h){var i=this.__data__;return Zi?(h=i[h])==="__lodash_hash_undefined__"?void 0:h:sG.call(i,h)?i[h]:void 0},Vf.prototype.has=function(h){var i=this.__data__;return Zi?i[h]!==void 0:tG.call(i,h)},Vf.prototype.set=function(h,i){var g=this.__data__;return this.size+=this.has(h)?0:1,g[h]=Zi&&i===void 0?"__lodash_hash_undefined__":i,this};var $i=function(h,i){return h===i||h!=h&&i!=i},Ok=function(h,i){for(var g=h.length;g--;)if($i(h[g][0],i))return g;return-1},uG=Array.prototype.splice;Mg.prototype.clear=function(){this.__data__=[],this.size=0},Mg.prototype.delete=function(h){var i=this.__data__;return!(0>(h=Ok(i,h)))&&(h==i.length-1?i.pop():uG.call(i,h,1),--this.size,!0)},Mg.prototype.get=function(h){var i=this.__data__;return 0>(h=Ok(i,h))?void 0:i[h][1]},Mg.prototype.has=function(h){return-1<Ok(this.__data__,h)},Mg.prototype.set=function(h,i){var g=this.__data__,_=Ok(g,h);return 0>_?(++this.size,g.push([h,i])):g[_][1]=i,this};var Gj=Mg,aj=pg(hd,"Map"),Pk=function(h,i){h=h.__data__;var g=Ia(i);return(g=="string"||g=="number"||g=="symbol"||g=="boolean"?i!=="__proto__":i===null)?h[typeof i=="string"?"string":"hash"]:h.map};Ng.prototype.clear=function(){this.size=0,this.__data__={hash:new Vf,map:new(aj||Gj),string:new Vf}},Ng.prototype.delete=function(h){return h=Pk(this,h).delete(h),this.size-=h?1:0,h},Ng.prototype.get=function(h){return Pk(this,h).get(h)},Ng.prototype.has=function(h){return Pk(this,h).has(h)},Ng.prototype.set=function(h,i){var g=Pk(this,h),_=g.size;return g.set(h,i),this.size+=g.size==_?0:1,this};var Fj=Ng;ei.prototype.add=ei.prototype.push=function(h){return this.__data__.set(h,"__lodash_hash_undefined__"),this},ei.prototype.has=function(h){return this.__data__.has(h)};var Cv=function(h,i,g,_){var j=h.length;for(g+=_?1:-1;_?g--:++g<j;)if(i(h[g],g,h))return g;return-1},vG=function(h){return h!=h},wG=function(h,i){var g;if(g=!(h==null||!h.length)){if(i==i)e:{g=-1;for(var _=h.length;++g<_;)if(h[g]===i){h=g;break e}h=-1}else h=Cv(h,vG,0);g=-1<h}return g},xG=function(h,i,g){for(var _=-1,j=h==null?0:h.length;++_<j;)if(g(i,h[_]))return!0;return!1},yG=function(h,i){return h.has(i)},Ah=pg(hd,"Set"),zG=function(){},Co=function(h){var i=-1,g=Array(h.size);return h.forEach(function(_){g[++i]=_}),g},AG=1/0,BG=Ah&&1/Co(new Ah([,-0]))[1]==AG?function(h){return new Ah(h)}:zG,Do=function(h,i,g){var _=-1,j=wG,$=h.length,_n=!0,_i=[],_s=_i;if(g)_n=!1,j=xG;else if(200<=$){if(j=i?null:BG(h))return Co(j);_n=!1,j=yG,_s=new ei}else _s=i?[]:_i;e:for(;++_<$;){var ga=h[_],ba=i?i(ga):ga;if(ga=g||ga!==0?ga:0,_n&&ba==ba){for(var xa=_s.length;xa--;)if(_s[xa]===ba)continue e;i&&_s.push(ba),_i.push(ga)}else j(_s,ba,g)||(_s!==_i&&_s.push(ba),_i.push(ga))}return _i},Dv=function(h){for(var i=-1,g=h==null?0:h.length,_={};++i<g;){var j=h[i];_[j[0]]=j[1]}return _},Rg=function(h,i){for(var g=-1,_=h==null?0:h.length,j=Array(_);++g<_;)j[g]=i(h[g],g,h);return j};Og.prototype.clear=function(){this.__data__=new Gj,this.size=0},Og.prototype.delete=function(h){var i=this.__data__;return h=i.delete(h),this.size=i.size,h},Og.prototype.get=function(h){return this.__data__.get(h)},Og.prototype.has=function(h){return this.__data__.has(h)},Og.prototype.set=function(h,i){var g=this.__data__;if(g instanceof Gj){var _=g.__data__;if(!aj||199>_.length)return _.push([h,i]),this.size=++g.size,this;g=this.__data__=new Fj(_)}return g.set(h,i),this.size=g.size,this};var Qg=Og,cB=function(h,i){for(var g=-1,_=h==null?0:h.length;++g<_&&i(h[g],g,h)!==!1;);return h},Qk=function(){try{var h=pg(Object,"defineProperty");return h({},"",{}),h}catch{}}(),bj=function(h,i,g){i=="__proto__"&&Qk?Qk(h,i,{configurable:!0,enumerable:!0,value:g,writable:!0}):h[i]=g},CG=Object.prototype.hasOwnProperty,sr=function(h,i,g){var _=h[i];CG.call(h,i)&&$i(_,g)&&(g!==void 0||i in h)||bj(h,i,g)},bh=function(h,i,g,_){var j=!g;g||(g={});for(var $=-1,_n=i.length;++$<_n;){var _i=i[$],_s=_?_(g[_i],h[_i],_i,g,h):void 0;_s===void 0&&(_s=h[_i]),j?bj(g,_i,_s):sr(g,_i,_s)}return g},ee=function(h){return h!=null&&Ia(h)=="object"},Ev=function(h){return ee(h)&&ng(h)=="[object Arguments]"},Fv=Object.prototype,DG=Fv.hasOwnProperty,EG=Fv.propertyIsEnumerable,oi=Ev(function(){return arguments}())?Ev:function(h){return ee(h)&&DG.call(h,"callee")&&!EG.call(h,"callee")},lc=Array.isArray,FG=function(){return!1},gi=kc(function(h,i){var g=(i=i&&!i.nodeType&&i)&&h&&!h.nodeType&&h;i=g&&g.exports===i?hd.Buffer:void 0,h.exports=(i?i.isBuffer:void 0)||FG}),GG=/^(?:0|[1-9]\d*)$/,Eo=function(h,i){var g=Ia(h);return!!(i=i??9007199254740991)&&(g=="number"||g!="symbol"&&GG.test(h))&&-1<h&&h%1==0&&h<i},Fo=function(h){return typeof h=="number"&&-1<h&&h%1==0&&9007199254740991>=h},Hb={};Hb["[object Float32Array]"]=Hb["[object Float64Array]"]=Hb["[object Int8Array]"]=Hb["[object Int16Array]"]=Hb["[object Int32Array]"]=Hb["[object Uint8Array]"]=Hb["[object Uint8ClampedArray]"]=Hb["[object Uint16Array]"]=Hb["[object Uint32Array]"]=!0,Hb["[object Arguments]"]=Hb["[object Array]"]=Hb["[object ArrayBuffer]"]=Hb["[object Boolean]"]=Hb["[object DataView]"]=Hb["[object Date]"]=Hb["[object Error]"]=Hb["[object Function]"]=Hb["[object Map]"]=Hb["[object Number]"]=Hb["[object Object]"]=Hb["[object RegExp]"]=Hb["[object Set]"]=Hb["[object String]"]=Hb["[object WeakMap]"]=!1;var HG=function(h){return ee(h)&&Fo(h.length)&&!!Hb[ng(h)]},Rk=function(h){return function(i){return h(i)}},Bh=kc(function(h,i){var g=i&&!i.nodeType&&i;g=(i=g&&h&&!h.nodeType&&h)&&i.exports===g&&yv.process;e:{try{var _=i&&i.require&&i.require("util").types;if(_){var j=_;break e}j=g&&g.binding&&g.binding("util");break e}catch{}j=void 0}h.exports=j}),Gv=Bh&&Bh.isTypedArray,om=Gv?Rk(Gv):HG,IG=Object.prototype.hasOwnProperty,Hv=function(h,i){var g=lc(h),_=!g&&oi(h),j=!g&&!_&&gi(h),$=!g&&!_&&!j&&om(h);if(g=g||_||j||$){_=h.length;for(var _n=String,_i=-1,_s=Array(_);++_i<_;)_s[_i]=_n(_i);_=_s}else _=[];for(var ga in _n=_.length,h)!i&&!IG.call(h,ga)||g&&(ga=="length"||j&&(ga=="offset"||ga=="parent")||$&&(ga=="buffer"||ga=="byteLength"||ga=="byteOffset")||Eo(ga,_n))||_.push(ga);return _},JG=Object.prototype,Go=function(h){var i=h&&h.constructor;return h===(typeof i=="function"&&i.prototype||JG)},Iv=function(h,i){return function(g){return h(i(g))}},KG=Iv(Object.keys,Object),LG=Object.prototype.hasOwnProperty,$f=function(h){return h!=null&&Fo(h.length)&&!Em(h)},Wf=function(h){if($f(h))h=Hv(h);else if(Go(h)){var i,g=[];for(i in Object(h))LG.call(h,i)&&i!="constructor"&&g.push(i);h=g}else h=KG(h);return h},ZA=function(h,i){return h&&bh(i,Wf(i),h)},MG=Object.prototype.hasOwnProperty,hi=function(h){if($f(h))h=Hv(h,!0);else if(Kc(h)){var i=Go(h),g=[];for(_ in h)(_!="constructor"||!i&&MG.call(h,_))&&g.push(_);h=g}else{var _=[];if(h!=null)for(i in Object(h))_.push(i);h=_}return h},XA=function(h,i){return h&&bh(i,hi(i),h)},pr=kc(function(h,i){var g=(i=i&&!i.nodeType&&i)&&h&&!h.nodeType&&h,_=(i=g&&g.exports===i?hd.Buffer:void 0)?i.allocUnsafe:void 0;h.exports=function(j,$){return $?j.slice():($=j.length,$=_?_($):new j.constructor($),j.copy($),$)}}),jm=function(h,i){var g=-1,_=h.length;for(i||(i=Array(_));++g<_;)i[g]=h[g];return i},NG=function(h,i){for(var g=-1,_=h==null?0:h.length,j=0,$=[];++g<_;){var _n=h[g];i(_n,g,h)&&($[j++]=_n)}return $},Jv=function(){return[]},OG=Object.prototype.propertyIsEnumerable,Kv=Object.getOwnPropertySymbols,Ho=Kv?function(h){return h==null?[]:(h=Object(h),NG(Kv(h),function(i){return OG.call(h,i)}))}:Jv,YA=function(h,i){return bh(h,Ho(h),i)},nm=function(h,i){for(var g=-1,_=i.length,j=h.length;++g<_;)h[j+g]=i[g];return h},Io=Iv(Object.getPrototypeOf,Object),Lv=Object.getOwnPropertySymbols?function(h){for(var i=[];h;)nm(i,Ho(h)),h=Io(h);return i}:Jv,WA=function(h,i){return bh(h,Lv(h),i)},Mv=function(h,i,g){return i=i(h),lc(h)?i:nm(i,g(h))},km=function(h){return Mv(h,Wf,Ho)},rr=function(h){return Mv(h,hi,Lv)},Jo=pg(hd,"DataView"),Ko=pg(hd,"Promise"),Lo=pg(hd,"WeakMap"),PG=og(Jo),QG=og(aj),RG=og(Ko),SG=og(Ah),TG=og(Lo),qg=ng;(Jo&&qg(new Jo(new ArrayBuffer(1)))!="[object DataView]"||aj&&qg(new aj)!="[object Map]"||Ko&&qg(Ko.resolve())!="[object Promise]"||Ah&&qg(new Ah)!="[object Set]"||Lo&&qg(new Lo)!="[object WeakMap]")&&(qg=function(h){var i=ng(h);if(h=(h=i=="[object Object]"?h.constructor:void 0)?og(h):"")switch(h){case PG:return"[object DataView]";case QG:return"[object Map]";case RG:return"[object Promise]";case SG:return"[object Set]";case TG:return"[object WeakMap]"}return i});var fi=qg,UG=Object.prototype.hasOwnProperty,VA=function(h){var i=h.length,g=new h.constructor(i);return i&&typeof h[0]=="string"&&UG.call(h,"index")&&(g.index=h.index,g.input=h.input),g},Sk=hd.Uint8Array,Mo=function(h){var i=new h.constructor(h.byteLength);return new Sk(i).set(new Sk(h)),i},VG=/\w*$/,Nv=xd?xd.prototype:void 0,Ov=Nv?Nv.valueOf:void 0,cs=function(h,i){return i=i?Mo(h.buffer):h.buffer,new h.constructor(i,h.byteOffset,h.length)},$A=function(h,i,g){var _=h.constructor;switch(i){case"[object ArrayBuffer]":return Mo(h);case"[object Boolean]":case"[object Date]":return new _(+h);case"[object DataView]":return i=g?Mo(h.buffer):h.buffer,new h.constructor(i,h.byteOffset,h.byteLength);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return cs(h,g);case"[object Map]":return new _;case"[object Number]":case"[object String]":return new _(h);case"[object RegExp]":return(i=new h.constructor(h.source,VG.exec(h))).lastIndex=h.lastIndex,i;case"[object Set]":return new _;case"[object Symbol]":return Ov?Object(Ov.call(h)):{}}},Pv=Object.create,WG=function(){function h(){}return function(i){return Kc(i)?Pv?Pv(i):(h.prototype=i,i=new h,h.prototype=void 0,i):{}}}(),qr=function(h){return typeof h.constructor!="function"||Go(h)?{}:WG(Io(h))},XG=function(h){return ee(h)&&fi(h)=="[object Map]"},Qv=Bh&&Bh.isMap,bB=Qv?Rk(Qv):XG,YG=function(h){return ee(h)&&fi(h)=="[object Set]"},Rv=Bh&&Bh.isSet,aB=Rv?Rk(Rv):YG,zb={};zb["[object Arguments]"]=zb["[object Array]"]=zb["[object ArrayBuffer]"]=zb["[object DataView]"]=zb["[object Boolean]"]=zb["[object Date]"]=zb["[object Float32Array]"]=zb["[object Float64Array]"]=zb["[object Int8Array]"]=zb["[object Int16Array]"]=zb["[object Int32Array]"]=zb["[object Map]"]=zb["[object Number]"]=zb["[object Object]"]=zb["[object RegExp]"]=zb["[object Set]"]=zb["[object String]"]=zb["[object Symbol]"]=zb["[object Uint8Array]"]=zb["[object Uint8ClampedArray]"]=zb["[object Uint16Array]"]=zb["[object Uint32Array]"]=!0,zb["[object Error]"]=zb["[object Function]"]=zb["[object WeakMap]"]=!1;var Sg=function(h){return Ia(h)=="symbol"||ee(h)&&ng(h)=="[object Symbol]"},ZG=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,$G=/^\w*$/,No=function(h,i){if(lc(h))return!1;var g=Ia(h);return!(g!="number"&&g!="symbol"&&g!="boolean"&&h!=null&&!Sg(h))||$G.test(h)||!ZG.test(h)||i!=null&&h in Object(i)};lm.Cache=Fj;var aH=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,bH=/\\(\\)?/g,cH=function(h){var i=(h=lm(h,function(g){return i.size===500&&i.clear(),g})).cache;return h}(function(h){var i=[];return h.charCodeAt(0)===46&&i.push(""),h.replace(aH,function(g,_,j,$){i.push(j?$.replace(bH,"$1"):_||g)}),i}),dB=1/0,Sv=xd?xd.prototype:void 0,ur=Sv?Sv.toString:void 0,Tk=function(h,i){return lc(h)?h:No(h,i)?[h]:cH(h==null?"":tr(h))},dH=1/0,cj=function(h){if(typeof h=="string"||Sg(h))return h;var i=h+"";return i=="0"&&1/h==-dH?"-0":i},Uk=function(h,i){for(var g=0,_=(i=Tk(i,h)).length;h!=null&&g<_;)h=h[cj(i[g++])];return g&&g==_?h:void 0},eH=function(h,i){if(!(2>(i=Tk(i,h)).length)){var g=i,_=0,j=-1,$=-1,_n=g.length;for(0>_&&(_=-_>_n?0:_n+_),0>(j=j>_n?_n:j)&&(j+=_n),_n=_>j?0:j-_>>>0,_>>>=0,j=Array(_n);++$<_n;)j[$]=g[$+_];h=Uk(h,j)}return(g=h==null)||(g=i==null?0:i.length,g=delete h[cj(g?i[g-1]:void 0)]),g},Tv=Function.prototype.toString,fH=Object.prototype.hasOwnProperty,gH=Tv.call(Object),ds=function(h){return!(!ee(h)||ng(h)!="[object Object]")&&((h=Io(h))===null||typeof(h=fH.call(h,"constructor")&&h.constructor)=="function"&&h instanceof h&&Tv.call(h)==gH)},hH=function(h){return ds(h)?void 0:h},Uv=xd?xd.isConcatSpreadable:void 0,eB=function(h){return lc(h)||oi(h)||!!(Uv&&h&&h[Uv])},iH=function(h){return h!=null&&h.length?mm(h,1):[]},jH=function(h,i,g){switch(g.length){case 0:return h.call(i);case 1:return h.call(i,g[0]);case 2:return h.call(i,g[0],g[1]);case 3:return h.call(i,g[0],g[1],g[2])}return h.apply(i,g)},Vv=Math.max,Wv=function(h,i,g){return i=Vv(i===void 0?h.length-1:i,0),function(){for(var _=arguments,j=-1,$=Vv(_.length-i,0),_n=Array($);++j<$;)_n[j]=_[i+j];for(j=-1,$=Array(i+1);++j<i;)$[j]=_[j];return $[i]=g(_n),jH(h,this,$)}},kH=function(h){return function(){return h}},Vk=function(h){return h},lH=Date.now,Xv=function(h){var i=0,g=0;return function(){var _=lH(),j=16-(_-g);if(g=_,0<j){if(800<=++i)return arguments[0]}else i=0;return h.apply(void 0,arguments)}}(Qk?function(h,i){return Qk(h,"toString",{configurable:!0,enumerable:!1,value:kH(i),writable:!0})}:Vk),Oo=function(h){return Xv(Wv(h,void 0,iH),h+"")}(function(h,i){var g={};if(h==null)return g;var _=!1;i=Rg(i,function($){return $=Tk($,h),_||(_=1<$.length),$}),bh(h,rr(h),g),_&&(g=Pg(g,7,hH));for(var j=i.length;j--;)eH(g,i[j]);return g}),mH=function(h,i,g,_){for(var j=-1,$=h==null?0:h.length;++j<$;){var _n=h[j];i(_,_n,g(_n),h)}return _},bs=function(h,i,g){for(var _=-1,j=Object(h),$=(g=g(h)).length;$--;){var _n=g[++_];if(i(j[_n],_n,j)===!1)break}return h},Yv=function(h,i){return h&&bs(h,i,Wf)},Po=function(h,i){return function(g,_){if(g==null)return g;if(!$f(g))return h(g,_);for(var j=g.length,$=-1,_n=Object(g);++$<j&&_(_n[$],$,_n)!==!1;);return g}}(Yv),nH=function(h,i,g,_){return Po(h,function(j,$,_n){i(_,j,g(j),_n)}),_},Zv=function(h,i){for(var g=-1,_=h==null?0:h.length;++g<_;)if(i(h[g],g,h))return!0;return!1},vr=function(h,i,g,_,j,$){var _n=1&g,_i=h.length,_s=i.length;if(_i!=_s&&!(_n&&_s>_i))return!1;_s=$.get(h);var ga=$.get(i);if(_s&&ga)return _s==i&&ga==h;_s=-1,ga=!0;var ba=2&g?new ei:void 0;for($.set(h,i),$.set(i,h);++_s<_i;){var xa=h[_s],El=i[_s];if(_)var Tl=_n?_(El,xa,_s,i,h,$):_(xa,El,_s,h,i,$);if(Tl!==void 0){if(Tl)continue;ga=!1;break}if(ba){if(!Zv(i,function(Sl,Il){if(!ba.has(Il)&&(xa===Sl||j(xa,Sl,g,_,$)))return ba.push(Il)})){ga=!1;break}}else if(xa!==El&&!j(xa,El,g,_,$)){ga=!1;break}}return $.delete(h),$.delete(i),ga},oH=function(h){var i=-1,g=Array(h.size);return h.forEach(function(_,j){g[++i]=[j,_]}),g},$v=xd?xd.prototype:void 0,Qo=$v?$v.valueOf:void 0,fB=function(h,i,g,_,j,$,_n){switch(g){case"[object DataView]":if(h.byteLength!=i.byteLength||h.byteOffset!=i.byteOffset)break;h=h.buffer,i=i.buffer;case"[object ArrayBuffer]":if(h.byteLength!=i.byteLength||!$(new Sk(h),new Sk(i)))break;return!0;case"[object Boolean]":case"[object Date]":case"[object Number]":return $i(+h,+i);case"[object Error]":return h.name==i.name&&h.message==i.message;case"[object RegExp]":case"[object String]":return h==i+"";case"[object Map]":var _i=oH;case"[object Set]":if(_i||(_i=Co),h.size!=i.size&&!(1&_))break;return(g=_n.get(h))?g==i:(_|=2,_n.set(h,i),i=vr(_i(h),_i(i),_,j,$,_n),_n.delete(h),i);case"[object Symbol]":if(Qo)return Qo.call(h)==Qo.call(i)}return!1},gB=Object.prototype.hasOwnProperty,wr=Object.prototype.hasOwnProperty,pH=function(h,i,g,_){var j=g.length,$=j,_n=!_;if(h==null)return!$;for(h=Object(h);j--;){var _i=g[j];if(_n&&_i[2]?_i[1]!==h[_i[0]]:!(_i[0]in h))return!1}for(;++j<$;){var _s=(_i=g[j])[0],ga=h[_s],ba=_i[1];if(_n&&_i[2]){if(ga===void 0&&!(_s in h))return!1}else{if(_i=new Qg,_)var xa=_(ga,ba,_s,h,i,_i);if(xa===void 0?!Tg(ba,ga,3,_,_i):!xa)return!1}}return!0},qH=function(h){for(var i=Wf(h),g=i.length;g--;){var _=i[g],j=h[_];i[g]=[_,j,j==j&&!Kc(j)]}return i},aw=function(h,i){return function(g){return g!=null&&g[h]===i&&(i!==void 0||h in Object(g))}},rH=function(h){var i=qH(h);return i.length==1&&i[0][2]?aw(i[0][0],i[0][1]):function(g){return g===h||pH(g,h,i)}},sH=function(h,i){return No(h)&&i==i&&!Kc(i)?aw(cj(h),i):function(g){var _=g==null?void 0:Uk(g,h);if((_=_===void 0?void 0:_)===void 0&&_===i){if(_=g!=null){for(var j=-1,$=(_=Tk(_=h,g)).length,_n=!1;++j<$;){var _i=cj(_[j]);if(!(_n=g!=null&&g!=null&&_i in Object(g)))break;g=g[_i]}_n||++j!=$?_=_n:_=!!($=g==null?0:g.length)&&Fo($)&&Eo(_i,$)&&(lc(g)||oi(g))}_i=_}else _i=Tg(i,_,3);return _i}},tH=function(h){return function(i){return i==null?void 0:i[h]}},uH=function(h){return function(i){return Uk(i,h)}},Ch=function(h){return typeof h=="function"?h:h==null?Vk:Ia(h)=="object"?lc(h)?sH(h[0],h[1]):rH(h):No(h)?tH(cj(h)):uH(h)},Ro=function(h,i){return function(g,_){var j={};return(lc(g)?mH:nH)(g,h,Ch(_),j)}}(function(h,i,g){bj(h,g,i)}),Pe=function(h,i){var g={};return i=Ch(i),Yv(h,function(_,j,$){bj(g,j,i(_,j,$))}),g};wa({target:"String",proto:!0,forced:Ga(function(){var h="".sub('"');return h!==h.toLowerCase()||3<h.split('"').length})},{sub:function(){return"<sub>"+String(Ec(this))+"</sub>"}});var D=Ab,yd=null;try{yd=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(h){}Ab.prototype.__isLong__,Object.defineProperty(Ab.prototype,"__isLong__",{value:!0}),Ab.isLong=Lc;var yr={},xr={};Ab.fromInt=Xf,Ab.fromNumber=qd,Ab.fromBits=Bb;var Hj=Math.pow;Ab.fromString=pm,Ab.fromValue=Nd;var Ug=4294967296,zr=Ug*Ug,Br=zr/2,bw=Xf(16777216),rd=Xf(0);Ab.ZERO=rd;var Yf=Xf(0,!0);Ab.UZERO=Yf;var Dh=Xf(1);Ab.ONE=Dh;var cw=Xf(1,!0);Ab.UONE=cw;var So=Xf(-1);Ab.NEG_ONE=So;var Cr=Bb(-1,2147483647,!1);Ab.MAX_VALUE=Cr;var Ar=Bb(-1,-1,!0);Ab.MAX_UNSIGNED_VALUE=Ar;var Mc=Bb(0,-2147483648,!1);Ab.MIN_VALUE=Mc;var sa=Ab.prototype;sa.toInt=function(){return this.unsigned?this.low>>>0:this.low},sa.toNumber=function(){return this.unsigned?(this.high>>>0)*Ug+(this.low>>>0):this.high*Ug+(this.low>>>0)},sa.toString=function(h){if(2>(h=h||10)||36<h)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(Mc)){var i=qd(h),g=this.div(i);return i=g.mul(i).sub(this),g.toString(h)+i.toInt().toString(h)}return"-"+this.neg().toString(h)}g=qd(Hj(h,6),this.unsigned),i=this;for(var _="";;){var j=i.div(g),$=(i.sub(j.mul(g)).toInt()>>>0).toString(h);if((i=j).isZero())return $+_;for(;6>$.length;)$="0"+$;_=""+$+_}},sa.getHighBits=function(){return this.high},sa.getHighBitsUnsigned=function(){return this.high>>>0},sa.getLowBits=function(){return this.low},sa.getLowBitsUnsigned=function(){return this.low>>>0},sa.getNumBitsAbs=function(){if(this.isNegative())return this.eq(Mc)?64:this.neg().getNumBitsAbs();for(var h=this.high!=0?this.high:this.low,i=31;0<i&&!(h&1<<i);i--);return this.high!=0?i+33:i+1},sa.isZero=function(){return this.high===0&&this.low===0},sa.eqz=sa.isZero,sa.isNegative=function(){return!this.unsigned&&0>this.high},sa.isPositive=function(){return this.unsigned||0<=this.high},sa.isOdd=function(){return(1&this.low)==1},sa.isEven=function(){return(1&this.low)==0},sa.equals=function(h){return Lc(h)||(h=Nd(h)),(this.unsigned===h.unsigned||this.high>>>31!=1||h.high>>>31!=1)&&this.high===h.high&&this.low===h.low},sa.eq=sa.equals,sa.notEquals=function(h){return!this.eq(h)},sa.neq=sa.notEquals,sa.ne=sa.notEquals,sa.lessThan=function(h){return 0>this.comp(h)},sa.lt=sa.lessThan,sa.lessThanOrEqual=function(h){return 0>=this.comp(h)},sa.lte=sa.lessThanOrEqual,sa.le=sa.lessThanOrEqual,sa.greaterThan=function(h){return 0<this.comp(h)},sa.gt=sa.greaterThan,sa.greaterThanOrEqual=function(h){return 0<=this.comp(h)},sa.gte=sa.greaterThanOrEqual,sa.ge=sa.greaterThanOrEqual,sa.compare=function(h){if(Lc(h)||(h=Nd(h)),this.eq(h))return 0;var i=this.isNegative(),g=h.isNegative();return i&&!g?-1:!i&&g?1:this.unsigned?h.high>>>0>this.high>>>0||h.high===this.high&&h.low>>>0>this.low>>>0?-1:1:this.sub(h).isNegative()?-1:1},sa.comp=sa.compare,sa.negate=function(){return!this.unsigned&&this.eq(Mc)?Mc:this.not().add(Dh)},sa.neg=sa.negate,sa.add=function(h){Lc(h)||(h=Nd(h));var i=this.high>>>16,g=65535&this.high,_=this.low>>>16,j=h.high>>>16,$=65535&h.high,_n=h.low>>>16;return _=(_n=((h=(65535&this.low)+(65535&h.low))>>>16)+(_+_n))>>>16,Bb((65535&_n)<<16|65535&h,(i=((_+=g+$)>>>16)+(i+j)&65535)<<16|65535&_,this.unsigned)},sa.subtract=function(h){return Lc(h)||(h=Nd(h)),this.add(h.neg())},sa.sub=sa.subtract,sa.multiply=function(h){if(this.isZero())return rd;if(Lc(h)||(h=Nd(h)),yd){var i=yd.mul(this.low,this.high,h.low,h.high);return Bb(i,yd.get_high(),this.unsigned)}if(h.isZero())return rd;if(this.eq(Mc))return h.isOdd()?Mc:rd;if(h.eq(Mc))return this.isOdd()?Mc:rd;if(this.isNegative())return h.isNegative()?this.neg().mul(h.neg()):this.neg().mul(h).neg();if(h.isNegative())return this.mul(h.neg()).neg();if(this.lt(bw)&&h.lt(bw))return qd(this.toNumber()*h.toNumber(),this.unsigned);i=this.high>>>16;var g=65535&this.high,_=this.low>>>16,j=65535&this.low,$=h.high>>>16,_n=65535&h.high,_i=h.low>>>16,_s=j*(h=65535&h.low),ga=(_s>>>16)+_*h,ba=ga>>>16;ba+=(ga=(65535&ga)+j*_i)>>>16;var xa=(ba+=g*h)>>>16;return Bb((65535&ga)<<16|65535&_s,(xa=(xa+=(ba=(65535&ba)+_*_i)>>>16)+((ba=(65535&ba)+j*_n)>>>16)+(i*h+g*_i+_*_n+j*$)&65535)<<16|65535&ba,this.unsigned)},sa.mul=sa.multiply,sa.divide=function(h){if(Lc(h)||(h=Nd(h)),h.isZero())throw Error("division by zero");if(yd)return this.unsigned||this.high!==-2147483648||h.low!==-1||h.high!==-1?Bb(h=(this.unsigned?yd.div_u:yd.div_s)(this.low,this.high,h.low,h.high),yd.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?Yf:rd;if(this.unsigned){if(h.unsigned||(h=h.toUnsigned()),h.gt(this))return Yf;if(h.gt(this.shru(1)))return cw;var i=Yf}else{if(this.eq(Mc)){if(h.eq(Dh)||h.eq(So))return Mc;if(h.eq(Mc))return Dh;var g=this.shr(1).div(h).shl(1);if(g.eq(rd))return h.isNegative()?Dh:So;var _=this.sub(h.mul(g));return g.add(_.div(h))}if(h.eq(Mc))return this.unsigned?Yf:rd;if(this.isNegative())return h.isNegative()?this.neg().div(h.neg()):this.neg().div(h).neg();if(h.isNegative())return this.div(h.neg()).neg();i=rd}for(_=this;_.gte(h);){g=Math.max(1,Math.floor(_.toNumber()/h.toNumber()));var j=Math.ceil(Math.log(g)/Math.LN2);j=48>=j?1:Hj(2,j-48);for(var $=qd(g),_n=$.mul(h);_n.isNegative()||_n.gt(_);)_n=($=qd(g-=j,this.unsigned)).mul(h);$.isZero()&&($=Dh),i=i.add($),_=_.sub(_n)}return i},sa.div=sa.divide,sa.modulo=function(h){return Lc(h)||(h=Nd(h)),yd?Bb(h=(this.unsigned?yd.rem_u:yd.rem_s)(this.low,this.high,h.low,h.high),yd.get_high(),this.unsigned):this.sub(this.div(h).mul(h))},sa.mod=sa.modulo,sa.rem=sa.modulo,sa.not=function(){return Bb(~this.low,~this.high,this.unsigned)},sa.and=function(h){return Lc(h)||(h=Nd(h)),Bb(this.low&h.low,this.high&h.high,this.unsigned)},sa.or=function(h){return Lc(h)||(h=Nd(h)),Bb(this.low|h.low,this.high|h.high,this.unsigned)},sa.xor=function(h){return Lc(h)||(h=Nd(h)),Bb(this.low^h.low,this.high^h.high,this.unsigned)},sa.shiftLeft=function(h){return Lc(h)&&(h=h.toInt()),(h&=63)==0?this:32>h?Bb(this.low<<h,this.high<<h|this.low>>>32-h,this.unsigned):Bb(0,this.low<<h-32,this.unsigned)},sa.shl=sa.shiftLeft,sa.shiftRight=function(h){return Lc(h)&&(h=h.toInt()),(h&=63)==0?this:32>h?Bb(this.low>>>h|this.high<<32-h,this.high>>h,this.unsigned):Bb(this.high>>h-32,0<=this.high?0:-1,this.unsigned)},sa.shr=sa.shiftRight,sa.shiftRightUnsigned=function(h){if(Lc(h)&&(h=h.toInt()),(h&=63)===0)return this;var i=this.high;return 32>h?Bb(this.low>>>h|i<<32-h,i>>>h,this.unsigned):Bb(h===32?i:i>>>h-32,0,this.unsigned)},sa.shru=sa.shiftRightUnsigned,sa.shr_u=sa.shiftRightUnsigned,sa.toSigned=function(){return this.unsigned?Bb(this.low,this.high,!1):this},sa.toUnsigned=function(){return this.unsigned?this:Bb(this.low,this.high,!0)},sa.toBytes=function(h){return h?this.toBytesLE():this.toBytesBE()},sa.toBytesLE=function(){var h=this.high,i=this.low;return[255&i,i>>>8&255,i>>>16&255,i>>>24,255&h,h>>>8&255,h>>>16&255,h>>>24]},sa.toBytesBE=function(){var h=this.high,i=this.low;return[h>>>24,h>>>16&255,h>>>8&255,255&h,i>>>24,i>>>16&255,i>>>8&255,255&i]},Ab.fromBytes=function(h,i,g){return g?Ab.fromBytesLE(h,i):Ab.fromBytesBE(h,i)},Ab.fromBytesLE=function(h,i){return new Ab(h[0]|h[1]<<8|h[2]<<16|h[3]<<24,h[4]|h[5]<<8|h[6]<<16|h[7]<<24,i)},Ab.fromBytesBE=function(h,i){return new Ab(h[4]<<24|h[5]<<16|h[6]<<8|h[7],h[0]<<24|h[1]<<16|h[2]<<8|h[3],i)};var qm=function(h,i){return(qm=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(g,_){g.__proto__=_}||function(g,_){for(var j in _)_.hasOwnProperty(j)&&(g[j]=_[j])})(h,i)},To=!1,sd={Promise:void 0,set useDeprecatedSynchronousErrorHandling(h){h?console.warn(`DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: 
`+Error().stack):To&&console.log("RxJS: Back to a better error behavior. Thank you. <3"),To=h},get useDeprecatedSynchronousErrorHandling(){return To}},Wk={closed:!0,next:function(h){},error:function(h){if(sd.useDeprecatedSynchronousErrorHandling)throw h;Wg(h)},complete:function(){}},td=Array.isArray||function(h){return h&&typeof h.length=="number"},ii=function(){function h(i){return Error.call(this),this.message=i?i.length+` errors occurred during unsubscription:
`+i.map(function(g,_){return _+1+") "+g.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=i,this}return h.prototype=Object.create(Error.prototype),h}(),dc=function(){function h(i){this.closed=!1,this._subscriptions=this._parentOrParents=null,i&&(this._ctorUnsubscribe=!0,this._unsubscribe=i)}return h.prototype.unsubscribe=function(){if(!this.closed){var i=this._parentOrParents,g=this._ctorUnsubscribe,_=this._unsubscribe,j=this._subscriptions;if(this.closed=!0,this._subscriptions=this._parentOrParents=null,i instanceof h)i.remove(this);else if(i!==null)for(var $=0;$<i.length;++$)i[$].remove(this);if(Vg(_)){g&&(this._unsubscribe=void 0);try{_.call(this)}catch(_i){var _n=_i instanceof ii?Dr(_i.errors):[_i]}}if(td(j)){for($=-1,i=j.length;++$<i;)if(rm(g=j[$]))try{g.unsubscribe()}catch(_i){_n=_n||[],_i instanceof ii?_n=_n.concat(Dr(_i.errors)):_n.push(_i)}}if(_n)throw new ii(_n)}},h.prototype.add=function(i){var g=i;if(!i)return h.EMPTY;switch(Ia(i)){case"function":g=new h(i);case"object":if(g===this||g.closed||typeof g.unsubscribe!="function")return g;if(this.closed)return g.unsubscribe(),g;g instanceof h||(i=g,(g=new h)._subscriptions=[i]);break;default:throw Error("unrecognized teardown "+i+" added to Subscription.")}if((i=g._parentOrParents)===null)g._parentOrParents=this;else if(i instanceof h){if(i===this)return g;g._parentOrParents=[i,this]}else{if(i.indexOf(this)!==-1)return g;i.push(this)}return(i=this._subscriptions)===null?this._subscriptions=[g]:i.push(g),g},h.prototype.remove=function(i){var g=this._subscriptions;g&&(i=g.indexOf(i))!==-1&&g.splice(i,1)},h.EMPTY=function(i){return i.closed=!0,i}(new h),h}(),Xk=typeof Symbol=="function"?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random(),hb=function(h){function i(g,_,j){var $=h.call(this)||this;switch($.syncErrorValue=null,$.syncErrorThrown=!1,$.syncErrorThrowable=!1,$.isStopped=!1,arguments.length){case 0:$.destination=Wk;break;case 1:if(!g){$.destination=Wk;break}if(Ia(g)==="object"){g instanceof i?($.syncErrorThrowable=g.syncErrorThrowable,$.destination=g,g.add($)):($.syncErrorThrowable=!0,$.destination=new dw($,g));break}default:$.syncErrorThrowable=!0,$.destination=new dw($,g,_,j)}return $}return Ca(i,h),i.prototype[Xk]=function(){return this},i.create=function(g,_,j){return(g=new i(g,_,j)).syncErrorThrowable=!1,g},i.prototype.next=function(g){this.isStopped||this._next(g)},i.prototype.error=function(g){this.isStopped||(this.isStopped=!0,this._error(g))},i.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},i.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,h.prototype.unsubscribe.call(this))},i.prototype._next=function(g){this.destination.next(g)},i.prototype._error=function(g){this.destination.error(g),this.unsubscribe()},i.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},i.prototype._unsubscribeAndRecycle=function(){var g=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.isStopped=this.closed=!1,this._parentOrParents=g,this},i}(dc),dw=function(h){function i(g,_,j,$){var _n=h.call(this)||this;if(_n._parentSubscriber=g,g=_n,Vg(_))var _i=_;else _&&(_i=_.next,j=_.error,$=_.complete,_!==Wk&&(Vg((g=Object.create(_)).unsubscribe)&&_n.add(g.unsubscribe.bind(g)),g.unsubscribe=_n.unsubscribe.bind(_n)));return _n._context=g,_n._next=_i,_n._error=j,_n._complete=$,_n}return Ca(i,h),i.prototype.next=function(g){if(!this.isStopped&&this._next){var _=this._parentSubscriber;sd.useDeprecatedSynchronousErrorHandling&&_.syncErrorThrowable?this.__tryOrSetError(_,this._next,g)&&this.unsubscribe():this.__tryOrUnsub(this._next,g)}},i.prototype.error=function(g){if(!this.isStopped){var _=this._parentSubscriber,j=sd.useDeprecatedSynchronousErrorHandling;if(this._error)j&&_.syncErrorThrowable?this.__tryOrSetError(_,this._error,g):this.__tryOrUnsub(this._error,g),this.unsubscribe();else if(_.syncErrorThrowable)j?(_.syncErrorValue=g,_.syncErrorThrown=!0):Wg(g),this.unsubscribe();else{if(this.unsubscribe(),j)throw g;Wg(g)}}},i.prototype.complete=function(){var g=this;if(!this.isStopped){var _=this._parentSubscriber;if(this._complete){var j=function(){return g._complete.call(g._context)};sd.useDeprecatedSynchronousErrorHandling&&_.syncErrorThrowable?this.__tryOrSetError(_,j):this.__tryOrUnsub(j)}this.unsubscribe()}},i.prototype.__tryOrUnsub=function(g,_){try{g.call(this._context,_)}catch(j){if(this.unsubscribe(),sd.useDeprecatedSynchronousErrorHandling)throw j;Wg(j)}},i.prototype.__tryOrSetError=function(g,_,j){if(!sd.useDeprecatedSynchronousErrorHandling)throw Error("bad call");try{_.call(this._context,j)}catch($){return sd.useDeprecatedSynchronousErrorHandling?(g.syncErrorValue=$,g.syncErrorThrown=!0):Wg($),!0}return!1},i.prototype._unsubscribe=function(){var g=this._parentSubscriber;this._parentSubscriber=this._context=null,g.unsubscribe()},i}(hb),Xg=typeof Symbol=="function"&&Symbol.observable||"@@observable",Za=function(){function h(i){this._isScalar=!1,i&&(this._subscribe=i)}return h.prototype.lift=function(i){var g=new h;return g.source=this,g.operator=i,g},h.prototype.subscribe=function(i,g,_){var j=this.operator;e:{if(i){if(i instanceof hb)break e;if(i[Xk]){i=i[Xk]();break e}}i=i||g||_?new hb(i,g,_):new hb(Wk)}if(j?i.add(j.call(i,this.source)):i.add(this.source||sd.useDeprecatedSynchronousErrorHandling&&!i.syncErrorThrowable?this._subscribe(i):this._trySubscribe(i)),sd.useDeprecatedSynchronousErrorHandling&&i.syncErrorThrowable&&(i.syncErrorThrowable=!1,i.syncErrorThrown))throw i.syncErrorValue;return i},h.prototype._trySubscribe=function(i){try{return this._subscribe(i)}catch(g){sd.useDeprecatedSynchronousErrorHandling&&(i.syncErrorThrown=!0,i.syncErrorValue=g),sm(i)?i.error(g):console.warn(g)}},h.prototype.forEach=function(i,g){var _=this;return new(g=Fr(g))(function(j,$){var _n=_.subscribe(function(_i){try{i(_i)}catch(_s){$(_s),_n&&_n.unsubscribe()}},$,j)})},h.prototype._subscribe=function(i){var g=this.source;return g&&g.subscribe(i)},h.prototype[Xg]=function(){return this},h.prototype.pipe=function(){for(var i=[],g=0;g<arguments.length;g++)i[g]=arguments[g];return i.length===0?this:Er(i)(this)},h.prototype.toPromise=function(i){var g=this;return new(i=Fr(i))(function(_,j){var $;g.subscribe(function(_n){return $=_n},function(_n){return j(_n)},function(){return _($)})})},h.create=function(i){return new h(i)},h}(),Cf=function(){function h(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return h.prototype=Object.create(Error.prototype),h}(),ew=function(h){function i(g,_){var j=h.call(this)||this;return j.subject=g,j.subscriber=_,j.closed=!1,j}return Ca(i,h),i.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var g=this.subject,_=g.observers;this.subject=null,!_||_.length===0||g.isStopped||g.closed||(g=_.indexOf(this.subscriber))!==-1&&_.splice(g,1)}},i}(dc),fw=function(h){function i(g){var _=h.call(this,g)||this;return _.destination=g,_}return Ca(i,h),i}(hb),ec=function(h){function i(){var g=h.call(this)||this;return g.observers=[],g.closed=!1,g.isStopped=!1,g.hasError=!1,g.thrownError=null,g}return Ca(i,h),i.prototype[Xk]=function(){return new fw(this)},i.prototype.lift=function(g){var _=new gw(this,this);return _.operator=g,_},i.prototype.next=function(g){if(this.closed)throw new Cf;if(!this.isStopped){var _=this.observers,j=_.length;_=_.slice();for(var $=0;$<j;$++)_[$].next(g)}},i.prototype.error=function(g){if(this.closed)throw new Cf;this.hasError=!0,this.thrownError=g,this.isStopped=!0;var _=this.observers,j=_.length;_=_.slice();for(var $=0;$<j;$++)_[$].error(g);this.observers.length=0},i.prototype.complete=function(){if(this.closed)throw new Cf;this.isStopped=!0;var g=this.observers,_=g.length;g=g.slice();for(var j=0;j<_;j++)g[j].complete();this.observers.length=0},i.prototype.unsubscribe=function(){this.closed=this.isStopped=!0,this.observers=null},i.prototype._trySubscribe=function(g){if(this.closed)throw new Cf;return h.prototype._trySubscribe.call(this,g)},i.prototype._subscribe=function(g){if(this.closed)throw new Cf;return this.hasError?(g.error(this.thrownError),dc.EMPTY):this.isStopped?(g.complete(),dc.EMPTY):(this.observers.push(g),new ew(this,g))},i.prototype.asObservable=function(){var g=new Za;return g.source=this,g},i.create=function(g,_){return new gw(g,_)},i}(Za),gw=function(h){function i(g,_){var j=h.call(this)||this;return j.destination=g,j.source=_,j}return Ca(i,h),i.prototype.next=function(g){var _=this.destination;_&&_.next&&_.next(g)},i.prototype.error=function(g){var _=this.destination;_&&_.error&&this.destination.error(g)},i.prototype.complete=function(){var g=this.destination;g&&g.complete&&this.destination.complete()},i.prototype._subscribe=function(g){return this.source?this.source.subscribe(g):dc.EMPTY},i}(ec),hB=function(){function h(i){this.connectable=i}return h.prototype.call=function(i,g){var _=this.connectable;return _._refCount++,i=new vH(i,_),g=g.subscribe(i),i.closed||(i.connection=_.connect()),g},h}(),vH=function(h){function i(g,_){return(g=h.call(this,g)||this).connectable=_,g}return Ca(i,h),i.prototype._unsubscribe=function(){var g=this.connectable;if(g){this.connectable=null;var _=g._refCount;0>=_?this.connection=null:(g._refCount=_-1,1<_?this.connection=null:(_=this.connection,g=g._connection,this.connection=null,!g||_&&g!==_||g.unsubscribe()))}else this.connection=null},i}(hb),hw=function(h){function i(g,_){var j=h.call(this)||this;return j.source=g,j.subjectFactory=_,j._refCount=0,j._isComplete=!1,j}return Ca(i,h),i.prototype._subscribe=function(g){return this.getSubject().subscribe(g)},i.prototype.getSubject=function(){var g=this._subject;return g&&!g.isStopped||(this._subject=this.subjectFactory()),this._subject},i.prototype.connect=function(){var g=this._connection;return g||(this._isComplete=!1,(g=this._connection=new dc).add(this.source.subscribe(new wH(this.getSubject(),this))),g.closed&&(this._connection=null,g=dc.EMPTY)),g},i.prototype.refCount=function(){return Gr()(this)},i}(Za),WB=function(){var h=hw.prototype;return{operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:h._subscribe},_isComplete:{value:h._isComplete,writable:!0},getSubject:{value:h.getSubject},connect:{value:h.connect},refCount:{value:h.refCount}}}(),wH=function(h){function i(g,_){return(g=h.call(this,g)||this).connectable=_,g}return Ca(i,h),i.prototype._error=function(g){this._unsubscribe(),h.prototype._error.call(this,g)},i.prototype._complete=function(){this.connectable._isComplete=!0,this._unsubscribe(),h.prototype._complete.call(this)},i.prototype._unsubscribe=function(){var g=this.connectable;if(g){this.connectable=null;var _=g._connection;g._refCount=0,g._subject=null,g._connection=null,_&&_.unsubscribe()}},i}(fw);(function(h){function i(g,_){return(g=h.call(this,g)||this).connectable=_,g}Ca(i,h),i.prototype._unsubscribe=function(){var g=this.connectable;if(g){this.connectable=null;var _=g._refCount;0>=_?this.connection=null:(g._refCount=_-1,1<_?this.connection=null:(_=this.connection,g=g._connection,this.connection=null,!g||_&&g!==_||g.unsubscribe()))}else this.connection=null}})(hb),function(h){function i(g,_,j,$,_n){return(g=h.call(this,g)||this).keySelector=_,g.elementSelector=j,g.durationSelector=$,g.subjectSelector=_n,g.groups=null,g.attemptedToUnsubscribe=!1,g.count=0,g}Ca(i,h),i.prototype._next=function(g){try{var _=this.keySelector(g)}catch(j){return void this.error(j)}this._group(g,_)},i.prototype._group=function(g,_){var j=this.groups;j||(j=this.groups=new Map);var $=j.get(_);if(this.elementSelector)try{var _n=this.elementSelector(g)}catch(_i){this.error(_i)}else _n=g;if(!$&&($=this.subjectSelector?this.subjectSelector():new ec,j.set(_,$),g=new Uo(_,$,this),this.destination.next(g),this.durationSelector)){g=void 0;try{g=this.durationSelector(new Uo(_,$))}catch(_i){return void this.error(_i)}this.add(g.subscribe(new xH(_,$,this)))}$.closed||$.next(_n)},i.prototype._error=function(g){var _=this.groups;_&&(_.forEach(function(j,$){j.error(g)}),_.clear()),this.destination.error(g)},i.prototype._complete=function(){var g=this.groups;g&&(g.forEach(function(_,j){_.complete()}),g.clear()),this.destination.complete()},i.prototype.removeGroup=function(g){this.groups.delete(g)},i.prototype.unsubscribe=function(){this.closed||(this.attemptedToUnsubscribe=!0,this.count===0&&h.prototype.unsubscribe.call(this))}}(hb);var xH=function(h){function i(g,_,j){var $=h.call(this,_)||this;return $.key=g,$.group=_,$.parent=j,$}return Ca(i,h),i.prototype._next=function(g){this.complete()},i.prototype._unsubscribe=function(){var g=this.parent,_=this.key;this.key=this.parent=null,g&&g.removeGroup(_)},i}(hb),Uo=function(h){function i(g,_,j){var $=h.call(this)||this;return $.key=g,$.groupSubject=_,$.refCountSubscription=j,$}return Ca(i,h),i.prototype._subscribe=function(g){var _=new dc,j=this.refCountSubscription,$=this.groupSubject;return j&&!j.closed&&_.add(new yH(j)),_.add($.subscribe(g)),_},i}(Za),yH=function(h){function i(g){var _=h.call(this)||this;return _.parent=g,g.count++,_}return Ca(i,h),i.prototype.unsubscribe=function(){var g=this.parent;g.closed||this.closed||(h.prototype.unsubscribe.call(this),--g.count,g.count===0&&g.attemptedToUnsubscribe&&g.unsubscribe())},i}(dc),zH=function(h){function i(g){var _=h.call(this)||this;return _._value=g,_}return Ca(i,h),Object.defineProperty(i.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),i.prototype._subscribe=function(g){var _=h.prototype._subscribe.call(this,g);return _&&!_.closed&&g.next(this._value),_},i.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new Cf;return this._value},i.prototype.next=function(g){h.prototype.next.call(this,this._value=g)},i}(ec),dj=function(h){function i(g,_){var j=h.call(this,g,_)||this;return j.scheduler=g,j.work=_,j.pending=!1,j}return Ca(i,h),i.prototype.schedule=function(g,_){if(_===void 0&&(_=0),this.closed)return this;this.state=g,g=this.id;var j=this.scheduler;return g!=null&&(this.id=this.recycleAsyncId(j,g,_)),this.pending=!0,this.delay=_,this.id=this.id||this.requestAsyncId(j,this.id,_),this},i.prototype.requestAsyncId=function(g,_,j){return j===void 0&&(j=0),setInterval(g.flush.bind(g,this),j)},i.prototype.recycleAsyncId=function(g,_,j){if(j===void 0&&(j=0),j!==null&&this.delay===j&&this.pending===!1)return _;clearInterval(_)},i.prototype.execute=function(g,_){return this.closed?Error("executing a cancelled action"):(this.pending=!1,(g=this._execute(g,_))?g:void(this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))))},i.prototype._execute=function(g,_){_=!1;var j=void 0;try{this.work(g)}catch($){_=!0,j=!!$&&$||Error($)}if(_)return this.unsubscribe(),j},i.prototype._unsubscribe=function(){var g=this.id,_=this.scheduler,j=_.actions,$=j.indexOf(this);this.state=this.work=null,this.pending=!1,this.scheduler=null,$!==-1&&j.splice($,1),g!=null&&(this.id=this.recycleAsyncId(_,g,null)),this.delay=null},i}(function(h){function i(g,_){return h.call(this)||this}return Ca(i,h),i.prototype.schedule=function(g,_){return this},i}(dc)),AH=function(h){function i(g,_){var j=h.call(this,g,_)||this;return j.scheduler=g,j.work=_,j}return Ca(i,h),i.prototype.schedule=function(g,_){return _===void 0&&(_=0),0<_?h.prototype.schedule.call(this,g,_):(this.delay=_,this.state=g,this.scheduler.flush(this),this)},i.prototype.execute=function(g,_){return 0<_||this.closed?h.prototype.execute.call(this,g,_):this._execute(g,_)},i.prototype.requestAsyncId=function(g,_,j){return j===void 0&&(j=0),j!==null&&0<j||j===null&&0<this.delay?h.prototype.requestAsyncId.call(this,g,_,j):g.flush(this)},i}(dj),Vo=function(){function h(i,g){g===void 0&&(g=h.now),this.SchedulerAction=i,this.now=g}return h.prototype.schedule=function(i,g,_){return g===void 0&&(g=0),new this.SchedulerAction(this,i).schedule(_,g)},h.now=function(){return Date.now()},h}(),ej=function(h){function i(g,_){_===void 0&&(_=Vo.now);var j=h.call(this,g,function(){return i.delegate&&i.delegate!==j?i.delegate.now():_()})||this;return j.actions=[],j.active=!1,j.scheduled=void 0,j}return Ca(i,h),i.prototype.schedule=function(g,_,j){return _===void 0&&(_=0),i.delegate&&i.delegate!==this?i.delegate.schedule(g,_,j):h.prototype.schedule.call(this,g,_,j)},i.prototype.flush=function(g){var _=this.actions;if(this.active)_.push(g);else{var j;this.active=!0;do if(j=g.execute(g.state,g.delay))break;while(g=_.shift());if(this.active=!1,j){for(;g=_.shift();)g.unsubscribe();throw j}}},i}(Vo),fj=new(function(h){function i(){return h!==null&&h.apply(this,arguments)||this}return Ca(i,h),i}(ej))(AH),$c=new Za(function(h){return h.complete()}),Hr=function(h){return function(i){for(var g=0,_=h.length;g<_&&!i.closed;g++)i.next(h[g]);i.complete()}},Wo;(function(h){h.NEXT="N",h.ERROR="E",h.COMPLETE="C"})(Wo||(Wo={}));var Eh=function(){function h(i,g,_){this.kind=i,this.value=g,this.error=_,this.hasValue=i==="N"}return h.prototype.observe=function(i){switch(this.kind){case"N":return i.next&&i.next(this.value);case"E":return i.error&&i.error(this.error);case"C":return i.complete&&i.complete()}},h.prototype.do=function(i,g,_){switch(this.kind){case"N":return i&&i(this.value);case"E":return g&&g(this.error);case"C":return _&&_()}},h.prototype.accept=function(i,g,_){return i&&typeof i.next=="function"?this.observe(i):this.do(i,g,_)},h.prototype.toObservable=function(){switch(this.kind){case"N":return Wb(this.value);case"E":return Va(this.error);case"C":return ji()}throw Error("unexpected notification kind value")},h.createNext=function(i){return i!==void 0?new h("N",i):h.undefinedValueNotification},h.createError=function(i){return new h("E",void 0,i)},h.createComplete=function(){return h.completeNotification},h.completeNotification=new h("C"),h.undefinedValueNotification=new h("N",void 0),h}(),lB=function(){function h(i,g){g===void 0&&(g=0),this.scheduler=i,this.delay=g}return h.prototype.call=function(i,g){return g.subscribe(new iw(i,this.scheduler,this.delay))},h}(),iw=function(h){function i(g,_,j){return j===void 0&&(j=0),(g=h.call(this,g)||this).scheduler=_,g.delay=j,g}return Ca(i,h),i.dispatch=function(g){g.notification.observe(g.destination),this.unsubscribe()},i.prototype.scheduleMessage=function(g){this.destination.add(this.scheduler.schedule(i.dispatch,this.delay,new BH(g,this.destination)))},i.prototype._next=function(g){this.scheduleMessage(Eh.createNext(g))},i.prototype._error=function(g){this.scheduleMessage(Eh.createError(g)),this.unsubscribe()},i.prototype._complete=function(){this.scheduleMessage(Eh.createComplete()),this.unsubscribe()},i}(hb),BH=function(h,i){this.notification=h,this.destination=i},ah=function(h){function i(g,_,j){g===void 0&&(g=Number.POSITIVE_INFINITY),_===void 0&&(_=Number.POSITIVE_INFINITY);var $=h.call(this)||this;return $.scheduler=j,$._events=[],$._infiniteTimeWindow=!1,$._bufferSize=1>g?1:g,$._windowTime=1>_?1:_,_===Number.POSITIVE_INFINITY?($._infiniteTimeWindow=!0,$.next=$.nextInfiniteTimeWindow):$.next=$.nextTimeWindow,$}return Ca(i,h),i.prototype.nextInfiniteTimeWindow=function(g){if(!this.isStopped){var _=this._events;_.push(g),_.length>this._bufferSize&&_.shift()}h.prototype.next.call(this,g)},i.prototype.nextTimeWindow=function(g){this.isStopped||(this._events.push(new CH(this._getNow(),g)),this._trimBufferThenGetEvents()),h.prototype.next.call(this,g)},i.prototype._subscribe=function(g){var _=this._infiniteTimeWindow,j=_?this._events:this._trimBufferThenGetEvents(),$=this.scheduler,_n=j.length;if(this.closed)throw new Cf;if(this.isStopped||this.hasError)var _i=dc.EMPTY;else this.observers.push(g),_i=new ew(this,g);if($&&g.add(g=new iw(g,$)),_)for(_=0;_<_n&&!g.closed;_++)g.next(j[_]);else for(_=0;_<_n&&!g.closed;_++)g.next(j[_].value);return this.hasError?g.error(this.thrownError):this.isStopped&&g.complete(),_i},i.prototype._getNow=function(){return(this.scheduler||fj).now()},i.prototype._trimBufferThenGetEvents=function(){for(var g=this._getNow(),_=this._bufferSize,j=this._windowTime,$=this._events,_n=$.length,_i=0;_i<_n&&!(g-$[_i].time<j);)_i++;return _n>_&&(_i=Math.max(_i,_n-_)),0<_i&&$.splice(0,_i),$},i}(ec),CH=function(h,i){this.time=h,this.value=i},li=function(h){function i(){var g=h!==null&&h.apply(this,arguments)||this;return g.value=null,g.hasNext=!1,g.hasCompleted=!1,g}return Ca(i,h),i.prototype._subscribe=function(g){return this.hasError?(g.error(this.thrownError),dc.EMPTY):this.hasCompleted&&this.hasNext?(g.next(this.value),g.complete(),dc.EMPTY):h.prototype._subscribe.call(this,g)},i.prototype.next=function(g){this.hasCompleted||(this.value=g,this.hasNext=!0)},i.prototype.error=function(g){this.hasCompleted||h.prototype.error.call(this,g)},i.prototype.complete=function(){this.hasCompleted=!0,this.hasNext&&h.prototype.next.call(this,this.value),h.prototype.complete.call(this)},i}(ec),DH=1,EH=Promise.resolve(),vm={},jw={setImmediate:function(h){var i=DH++;return vm[i]=!0,EH.then(function(){return Ir(i)&&h()}),i},clearImmediate:function(h){Ir(h)}},FH=function(h){function i(g,_){var j=h.call(this,g,_)||this;return j.scheduler=g,j.work=_,j}return Ca(i,h),i.prototype.requestAsyncId=function(g,_,j){return j===void 0&&(j=0),j!==null&&0<j?h.prototype.requestAsyncId.call(this,g,_,j):(g.actions.push(this),g.scheduled||(g.scheduled=jw.setImmediate(g.flush.bind(g,null))))},i.prototype.recycleAsyncId=function(g,_,j){if(j===void 0&&(j=0),j!==null&&0<j||j===null&&0<this.delay)return h.prototype.recycleAsyncId.call(this,g,_,j);g.actions.length===0&&(jw.clearImmediate(_),g.scheduled=void 0)},i}(dj),Fm=new(function(h){function i(){return h!==null&&h.apply(this,arguments)||this}return Ca(i,h),i.prototype.flush=function(g){this.active=!0,this.scheduled=void 0;var _,j=this.actions,$=-1,_n=j.length;g=g||j.shift();do if(_=g.execute(g.state,g.delay))break;while(++$<_n&&(g=j.shift()));if(this.active=!1,_){for(;++$<_n&&(g=j.shift());)g.unsubscribe();throw _}},i}(ej))(FH),GH=Fm,Xo=new ej(dj),Ee=Xo,HH=function(h){function i(g,_){var j=h.call(this,g,_)||this;return j.scheduler=g,j.work=_,j}return Ca(i,h),i.prototype.requestAsyncId=function(g,_,j){return j===void 0&&(j=0),j!==null&&0<j?h.prototype.requestAsyncId.call(this,g,_,j):(g.actions.push(this),g.scheduled||(g.scheduled=requestAnimationFrame(function(){return g.flush(null)})))},i.prototype.recycleAsyncId=function(g,_,j){if(j===void 0&&(j=0),j!==null&&0<j||j===null&&0<this.delay)return h.prototype.recycleAsyncId.call(this,g,_,j);g.actions.length===0&&(cancelAnimationFrame(_),g.scheduled=void 0)},i}(dj),kw=new(function(h){function i(){return h!==null&&h.apply(this,arguments)||this}return Ca(i,h),i.prototype.flush=function(g){this.active=!0,this.scheduled=void 0;var _,j=this.actions,$=-1,_n=j.length;g=g||j.shift();do if(_=g.execute(g.state,g.delay))break;while(++$<_n&&(g=j.shift()));if(this.active=!1,_){for(;++$<_n&&(g=j.shift());)g.unsubscribe();throw _}},i}(ej))(HH),IH=function(h){function i(g,_){g===void 0&&(g=lw),_===void 0&&(_=Number.POSITIVE_INFINITY);var j=h.call(this,g,function(){return j.frame})||this;return j.maxFrames=_,j.frame=0,j.index=-1,j}return Ca(i,h),i.prototype.flush=function(){for(var g,_,j=this.actions,$=this.maxFrames;(_=j[0])&&_.delay<=$&&(j.shift(),this.frame=_.delay,!(g=_.execute(_.state,_.delay))););if(g){for(;_=j.shift();)_.unsubscribe();throw g}},i.frameTimeFactor=10,i}(ej),lw=function(h){function i(g,_,j){j===void 0&&(j=g.index+=1);var $=h.call(this,g,_)||this;return $.scheduler=g,$.work=_,$.index=j,$.active=!0,$.index=g.index=j,$}return Ca(i,h),i.prototype.schedule=function(g,_){if(_===void 0&&(_=0),!this.id)return h.prototype.schedule.call(this,g,_);this.active=!1;var j=new i(this.scheduler,this.work);return this.add(j),j.schedule(g,_)},i.prototype.requestAsyncId=function(g,_,j){return j===void 0&&(j=0),this.delay=g.frame+j,(g=g.actions).push(this),g.sort(i.sortActions),!0},i.prototype.recycleAsyncId=function(g,_,j){},i.prototype._execute=function(g,_){if(this.active===!0)return h.prototype._execute.call(this,g,_)},i.sortActions=function(g,_){return g.delay===_.delay?g.index===_.index?0:g.index>_.index?1:-1:g.delay>_.delay?1:-1},i}(dj),Yo=function(){function h(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return h.prototype=Object.create(Error.prototype),h}(),Lj=function(){function h(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}return h.prototype=Object.create(Error.prototype),h}(),ad=function(){function h(){return Error.call(this),this.message="Timeout has occurred",this.name="TimeoutError",this}return h.prototype=Object.create(Error.prototype),h}(),mB=function(){function h(i,g){this.project=i,this.thisArg=g}return h.prototype.call=function(i,g){return g.subscribe(new JH(i,this.project,this.thisArg))},h}(),JH=function(h){function i(g,_,j){return(g=h.call(this,g)||this).project=_,g.count=0,g.thisArg=j||g,g}return Ca(i,h),i.prototype._next=function(g){try{var _=this.project.call(this.thisArg,g,this.count++)}catch(j){return void this.destination.error(j)}this.destination.next(_)},i}(hb),Zo=function(h){function i(){return h!==null&&h.apply(this,arguments)||this}return Ca(i,h),i.prototype.notifyNext=function(g,_,j,$,_n){this.destination.next(_)},i.prototype.notifyError=function(g,_){this.destination.error(g)},i.prototype.notifyComplete=function(g){this.destination.complete()},i}(hb),rB=function(h){function i(g,_,j){var $=h.call(this)||this;return $.parent=g,$.outerValue=_,$.outerIndex=j,$.index=0,$}return Ca(i,h),i.prototype._next=function(g){this.parent.notifyNext(this.outerValue,g,this.outerIndex,this.index++,this)},i.prototype._error=function(g){this.parent.notifyError(g,this),this.unsubscribe()},i.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},i}(hb),KH=function(h){return function(i){return h.then(function(g){i.closed||(i.next(g),i.complete())},function(g){return i.error(g)}).then(null,Wg),i}},kf=typeof Symbol=="function"&&Symbol.iterator?Symbol.iterator:"@@iterator",LH=function(h){return function(i){for(var g=h[kf]();;){var _=void 0;try{_=g.next()}catch(j){return i.error(j),i}if(_.done){i.complete();break}if(i.next(_.value),i.closed)break}return typeof g.return=="function"&&i.add(function(){g.return&&g.return()}),i}},MH=function(h){return function(i){var g=h[Xg]();if(typeof g.subscribe!="function")throw new TypeError("Provided object does not correctly implement Symbol.observable");return g.subscribe(i)}},Or=function(h){return h&&typeof h.length=="number"&&typeof h!="function"},mi=function(h){if(h&&typeof h[Xg]=="function")return MH(h);if(Or(h))return Hr(h);if(Mr(h))return KH(h);if(h&&typeof h[kf]=="function")return LH(h);throw h=rm(h)?"an invalid object":"'"+h+"'",new TypeError("You provided "+h+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.")},mw={},OH=function(){function h(i){this.resultSelector=i}return h.prototype.call=function(i,g){return g.subscribe(new NH(i,this.resultSelector))},h}(),NH=function(h){function i(g,_){return(g=h.call(this,g)||this).resultSelector=_,g.active=0,g.values=[],g.observables=[],g}return Ca(i,h),i.prototype._next=function(g){this.values.push(mw),this.observables.push(g)},i.prototype._complete=function(){var g=this.observables,_=g.length;if(_===0)this.destination.complete();else{this.toRespond=this.active=_;for(var j=0;j<_;j++)this.add(wm(this,g[j],void 0,j))}},i.prototype.notifyComplete=function(g){--this.active==0&&this.destination.complete()},i.prototype.notifyNext=function(g,_,j){var $=(g=this.values)[j];$=this.toRespond?$===mw?--this.toRespond:this.toRespond:0,g[j]=_,$===0&&(this.resultSelector?this._tryResultSelector(g):this.destination.next(g.slice()))},i.prototype._tryResultSelector=function(g){try{var _=this.resultSelector.apply(this,g)}catch(j){return void this.destination.error(j)}this.destination.next(_)},i}(Zo),Qe=function(h){function i(g){var _=h.call(this)||this;return _.parent=g,_}return Ca(i,h),i.prototype._next=function(g){this.parent.notifyNext(g)},i.prototype._error=function(g){this.parent.notifyError(g),this.unsubscribe()},i.prototype._complete=function(){this.parent.notifyComplete(),this.unsubscribe()},i}(hb);(function(h){function i(g,_,j){var $=h.call(this)||this;return $.parent=g,$.outerValue=_,$.outerIndex=j,$}Ca(i,h),i.prototype._next=function(g){this.parent.notifyNext(this.outerValue,g,this.outerIndex,this)},i.prototype._error=function(g){this.parent.notifyError(g),this.unsubscribe()},i.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()}})(hb);var Re=function(h){function i(){return h!==null&&h.apply(this,arguments)||this}return Ca(i,h),i.prototype.notifyNext=function(g){this.destination.next(g)},i.prototype.notifyError=function(g){this.destination.error(g)},i.prototype.notifyComplete=function(){this.destination.complete()},i}(hb);(function(h){function i(){return h!==null&&h.apply(this,arguments)||this}Ca(i,h),i.prototype.notifyNext=function(g,_,j,$){this.destination.next(_)},i.prototype.notifyError=function(g){this.destination.error(g)},i.prototype.notifyComplete=function(g){this.destination.complete()}})(hb);var vB=function(){function h(i,g){g===void 0&&(g=Number.POSITIVE_INFINITY),this.project=i,this.concurrent=g}return h.prototype.call=function(i,g){return g.subscribe(new PH(i,this.project,this.concurrent))},h}(),PH=function(h){function i(g,_,j){return j===void 0&&(j=Number.POSITIVE_INFINITY),(g=h.call(this,g)||this).project=_,g.concurrent=j,g.hasCompleted=!1,g.buffer=[],g.active=0,g.index=0,g}return Ca(i,h),i.prototype._next=function(g){this.active<this.concurrent?this._tryNext(g):this.buffer.push(g)},i.prototype._tryNext=function(g){var _=this.index++;try{var j=this.project(g,_)}catch($){return void this.destination.error($)}this.active++,this._innerSub(j)},i.prototype._innerSub=function(g){var _=new Qe(this),j=this.destination;j.add(_),(g=De(g,_))!==_&&j.add(g)},i.prototype._complete=function(){this.hasCompleted=!0,this.active===0&&this.buffer.length===0&&this.destination.complete(),this.unsubscribe()},i.prototype.notifyNext=function(g){this.destination.next(g)},i.prototype.notifyComplete=function(){var g=this.buffer;this.active--,0<g.length?this._next(g.shift()):this.active===0&&this.hasCompleted&&this.destination.complete()},i}(Re),$o=na.parseFloat,nw=-1/0!=1/$o(`	
\v\f\r                　\u2028\u2029\uFEFF-0`)?function(h){h=kk(String(h));var i=$o(h);return i===0&&h.charAt(0)=="-"?-0:i}:$o;wa({global:!0,forced:parseFloat!=nw},{parseFloat:nw});var ap=new Za(fe),AB=function(){function h(i,g){this.predicate=i,this.thisArg=g}return h.prototype.call=function(i,g){return g.subscribe(new QH(i,this.predicate,this.thisArg))},h}(),QH=function(h){function i(g,_,j){return(g=h.call(this,g)||this).predicate=_,g.thisArg=j,g.count=0,g}return Ca(i,h),i.prototype._next=function(g){try{var _=this.predicate.call(this.thisArg,g,this.count++)}catch(j){return void this.destination.error(j)}_&&this.destination.next(g)},i}(hb),BB=function(){function h(){}return h.prototype.call=function(i,g){return g.subscribe(new RH(i))},h}(),RH=function(h){function i(g){return(g=h.call(this,g)||this).hasFirst=!1,g.observables=[],g.subscriptions=[],g}return Ca(i,h),i.prototype._next=function(g){this.observables.push(g)},i.prototype._complete=function(){var g=this.observables,_=g.length;if(_===0)this.destination.complete();else{for(var j=0;j<_&&!this.hasFirst;j++){var $=wm(this,g[j],void 0,j);this.subscriptions&&this.subscriptions.push($),this.add($)}this.observables=null}},i.prototype.notifyNext=function(g,_,j){if(!this.hasFirst){for(this.hasFirst=!0,g=0;g<this.subscriptions.length;g++)if(g!==j){var $=this.subscriptions[g];$.unsubscribe(),this.remove($)}this.subscriptions=null}this.destination.next(_)},i}(Zo),EB=function(){function h(i){this.resultSelector=i}return h.prototype.call=function(i,g){return g.subscribe(new SH(i,this.resultSelector))},h}(),SH=function(h){function i(g,_,j){return(g=h.call(this,g)||this).resultSelector=_,g.iterators=[],g.active=0,g.resultSelector=typeof _=="function"?_:void 0,g}return Ca(i,h),i.prototype._next=function(g){var _=this.iterators;td(g)?_.push(new TH(g)):typeof g[kf]=="function"?_.push(new UH(g[kf]())):_.push(new VH(this.destination,this,g))},i.prototype._complete=function(){var g=this.iterators,_=g.length;if(this.unsubscribe(),_===0)this.destination.complete();else{this.active=_;for(var j=0;j<_;j++){var $=g[j];$.stillUnsubscribed?this.destination.add($.subscribe()):this.active--}}},i.prototype.notifyInactive=function(){this.active--,this.active===0&&this.destination.complete()},i.prototype.checkIterators=function(){for(var g=this.iterators,_=g.length,j=this.destination,$=0;$<_;$++){var _n=g[$];if(typeof _n.hasValue=="function"&&!_n.hasValue())return}var _i=!1,_s=[];for($=0;$<_;$++){var ga=(_n=g[$]).next();if(_n.hasCompleted()&&(_i=!0),ga.done)return void j.complete();_s.push(ga.value)}this.resultSelector?this._tryresultSelector(_s):j.next(_s),_i&&j.complete()},i.prototype._tryresultSelector=function(g){try{var _=this.resultSelector.apply(this,g)}catch(j){return void this.destination.error(j)}this.destination.next(_)},i}(hb),UH=function(){function h(i){this.iterator=i,this.nextResult=i.next()}return h.prototype.hasValue=function(){return!0},h.prototype.next=function(){var i=this.nextResult;return this.nextResult=this.iterator.next(),i},h.prototype.hasCompleted=function(){var i=this.nextResult;return!(!i||!i.done)},h}(),TH=function(){function h(i){this.array=i,this.length=this.index=0,this.length=i.length}return h.prototype[kf]=function(){return this},h.prototype.next=function(i){i=this.index++;var g=this.array;return i<this.length?{value:g[i],done:!1}:{value:null,done:!0}},h.prototype.hasValue=function(){return this.array.length>this.index},h.prototype.hasCompleted=function(){return this.array.length===this.index},h}(),VH=function(h){function i(g,_,j){return(g=h.call(this,g)||this).parent=_,g.observable=j,g.stillUnsubscribed=!0,g.buffer=[],g.isComplete=!1,g}return Ca(i,h),i.prototype[kf]=function(){return this},i.prototype.next=function(){var g=this.buffer;return g.length===0&&this.isComplete?{value:null,done:!0}:{value:g.shift(),done:!1}},i.prototype.hasValue=function(){return 0<this.buffer.length},i.prototype.hasCompleted=function(){return this.buffer.length===0&&this.isComplete},i.prototype.notifyComplete=function(){0<this.buffer.length?(this.isComplete=!0,this.parent.notifyInactive()):this.destination.complete()},i.prototype.notifyNext=function(g){this.buffer.push(g),this.parent.checkIterators()},i.prototype.subscribe=function(){return De(this.observable,new Qe(this))},i}(Re),WH=Object.freeze({__proto__:null,Observable:Za,ConnectableObservable:hw,GroupedObservable:Uo,observable:Xg,Subject:ec,BehaviorSubject:zH,ReplaySubject:ah,AsyncSubject:li,asap:GH,asapScheduler:Fm,async:Ee,asyncScheduler:Xo,queue:fj,queueScheduler:fj,animationFrame:kw,animationFrameScheduler:kw,VirtualTimeScheduler:IH,VirtualAction:lw,Scheduler:Vo,Subscription:dc,Subscriber:hb,Notification:Eh,get NotificationKind(){return Wo},pipe:tm,noop:fe,identity:jf,isObservable:function(h){return!!h&&(h instanceof Za||typeof h.lift=="function"&&typeof h.subscribe=="function")},ArgumentOutOfRangeError:Yo,EmptyError:Lj,ObjectUnsubscribedError:Cf,UnsubscriptionError:ii,TimeoutError:ad,bindCallback:Jr,bindNodeCallback:Kr,combineLatest:function(){for(var h=[],i=0;i<arguments.length;i++)h[i]=arguments[i];var g=i=void 0;return Ce(h[h.length-1])&&(g=h.pop()),typeof h[h.length-1]=="function"&&(i=h.pop()),h.length===1&&td(h[0])&&(h=h[0]),ki(h,g).lift(new OH(i))},concat:Pr,defer:lf,empty:ji,forkJoin:function(){for(var h=[],i=0;i<arguments.length;i++)h[i]=arguments[i];if(h.length===1){var g=h[0];if(td(g))return Jj(g,null);if(rm(g)&&Object.getPrototypeOf(g)===Object.prototype)return Jj((h=Object.keys(g)).map(function(j){return g[j]}),h)}if(typeof h[h.length-1]=="function"){var _=h.pop();return Jj(h=h.length===1&&td(h[0])?h[0]:h,null).pipe(Wa(function(j){return _.apply(void 0,j)}))}return Jj(h,null)},from:ge,fromEvent:Bc,fromEventPattern:Rr,generate:function(h,i,g,_,j){if(arguments.length==1){var $=h.initialState;i=h.condition,g=h.iterate;var _n=h.resultSelector||jf;j=h.scheduler}else _===void 0||Ce(_)?($=h,_n=jf,j=_):($=h,_n=_);return new Za(function(_i){var _s=$;if(j)return j.schedule(wB,0,{subscriber:_i,iterate:g,condition:i,resultSelector:_n,state:_s});for(;;){if(i){var ga=void 0;try{ga=i(_s)}catch(ba){_i.error(ba);break}if(!ga){_i.complete();break}}ga=void 0;try{ga=_n(_s)}catch(ba){_i.error(ba);break}if(_i.next(ga),_i.closed)break;try{_s=g(_s)}catch(ba){_i.error(ba);break}}})},iif:function(h,i,g){return i===void 0&&(i=$c),g===void 0&&(g=$c),lf(function(){return h()?i:g})},interval:Yg,merge:Nc,never:function(){return ap},of:Wb,onErrorResumeNext:ym,pairs:function(h,i){return new Za(i?function(g){var _=Object.keys(h),j=new dc;return j.add(i.schedule(yB,0,{keys:_,index:0,subscriber:g,subscription:j,obj:h})),j}:function(g){for(var _=Object.keys(h),j=0;j<_.length&&!g.closed;j++){var $=_[j];h.hasOwnProperty($)&&g.next([$,h[$]])}g.complete()})},partition:function(h,i,g){return[sc(i,g)(new Za(mi(h))),sc(zB(i,g))(new Za(mi(h)))]},race:bb,range:function(h,i,g){return h===void 0&&(h=0),new Za(function(_){i===void 0&&(i=h,h=0);var j=0,$=h;if(g)return g.schedule(CB,0,{index:j,count:i,start:h,subscriber:_});for(;;){if(j++>=i){_.complete();break}if(_.next($++),_.closed)break}})},throwError:Va,timer:Fe,using:function(h,i){return new Za(function(g){try{var _=h()}catch(_n){return void g.error(_n)}try{var j=i(_)}catch(_n){return void g.error(_n)}var $=(j?ge(j):$c).subscribe(g);return function(){$.unsubscribe(),_&&_.unsubscribe()}})},zip:zm,scheduled:Nr,EMPTY:$c,NEVER:ap,config:sd}),FB=function(){function h(i,g,_,j){this.bufferTimeSpan=i,this.bufferCreationInterval=g,this.maxBufferSize=_,this.scheduler=j}return h.prototype.call=function(i,g){return g.subscribe(new XH(i,this.bufferTimeSpan,this.bufferCreationInterval,this.maxBufferSize,this.scheduler))},h}(),YH=function(){this.buffer=[]},XH=function(h){function i(g,_,j,$,_n){if((g=h.call(this,g)||this).bufferTimeSpan=_,g.bufferCreationInterval=j,g.maxBufferSize=$,g.scheduler=_n,g.contexts=[],$=g.openContext(),g.timespanOnly=j==null||0>j,g.timespanOnly)g.add($.closeAction=_n.schedule(Sr,_,{subscriber:g,context:$,bufferTimeSpan:_}));else{var _i={bufferTimeSpan:_,bufferCreationInterval:j,subscriber:g,scheduler:_n};g.add($.closeAction=_n.schedule(Tr,_,{subscriber:g,context:$})),g.add(_n.schedule(GB,j,_i))}return g}return Ca(i,h),i.prototype._next=function(g){for(var _,j=this.contexts,$=j.length,_n=0;_n<$;_n++){var _i=j[_n],_s=_i.buffer;_s.push(g),_s.length==this.maxBufferSize&&(_=_i)}_&&this.onBufferFull(_)},i.prototype._error=function(g){this.contexts.length=0,h.prototype._error.call(this,g)},i.prototype._complete=function(){for(var g=this.contexts,_=this.destination;0<g.length;){var j=g.shift();_.next(j.buffer)}h.prototype._complete.call(this)},i.prototype._unsubscribe=function(){this.contexts=null},i.prototype.onBufferFull=function(g){if(this.closeContext(g),(g=g.closeAction).unsubscribe(),this.remove(g),!this.closed&&this.timespanOnly){g=this.openContext();var _=this.bufferTimeSpan;this.add(g.closeAction=this.scheduler.schedule(Sr,_,{subscriber:this,context:g,bufferTimeSpan:_}))}},i.prototype.openContext=function(){var g=new YH;return this.contexts.push(g),g},i.prototype.closeContext=function(g){this.destination.next(g.buffer);var _=this.contexts;0<=(_?_.indexOf(g):-1)&&_.splice(_.indexOf(g),1)},i}(hb),HB=function(){function h(i){this.selector=i}return h.prototype.call=function(i,g){return g.subscribe(new ZH(i,this.selector,this.caught))},h}(),ZH=function(h){function i(g,_,j){return(g=h.call(this,g)||this).selector=_,g.caught=j,g}return Ca(i,h),i.prototype.error=function(g){if(!this.isStopped){var _=void 0;try{_=this.selector(g,this.caught)}catch(j){return void h.prototype.error.call(this,j)}this._unsubscribeAndRecycle(),g=new Qe(this),this.add(g),(_=De(_,g))!==g&&this.add(_)}},i}(Re),IB=function(){function h(i){this.defaultValue=i}return h.prototype.call=function(i,g){return g.subscribe(new $H(i,this.defaultValue))},h}(),$H=function(h){function i(g,_){return(g=h.call(this,g)||this).defaultValue=_,g.isEmpty=!0,g}return Ca(i,h),i.prototype._next=function(g){this.isEmpty=!1,this.destination.next(g)},i.prototype._complete=function(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()},i}(hb),JB=function(){function h(i,g){this.delay=i,this.scheduler=g}return h.prototype.call=function(i,g){return g.subscribe(new aI(i,this.delay,this.scheduler))},h}(),aI=function(h){function i(g,_,j){return(g=h.call(this,g)||this).delay=_,g.scheduler=j,g.queue=[],g.active=!1,g.errored=!1,g}return Ca(i,h),i.dispatch=function(g){for(var _=g.source,j=_.queue,$=g.scheduler,_n=g.destination;0<j.length&&0>=j[0].time-$.now();)j.shift().notification.observe(_n);0<j.length?(_=Math.max(0,j[0].time-$.now()),this.schedule(g,_)):(this.unsubscribe(),_.active=!1)},i.prototype._schedule=function(g){this.active=!0,this.destination.add(g.schedule(i.dispatch,this.delay,{source:this,destination:this.destination,scheduler:g}))},i.prototype.scheduleNotification=function(g){if(this.errored!==!0){var _=this.scheduler;g=new bI(_.now()+this.delay,g),this.queue.push(g),this.active===!1&&this._schedule(_)}},i.prototype._next=function(g){this.scheduleNotification(Eh.createNext(g))},i.prototype._error=function(g){this.errored=!0,this.queue=[],this.destination.error(g),this.unsubscribe()},i.prototype._complete=function(){this.scheduleNotification(Eh.createComplete()),this.unsubscribe()},i}(hb),bI=function(h,i){this.time=h,this.notification=i},KB=function(){function h(i,g){this.keySelector=i,this.flushes=g}return h.prototype.call=function(i,g){return g.subscribe(new cI(i,this.keySelector,this.flushes))},h}(),cI=function(h){function i(g,_,j){return(g=h.call(this,g)||this).keySelector=_,g.values=new Set,j&&g.add(De(j,new Qe(g))),g}return Ca(i,h),i.prototype.notifyNext=function(){this.values.clear()},i.prototype.notifyError=function(g){this._error(g)},i.prototype._next=function(g){this.keySelector?this._useKeySelector(g):this._finalizeNext(g,g)},i.prototype._useKeySelector=function(g){var _=this.destination;try{var j=this.keySelector(g)}catch($){return void _.error($)}this._finalizeNext(j,g)},i.prototype._finalizeNext=function(g,_){var j=this.values;j.has(g)||(j.add(g),this.destination.next(_))},i}(Re),MB=function(){function h(i){this.errorFactory=i}return h.prototype.call=function(i,g){return g.subscribe(new dI(i,this.errorFactory))},h}(),dI=function(h){function i(g,_){return(g=h.call(this,g)||this).errorFactory=_,g.hasValue=!1,g}return Ca(i,h),i.prototype._next=function(g){this.hasValue=!0,this.destination.next(g)},i.prototype._complete=function(){if(this.hasValue)return this.destination.complete();var g=void 0;try{g=this.errorFactory()}catch(_){g=_}this.destination.error(g)},i}(hb),NB=function(){function h(i){if(this.total=i,0>this.total)throw new Yo}return h.prototype.call=function(i,g){return g.subscribe(new eI(i,this.total))},h}(),eI=function(h){function i(g,_){return(g=h.call(this,g)||this).total=_,g.count=0,g}return Ca(i,h),i.prototype._next=function(g){var _=this.total,j=++this.count;j<=_&&(this.destination.next(g),j===_&&(this.destination.complete(),this.unsubscribe()))},i}(hb),OB=function(){function h(i){this.callback=i}return h.prototype.call=function(i,g){return g.subscribe(new fI(i,this.callback))},h}(),fI=function(h){function i(g,_){return(g=h.call(this,g)||this).add(new dc(_)),g}return Ca(i,h),i}(hb),QB=function(){function h(){}return h.prototype.call=function(i,g){return g.subscribe(new gI(i))},h}(),gI=function(h){function i(){return h!==null&&h.apply(this,arguments)||this}return Ca(i,h),i.prototype._next=function(g){},i}(hb),RB=function(){function h(i){if(this.total=i,0>this.total)throw new Yo}return h.prototype.call=function(i,g){return g.subscribe(new hI(i,this.total))},h}(),hI=function(h){function i(g,_){return(g=h.call(this,g)||this).total=_,g.ring=[],g.count=0,g}return Ca(i,h),i.prototype._next=function(g){var _=this.ring,j=this.total,$=this.count++;_.length<j?_.push(g):_[$%j]=g},i.prototype._complete=function(){var g=this.destination,_=this.count;if(0<_)for(var j=this.count>=this.total?this.total:this.count,$=this.ring,_n=0;_n<j;_n++){var _i=_++%j;g.next($[_i])}g.complete()},i}(hb),SB=function(){function h(i){this.value=i}return h.prototype.call=function(i,g){return g.subscribe(new iI(i,this.value))},h}(),iI=function(h){function i(g,_){return(g=h.call(this,g)||this).value=_,g}return Ca(i,h),i.prototype._next=function(g){this.destination.next(this.value)},i}(hb),TB=function(){function h(i,g,_){_===void 0&&(_=!1),this.accumulator=i,this.seed=g,this.hasSeed=_}return h.prototype.call=function(i,g){return g.subscribe(new jI(i,this.accumulator,this.seed,this.hasSeed))},h}(),jI=function(h){function i(g,_,j,$){return(g=h.call(this,g)||this).accumulator=_,g._seed=j,g.hasSeed=$,g.index=0,g}return Ca(i,h),Object.defineProperty(i.prototype,"seed",{get:function(){return this._seed},set:function(g){this.hasSeed=!0,this._seed=g},enumerable:!0,configurable:!0}),i.prototype._next=function(g){if(this.hasSeed)return this._tryNext(g);this.seed=g,this.destination.next(g)},i.prototype._tryNext=function(g){var _=this.index++;try{var j=this.accumulator(this.seed,g,_)}catch($){this.destination.error($)}this.seed=j,this.destination.next(j)},i}(hb),VB=function(){function h(i,g){this.subjectFactory=i,this.selector=g}return h.prototype.call=function(i,g){var _=this.selector,j=this.subjectFactory();return(i=_(j).subscribe(i)).add(g.subscribe(j)),i},h}(),XB=function(){function h(i,g){this.notifier=i,this.source=g}return h.prototype.call=function(i,g){return g.subscribe(new kI(i,this.notifier,this.source))},h}(),kI=function(h){function i(g,_,j){return(g=h.call(this,g)||this).notifier=_,g.source=j,g}return Ca(i,h),i.prototype.error=function(g){if(!this.isStopped){var _=this.errors,j=this.retries,$=this.retriesSubscription;if(j)this.retriesSubscription=this.errors=void 0;else{_=new ec;try{j=(0,this.notifier)(_)}catch(_n){return h.prototype.error.call(this,_n)}$=De(j,new Qe(this))}this._unsubscribeAndRecycle(),this.errors=_,this.retries=j,this.retriesSubscription=$,_.next(g)}},i.prototype._unsubscribe=function(){var g=this.errors,_=this.retriesSubscription;g&&(g.unsubscribe(),this.errors=void 0),_&&(_.unsubscribe(),this.retriesSubscription=void 0),this.retries=void 0},i.prototype.notifyNext=function(){var g=this._unsubscribe;this._unsubscribe=null,this._unsubscribeAndRecycle(),this._unsubscribe=g,this.source.subscribe(this)},i}(Re),$B=function(){function h(i){this.project=i}return h.prototype.call=function(i,g){return g.subscribe(new lI(i,this.project))},h}(),lI=function(h){function i(g,_){return(g=h.call(this,g)||this).project=_,g.index=0,g}return Ca(i,h),i.prototype._next=function(g){var _=this.index++;try{var j=this.project(g,_)}catch($){return void this.destination.error($)}this._innerSub(j)},i.prototype._innerSub=function(g){var _=this.innerSubscription;_&&_.unsubscribe(),_=new Qe(this);var j=this.destination;j.add(_),this.innerSubscription=De(g,_),this.innerSubscription!==_&&j.add(this.innerSubscription)},i.prototype._complete=function(){var g=this.innerSubscription;g&&!g.closed||h.prototype._complete.call(this),this.unsubscribe()},i.prototype._unsubscribe=function(){this.innerSubscription=void 0},i.prototype.notifyComplete=function(){this.innerSubscription=void 0,this.isStopped&&h.prototype._complete.call(this)},i.prototype.notifyNext=function(g){this.destination.next(g)},i}(Re),aC=function(){function h(i){this.notifier=i}return h.prototype.call=function(i,g){i=new mI(i);var _=De(this.notifier,new Qe(i));return _&&!i.seenValue?(i.add(_),g.subscribe(i)):i},h}(),mI=function(h){function i(g){return(g=h.call(this,g)||this).seenValue=!1,g}return Ca(i,h),i.prototype.notifyNext=function(){this.seenValue=!0,this.complete()},i.prototype.notifyComplete=function(){},i}(Re),bC=function(){function h(i,g,_){this.nextOrObserver=i,this.error=g,this.complete=_}return h.prototype.call=function(i,g){return g.subscribe(new nI(i,this.nextOrObserver,this.error,this.complete))},h}(),nI=function(h){function i(g,_,j,$){return(g=h.call(this,g)||this)._tapNext=fe,g._tapError=fe,g._tapComplete=fe,g._tapError=j||fe,g._tapComplete=$||fe,Vg(_)?(g._context=g,g._tapNext=_):_&&(g._context=_,g._tapNext=_.next||fe,g._tapError=_.error||fe,g._tapComplete=_.complete||fe),g}return Ca(i,h),i.prototype._next=function(g){try{this._tapNext.call(this._context,g)}catch(_){return void this.destination.error(_)}this.destination.next(g)},i.prototype._error=function(g){try{this._tapError.call(this._context,g)}catch(_){return void this.destination.error(_)}this.destination.error(g)},i.prototype._complete=function(){try{this._tapComplete.call(this._context)}catch(g){return void this.destination.error(g)}return this.destination.complete()},i}(hb),dC={leading:!0,trailing:!1};(function(h){function i(g,_,j,$){var _n=h.call(this,g)||this;return _n.destination=g,_n.durationSelector=_,_n._leading=j,_n._trailing=$,_n._hasValue=!1,_n}Ca(i,h),i.prototype._next=function(g){this._hasValue=!0,this._sendValue=g,this._throttled||(this._leading?this.send():this.throttle(g))},i.prototype.send=function(){var g=this._sendValue;this._hasValue&&(this.destination.next(g),this.throttle(g)),this._hasValue=!1,this._sendValue=void 0},i.prototype.throttle=function(g){(g=this.tryDurationSelector(g))&&this.add(this._throttled=De(g,new Qe(this)))},i.prototype.tryDurationSelector=function(g){try{return this.durationSelector(g)}catch(_){return this.destination.error(_),null}},i.prototype.throttlingDone=function(){var g=this._throttled,_=this._trailing;g&&g.unsubscribe(),this._throttled=void 0,_&&this.send()},i.prototype.notifyNext=function(){this.throttlingDone()},i.prototype.notifyComplete=function(){this.throttlingDone()}})(Re);for(var eC=function(){function h(i,g,_,j){this.duration=i,this.scheduler=g,this.leading=_,this.trailing=j}return h.prototype.call=function(i,g){return g.subscribe(new oI(i,this.duration,this.scheduler,this.leading,this.trailing))},h}(),oI=function(h){function i(g,_,j,$,_n){return(g=h.call(this,g)||this).duration=_,g.scheduler=j,g.leading=$,g.trailing=_n,g._hasTrailingValue=!1,g._trailingValue=null,g}return Ca(i,h),i.prototype._next=function(g){this.throttled?this.trailing&&(this._trailingValue=g,this._hasTrailingValue=!0):(this.add(this.throttled=this.scheduler.schedule(fC,this.duration,{subscriber:this})),this.leading?this.destination.next(g):this.trailing&&(this._trailingValue=g,this._hasTrailingValue=!0))},i.prototype._complete=function(){this._hasTrailingValue&&this.destination.next(this._trailingValue),this.destination.complete()},i.prototype.clearThrottle=function(){var g=this.throttled;g&&(this.trailing&&this._hasTrailingValue&&(this.destination.next(this._trailingValue),this._trailingValue=null,this._hasTrailingValue=!1),g.unsubscribe(),this.remove(g),this.throttled=null)},i}(hb),hC=function(){function h(i,g,_,j){this.waitFor=i,this.absoluteTimeout=g,this.withObservable=_,this.scheduler=j}return h.prototype.call=function(i,g){return g.subscribe(new pI(i,this.absoluteTimeout,this.waitFor,this.withObservable,this.scheduler))},h}(),pI=function(h){function i(g,_,j,$,_n){return(g=h.call(this,g)||this).absoluteTimeout=_,g.waitFor=j,g.withObservable=$,g.scheduler=_n,g.scheduleTimeout(),g}return Ca(i,h),i.dispatchTimeout=function(g){var _=g.withObservable;g._unsubscribeAndRecycle(),g.add(De(_,new Qe(g)))},i.prototype.scheduleTimeout=function(){var g=this.action;g?this.action=g.schedule(this,this.waitFor):this.add(this.action=this.scheduler.schedule(i.dispatchTimeout,this.waitFor,this))},i.prototype._next=function(g){this.absoluteTimeout||this.scheduleTimeout(),h.prototype._next.call(this,g)},i.prototype._unsubscribe=function(){this.action=void 0,this.withObservable=this.scheduler=null},i}(Re),jC=function(){function h(i,g){this.observables=i,this.project=g}return h.prototype.call=function(i,g){return g.subscribe(new qI(i,this.observables,this.project))},h}(),qI=function(h){function i(g,_,j){(g=h.call(this,g)||this).observables=_,g.project=j,g.toRespond=[],j=_.length,g.values=Array(j);for(var $=0;$<j;$++)g.toRespond.push($);for($=0;$<j;$++)g.add(wm(g,_[$],void 0,$));return g}return Ca(i,h),i.prototype.notifyNext=function(g,_,j){this.values[j]=_,0<(g=this.toRespond).length&&(j=g.indexOf(j))!==-1&&g.splice(j,1)},i.prototype.notifyComplete=function(){},i.prototype._next=function(g){this.toRespond.length===0&&(g=[g].concat(this.values),this.project?this._tryProject(g):this.destination.next(g))},i.prototype._tryProject=function(g){try{var _=this.project.apply(this,g)}catch(j){return void this.destination.error(j)}this.destination.next(_)},i}(Zo),ow=kc(function(h){var i=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof window.msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto);if(i){var g=new Uint8Array(16);h.exports=function(){return i(g),g}}else{var _=Array(16);h.exports=function(){for(var j,$=0;16>$;$++)!(3&$)&&(j=4294967296*Math.random()),_[$]=j>>>((3&$)<<3)&255;return _}}}),tc=[],Yk=0;256>Yk;++Yk)tc[Yk]=(Yk+256).toString(16).substr(1);var pw=function(h,i){return i=i||0,[tc[h[i++]],tc[h[i++]],tc[h[i++]],tc[h[i++]],"-",tc[h[i++]],tc[h[i++]],"-",tc[h[i++]],tc[h[i++]],"-",tc[h[i++]],tc[h[i++]],"-",tc[h[i++]],tc[h[i++]],tc[h[i++]],tc[h[i++]],tc[h[i++]],tc[h[i++]]].join("")},gj=function(h,i,g){if(g=i&&g||0,typeof h=="string"&&(i=h==="binary"?Array(16):null,h=null),(h=(h=h||{}).random||(h.rng||ow)())[6]=15&h[6]|64,h[8]=63&h[8]|128,i)for(var _=0;16>_;++_)i[g+_]=h[_];return i||pw(h)},hj=gj(),Bm=!1,$r=new AbortController,Se,Df,bp,cp,Ef,rg,Zd,sg,zd,dp,Te,tg,Ue,Ve,We,Fh,Uc,$d;(function(h){h[h.ATTRIBUTE_OPERATION_ERR_FAILURE=2]="ATTRIBUTE_OPERATION_ERR_FAILURE",h[h.ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT=3]="ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT",h[h.ATTRIBUTE_OPERATION_ERR_SIZE_OVERFLOW=4]="ATTRIBUTE_OPERATION_ERR_SIZE_OVERFLOW",h[h.ATTRIBUTE_OPERATION_ERR_TOO_OFTEN=5]="ATTRIBUTE_OPERATION_ERR_TOO_OFTEN",h[h.ATTRIBUTE_OPERATION_ERR_USER_NOT_FOUND=6]="ATTRIBUTE_OPERATION_ERR_USER_NOT_FOUND",h[h.ATTRIBUTE_OPERATION_ERR_TIMEOUT=7]="ATTRIBUTE_OPERATION_ERR_TIMEOUT",h[h.ATTRIBUTE_OPERATION_ERR_USER_NOT_LOGGED_IN=102]="ATTRIBUTE_OPERATION_ERR_USER_NOT_LOGGED_IN"})(Se||(Se={})),function(h){h[h.CHANNEL_MESSAGE_ERR_FAILURE=1]="CHANNEL_MESSAGE_ERR_FAILURE",h[h.CHANNEL_MESSAGE_ERR_TIMEOUT=2]="CHANNEL_MESSAGE_ERR_TIMEOUT",h[h.CHANNEL_MESSAGE_ERR_TOO_OFTEN=3]="CHANNEL_MESSAGE_ERR_TOO_OFTEN",h[h.CHANNEL_MESSAGE_ERR_INVALID_MESSAGE=4]="CHANNEL_MESSAGE_ERR_INVALID_MESSAGE",h[h.CHANNEL_MESSAGE_ERR_NOT_IN_CHANNEL=5]="CHANNEL_MESSAGE_ERR_NOT_IN_CHANNEL",h[h.CHANNEL_MESSAGE_ERR_USER_NOT_LOGGED_IN=102]="CHANNEL_MESSAGE_ERR_USER_NOT_LOGGED_IN"}(Df||(Df={})),function(h){h[h.CREATE_CHANNEL_ERR_INVALID_ARGUMENT=1]="CREATE_CHANNEL_ERR_INVALID_ARGUMENT"}(bp||(bp={})),function(h){h[h.CREATE_INSTANCE_ERR_INVALID_ARGUMENT=1]="CREATE_INSTANCE_ERR_INVALID_ARGUMENT"}(cp||(cp={})),function(h){h[h.GET_MEMBERS_ERR_FAILURE=1]="GET_MEMBERS_ERR_FAILURE",h[h.GET_MEMBERS_ERR_REJECTED=2]="GET_MEMBERS_ERR_REJECTED",h[h.GET_MEMBERS_ERR_TIMEOUT=3]="GET_MEMBERS_ERR_TIMEOUT",h[h.GET_MEMBERS_ERR_TOO_OFTEN=4]="GET_MEMBERS_ERR_TOO_OFTEN",h[h.GET_MEMBERS_ERR_NOT_IN_CHANNEL=5]="GET_MEMBERS_ERR_NOT_IN_CHANNEL",h[h.GET_MEMBERS_ERR_USER_NOT_LOGGED_IN=102]="GET_MEMBERS_ERR_USER_NOT_LOGGED_IN"}(Ef||(Ef={})),function(h){h[h.INVITATION_API_CALL_ERR_INVALID_ARGUMENT=1]="INVITATION_API_CALL_ERR_INVALID_ARGUMENT",h[h.INVITATION_API_CALL_ERR_NOT_STARTED=2]="INVITATION_API_CALL_ERR_NOT_STARTED",h[h.INVITATION_API_CALL_ERR_ALREADY_END=3]="INVITATION_API_CALL_ERR_ALREADY_END",h[h.INVITATION_API_CALL_ERR_ALREADY_ACCEPT=4]="INVITATION_API_CALL_ERR_ALREADY_ACCEPT",h[h.INVITATION_API_CALL_ERR_ALREADY_SENT=5]="INVITATION_API_CALL_ERR_ALREADY_SENT"}(rg||(rg={})),function(h){h[h.JOIN_CHANNEL_ERR_FAILURE=1]="JOIN_CHANNEL_ERR_FAILURE",h[h.JOIN_CHANNEL_ERR_REJECTED=2]="JOIN_CHANNEL_ERR_REJECTED",h[h.JOIN_CHANNEL_ERR_INVALID_ARGUMENT=3]="JOIN_CHANNEL_ERR_INVALID_ARGUMENT",h[h.JOIN_CHANNEL_TIMEOUT=4]="JOIN_CHANNEL_TIMEOUT",h[h.JOIN_CHANNEL_ERR_EXCEED_LIMIT=5]="JOIN_CHANNEL_ERR_EXCEED_LIMIT",h[h.JOIN_CHANNEL_ERR_ALREADY_JOINED=6]="JOIN_CHANNEL_ERR_ALREADY_JOINED",h[h.JOIN_CHANNEL_ERR_TOO_OFTEN=7]="JOIN_CHANNEL_ERR_TOO_OFTEN",h[h.JOIN_CHANNEL_ERR_JOIN_SAME_CHANNEL_TOO_OFTEN=8]="JOIN_CHANNEL_ERR_JOIN_SAME_CHANNEL_TOO_OFTEN",h[h.JOIN_CHANNEL_ERR_USER_NOT_LOGGED_IN=102]="JOIN_CHANNEL_ERR_USER_NOT_LOGGED_IN",h[h.JOIN_CHANNEL_ERR_ABORTED_BY_LEAVE=201]="JOIN_CHANNEL_ERR_ABORTED_BY_LEAVE",h[h.JOIN_CHANNEL_ERR_ALREADY_JOINED_CHANNEL_OF_SAME_ID=202]="JOIN_CHANNEL_ERR_ALREADY_JOINED_CHANNEL_OF_SAME_ID"}(Zd||(Zd={})),function(h){h[h.LEAVE_CHANNEL_ERR_FAILURE=1]="LEAVE_CHANNEL_ERR_FAILURE",h[h.LEAVE_CHANNEL_ERR_REJECTED=2]="LEAVE_CHANNEL_ERR_REJECTED",h[h.LEAVE_CHANNEL_ERR_NOT_IN_CHANNEL=3]="LEAVE_CHANNEL_ERR_NOT_IN_CHANNEL",h[h.LEAVE_CHANNEL_ERR_KICKED=4]="LEAVE_CHANNEL_ERR_KICKED",h[h.LEAVE_CHANNEL_ERR_USER_NOT_LOGGED_IN=102]="LEAVE_CHANNEL_ERR_USER_NOT_LOGGED_IN"}(sg||(sg={})),function(h){h[h.LOGIN_ERR_UNKNOWN=1]="LOGIN_ERR_UNKNOWN",h[h.LOGIN_ERR_REJECTED=2]="LOGIN_ERR_REJECTED",h[h.LOGIN_ERR_INVALID_ARGUMENT=3]="LOGIN_ERR_INVALID_ARGUMENT",h[h.LOGIN_ERR_INVALID_APP_ID=4]="LOGIN_ERR_INVALID_APP_ID",h[h.LOGIN_ERR_INVALID_TOKEN=5]="LOGIN_ERR_INVALID_TOKEN",h[h.LOGIN_ERR_TOKEN_EXPIRED=6]="LOGIN_ERR_TOKEN_EXPIRED",h[h.LOGIN_ERR_NOT_AUTHORIZED=7]="LOGIN_ERR_NOT_AUTHORIZED",h[h.LOGIN_ERR_ALREADY_LOGIN=8]="LOGIN_ERR_ALREADY_LOGIN",h[h.LOGIN_ERR_TIMEOUT=9]="LOGIN_ERR_TIMEOUT",h[h.LOGIN_ERR_TOO_OFTEN=10]="LOGIN_ERR_TOO_OFTEN",h[h.LOGIN_ERR_ABORTED_BY_LOGOUT=201]="LOGIN_ERR_ABORTED_BY_LOGOUT"}(zd||(zd={})),function(h){h[h.LOGOUT_ERR_USER_NOT_LOGGED_IN=102]="LOGOUT_ERR_USER_NOT_LOGGED_IN"}(dp||(dp={})),function(h){h[h.PEER_MESSAGE_ERR_FAILURE=1]="PEER_MESSAGE_ERR_FAILURE",h[h.PEER_MESSAGE_ERR_TIMEOUT=2]="PEER_MESSAGE_ERR_TIMEOUT",h[h.PEER_MESSAGE_ERR_TOO_OFTEN=5]="PEER_MESSAGE_ERR_TOO_OFTEN",h[h.PEER_MESSAGE_ERR_INVALID_USERID=6]="PEER_MESSAGE_ERR_INVALID_USERID",h[h.PEER_MESSAGE_ERR_INVALID_MESSAGE=7]="PEER_MESSAGE_ERR_INVALID_MESSAGE",h[h.PEER_MESSAGE_ERR_INCOMPATIBLE_MESSAGE=8]="PEER_MESSAGE_ERR_INCOMPATIBLE_MESSAGE",h[h.PEER_MESSAGE_ERR_USER_NOT_LOGGED_IN=102]="PEER_MESSAGE_ERR_USER_NOT_LOGGED_IN"}(Te||(Te={})),function(h){h[h.QUERY_PEERS_ONLINE_STATUS_ERR_INVALID_ARGUMENT=2]="QUERY_PEERS_ONLINE_STATUS_ERR_INVALID_ARGUMENT",h[h.QUERY_PEERS_ONLINE_STATUS_ERR_REJECTED=3]="QUERY_PEERS_ONLINE_STATUS_ERR_REJECTED",h[h.QUERY_PEERS_ONLINE_STATUS_ERR_TIMEOUT=4]="QUERY_PEERS_ONLINE_STATUS_ERR_TIMEOUT",h[h.QUERY_PEERS_ONLINE_STATUS_ERR_TOO_OFTEN=5]="QUERY_PEERS_ONLINE_STATUS_ERR_TOO_OFTEN",h[h.QUERY_PEERS_ONLINE_STATUS_ERR_USER_NOT_LOGGED_IN=102]="QUERY_PEERS_ONLINE_STATUS_ERR_USER_NOT_LOGGED_IN"}(tg||(tg={})),function(h){h[h.RENEW_TOKEN_ERR_FAILURE=1]="RENEW_TOKEN_ERR_FAILURE",h[h.RENEW_TOKEN_ERR_INVALID_ARGUMENT=2]="RENEW_TOKEN_ERR_INVALID_ARGUMENT",h[h.RENEW_TOKEN_ERR_REJECTED=3]="RENEW_TOKEN_ERR_REJECTED",h[h.RENEW_TOKEN_ERR_TOO_OFTEN=4]="RENEW_TOKEN_ERR_TOO_OFTEN",h[h.RENEW_TOKEN_ERR_TOKEN_EXPIRED=5]="RENEW_TOKEN_ERR_TOKEN_EXPIRED",h[h.RENEW_TOKEN_ERR_INVALID_TOKEN=6]="RENEW_TOKEN_ERR_INVALID_TOKEN",h[h.RENEW_TOKEN_ERR_USER_NOT_LOGGED_IN=102]="RENEW_TOKEN_ERR_USER_NOT_LOGGED_IN",h[h.RENEW_TOKEN_ERR_ABORTED_BY_LOGOUT=201]="RENEW_TOKEN_ERR_ABORTED_BY_LOGOUT"}(Ue||(Ue={})),function(h){h[h.GET_CHANNEL_MEMBER_COUNT_ERR_FAILURE=1]="GET_CHANNEL_MEMBER_COUNT_ERR_FAILURE",h[h.GET_CHANNEL_MEMBER_COUNT_ERR_INVALID_ARGUMENT=2]="GET_CHANNEL_MEMBER_COUNT_ERR_INVALID_ARGUMENT",h[h.GET_CHANNEL_MEMBER_COUNT_ERR_TOO_OFTEN=3]="GET_CHANNEL_MEMBER_COUNT_ERR_TOO_OFTEN",h[h.GET_CHANNEL_MEMBER_COUNT_ERR_TIMEOUT=4]="GET_CHANNEL_MEMBER_COUNT_ERR_TIMEOUT",h[h.GET_CHANNEL_MEMBER_COUNT_ERR_EXCEED_LIMIT=5]="GET_CHANNEL_MEMBER_COUNT_ERR_EXCEED_LIMIT",h[h.GET_CHANNEL_MEMBER_COUNT_ERR_NOT_INITIALIZED=101]="GET_CHANNEL_MEMBER_COUNT_ERR_NOT_INITIALIZED",h[h.GET_CHANNEL_MEMBER_COUNT_ERR_USER_NOT_LOGGED_IN=102]="GET_CHANNEL_MEMBER_COUNT_ERR_USER_NOT_LOGGED_IN"}(Ve||(Ve={})),function(h){h[h.PEER_SUBSCRIPTION_STATUS_ERR_FAILURE=1]="PEER_SUBSCRIPTION_STATUS_ERR_FAILURE",h[h.PEER_SUBSCRIPTION_STATUS_ERR_INVALID_ARGUMENT=2]="PEER_SUBSCRIPTION_STATUS_ERR_INVALID_ARGUMENT",h[h.PEER_SUBSCRIPTION_STATUS_ERR_REJECTED=3]="PEER_SUBSCRIPTION_STATUS_ERR_REJECTED",h[h.PEER_SUBSCRIPTION_STATUS_ERR_TIMEOUT=4]="PEER_SUBSCRIPTION_STATUS_ERR_TIMEOUT",h[h.PEER_SUBSCRIPTION_STATUS_ERR_TOO_OFTEN=5]="PEER_SUBSCRIPTION_STATUS_ERR_TOO_OFTEN",h[h.PEER_SUBSCRIPTION_STATUS_ERR_OVERFLOW=6]="PEER_SUBSCRIPTION_STATUS_ERR_OVERFLOW",h[h.PEER_SUBSCRIPTION_STATUS_ERR_USER_NOT_LOGGED_IN=102]="PEER_SUBSCRIPTION_STATUS_ERR_USER_NOT_LOGGED_IN"}(We||(We={})),function(h){h[h.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_FAILURE=1]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_FAILURE",h[h.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TIMEOUT=2]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TIMEOUT",h[h.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TOO_OFTEN=3]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TOO_OFTEN",h[h.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_USER_NOT_LOGGED_IN=102]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_USER_NOT_LOGGED_IN"}(Fh||(Fh={})),function(h){h[h.METADATA_OPERATION_ERR_OK=0]="METADATA_OPERATION_ERR_OK",h[h.METADATA_OPERATION_ERR_FAILURE=1]="METADATA_OPERATION_ERR_FAILURE",h[h.METADATA_OPERATION_ERR_INVALID_USER_ID=2]="METADATA_OPERATION_ERR_INVALID_USER_ID",h[h.METADATA_OPERATION_ERR_INVALID_ARGUMENT=3]="METADATA_OPERATION_ERR_INVALID_ARGUMENT",h[h.METADATA_OPERATION_ERR_SIZE_OVERFLOW=4]="METADATA_OPERATION_ERR_SIZE_OVERFLOW",h[h.METADATA_OPERATION_ERR_DUPLICATE_KEY=5]="METADATA_OPERATION_ERR_DUPLICATE_KEY",h[h.METADATA_OPERATION_ERR_TOO_OFTEN=6]="METADATA_OPERATION_ERR_TOO_OFTEN",h[h.METADATA_OPERATION_ERR_TIMEOUT=7]="METADATA_OPERATION_ERR_TIMEOUT",h[h.METADATA_OPERATION_ERR_OUTDATE_REVISION=8]="METADATA_OPERATION_ERR_OUTDATE_REVISION",h[h.METADATA_OPERATION_ERR_NOT_IN_CHANNEL=9]="METADATA_OPERATION_ERR_NOT_IN_CHANNEL",h[h.METADATA_OPERATION_ERR_NOT_INITIALIZED=101]="METADATA_OPERATION_ERR_NOT_INITIALIZED",h[h.METADATA_OPERATION_ERR_USER_NOT_LOGGED_IN=102]="METADATA_OPERATION_ERR_USER_NOT_LOGGED_IN"}(Uc||(Uc={})),function(h){h[h.METADATA_SUBSCRIPTION_ERR_OK=0]="METADATA_SUBSCRIPTION_ERR_OK",h[h.METADATA_SUBSCRIPTION_ERR_FAILURE=1]="METADATA_SUBSCRIPTION_ERR_FAILURE",h[h.METADATA_SUBSCRIPTION_ERR_TIMEOUT=2]="METADATA_SUBSCRIPTION_ERR_TIMEOUT",h[h.METADATA_SUBSCRIPTION_ERR_INVALID_ARGUMENT=3]="METADATA_SUBSCRIPTION_ERR_INVALID_ARGUMENT",h[h.METADATA_SUBSCRIPTION_ERR_TOO_OFTEN=4]="METADATA_SUBSCRIPTION_ERR_TOO_OFTEN",h[h.METADATA_SUBSCRIPTION_ERR_OVERFLOW=5]="METADATA_SUBSCRIPTION_ERR_OVERFLOW",h[h.METADATA_SUBSCRIPTION_USER_NOT_SUBSCRIBED=6]="METADATA_SUBSCRIPTION_USER_NOT_SUBSCRIBED",h[h.METADATA_SUBSCRIPTION_ERR_NOT_INITIALIZED=101]="METADATA_SUBSCRIPTION_ERR_NOT_INITIALIZED",h[h.METADATA_SUBSCRIPTION_ERR_NOT_LOGGED_IN=102]="METADATA_SUBSCRIPTION_ERR_NOT_LOGGED_IN"}($d||($d={}));var Ad=Se.ATTRIBUTE_OPERATION_ERR_FAILURE,Ub=Se.ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT,ch=Se.ATTRIBUTE_OPERATION_ERR_SIZE_OVERFLOW;Se.ATTRIBUTE_OPERATION_ERR_TOO_OFTEN;var qw=Se.ATTRIBUTE_OPERATION_ERR_USER_NOT_FOUND,Bd=Se.ATTRIBUTE_OPERATION_ERR_TIMEOUT,Cd=Se.ATTRIBUTE_OPERATION_ERR_USER_NOT_LOGGED_IN,Zk=Df.CHANNEL_MESSAGE_ERR_FAILURE,ep=Df.CHANNEL_MESSAGE_ERR_TIMEOUT,rw=Df.CHANNEL_MESSAGE_ERR_TOO_OFTEN,fp=Df.CHANNEL_MESSAGE_ERR_INVALID_MESSAGE,rI=Df.CHANNEL_MESSAGE_ERR_NOT_IN_CHANNEL,gp=Df.CHANNEL_MESSAGE_ERR_USER_NOT_LOGGED_IN,sI=bp.CREATE_CHANNEL_ERR_INVALID_ARGUMENT,sw=cp.CREATE_INSTANCE_ERR_INVALID_ARGUMENT;Ve.GET_CHANNEL_MEMBER_COUNT_ERR_FAILURE;var tw=Ve.GET_CHANNEL_MEMBER_COUNT_ERR_INVALID_ARGUMENT;Ve.GET_CHANNEL_MEMBER_COUNT_ERR_TOO_OFTEN;var uw=Ve.GET_CHANNEL_MEMBER_COUNT_ERR_TIMEOUT,tI=Ve.GET_CHANNEL_MEMBER_COUNT_ERR_EXCEED_LIMIT;Ve.GET_CHANNEL_MEMBER_COUNT_ERR_NOT_INITIALIZED;var uI=Ve.GET_CHANNEL_MEMBER_COUNT_ERR_USER_NOT_LOGGED_IN,vI=Ef.GET_MEMBERS_ERR_FAILURE,wI=Ef.GET_MEMBERS_ERR_REJECTED;Ef.GET_MEMBERS_ERR_TIMEOUT,Ef.GET_MEMBERS_ERR_TOO_OFTEN;var xI=Ef.GET_MEMBERS_ERR_NOT_IN_CHANNEL,yI=Ef.GET_MEMBERS_ERR_USER_NOT_LOGGED_IN,ve=rg.INVITATION_API_CALL_ERR_INVALID_ARGUMENT,zI=rg.INVITATION_API_CALL_ERR_NOT_STARTED,$k=rg.INVITATION_API_CALL_ERR_ALREADY_END,vw=rg.INVITATION_API_CALL_ERR_ALREADY_ACCEPT,AI=rg.INVITATION_API_CALL_ERR_ALREADY_SENT,ww=Zd.JOIN_CHANNEL_ERR_FAILURE;Zd.JOIN_CHANNEL_ERR_REJECTED;var BI=Zd.JOIN_CHANNEL_ERR_INVALID_ARGUMENT,xw=Zd.JOIN_CHANNEL_TIMEOUT,yw=Zd.JOIN_CHANNEL_ERR_EXCEED_LIMIT,zw=Zd.JOIN_CHANNEL_ERR_ALREADY_JOINED;Zd.JOIN_CHANNEL_ERR_TOO_OFTEN;var Aw=Zd.JOIN_CHANNEL_ERR_USER_NOT_LOGGED_IN,Bw=Zd.JOIN_CHANNEL_ERR_ALREADY_JOINED_CHANNEL_OF_SAME_ID,Cw=sg.LEAVE_CHANNEL_ERR_FAILURE,Dw=sg.LEAVE_CHANNEL_ERR_REJECTED,CI=sg.LEAVE_CHANNEL_ERR_NOT_IN_CHANNEL,DI=sg.LEAVE_CHANNEL_ERR_USER_NOT_LOGGED_IN,EI=sg.LEAVE_CHANNEL_ERR_KICKED,Ew=zd.LOGIN_ERR_UNKNOWN,ij=zd.LOGIN_ERR_REJECTED,al=zd.LOGIN_ERR_INVALID_ARGUMENT,Fw=zd.LOGIN_ERR_INVALID_APP_ID,Gw=zd.LOGIN_ERR_INVALID_TOKEN,bl=zd.LOGIN_ERR_TOKEN_EXPIRED;zd.LOGIN_ERR_NOT_AUTHORIZED;var FI=zd.LOGIN_ERR_ALREADY_LOGIN,GI=zd.LOGIN_ERR_TIMEOUT,HI=zd.LOGIN_ERR_TOO_OFTEN,Hw=dp.LOGOUT_ERR_USER_NOT_LOGGED_IN,Iw=Te.PEER_MESSAGE_ERR_FAILURE,hp=Te.PEER_MESSAGE_ERR_TIMEOUT,Jw=Te.PEER_MESSAGE_ERR_TOO_OFTEN,Kw=Te.PEER_MESSAGE_ERR_INVALID_USERID,si=Te.PEER_MESSAGE_ERR_INVALID_MESSAGE,ip=Te.PEER_MESSAGE_ERR_USER_NOT_LOGGED_IN;Te.PEER_MESSAGE_ERR_INCOMPATIBLE_MESSAGE;var Lw=tg.QUERY_PEERS_ONLINE_STATUS_ERR_INVALID_ARGUMENT;tg.QUERY_PEERS_ONLINE_STATUS_ERR_REJECTED;var II=tg.QUERY_PEERS_ONLINE_STATUS_ERR_TIMEOUT;tg.QUERY_PEERS_ONLINE_STATUS_ERR_TOO_OFTEN;var JI=tg.QUERY_PEERS_ONLINE_STATUS_ERR_USER_NOT_LOGGED_IN,jp=Ue.RENEW_TOKEN_ERR_FAILURE,KI=Ue.RENEW_TOKEN_ERR_INVALID_ARGUMENT;Ue.RENEW_TOKEN_ERR_REJECTED,Ue.RENEW_TOKEN_ERR_TOO_OFTEN;var LI=Ue.RENEW_TOKEN_ERR_TOKEN_EXPIRED,MI=Ue.RENEW_TOKEN_ERR_INVALID_TOKEN,Mw=Ue.RENEW_TOKEN_ERR_USER_NOT_LOGGED_IN,Nw=We.PEER_SUBSCRIPTION_STATUS_ERR_FAILURE,jj=We.PEER_SUBSCRIPTION_STATUS_ERR_INVALID_ARGUMENT;We.PEER_SUBSCRIPTION_STATUS_ERR_REJECTED;var NI=We.PEER_SUBSCRIPTION_STATUS_ERR_TIMEOUT;We.PEER_SUBSCRIPTION_STATUS_ERR_TOO_OFTEN;var Ow=We.PEER_SUBSCRIPTION_STATUS_ERR_OVERFLOW,kp=We.PEER_SUBSCRIPTION_STATUS_ERR_USER_NOT_LOGGED_IN;Fh.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_FAILURE,Fh.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TIMEOUT,Fh.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TOO_OFTEN,Fh.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_USER_NOT_LOGGED_IN;var bd=Uc.METADATA_OPERATION_ERR_OK,He=Uc.METADATA_OPERATION_ERR_FAILURE;Uc.METADATA_OPERATION_ERR_INVALID_USER_ID;var Mb=Uc.METADATA_OPERATION_ERR_INVALID_ARGUMENT,Om=Uc.METADATA_OPERATION_ERR_SIZE_OVERFLOW,oC=Uc.METADATA_OPERATION_ERR_DUPLICATE_KEY,Vc=Uc.METADATA_OPERATION_ERR_TOO_OFTEN,cd=Uc.METADATA_OPERATION_ERR_TIMEOUT,of=Uc.METADATA_OPERATION_ERR_OUTDATE_REVISION;Uc.METADATA_OPERATION_ERR_NOT_INITIALIZED;var oc=Uc.METADATA_OPERATION_ERR_USER_NOT_LOGGED_IN,kj=Uc.METADATA_OPERATION_ERR_NOT_IN_CHANNEL,Pw=$d.METADATA_SUBSCRIPTION_ERR_OK,lp=$d.METADATA_SUBSCRIPTION_ERR_FAILURE,cl=$d.METADATA_SUBSCRIPTION_ERR_TIMEOUT,dl=$d.METADATA_SUBSCRIPTION_ERR_INVALID_ARGUMENT;$d.METADATA_SUBSCRIPTION_ERR_TOO_OFTEN;var OI=$d.METADATA_SUBSCRIPTION_ERR_OVERFLOW,PI=$d.METADATA_SUBSCRIPTION_USER_NOT_SUBSCRIBED;$d.METADATA_SUBSCRIPTION_ERR_NOT_INITIALIZED,$d.METADATA_SUBSCRIPTION_ERR_NOT_LOGGED_IN;var QI=function(h,i){var g;return Po(h,function(_,j,$){return!(g=i(_,j,$))}),!!g},el=function(h,i,g){if(!Kc(g))return!1;var _=Ia(i);return!!(_=="number"?$f(g)&&Eo(i,g.length):_=="string"&&i in g)&&$i(g[i],h)},mp=function(h,i,g){var _=lc(h)?Zv:QI;return g&&el(h,i,g)&&(i=void 0),_(h,Ch(i))},RI=function(h,i){var g=-1,_=$f(h)?Array(h.length):[];return Po(h,function(j,$,_n){_[++g]=i(j,$,_n)}),_},SI=function(h,i){var g=h.length;for(h.sort(i);g--;)h[g]=h[g].value;return h},TI=function(h,i,g){i=i.length?Rg(i,function(j){return lc(j)?function($){return Uk($,j.length===1?j[0]:j)}:j}):[Vk];var _=-1;return i=Rg(i,Rk(Ch)),h=RI(h,function(j,$,_n){return{criteria:Rg(i,function(_i){return _i(j)}),index:++_,value:j}}),SI(h,function(j,$){e:{for(var _n=-1,_i=j.criteria,_s=$.criteria,ga=_i.length,ba=g.length;++_n<ga;){t:{var xa=_i[_n],El=_s[_n];if(xa!==El){var Tl=xa!==void 0,Sl=xa===null,Il=xa==xa,Cl=Sg(xa),Nl=El!==void 0,Dl=El===null,Ul=El==El,Kl=Sg(El);if(!Dl&&!Kl&&!Cl&&xa>El||Cl&&Nl&&Ul&&!Dl&&!Kl||Sl&&Nl&&Ul||!Tl&&Ul||!Il){xa=1;break t}if(!Sl&&!Cl&&!Kl&&xa<El||Kl&&Tl&&Il&&!Sl&&!Cl||Dl&&Tl&&Il||!Nl&&Il||!Ul){xa=-1;break t}}xa=0}if(xa){j=_n>=ba?xa:xa*(g[_n]=="desc"?-1:1);break e}}j=j.index-$.index}return j})},Qw=function(h,i){return Xv(Wv(h,i,Vk),h+"")},Rw=Qw(function(h,i){if(h==null)return[];var g=i.length;return 1<g&&el(h,i[0],i[1])?i=[]:2<g&&el(i[0],i[1],i[2])&&(i=[i[0]]),TI(h,mm(i,1),[])}),Sw=function(h){if(h.__esModule)return h;var i=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(h).forEach(function(g){var _=Object.getOwnPropertyDescriptor(h,g);Object.defineProperty(i,g,_.get?_:{enumerable:!0,get:function(){return h[g]}})}),i}(WH),Tw=kc(function(h,i){Object.defineProperty(i,"__esModule",{value:!0});var g=[],_=function(j,$){return new WebSocket(j,$)};i.normalClosureMessage="Normal closure",i.default=function(j,$){var _n=($=$===void 0?{protocols:g,makeWebSocket:_}:$).protocols,_i=_n===void 0?g:_n,_s=($=$.makeWebSocket)===void 0?_:$;return new Sw.Observable(function(ga){var ba,xa=new Sw.Subject,El=_s(j,_i),Tl=!1,Sl=!1,Il=function(Cl){if(ba)throw Tl=!0,Cl=Error("Web socket message factory function called more than once"),ga.error(Cl),Cl;return ba=Cl.subscribe(function(Nl){El.send(Nl)}),xa};return El.onopen=function(){Sl?(Tl=!0,El.close()):ga.next(Il)},El.onmessage=function(Cl){xa.next(Cl.data)},El.onerror=function(Cl){Tl=!0,ga.error(Error(Cl.message))},El.onclose=function(Cl){Tl||(Tl=!0,Sl?(ga.complete(),xa.complete()):ga.error(Error(Cl.code===1e3?i.normalClosureMessage:Cl.reason)))},function(){Sl=!0,ba&&ba.unsubscribe(),Tl||(Tl=!0,El.close())}})}});(function(h){h&&h.__esModule&&Object.prototype.hasOwnProperty.call(h,"default")&&h.default})(Tw);var Dm=function(h,i,g){(g===void 0||$i(h[i],g))&&(g!==void 0||i in h)||bj(h,i,g)},Cm=function(h,i){if((i!=="constructor"||typeof h[i]!="function")&&i!="__proto__")return h[i]},UI=function(h){return Qw(function(i,g){var _=-1,j=g.length,$=1<j?g[j-1]:void 0,_n=2<j?g[2]:void 0;for($=3<h.length&&typeof $=="function"?(j--,$):void 0,_n&&el(g[0],g[1],_n)&&($=3>j?void 0:$,j=1),i=Object(i);++_<j;)(_n=g[_])&&h(i,_n,_,$);return i})}(function(h,i,g,_){as(h,i,g,_)}),VI=Math.floor,WI=Math.random,Uw=function(h,i){return h+VI(WI()*(i-h+1))},Vw=function(h){var i=h.length;return i?h[Uw(0,i-1)]:void 0},XI=function(h,i){return Rg(i,function(g){return h[g]})},Vm=function(h){return h==null?[]:XI(h,Wf(h))},YI=function(h){return Vw(Vm(h))},Es=function(h){return(lc(h)?Vw:YI)(h)},es=[],fs=function(h,i){return new WebSocket(h,i)};cb&&(/./g.flags!="g"||Sd)&&$b.f(RegExp.prototype,"flags",{configurable:!0,get:hk});var ZI=Math.floor;wa({target:"Number",stat:!0},{isInteger:function(h){return!fb(h)&&isFinite(h)&&ZI(h)===h}}),tu("from",On,Nn);var $I=function(h,i){for(var g=Array(arguments.length-1),_=0,j=2,$=!0;j<arguments.length;)g[_++]=arguments[j++];return new Promise(function(_n,_i){g[_]=function(_s){if($)if($=!1,_s)_i(_s);else{for(var ga=Array(arguments.length-1),ba=0;ba<ga.length;)ga[ba++]=arguments[ba];_n.apply(null,ga)}};try{h.apply(i||null,g)}catch(_s){$&&($=!1,_i(_s))}})},aJ=kc(function(h,i){i.length=function(j){var $=j.length;if(!$)return 0;for(var _n=0;1<--$%4&&j.charAt($)==="=";)++_n;return Math.ceil(3*j.length)/4-_n};var g=Array(64),_=Array(123);for(h=0;64>h;)_[g[h]=26>h?h+65:52>h?h+71:62>h?h-4:h-59|43]=h++;i.encode=function(j,$,_n){for(var _i,_s=null,ga=[],ba=0,xa=0;$<_n;){var El=j[$++];switch(xa){case 0:ga[ba++]=g[El>>2],_i=(3&El)<<4,xa=1;break;case 1:ga[ba++]=g[_i|El>>4],_i=(15&El)<<2,xa=2;break;case 2:ga[ba++]=g[_i|El>>6],ga[ba++]=g[63&El],xa=0}8191<ba&&((_s||(_s=[])).push(String.fromCharCode.apply(String,ga)),ba=0)}return xa&&(ga[ba++]=g[_i],ga[ba++]=61,xa===1&&(ga[ba++]=61)),_s?(ba&&_s.push(String.fromCharCode.apply(String,ga.slice(0,ba))),_s.join("")):String.fromCharCode.apply(String,ga.slice(0,ba))},i.decode=function(j,$,_n){for(var _i,_s=_n,ga=0,ba=0;ba<j.length;){var xa=j.charCodeAt(ba++);if(xa===61&&1<ga)break;if((xa=_[xa])===void 0)throw Error("invalid encoding");switch(ga){case 0:_i=xa,ga=1;break;case 1:$[_n++]=_i<<2|(48&xa)>>4,_i=xa,ga=2;break;case 2:$[_n++]=(15&_i)<<4|(60&xa)>>2,_i=xa,ga=3;break;case 3:$[_n++]=(3&_i)<<6|xa,ga=0}}if(ga===1)throw Error("invalid encoding");return _n-_s},i.test=function(j){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(j)}});Oj.prototype.on=function(h,i,g){return(this._listeners[h]||(this._listeners[h]=[])).push({fn:i,ctx:g||this}),this},Oj.prototype.off=function(h,i){if(h===void 0)this._listeners={};else if(i===void 0)this._listeners[h]=[];else{h=this._listeners[h];for(var g=0;g<h.length;)h[g].fn===i?h.splice(g,1):++g}return this},Oj.prototype.emit=function(h){var i=this._listeners[h];if(i){for(var g=[],_=1;_<arguments.length;)g.push(arguments[_++]);for(_=0;_<i.length;)i[_].fn.apply(i[_++].ctx,g)}return this};var bJ=gs(gs),cJ=function(d){try{var b=eval("quire".replace(/^/,"re"))(d);if(b&&(b.length||Object.keys(b).length))return b}catch(h){}return null},dJ=kc(function(h,i){i.length=function(g){for(var _,j=0,$=0;$<g.length;++$)128>(_=g.charCodeAt($))?j+=1:2048>_?j+=2:(64512&_)==55296&&(64512&g.charCodeAt($+1))==56320?(++$,j+=4):j+=3;return j},i.read=function(g,_,j){if(1>j-_)return"";for(var $,_n=null,_i=[],_s=0;_<j;)128>($=g[_++])?_i[_s++]=$:191<$&&224>$?_i[_s++]=(31&$)<<6|63&g[_++]:239<$&&365>$?($=((7&$)<<18|(63&g[_++])<<12|(63&g[_++])<<6|63&g[_++])-65536,_i[_s++]=55296+($>>10),_i[_s++]=56320+(1023&$)):_i[_s++]=(15&$)<<12|(63&g[_++])<<6|63&g[_++],8191<_s&&((_n||(_n=[])).push(String.fromCharCode.apply(String,_i)),_s=0);return _n?(_s&&_n.push(String.fromCharCode.apply(String,_i.slice(0,_s))),_n.join("")):String.fromCharCode.apply(String,_i.slice(0,_s))},i.write=function(g,_,j){for(var $,_n,_i=j,_s=0;_s<g.length;++_s)128>($=g.charCodeAt(_s))?_[j++]=$:(2048>$?_[j++]=$>>6|192:((64512&$)==55296&&(64512&(_n=g.charCodeAt(_s+1)))==56320?($=65536+((1023&$)<<10)+(1023&_n),++_s,_[j++]=$>>18|240,_[j++]=$>>12&63|128):_[j++]=$>>12|224,_[j++]=$>>6&63|128),_[j++]=63&$|128);return j-_i}}),eJ=function(h,i,g){var _=g||8192,j=_>>>1,$=null,_n=_;return function(_i){return 1>_i||_i>j?h(_i):(_n+_i>_&&($=h(_),_n=0),_i=i.call($,_n,_n+=_i),7&_n&&(_n=1+(7|_n)),_i)}},ug=mc.zero=new mc(0,0);ug.toNumber=function(){return 0},ug.zzEncode=ug.zzDecode=function(){return this},ug.length=function(){return 1};var fJ=mc.zeroHash="\0\0\0\0\0\0\0\0";mc.fromNumber=function(h){if(h===0)return ug;var i=0>h;i&&(h=-h);var g=h>>>0;return h=(h-g)/4294967296>>>0,i&&(h=~h>>>0,g=~g>>>0,4294967295<++g&&(g=0,4294967295<++h&&(h=0))),new mc(g,h)},mc.from=function(h){if(typeof h=="number")return mc.fromNumber(h);if(Ra.isString(h)){if(!Ra.Long)return mc.fromNumber(parseInt(h,10));h=Ra.Long.fromString(h)}return h.low||h.high?new mc(h.low>>>0,h.high>>>0):ug},mc.prototype.toNumber=function(h){if(!h&&this.hi>>>31){h=1+~this.lo>>>0;var i=~this.hi>>>0;return h||(i=i+1>>>0),-(h+4294967296*i)}return this.lo+4294967296*this.hi},mc.prototype.toLong=function(h){return Ra.Long?new Ra.Long(0|this.lo,0|this.hi,!!h):{low:0|this.lo,high:0|this.hi,unsigned:!!h}};var Ff=String.prototype.charCodeAt;mc.fromHash=function(h){return h===fJ?ug:new mc((Ff.call(h,0)|Ff.call(h,1)<<8|Ff.call(h,2)<<16|Ff.call(h,3)<<24)>>>0,(Ff.call(h,4)|Ff.call(h,5)<<8|Ff.call(h,6)<<16|Ff.call(h,7)<<24)>>>0)},mc.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},mc.prototype.zzEncode=function(){var h=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^h)>>>0,this.lo=(this.lo<<1^h)>>>0,this},mc.prototype.zzDecode=function(){var h=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^h)>>>0,this.hi=(this.hi>>>1^h)>>>0,this},mc.prototype.length=function(){var h=this.lo,i=(this.lo>>>28|this.hi<<4)>>>0,g=this.hi>>>24;return g===0?i===0?16384>h?128>h?1:2:2097152>h?3:4:16384>i?128>i?5:6:2097152>i?7:8:128>g?9:10};var Ra=kc(function(h,i){function g(j,$,_n){for(var _i=Object.keys($),_s=0;_s<_i.length;++_s)j[_i[_s]]!==void 0&&_n||(j[_i[_s]]=$[_i[_s]]);return j}function _(j){function $(_n,_i){if(!(this instanceof $))return new $(_n,_i);Object.defineProperty(this,"message",{get:function(){return _n}}),Error.captureStackTrace?Error.captureStackTrace(this,$):Object.defineProperty(this,"stack",{value:Error().stack||""}),_i&&g(this,_i)}return($.prototype=Object.create(Error.prototype)).constructor=$,Object.defineProperty($.prototype,"name",{get:function(){return j}}),$.prototype.toString=function(){return this.name+": "+this.message},$}i.asPromise=$I,i.base64=aJ,i.EventEmitter=Oj,i.float=bJ,i.inquire=cJ,i.utf8=dJ,i.pool=eJ,i.LongBits=mc,i.isNode=!!(qb!==void 0&&qb&&qb.process&&qb.process.versions&&qb.process.versions.node),i.global=i.isNode&&qb||typeof window<"u"&&window||typeof self<"u"&&self||qb,i.emptyArray=Object.freeze?Object.freeze([]):[],i.emptyObject=Object.freeze?Object.freeze({}):{},i.isInteger=Number.isInteger||function(j){return typeof j=="number"&&isFinite(j)&&Math.floor(j)===j},i.isString=function(j){return typeof j=="string"||j instanceof String},i.isObject=function(j){return j&&Ia(j)==="object"},i.isset=i.isSet=function(j,$){var _n=j[$];return!(_n==null||!j.hasOwnProperty($))&&(Ia(_n)!=="object"||0<(Array.isArray(_n)?_n.length:Object.keys(_n).length))},i.Buffer=function(){try{var j=i.inquire("buffer").Buffer;return j.prototype.utf8Write?j:null}catch{return null}}(),i._Buffer_from=null,i._Buffer_allocUnsafe=null,i.newBuffer=function(j){return typeof j=="number"?i.Buffer?i._Buffer_allocUnsafe(j):new i.Array(j):i.Buffer?i._Buffer_from(j):typeof Uint8Array>"u"?j:new Uint8Array(j)},i.Array=typeof Uint8Array<"u"?Uint8Array:Array,i.Long=i.global.dcodeIO&&i.global.dcodeIO.Long||i.global.Long||i.inquire("long"),i.key2Re=/^true|false|0|1$/,i.key32Re=/^-?(?:0|[1-9][0-9]*)$/,i.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,i.longToHash=function(j){return j?i.LongBits.from(j).toHash():i.LongBits.zeroHash},i.longFromHash=function(j,$){return j=i.LongBits.fromHash(j),i.Long?i.Long.fromBits(j.lo,j.hi,$):j.toNumber(!!$)},i.merge=g,i.lcFirst=function(j){return j.charAt(0).toLowerCase()+j.substring(1)},i.newError=_,i.ProtocolError=_("ProtocolError"),i.oneOfGetter=function(j){for(var $={},_n=0;_n<j.length;++_n)$[j[_n]]=1;return function(){for(var _i=Object.keys(this),_s=_i.length-1;-1<_s;--_s)if($[_i[_s]]===1&&this[_i[_s]]!==void 0&&this[_i[_s]]!==null)return _i[_s]}},i.oneOfSetter=function(j){return function($){for(var _n=0;_n<j.length;++_n)j[_n]!==$&&delete this[j[_n]]}},i.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},i._configure=function(){var j=i.Buffer;j?(i._Buffer_from=j.from!==Uint8Array.from&&j.from||function($,_n){return new j($,_n)},i._Buffer_allocUnsafe=j.allocUnsafe||function($){return new j($)}):i._Buffer_from=i._Buffer_allocUnsafe=null}}),Lm=ib,np,fl=Ra.LongBits,Ww=Ra.base64,Xw=Ra.utf8,Yw=function(){return Ra.Buffer?function(){return(ib.create=function(){return new np})()}:function(){return new ib}};ib.create=Yw(),ib.alloc=function(h){return new Ra.Array(h)},Ra.Array!==Array&&(ib.alloc=Ra.pool(ib.alloc,Ra.Array.prototype.subarray)),ib.prototype._push=function(h,i,g){return this.tail=this.tail.next=new pi(h,i,g),this.len+=i,this},Im.prototype=Object.create(pi.prototype),Im.prototype.fn=function(h,i,g){for(;127<h;)i[g++]=127&h|128,h>>>=7;i[g]=h},ib.prototype.uint32=function(h){return this.len+=(this.tail=this.tail.next=new Im(128>(h>>>=0)?1:16384>h?2:2097152>h?3:268435456>h?4:5,h)).len,this},ib.prototype.int32=function(h){return 0>h?this._push(Jm,10,fl.fromNumber(h)):this.uint32(h)},ib.prototype.sint32=function(h){return this.uint32((h<<1^h>>31)>>>0)},ib.prototype.uint64=function(h){return h=fl.from(h),this._push(Jm,h.length(),h)},ib.prototype.int64=ib.prototype.uint64,ib.prototype.sint64=function(h){return h=fl.from(h).zzEncode(),this._push(Jm,h.length(),h)},ib.prototype.bool=function(h){return this._push(Hm,1,h?1:0)},ib.prototype.fixed32=function(h){return this._push(Km,4,h>>>0)},ib.prototype.sfixed32=ib.prototype.fixed32,ib.prototype.fixed64=function(h){return h=fl.from(h),this._push(Km,4,h.lo)._push(Km,4,h.hi)},ib.prototype.sfixed64=ib.prototype.fixed64,ib.prototype.float=function(h){return this._push(Ra.float.writeFloatLE,4,h)},ib.prototype.double=function(h){return this._push(Ra.float.writeDoubleLE,8,h)};var gJ=Ra.Array.prototype.set?function(h,i,g){i.set(h,g)}:function(h,i,g){for(var _=0;_<h.length;++_)i[g+_]=h[_]};ib.prototype.bytes=function(h){var i=h.length>>>0;if(!i)return this._push(Hm,1,0);if(Ra.isString(h)){var g=ib.alloc(i=Ww.length(h));Ww.decode(h,g,0),h=g}return this.uint32(i)._push(gJ,i,h)},ib.prototype.string=function(h){var i=Xw.length(h);return i?this.uint32(i)._push(Xw.write,i,h):this._push(Hm,1,0)},ib.prototype.fork=function(){return this.states=new mC(this),this.head=this.tail=new pi(Gm,0,0),this.len=0,this},ib.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new pi(Gm,0,0),this.len=0),this},ib.prototype.ldelim=function(){var h=this.head,i=this.tail,g=this.len;return this.reset().uint32(g),g&&(this.tail.next=h.next,this.tail=i,this.len+=g),this},ib.prototype.finish=function(){for(var h=this.head.next,i=this.constructor.alloc(this.len),g=0;h;)h.fn(h.val,i,g),g+=h.len,h=h.next;return i},ib._configure=function(h){np=h,ib.create=Yw(),np._configure()},(ie.prototype=Object.create(Lm.prototype)).constructor=ie,ie._configure=function(){ie.alloc=Ra._Buffer_allocUnsafe,ie.writeBytesBuffer=Ra.Buffer&&Ra.Buffer.prototype instanceof Uint8Array&&Ra.Buffer.prototype.set.name==="set"?function(h,i,g){i.set(h,g)}:function(h,i,g){if(h.copy)h.copy(i,g,0,h.length);else for(var _=0;_<h.length;)i[g++]=h[_++]}},ie.prototype.bytes=function(h){Ra.isString(h)&&(h=Ra._Buffer_from(h,"base64"));var i=h.length>>>0;return this.uint32(i),i&&this._push(ie.writeBytesBuffer,i,h),this},ie.prototype.string=function(h){var i=Ra.Buffer.byteLength(h);return this.uint32(i),i&&this._push(nC,i,h),this},ie._configure();var Nm=Yb,op,ls=Ra.LongBits,hJ=Ra.utf8,Zw=typeof Uint8Array<"u"?function(h){if(h instanceof Uint8Array||Array.isArray(h))return new Yb(h);throw Error("illegal buffer")}:function(h){if(Array.isArray(h))return new Yb(h);throw Error("illegal buffer")},$w=function(){return Ra.Buffer?function(h){return(Yb.create=function(i){return Ra.Buffer.isBuffer(i)?new op(i):Zw(i)})(h)}:Zw};Yb.create=$w(),Yb.prototype._slice=Ra.Array.prototype.subarray||Ra.Array.prototype.slice,Yb.prototype.uint32=function(){var h=4294967295;return function(){if(h=(127&this.buf[this.pos])>>>0,128>this.buf[this.pos++]||(h=(h|(127&this.buf[this.pos])<<7)>>>0,128>this.buf[this.pos++])||(h=(h|(127&this.buf[this.pos])<<14)>>>0,128>this.buf[this.pos++])||(h=(h|(127&this.buf[this.pos])<<21)>>>0,128>this.buf[this.pos++])||(h=(h|(15&this.buf[this.pos])<<28)>>>0,128>this.buf[this.pos++]))return h;if((this.pos+=5)>this.len)throw this.pos=this.len,Od(this,10);return h}}(),Yb.prototype.int32=function(){return 0|this.uint32()},Yb.prototype.sint32=function(){var h=this.uint32();return h>>>1^-(1&h)|0},Yb.prototype.bool=function(){return this.uint32()!==0},Yb.prototype.fixed32=function(){if(this.pos+4>this.len)throw Od(this,4);return Pj(this.buf,this.pos+=4)},Yb.prototype.sfixed32=function(){if(this.pos+4>this.len)throw Od(this,4);return 0|Pj(this.buf,this.pos+=4)},Yb.prototype.float=function(){if(this.pos+4>this.len)throw Od(this,4);var h=Ra.float.readFloatLE(this.buf,this.pos);return this.pos+=4,h},Yb.prototype.double=function(){if(this.pos+8>this.len)throw Od(this,4);var h=Ra.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,h},Yb.prototype.bytes=function(){var h=this.uint32(),i=this.pos,g=this.pos+h;if(g>this.len)throw Od(this,h);return this.pos+=h,Array.isArray(this.buf)?this.buf.slice(i,g):i===g?new this.buf.constructor(0):this._slice.call(this.buf,i,g)},Yb.prototype.string=function(){var h=this.bytes();return hJ.read(h,0,h.length)},Yb.prototype.skip=function(h){if(typeof h=="number"){if(this.pos+h>this.len)throw Od(this,h);this.pos+=h}else do if(this.pos>=this.len)throw Od(this);while(128&this.buf[this.pos++]);return this},Yb.prototype.skipType=function(h){switch(h){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(h=7&this.uint32())!=4;)this.skipType(h);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+h+" at offset "+this.pos)}return this},Yb._configure=function(h){op=h,Yb.create=$w(),op._configure();var i=Ra.Long?"toLong":"toNumber";Ra.merge(Yb.prototype,{int64:function(){return Mm.call(this)[i](!1)},uint64:function(){return Mm.call(this)[i](!0)},sint64:function(){return Mm.call(this).zzDecode()[i](!1)},fixed64:function(){return ms.call(this)[i](!0)},sfixed64:function(){return ms.call(this)[i](!1)}})},(ag.prototype=Object.create(Nm.prototype)).constructor=ag,ag._configure=function(){Ra.Buffer&&(ag.prototype._slice=Ra.Buffer.prototype.slice)},ag.prototype.string=function(){var h=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+h,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+h,this.len))},ag._configure(),(qi.prototype=Object.create(Ra.EventEmitter.prototype)).constructor=qi,qi.prototype.rpcCall=function h(i,g,_,j,$){if(!j)throw TypeError("request must be specified");var _n=this;if(!$)return Ra.asPromise(h,_n,i,g,_,j);if(_n.rpcImpl)try{return _n.rpcImpl(i,g[_n.requestDelimited?"encodeDelimited":"encode"](j).finish(),function(_i,_s){if(_i)return _n.emit("error",_i,i),$(_i);if(_s!==null){if(!(_s instanceof _))try{_s=_[_n.responseDelimited?"decodeDelimited":"decode"](_s)}catch(ga){return _n.emit("error",ga,i),$(ga)}return _n.emit("data",_s,i),$(null,_s)}_n.end(!0)})}catch(_i){_n.emit("error",_i,i),setTimeout(function(){$(_i)},0)}else setTimeout(function(){$(Error("already ended"))},0)},qi.prototype.end=function(h){return this.rpcImpl&&(h||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this};var iJ=kc(function(h,i){i.Service=qi}),jJ={},ae=kc(function(h,i){function g(){_.util._configure(),_.Writer._configure(_.BufferWriter),_.Reader._configure(_.BufferReader)}var _=i;_.build="minimal",_.Writer=Lm,_.BufferWriter=ie,_.Reader=Nm,_.BufferReader=ag,_.util=Ra,_.rpc=iJ,_.roots=jJ,_.configure=g,g()});ae.util.Long=D,ae.configure();var T=ae.Reader,ta=ae.Writer,I=ae.util,Q=ae.roots.default||(ae.roots.default={}),kJ=Q.URI=function(){var h={},i=Object.create(h);return i[h[0]="Unknown"]=0,i[h[1]="PingUri"]=1,i[h[2]="PongUri"]=2,i[h[11]="UserJoinUri"]=11,i[h[12]="UserRespUri"]=12,i[h[15]="UserTicketNearlyExpireUri"]=15,i[h[16]="UserRenewTokenReqUri"]=16,i[h[17]="UserRenewTokenRespUri"]=17,i[h[21]="UserQuitUri"]=21,i[h[22]="UserDropUri"]=22,i[h[31]="GroupEnterUri"]=31,i[h[32]="GroupLeaveUri"]=32,i[h[33]="GroupReplyUri"]=33,i[h[35]="GroupDropUri"]=35,i[h[36]="GroupEnterNoticeUri"]=36,i[h[37]="GroupLeaveNoticeUri"]=37,i[h[38]="GroupEventNoticeUri"]=38,i[h[39]="GroupCountNoticeUri"]=39,i[h[41]="UserStatusListUri"]=41,i[h[42]="UserStatusResultUri"]=42,i[h[51]="GroupStatusListUri"]=51,i[h[52]="GroupStatusResultUri"]=52,i[h[55]="GroupAllUsersListUri"]=55,i[h[56]="GroupAllUsersResultUri"]=56,i[h[100]="MessageUri"]=100,i[h[101]="AckUri"]=101,i[h[201]="UserJoinNoticeUri"]=201,i[h[202]="UserQuitNoticeUri"]=202,i[h[203]="UserWaitNoticeUri"]=203,i[h[301]="UserAttributeGetUri"]=301,i[h[302]="UserAttributeRetUri"]=302,i[h[303]="UserAttributeSetUri"]=303,i[h[304]="UserAttributeModUri"]=304,i[h[305]="UserAttributeDelUri"]=305,i[h[307]="UserAttributeRspUri"]=307,i[h[308]="UserAttributeErrUri"]=308,i[h[311]="UserAttributeKeysGetUri"]=311,i[h[312]="UserAttributeKeysRetUri"]=312,i[h[351]="GroupAttributeGetUri"]=351,i[h[352]="GroupAttributeRetUri"]=352,i[h[353]="GroupAttributeSetUri"]=353,i[h[354]="GroupAttributeModUri"]=354,i[h[355]="GroupAttributeDelUri"]=355,i[h[356]="GroupAttributeAltUri"]=356,i[h[357]="GroupAttributeRspUri"]=357,i[h[358]="GroupAttributeErrUri"]=358,i[h[361]="GroupAttributeKeysGetUri"]=361,i[h[362]="GroupAttributeKeysRetUri"]=362,i[h[401]="SubscribeUserStatusUri"]=401,i[h[402]="UnsubscribeUserStatusUri"]=402,i[h[499]="SubscribeResponseUri"]=499,i[h[601]="StateSubscribeUri"]=601,i[h[602]="StateUpdateUri"]=602,i[h[603]="StateSubscribeResultUri"]=603,i[h[604]="StateUnsubscribeUri"]=604,i[h[605]="StateSetUri"]=605,i[h[606]="StateModifyUri"]=606,i[h[607]="StateRequestResultUri"]=607,i[h[608]="StateGetUri"]=608,i[h[609]="StateGetResultUri"]=609,i[h[610]="StateLockAcquireUri"]=610,i[h[611]="StateLockReleaseUri"]=611,i[h[612]="StateLockAcquireResultUri"]=612,i[h[613]="StateLockUpdateUri"]=613,i[h[614]="StateLockReleaseResultUri"]=614,i[h[615]="StateLockDisableUri"]=615,i[h[616]="StateLockDisableResultUri"]=616,i}(),gl=Q.Wrapper=function(){function h(i){if(i)for(var g=Object.keys(i),_=0;_<g.length;++_)i[g[_]]!=null&&(this[g[_]]=i[g[_]])}return h.prototype.uri=0,h.prototype.data=I.newBuffer([]),h.encode=function(i,g){return g||(g=ta.create()),i.uri!=null&&Object.hasOwnProperty.call(i,"uri")&&g.uint32(8).int32(i.uri),i.data!=null&&Object.hasOwnProperty.call(i,"data")&&g.uint32(18).bytes(i.data),g},h.decode=function(i,g){i instanceof T||(i=T.create(i)),g=g===void 0?i.len:i.pos+g;for(var _=new Q.Wrapper;i.pos<g;){var j=i.uint32();switch(j>>>3){case 1:_.uri=i.int32();break;case 2:_.data=i.bytes();break;default:i.skipType(7&j)}}return _},h}(),lJ=Q.Ping=function(){function h(i){if(i)for(var g=Object.keys(i),_=0;_<g.length;++_)i[g[_]]!=null&&(this[g[_]]=i[g[_]])}return h.prototype.seq=I.Long?I.Long.fromBits(0,0,!0):0,h.prototype.ms=I.Long?I.Long.fromBits(0,0,!0):0,h.encode=function(i,g){return g||(g=ta.create()),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&g.uint32(8).uint64(i.seq),i.ms!=null&&Object.hasOwnProperty.call(i,"ms")&&g.uint32(16).uint64(i.ms),g},h.decode=function(i,g){i instanceof T||(i=T.create(i)),g=g===void 0?i.len:i.pos+g;for(var _=new Q.Ping;i.pos<g;){var j=i.uint32();switch(j>>>3){case 1:_.seq=i.uint64();break;case 2:_.ms=i.uint64();break;default:i.skipType(7&j)}}return _},h}(),mJ=Q.Pong=function(){function h(i){if(i)for(var g=Object.keys(i),_=0;_<g.length;++_)i[g[_]]!=null&&(this[g[_]]=i[g[_]])}return h.prototype.seq=I.Long?I.Long.fromBits(0,0,!0):0,h.prototype.ms=I.Long?I.Long.fromBits(0,0,!0):0,h.encode=function(i,g){return g||(g=ta.create()),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&g.uint32(8).uint64(i.seq),i.ms!=null&&Object.hasOwnProperty.call(i,"ms")&&g.uint32(16).uint64(i.ms),g},h.decode=function(i,g){i instanceof T||(i=T.create(i)),g=g===void 0?i.len:i.pos+g;for(var _=new Q.Pong;i.pos<g;){var j=i.uint32();switch(j>>>3){case 1:_.seq=i.uint64();break;case 2:_.ms=i.uint64();break;default:i.skipType(7&j)}}return _},h}(),nJ=Q.UserJoin=function(){function h(i){if(i)for(var g=Object.keys(i),_=0;_<g.length;++_)i[g[_]]!=null&&(this[g[_]]=i[g[_]])}return h.prototype.seq=I.Long?I.Long.fromBits(0,0,!0):0,h.prototype.opt=I.Long?I.Long.fromBits(0,0,!0):0,h.prototype.instance=I.Long?I.Long.fromBits(0,0,!0):0,h.prototype.account="",h.prototype.ticket="",h.encode=function(i,g){return g||(g=ta.create()),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&g.uint32(8).uint64(i.seq),i.opt!=null&&Object.hasOwnProperty.call(i,"opt")&&g.uint32(16).uint64(i.opt),i.instance!=null&&Object.hasOwnProperty.call(i,"instance")&&g.uint32(24).uint64(i.instance),i.account!=null&&Object.hasOwnProperty.call(i,"account")&&g.uint32(34).string(i.account),i.ticket!=null&&Object.hasOwnProperty.call(i,"ticket")&&g.uint32(42).string(i.ticket),g},h.decode=function(i,g){i instanceof T||(i=T.create(i)),g=g===void 0?i.len:i.pos+g;for(var _=new Q.UserJoin;i.pos<g;){var j=i.uint32();switch(j>>>3){case 1:_.seq=i.uint64();break;case 2:_.opt=i.uint64();break;case 3:_.instance=i.uint64();break;case 4:_.account=i.string();break;case 5:_.ticket=i.string();break;default:i.skipType(7&j)}}return _},h}(),oJ=Q.UserResp=function(){function h(i){if(i)for(var g=Object.keys(i),_=0;_<g.length;++_)i[g[_]]!=null&&(this[g[_]]=i[g[_]])}return h.prototype.seq=I.Long?I.Long.fromBits(0,0,!0):0,h.prototype.account="",h.prototype.code=0,h.encode=function(i,g){return g||(g=ta.create()),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&g.uint32(8).uint64(i.seq),i.account!=null&&Object.hasOwnProperty.call(i,"account")&&g.uint32(18).string(i.account),i.code!=null&&Object.hasOwnProperty.call(i,"code")&&g.uint32(24).uint32(i.code),g},h.decode=function(i,g){i instanceof T||(i=T.create(i)),g=g===void 0?i.len:i.pos+g;for(var _=new Q.UserResp;i.pos<g;){var j=i.uint32();switch(j>>>3){case 1:_.seq=i.uint64();break;case 2:_.account=i.string();break;case 3:_.code=i.uint32();break;default:i.skipType(7&j)}}return _},h}(),pJ=Q.UserQuit=function(){function h(i){if(i)for(var g=Object.keys(i),_=0;_<g.length;++_)i[g[_]]!=null&&(this[g[_]]=i[g[_]])}return h.encode=function(i,g){return g||(g=ta.create()),g},h.decode=function(i,g){i instanceof T||(i=T.create(i)),g=g===void 0?i.len:i.pos+g;for(var _=new Q.UserQuit;i.pos<g;){var j=i.uint32();i.skipType(7&j)}return _},h}(),qJ=Q.UserDrop=function(){function h(i){if(i)for(var g=Object.keys(i),_=0;_<g.length;++_)i[g[_]]!=null&&(this[g[_]]=i[g[_]])}return h.prototype.code=0,h.encode=function(i,g){return g||(g=ta.create()),i.code!=null&&Object.hasOwnProperty.call(i,"code")&&g.uint32(8).uint32(i.code),g},h.decode=function(i,g){i instanceof T||(i=T.create(i)),g=g===void 0?i.len:i.pos+g;for(var _=new Q.UserDrop;i.pos<g;){var j=i.uint32();switch(j>>>3){case 1:_.code=i.uint32();break;default:i.skipType(7&j)}}return _},h}(),rJ=Q.UserTicketNearlyExpire=function(){function h(i){if(i)for(var g=Object.keys(i),_=0;_<g.length;++_)i[g[_]]!=null&&(this[g[_]]=i[g[_]])}return h.prototype.expireTs=I.Long?I.Long.fromBits(0,0,!0):0,h.prototype.ticket="",h.encode=function(i,g){return g||(g=ta.create()),i.expireTs!=null&&Object.hasOwnProperty.call(i,"expireTs")&&g.uint32(8).uint64(i.expireTs),i.ticket!=null&&Object.hasOwnProperty.call(i,"ticket")&&g.uint32(18).string(i.ticket),g},h.decode=function(i,g){i instanceof T||(i=T.create(i)),g=g===void 0?i.len:i.pos+g;for(var _=new Q.UserTicketNearlyExpire;i.pos<g;){var j=i.uint32();switch(j>>>3){case 1:_.expireTs=i.uint64();break;case 2:_.ticket=i.string();break;default:i.skipType(7&j)}}return _},h}(),sJ=Q.UserRenewTokenReq=function(){function h(i){if(i)for(var g=Object.keys(i),_=0;_<g.length;++_)i[g[_]]!=null&&(this[g[_]]=i[g[_]])}return h.prototype.instance=I.Long?I.Long.fromBits(0,0,!0):0,h.prototype.seq=I.Long?I.Long.fromBits(0,0,!0):0,h.prototype.account="",h.prototype.ticket="",h.encode=function(i,g){return g||(g=ta.create()),i.instance!=null&&Object.hasOwnProperty.call(i,"instance")&&g.uint32(8).uint64(i.instance),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&g.uint32(16).uint64(i.seq),i.account!=null&&Object.hasOwnProperty.call(i,"account")&&g.uint32(26).string(i.account),i.ticket!=null&&Object.hasOwnProperty.call(i,"ticket")&&g.uint32(34).string(i.ticket),g},h.decode=function(i,g){i instanceof T||(i=T.create(i)),g=g===void 0?i.len:i.pos+g;for(var _=new Q.UserRenewTokenReq;i.pos<g;){var j=i.uint32();switch(j>>>3){case 1:_.instance=i.uint64();break;case 2:_.seq=i.uint64();break;case 3:_.account=i.string();break;case 4:_.ticket=i.string();break;default:i.skipType(7&j)}}return _},h}(),tJ=Q.UserRenewTokenResp=function(){function h(i){if(i)for(var g=Object.keys(i),_=0;_<g.length;++_)i[g[_]]!=null&&(this[g[_]]=i[g[_]])}return h.prototype.seq=I.Long?I.Long.fromBits(0,0,!0):0,h.prototype.code=0,h.encode=function(i,g){return g||(g=ta.create()),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&g.uint32(8).uint64(i.seq),i.code!=null&&Object.hasOwnProperty.call(i,"code")&&g.uint32(16).uint32(i.code),g},h.decode=function(i,g){i instanceof T||(i=T.create(i)),g=g===void 0?i.len:i.pos+g;for(var _=new Q.UserRenewTokenResp;i.pos<g;){var j=i.uint32();switch(j>>>3){case 1:_.seq=i.uint64();break;case 2:_.code=i.uint32();break;default:i.skipType(7&j)}}return _},h}(),uJ=Q.GroupEnter=function(){function h(i){if(i)for(var g=Object.keys(i),_=0;_<g.length;++_)i[g[_]]!=null&&(this[g[_]]=i[g[_]])}return h.prototype.seq=I.Long?I.Long.fromBits(0,0,!0):0,h.prototype.account="",h.encode=function(i,g){return g||(g=ta.create()),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&g.uint32(8).uint64(i.seq),i.account!=null&&Object.hasOwnProperty.call(i,"account")&&g.uint32(18).string(i.account),g},h.decode=function(i,g){i instanceof T||(i=T.create(i)),g=g===void 0?i.len:i.pos+g;for(var _=new Q.GroupEnter;i.pos<g;){var j=i.uint32();switch(j>>>3){case 1:_.seq=i.uint64();break;case 2:_.account=i.string();break;default:i.skipType(7&j)}}return _},h}(),vJ=Q.GroupLeave=function(){function h(i){if(i)for(var g=Object.keys(i),_=0;_<g.length;++_)i[g[_]]!=null&&(this[g[_]]=i[g[_]])}return h.prototype.account="",h.encode=function(i,g){return g||(g=ta.create()),i.account!=null&&Object.hasOwnProperty.call(i,"account")&&g.uint32(10).string(i.account),g},h.decode=function(i,g){i instanceof T||(i=T.create(i)),g=g===void 0?i.len:i.pos+g;for(var _=new Q.GroupLeave;i.pos<g;){var j=i.uint32();switch(j>>>3){case 1:_.account=i.string();break;default:i.skipType(7&j)}}return _},h}(),wJ=Q.GroupReply=function(){function h(i){if(i)for(var g=Object.keys(i),_=0;_<g.length;++_)i[g[_]]!=null&&(this[g[_]]=i[g[_]])}return h.prototype.seq=I.Long?I.Long.fromBits(0,0,!0):0,h.prototype.account="",h.prototype.code=0,h.encode=function(i,g){return g||(g=ta.create()),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&g.uint32(8).uint64(i.seq),i.account!=null&&Object.hasOwnProperty.call(i,"account")&&g.uint32(18).string(i.account),i.code!=null&&Object.hasOwnProperty.call(i,"code")&&g.uint32(24).uint32(i.code),g},h.decode=function(i,g){i instanceof T||(i=T.create(i)),g=g===void 0?i.len:i.pos+g;for(var _=new Q.GroupReply;i.pos<g;){var j=i.uint32();switch(j>>>3){case 1:_.seq=i.uint64();break;case 2:_.account=i.string();break;case 3:_.code=i.uint32();break;default:i.skipType(7&j)}}return _},h}(),ax=Q.GroupLeaveNotice=function(){function h(i){if(i)for(var g=Object.keys(i),_=0;_<g.length;++_)i[g[_]]!=null&&(this[g[_]]=i[g[_]])}return h.prototype.seq=I.Long?I.Long.fromBits(0,0,!0):0,h.prototype.user="",h.prototype.group="",h.prototype.instance=I.Long?I.Long.fromBits(0,0,!0):0,h.prototype.size=0,h.encode=function(i,g){return g||(g=ta.create()),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&g.uint32(8).uint64(i.seq),i.user!=null&&Object.hasOwnProperty.call(i,"user")&&g.uint32(18).string(i.user),i.group!=null&&Object.hasOwnProperty.call(i,"group")&&g.uint32(26).string(i.group),i.instance!=null&&Object.hasOwnProperty.call(i,"instance")&&g.uint32(32).uint64(i.instance),i.size!=null&&Object.hasOwnProperty.call(i,"size")&&g.uint32(40).uint32(i.size),g},h.decode=function(i,g){i instanceof T||(i=T.create(i)),g=g===void 0?i.len:i.pos+g;for(var _=new Q.GroupLeaveNotice;i.pos<g;){var j=i.uint32();switch(j>>>3){case 1:_.seq=i.uint64();break;case 2:_.user=i.string();break;case 3:_.group=i.string();break;case 4:_.instance=i.uint64();break;case 5:_.size=i.uint32();break;default:i.skipType(7&j)}}return _},h}(),bx=Q.GroupEnterNotice=function(){function h(i){if(i)for(var g=Object.keys(i),_=0;_<g.length;++_)i[g[_]]!=null&&(this[g[_]]=i[g[_]])}return h.prototype.seq=I.Long?I.Long.fromBits(0,0,!0):0,h.prototype.user="",h.prototype.group="",h.prototype.instance=I.Long?I.Long.fromBits(0,0,!0):0,h.prototype.size=0,h.encode=function(i,g){return g||(g=ta.create()),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&g.uint32(8).uint64(i.seq),i.user!=null&&Object.hasOwnProperty.call(i,"user")&&g.uint32(18).string(i.user),i.group!=null&&Object.hasOwnProperty.call(i,"group")&&g.uint32(26).string(i.group),i.instance!=null&&Object.hasOwnProperty.call(i,"instance")&&g.uint32(32).uint64(i.instance),i.size!=null&&Object.hasOwnProperty.call(i,"size")&&g.uint32(40).uint32(i.size),g},h.decode=function(i,g){i instanceof T||(i=T.create(i)),g=g===void 0?i.len:i.pos+g;for(var _=new Q.GroupEnterNotice;i.pos<g;){var j=i.uint32();switch(j>>>3){case 1:_.seq=i.uint64();break;case 2:_.user=i.string();break;case 3:_.group=i.string();break;case 4:_.instance=i.uint64();break;case 5:_.size=i.uint32();break;default:i.skipType(7&j)}}return _},h}(),cx=Q.Message=function(){function h(i){if(this.MiscMap={},i)for(var g=Object.keys(i),_=0;_<g.length;++_)i[g[_]]!=null&&(this[g[_]]=i[g[_]])}return h.prototype.instance=I.Long?I.Long.fromBits(0,0,!0):0,h.prototype.dialogue=I.Long?I.Long.fromBits(0,0,!0):0,h.prototype.sequence=I.Long?I.Long.fromBits(0,0,!0):0,h.prototype.options=I.Long?I.Long.fromBits(0,0,!0):0,h.prototype.src="",h.prototype.dst="",h.prototype.payload=I.newBuffer([]),h.prototype.MiscMap=I.emptyObject,h.prototype.ms=I.Long?I.Long.fromBits(0,0,!0):0,h.encode=function(i,g){if(g||(g=ta.create()),i.instance!=null&&Object.hasOwnProperty.call(i,"instance")&&g.uint32(8).uint64(i.instance),i.dialogue!=null&&Object.hasOwnProperty.call(i,"dialogue")&&g.uint32(16).uint64(i.dialogue),i.sequence!=null&&Object.hasOwnProperty.call(i,"sequence")&&g.uint32(24).uint64(i.sequence),i.options!=null&&Object.hasOwnProperty.call(i,"options")&&g.uint32(32).uint64(i.options),i.src!=null&&Object.hasOwnProperty.call(i,"src")&&g.uint32(42).string(i.src),i.dst!=null&&Object.hasOwnProperty.call(i,"dst")&&g.uint32(50).string(i.dst),i.payload!=null&&Object.hasOwnProperty.call(i,"payload")&&g.uint32(58).bytes(i.payload),i.MiscMap!=null&&Object.hasOwnProperty.call(i,"MiscMap"))for(var _=Object.keys(i.MiscMap),j=0;j<_.length;++j)g.uint32(66).fork().uint32(10).string(_[j]).uint32(18).bytes(i.MiscMap[_[j]]).ldelim();return i.ms!=null&&Object.hasOwnProperty.call(i,"ms")&&g.uint32(72).uint64(i.ms),g},h.decode=function(i,g){i instanceof T||(i=T.create(i)),g=g===void 0?i.len:i.pos+g;for(var _,j,$=new Q.Message;i.pos<g;)switch(_=i.uint32(),_>>>3){case 1:$.instance=i.uint64();break;case 2:$.dialogue=i.uint64();break;case 3:$.sequence=i.uint64();break;case 4:$.options=i.uint64();break;case 5:$.src=i.string();break;case 6:$.dst=i.string();break;case 7:$.payload=i.bytes();break;case 8:$.MiscMap===I.emptyObject&&($.MiscMap={});var _n=i.uint32()+i.pos;for(_="",j=[];i.pos<_n;){var _i=i.uint32();switch(_i>>>3){case 1:_=i.string();break;case 2:j=i.bytes();break;default:i.skipType(7&_i)}}$.MiscMap[_]=j;break;case 9:$.ms=i.uint64();break;default:i.skipType(7&_)}return $},h}(),dx=Q.Ack=function(){function h(i){if(i)for(var g=Object.keys(i),_=0;_<g.length;++_)i[g[_]]!=null&&(this[g[_]]=i[g[_]])}return h.prototype.instance=I.Long?I.Long.fromBits(0,0,!0):0,h.prototype.dialogue=I.Long?I.Long.fromBits(0,0,!0):0,h.prototype.sequence=I.Long?I.Long.fromBits(0,0,!0):0,h.prototype.code=0,h.encode=function(i,g){return g||(g=ta.create()),i.instance!=null&&Object.hasOwnProperty.call(i,"instance")&&g.uint32(8).uint64(i.instance),i.dialogue!=null&&Object.hasOwnProperty.call(i,"dialogue")&&g.uint32(16).uint64(i.dialogue),i.sequence!=null&&Object.hasOwnProperty.call(i,"sequence")&&g.uint32(24).uint64(i.sequence),i.code!=null&&Object.hasOwnProperty.call(i,"code")&&g.uint32(32).uint32(i.code),g},h.decode=function(i,g){i instanceof T||(i=T.create(i)),g=g===void 0?i.len:i.pos+g;for(var _=new Q.Ack;i.pos<g;){var j=i.uint32();switch(j>>>3){case 1:_.instance=i.uint64();break;case 2:_.dialogue=i.uint64();break;case 3:_.sequence=i.uint64();break;case 4:_.code=i.uint32();break;default:i.skipType(7&j)}}return _},h}(),xJ=Q.GroupDrop=function(){function h(i){if(i)for(var g=Object.keys(i),_=0;_<g.length;++_)i[g[_]]!=null&&(this[g[_]]=i[g[_]])}return h.prototype.account="",h.prototype.code=0,h.encode=function(i,g){return g||(g=ta.create()),i.account!=null&&Object.hasOwnProperty.call(i,"account")&&g.uint32(10).string(i.account),i.code!=null&&Object.hasOwnProperty.call(i,"code")&&g.uint32(16).uint32(i.code),g},h.decode=function(i,g){i instanceof T||(i=T.create(i)),g=g===void 0?i.len:i.pos+g;for(var _=new Q.GroupDrop;i.pos<g;){var j=i.uint32();switch(j>>>3){case 1:_.account=i.string();break;case 2:_.code=i.uint32();break;default:i.skipType(7&j)}}return _},h}(),yJ=Q.GroupAllUsersList=function(){function h(i){if(i)for(var g=Object.keys(i),_=0;_<g.length;++_)i[g[_]]!=null&&(this[g[_]]=i[g[_]])}return h.prototype.seq=I.Long?I.Long.fromBits(0,0,!0):0,h.prototype.group="",h.prototype.pageSize=0,h.prototype.pageNumber=0,h.encode=function(i,g){return g||(g=ta.create()),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&g.uint32(8).uint64(i.seq),i.group!=null&&Object.hasOwnProperty.call(i,"group")&&g.uint32(18).string(i.group),i.pageSize!=null&&Object.hasOwnProperty.call(i,"pageSize")&&g.uint32(24).uint32(i.pageSize),i.pageNumber!=null&&Object.hasOwnProperty.call(i,"pageNumber")&&g.uint32(32).uint32(i.pageNumber),g},h.decode=function(i,g){i instanceof T||(i=T.create(i)),g=g===void 0?i.len:i.pos+g;for(var _=new Q.GroupAllUsersList;i.pos<g;){var j=i.uint32();switch(j>>>3){case 1:_.seq=i.uint64();break;case 2:_.group=i.string();break;case 3:_.pageSize=i.uint32();break;case 4:_.pageNumber=i.uint32();break;default:i.skipType(7&j)}}return _},h}(),zJ=Q.GroupAllUsersResult=function(){function h(i){if(this.memberInfos=[],i)for(var g=Object.keys(i),_=0;_<g.length;++_)i[g[_]]!=null&&(this[g[_]]=i[g[_]])}return h.prototype.seq=I.Long?I.Long.fromBits(0,0,!0):0,h.prototype.group="",h.prototype.totalSize=0,h.prototype.pageSize=0,h.prototype.pageNumber=0,h.prototype.memberInfos=I.emptyArray,h.encode=function(i,g){if(g||(g=ta.create()),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&g.uint32(8).uint64(i.seq),i.group!=null&&Object.hasOwnProperty.call(i,"group")&&g.uint32(18).string(i.group),i.totalSize!=null&&Object.hasOwnProperty.call(i,"totalSize")&&g.uint32(24).uint32(i.totalSize),i.pageSize!=null&&Object.hasOwnProperty.call(i,"pageSize")&&g.uint32(32).uint32(i.pageSize),i.pageNumber!=null&&Object.hasOwnProperty.call(i,"pageNumber")&&g.uint32(40).uint32(i.pageNumber),i.memberInfos!=null&&i.memberInfos.length)for(var _=0;_<i.memberInfos.length;++_)Q.GroupAllUsersResult.MemberInfo.encode(i.memberInfos[_],g.uint32(50).fork()).ldelim();return g},h.decode=function(i,g){i instanceof T||(i=T.create(i)),g=g===void 0?i.len:i.pos+g;for(var _=new Q.GroupAllUsersResult;i.pos<g;){var j=i.uint32();switch(j>>>3){case 1:_.seq=i.uint64();break;case 2:_.group=i.string();break;case 3:_.totalSize=i.uint32();break;case 4:_.pageSize=i.uint32();break;case 5:_.pageNumber=i.uint32();break;case 6:_.memberInfos&&_.memberInfos.length||(_.memberInfos=[]),_.memberInfos.push(Q.GroupAllUsersResult.MemberInfo.decode(i,i.uint32()));break;default:i.skipType(7&j)}}return _},h.MemberInfo=function(){function i(g){if(g)for(var _=Object.keys(g),j=0;j<_.length;++j)g[_[j]]!=null&&(this[_[j]]=g[_[j]])}return i.prototype.account="",i.prototype.ts=0,i.encode=function(g,_){return _||(_=ta.create()),g.account!=null&&Object.hasOwnProperty.call(g,"account")&&_.uint32(10).string(g.account),g.ts!=null&&Object.hasOwnProperty.call(g,"ts")&&_.uint32(16).uint32(g.ts),_},i.decode=function(g,_){g instanceof T||(g=T.create(g)),_=_===void 0?g.len:g.pos+_;for(var j=new Q.GroupAllUsersResult.MemberInfo;g.pos<_;){var $=g.uint32();switch($>>>3){case 1:j.account=g.string();break;case 2:j.ts=g.uint32();break;default:g.skipType(7&$)}}return j},i}(),h}(),AJ=Q.UserStatusList=function(){function h(i){if(this.users=[],i)for(var g=Object.keys(i),_=0;_<g.length;++_)i[g[_]]!=null&&(this[g[_]]=i[g[_]])}return h.prototype.seq=I.Long?I.Long.fromBits(0,0,!0):0,h.prototype.users=I.emptyArray,h.encode=function(i,g){if(g||(g=ta.create()),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&g.uint32(8).uint64(i.seq),i.users!=null&&i.users.length)for(var _=0;_<i.users.length;++_)g.uint32(18).string(i.users[_]);return g},h.decode=function(i,g){i instanceof T||(i=T.create(i)),g=g===void 0?i.len:i.pos+g;for(var _=new Q.UserStatusList;i.pos<g;){var j=i.uint32();switch(j>>>3){case 1:_.seq=i.uint64();break;case 2:_.users&&_.users.length||(_.users=[]),_.users.push(i.string());break;default:i.skipType(7&j)}}return _},h}(),BJ=Q.UserStatusResult=function(){function h(i){if(this.userInfos=[],i)for(var g=Object.keys(i),_=0;_<g.length;++_)i[g[_]]!=null&&(this[g[_]]=i[g[_]])}return h.prototype.seq=I.Long?I.Long.fromBits(0,0,!0):0,h.prototype.userInfos=I.emptyArray,h.encode=function(i,g){if(g||(g=ta.create()),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&g.uint32(8).uint64(i.seq),i.userInfos!=null&&i.userInfos.length)for(var _=0;_<i.userInfos.length;++_)Q.UserStatusResult.UserStatusInfo.encode(i.userInfos[_],g.uint32(18).fork()).ldelim();return g},h.decode=function(i,g){i instanceof T||(i=T.create(i)),g=g===void 0?i.len:i.pos+g;for(var _=new Q.UserStatusResult;i.pos<g;){var j=i.uint32();switch(j>>>3){case 1:_.seq=i.uint64();break;case 2:_.userInfos&&_.userInfos.length||(_.userInfos=[]),_.userInfos.push(Q.UserStatusResult.UserStatusInfo.decode(i,i.uint32()));break;default:i.skipType(7&j)}}return _},h.UserStatusInfo=function(){function i(g){if(g)for(var _=Object.keys(g),j=0;j<_.length;++j)g[_[j]]!=null&&(this[_[j]]=g[_[j]])}return i.prototype.account="",i.prototype.ts=0,i.encode=function(g,_){return _||(_=ta.create()),g.account!=null&&Object.hasOwnProperty.call(g,"account")&&_.uint32(10).string(g.account),g.ts!=null&&Object.hasOwnProperty.call(g,"ts")&&_.uint32(16).uint32(g.ts),_},i.decode=function(g,_){g instanceof T||(g=T.create(g)),_=_===void 0?g.len:g.pos+_;for(var j=new Q.UserStatusResult.UserStatusInfo;g.pos<_;){var $=g.uint32();switch($>>>3){case 1:j.account=g.string();break;case 2:j.ts=g.uint32();break;default:g.skipType(7&$)}}return j},i}(),h}(),CJ=Q.UserAttributeGet=function(){function h(i){if(this.attributes=[],i)for(var g=Object.keys(i),_=0;_<g.length;++_)i[g[_]]!=null&&(this[g[_]]=i[g[_]])}return h.prototype.seq=I.Long?I.Long.fromBits(0,0,!0):0,h.prototype.account="",h.prototype.attributes=I.emptyArray,h.encode=function(i,g){if(g||(g=ta.create()),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&g.uint32(8).uint64(i.seq),i.account!=null&&Object.hasOwnProperty.call(i,"account")&&g.uint32(18).string(i.account),i.attributes!=null&&i.attributes.length)for(var _=0;_<i.attributes.length;++_)g.uint32(26).string(i.attributes[_]);return g},h.decode=function(i,g){i instanceof T||(i=T.create(i)),g=g===void 0?i.len:i.pos+g;for(var _=new Q.UserAttributeGet;i.pos<g;){var j=i.uint32();switch(j>>>3){case 1:_.seq=i.uint64();break;case 2:_.account=i.string();break;case 3:_.attributes&&_.attributes.length||(_.attributes=[]),_.attributes.push(i.string());break;default:i.skipType(7&j)}}return _},h}(),DJ=Q.UserAttributeRet=function(){function h(i){if(this.attributeInfos=[],i)for(var g=Object.keys(i),_=0;_<g.length;++_)i[g[_]]!=null&&(this[g[_]]=i[g[_]])}return h.prototype.seq=I.Long?I.Long.fromBits(0,0,!0):0,h.prototype.attributeInfos=I.emptyArray,h.encode=function(i,g){if(g||(g=ta.create()),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&g.uint32(8).uint64(i.seq),i.attributeInfos!=null&&i.attributeInfos.length)for(var _=0;_<i.attributeInfos.length;++_)Q.UserAttributeRet.AttributeInfo.encode(i.attributeInfos[_],g.uint32(18).fork()).ldelim();return g},h.decode=function(i,g){i instanceof T||(i=T.create(i)),g=g===void 0?i.len:i.pos+g;for(var _=new Q.UserAttributeRet;i.pos<g;){var j=i.uint32();switch(j>>>3){case 1:_.seq=i.uint64();break;case 2:_.attributeInfos&&_.attributeInfos.length||(_.attributeInfos=[]),_.attributeInfos.push(Q.UserAttributeRet.AttributeInfo.decode(i,i.uint32()));break;default:i.skipType(7&j)}}return _},h.AttributeInfo=function(){function i(g){if(g)for(var _=Object.keys(g),j=0;j<_.length;++j)g[_[j]]!=null&&(this[_[j]]=g[_[j]])}return i.prototype.key="",i.prototype.value="",i.encode=function(g,_){return _||(_=ta.create()),g.key!=null&&Object.hasOwnProperty.call(g,"key")&&_.uint32(10).string(g.key),g.value!=null&&Object.hasOwnProperty.call(g,"value")&&_.uint32(18).string(g.value),_},i.decode=function(g,_){g instanceof T||(g=T.create(g)),_=_===void 0?g.len:g.pos+_;for(var j=new Q.UserAttributeRet.AttributeInfo;g.pos<_;){var $=g.uint32();switch($>>>3){case 1:j.key=g.string();break;case 2:j.value=g.string();break;default:g.skipType(7&$)}}return j},i}(),h}(),EJ=Q.UserAttributeSet=function(){function h(i){if(this.attributeInfos=[],i)for(var g=Object.keys(i),_=0;_<g.length;++_)i[g[_]]!=null&&(this[g[_]]=i[g[_]])}return h.prototype.seq=I.Long?I.Long.fromBits(0,0,!0):0,h.prototype.account="",h.prototype.attributeInfos=I.emptyArray,h.encode=function(i,g){if(g||(g=ta.create()),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&g.uint32(8).uint64(i.seq),i.account!=null&&Object.hasOwnProperty.call(i,"account")&&g.uint32(18).string(i.account),i.attributeInfos!=null&&i.attributeInfos.length)for(var _=0;_<i.attributeInfos.length;++_)Q.UserAttributeSet.AttributeInfo.encode(i.attributeInfos[_],g.uint32(26).fork()).ldelim();return g},h.decode=function(i,g){i instanceof T||(i=T.create(i)),g=g===void 0?i.len:i.pos+g;for(var _=new Q.UserAttributeSet;i.pos<g;){var j=i.uint32();switch(j>>>3){case 1:_.seq=i.uint64();break;case 2:_.account=i.string();break;case 3:_.attributeInfos&&_.attributeInfos.length||(_.attributeInfos=[]),_.attributeInfos.push(Q.UserAttributeSet.AttributeInfo.decode(i,i.uint32()));break;default:i.skipType(7&j)}}return _},h.AttributeInfo=function(){function i(g){if(g)for(var _=Object.keys(g),j=0;j<_.length;++j)g[_[j]]!=null&&(this[_[j]]=g[_[j]])}return i.prototype.key="",i.prototype.value="",i.encode=function(g,_){return _||(_=ta.create()),g.key!=null&&Object.hasOwnProperty.call(g,"key")&&_.uint32(10).string(g.key),g.value!=null&&Object.hasOwnProperty.call(g,"value")&&_.uint32(18).string(g.value),_},i.decode=function(g,_){g instanceof T||(g=T.create(g)),_=_===void 0?g.len:g.pos+_;for(var j=new Q.UserAttributeSet.AttributeInfo;g.pos<_;){var $=g.uint32();switch($>>>3){case 1:j.key=g.string();break;case 2:j.value=g.string();break;default:g.skipType(7&$)}}return j},i}(),h}(),FJ=Q.UserAttributeMod=function(){function h(i){if(this.attributeInfos=[],i)for(var g=Object.keys(i),_=0;_<g.length;++_)i[g[_]]!=null&&(this[g[_]]=i[g[_]])}return h.prototype.seq=I.Long?I.Long.fromBits(0,0,!0):0,h.prototype.account="",h.prototype.attributeInfos=I.emptyArray,h.encode=function(i,g){if(g||(g=ta.create()),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&g.uint32(8).uint64(i.seq),i.account!=null&&Object.hasOwnProperty.call(i,"account")&&g.uint32(18).string(i.account),i.attributeInfos!=null&&i.attributeInfos.length)for(var _=0;_<i.attributeInfos.length;++_)Q.UserAttributeMod.AttributeInfo.encode(i.attributeInfos[_],g.uint32(26).fork()).ldelim();return g},h.decode=function(i,g){i instanceof T||(i=T.create(i)),g=g===void 0?i.len:i.pos+g;for(var _=new Q.UserAttributeMod;i.pos<g;){var j=i.uint32();switch(j>>>3){case 1:_.seq=i.uint64();break;case 2:_.account=i.string();break;case 3:_.attributeInfos&&_.attributeInfos.length||(_.attributeInfos=[]),_.attributeInfos.push(Q.UserAttributeMod.AttributeInfo.decode(i,i.uint32()));break;default:i.skipType(7&j)}}return _},h.AttributeInfo=function(){function i(g){if(g)for(var _=Object.keys(g),j=0;j<_.length;++j)g[_[j]]!=null&&(this[_[j]]=g[_[j]])}return i.prototype.key="",i.prototype.value="",i.encode=function(g,_){return _||(_=ta.create()),g.key!=null&&Object.hasOwnProperty.call(g,"key")&&_.uint32(10).string(g.key),g.value!=null&&Object.hasOwnProperty.call(g,"value")&&_.uint32(18).string(g.value),_},i.decode=function(g,_){g instanceof T||(g=T.create(g)),_=_===void 0?g.len:g.pos+_;for(var j=new Q.UserAttributeMod.AttributeInfo;g.pos<_;){var $=g.uint32();switch($>>>3){case 1:j.key=g.string();break;case 2:j.value=g.string();break;default:g.skipType(7&$)}}return j},i}(),h}(),GJ=Q.UserAttributeDel=function(){function h(i){if(this.attributes=[],i)for(var g=Object.keys(i),_=0;_<g.length;++_)i[g[_]]!=null&&(this[g[_]]=i[g[_]])}return h.prototype.seq=I.Long?I.Long.fromBits(0,0,!0):0,h.prototype.account="",h.prototype.attributes=I.emptyArray,h.encode=function(i,g){if(g||(g=ta.create()),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&g.uint32(8).uint64(i.seq),i.account!=null&&Object.hasOwnProperty.call(i,"account")&&g.uint32(18).string(i.account),i.attributes!=null&&i.attributes.length)for(var _=0;_<i.attributes.length;++_)g.uint32(26).string(i.attributes[_]);return g},h.decode=function(i,g){i instanceof T||(i=T.create(i)),g=g===void 0?i.len:i.pos+g;for(var _=new Q.UserAttributeDel;i.pos<g;){var j=i.uint32();switch(j>>>3){case 1:_.seq=i.uint64();break;case 2:_.account=i.string();break;case 3:_.attributes&&_.attributes.length||(_.attributes=[]),_.attributes.push(i.string());break;default:i.skipType(7&j)}}return _},h}(),HJ=Q.UserAttributeErr=function(){function h(i){if(i)for(var g=Object.keys(i),_=0;_<g.length;++_)i[g[_]]!=null&&(this[g[_]]=i[g[_]])}return h.prototype.seq=I.Long?I.Long.fromBits(0,0,!0):0,h.prototype.code=0,h.encode=function(i,g){return g||(g=ta.create()),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&g.uint32(8).uint64(i.seq),i.code!=null&&Object.hasOwnProperty.call(i,"code")&&g.uint32(16).uint32(i.code),g},h.decode=function(i,g){i instanceof T||(i=T.create(i)),g=g===void 0?i.len:i.pos+g;for(var _=new Q.UserAttributeErr;i.pos<g;){var j=i.uint32();switch(j>>>3){case 1:_.seq=i.uint64();break;case 2:_.code=i.uint32();break;default:i.skipType(7&j)}}return _},h}(),IJ=Q.UserAttributeKeysGet=function(){function h(i){if(i)for(var g=Object.keys(i),_=0;_<g.length;++_)i[g[_]]!=null&&(this[g[_]]=i[g[_]])}return h.prototype.seq=I.Long?I.Long.fromBits(0,0,!0):0,h.prototype.account="",h.encode=function(i,g){return g||(g=ta.create()),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&g.uint32(8).uint64(i.seq),i.account!=null&&Object.hasOwnProperty.call(i,"account")&&g.uint32(18).string(i.account),g},h.decode=function(i,g){i instanceof T||(i=T.create(i)),g=g===void 0?i.len:i.pos+g;for(var _=new Q.UserAttributeKeysGet;i.pos<g;){var j=i.uint32();switch(j>>>3){case 1:_.seq=i.uint64();break;case 2:_.account=i.string();break;default:i.skipType(7&j)}}return _},h}(),JJ=Q.UserAttributeKeysRet=function(){function h(i){if(this.keys=[],i)for(var g=Object.keys(i),_=0;_<g.length;++_)i[g[_]]!=null&&(this[g[_]]=i[g[_]])}return h.prototype.seq=I.Long?I.Long.fromBits(0,0,!0):0,h.prototype.keys=I.emptyArray,h.encode=function(i,g){if(g||(g=ta.create()),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&g.uint32(8).uint64(i.seq),i.keys!=null&&i.keys.length)for(var _=0;_<i.keys.length;++_)g.uint32(18).string(i.keys[_]);return g},h.decode=function(i,g){i instanceof T||(i=T.create(i)),g=g===void 0?i.len:i.pos+g;for(var _=new Q.UserAttributeKeysRet;i.pos<g;){var j=i.uint32();switch(j>>>3){case 1:_.seq=i.uint64();break;case 2:_.keys&&_.keys.length||(_.keys=[]),_.keys.push(i.string());break;default:i.skipType(7&j)}}return _},h}(),KJ=Q.UserAttributeRsp=function(){function h(i){if(i)for(var g=Object.keys(i),_=0;_<g.length;++_)i[g[_]]!=null&&(this[g[_]]=i[g[_]])}return h.prototype.seq=I.Long?I.Long.fromBits(0,0,!0):0,h.encode=function(i,g){return g||(g=ta.create()),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&g.uint32(8).uint64(i.seq),g},h.decode=function(i,g){i instanceof T||(i=T.create(i)),g=g===void 0?i.len:i.pos+g;for(var _=new Q.UserAttributeRsp;i.pos<g;){var j=i.uint32();switch(j>>>3){case 1:_.seq=i.uint64();break;default:i.skipType(7&j)}}return _},h}(),LJ=Q.GroupStatusList=function(){function h(i){if(this.groups=[],i)for(var g=Object.keys(i),_=0;_<g.length;++_)i[g[_]]!=null&&(this[g[_]]=i[g[_]])}return h.prototype.seq=I.Long?I.Long.fromBits(0,0,!0):0,h.prototype.groups=I.emptyArray,h.encode=function(i,g){if(g||(g=ta.create()),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&g.uint32(8).uint64(i.seq),i.groups!=null&&i.groups.length)for(var _=0;_<i.groups.length;++_)g.uint32(18).string(i.groups[_]);return g},h.decode=function(i,g){i instanceof T||(i=T.create(i)),g=g===void 0?i.len:i.pos+g;for(var _=new Q.GroupStatusList;i.pos<g;){var j=i.uint32();switch(j>>>3){case 1:_.seq=i.uint64();break;case 2:_.groups&&_.groups.length||(_.groups=[]),_.groups.push(i.string());break;default:i.skipType(7&j)}}return _},h}(),MJ=Q.GroupStatusResult=function(){function h(i){if(this.groupInfos=[],i)for(var g=Object.keys(i),_=0;_<g.length;++_)i[g[_]]!=null&&(this[g[_]]=i[g[_]])}return h.prototype.seq=I.Long?I.Long.fromBits(0,0,!0):0,h.prototype.groupInfos=I.emptyArray,h.encode=function(i,g){if(g||(g=ta.create()),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&g.uint32(8).uint64(i.seq),i.groupInfos!=null&&i.groupInfos.length)for(var _=0;_<i.groupInfos.length;++_)Q.GroupStatusResult.GroupInfo.encode(i.groupInfos[_],g.uint32(18).fork()).ldelim();return g},h.decode=function(i,g){i instanceof T||(i=T.create(i)),g=g===void 0?i.len:i.pos+g;for(var _=new Q.GroupStatusResult;i.pos<g;){var j=i.uint32();switch(j>>>3){case 1:_.seq=i.uint64();break;case 2:_.groupInfos&&_.groupInfos.length||(_.groupInfos=[]),_.groupInfos.push(Q.GroupStatusResult.GroupInfo.decode(i,i.uint32()));break;default:i.skipType(7&j)}}return _},h.GroupInfo=function(){function i(g){if(g)for(var _=Object.keys(g),j=0;j<_.length;++j)g[_[j]]!=null&&(this[_[j]]=g[_[j]])}return i.prototype.group="",i.prototype.memberCount=0,i.encode=function(g,_){return _||(_=ta.create()),g.group!=null&&Object.hasOwnProperty.call(g,"group")&&_.uint32(10).string(g.group),g.memberCount!=null&&Object.hasOwnProperty.call(g,"memberCount")&&_.uint32(16).uint32(g.memberCount),_},i.decode=function(g,_){g instanceof T||(g=T.create(g)),_=_===void 0?g.len:g.pos+_;for(var j=new Q.GroupStatusResult.GroupInfo;g.pos<_;){var $=g.uint32();switch($>>>3){case 1:j.group=g.string();break;case 2:j.memberCount=g.uint32();break;default:g.skipType(7&$)}}return j},i}(),h}(),NJ=Q.GroupCountNotice=function(){function h(i){if(i)for(var g=Object.keys(i),_=0;_<g.length;++_)i[g[_]]!=null&&(this[g[_]]=i[g[_]])}return h.prototype.instance=I.Long?I.Long.fromBits(0,0,!0):0,h.prototype.seq=I.Long?I.Long.fromBits(0,0,!0):0,h.prototype.group="",h.prototype.size=0,h.encode=function(i,g){return g||(g=ta.create()),i.instance!=null&&Object.hasOwnProperty.call(i,"instance")&&g.uint32(8).uint64(i.instance),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&g.uint32(16).uint64(i.seq),i.group!=null&&Object.hasOwnProperty.call(i,"group")&&g.uint32(26).string(i.group),i.size!=null&&Object.hasOwnProperty.call(i,"size")&&g.uint32(32).uint32(i.size),g},h.decode=function(i,g){i instanceof T||(i=T.create(i)),g=g===void 0?i.len:i.pos+g;for(var _=new Q.GroupCountNotice;i.pos<g;){var j=i.uint32();switch(j>>>3){case 1:_.instance=i.uint64();break;case 2:_.seq=i.uint64();break;case 3:_.group=i.string();break;case 4:_.size=i.uint32();break;default:i.skipType(7&j)}}return _},h}(),OJ=Q.GroupAttributeGet=function(){function h(i){if(this.attributes=[],i)for(var g=Object.keys(i),_=0;_<g.length;++_)i[g[_]]!=null&&(this[g[_]]=i[g[_]])}return h.prototype.seq=I.Long?I.Long.fromBits(0,0,!0):0,h.prototype.group="",h.prototype.attributes=I.emptyArray,h.encode=function(i,g){if(g||(g=ta.create()),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&g.uint32(8).uint64(i.seq),i.group!=null&&Object.hasOwnProperty.call(i,"group")&&g.uint32(18).string(i.group),i.attributes!=null&&i.attributes.length)for(var _=0;_<i.attributes.length;++_)g.uint32(26).string(i.attributes[_]);return g},h.decode=function(i,g){i instanceof T||(i=T.create(i)),g=g===void 0?i.len:i.pos+g;for(var _=new Q.GroupAttributeGet;i.pos<g;){var j=i.uint32();switch(j>>>3){case 1:_.seq=i.uint64();break;case 2:_.group=i.string();break;case 3:_.attributes&&_.attributes.length||(_.attributes=[]),_.attributes.push(i.string());break;default:i.skipType(7&j)}}return _},h}(),PJ=Q.GroupAttributeRet=function(){function h(i){if(this.attributeMaps=[],i)for(var g=Object.keys(i),_=0;_<g.length;++_)i[g[_]]!=null&&(this[g[_]]=i[g[_]])}return h.prototype.seq=I.Long?I.Long.fromBits(0,0,!0):0,h.prototype.attributeMaps=I.emptyArray,h.encode=function(i,g){if(g||(g=ta.create()),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&g.uint32(8).uint64(i.seq),i.attributeMaps!=null&&i.attributeMaps.length)for(var _=0;_<i.attributeMaps.length;++_)Q.GroupAttributeRet.AttributeMap.encode(i.attributeMaps[_],g.uint32(18).fork()).ldelim();return g},h.decode=function(i,g){i instanceof T||(i=T.create(i)),g=g===void 0?i.len:i.pos+g;for(var _=new Q.GroupAttributeRet;i.pos<g;){var j=i.uint32();switch(j>>>3){case 1:_.seq=i.uint64();break;case 2:_.attributeMaps&&_.attributeMaps.length||(_.attributeMaps=[]),_.attributeMaps.push(Q.GroupAttributeRet.AttributeMap.decode(i,i.uint32()));break;default:i.skipType(7&j)}}return _},h.AttributeMap=function(){function i(g){if(g)for(var _=Object.keys(g),j=0;j<_.length;++j)g[_[j]]!=null&&(this[_[j]]=g[_[j]])}return i.prototype.key="",i.prototype.value="",i.prototype.origin="",i.prototype.ms=I.Long?I.Long.fromBits(0,0,!0):0,i.encode=function(g,_){return _||(_=ta.create()),g.key!=null&&Object.hasOwnProperty.call(g,"key")&&_.uint32(10).string(g.key),g.value!=null&&Object.hasOwnProperty.call(g,"value")&&_.uint32(18).string(g.value),g.origin!=null&&Object.hasOwnProperty.call(g,"origin")&&_.uint32(26).string(g.origin),g.ms!=null&&Object.hasOwnProperty.call(g,"ms")&&_.uint32(32).uint64(g.ms),_},i.decode=function(g,_){g instanceof T||(g=T.create(g)),_=_===void 0?g.len:g.pos+_;for(var j=new Q.GroupAttributeRet.AttributeMap;g.pos<_;){var $=g.uint32();switch($>>>3){case 1:j.key=g.string();break;case 2:j.value=g.string();break;case 3:j.origin=g.string();break;case 4:j.ms=g.uint64();break;default:g.skipType(7&$)}}return j},i}(),h}(),QJ=Q.GroupAttributeSet=function(){function h(i){if(this.attributeInfos=[],i)for(var g=Object.keys(i),_=0;_<g.length;++_)i[g[_]]!=null&&(this[g[_]]=i[g[_]])}return h.prototype.seq=I.Long?I.Long.fromBits(0,0,!0):0,h.prototype.group="",h.prototype.broadcast=!1,h.prototype.attributeInfos=I.emptyArray,h.encode=function(i,g){if(g||(g=ta.create()),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&g.uint32(8).uint64(i.seq),i.group!=null&&Object.hasOwnProperty.call(i,"group")&&g.uint32(18).string(i.group),i.broadcast!=null&&Object.hasOwnProperty.call(i,"broadcast")&&g.uint32(24).bool(i.broadcast),i.attributeInfos!=null&&i.attributeInfos.length)for(var _=0;_<i.attributeInfos.length;++_)Q.GroupAttributeSet.AttributeInfo.encode(i.attributeInfos[_],g.uint32(34).fork()).ldelim();return g},h.decode=function(i,g){i instanceof T||(i=T.create(i)),g=g===void 0?i.len:i.pos+g;for(var _=new Q.GroupAttributeSet;i.pos<g;){var j=i.uint32();switch(j>>>3){case 1:_.seq=i.uint64();break;case 2:_.group=i.string();break;case 3:_.broadcast=i.bool();break;case 4:_.attributeInfos&&_.attributeInfos.length||(_.attributeInfos=[]),_.attributeInfos.push(Q.GroupAttributeSet.AttributeInfo.decode(i,i.uint32()));break;default:i.skipType(7&j)}}return _},h.AttributeInfo=function(){function i(g){if(g)for(var _=Object.keys(g),j=0;j<_.length;++j)g[_[j]]!=null&&(this[_[j]]=g[_[j]])}return i.prototype.key="",i.prototype.value="",i.encode=function(g,_){return _||(_=ta.create()),g.key!=null&&Object.hasOwnProperty.call(g,"key")&&_.uint32(10).string(g.key),g.value!=null&&Object.hasOwnProperty.call(g,"value")&&_.uint32(18).string(g.value),_},i.decode=function(g,_){g instanceof T||(g=T.create(g)),_=_===void 0?g.len:g.pos+_;for(var j=new Q.GroupAttributeSet.AttributeInfo;g.pos<_;){var $=g.uint32();switch($>>>3){case 1:j.key=g.string();break;case 2:j.value=g.string();break;default:g.skipType(7&$)}}return j},i}(),h}(),RJ=Q.GroupAttributeMod=function(){function h(i){if(this.attributeInfos=[],i)for(var g=Object.keys(i),_=0;_<g.length;++_)i[g[_]]!=null&&(this[g[_]]=i[g[_]])}return h.prototype.seq=I.Long?I.Long.fromBits(0,0,!0):0,h.prototype.group="",h.prototype.broadcast=!1,h.prototype.attributeInfos=I.emptyArray,h.encode=function(i,g){if(g||(g=ta.create()),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&g.uint32(8).uint64(i.seq),i.group!=null&&Object.hasOwnProperty.call(i,"group")&&g.uint32(18).string(i.group),i.broadcast!=null&&Object.hasOwnProperty.call(i,"broadcast")&&g.uint32(24).bool(i.broadcast),i.attributeInfos!=null&&i.attributeInfos.length)for(var _=0;_<i.attributeInfos.length;++_)Q.GroupAttributeMod.AttributeInfo.encode(i.attributeInfos[_],g.uint32(34).fork()).ldelim();return g},h.decode=function(i,g){i instanceof T||(i=T.create(i)),g=g===void 0?i.len:i.pos+g;for(var _=new Q.GroupAttributeMod;i.pos<g;){var j=i.uint32();switch(j>>>3){case 1:_.seq=i.uint64();break;case 2:_.group=i.string();break;case 3:_.broadcast=i.bool();break;case 4:_.attributeInfos&&_.attributeInfos.length||(_.attributeInfos=[]),_.attributeInfos.push(Q.GroupAttributeMod.AttributeInfo.decode(i,i.uint32()));break;default:i.skipType(7&j)}}return _},h.AttributeInfo=function(){function i(g){if(g)for(var _=Object.keys(g),j=0;j<_.length;++j)g[_[j]]!=null&&(this[_[j]]=g[_[j]])}return i.prototype.key="",i.prototype.value="",i.encode=function(g,_){return _||(_=ta.create()),g.key!=null&&Object.hasOwnProperty.call(g,"key")&&_.uint32(10).string(g.key),g.value!=null&&Object.hasOwnProperty.call(g,"value")&&_.uint32(18).string(g.value),_},i.decode=function(g,_){g instanceof T||(g=T.create(g)),_=_===void 0?g.len:g.pos+_;for(var j=new Q.GroupAttributeMod.AttributeInfo;g.pos<_;){var $=g.uint32();switch($>>>3){case 1:j.key=g.string();break;case 2:j.value=g.string();break;default:g.skipType(7&$)}}return j},i}(),h}(),SJ=Q.GroupAttributeDel=function(){function h(i){if(this.attributes=[],i)for(var g=Object.keys(i),_=0;_<g.length;++_)i[g[_]]!=null&&(this[g[_]]=i[g[_]])}return h.prototype.seq=I.Long?I.Long.fromBits(0,0,!0):0,h.prototype.group="",h.prototype.broadcast=!1,h.prototype.attributes=I.emptyArray,h.encode=function(i,g){if(g||(g=ta.create()),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&g.uint32(8).uint64(i.seq),i.group!=null&&Object.hasOwnProperty.call(i,"group")&&g.uint32(18).string(i.group),i.broadcast!=null&&Object.hasOwnProperty.call(i,"broadcast")&&g.uint32(24).bool(i.broadcast),i.attributes!=null&&i.attributes.length)for(var _=0;_<i.attributes.length;++_)g.uint32(34).string(i.attributes[_]);return g},h.decode=function(i,g){i instanceof T||(i=T.create(i)),g=g===void 0?i.len:i.pos+g;for(var _=new Q.GroupAttributeDel;i.pos<g;){var j=i.uint32();switch(j>>>3){case 1:_.seq=i.uint64();break;case 2:_.group=i.string();break;case 3:_.broadcast=i.bool();break;case 4:_.attributes&&_.attributes.length||(_.attributes=[]),_.attributes.push(i.string());break;default:i.skipType(7&j)}}return _},h}(),TJ=Q.GroupAttributeAlt=function(){function h(i){if(this.attributeMaps=[],i)for(var g=Object.keys(i),_=0;_<g.length;++_)i[g[_]]!=null&&(this[g[_]]=i[g[_]])}return h.prototype.seq=I.Long?I.Long.fromBits(0,0,!0):0,h.prototype.group="",h.prototype.instance=I.Long?I.Long.fromBits(0,0,!0):0,h.prototype.attributeMaps=I.emptyArray,h.encode=function(i,g){if(g||(g=ta.create()),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&g.uint32(8).uint64(i.seq),i.group!=null&&Object.hasOwnProperty.call(i,"group")&&g.uint32(18).string(i.group),i.instance!=null&&Object.hasOwnProperty.call(i,"instance")&&g.uint32(24).uint64(i.instance),i.attributeMaps!=null&&i.attributeMaps.length)for(var _=0;_<i.attributeMaps.length;++_)Q.GroupAttributeAlt.AttributeMap.encode(i.attributeMaps[_],g.uint32(34).fork()).ldelim();return g},h.decode=function(i,g){i instanceof T||(i=T.create(i)),g=g===void 0?i.len:i.pos+g;for(var _=new Q.GroupAttributeAlt;i.pos<g;){var j=i.uint32();switch(j>>>3){case 1:_.seq=i.uint64();break;case 2:_.group=i.string();break;case 3:_.instance=i.uint64();break;case 4:_.attributeMaps&&_.attributeMaps.length||(_.attributeMaps=[]),_.attributeMaps.push(Q.GroupAttributeAlt.AttributeMap.decode(i,i.uint32()));break;default:i.skipType(7&j)}}return _},h.AttributeMap=function(){function i(g){if(g)for(var _=Object.keys(g),j=0;j<_.length;++j)g[_[j]]!=null&&(this[_[j]]=g[_[j]])}return i.prototype.key="",i.prototype.value="",i.prototype.origin="",i.prototype.ms=I.Long?I.Long.fromBits(0,0,!0):0,i.encode=function(g,_){return _||(_=ta.create()),g.key!=null&&Object.hasOwnProperty.call(g,"key")&&_.uint32(10).string(g.key),g.value!=null&&Object.hasOwnProperty.call(g,"value")&&_.uint32(18).string(g.value),g.origin!=null&&Object.hasOwnProperty.call(g,"origin")&&_.uint32(26).string(g.origin),g.ms!=null&&Object.hasOwnProperty.call(g,"ms")&&_.uint32(32).uint64(g.ms),_},i.decode=function(g,_){g instanceof T||(g=T.create(g)),_=_===void 0?g.len:g.pos+_;for(var j=new Q.GroupAttributeAlt.AttributeMap;g.pos<_;){var $=g.uint32();switch($>>>3){case 1:j.key=g.string();break;case 2:j.value=g.string();break;case 3:j.origin=g.string();break;case 4:j.ms=g.uint64();break;default:g.skipType(7&$)}}return j},i}(),h}(),UJ=Q.GroupAttributeRsp=function(){function h(i){if(i)for(var g=Object.keys(i),_=0;_<g.length;++_)i[g[_]]!=null&&(this[g[_]]=i[g[_]])}return h.prototype.seq=I.Long?I.Long.fromBits(0,0,!0):0,h.encode=function(i,g){return g||(g=ta.create()),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&g.uint32(8).uint64(i.seq),g},h.decode=function(i,g){i instanceof T||(i=T.create(i)),g=g===void 0?i.len:i.pos+g;for(var _=new Q.GroupAttributeRsp;i.pos<g;){var j=i.uint32();switch(j>>>3){case 1:_.seq=i.uint64();break;default:i.skipType(7&j)}}return _},h}(),VJ=Q.GroupAttributeErr=function(){function h(i){if(i)for(var g=Object.keys(i),_=0;_<g.length;++_)i[g[_]]!=null&&(this[g[_]]=i[g[_]])}return h.prototype.seq=I.Long?I.Long.fromBits(0,0,!0):0,h.prototype.code=0,h.encode=function(i,g){return g||(g=ta.create()),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&g.uint32(8).uint64(i.seq),i.code!=null&&Object.hasOwnProperty.call(i,"code")&&g.uint32(16).uint32(i.code),g},h.decode=function(i,g){i instanceof T||(i=T.create(i)),g=g===void 0?i.len:i.pos+g;for(var _=new Q.GroupAttributeErr;i.pos<g;){var j=i.uint32();switch(j>>>3){case 1:_.seq=i.uint64();break;case 2:_.code=i.uint32();break;default:i.skipType(7&j)}}return _},h}(),WJ=Q.GroupAttributeKeysGet=function(){function h(i){if(i)for(var g=Object.keys(i),_=0;_<g.length;++_)i[g[_]]!=null&&(this[g[_]]=i[g[_]])}return h.prototype.seq=I.Long?I.Long.fromBits(0,0,!0):0,h.prototype.group="",h.encode=function(i,g){return g||(g=ta.create()),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&g.uint32(8).uint64(i.seq),i.group!=null&&Object.hasOwnProperty.call(i,"group")&&g.uint32(18).string(i.group),g},h.decode=function(i,g){i instanceof T||(i=T.create(i)),g=g===void 0?i.len:i.pos+g;for(var _=new Q.GroupAttributeKeysGet;i.pos<g;){var j=i.uint32();switch(j>>>3){case 1:_.seq=i.uint64();break;case 2:_.group=i.string();break;default:i.skipType(7&j)}}return _},h}(),XJ=Q.GroupAttributeKeysRet=function(){function h(i){if(this.keys=[],i)for(var g=Object.keys(i),_=0;_<g.length;++_)i[g[_]]!=null&&(this[g[_]]=i[g[_]])}return h.prototype.seq=I.Long?I.Long.fromBits(0,0,!0):0,h.prototype.keys=I.emptyArray,h.encode=function(i,g){if(g||(g=ta.create()),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&g.uint32(8).uint64(i.seq),i.keys!=null&&i.keys.length)for(var _=0;_<i.keys.length;++_)g.uint32(18).string(i.keys[_]);return g},h.decode=function(i,g){i instanceof T||(i=T.create(i)),g=g===void 0?i.len:i.pos+g;for(var _=new Q.GroupAttributeKeysRet;i.pos<g;){var j=i.uint32();switch(j>>>3){case 1:_.seq=i.uint64();break;case 2:_.keys&&_.keys.length||(_.keys=[]),_.keys.push(i.string());break;default:i.skipType(7&j)}}return _},h}(),YJ=Q.SubscribeUserStatus=function(){function h(i){if(this.users=[],i)for(var g=Object.keys(i),_=0;_<g.length;++_)i[g[_]]!=null&&(this[g[_]]=i[g[_]])}return h.prototype.seq=I.Long?I.Long.fromBits(0,0,!0):0,h.prototype.users=I.emptyArray,h.encode=function(i,g){if(g||(g=ta.create()),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&g.uint32(8).uint64(i.seq),i.users!=null&&i.users.length)for(var _=0;_<i.users.length;++_)g.uint32(18).string(i.users[_]);return g},h.decode=function(i,g){i instanceof T||(i=T.create(i)),g=g===void 0?i.len:i.pos+g;for(var _=new Q.SubscribeUserStatus;i.pos<g;){var j=i.uint32();switch(j>>>3){case 1:_.seq=i.uint64();break;case 2:_.users&&_.users.length||(_.users=[]),_.users.push(i.string());break;default:i.skipType(7&j)}}return _},h}(),ZJ=Q.UnsubscribeUserStatus=function(){function h(i){if(this.users=[],i)for(var g=Object.keys(i),_=0;_<g.length;++_)i[g[_]]!=null&&(this[g[_]]=i[g[_]])}return h.prototype.seq=I.Long?I.Long.fromBits(0,0,!0):0,h.prototype.users=I.emptyArray,h.encode=function(i,g){if(g||(g=ta.create()),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&g.uint32(8).uint64(i.seq),i.users!=null&&i.users.length)for(var _=0;_<i.users.length;++_)g.uint32(18).string(i.users[_]);return g},h.decode=function(i,g){i instanceof T||(i=T.create(i)),g=g===void 0?i.len:i.pos+g;for(var _=new Q.UnsubscribeUserStatus;i.pos<g;){var j=i.uint32();switch(j>>>3){case 1:_.seq=i.uint64();break;case 2:_.users&&_.users.length||(_.users=[]),_.users.push(i.string());break;default:i.skipType(7&j)}}return _},h}(),$J=Q.UserJoinNotice=function(){function h(i){if(i)for(var g=Object.keys(i),_=0;_<g.length;++_)i[g[_]]!=null&&(this[g[_]]=i[g[_]])}return h.prototype.instance=I.Long?I.Long.fromBits(0,0,!0):0,h.prototype.seq=I.Long?I.Long.fromBits(0,0,!0):0,h.prototype.user="",h.encode=function(i,g){return g||(g=ta.create()),i.instance!=null&&Object.hasOwnProperty.call(i,"instance")&&g.uint32(8).uint64(i.instance),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&g.uint32(16).uint64(i.seq),i.user!=null&&Object.hasOwnProperty.call(i,"user")&&g.uint32(26).string(i.user),g},h.decode=function(i,g){i instanceof T||(i=T.create(i)),g=g===void 0?i.len:i.pos+g;for(var _=new Q.UserJoinNotice;i.pos<g;){var j=i.uint32();switch(j>>>3){case 1:_.instance=i.uint64();break;case 2:_.seq=i.uint64();break;case 3:_.user=i.string();break;default:i.skipType(7&j)}}return _},h}(),aK=Q.UserQuitNotice=function(){function h(i){if(i)for(var g=Object.keys(i),_=0;_<g.length;++_)i[g[_]]!=null&&(this[g[_]]=i[g[_]])}return h.prototype.instance=I.Long?I.Long.fromBits(0,0,!0):0,h.prototype.seq=I.Long?I.Long.fromBits(0,0,!0):0,h.prototype.user="",h.encode=function(i,g){return g||(g=ta.create()),i.instance!=null&&Object.hasOwnProperty.call(i,"instance")&&g.uint32(8).uint64(i.instance),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&g.uint32(16).uint64(i.seq),i.user!=null&&Object.hasOwnProperty.call(i,"user")&&g.uint32(26).string(i.user),g},h.decode=function(i,g){i instanceof T||(i=T.create(i)),g=g===void 0?i.len:i.pos+g;for(var _=new Q.UserQuitNotice;i.pos<g;){var j=i.uint32();switch(j>>>3){case 1:_.instance=i.uint64();break;case 2:_.seq=i.uint64();break;case 3:_.user=i.string();break;default:i.skipType(7&j)}}return _},h}(),bK=Q.UserWaitNotice=function(){function h(i){if(i)for(var g=Object.keys(i),_=0;_<g.length;++_)i[g[_]]!=null&&(this[g[_]]=i[g[_]])}return h.prototype.instance=I.Long?I.Long.fromBits(0,0,!0):0,h.prototype.seq=I.Long?I.Long.fromBits(0,0,!0):0,h.prototype.user="",h.encode=function(i,g){return g||(g=ta.create()),i.instance!=null&&Object.hasOwnProperty.call(i,"instance")&&g.uint32(8).uint64(i.instance),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&g.uint32(16).uint64(i.seq),i.user!=null&&Object.hasOwnProperty.call(i,"user")&&g.uint32(26).string(i.user),g},h.decode=function(i,g){i instanceof T||(i=T.create(i)),g=g===void 0?i.len:i.pos+g;for(var _=new Q.UserWaitNotice;i.pos<g;){var j=i.uint32();switch(j>>>3){case 1:_.instance=i.uint64();break;case 2:_.seq=i.uint64();break;case 3:_.user=i.string();break;default:i.skipType(7&j)}}return _},h}(),cK=Q.StateSubscribe=function(){function h(i){if(i)for(var g=Object.keys(i),_=0;_<g.length;++_)i[g[_]]!=null&&(this[g[_]]=i[g[_]])}return h.prototype.target="",h.prototype.subTarget="",h.prototype.sequence=I.Long?I.Long.fromBits(0,0,!0):0,h.prototype.flags=I.Long?I.Long.fromBits(0,0,!0):0,h.encode=function(i,g){return g||(g=ta.create()),i.target!=null&&Object.hasOwnProperty.call(i,"target")&&g.uint32(10).string(i.target),i.subTarget!=null&&Object.hasOwnProperty.call(i,"subTarget")&&g.uint32(18).string(i.subTarget),i.sequence!=null&&Object.hasOwnProperty.call(i,"sequence")&&g.uint32(24).uint64(i.sequence),i.flags!=null&&Object.hasOwnProperty.call(i,"flags")&&g.uint32(32).uint64(i.flags),g},h.decode=function(i,g){i instanceof T||(i=T.create(i)),g=g===void 0?i.len:i.pos+g;for(var _=new Q.StateSubscribe;i.pos<g;){var j=i.uint32();switch(j>>>3){case 1:_.target=i.string();break;case 2:_.subTarget=i.string();break;case 3:_.sequence=i.uint64();break;case 4:_.flags=i.uint64();break;default:i.skipType(7&j)}}return _},h}(),dK=Q.StateUpdate=function(){function h(i){if(i)for(var g=Object.keys(i),_=0;_<g.length;++_)i[g[_]]!=null&&(this[g[_]]=i[g[_]])}return h.prototype.target="",h.prototype.subTarget="",h.prototype.allStates="",h.prototype.flags=I.Long?I.Long.fromBits(0,0,!0):0,h.encode=function(i,g){return g||(g=ta.create()),i.target!=null&&Object.hasOwnProperty.call(i,"target")&&g.uint32(10).string(i.target),i.subTarget!=null&&Object.hasOwnProperty.call(i,"subTarget")&&g.uint32(18).string(i.subTarget),i.allStates!=null&&Object.hasOwnProperty.call(i,"allStates")&&g.uint32(26).string(i.allStates),i.flags!=null&&Object.hasOwnProperty.call(i,"flags")&&g.uint32(32).uint64(i.flags),g},h.decode=function(i,g){i instanceof T||(i=T.create(i)),g=g===void 0?i.len:i.pos+g;for(var _=new Q.StateUpdate;i.pos<g;){var j=i.uint32();switch(j>>>3){case 1:_.target=i.string();break;case 2:_.subTarget=i.string();break;case 3:_.allStates=i.string();break;case 4:_.flags=i.uint64();break;default:i.skipType(7&j)}}return _},h}(),eK=Q.StateSubscribeResult=function(){function h(i){if(i)for(var g=Object.keys(i),_=0;_<g.length;++_)i[g[_]]!=null&&(this[g[_]]=i[g[_]])}return h.prototype.target="",h.prototype.subTarget="",h.prototype.sequence=I.Long?I.Long.fromBits(0,0,!0):0,h.prototype.flags=I.Long?I.Long.fromBits(0,0,!0):0,h.prototype.code=0,h.encode=function(i,g){return g||(g=ta.create()),i.target!=null&&Object.hasOwnProperty.call(i,"target")&&g.uint32(10).string(i.target),i.subTarget!=null&&Object.hasOwnProperty.call(i,"subTarget")&&g.uint32(18).string(i.subTarget),i.sequence!=null&&Object.hasOwnProperty.call(i,"sequence")&&g.uint32(24).uint64(i.sequence),i.flags!=null&&Object.hasOwnProperty.call(i,"flags")&&g.uint32(32).uint64(i.flags),i.code!=null&&Object.hasOwnProperty.call(i,"code")&&g.uint32(40).uint32(i.code),g},h.decode=function(i,g){i instanceof T||(i=T.create(i)),g=g===void 0?i.len:i.pos+g;for(var _=new Q.StateSubscribeResult;i.pos<g;){var j=i.uint32();switch(j>>>3){case 1:_.target=i.string();break;case 2:_.subTarget=i.string();break;case 3:_.sequence=i.uint64();break;case 4:_.flags=i.uint64();break;case 5:_.code=i.uint32();break;default:i.skipType(7&j)}}return _},h}(),fK=Q.StateUnsubscribe=function(){function h(i){if(i)for(var g=Object.keys(i),_=0;_<g.length;++_)i[g[_]]!=null&&(this[g[_]]=i[g[_]])}return h.prototype.target="",h.prototype.subTarget="",h.prototype.sequence=I.Long?I.Long.fromBits(0,0,!0):0,h.prototype.flags=I.Long?I.Long.fromBits(0,0,!0):0,h.encode=function(i,g){return g||(g=ta.create()),i.target!=null&&Object.hasOwnProperty.call(i,"target")&&g.uint32(10).string(i.target),i.subTarget!=null&&Object.hasOwnProperty.call(i,"subTarget")&&g.uint32(18).string(i.subTarget),i.sequence!=null&&Object.hasOwnProperty.call(i,"sequence")&&g.uint32(24).uint64(i.sequence),i.flags!=null&&Object.hasOwnProperty.call(i,"flags")&&g.uint32(32).uint64(i.flags),g},h.decode=function(i,g){i instanceof T||(i=T.create(i)),g=g===void 0?i.len:i.pos+g;for(var _=new Q.StateUnsubscribe;i.pos<g;){var j=i.uint32();switch(j>>>3){case 1:_.target=i.string();break;case 2:_.subTarget=i.string();break;case 3:_.sequence=i.uint64();break;case 4:_.flags=i.uint64();break;default:i.skipType(7&j)}}return _},h}(),gK=Q.StateSet=function(){function h(i){if(i)for(var g=Object.keys(i),_=0;_<g.length;++_)i[g[_]]!=null&&(this[g[_]]=i[g[_]])}return h.prototype.target="",h.prototype.author="",h.prototype.value="",h.prototype.lock="",h.prototype.requestUuid="",h.prototype.sequence=I.Long?I.Long.fromBits(0,0,!0):0,h.prototype.flags=I.Long?I.Long.fromBits(0,0,!0):0,h.prototype.baseRevision=I.Long?I.Long.fromBits(0,0,!0):0,h.prototype.lockRev=I.Long?I.Long.fromBits(0,0,!0):0,h.encode=function(i,g){return g||(g=ta.create()),i.target!=null&&Object.hasOwnProperty.call(i,"target")&&g.uint32(10).string(i.target),i.author!=null&&Object.hasOwnProperty.call(i,"author")&&g.uint32(18).string(i.author),i.value!=null&&Object.hasOwnProperty.call(i,"value")&&g.uint32(26).string(i.value),i.lock!=null&&Object.hasOwnProperty.call(i,"lock")&&g.uint32(34).string(i.lock),i.requestUuid!=null&&Object.hasOwnProperty.call(i,"requestUuid")&&g.uint32(42).string(i.requestUuid),i.sequence!=null&&Object.hasOwnProperty.call(i,"sequence")&&g.uint32(48).uint64(i.sequence),i.flags!=null&&Object.hasOwnProperty.call(i,"flags")&&g.uint32(56).uint64(i.flags),i.baseRevision!=null&&Object.hasOwnProperty.call(i,"baseRevision")&&g.uint32(64).uint64(i.baseRevision),i.lockRev!=null&&Object.hasOwnProperty.call(i,"lockRev")&&g.uint32(72).uint64(i.lockRev),g},h.decode=function(i,g){i instanceof T||(i=T.create(i)),g=g===void 0?i.len:i.pos+g;for(var _=new Q.StateSet;i.pos<g;){var j=i.uint32();switch(j>>>3){case 1:_.target=i.string();break;case 2:_.author=i.string();break;case 3:_.value=i.string();break;case 4:_.lock=i.string();break;case 5:_.requestUuid=i.string();break;case 6:_.sequence=i.uint64();break;case 7:_.flags=i.uint64();break;case 8:_.baseRevision=i.uint64();break;case 9:_.lockRev=i.uint64();break;default:i.skipType(7&j)}}return _},h}(),hK=Q.StateModify=function(){function h(i){if(i)for(var g=Object.keys(i),_=0;_<g.length;++_)i[g[_]]!=null&&(this[g[_]]=i[g[_]])}return h.prototype.target="",h.prototype.author="",h.prototype.value="",h.prototype.lock="",h.prototype.requestUuid="",h.prototype.sequence=I.Long?I.Long.fromBits(0,0,!0):0,h.prototype.flags=I.Long?I.Long.fromBits(0,0,!0):0,h.prototype.baseRevision=I.Long?I.Long.fromBits(0,0,!0):0,h.prototype.lockRev=I.Long?I.Long.fromBits(0,0,!0):0,h.encode=function(i,g){return g||(g=ta.create()),i.target!=null&&Object.hasOwnProperty.call(i,"target")&&g.uint32(10).string(i.target),i.author!=null&&Object.hasOwnProperty.call(i,"author")&&g.uint32(18).string(i.author),i.value!=null&&Object.hasOwnProperty.call(i,"value")&&g.uint32(26).string(i.value),i.lock!=null&&Object.hasOwnProperty.call(i,"lock")&&g.uint32(34).string(i.lock),i.requestUuid!=null&&Object.hasOwnProperty.call(i,"requestUuid")&&g.uint32(42).string(i.requestUuid),i.sequence!=null&&Object.hasOwnProperty.call(i,"sequence")&&g.uint32(48).uint64(i.sequence),i.flags!=null&&Object.hasOwnProperty.call(i,"flags")&&g.uint32(56).uint64(i.flags),i.baseRevision!=null&&Object.hasOwnProperty.call(i,"baseRevision")&&g.uint32(64).uint64(i.baseRevision),i.lockRev!=null&&Object.hasOwnProperty.call(i,"lockRev")&&g.uint32(72).uint64(i.lockRev),g},h.decode=function(i,g){i instanceof T||(i=T.create(i)),g=g===void 0?i.len:i.pos+g;for(var _=new Q.StateModify;i.pos<g;){var j=i.uint32();switch(j>>>3){case 1:_.target=i.string();break;case 2:_.author=i.string();break;case 3:_.value=i.string();break;case 4:_.lock=i.string();break;case 5:_.requestUuid=i.string();break;case 6:_.sequence=i.uint64();break;case 7:_.flags=i.uint64();break;case 8:_.baseRevision=i.uint64();break;case 9:_.lockRev=i.uint64();break;default:i.skipType(7&j)}}return _},h}(),iK=Q.StateRequestResult=function(){function h(i){if(i)for(var g=Object.keys(i),_=0;_<g.length;++_)i[g[_]]!=null&&(this[g[_]]=i[g[_]])}return h.prototype.requestUuid="",h.prototype.sequence=I.Long?I.Long.fromBits(0,0,!0):0,h.prototype.code=0,h.encode=function(i,g){return g||(g=ta.create()),i.requestUuid!=null&&Object.hasOwnProperty.call(i,"requestUuid")&&g.uint32(10).string(i.requestUuid),i.sequence!=null&&Object.hasOwnProperty.call(i,"sequence")&&g.uint32(16).uint64(i.sequence),i.code!=null&&Object.hasOwnProperty.call(i,"code")&&g.uint32(24).uint32(i.code),g},h.decode=function(i,g){i instanceof T||(i=T.create(i)),g=g===void 0?i.len:i.pos+g;for(var _=new Q.StateRequestResult;i.pos<g;){var j=i.uint32();switch(j>>>3){case 1:_.requestUuid=i.string();break;case 2:_.sequence=i.uint64();break;case 3:_.code=i.uint32();break;default:i.skipType(7&j)}}return _},h}(),jK=Q.StateGet=function(){function h(i){if(i)for(var g=Object.keys(i),_=0;_<g.length;++_)i[g[_]]!=null&&(this[g[_]]=i[g[_]])}return h.prototype.target="",h.prototype.subTarget="",h.prototype.lock="",h.prototype.sequence=I.Long?I.Long.fromBits(0,0,!0):0,h.prototype.flags=I.Long?I.Long.fromBits(0,0,!0):0,h.prototype.lockRev=I.Long?I.Long.fromBits(0,0,!0):0,h.encode=function(i,g){return g||(g=ta.create()),i.target!=null&&Object.hasOwnProperty.call(i,"target")&&g.uint32(10).string(i.target),i.subTarget!=null&&Object.hasOwnProperty.call(i,"subTarget")&&g.uint32(18).string(i.subTarget),i.lock!=null&&Object.hasOwnProperty.call(i,"lock")&&g.uint32(26).string(i.lock),i.sequence!=null&&Object.hasOwnProperty.call(i,"sequence")&&g.uint32(32).uint64(i.sequence),i.flags!=null&&Object.hasOwnProperty.call(i,"flags")&&g.uint32(40).uint64(i.flags),i.lockRev!=null&&Object.hasOwnProperty.call(i,"lockRev")&&g.uint32(48).uint64(i.lockRev),g},h.decode=function(i,g){i instanceof T||(i=T.create(i)),g=g===void 0?i.len:i.pos+g;for(var _=new Q.StateGet;i.pos<g;){var j=i.uint32();switch(j>>>3){case 1:_.target=i.string();break;case 2:_.subTarget=i.string();break;case 3:_.lock=i.string();break;case 4:_.sequence=i.uint64();break;case 5:_.flags=i.uint64();break;case 6:_.lockRev=i.uint64();break;default:i.skipType(7&j)}}return _},h}(),kK=Q.StateGetResult=function(){function h(i){if(i)for(var g=Object.keys(i),_=0;_<g.length;++_)i[g[_]]!=null&&(this[g[_]]=i[g[_]])}return h.prototype.target="",h.prototype.subTarget="",h.prototype.allStates="",h.prototype.sequence=I.Long?I.Long.fromBits(0,0,!0):0,h.prototype.flags=I.Long?I.Long.fromBits(0,0,!0):0,h.prototype.code=0,h.encode=function(i,g){return g||(g=ta.create()),i.target!=null&&Object.hasOwnProperty.call(i,"target")&&g.uint32(10).string(i.target),i.subTarget!=null&&Object.hasOwnProperty.call(i,"subTarget")&&g.uint32(18).string(i.subTarget),i.allStates!=null&&Object.hasOwnProperty.call(i,"allStates")&&g.uint32(26).string(i.allStates),i.sequence!=null&&Object.hasOwnProperty.call(i,"sequence")&&g.uint32(32).uint64(i.sequence),i.flags!=null&&Object.hasOwnProperty.call(i,"flags")&&g.uint32(40).uint64(i.flags),i.code!=null&&Object.hasOwnProperty.call(i,"code")&&g.uint32(48).uint32(i.code),g},h.decode=function(i,g){i instanceof T||(i=T.create(i)),g=g===void 0?i.len:i.pos+g;for(var _=new Q.StateGetResult;i.pos<g;){var j=i.uint32();switch(j>>>3){case 1:_.target=i.string();break;case 2:_.subTarget=i.string();break;case 3:_.allStates=i.string();break;case 4:_.sequence=i.uint64();break;case 5:_.flags=i.uint64();break;case 6:_.code=i.uint32();break;default:i.skipType(7&j)}}return _},h}(),lK=Q.StateLockAcquire=function(){function h(i){if(i)for(var g=Object.keys(i),_=0;_<g.length;++_)i[g[_]]!=null&&(this[g[_]]=i[g[_]])}return h.prototype.target="",h.prototype.lock="",h.prototype.requestUuid="",h.prototype.flags=I.Long?I.Long.fromBits(0,0,!0):0,h.prototype.ttl=I.Long?I.Long.fromBits(0,0,!0):0,h.encode=function(i,g){return g||(g=ta.create()),i.target!=null&&Object.hasOwnProperty.call(i,"target")&&g.uint32(10).string(i.target),i.lock!=null&&Object.hasOwnProperty.call(i,"lock")&&g.uint32(18).string(i.lock),i.requestUuid!=null&&Object.hasOwnProperty.call(i,"requestUuid")&&g.uint32(26).string(i.requestUuid),i.flags!=null&&Object.hasOwnProperty.call(i,"flags")&&g.uint32(32).uint64(i.flags),i.ttl!=null&&Object.hasOwnProperty.call(i,"ttl")&&g.uint32(40).uint64(i.ttl),g},h.decode=function(i,g){i instanceof T||(i=T.create(i)),g=g===void 0?i.len:i.pos+g;for(var _=new Q.StateLockAcquire;i.pos<g;){var j=i.uint32();switch(j>>>3){case 1:_.target=i.string();break;case 2:_.lock=i.string();break;case 3:_.requestUuid=i.string();break;case 4:_.flags=i.uint64();break;case 5:_.ttl=i.uint64();break;default:i.skipType(7&j)}}return _},h}(),mK=Q.StateLockRelease=function(){function h(i){if(i)for(var g=Object.keys(i),_=0;_<g.length;++_)i[g[_]]!=null&&(this[g[_]]=i[g[_]])}return h.prototype.target="",h.prototype.lock="",h.prototype.requestUuid="",h.prototype.flags=I.Long?I.Long.fromBits(0,0,!0):0,h.encode=function(i,g){return g||(g=ta.create()),i.target!=null&&Object.hasOwnProperty.call(i,"target")&&g.uint32(10).string(i.target),i.lock!=null&&Object.hasOwnProperty.call(i,"lock")&&g.uint32(18).string(i.lock),i.requestUuid!=null&&Object.hasOwnProperty.call(i,"requestUuid")&&g.uint32(26).string(i.requestUuid),i.flags!=null&&Object.hasOwnProperty.call(i,"flags")&&g.uint32(32).uint64(i.flags),g},h.decode=function(i,g){i instanceof T||(i=T.create(i)),g=g===void 0?i.len:i.pos+g;for(var _=new Q.StateLockRelease;i.pos<g;){var j=i.uint32();switch(j>>>3){case 1:_.target=i.string();break;case 2:_.lock=i.string();break;case 3:_.requestUuid=i.string();break;case 4:_.flags=i.uint64();break;default:i.skipType(7&j)}}return _},h}(),nK=Q.StateLockAcquireResult=function(){function h(i){if(i)for(var g=Object.keys(i),_=0;_<g.length;++_)i[g[_]]!=null&&(this[g[_]]=i[g[_]])}return h.prototype.target="",h.prototype.lock="",h.prototype.requestUuid="",h.prototype.flags=I.Long?I.Long.fromBits(0,0,!0):0,h.prototype.lockRev=I.Long?I.Long.fromBits(0,0,!0):0,h.prototype.code=0,h.prototype.reason="",h.encode=function(i,g){return g||(g=ta.create()),i.target!=null&&Object.hasOwnProperty.call(i,"target")&&g.uint32(10).string(i.target),i.lock!=null&&Object.hasOwnProperty.call(i,"lock")&&g.uint32(18).string(i.lock),i.requestUuid!=null&&Object.hasOwnProperty.call(i,"requestUuid")&&g.uint32(26).string(i.requestUuid),i.flags!=null&&Object.hasOwnProperty.call(i,"flags")&&g.uint32(32).uint64(i.flags),i.lockRev!=null&&Object.hasOwnProperty.call(i,"lockRev")&&g.uint32(40).uint64(i.lockRev),i.code!=null&&Object.hasOwnProperty.call(i,"code")&&g.uint32(48).uint32(i.code),i.reason!=null&&Object.hasOwnProperty.call(i,"reason")&&g.uint32(58).string(i.reason),g},h.decode=function(i,g){i instanceof T||(i=T.create(i)),g=g===void 0?i.len:i.pos+g;for(var _=new Q.StateLockAcquireResult;i.pos<g;){var j=i.uint32();switch(j>>>3){case 1:_.target=i.string();break;case 2:_.lock=i.string();break;case 3:_.requestUuid=i.string();break;case 4:_.flags=i.uint64();break;case 5:_.lockRev=i.uint64();break;case 6:_.code=i.uint32();break;case 7:_.reason=i.string();break;default:i.skipType(7&j)}}return _},h}(),oK=Q.StateLockUpdate=function(){function h(i){if(i)for(var g=Object.keys(i),_=0;_<g.length;++_)i[g[_]]!=null&&(this[g[_]]=i[g[_]])}return h.prototype.target="",h.prototype.lock="",h.prototype.flags=I.Long?I.Long.fromBits(0,0,!0):0,h.prototype.code=0,h.encode=function(i,g){return g||(g=ta.create()),i.target!=null&&Object.hasOwnProperty.call(i,"target")&&g.uint32(10).string(i.target),i.lock!=null&&Object.hasOwnProperty.call(i,"lock")&&g.uint32(18).string(i.lock),i.flags!=null&&Object.hasOwnProperty.call(i,"flags")&&g.uint32(24).uint64(i.flags),i.code!=null&&Object.hasOwnProperty.call(i,"code")&&g.uint32(32).uint32(i.code),g},h.decode=function(i,g){i instanceof T||(i=T.create(i)),g=g===void 0?i.len:i.pos+g;for(var _=new Q.StateLockUpdate;i.pos<g;){var j=i.uint32();switch(j>>>3){case 1:_.target=i.string();break;case 2:_.lock=i.string();break;case 3:_.flags=i.uint64();break;case 4:_.code=i.uint32();break;default:i.skipType(7&j)}}return _},h}(),pK=Q.StateLockReleaseResult=function(){function h(i){if(i)for(var g=Object.keys(i),_=0;_<g.length;++_)i[g[_]]!=null&&(this[g[_]]=i[g[_]])}return h.prototype.target="",h.prototype.lock="",h.prototype.requestUuid="",h.prototype.flags=I.Long?I.Long.fromBits(0,0,!0):0,h.prototype.code=0,h.encode=function(i,g){return g||(g=ta.create()),i.target!=null&&Object.hasOwnProperty.call(i,"target")&&g.uint32(10).string(i.target),i.lock!=null&&Object.hasOwnProperty.call(i,"lock")&&g.uint32(18).string(i.lock),i.requestUuid!=null&&Object.hasOwnProperty.call(i,"requestUuid")&&g.uint32(26).string(i.requestUuid),i.flags!=null&&Object.hasOwnProperty.call(i,"flags")&&g.uint32(32).uint64(i.flags),i.code!=null&&Object.hasOwnProperty.call(i,"code")&&g.uint32(40).uint32(i.code),g},h.decode=function(i,g){i instanceof T||(i=T.create(i)),g=g===void 0?i.len:i.pos+g;for(var _=new Q.StateLockReleaseResult;i.pos<g;){var j=i.uint32();switch(j>>>3){case 1:_.target=i.string();break;case 2:_.lock=i.string();break;case 3:_.requestUuid=i.string();break;case 4:_.flags=i.uint64();break;case 5:_.code=i.uint32();break;default:i.skipType(7&j)}}return _},h}(),qK=Q.StateLockDisable=function(){function h(i){if(i)for(var g=Object.keys(i),_=0;_<g.length;++_)i[g[_]]!=null&&(this[g[_]]=i[g[_]])}return h.prototype.target="",h.prototype.lock="",h.prototype.userId="",h.prototype.requestUuid="",h.prototype.flags=I.Long?I.Long.fromBits(0,0,!0):0,h.encode=function(i,g){return g||(g=ta.create()),i.target!=null&&Object.hasOwnProperty.call(i,"target")&&g.uint32(10).string(i.target),i.lock!=null&&Object.hasOwnProperty.call(i,"lock")&&g.uint32(18).string(i.lock),i.userId!=null&&Object.hasOwnProperty.call(i,"userId")&&g.uint32(26).string(i.userId),i.requestUuid!=null&&Object.hasOwnProperty.call(i,"requestUuid")&&g.uint32(34).string(i.requestUuid),i.flags!=null&&Object.hasOwnProperty.call(i,"flags")&&g.uint32(40).uint64(i.flags),g},h.decode=function(i,g){i instanceof T||(i=T.create(i)),g=g===void 0?i.len:i.pos+g;for(var _=new Q.StateLockDisable;i.pos<g;){var j=i.uint32();switch(j>>>3){case 1:_.target=i.string();break;case 2:_.lock=i.string();break;case 3:_.userId=i.string();break;case 4:_.requestUuid=i.string();break;case 5:_.flags=i.uint64();break;default:i.skipType(7&j)}}return _},h}(),rK=Q.StateLockDisableResult=function(){function h(i){if(i)for(var g=Object.keys(i),_=0;_<g.length;++_)i[g[_]]!=null&&(this[g[_]]=i[g[_]])}return h.prototype.target="",h.prototype.lock="",h.prototype.requestUuid="",h.prototype.flags=I.Long?I.Long.fromBits(0,0,!0):0,h.prototype.code=0,h.encode=function(i,g){return g||(g=ta.create()),i.target!=null&&Object.hasOwnProperty.call(i,"target")&&g.uint32(10).string(i.target),i.lock!=null&&Object.hasOwnProperty.call(i,"lock")&&g.uint32(18).string(i.lock),i.requestUuid!=null&&Object.hasOwnProperty.call(i,"requestUuid")&&g.uint32(26).string(i.requestUuid),i.flags!=null&&Object.hasOwnProperty.call(i,"flags")&&g.uint32(32).uint64(i.flags),i.code!=null&&Object.hasOwnProperty.call(i,"code")&&g.uint32(40).uint32(i.code),g},h.decode=function(i,g){i instanceof T||(i=T.create(i)),g=g===void 0?i.len:i.pos+g;for(var _=new Q.StateLockDisableResult;i.pos<g;){var j=i.uint32();switch(j>>>3){case 1:_.target=i.string();break;case 2:_.lock=i.string();break;case 3:_.requestUuid=i.string();break;case 4:_.flags=i.uint64();break;case 5:_.code=i.uint32();break;default:i.skipType(7&j)}}return _},h}(),sK=Q.SubscribeResponse=function(){function h(i){if(this.errors=[],i)for(var g=Object.keys(i),_=0;_<g.length;++_)i[g[_]]!=null&&(this[g[_]]=i[g[_]])}return h.prototype.seq=I.Long?I.Long.fromBits(0,0,!0):0,h.prototype.errors=I.emptyArray,h.encode=function(i,g){if(g||(g=ta.create()),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&g.uint32(8).uint64(i.seq),i.errors!=null&&i.errors.length)for(var _=0;_<i.errors.length;++_)Q.SubscribeResponse.SubscribeErrorsType.encode(i.errors[_],g.uint32(18).fork()).ldelim();return g},h.decode=function(i,g){i instanceof T||(i=T.create(i)),g=g===void 0?i.len:i.pos+g;for(var _=new Q.SubscribeResponse;i.pos<g;){var j=i.uint32();switch(j>>>3){case 1:_.seq=i.uint64();break;case 2:_.errors&&_.errors.length||(_.errors=[]),_.errors.push(Q.SubscribeResponse.SubscribeErrorsType.decode(i,i.uint32()));break;default:i.skipType(7&j)}}return _},h.SubscribeErrorsType=function(){function i(g){if(g)for(var _=Object.keys(g),j=0;j<_.length;++j)g[_[j]]!=null&&(this[_[j]]=g[_[j]])}return i.prototype.account="",i.prototype.code=0,i.encode=function(g,_){return _||(_=ta.create()),g.account!=null&&Object.hasOwnProperty.call(g,"account")&&_.uint32(10).string(g.account),g.code!=null&&Object.hasOwnProperty.call(g,"code")&&_.uint32(16).uint32(g.code),_},i.decode=function(g,_){g instanceof T||(g=T.create(g)),_=_===void 0?g.len:g.pos+_;for(var j=new Q.SubscribeResponse.SubscribeErrorsType;g.pos<_;){var $=g.uint32();switch($>>>3){case 1:j.account=g.string();break;case 2:j.code=g.uint32();break;default:g.skipType(7&$)}}return j},i}(),h}(),tK=Object.freeze({__proto__:null,URI:kJ,Wrapper:gl,Ping:lJ,Pong:mJ,UserJoin:nJ,UserResp:oJ,UserQuit:pJ,UserDrop:qJ,UserTicketNearlyExpire:rJ,UserRenewTokenReq:sJ,UserRenewTokenResp:tJ,GroupEnter:uJ,GroupLeave:vJ,GroupReply:wJ,GroupLeaveNotice:ax,GroupEnterNotice:bx,Message:cx,Ack:dx,GroupDrop:xJ,GroupAllUsersList:yJ,GroupAllUsersResult:zJ,UserStatusList:AJ,UserStatusResult:BJ,UserAttributeGet:CJ,UserAttributeRet:DJ,UserAttributeSet:EJ,UserAttributeMod:FJ,UserAttributeDel:GJ,UserAttributeErr:HJ,UserAttributeKeysGet:IJ,UserAttributeKeysRet:JJ,UserAttributeRsp:KJ,GroupStatusList:LJ,GroupStatusResult:MJ,GroupCountNotice:NJ,GroupAttributeGet:OJ,GroupAttributeRet:PJ,GroupAttributeSet:QJ,GroupAttributeMod:RJ,GroupAttributeDel:SJ,GroupAttributeAlt:TJ,GroupAttributeRsp:UJ,GroupAttributeErr:VJ,GroupAttributeKeysGet:WJ,GroupAttributeKeysRet:XJ,SubscribeUserStatus:YJ,UnsubscribeUserStatus:ZJ,UserJoinNotice:$J,UserQuitNotice:aK,UserWaitNotice:bK,StateSubscribe:cK,StateUpdate:dK,StateSubscribeResult:eK,StateUnsubscribe:fK,StateSet:gK,StateModify:hK,StateRequestResult:iK,StateGet:jK,StateGetResult:kK,StateLockAcquire:lK,StateLockRelease:mK,StateLockAcquireResult:nK,StateLockUpdate:oK,StateLockReleaseResult:pK,StateLockDisable:qK,StateLockDisableResult:rK,SubscribeResponse:sK,default:Q}),uK=Math.ceil,ex=function(h){return function(i,g,_){var j=(i=String(Ec(i))).length;return _=_===void 0?" ":String(_),(g=xb(g))<=j||_==""?i:(g-=j,(j=At.call(_,uK(g/_.length))).length>g&&(j=j.slice(0,g)),h?i+j:j+i)}},vK=ex(!1),wK=ex(!0),fx=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(lh);wa({target:"String",proto:!0,forced:fx},{padEnd:function(h){return wK(this,h,1<arguments.length?arguments[1]:void 0)}}),wa({target:"Object",stat:!0},{entries:function(h){return BF(h)}});var xK=pd.f,gx="".endsWith,yK=Math.min,hx=no("endsWith"),zK=!hx&&!!function(){var h=xK(String.prototype,"endsWith");return h&&!h.writable}();wa({target:"String",proto:!0,forced:!zK&&!hx},{endsWith:function(h){var i=String(Ec(this));mo(h);var g=1<arguments.length?arguments[1]:void 0,_=xb(i.length);return g=g===void 0?_:yK(xb(g),_),_=String(h),gx?gx.call(i,_,g):i.slice(g-_.length,g)===_}}),jk("match",1,function(h,i,g){return[function(_){var j=Ec(this),$=_==null?void 0:_[h];return $!==void 0?$.call(_,j):new RegExp(_)[h](String(j))},function(_){var j=g(i,_,this);if(j.done)return j.value;if(_=ub(_),j=String(this),!_.global)return mh(_,j);var $=_.unicode;_.lastIndex=0;for(var _n,_i=[],_s=0;(_n=mh(_,j))!==null;)_n=String(_n[0]),_i[_s]=_n,_n===""&&(_.lastIndex=hn(j,xb(_.lastIndex),$)),_s++;return _s===0?null:_i}]});var AK=pd.f,ix="".startsWith,BK=Math.min,jx=no("startsWith"),CK=!jx&&!!function(){var h=AK(String.prototype,"startsWith");return h&&!h.writable}();wa({target:"String",proto:!0,forced:!CK&&!jx},{startsWith:function(h){var i=String(Ec(this));mo(h);var g=xb(BK(1<arguments.length?arguments[1]:void 0,i.length)),_=String(h);return ix?ix.call(i,_,g):i.slice(g,g+_.length)===_}});var us=function(h){var i=/(%?)(%([jds]))/g,g=Array.prototype.slice.call(arguments,1);return g.length&&(h=h.replace(i,function(_,j,$,_n){switch($=g.shift(),_n){case"s":$=""+$;break;case"d":$=Number($);break;case"j":$=JSON.stringify($)}return j?(g.unshift($),_):$})),g.length&&(h+=" "+g.join(" ")),""+(h=h.replace(/%{2,2}/g,"%"))},DK=/\s/,EK=/^\s+/,kx=NaN,FK=/^[-+]0x[0-9a-f]+$/i,GK=/^0b[01]+$/i,HK=/^0o[0-7]+$/i,IK=parseInt,hl=function(h){if(typeof h=="number")return h;if(Sg(h))return kx;if(Kc(h)&&(h=typeof h.valueOf=="function"?h.valueOf():h,h=Kc(h)?h+"":h),typeof h!="string")return h===0?h:+h;if(h){for(var i=h.slice,g=h.length;g--&&DK.test(h.charAt(g)););h=i.call(h,0,g+1).replace(EK,"")}return(i=GK.test(h))||HK.test(h)?IK(h.slice(2),i?2:8):FK.test(h)?kx:+h},JK=Math.max,KK=Math.min,LK=function(h,i,g){function _(Dl){var Ul=_s,Kl=ga;return _s=ga=void 0,Tl=Dl,ba=h.apply(Kl,Ul)}function j(Dl){var Ul=Dl-El;return Dl-=Tl,El===void 0||Ul>=i||0>Ul||Il&&Dl>=Nl}function $(){var Dl=hd.Date.now();if(j(Dl))return _n(Dl);var Ul=setTimeout,Kl=Dl-Tl;Dl=i-(Dl-El),Kl=Il?KK(Dl,Nl-Kl):Dl,xa=Ul($,Kl)}function _n(Dl){return xa=void 0,Cl&&_s?_(Dl):(_s=ga=void 0,ba)}function _i(){var Dl=hd.Date.now(),Ul=j(Dl);if(_s=arguments,ga=this,El=Dl,Ul){if(xa===void 0)return Tl=Dl=El,xa=setTimeout($,i),Sl?_(Dl):ba;if(Il)return clearTimeout(xa),xa=setTimeout($,i),_(El)}return xa===void 0&&(xa=setTimeout($,i)),ba}var _s,ga,ba,xa,El,Tl=0,Sl=!1,Il=!1,Cl=!0;if(typeof h!="function")throw new TypeError("Expected a function");if(i=hl(i)||0,Kc(g)){Sl=!!g.leading;var Nl=(Il="maxWait"in g)?JK(hl(g.maxWait)||0,i):Nl;Cl="trailing"in g?!!g.trailing:Cl}return _i.cancel=function(){xa!==void 0&&clearTimeout(xa),Tl=0,_s=El=ga=xa=void 0},_i.flush=function(){return xa===void 0?ba:_n(hd.Date.now())},_i},vb;(function(h){h[h.ChannelSMsg=1]="ChannelSMsg",h[h.ChannelRMsg=2]="ChannelRMsg",h[h.P2pSMsgOfflineFlag=3]="P2pSMsgOfflineFlag",h[h.P2pRMsgOfflineFlag=4]="P2pRMsgOfflineFlag",h[h.P2pSMsgNoOfflineFlag=5]="P2pSMsgNoOfflineFlag",h[h.P2pRMsgNoOfflineFlag=6]="P2pRMsgNoOfflineFlag",h[h.P2pCallInvitation=7]="P2pCallInvitation",h[h.P2pCallCancellation=8]="P2pCallCancellation",h[h.P2pCallAcceptance=9]="P2pCallAcceptance",h[h.P2pCallRefusal=10]="P2pCallRefusal"})(vb||(vb={}));var Xe=function(h){function i(_,j){return ab(this,i),E(L(_=g.call(this,ts(_,j))),"originalError",void 0),E(L(_),"code",void 0),E(L(_),"serverCode",void 0),typeof j=="number"?_.code=j:typeof j=="string"?_.name=j:j!==void 0&&(j.originalError&&(_.originalError=j.originalError),j.code!==void 0&&(_.code=j.code),j.serverCode!==void 0&&(_.serverCode=j.serverCode)),_}nb(i,h);var g=ob(i);return i}(di(Error)),Ib=function(h){function i(_,j){return ab(this,i),E(L(_=g.call(this,ts(_,j))),"name","RtmInternalError"),E(L(_),"code",void 0),_.code=j,_}nb(i,h);var g=ob(i);return i}(di(Error)),il=function(){return function(h){function i(_){ab(this,i);var j=Object.keys(_);return g.call(this,_[j[0]],j[0])}nb(i,h);var g=ob(i);return i}(Ib)},rb=il(),Pc=function(h){function i(){ab(this,i);for(var _=arguments.length,j=Array(_),$=0;$<_;$++)j[$]=arguments[$];return E(L(_=g.call.apply(g,[this].concat(j))),"name","RtmTimeoutError"),_}nb(i,h);var g=ob(i);return i}(Xe),ja=function(h){function i(){ab(this,i);for(var _=arguments.length,j=Array(_),$=0;$<_;$++)j[$]=arguments[$];return E(L(_=g.call.apply(g,[this].concat(j))),"name","RtmInvalidArgumentError"),_}nb(i,h);var g=ob(i);return i}(Xe),ia=function(h){function i(){ab(this,i);for(var _=arguments.length,j=Array(_),$=0;$<_;$++)j[$]=arguments[$];return E(L(_=g.call.apply(g,[this].concat(j))),"name","RtmInvalidStatusError"),_}nb(i,h);var g=ob(i);return i}(Xe),Dc=function(h){function i(){ab(this,i);for(var _=arguments.length,j=Array(_),$=0;$<_;$++)j[$]=arguments[$];return E(L(_=g.call.apply(g,[this].concat(j))),"name","RtmLimitExceededError"),_}nb(i,h);var g=ob(i);return i}(Xe),Fc=function(h){function i(){ab(this,i);for(var _=arguments.length,j=Array(_),$=0;$<_;$++)j[$]=arguments[$];return E(L(_=g.call.apply(g,[this].concat(j))),"name","RtmInvokeTooOftenError"),_}nb(i,h);var g=ob(i);return i}(Xe),Pa=function(h){function i(){ab(this,i);for(var _=arguments.length,j=Array(_),$=0;$<_;$++)j[$]=arguments[$];return E(L(_=g.call.apply(g,[this].concat(j))),"name","RtmUnavailableError"),E(L(_),"serverCode",void 0),E(L(_),"statusCode",void 0),_}nb(i,h);var g=ob(i);return i}(Xe),Gh=function(h){function i(){ab(this,i);for(var _=arguments.length,j=Array(_),$=0;$<_;$++)j[$]=arguments[$];return E(L(_=g.call.apply(g,[this].concat(j))),"name","RtmUnauthenticatedError"),E(L(_),"serverCode",void 0),_}nb(i,h);var g=ob(i);return i}(Xe),id=function(h){function i(){ab(this,i);for(var _=arguments.length,j=Array(_),$=0;$<_;$++)j[$]=arguments[$];return E(L(_=g.call.apply(g,[this].concat(j))),"name","RtmUnknownError"),_}nb(i,h);var g=ob(i);return i}(Xe),uc=function(h){return h instanceof Pc||h instanceof ad},Sa=function(h){return h instanceof Xe},vg=function(h,i,g){return['Executing "%s.%s" timed out after %ds',h,i,g/1e3]},ss=new Map,MK=function(){var h=new Date;return"".concat(h.toISOString().split("T")[1].replace(/\..+/,""),".").concat(h.getMilliseconds())},vi=Object.keys,Vj=Object.entries.bind(Object),Sj=function(h){return typeof h=="string"?h.endsWith(".")?h:"".concat(h,"."):h},NK=Ga(function(){return new Date(NaN).toJSON()!==null||Date.prototype.toJSON.call({toISOString:function(){return 1}})!==1});wa({target:"Date",proto:!0,forced:NK},{toJSON:function(h){h=Zb(this);var i=le(h);return typeof i!="number"||isFinite(i)?h.toISOString():null}}),wa({target:"URL",proto:!0,enumerable:!0},{toJSON:function(){return URL.prototype.toString.call(this)}});var rC=Object.prototype.hasOwnProperty,lx=function(h,i,g){return JSON.stringify(As(h),i,g)};lx.ensureProperties=As;var OK=function(h,i){i=i||{};var g=Ia(h);if(g==="string"&&0<h.length)return sC(h);if(g==="number"&&isFinite(h))return i.long?h=864e5<=(i=Math.abs(h))?Xj(h,i,864e5,"day"):36e5<=i?Xj(h,i,36e5,"hour"):6e4<=i?Xj(h,i,6e4,"minute"):1e3<=i?Xj(h,i,1e3,"second"):h+" ms":h=864e5<=(i=Math.abs(h))?Math.round(h/864e5)+"d":36e5<=i?Math.round(h/36e5)+"h":6e4<=i?Math.round(h/6e4)+"m":1e3<=i?Math.round(h/1e3)+"s":h+"ms",h;throw Error("val is not a non-empty string or a valid number. val="+JSON.stringify(h))},PK=function(h){function i(j){function $(){for(var _s=arguments.length,ga=Array(_s),ba=0;ba<_s;ba++)ga[ba]=arguments[ba];if($.enabled){_s=Number(new Date),$.diff=_s-(_n||_s),$.prev=_n,_n=$.curr=_s,ga[0]=i.coerce(ga[0]),typeof ga[0]!="string"&&ga.unshift("%O");var xa=0;ga[0]=ga[0].replace(/%([a-zA-Z%])/g,function(El,Tl){return El==="%%"?"%":(xa++,typeof(Tl=i.formatters[Tl])=="function"&&(El=Tl.call($,ga[xa]),ga.splice(xa,1),xa--),El)}),i.formatArgs.call($,ga),($.log||i.log).apply($,ga)}}var _n,_i=null;return $.namespace=j,$.useColors=i.useColors(),$.color=i.selectColor(j),$.extend=g,$.destroy=i.destroy,Object.defineProperty($,"enabled",{enumerable:!0,configurable:!1,get:function(){return _i===null?i.enabled(j):_i},set:function(_s){_i=_s}}),typeof i.init=="function"&&i.init($),$}function g(j,$){return(j=i(this.namespace+($===void 0?":":$)+j)).log=this.log,j}function _(j){return j.toString().substring(2,j.toString().length-2).replace(/\.\*\?$/,"*")}return i.debug=i,i.default=i,i.coerce=function(j){return j instanceof Error?j.stack||j.message:j},i.disable=function(){var j=[].concat(ra(i.names.map(_)),ra(i.skips.map(_).map(function($){return"-"+$}))).join(",");return i.enable(""),j},i.enable=function(j){i.save(j),i.names=[],i.skips=[];var $,_n=(typeof j=="string"?j:"").split(/[\s,]+/),_i=_n.length;for($=0;$<_i;$++)_n[$]&&((j=_n[$].replace(/\*/g,".*?"))[0]==="-"?i.skips.push(new RegExp("^"+j.substr(1)+"$")):i.names.push(new RegExp("^"+j+"$")))},i.enabled=function(j){if(j[j.length-1]==="*")return!0;var $,_n=0;for($=i.skips.length;_n<$;_n++)if(i.skips[_n].test(j))return!1;for(_n=0,$=i.names.length;_n<$;_n++)if(i.names[_n].test(j))return!0;return!1},i.humanize=OK,i.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(h).forEach(function(j){i[j]=h[j]}),i.names=[],i.skips=[],i.formatters={},i.selectColor=function(j){for(var $=0,_n=0;_n<j.length;_n++)$=($<<5)-$+j.charCodeAt(_n),$|=0;return i.colors[Math.abs($)%i.colors.length]},i.enable(i.load()),i},mx=kc(function(h,i){i.formatArgs=function(j){if(j[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+j[0]+(this.useColors?"%c ":" ")+"+"+h.exports.humanize(this.diff),this.useColors){var $="color: "+this.color;j.splice(1,0,$,"color: inherit");var _n=0,_i=0;j[0].replace(/%[a-zA-Z%]/g,function(_s){_s!=="%%"&&(_n++,_s==="%c"&&(_i=_n))}),j.splice(_i,0,$)}},i.save=function(j){try{j?i.storage.setItem("debug",j):i.storage.removeItem("debug")}catch{}},i.load=function(){try{var j=i.storage.getItem("debug")}catch{}return!j&&typeof process<"u"&&"env"in process&&(j={}.DEBUG),j},i.useColors=function(){return!(typeof window>"u"||!window.process||window.process.type!=="renderer"&&!window.process.__nwjs)||(typeof navigator>"u"||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&(typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))};e:{try{var g=localStorage;break e}catch{}g=void 0}var _;i.storage=g,i.destroy=(_=!1,function(){_||(_=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}),i.colors="#0000CC #0000FF #0033CC #0033FF #0066CC #0066FF #0099CC #0099FF #00CC00 #00CC33 #00CC66 #00CC99 #00CCCC #00CCFF #3300CC #3300FF #3333CC #3333FF #3366CC #3366FF #3399CC #3399FF #33CC00 #33CC33 #33CC66 #33CC99 #33CCCC #33CCFF #6600CC #6600FF #6633CC #6633FF #66CC00 #66CC33 #9900CC #9900FF #9933CC #9933FF #99CC00 #99CC33 #CC0000 #CC0033 #CC0066 #CC0099 #CC00CC #CC00FF #CC3300 #CC3333 #CC3366 #CC3399 #CC33CC #CC33FF #CC6600 #CC6633 #CC9900 #CC9933 #CCCC00 #CCCC33 #FF0000 #FF0033 #FF0066 #FF0099 #FF00CC #FF00FF #FF3300 #FF3333 #FF3366 #FF3399 #FF33CC #FF33FF #FF6600 #FF6633 #FF9900 #FF9933 #FFCC00 #FFCC33".split(" "),i.log=console.debug||console.log||function(){},h.exports=PK(i),h.exports.formatters.j=function(j){try{return JSON.stringify(j)}catch($){return"[UnexpectedJSONParseError]: "+$.message}}}),nx=mx("RTM:DEBUG"),Hh;nx.enabled=!1,function(h){h[h.Uploading=0]="Uploading",h[h.Free=1]="Free"}(Hh||(Hh={}));var QK=function(){function h(i){ab(this,h),E(this,"uploadRequest",void 0),E(this,"uploadState",void 0),E(this,"uploadResendCount",void 0),E(this,"LogCache",void 0),E(this,"LogsToPost",void 0),E(this,"processId",void 0),E(this,"sdkVersion",void 0),E(this,"logId",void 0),E(this,"rtmConfig",void 0),this.processId=i.processId,this.sdkVersion=i.sdkVersion,this.rtmConfig=i.rtmConfig,this.uploadRequest=i.uploadRequest,this.uploadState=Hh.Free,this.uploadResendCount=0,this.LogCache=[],this.LogsToPost=[],this.logId=0}return Qb(h,[{key:"upload",value:function(i){this.LogCache.push(i),this.uploadState===Hh.Free&&(this.LogsToPost=40>this.LogCache.length?this.LogCache.splice(0,this.LogCache.length):this.LogCache.splice(0,40),this.postLog(this.LogsToPost))}},{key:"postLog",value:function(i){var g=this;this.uploadState=Hh.Uploading,setTimeout(za(W.mark(function _(){var j,$,_n;return W.wrap(function(_i){for(;;)switch(_i.prev=_i.next){case 0:return j={sdk_version:g.sdkVersion,process_id:g.processId,payload:JSON.stringify(i)},_i.prev=1,_i.next=4,g.uploadRequest(j,($=g.rtmConfig.enableCloudProxy)!==null&&$!==void 0&&$);case 4:if(!Bm){_i.next=6;break}throw Error("RTM is busy");case 6:_i.next=13;break;case 8:return _i.prev=8,_i.t0=_i.catch(1),_n=2>g.uploadResendCount++?2e3:1e4,setTimeout(function(){return g.postLog(g.LogsToPost)},_n),_i.abrupt("return");case 13:if(nx('The logs uploaded for "process-'.concat(hj,'"')),g.LogCache.length!==0){_i.next=17;break}return g.uploadState=Hh.Free,_i.abrupt("return");case 17:g.uploadResendCount=0,g.LogsToPost=40>g.LogCache.length?g.LogCache.splice(0,g.LogCache.length):g.LogCache.splice(0,40),g.postLog(g.LogsToPost);case 20:case"end":return _i.stop()}},_,null,[[1,8]])})),wg.getParameter("LOG_UPLOAD_INTERVAL"))}}]),h}(),ox=function(h,i,g,_,j,$,_n,_i){var _s=0;for(_n=!!_n&&tf(_n,_i,3);_s<_;){if(_s in g){if(_i=_n?_n(g[_s],_s,i):g[_s],0<$&&uf(_i))j=ox(h,i,_i,xb(_i.length),j,$-1)-1;else{if(9007199254740991<=j)throw TypeError("Exceed the acceptable array length");h[j]=_i}j++}_s++}return j},px=ox;wa({target:"Array",proto:!0},{flat:function(){var h=arguments.length?arguments[0]:void 0,i=Zb(this),g=xb(i.length),_=Ei(i,0);return _.length=px(_,i,i,g,0,h===void 0?1:Rd(h)),_}});var RK=["CODE"],jd,Gf,oa;(function(h){h.CHINA="CN",h.ASIA="AS",h.NORTH_AMERICA="NA",h.EUROPE="EU",h.JAPAN="JP",h.INDIA="IN",h.OCEANIA="OC",h.SOUTH_AMERICA="SA",h.AFRICA="AF",h.OVERSEA="OVERSEA",h.GLOBAL="GLOBAL"})(oa||(oa={}));var SK={CN:oa.CHINA,NA:oa.NORTH_AMERICA,EU:oa.EUROPE,AS:oa.ASIA,JP:oa.JAPAN,IN:oa.INDIA,GLOB:oa.GLOBAL,AF:oa.AFRICA,OC:oa.OVERSEA,OVS:oa.OVERSEA,SA:oa.SOUTH_AMERICA},Yj=ys((jd={},E(jd,oa.ASIA,{CODE:oa.ASIA,AP_DOMAINS:["ap-web-1-asia.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-asia.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_AP:["proxy-ap-web-asia.agora.io"],PROXY_NGINX:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]}),E(jd,oa.NORTH_AMERICA,{CODE:oa.NORTH_AMERICA,AP_DOMAINS:["ap-web-1-north-america.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-north-america.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_AP:["proxy-ap-web-america.agora.io"],PROXY_NGINX:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]}),E(jd,oa.EUROPE,{CODE:oa.EUROPE,AP_DOMAINS:["ap-web-1-europe.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-europe.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_AP:["proxy-ap-web-europe.agora.io"],PROXY_NGINX:["europe.webrtc-cloud-proxy.sd-rtn.com"]}),E(jd,oa.JAPAN,{CODE:oa.JAPAN,AP_DOMAINS:["ap-web-1-japan.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-japan.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_AP:["proxy-ap-web-japan.agora.io"],PROXY_NGINX:["japan.webrtc-cloud-proxy.sd-rtn.com"]}),E(jd,oa.INDIA,{CODE:oa.INDIA,AP_DOMAINS:["ap-web-1-india.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-india.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_AP:["proxy-ap-web-india.agora.io"],PROXY_NGINX:["india.webrtc-cloud-proxy.sd-rtn.com"]}),E(jd,oa.OVERSEA,{CODE:oa.OVERSEA,AP_DOMAINS:["ap-web-1-oversea.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_AP:["proxy-ap-web-oversea.agora.io"],PROXY_NGINX:["webrtc-cloud-proxy.agora.io"]}),E(jd,oa.GLOBAL,{CODE:oa.GLOBAL,AP_DOMAINS:["ap-web-1.agora.io","ap-web-2.agora.io"],AP_BACKUP_DOMAINS:["ap-web-3.agora.io","ap-web-4.agora.io"],EVENT_REPORT_DOMAIN:["webcollector-rtm.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["webcollector-1.agora.io"],LOG_UPLOAD_SERVER:["logservice-rtm.agora.io"],PROXY_AP:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],PROXY_NGINX:["webrtc-cloud-proxy.sd-rtn.com"]}),E(jd,oa.OCEANIA,{CODE:oa.OCEANIA,AP_DOMAINS:["ap-web-1-oceania.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-oceania.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_AP:["proxy-ap-web-oceania.agora.io"],PROXY_NGINX:["oceania.webrtc-cloud-proxy.sd-rtn.com"]}),E(jd,oa.SOUTH_AMERICA,{CODE:oa.SOUTH_AMERICA,AP_DOMAINS:["ap-web-1-south-america.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-south-america.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_AP:["proxy-ap-web-south-america.agora.io"],PROXY_NGINX:["south-america.webrtc-cloud-proxy.sd-rtn.com"]}),E(jd,oa.AFRICA,{CODE:oa.AFRICA,AP_DOMAINS:["ap-web-1-africa.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-africa.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_AP:["proxy-ap-web-africa.agora.io"],PROXY_NGINX:["africa.webrtc-cloud-proxy.sd-rtn.com"]}),E(jd,oa.CHINA,{CODE:oa.CHINA,AP_DOMAINS:["webrtc2-2.ap.sd-rtn.com"],AP_BACKUP_DOMAINS:["webrtc2-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_AP:["proxy-ap-web.agoraio.cn"],PROXY_NGINX:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]}),jd)),wi=(Gf={},E(Gf,oa.ASIA,[oa.CHINA,oa.JAPAN,oa.INDIA]),E(Gf,oa.EUROPE,[]),E(Gf,oa.NORTH_AMERICA,[]),E(Gf,oa.SOUTH_AMERICA,[]),E(Gf,oa.OCEANIA,[]),E(Gf,oa.AFRICA,[]),Gf),qx=[oa.OVERSEA,oa.GLOBAL,oa.CHINA,oa.NORTH_AMERICA,oa.EUROPE,oa.ASIA,oa.JAPAN,oa.INDIA,oa.OCEANIA,oa.SOUTH_AMERICA,oa.AFRICA],Bs=function(h){return Object.values(wi).flat().includes(h)},uC=function(h){var i;return(i=Vj(wi).find(function(g){return(g=Lb(g,2))[0],g[1].includes(h)}))===null||i===void 0?void 0:i[0]},TK=function(h){return h.sort(function(i,g){return qx.indexOf(i)-qx.indexOf(g)})},eh=function(h){var i=new Set;if((h=TK(h).slice(0,3).map(function(g){var _=Yj[g];if(_===void 0)throw new Ib("invalid area key");return g=_.CODE,_=em(_,RK),i.add(g),_})).length===0)throw new Ib("areas cannot be empty");return tb({CODES:i},h.reduce(function(g,_){for(var j=0,$=Vj(g);j<$.length;j++){var _n=Lb($[j],2),_i=_n[0];_n=_n[1],g[_i]=Array.from(new Set([].concat(ra(_[_i]),ra(_n))))}return g}))},Ba,rx=function(){var h=za(W.mark(function i(g,_){var j,$,_n,_i,_s,ga=arguments;return W.wrap(function(ba){for(;;)switch(ba.prev=ba.next){case 0:if(!(2<($=2<ga.length&&ga[2]!==void 0?ga[2]:0))){ba.next=3;break}return ba.abrupt("return");case 3:return _n={withCredentials:!0,body:g,timeout:2e4},_i=0<$?(Ba==null?void 0:Ba.LOG_UPLOAD_SERVER[0])||"rtm.logservice.sd-rtn.com":(Ba==null?void 0:Ba.LOG_UPLOAD_SERVER[0])||"logservice-rtm.agora.io",_s=_?"https://".concat((j=Ba==null?void 0:Ba.PROXY_NGINX[0])!==null&&j!==void 0?j:"webrtc-cloud-proxy.sd-rtn.com","/ls/?h=").concat(_i,"&p=443&d=upload/v1"):"https://".concat(_i,"/upload/v1"),ba.next=8,Tj(_s,_n).catch(function(xa){return rx(g,_,$+1)});case 8:case"end":return ba.stop()}},i)}));return function(i,g){return h.apply(this,arguments)}}(),sx=new QK({processId:"process-".concat(hj),sdkVersion:"Agora_RTM_SDK_for_Web_".concat("v1.5.1-67-g0f6d3600"),uploadRequest:rx,rtmConfig:{}}),pp="text payload rawMessage thumbnail attributeInfos keys value extra".split(" "),tx="account ticket uid detail token account fileName cname user group key origin users src dst lastUpdateUserId channel cert wan_ip".split(" "),ux=["serverReceivedTs","hasPeerReceived","messageType","enableNotificationToChannelMembers","lastUpdateTs"],UK="ChannelMessage MemberLeft MessageFromPeer LocalInvitationRefused LocalInvitationAccepted RemoteInvitationCanceled PeersOnlineStatusChanged AttributesUpdated MemberJoined".split(" "),fh=function(h){if(typeof h=="string")return wb(h);if(Array.isArray(h)&&h.every(function($){return typeof $=="string"}))return h.map(function($){return wb($)});if(!or(h)){for(var i={},g=0;g<ux.length;g++){var _=ux[g];_ in h&&(i[_]=h[_])}if(0<Object.keys(i).length)return i;if(5>Object.keys(h).length){for(g=0,h=Object.entries(h);g<h.length;g++){var j=Lb(h[g],2);_=j[0],j=j[1],pp.includes(_)?i[_]="[Hidden Info]":i[wb(_)]=typeof j=="string"?wb(j):"[Sensitive Info]"}return i}return"[Sensitive Info]"}return h},vx=function(h){return Ia(h)==="object"?Lg(h)?xs(Pg(h,5),pp,tx):h.constructor&&h.constructor.name:h},wx=function(h,i){return h instanceof Error?h.message:typeof h!="string"?JSON.stringify(xs(Pg(h,5),pp,tx)):(i=i.map(function(g){return g instanceof Error?g.message:Ia(g)==="object"?lx(Array.isArray(g)?g.map(vx):vx(g)):g}),us.apply(void 0,[h.replace(/%[%Oo]/g,function(g){return g==="%%"?"%":g==="%o"||g==="%O"?"%s":g})].concat(ra(i))))},VK=1,xx=function(h,i,g){var _=mx(h);return _.enabled=!0,_.log=g,_.useColors=!1,function(j){for(var $=arguments.length,_n=Array(1<$?$-1:0),_i=1;_i<$;_i++)_n[_i-1]=arguments[_i];if(i.enableLogUpload){$=Sj(j);var _s=wx($,_n);sx.upload({log_item_id:"".concat(VK++),log_level:h,payload_str:"[".concat(MK(),"] ").concat(h," - ").concat(256<_s.length?_s.slice(0,256):_s)})}switch($=function(ga){var ba=_s||wx(Sj(j),_n),xa=Yd.LOG_HANDLER;typeof xa=="function"&&xa({level:ga,message:ba}),_(ba)},h){case"RTM:INFO":i.logFilter.info&&$("log");break;case"RTM:WARN":i.logFilter.warn&&$("warning");break;case"RTM:ERROR":i.logFilter.error&&$("error");break;case"RTM:TRACK":i.logFilter.track&&$("log");break;case"RTM:MSG:RECV":case"RTM:MSG:SEND":i.logFilter.debug&&$("debug");break;case"RTM:DEBUG":i.logFilter.debug&&$("debug")}}},qp,yx=function(h){return function(i){var g=qp===1||h===void 0?"":"Ins#".concat(h," ");return"".concat(g).concat(i)}},rp=function(h,i,g){var _=yx(qp);return xx("RTM:".concat(i),g,function(j){return h(_(j))})},Dd=function(){return function(h){function i(_,j){var $=2<arguments.length&&arguments[2]!==void 0&&arguments[2];ab(this,i);var _n=g.call(this);if(E(L(_n),"logError",void 0),E(L(_n),"invokeTracker",void 0),E(L(_n),"resultTracker",void 0),E(L(_n),"errorTracker",void 0),E(L(_n),"eventTracker",void 0),E(L(_n),"info",void 0),E(L(_n),"warn",void 0),E(L(_n),"log",void 0),E(L(_n),"genLogger",void 0),E(L(_n),"loggerId",void 0),E(L(_n),"logger",void 0),E(L(_n),"name",void 0),_n.logger=_,_n.name=j,_n.loggerId=_.loggerId,_n.info=_.info,_n.warn=_.warn,_n.logError=_.logError,_n.genLogger=_.genLogger,_n.log=_.genLogger("RTM:DEBUG","<".concat(j,"> ")),_n.invokeTracker=_.genTracker("Invoke"),_n.eventTracker=_.genTracker("Event"),_n.resultTracker=_.genTracker("Result"),_n.errorTracker=_.genTracker("Error"),$){var _i=_n.emit.bind(L(_n));_n.emit=function(){for(var _s=arguments.length,ga=Array(_s),ba=0;ba<_s;ba++)ga[ba]=arguments[ba];_s=ga[0],ba=ga.slice(1);var xa=UK.includes(_s);_n.eventTracker.apply(_n,["%s: ".concat(0<ba.length?"%s emitted with args: ".concat(ba.map(function(){return"%o"})):"%s emitted"),j,_s].concat(ra(xa?ba.map(fh):ba)));try{_i.apply(void 0,ga)}catch(El){_n.logError("Caught in the callback function of the event %s",_s,El)}}}return _n}nb(i,h);var g=ob(i);return i}(kb)},WK=function(h){return rp(console.log.bind(console),"INFO",h)},XK=function(h){return rp(console.warn.bind(console),"WARN",h)},YK=function(h){return rp(console.error.bind(console),"ERROR",h)},zx=function(h,i){return function(g){var _=1<arguments.length&&arguments[1]!==void 0?arguments[1]:"",j=yx(h),$=console.debug.bind(console),_n=xx(g,i,function(_i){return $(j(_i))});return function(_i){for(var _s=arguments.length,ga=Array(1<_s?_s-1:0),ba=1;ba<_s;ba++)ga[ba-1]=arguments[ba];return _n.apply(void 0,[_+_i].concat(ga))}}},ZK=function(h,i){return function(g){return zx(h,i)("RTM:TRACK","[".concat(g,"] "))}},Tm=Q.URI,wC=gl,$K=em(tK,["Wrapper"]),Cs=Oo($K,"URI"),Ax=function(h,i){var g=-1,_=h.length,j=_-1;for(i=i===void 0?_:i;++g<i;){var $=h[_=Uw(g,j)];h[_]=h[g],h[g]=$}return h.length=i,h},aL=function(h){return Ax(jm(h))},bL=function(h){return Ax(Vm(h))},Ih=function(h){return(lc(h)?aL:bL)(h)},Jh={0:9591,1:9593},xg=function(h){var i=ui(null);return"https://".concat(i?null:h,"/api/v1")},cL=Wb.apply(void 0,ra(Ih(["web-1.ap.sd-rtn.com","web-2.ap.sd-rtn.com"].map(xg)))),dL=Wb.apply(void 0,ra(Ih(["ap-web-1.agora.io","ap-web-2.agora.io"].map(xg)))),eL=Wb.apply(void 0,ra(Ih(["web-3.ap.sd-rtn.com","web-4.ap.sd-rtn.com"].map(xg)))),fL=Wb.apply(void 0,ra(Ih(["ap-web-3.agora.io","ap-web-4.agora.io"].map(xg)))),vc=ae.Writer,O=ae.util,bc=ae.roots.default||(ae.roots.default={}),gL=bc.Session=function(){function h(i){if(i)for(var g=Object.keys(i),_=0;_<g.length;++_)i[g[_]]!=null&&(this[g[_]]=i[g[_]])}return h.prototype.sid="",h.prototype.userId="",h.prototype.lts=O.Long?O.Long.fromBits(0,0,!1):0,h.prototype.elapse=O.Long?O.Long.fromBits(0,0,!1):0,h.prototype.appId="",h.prototype.ver="",h.prototype.buildno=0,h.prototype.installId="",h.prototype.os=0,h.prototype.did="",h.prototype.index=null,h.prototype.token="",h.prototype.version=0,h.prototype.subVersion=0,h.encode=function(i,g){return g||(g=vc.create()),i.sid!=null&&Object.hasOwnProperty.call(i,"sid")&&g.uint32(10).string(i.sid),i.userId!=null&&Object.hasOwnProperty.call(i,"userId")&&g.uint32(18).string(i.userId),i.lts!=null&&Object.hasOwnProperty.call(i,"lts")&&g.uint32(24).int64(i.lts),i.elapse!=null&&Object.hasOwnProperty.call(i,"elapse")&&g.uint32(32).int64(i.elapse),i.appId!=null&&Object.hasOwnProperty.call(i,"appId")&&g.uint32(42).string(i.appId),i.ver!=null&&Object.hasOwnProperty.call(i,"ver")&&g.uint32(50).string(i.ver),i.buildno!=null&&Object.hasOwnProperty.call(i,"buildno")&&g.uint32(56).int32(i.buildno),i.installId!=null&&Object.hasOwnProperty.call(i,"installId")&&g.uint32(66).string(i.installId),i.os!=null&&Object.hasOwnProperty.call(i,"os")&&g.uint32(128).int32(i.os),i.did!=null&&Object.hasOwnProperty.call(i,"did")&&g.uint32(138).string(i.did),i.index!=null&&Object.hasOwnProperty.call(i,"index")&&bc.Session.CommonIndex.encode(i.index,g.uint32(162).fork()).ldelim(),i.token!=null&&Object.hasOwnProperty.call(i,"token")&&g.uint32(170).string(i.token),i.version!=null&&Object.hasOwnProperty.call(i,"version")&&g.uint32(176).int32(i.version),i.subVersion!=null&&Object.hasOwnProperty.call(i,"subVersion")&&g.uint32(184).int32(i.subVersion),g},h.CommonIndex=function(){function i(g){if(g)for(var _=Object.keys(g),j=0;j<_.length;++j)g[_[j]]!=null&&(this[_[j]]=g[_[j]])}return i.prototype.index1="",i.prototype.index2="",i.prototype.index3="",i.encode=function(g,_){return _||(_=vc.create()),g.index1!=null&&Object.hasOwnProperty.call(g,"index1")&&_.uint32(10).string(g.index1),g.index2!=null&&Object.hasOwnProperty.call(g,"index2")&&_.uint32(18).string(g.index2),g.index3!=null&&Object.hasOwnProperty.call(g,"index3")&&_.uint32(26).string(g.index3),_},i}(),h}(),hL=bc.ApEvent=function(){function h(i){if(this.linkServerList=[],i)for(var g=Object.keys(i),_=0;_<g.length;++_)i[g[_]]!=null&&(this[g[_]]=i[g[_]])}return h.prototype.sid="",h.prototype.userId="",h.prototype.lts=O.Long?O.Long.fromBits(0,0,!1):0,h.prototype.elapse=O.Long?O.Long.fromBits(0,0,!1):0,h.prototype.apAddr="",h.prototype.linkServerList=O.emptyArray,h.prototype.errCode=0,h.prototype.serverErrCode=0,h.prototype.isp="",h.prototype.opId=O.Long?O.Long.fromBits(0,0,!1):0,h.prototype.envId=0,h.prototype.flag=0,h.prototype.area="",h.encode=function(i,g){if(g||(g=vc.create()),i.sid!=null&&Object.hasOwnProperty.call(i,"sid")&&g.uint32(10).string(i.sid),i.userId!=null&&Object.hasOwnProperty.call(i,"userId")&&g.uint32(18).string(i.userId),i.lts!=null&&Object.hasOwnProperty.call(i,"lts")&&g.uint32(24).int64(i.lts),i.elapse!=null&&Object.hasOwnProperty.call(i,"elapse")&&g.uint32(32).int64(i.elapse),i.apAddr!=null&&Object.hasOwnProperty.call(i,"apAddr")&&g.uint32(50).string(i.apAddr),i.linkServerList!=null&&i.linkServerList.length)for(var _=0;_<i.linkServerList.length;++_)g.uint32(58).string(i.linkServerList[_]);return i.errCode!=null&&Object.hasOwnProperty.call(i,"errCode")&&g.uint32(72).int32(i.errCode),i.serverErrCode!=null&&Object.hasOwnProperty.call(i,"serverErrCode")&&g.uint32(80).int32(i.serverErrCode),i.isp!=null&&Object.hasOwnProperty.call(i,"isp")&&g.uint32(90).string(i.isp),i.opId!=null&&Object.hasOwnProperty.call(i,"opId")&&g.uint32(96).int64(i.opId),i.envId!=null&&Object.hasOwnProperty.call(i,"envId")&&g.uint32(104).int32(i.envId),i.flag!=null&&Object.hasOwnProperty.call(i,"flag")&&g.uint32(112).int32(i.flag),i.area!=null&&Object.hasOwnProperty.call(i,"area")&&g.uint32(122).string(i.area),g},h}(),iL=bc.ApRequest=function(){function h(i){if(i)for(var g=Object.keys(i),_=0;_<g.length;++_)i[g[_]]!=null&&(this[g[_]]=i[g[_]])}return h.prototype.sid="",h.prototype.userId="",h.prototype.lts=O.Long?O.Long.fromBits(0,0,!1):0,h.prototype.elapse=O.Long?O.Long.fromBits(0,0,!1):0,h.prototype.apAddr="",h.prototype.opId=O.Long?O.Long.fromBits(0,0,!1):0,h.prototype.envId=0,h.prototype.flag=0,h.encode=function(i,g){return g||(g=vc.create()),i.sid!=null&&Object.hasOwnProperty.call(i,"sid")&&g.uint32(10).string(i.sid),i.userId!=null&&Object.hasOwnProperty.call(i,"userId")&&g.uint32(18).string(i.userId),i.lts!=null&&Object.hasOwnProperty.call(i,"lts")&&g.uint32(24).int64(i.lts),i.elapse!=null&&Object.hasOwnProperty.call(i,"elapse")&&g.uint32(32).int64(i.elapse),i.apAddr!=null&&Object.hasOwnProperty.call(i,"apAddr")&&g.uint32(42).string(i.apAddr),i.opId!=null&&Object.hasOwnProperty.call(i,"opId")&&g.uint32(48).int64(i.opId),i.envId!=null&&Object.hasOwnProperty.call(i,"envId")&&g.uint32(56).int32(i.envId),i.flag!=null&&Object.hasOwnProperty.call(i,"flag")&&g.uint32(64).int32(i.flag),g},h}(),jL=bc.LinkLoginRequest=function(){function h(i){if(i)for(var g=Object.keys(i),_=0;_<g.length;++_)i[g[_]]!=null&&(this[g[_]]=i[g[_]])}return h.prototype.sid="",h.prototype.userId="",h.prototype.lts=O.Long?O.Long.fromBits(0,0,!1):0,h.prototype.elapse=O.Long?O.Long.fromBits(0,0,!1):0,h.prototype.destServerIp="",h.prototype.linkId=0,h.encode=function(i,g){return g||(g=vc.create()),i.sid!=null&&Object.hasOwnProperty.call(i,"sid")&&g.uint32(10).string(i.sid),i.userId!=null&&Object.hasOwnProperty.call(i,"userId")&&g.uint32(18).string(i.userId),i.lts!=null&&Object.hasOwnProperty.call(i,"lts")&&g.uint32(24).int64(i.lts),i.elapse!=null&&Object.hasOwnProperty.call(i,"elapse")&&g.uint32(32).int64(i.elapse),i.destServerIp!=null&&Object.hasOwnProperty.call(i,"destServerIp")&&g.uint32(42).string(i.destServerIp),i.linkId!=null&&Object.hasOwnProperty.call(i,"linkId")&&g.uint32(48).int32(i.linkId),g},h}(),kL=bc.Link=function(){function h(i){if(i)for(var g=Object.keys(i),_=0;_<g.length;++_)i[g[_]]!=null&&(this[g[_]]=i[g[_]])}return h.prototype.sid="",h.prototype.userId="",h.prototype.lts=O.Long?O.Long.fromBits(0,0,!1):0,h.prototype.elapse=O.Long?O.Long.fromBits(0,0,!1):0,h.prototype.ec=0,h.prototype.sc=0,h.prototype.destServerIp="",h.prototype.ackedServerIp="",h.prototype.responseTime=0,h.encode=function(i,g){return g||(g=vc.create()),i.sid!=null&&Object.hasOwnProperty.call(i,"sid")&&g.uint32(10).string(i.sid),i.userId!=null&&Object.hasOwnProperty.call(i,"userId")&&g.uint32(18).string(i.userId),i.lts!=null&&Object.hasOwnProperty.call(i,"lts")&&g.uint32(24).int64(i.lts),i.elapse!=null&&Object.hasOwnProperty.call(i,"elapse")&&g.uint32(32).int64(i.elapse),i.ec!=null&&Object.hasOwnProperty.call(i,"ec")&&g.uint32(40).int32(i.ec),i.sc!=null&&Object.hasOwnProperty.call(i,"sc")&&g.uint32(48).int32(i.sc),i.destServerIp!=null&&Object.hasOwnProperty.call(i,"destServerIp")&&g.uint32(58).string(i.destServerIp),i.ackedServerIp!=null&&Object.hasOwnProperty.call(i,"ackedServerIp")&&g.uint32(66).string(i.ackedServerIp),i.responseTime!=null&&Object.hasOwnProperty.call(i,"responseTime")&&g.uint32(72).int32(i.responseTime),g},h}(),lL=bc.Logout=function(){function h(i){if(i)for(var g=Object.keys(i),_=0;_<g.length;++_)i[g[_]]!=null&&(this[g[_]]=i[g[_]])}return h.prototype.sid="",h.prototype.userId="",h.prototype.lts=O.Long?O.Long.fromBits(0,0,!1):0,h.prototype.elapse=O.Long?O.Long.fromBits(0,0,!1):0,h.encode=function(i,g){return g||(g=vc.create()),i.sid!=null&&Object.hasOwnProperty.call(i,"sid")&&g.uint32(10).string(i.sid),i.userId!=null&&Object.hasOwnProperty.call(i,"userId")&&g.uint32(18).string(i.userId),i.lts!=null&&Object.hasOwnProperty.call(i,"lts")&&g.uint32(24).int64(i.lts),i.elapse!=null&&Object.hasOwnProperty.call(i,"elapse")&&g.uint32(32).int64(i.elapse),g},h}(),mL=bc.KickedOff=function(){function h(i){if(i)for(var g=Object.keys(i),_=0;_<g.length;++_)i[g[_]]!=null&&(this[g[_]]=i[g[_]])}return h.prototype.sid="",h.prototype.userId="",h.prototype.lts=O.Long?O.Long.fromBits(0,0,!1):0,h.prototype.elapse=O.Long?O.Long.fromBits(0,0,!1):0,h.prototype.linkId=0,h.prototype.code=0,h.prototype.server="",h.prototype.serverCode=0,h.encode=function(i,g){return g||(g=vc.create()),i.sid!=null&&Object.hasOwnProperty.call(i,"sid")&&g.uint32(10).string(i.sid),i.userId!=null&&Object.hasOwnProperty.call(i,"userId")&&g.uint32(18).string(i.userId),i.lts!=null&&Object.hasOwnProperty.call(i,"lts")&&g.uint32(24).int64(i.lts),i.elapse!=null&&Object.hasOwnProperty.call(i,"elapse")&&g.uint32(32).int64(i.elapse),i.linkId!=null&&Object.hasOwnProperty.call(i,"linkId")&&g.uint32(48).int32(i.linkId),i.code!=null&&Object.hasOwnProperty.call(i,"code")&&g.uint32(56).int32(i.code),i.server!=null&&Object.hasOwnProperty.call(i,"server")&&g.uint32(66).string(i.server),i.serverCode!=null&&Object.hasOwnProperty.call(i,"serverCode")&&g.uint32(72).int32(i.serverCode),g},h}(),nL=bc.ChnJoin=function(){function h(i){if(i)for(var g=Object.keys(i),_=0;_<g.length;++_)i[g[_]]!=null&&(this[g[_]]=i[g[_]])}return h.prototype.sid="",h.prototype.userId="",h.prototype.lts=O.Long?O.Long.fromBits(0,0,!1):0,h.prototype.elapse=O.Long?O.Long.fromBits(0,0,!1):0,h.prototype.cname="",h.prototype.errCode=0,h.encode=function(i,g){return g||(g=vc.create()),i.sid!=null&&Object.hasOwnProperty.call(i,"sid")&&g.uint32(10).string(i.sid),i.userId!=null&&Object.hasOwnProperty.call(i,"userId")&&g.uint32(18).string(i.userId),i.lts!=null&&Object.hasOwnProperty.call(i,"lts")&&g.uint32(24).int64(i.lts),i.elapse!=null&&Object.hasOwnProperty.call(i,"elapse")&&g.uint32(32).int64(i.elapse),i.cname!=null&&Object.hasOwnProperty.call(i,"cname")&&g.uint32(50).string(i.cname),i.errCode!=null&&Object.hasOwnProperty.call(i,"errCode")&&g.uint32(56).int32(i.errCode),g},h}(),oL=bc.ChnJoinRes=function(){function h(i){if(i)for(var g=Object.keys(i),_=0;_<g.length;++_)i[g[_]]!=null&&(this[g[_]]=i[g[_]])}return h.prototype.sid="",h.prototype.userId="",h.prototype.lts=O.Long?O.Long.fromBits(0,0,!1):0,h.prototype.elapse=O.Long?O.Long.fromBits(0,0,!1):0,h.prototype.cname="",h.prototype.errCode=0,h.prototype.serverErrCode=0,h.encode=function(i,g){return g||(g=vc.create()),i.sid!=null&&Object.hasOwnProperty.call(i,"sid")&&g.uint32(10).string(i.sid),i.userId!=null&&Object.hasOwnProperty.call(i,"userId")&&g.uint32(18).string(i.userId),i.lts!=null&&Object.hasOwnProperty.call(i,"lts")&&g.uint32(24).int64(i.lts),i.elapse!=null&&Object.hasOwnProperty.call(i,"elapse")&&g.uint32(32).int64(i.elapse),i.cname!=null&&Object.hasOwnProperty.call(i,"cname")&&g.uint32(50).string(i.cname),i.errCode!=null&&Object.hasOwnProperty.call(i,"errCode")&&g.uint32(56).int32(i.errCode),i.serverErrCode!=null&&Object.hasOwnProperty.call(i,"serverErrCode")&&g.uint32(64).int32(i.serverErrCode),g},h}(),pL=bc.ChnLeave=function(){function h(i){if(i)for(var g=Object.keys(i),_=0;_<g.length;++_)i[g[_]]!=null&&(this[g[_]]=i[g[_]])}return h.prototype.sid="",h.prototype.userId="",h.prototype.lts=O.Long?O.Long.fromBits(0,0,!1):0,h.prototype.elapse=O.Long?O.Long.fromBits(0,0,!1):0,h.prototype.cname="",h.prototype.errCode=0,h.encode=function(i,g){return g||(g=vc.create()),i.sid!=null&&Object.hasOwnProperty.call(i,"sid")&&g.uint32(10).string(i.sid),i.userId!=null&&Object.hasOwnProperty.call(i,"userId")&&g.uint32(18).string(i.userId),i.lts!=null&&Object.hasOwnProperty.call(i,"lts")&&g.uint32(24).int64(i.lts),i.elapse!=null&&Object.hasOwnProperty.call(i,"elapse")&&g.uint32(32).int64(i.elapse),i.cname!=null&&Object.hasOwnProperty.call(i,"cname")&&g.uint32(50).string(i.cname),i.errCode!=null&&Object.hasOwnProperty.call(i,"errCode")&&g.uint32(56).int32(i.errCode),g},h}(),qL=bc.ConnectionStateChange=function(){function h(i){if(i)for(var g=Object.keys(i),_=0;_<g.length;++_)i[g[_]]!=null&&(this[g[_]]=i[g[_]])}return h.prototype.sid="",h.prototype.userId="",h.prototype.lts=O.Long?O.Long.fromBits(0,0,!1):0,h.prototype.elapse=O.Long?O.Long.fromBits(0,0,!1):0,h.prototype.oldState=0,h.prototype.newState=0,h.prototype.reason=0,h.prototype.reconnId=0,h.encode=function(i,g){return g||(g=vc.create()),i.sid!=null&&Object.hasOwnProperty.call(i,"sid")&&g.uint32(10).string(i.sid),i.userId!=null&&Object.hasOwnProperty.call(i,"userId")&&g.uint32(18).string(i.userId),i.lts!=null&&Object.hasOwnProperty.call(i,"lts")&&g.uint32(24).int64(i.lts),i.elapse!=null&&Object.hasOwnProperty.call(i,"elapse")&&g.uint32(32).int64(i.elapse),i.oldState!=null&&Object.hasOwnProperty.call(i,"oldState")&&g.uint32(40).int32(i.oldState),i.newState!=null&&Object.hasOwnProperty.call(i,"newState")&&g.uint32(48).int32(i.newState),i.reason!=null&&Object.hasOwnProperty.call(i,"reason")&&g.uint32(56).int32(i.reason),i.reconnId!=null&&Object.hasOwnProperty.call(i,"reconnId")&&g.uint32(64).int32(i.reconnId),g},h}(),Bx=bc.RtmSdkMessageCount=function(){function h(i){if(i)for(var g=Object.keys(i),_=0;_<g.length;++_)i[g[_]]!=null&&(this[g[_]]=i[g[_]])}return h.prototype.lts=O.Long?O.Long.fromBits(0,0,!1):0,h.prototype.vid=O.Long?O.Long.fromBits(0,0,!1):0,h.prototype.sid="",h.prototype.messagecategory=0,h.prototype.reportsequence=O.Long?O.Long.fromBits(0,0,!1):0,h.prototype.sentcount=O.Long?O.Long.fromBits(0,0,!1):0,h.prototype.receivedcount=O.Long?O.Long.fromBits(0,0,!1):0,h.prototype.peerack10mscount=O.Long?O.Long.fromBits(0,0,!1):0,h.prototype.peerack25mscount=O.Long?O.Long.fromBits(0,0,!1):0,h.prototype.peerack50mscount=O.Long?O.Long.fromBits(0,0,!1):0,h.prototype.peerack75mscount=O.Long?O.Long.fromBits(0,0,!1):0,h.prototype.peerack100mscount=O.Long?O.Long.fromBits(0,0,!1):0,h.prototype.peerack150mscount=O.Long?O.Long.fromBits(0,0,!1):0,h.prototype.peerack200mscount=O.Long?O.Long.fromBits(0,0,!1):0,h.prototype.peerack250mscount=O.Long?O.Long.fromBits(0,0,!1):0,h.prototype.peerack300mscount=O.Long?O.Long.fromBits(0,0,!1):0,h.prototype.peerack400mscount=O.Long?O.Long.fromBits(0,0,!1):0,h.prototype.peerack500mscount=O.Long?O.Long.fromBits(0,0,!1):0,h.prototype.peerack600mscount=O.Long?O.Long.fromBits(0,0,!1):0,h.prototype.peerack800mscount=O.Long?O.Long.fromBits(0,0,!1):0,h.prototype.peerack1000mscount=O.Long?O.Long.fromBits(0,0,!1):0,h.prototype.peerack2000mscount=O.Long?O.Long.fromBits(0,0,!1):0,h.prototype.peerack3000mscount=O.Long?O.Long.fromBits(0,0,!1):0,h.prototype.peerack5000mscount=O.Long?O.Long.fromBits(0,0,!1):0,h.prototype.peerack7000mscount=O.Long?O.Long.fromBits(0,0,!1):0,h.prototype.peerackslowcount=O.Long?O.Long.fromBits(0,0,!1):0,h.prototype.norecipientack10mscount=O.Long?O.Long.fromBits(0,0,!1):0,h.prototype.norecipientack25mscount=O.Long?O.Long.fromBits(0,0,!1):0,h.prototype.norecipientack50mscount=O.Long?O.Long.fromBits(0,0,!1):0,h.prototype.norecipientack75mscount=O.Long?O.Long.fromBits(0,0,!1):0,h.prototype.norecipientack100mscount=O.Long?O.Long.fromBits(0,0,!1):0,h.prototype.norecipientack150mscount=O.Long?O.Long.fromBits(0,0,!1):0,h.prototype.norecipientack200mscount=O.Long?O.Long.fromBits(0,0,!1):0,h.prototype.norecipientack250mscount=O.Long?O.Long.fromBits(0,0,!1):0,h.prototype.norecipientack300mscount=O.Long?O.Long.fromBits(0,0,!1):0,h.prototype.norecipientack400mscount=O.Long?O.Long.fromBits(0,0,!1):0,h.prototype.norecipientack500mscount=O.Long?O.Long.fromBits(0,0,!1):0,h.prototype.norecipientack600mscount=O.Long?O.Long.fromBits(0,0,!1):0,h.prototype.norecipientack800mscount=O.Long?O.Long.fromBits(0,0,!1):0,h.prototype.norecipientack1000mscount=O.Long?O.Long.fromBits(0,0,!1):0,h.prototype.norecipientack2000mscount=O.Long?O.Long.fromBits(0,0,!1):0,h.prototype.norecipientack3000mscount=O.Long?O.Long.fromBits(0,0,!1):0,h.prototype.norecipientack5000mscount=O.Long?O.Long.fromBits(0,0,!1):0,h.prototype.norecipientack7000mscount=O.Long?O.Long.fromBits(0,0,!1):0,h.prototype.norecipientackslowcount=O.Long?O.Long.fromBits(0,0,!1):0,h.prototype.acktimeoutcount=O.Long?O.Long.fromBits(0,0,!1):0,h.prototype.apimajorversion=0,h.prototype.apiminorversion=0,h.prototype.os=0,h.prototype.toooftencount=0,h.prototype.receiverofflinecount=0,h.prototype.invalidmessagecount=0,h.prototype.unknowerrorcount=0,h.prototype.servercachedcount=0,h.prototype.timeoutcount=0,h.prototype.successcount=0,h.prototype.userid="",h.encode=function(i,g){return g||(g=vc.create()),i.lts!=null&&Object.hasOwnProperty.call(i,"lts")&&g.uint32(8).int64(i.lts),i.vid!=null&&Object.hasOwnProperty.call(i,"vid")&&g.uint32(16).int64(i.vid),i.sid!=null&&Object.hasOwnProperty.call(i,"sid")&&g.uint32(26).string(i.sid),i.messagecategory!=null&&Object.hasOwnProperty.call(i,"messagecategory")&&g.uint32(32).int32(i.messagecategory),i.reportsequence!=null&&Object.hasOwnProperty.call(i,"reportsequence")&&g.uint32(40).int64(i.reportsequence),i.sentcount!=null&&Object.hasOwnProperty.call(i,"sentcount")&&g.uint32(48).int64(i.sentcount),i.receivedcount!=null&&Object.hasOwnProperty.call(i,"receivedcount")&&g.uint32(56).int64(i.receivedcount),i.peerack10mscount!=null&&Object.hasOwnProperty.call(i,"peerack10mscount")&&g.uint32(64).int64(i.peerack10mscount),i.peerack25mscount!=null&&Object.hasOwnProperty.call(i,"peerack25mscount")&&g.uint32(72).int64(i.peerack25mscount),i.peerack50mscount!=null&&Object.hasOwnProperty.call(i,"peerack50mscount")&&g.uint32(80).int64(i.peerack50mscount),i.peerack75mscount!=null&&Object.hasOwnProperty.call(i,"peerack75mscount")&&g.uint32(88).int64(i.peerack75mscount),i.peerack100mscount!=null&&Object.hasOwnProperty.call(i,"peerack100mscount")&&g.uint32(96).int64(i.peerack100mscount),i.peerack150mscount!=null&&Object.hasOwnProperty.call(i,"peerack150mscount")&&g.uint32(104).int64(i.peerack150mscount),i.peerack200mscount!=null&&Object.hasOwnProperty.call(i,"peerack200mscount")&&g.uint32(112).int64(i.peerack200mscount),i.peerack250mscount!=null&&Object.hasOwnProperty.call(i,"peerack250mscount")&&g.uint32(120).int64(i.peerack250mscount),i.peerack300mscount!=null&&Object.hasOwnProperty.call(i,"peerack300mscount")&&g.uint32(128).int64(i.peerack300mscount),i.peerack400mscount!=null&&Object.hasOwnProperty.call(i,"peerack400mscount")&&g.uint32(136).int64(i.peerack400mscount),i.peerack500mscount!=null&&Object.hasOwnProperty.call(i,"peerack500mscount")&&g.uint32(144).int64(i.peerack500mscount),i.peerack600mscount!=null&&Object.hasOwnProperty.call(i,"peerack600mscount")&&g.uint32(152).int64(i.peerack600mscount),i.peerack800mscount!=null&&Object.hasOwnProperty.call(i,"peerack800mscount")&&g.uint32(160).int64(i.peerack800mscount),i.peerack1000mscount!=null&&Object.hasOwnProperty.call(i,"peerack1000mscount")&&g.uint32(168).int64(i.peerack1000mscount),i.peerack2000mscount!=null&&Object.hasOwnProperty.call(i,"peerack2000mscount")&&g.uint32(176).int64(i.peerack2000mscount),i.peerack3000mscount!=null&&Object.hasOwnProperty.call(i,"peerack3000mscount")&&g.uint32(184).int64(i.peerack3000mscount),i.peerack5000mscount!=null&&Object.hasOwnProperty.call(i,"peerack5000mscount")&&g.uint32(192).int64(i.peerack5000mscount),i.peerack7000mscount!=null&&Object.hasOwnProperty.call(i,"peerack7000mscount")&&g.uint32(200).int64(i.peerack7000mscount),i.peerackslowcount!=null&&Object.hasOwnProperty.call(i,"peerackslowcount")&&g.uint32(208).int64(i.peerackslowcount),i.norecipientack10mscount!=null&&Object.hasOwnProperty.call(i,"norecipientack10mscount")&&g.uint32(216).int64(i.norecipientack10mscount),i.norecipientack25mscount!=null&&Object.hasOwnProperty.call(i,"norecipientack25mscount")&&g.uint32(224).int64(i.norecipientack25mscount),i.norecipientack50mscount!=null&&Object.hasOwnProperty.call(i,"norecipientack50mscount")&&g.uint32(232).int64(i.norecipientack50mscount),i.norecipientack75mscount!=null&&Object.hasOwnProperty.call(i,"norecipientack75mscount")&&g.uint32(240).int64(i.norecipientack75mscount),i.norecipientack100mscount!=null&&Object.hasOwnProperty.call(i,"norecipientack100mscount")&&g.uint32(248).int64(i.norecipientack100mscount),i.norecipientack150mscount!=null&&Object.hasOwnProperty.call(i,"norecipientack150mscount")&&g.uint32(256).int64(i.norecipientack150mscount),i.norecipientack200mscount!=null&&Object.hasOwnProperty.call(i,"norecipientack200mscount")&&g.uint32(264).int64(i.norecipientack200mscount),i.norecipientack250mscount!=null&&Object.hasOwnProperty.call(i,"norecipientack250mscount")&&g.uint32(272).int64(i.norecipientack250mscount),i.norecipientack300mscount!=null&&Object.hasOwnProperty.call(i,"norecipientack300mscount")&&g.uint32(280).int64(i.norecipientack300mscount),i.norecipientack400mscount!=null&&Object.hasOwnProperty.call(i,"norecipientack400mscount")&&g.uint32(288).int64(i.norecipientack400mscount),i.norecipientack500mscount!=null&&Object.hasOwnProperty.call(i,"norecipientack500mscount")&&g.uint32(296).int64(i.norecipientack500mscount),i.norecipientack600mscount!=null&&Object.hasOwnProperty.call(i,"norecipientack600mscount")&&g.uint32(304).int64(i.norecipientack600mscount),i.norecipientack800mscount!=null&&Object.hasOwnProperty.call(i,"norecipientack800mscount")&&g.uint32(312).int64(i.norecipientack800mscount),i.norecipientack1000mscount!=null&&Object.hasOwnProperty.call(i,"norecipientack1000mscount")&&g.uint32(320).int64(i.norecipientack1000mscount),i.norecipientack2000mscount!=null&&Object.hasOwnProperty.call(i,"norecipientack2000mscount")&&g.uint32(328).int64(i.norecipientack2000mscount),i.norecipientack3000mscount!=null&&Object.hasOwnProperty.call(i,"norecipientack3000mscount")&&g.uint32(336).int64(i.norecipientack3000mscount),i.norecipientack5000mscount!=null&&Object.hasOwnProperty.call(i,"norecipientack5000mscount")&&g.uint32(344).int64(i.norecipientack5000mscount),i.norecipientack7000mscount!=null&&Object.hasOwnProperty.call(i,"norecipientack7000mscount")&&g.uint32(352).int64(i.norecipientack7000mscount),i.norecipientackslowcount!=null&&Object.hasOwnProperty.call(i,"norecipientackslowcount")&&g.uint32(360).int64(i.norecipientackslowcount),i.acktimeoutcount!=null&&Object.hasOwnProperty.call(i,"acktimeoutcount")&&g.uint32(368).int64(i.acktimeoutcount),i.apimajorversion!=null&&Object.hasOwnProperty.call(i,"apimajorversion")&&g.uint32(376).int32(i.apimajorversion),i.apiminorversion!=null&&Object.hasOwnProperty.call(i,"apiminorversion")&&g.uint32(384).int32(i.apiminorversion),i.os!=null&&Object.hasOwnProperty.call(i,"os")&&g.uint32(392).int32(i.os),i.toooftencount!=null&&Object.hasOwnProperty.call(i,"toooftencount")&&g.uint32(400).int32(i.toooftencount),i.receiverofflinecount!=null&&Object.hasOwnProperty.call(i,"receiverofflinecount")&&g.uint32(408).int32(i.receiverofflinecount),i.invalidmessagecount!=null&&Object.hasOwnProperty.call(i,"invalidmessagecount")&&g.uint32(416).int32(i.invalidmessagecount),i.unknowerrorcount!=null&&Object.hasOwnProperty.call(i,"unknowerrorcount")&&g.uint32(424).int32(i.unknowerrorcount),i.servercachedcount!=null&&Object.hasOwnProperty.call(i,"servercachedcount")&&g.uint32(432).int32(i.servercachedcount),i.timeoutcount!=null&&Object.hasOwnProperty.call(i,"timeoutcount")&&g.uint32(440).int32(i.timeoutcount),i.successcount!=null&&Object.hasOwnProperty.call(i,"successcount")&&g.uint32(448).int32(i.successcount),i.userid!=null&&Object.hasOwnProperty.call(i,"userid")&&g.uint32(458).string(i.userid),g},h}(),rL=bc.SyncOperateEvent=function(){function h(i){if(i)for(var g=Object.keys(i),_=0;_<g.length;++_)i[g[_]]!=null&&(this[g[_]]=i[g[_]])}return h.prototype.lts=O.Long?O.Long.fromBits(0,0,!1):0,h.prototype.userid="",h.prototype.vid=O.Long?O.Long.fromBits(0,0,!1):0,h.prototype.sid="",h.prototype.requestts=O.Long?O.Long.fromBits(0,0,!1):0,h.prototype.replyts=O.Long?O.Long.fromBits(0,0,!1):0,h.prototype.target="",h.prototype.eventtype="",h.prototype.revision=O.Long?O.Long.fromBits(0,0,!1):0,h.prototype.uuid="",h.prototype.sdktype=0,h.prototype.flags=O.Long?O.Long.fromBits(0,0,!1):0,h.prototype.code=0,h.prototype.seq=O.Long?O.Long.fromBits(0,0,!1):0,h.prototype.index=null,h.prototype.lock="",h.prototype.lockrev=O.Long?O.Long.fromBits(0,0,!1):0,h.prototype.subtarget="",h.prototype.usersid="",h.encode=function(i,g){return g||(g=vc.create()),i.lts!=null&&Object.hasOwnProperty.call(i,"lts")&&g.uint32(8).int64(i.lts),i.userid!=null&&Object.hasOwnProperty.call(i,"userid")&&g.uint32(26).string(i.userid),i.vid!=null&&Object.hasOwnProperty.call(i,"vid")&&g.uint32(32).int64(i.vid),i.sid!=null&&Object.hasOwnProperty.call(i,"sid")&&g.uint32(42).string(i.sid),i.requestts!=null&&Object.hasOwnProperty.call(i,"requestts")&&g.uint32(48).int64(i.requestts),i.replyts!=null&&Object.hasOwnProperty.call(i,"replyts")&&g.uint32(56).int64(i.replyts),i.target!=null&&Object.hasOwnProperty.call(i,"target")&&g.uint32(66).string(i.target),i.eventtype!=null&&Object.hasOwnProperty.call(i,"eventtype")&&g.uint32(74).string(i.eventtype),i.revision!=null&&Object.hasOwnProperty.call(i,"revision")&&g.uint32(80).int64(i.revision),i.uuid!=null&&Object.hasOwnProperty.call(i,"uuid")&&g.uint32(90).string(i.uuid),i.sdktype!=null&&Object.hasOwnProperty.call(i,"sdktype")&&g.uint32(96).int32(i.sdktype),i.flags!=null&&Object.hasOwnProperty.call(i,"flags")&&g.uint32(104).int64(i.flags),i.code!=null&&Object.hasOwnProperty.call(i,"code")&&g.uint32(112).int32(i.code),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&g.uint32(120).int64(i.seq),i.index!=null&&Object.hasOwnProperty.call(i,"index")&&bc.CommonIndex.encode(i.index,g.uint32(130).fork()).ldelim(),i.lock!=null&&Object.hasOwnProperty.call(i,"lock")&&g.uint32(138).string(i.lock),i.lockrev!=null&&Object.hasOwnProperty.call(i,"lockrev")&&g.uint32(144).int64(i.lockrev),i.subtarget!=null&&Object.hasOwnProperty.call(i,"subtarget")&&g.uint32(154).string(i.subtarget),i.usersid!=null&&Object.hasOwnProperty.call(i,"usersid")&&g.uint32(162).string(i.usersid),g},h}(),sL=bc.SyncSubscribeEvent=function(){function h(i){if(i)for(var g=Object.keys(i),_=0;_<g.length;++_)i[g[_]]!=null&&(this[g[_]]=i[g[_]])}return h.prototype.lts=O.Long?O.Long.fromBits(0,0,!1):0,h.prototype.userid="",h.prototype.vid=O.Long?O.Long.fromBits(0,0,!1):0,h.prototype.sid="",h.prototype.target="",h.prototype.eventtype="",h.prototype.sdktype=0,h.prototype.flags=O.Long?O.Long.fromBits(0,0,!1):0,h.prototype.code=0,h.prototype.seq=O.Long?O.Long.fromBits(0,0,!1):0,h.prototype.requestts=O.Long?O.Long.fromBits(0,0,!1):0,h.prototype.replyts=O.Long?O.Long.fromBits(0,0,!1):0,h.prototype.index=null,h.prototype.subtarget="",h.prototype.usersid="",h.encode=function(i,g){return g||(g=vc.create()),i.lts!=null&&Object.hasOwnProperty.call(i,"lts")&&g.uint32(8).int64(i.lts),i.userid!=null&&Object.hasOwnProperty.call(i,"userid")&&g.uint32(26).string(i.userid),i.vid!=null&&Object.hasOwnProperty.call(i,"vid")&&g.uint32(32).int64(i.vid),i.sid!=null&&Object.hasOwnProperty.call(i,"sid")&&g.uint32(42).string(i.sid),i.target!=null&&Object.hasOwnProperty.call(i,"target")&&g.uint32(66).string(i.target),i.eventtype!=null&&Object.hasOwnProperty.call(i,"eventtype")&&g.uint32(74).string(i.eventtype),i.sdktype!=null&&Object.hasOwnProperty.call(i,"sdktype")&&g.uint32(96).int32(i.sdktype),i.flags!=null&&Object.hasOwnProperty.call(i,"flags")&&g.uint32(104).int64(i.flags),i.code!=null&&Object.hasOwnProperty.call(i,"code")&&g.uint32(112).int32(i.code),i.seq!=null&&Object.hasOwnProperty.call(i,"seq")&&g.uint32(120).int64(i.seq),i.requestts!=null&&Object.hasOwnProperty.call(i,"requestts")&&g.uint32(128).int64(i.requestts),i.replyts!=null&&Object.hasOwnProperty.call(i,"replyts")&&g.uint32(136).int64(i.replyts),i.index!=null&&Object.hasOwnProperty.call(i,"index")&&bc.CommonIndex.encode(i.index,g.uint32(146).fork()).ldelim(),i.subtarget!=null&&Object.hasOwnProperty.call(i,"subtarget")&&g.uint32(154).string(i.subtarget),i.usersid!=null&&Object.hasOwnProperty.call(i,"usersid")&&g.uint32(162).string(i.usersid),g},h}(),tL=bc.SyncUpdateEvent=function(){function h(i){if(i)for(var g=Object.keys(i),_=0;_<g.length;++_)i[g[_]]!=null&&(this[g[_]]=i[g[_]])}return h.prototype.lts=O.Long?O.Long.fromBits(0,0,!1):0,h.prototype.userid="",h.prototype.vid=O.Long?O.Long.fromBits(0,0,!1):0,h.prototype.sid="",h.prototype.replyts=O.Long?O.Long.fromBits(0,0,!1):0,h.prototype.target="",h.prototype.eventtype="",h.prototype.revision=O.Long?O.Long.fromBits(0,0,!1):0,h.prototype.sdktype=0,h.prototype.flags=O.Long?O.Long.fromBits(0,0,!1):0,h.prototype.count=0,h.prototype.delta=0,h.prototype.code=0,h.prototype.index=null,h.prototype.subtarget="",h.encode=function(i,g){return g||(g=vc.create()),i.lts!=null&&Object.hasOwnProperty.call(i,"lts")&&g.uint32(8).int64(i.lts),i.userid!=null&&Object.hasOwnProperty.call(i,"userid")&&g.uint32(26).string(i.userid),i.vid!=null&&Object.hasOwnProperty.call(i,"vid")&&g.uint32(32).int64(i.vid),i.sid!=null&&Object.hasOwnProperty.call(i,"sid")&&g.uint32(42).string(i.sid),i.replyts!=null&&Object.hasOwnProperty.call(i,"replyts")&&g.uint32(56).int64(i.replyts),i.target!=null&&Object.hasOwnProperty.call(i,"target")&&g.uint32(66).string(i.target),i.eventtype!=null&&Object.hasOwnProperty.call(i,"eventtype")&&g.uint32(74).string(i.eventtype),i.revision!=null&&Object.hasOwnProperty.call(i,"revision")&&g.uint32(80).int64(i.revision),i.sdktype!=null&&Object.hasOwnProperty.call(i,"sdktype")&&g.uint32(96).int32(i.sdktype),i.flags!=null&&Object.hasOwnProperty.call(i,"flags")&&g.uint32(104).int64(i.flags),i.count!=null&&Object.hasOwnProperty.call(i,"count")&&g.uint32(112).int32(i.count),i.delta!=null&&Object.hasOwnProperty.call(i,"delta")&&g.uint32(120).int32(i.delta),i.code!=null&&Object.hasOwnProperty.call(i,"code")&&g.uint32(128).int32(i.code),i.index!=null&&Object.hasOwnProperty.call(i,"index")&&bc.CommonIndex.encode(i.index,g.uint32(138).fork()).ldelim(),i.subtarget!=null&&Object.hasOwnProperty.call(i,"subtarget")&&g.uint32(162).string(i.subtarget),g},h}(),uL=bc.CommonIndex=function(){function h(i){if(i)for(var g=Object.keys(i),_=0;_<g.length;++_)i[g[_]]!=null&&(this[g[_]]=i[g[_]])}return h.prototype.index1="",h.prototype.index2="",h.prototype.index3="",h.encode=function(i,g){return g||(g=vc.create()),i.index1!=null&&Object.hasOwnProperty.call(i,"index1")&&g.uint32(10).string(i.index1),i.index2!=null&&Object.hasOwnProperty.call(i,"index2")&&g.uint32(18).string(i.index2),i.index3!=null&&Object.hasOwnProperty.call(i,"index3")&&g.uint32(26).string(i.index3),g},h}(),xC=Object.freeze({__proto__:null,Session:gL,ApEvent:hL,ApRequest:iL,LinkLoginRequest:jL,Link:kL,Logout:lL,KickedOff:mL,ChnJoin:nL,ChnJoinRes:oL,ChnLeave:pL,ConnectionStateChange:qL,RtmSdkMessageCount:Bx,SyncOperateEvent:rL,SyncSubscribeEvent:sL,SyncUpdateEvent:tL,CommonIndex:uL,default:bc}),yC=Object.freeze({__proto__:null,Counter:1,ApiExec:154,Session:164,ApEvent:165,Link:166,Logout:167,TxMessage:168,RxMessage:169,KickedOff:170,TxMessageRes:171,ChnJoin:172,ChnJoinRes:173,ChnLeave:174,ChnGetMembers:175,ChnGetMembersRes:176,ChnMemberJoined:177,ChnMemberLeft:178,QueryPeersOnlineStatus:179,QueryPeersOnlineStatusRes:180,RenewToken:181,OperateAttribute:186,OperateAttributeRes:187,ApRequest:188,LinkTcpEvent:189,LinkLoginRequest:190,ConnectionStateChange:191,RtmSdkMessageCount:510,SyncOperateEvent:9654,SyncSubscribeEvent:9651,default:{Counter:1,ApiExec:154,Session:164,ApEvent:165,Link:166,Logout:167,TxMessage:168,RxMessage:169,KickedOff:170,TxMessageRes:171,ChnJoin:172,ChnJoinRes:173,ChnLeave:174,ChnGetMembers:175,ChnGetMembersRes:176,ChnMemberJoined:177,ChnMemberLeft:178,QueryPeersOnlineStatus:179,QueryPeersOnlineStatusRes:180,RenewToken:181,OperateAttribute:186,OperateAttributeRes:187,ApRequest:188,LinkTcpEvent:189,LinkLoginRequest:190,ConnectionStateChange:191,RtmSdkMessageCount:510,SyncOperateEvent:9654,SyncSubscribeEvent:9651}}),Cx=il(),sp=function(h){function i(_,j,$,_n,_i,_s){var ga,ba;ab(this,i);var xa=g.call(this,_i,Pm("Socket-",_i.loggerId));if(E(L(xa),"isActiveClose",!1),E(L(xa),"loggedIn",!1),E(L(xa),"useNewDomain",void 0),E(L(xa),"receivedPacket",new ec),E(L(xa),"open$",void 0),E(L(xa),"input$",new ec),E(L(xa),"userJoin$",new ec),E(L(xa),"attemptsSinceLastError",0),E(L(xa),"message$",new ec),E(L(xa),"socket$",void 0),E(L(xa),"toClose",new ec),E(L(xa),"toReconnect",new ec),E(L(xa),"sendLogger",void 0),E(L(xa),"receiveLogger",void 0),E(L(xa),"ip",void 0),E(L(xa),"env",void 0),E(L(xa),"ticket",void 0),E(L(xa),"context",void 0),E(L(xa),"getDomain",function(){return Ds(xa.ip,xa.useNewDomain)}),E(L(xa),"socketReconnector",function(Sl){var Il=function(Cl){return xa.attemptsSinceLastError+=1,xa.warn("The %s of Env %d reconnecting %s",xa.name,xa.env,Cl.message),Fe(3e3)};return Sl.pipe(Rb(function(Cl){return xa.log("socket connection closed"),xa.loggedIn=!1,2<=xa.attemptsSinceLastError?(xa.warn("socket connection failure"),xa.emit("connectionFailure"),xa.close(),Va(Cl)):xa.isActiveClose?$c:(xa.emit("reconnect"),xa.useNewDomain=!xa.useNewDomain,Va(Cl))}),Zg(function(Cl){return Cl.pipe(Cc(Il))}))}),xa.ip=_,xa.env=j,xa.ticket=$,xa.context=_n,xa.useNewDomain=_s??.5<=Math.random(),xa.sendLogger=xa.genLogger("RTM:MSG:SEND"),xa.receiveLogger=xa.genLogger("RTM:MSG:RECV"),j!==0&&j!==1)throw new Cx({ILLEGAL_RTM_ENV:"The env number is out of rtm env count"});var El=Jh[j];xa.log("Opening websocket address %s for the Env %d",xa.ip,xa.env),$a("LinkLoginRequest",{sid:xa.context.sid,userId:xa.context.uid,lts:D.fromNumber(Date.now()),elapse:Nb(xa.context.startTime),destServerIp:xa.ip,linkId:xa.env},(ga=xa.context.config.enableCloudProxy||xa.context.socketUseProxy)!==null&&ga!==void 0&&ga),$a("LinkLoginRequest",{sid:xa.context.sid,userId:xa.context.uid,lts:D.fromNumber(Date.now()),elapse:Nb(xa.context.startTime),destServerIp:xa.ip,linkId:xa.env},(ba=xa.context.config.enableCloudProxy||xa.context.socketUseProxy)!==null&&ba!==void 0&&ba);var Tl=Nc(xa.input$,xa.userJoin$.pipe(kC(2)),xa.message$).pipe(Wa(function(Sl){return gl.encode(Sl).finish()}));return _=Nc(lC("",{protocols:[],makeWebSocket:function(){if(xa.context.config.enableCloudProxy||xa.context.socketUseProxy){if(xa.context.cloudProxyServers.length===0)throw xa.logError("No cloud proxy server to connect"),new Pa;var Sl=ui(null)?JSON.parse(null.replace(/-/g,".")):xa.context.cloudProxyServers;Sl=dh(Sl="wss://".concat(Ds(Es(Sl),!1),"/"),"sid",xa.context.sid),Sl=dh(Sl,"remote_port",El.toString()),Sl=dh(Sl,"remote_ip",xa.ip),Sl=dh(Sl,"token",xa.context.key),Sl=new WebSocket(Sl)}else Sl=new WebSocket("wss://".concat(xa.getDomain(),":").concat(El));return Sl.binaryType="arraybuffer",Sl}}),xa.toReconnect),xa.socket$=bb(_,ap.pipe(Oc(7e3),Rb(function(Sl){return uc(Sl)&&xa.warn("socket open timed out"),Va(Sl)}))).pipe(Wa(function(Sl){if(Sl instanceof Error)throw xa.warn("Env_%d: Force reconnect the socket",xa.env),Sl;return Sl(Tl).pipe(Wa(function(Il){return gl.decode(new Uint8Array(Il))}))}),xa.socketReconnector),xa.open$=xa.socket$.pipe(Ka(function(Sl){xa.log("Websocket opened",xa.name),Sl.subscribe(function(Il){var Cl=Il.data;Il=Tm[Il.uri].slice(0,-3),Cl=Cs[Il].decode(Cl);var Nl=UI({},Oo(Cl,"toJSON"),function(Jl,Ep){return Ep instanceof D?rs(Ep):Ep}),Dl=!1;if((Cl instanceof bx||Cl instanceof ax)&&Cl.instance.lessThanOrEqual(4294967295)&&(Dl=!0),Cl instanceof cx||Cl instanceof dx){var Ul=Cl.instance,Kl=Cl.sequence;(Cl.dialogue.lessThanOrEqual(4294967295)||Ul.lessThanOrEqual(4294967295)||Kl.lessThan(1))&&(Dl=!0)}Dl?xa.warn("Env_%d: Illegal %s, abandoned %o",xa.env,Il,Nl):(Il!=="Pong"&&xa.receiveLogger("Env_%d: %s %o",xa.env,Il,Nl),xa.receivedPacket.next([Il,Cl]))},function(){})}),ni(void 0),he(xa.toClose),$g()),xa}nb(i,h);var g=ob(i);return Qb(i,[{key:"address",get:function(){return"".concat(this.ip,":").concat(Jh[this.env])}},{key:"sendPacket",value:function(_,j){if(_!=="Ping"){var $=Pe(j,function(_n){return _n instanceof D?rs(_n):_n});this.sendLogger("Env_%d: %s %o",this.env,_,$)}j=vC(_,j),_==="UserJoin"?this.userJoin$.next(j):_==="Message"?this.message$.next(j):this.input$.next(j)}},{key:"close",value:function(){this.isActiveClose=!0,this.loggedIn=!1,this.toClose.next()}},{key:"fromReceived",value:function(_){return this.receivedPacket.pipe(sc(function(j){return Lb(j,1)[0]===_}),Wa(function(j){return Lb(j,2)[1]}))}},{key:"forceReconnect",value:function(){this.toReconnect.next(new Cx({FORCE_RECONNECTING:"Connection seems broken, try force reconnecting"}))}}]),i}(Dd());wa({target:"String",proto:!0,forced:fx},{padStart:function(h){return vK(this,h,1<arguments.length?arguments[1]:void 0)}});var vL=function(h){var i=vi(Yj);h=qC(h);for(var g=0;g<i.length;g++){var _=Yj[i[g]];if(_!=null&&_.AP_DOMAINS.includes(h)||_!=null&&_.AP_BACKUP_DOMAINS.includes(h)||_!=null&&_.PROXY_AP.includes(h))return[_.CODE]}return[oa.CHINA,oa.GLOBAL]},wL={INVALID_APP_ID:"Illegal App ID",NO_AUTHORIZED:"Signature verification failed",TOKEN_TIMEOUT:"Dynamic key expired",INVALID_TOKEN_UID:"UID in the security key(token) is not valid",APP_ID_NO_ACTIVATED:"The vendor is not activated",DYNAMIC_KEY_NOT_ENABLED:"The vendor did not enable the dynamic key, but uses the dynamic key",DYNAMIC_ENABLED_BUT_STATIC_KEY:"The vendor enabled the dynamic key, but uses the static key",TOKEN_EXPIRED:"The token has expired",INVALID_USER_ID:"The user ID to login does not match the token",FORBIDDEN_REGION:"Forbidden to access the request in this area",CANNOT_MEET_AREA_DEMAND:"Cannot allocate to meet the requirements of the given area limit"},Dx={5:"INVALID_APP_ID",7:"INVALID_USER_ID",9:"NO_AUTHORIZED",10:"TOKEN_TIMEOUT",11:"APP_ID_NO_ACTIVATED",12:"INVALID_TOKEN_UID",13:"TOKEN_EXPIRED",14:"DYNAMIC_KEY_NOT_ENABLED",15:"DYNAMIC_ENABLED_BUT_STATIC_KEY",18:"FORBIDDEN_REGION",19:"CANNOT_MEET_AREA_DEMAND"},xL=[100,101,102],jl=/web-(\d)/,Ex=function(h){function i(_,j){var $=2<arguments.length&&arguments[2]!==void 0&&arguments[2];ab(this,i);var _n=g.call(this,j,"AccessPoint");return E(L(_n),"handleUniLbsError",function(_i,_s){var ga=_i;if(4<_i.toString().length){var ba=_i.toString().padStart(8,"0"),xa=parseInt(ba.slice(0,4),10);if(ba=parseInt(ba.slice(4,8),10),xa===201)ga=ba;else if(xa===101&&!xL.includes(ba))return Va(Error("service is currently unavailable"))}if(xa=ga.toString(),!Object.keys(Dx).includes(xa))return(_i=new Pa(["Login is rejected by the server. The response code is %d",_i],ij)).serverCode=ga,Va(_i);switch(xa=Dx[xa],ga=wL[xa],xa){case"INVALID_APP_ID":case"APP_ID_NO_ACTIVATED":return(_s=new Gh(ga,Fw)).serverCode=_i,Va(_s);case"INVALID_USER_ID":return(_s=new Gh(ga,al)).serverCode=_i,Va(_s);case"TOKEN_EXPIRED":case"TOKEN_TIMEOUT":return(_s=new Gh(ga,bl)).serverCode=_i,Va(_s);case"NO_AUTHORIZED":case"INVALID_TOKEN_UID":case"DYNAMIC_KEY_NOT_ENABLED":case"DYNAMIC_ENABLED_BUT_STATIC_KEY":return(_s=new Gh(ga,Gw)).serverCode=_i,Va(_s);case"CANNOT_MEET_AREA_DEMAND":return(_s=vL(_s)).forEach(function(El){return _n.failedAreas.add(El)}),_n.failedAreas.size===(Ba===void 0?2:Ba.CODES.size)?((_s=new ja(ga,ij)).serverCode=_i,Va(_s)):Va(Error("ap ".concat(_s.join(", ")," cannot meet requirement")));case"FORBIDDEN_REGION":return(_s=new Pa(ga,ij)).serverCode=_i,Va(_s);default:return Va(ps("ApResErrType",xa))}}),E(L(_n),"getApEdgeInfo$",void 0),E(L(_n),"getApEdgeInfoEndFirst$",void 0),E(L(_n),"apFinish$",new ec),E(L(_n),"retryCount",0),E(L(_n),"failedAreas",new Set),E(L(_n),"usedUrl",[]),E(L(_n),"newDomainUsed",!1),E(L(_n),"backupNewDomainUsed",!1),E(L(_n),"genUrl",function(){return Ba===void 0?zm.apply(void 0,ra(Ih([cL,dL]))).pipe(Am(function(_i){return Wb.apply(void 0,ra(_i))})):Wb.apply(void 0,ra(Ba.AP_DOMAINS.slice(0,3).map(xg)))}),E(L(_n),"genBackupUrl",function(){return Ba===void 0?zm.apply(void 0,ra(Ih([eL,fL]))).pipe(Am(function(_i){return Wb.apply(void 0,ra(_i))})):Wb.apply(void 0,ra(Ba.AP_BACKUP_DOMAINS.slice(0,3).map(xg)))}),E(L(_n),"getApUrl$",function(_i){var _s,ga;return _n.genUrl().pipe(sc(function(ba){return(!_n.newDomainUsed||!ba.includes("sd-rtn.com"))&&(ba.includes("sd-rtn.com")&&(_n.newDomainUsed=!0),!mp(_n.usedUrl,function(xa){var El;return xa===((El=ba.match(jl))===null||El===void 0?void 0:El[1])}))}),Ka(function(ba){var xa;Ba===void 0&&typeof(ba=(xa=ba.match(jl))===null||xa===void 0?void 0:xa[1])=="string"&&_n.usedUrl.push(ba)}),Xb(_i?Math.max(Yd.RECONNECTING_AP_NUM,(_s=Ba==null?void 0:Ba.CODES.size)!==null&&_s!==void 0?_s:0):(ga=Ba==null?void 0:Ba.CODES.size)!==null&&ga!==void 0?ga:2),Zf(function(){return i.runOutOfUrlSymbol}),Rb(function(ba,xa){return _n.newDomainUsed=!1,ba===i.runOutOfUrlSymbol?(_n.usedUrl=[],xa):Va(ba)}))}),E(L(_n),"getBackupApUrl$",function(_i){var _s,ga;return _n.genBackupUrl().pipe(sc(function(ba){return(!_n.backupNewDomainUsed||!ba.includes("sd-rtn.com"))&&(ba.includes("sd-rtn.com")&&(_n.backupNewDomainUsed=!0),!mp(_n.usedUrl,function(xa){var El;return xa===((El=ba.match(jl))===null||El===void 0?void 0:El[1])}))}),Ka(function(ba){var xa;Ba===void 0&&typeof(ba=(xa=ba.match(jl))===null||xa===void 0?void 0:xa[1])=="string"&&_n.usedUrl.push(ba)}),Xb(_i?Math.max(Yd.RECONNECTING_AP_NUM,(_s=Ba==null?void 0:Ba.CODES.size)!==null&&_s!==void 0?_s:0):(ga=Ba==null?void 0:Ba.CODES.size)!==null&&ga!==void 0?ga:2),Zf(function(){return i.runOutOfUrlSymbol}),Rb(function(ba,xa){return _n.backupNewDomainUsed=!1,ba===i.runOutOfUrlSymbol?(_n.usedUrl=[],xa):Va(ba)}))}),E(L(_n),"getProxyApUrl$",function(_i){var _s,ga;return Wb.apply(void 0,ra(((Ba==null?void 0:Ba.PROXY_AP.slice(0,3))||["ap-proxy-1.agora.io","ap-proxy-2.agora.io"]).map(xg))).pipe(Xb(_i?Math.max(Yd.RECONNECTING_AP_NUM,(_s=Ba==null?void 0:Ba.CODES.size)!==null&&_s!==void 0?_s:0):(ga=Ba==null?void 0:Ba.CODES.size)!==null&&ga!==void 0?ga:2))}),E(L(_n),"context",void 0),E(L(_n),"fetchCloudProxy",function(_i,_s){var ga=Pm("AP-",_n.loggerId);_n.log("The AccessPoint requests %s(%s)",_i,ga);var ba,xa=new AbortController;return _n.apFinish$.pipe(Xb(1)).subscribe(function(){return xa.abort()}),lf(za(W.mark(function El(){var Tl,Sl;return W.wrap(function(Il){for(;;)switch(Il.prev=Il.next){case 0:return Sl=Qj(0,Number.MAX_SAFE_INTEGER),_n.log("%s request opid: %d",ga,Sl),$a("ApRequest",{sid:_n.context.sid,userId:_n.context.uid,lts:D.fromNumber(Date.now()),elapse:Nb(_n.context.startTime),apAddr:_i,opId:D.fromNumber(Sl),envId:0,flag:128},(Tl=_n.context.config.enableCloudProxy)!==null&&Tl!==void 0&&Tl),Il.abrupt("return",Tj(_i,{headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"90","Content-Type":"application/json"},body:{sid:_n.context.sid,opid:Sl,appid:_n.context.appId,client_ts:Math.ceil(Date.now()/1e3),request_bodies:[{uri:22,buffer:{service_ids:[7,16],key:_s??_n.context.key,cname:_n.context.uid,uid:0,detail:tb({},Ba===void 0?{11:[oa.CHINA,oa.GLOBAL].join(),12:"1"}:{11:Array.from(Ba.CODES).map(function(Cl){return Cl===oa.OVERSEA?"".concat(oa.ASIA,",").concat(oa.EUROPE,",").concat(oa.AFRICA,",").concat(oa.NORTH_AMERICA,",").concat(oa.SOUTH_AMERICA,",").concat(oa.OCEANIA):Cl}).join(","),12:"1"})}}]},signal:xa.signal}));case 4:case"end":return Il.stop()}},El)}))).pipe(Rb(function(El){return El.name!=="AbortError"&&(_n.logError(El),_n.warn("The AP server %s request failure",_i,El)),$c}),Ac((ba=za(W.mark(function El(Tl){var Sl,Il,Cl,Nl,Dl,Ul,Kl,Jl,Ep,_p,Ip,Up,yp,Ap,Cp,Mp,wp,Np,Fp;return W.wrap(function(Hp){for(;;)switch(Hp.prev=Hp.next){case 0:if(Sl=Tl.responseText,Il=JSON.parse(Sl),_n.log("The %s response is %o",ga,Il),((Cl=Il.response_body)===void 0||Cl.length===0||Cl.some(function(xp){var Gp;return((Gp=xp.buffer)===null||Gp===void 0?void 0:Gp.code)===void 0||xp.uri!==23}))&&Va(new Pa("cloud proxy response_body not valid",ij)),(Nl=Cl.filter(function(xp){return xp.buffer.code!==0})).length===0){Hp.next=14;break}if((Dl=Nl.find(function(xp){return xp.buffer.flag===128}))===void 0){Hp.next=12;break}return Hp.abrupt("return",_n.handleUniLbsError(Dl.buffer.code,_i));case 12:return _n.logError("cloud proxy error response"),Hp.abrupt("return",_n.handleUniLbsError(Nl[0].buffer.code,_i));case 14:for(Ul=[],Kl=0;Kl<Cl.length;Kl++)if(((_p=Cl[Kl])==null||(Jl=_p.buffer)===null||Jl===void 0?void 0:Jl.flag)===262144)(Ip=_p.buffer)===null||Ip===void 0||(Up=Ip.edges_services)===null||Up===void 0||(yp=Up.forEach)===null||yp===void 0||yp.call(Up,function(xp){ns(xp=xp.ip)&&_n.context.cloudProxyServers.indexOf(xp)===-1&&(_n.log("got cloud proxy server: %s",xp),_n.context.cloudProxyServers.push(xp))});else if((_p==null||(Ep=_p.buffer)===null||Ep===void 0?void 0:Ep.flag)===128){for(wp=function(xp,Gp){var $p=Gp[xp];Ul.some(function(c0){return c0.ip===$p.ip})||Ul.push({ip:$p.ip,ticket:_p.buffer.cert})},Np=0,Fp=_p.buffer.edges_services;Np<Fp.length;Np++)wp(Np,Fp);_n.context.rtmArea=(Ap=(Cp=_p.buffer)===null||Cp===void 0||(Mp=Cp.detail)===null||Mp===void 0?void 0:Mp[9])!==null&&Ap!==void 0?Ap:""}return Hp.abrupt("return",Wb.apply(void 0,ra(Ul).concat([fj])));case 19:case"end":return Hp.stop()}},El)})),function(El){return ba.apply(this,arguments)})),Rb(function(El){return Sa(El)?Va(El):$c}),Ij(),sc(function(El){return El!==void 0&&typeof El.ip=="string"&&typeof El.ticket=="string"&&ns(El.ip)}))}),E(L(_n),"fetchAp",function(_i,_s){var ga=Pm("AP-",_n.loggerId);_n.log("The AccessPoint requests %s(%s)",_i,ga);var ba=new AbortController;_n.apFinish$.pipe(Xb(1)).subscribe(function(){return ba.abort()});var xa,El=Qj(0,Number.MAX_SAFE_INTEGER);return lf(za(W.mark(function Tl(){var Sl;return W.wrap(function(Il){for(;;)switch(Il.prev=Il.next){case 0:return _n.log("%s request opid: %d",ga,El),$a("ApRequest",{sid:_n.context.sid,userId:_n.context.uid,lts:D.fromNumber(Date.now()),elapse:Nb(_n.context.startTime),apAddr:_i,opId:D.fromNumber(El),envId:0,flag:128},(Sl=_n.context.config.enableCloudProxy)!==null&&Sl!==void 0&&Sl),Il.abrupt("return",Tj(_i,{headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"69","Content-Type":"application/json"},body:{flag:128,opid:El,key:_s||_n.context.key,cname:_n.context.uid,detail:tb({},Ba===void 0?{11:[oa.CHINA,oa.GLOBAL].join(),12:"1"}:{11:Array.from(Ba.CODES).map(function(Cl){return Cl===oa.OVERSEA?"".concat(oa.ASIA,",").concat(oa.EUROPE,",").concat(oa.AFRICA,",").concat(oa.NORTH_AMERICA,",").concat(oa.SOUTH_AMERICA,",").concat(oa.OCEANIA):Cl}).join(","),12:"1"}),uid:0,sid:_n.context.sid},signal:ba.signal}));case 3:case"end":return Il.stop()}},Tl)}))).pipe(Rb(function(Tl){return Tl.name!=="AbortError"&&(_n.logError(Tl),_n.warn("The AP server %s request failure",_i,Tl)),$c}),Ac((xa=za(W.mark(function Tl(Sl){var Il,Cl,Nl,Dl,Ul,Kl,Jl,Ep,_p,Ip;return W.wrap(function(Up){for(;;)switch(Up.prev=Up.next){case 0:if(Nl=Sl.responseText,Dl=JSON.parse(Nl),_n.log("The %s response is %o",ga,Dl),Kl=(Ul=Dl).code,Jl=Ul.addresses,Ep=Ul.detail,_n.context.vid=(Il=Ep[8])!==null&&Il!==void 0?Il:"",$a("ApEvent",{sid:_n.context.sid,userId:_n.context.uid,lts:D.fromNumber(Date.now()),elapse:Nb(_n.context.startTime),apAddr:_i,linkServerList:Jl.map(function(yp){return yp.ip}),serverErrCode:Kl,flag:128,envId:0,opId:D.fromNumber(El),errCode:0,area:Ep[9],isp:Ep[2]},(Cl=_n.context.config.enableCloudProxy)!==null&&Cl!==void 0&&Cl),_n.info(Dl),Kl===0){Up.next=9;break}return Up.abrupt("return",_n.handleUniLbsError(Kl,_i));case 9:if(_p=Jl,ui(null)&&(Ip=JSON.parse(null.replace(/-/g,".")),_p=Ip.map(function(yp){return{ip:yp,ticket:_p[0].ticket}})),_p.length!==0){Up.next=14;break}return Up.abrupt("return",Va(Error("No available edge address to connect")));case 14:return _n.context.rtmArea=Ep==null?void 0:Ep[9],Up.abrupt("return",Wb.apply(void 0,ra(_p).concat([fj])));case 16:case"end":return Up.stop()}},Tl)})),function(Tl){return xa.apply(this,arguments)})),Ij(),Rb(function(Tl){return Sa(Tl)?Va(Tl):$c}),sc(function(Tl){return Tl!==void 0&&typeof Tl.ip=="string"&&typeof Tl.ticket=="string"}))}),_n.context=_,_n.getApEdgeInfoEndFirst$=function(){var _i=0<arguments.length&&arguments[0]!==void 0&&arguments[0];return Fe(0,_i||$?Yd.RECONNECTING_AP_INTERVAL:2e3).pipe(Xb(1),Ka(function(){_n.retryCount+=1}),Ac(function(){return _n.context.config.enableCloudProxy||_n.context.socketUseProxy?_n.getProxyApUrl$(_i||$):(4<=_n.retryCount&&(_n.retryCount=0),3>=_n.retryCount?_n.getApUrl$(_i||$):_n.getBackupApUrl$(_i||$))}),Ac(function(_s){return _n.context.config.enableCloudProxy||_n.context.socketUseProxy?_n.fetchCloudProxy(_s):_n.fetchAp(_s)}),Rb(function(_s){return _s instanceof ad&&_n.warn("AP request timeout"),Va(_s)}),Vr(function(_s){return _s.ip}),he(_n.apFinish$))},_n.getApEdgeInfo$=function(_i){return Fe(0,_i||$?Yd.RECONNECTING_AP_INTERVAL:2e3).pipe(Xb(8),Ka(function(){_n.retryCount+=1}),Ac(function(){return _n.context.config.enableCloudProxy||_n.context.socketUseProxy?_n.getProxyApUrl$(_i||$):3>=_n.retryCount?_n.getApUrl$(_i||$):_n.getBackupApUrl$(_i||$)}),Ac(function(_s){return(_n.context.config.enableCloudProxy||_n.context.socketUseProxy?_n.fetchCloudProxy(_s):_n.fetchAp(_s)).pipe()}),Rb(function(_s){return _s instanceof ad&&_n.warn("AP request timeout"),Va(_s)}),Vr(function(_s){return _s.ip}),he(_n.apFinish$))},_n}nb(i,h);var g=ob(i);return Qb(i,[{key:"clearUp",value:function(){this.failedAreas.clear(),this.retryCount=0}}]),i}(Dd());E(Ex,"runOutOfUrlSymbol",Symbol("AP urls are used up"));var Fx=il(),Gx=function(h){function i(_,j,$){ab(this,i);var _n=g.call(this,j,"Connection");E(L(_n),"apClient",void 0),E(L(_n),"lastOpenSockets",[new ah(1),new ah(1)]),E(L(_n),"curOpenSockets",[void 0,void 0]),E(L(_n),"ipIterator",0),E(L(_n),"loginSocketOpenFailureCount",0),E(L(_n),"firstEnv",.5<=Math.random()?1:0),E(L(_n),"firstSocketOpener",void 0),E(L(_n),"secondSocketOpener",void 0),E(L(_n),"firstOpenKeeperSubject",new ec),E(L(_n),"secondOpenKeeperSubject",new ec),E(L(_n),"blacklistedIP",{}),E(L(_n),"edgeInfoReplayed",void 0),E(L(_n),"firstEnvOpenSocket",void 0),E(L(_n),"firstOpenKeeperSub",void 0),E(L(_n),"secondOpenKeeperSub",void 0),E(L(_n),"context",void 0),E(L(_n),"logger",void 0),_n.context=_,_n.logger=j,_n.apClient=new Ex(_n.context,j),_n.apClient.apFinish$.subscribe(function(){_n.log("Ap client fetch finished")});var _i,_s=[];return _n.edgeInfoReplayed=_n.apClient.getApEdgeInfo$($).pipe(Zg(function(ga){return ga.pipe(Ka(function(ba){if(Sa(ba))throw ba}),mf($?wg.getParameter("RECONNECTING_AP_INTERVAL"):900),he(Fe(2e4)))}),sc(function(ga){var ba;return!mp(_s,ga)&&1>=((ba=_n.blacklistedIP[ga.ip])!==null&&ba!==void 0?ba:0)}),Zf(function(){return new Fx({AP_NO_AVAILABLE_EDGE:"No available edge address to connect"})}),Ka(function(ga){_s.push(ga),_n.log("An edge info got %o",ga)}),Ka({error:function(ga){_n.emit("connectionInitFailure",ga)}}),Mj(function(){_n.apClient.clearUp()}),Yr()),_n.firstEnvOpenSocket=_n.edgeInfoReplayed.pipe(Ac(function(ga){if(ga===void 0)return Va(Error("Invalid edge info"));var ba=new sp(ga.ip,_n.firstEnv,ga.ticket,_n.context,j,_i);if(_n.firstEnv=_n.firstEnv===1?0:1,ba.once("connectionFailure",function(){return _n.onSocketConnectionFailure(ba)}),!$&&Yd.ENABLE_EDGE_AUTO_FALLBACK&&!_n.context.config.enableCloudProxy){var xa,El=Date.now();ba.on("reconnect",function(){var Tl;_n.loginSocketOpenFailureCount+=1,(Tl=xa)!==null&&Tl!==void 0||(xa=Date.now()-El),500>xa&&1<_n.loginSocketOpenFailureCount&&(_n.context.socketUseProxy=!0)})}return _i=!ba.useNewDomain,ba.open$.pipe(ni(ba))}),Ka(function(ga){_n.log("The websocket of ENV_%d opened to %s:%d",ga.env,ga.ip,Jh[ga.env]),_n.curOpenSockets[ga.env]=ga,_n.lastOpenSockets[ga.env].next(ga),_n.firstEnv=ga.env,_n.openSecondSocket(ga.env,ga.ip,ga.useNewDomain)}),Xb(1),$g()),_n.firstSocketOpener=_n.firstEnvOpenSocket.pipe(Ac(function(ga){return ga.open$.pipe(Ka(function(){_n.log("The websocket of first ENV_%d re-opened to %s:%d",ga.env,ga.ip,Jh[ga.env]),_n.curOpenSockets[ga.env]=ga,_n.lastOpenSockets[ga.env].next(ga)}))})),_=_n.firstOpenKeeperSubject.pipe(Cc(jf)),_n.firstOpenKeeperSub=_.subscribe({error:_n.logError}),_n}nb(i,h);var g=ob(i);return Qb(i,[{key:"initConnection",value:function(){this.firstOpenKeeperSubject.next(this.firstSocketOpener)}},{key:"closeSocket",value:function(_,j){if(![0,1].includes(_))throw new rb({INVALID_ENV:"The env argument is not 0 or 1"});var $=_===this.firstEnv?this.firstOpenKeeperSub:this.secondOpenKeeperSub;this.firstOpenKeeperSub=void 0;var _n=this.curOpenSockets[_];this.curOpenSockets[_]=void 0,_n&&(_n.isActiveClose=!0,setTimeout(function(){_n.close()},j)),$!==void 0&&setTimeout(function(){$==null||$.unsubscribe()},j)}},{key:"waitClosing",value:function(_){var j=this;return _.isActiveClose=!0,_.open$.pipe(PB(),Rb(function($){return $.message===Tw.normalClosureMessage?$c:Va($)}),Oc(5e3),Rb(function($){return $ instanceof ad?(j.warn("Force closing the ENV_%d connection",_.env),$c):Va($)}))}},{key:"onSocketConnectionFailure",value:function(_){var j=[0,1].filter(function($){return $!==_.env})[0];(j=this.curOpenSockets[j])&&j.loggedIn?this.reopenSocketWithApRequest(_.env):this.emit("socketsFailure")}},{key:"openSecondSocket",value:function(_,j,$){var _n=this,_i=_===1?0:1;this.secondSocketOpener=this.edgeInfoReplayed.pipe(Xr(function(_s,ga){return[].concat(ra(_s),[ga])},[]),Wa(function(_s){return Rw(_s,function(ga){return qs(j,ga.ip)}).slice(-1)[0]}),Xb(1),Ac(function(_s){if(_s===void 0)return Va(Error("Invalid edge info"));var ga=new sp(_s.ip,_i,_s.ticket,_n.context,_n.logger,$);return ga.on("connectionFailure",function(){return _n.onSocketConnectionFailure(ga)}),ga.open$.pipe(Ka(function(){_n.lastOpenSockets[_i].next(ga),_n.curOpenSockets[_i]=ga}))}),$g()),this.secondOpenKeeperSub=this.secondOpenKeeperSubject.pipe(Cc(jf)).subscribe({error:this.logError}),this.secondOpenKeeperSubject.next(this.secondSocketOpener)}},{key:"reopenSocketWithApRequest",value:function(_){var j=this,$=[0,1].filter(function(_s){return _s!==_})[0];if(($=this.curOpenSockets[$])!==void 0){var _n,_i=$.ip;$=this.apClient.getApEdgeInfoEndFirst$(!0).pipe(Zf(function(){return new Fx({AP_NO_AVAILABLE_EDGE:"No available edge address to connect"})}),Zg(function(_s){return _s.pipe(Ka(function(ga){if(ga.code===bl)j.emit("tokenExpired"),j.apClient.apFinish$.next(void 0);else if(Sa(ga))throw ga}),mf(wg.getParameter("RECONNECTING_AP_INTERVAL")),he(Fe(15e3)))}),Ka(function(_s){j.log("An edge info got %o",_s)}),Mj(function(){j.apClient.clearUp()})).pipe(Xr(function(_s,ga){return[].concat(ra(_s),[ga])},[]),Wa(function(_s){return(_s=Rw(_s,function(ga){return qs(_i,ga.ip)})).length-1>=j.ipIterator?_s.slice(-j.ipIterator++-1)[0]:(j.ipIterator=0,_s.slice(-1)[0])}),Zf(),Ac(function(_s){if(_s===void 0)return Va(Error("Invalid edge info"));var ga=new sp(_s.ip,_,_s.ticket,j.context,j.logger,_n);return ga.on("connectionFailure",function(){return j.onSocketConnectionFailure(ga)}),_n=!ga.useNewDomain,ga.open$.pipe(ni(ga))}),Ka(function(_s){j.log("The websocket of ENV_%d re-opened to %s:%d using ap",_s.env,_s.ip,Jh[_s.env]),j.curOpenSockets[_]=_s,j.lastOpenSockets[_].next(_s)}),Ac(function(_s){return _s.open$.pipe(Ka(function(){j.log("The websocket of ENV_%d re-opened to %s:%d",_s.env,_s.ip,Jh[_s.env]),j.curOpenSockets[_]=_s,j.lastOpenSockets[_].next(_s)}))}),$g()),_===this.firstEnv?this.firstOpenKeeperSubject.next($):this.secondOpenKeeperSubject.next($)}}}]),i}(Dd()),yL=function(h){function i(_,j,$){return ab(this,i),E(L($=g.call(this,$,"Context")),"_token",void 0),E(L($),"config",void 0),E(L($),"_uid",void 0),E(L($),"_sid",void 0),E(L($),"_vid",void 0),E(L($),"_startTime",void 0),E(L($),"_lastModifyMeteDataTime",-1),E(L($),"_lastGetMetaDataTime",-1),E(L($),"_lastSubscribeMetaDataTime",-1),E(L($),"_area","CN"),E(L($),"_socketUseProxy",!1),E(L($),"appId",void 0),E(L($),"enableCloudProxy",!1),E(L($),"cloudProxyServers",[]),$.appId=_,$.config=j,$}nb(i,h);var g=ob(i);return Qb(i,[{key:"socketUseProxy",get:function(){return this._socketUseProxy&&Yd.ENABLE_EDGE_AUTO_FALLBACK},set:function(_){this.log("socketUseProxy is set to %s",_),this._socketUseProxy=_}},{key:"token",set:function(_){this._token=typeof _=="string"&&_?_:void 0}},{key:"uid",get:function(){if(typeof this._uid=="string"&&this._uid)return this._uid;throw new Ib("Cannot get illegal uid")},set:function(_){if(this.log("The user ID is set to %s",wb(_)),!yb(_))throw new Ib;this._uid=_}},{key:"vid",get:function(){if(typeof this._vid=="string")return this._vid;throw new Ib("Cannot get illegal vid")},set:function(_){if(typeof _!="string")throw new Ib;this._vid=_}},{key:"key",get:function(){if(typeof this._token=="string"&&this._token)return this._token;if(typeof this.appId=="string"&&this.appId)return this.appId;throw new Ib("Cannot get illegal key")}},{key:"sid",get:function(){if(typeof this._sid=="string"&&this._sid)return this._sid;throw new Ib("Cannot get illegal sid")},set:function(_){if(this.log("sid is set to %s",_),typeof _!="string"||!_)throw new Ib;this._sid=_}},{key:"startTime",get:function(){if(typeof this._startTime=="number"&&this._startTime)return this._startTime;throw new Ib("Cannot get illegal startTime")},set:function(_){if(this.log("startTime is set to %s",_),typeof _!="number"||!_)throw new Ib;this._startTime=_}},{key:"rtmArea",get:function(){if(typeof this._area=="string"&&this._area)return this._area;throw new Ib("Cannot get illegal area")},set:function(_){this.log("area is set to %s",_),typeof _=="string"&&_?this._area=_:this.warn("set area failed")}},{key:"lastModifyMeteDataTime",get:function(){if(typeof this._lastModifyMeteDataTime=="number"&&this._lastModifyMeteDataTime)return this._lastModifyMeteDataTime;throw new Ib("Cannot get illegal lastModifyMeteDataTime")},set:function(_){if(this.log("lastModifyMeteDataTime is set to %s",_),typeof _!="number"||!_)throw new Ib;this._lastModifyMeteDataTime=_}},{key:"lastGetMetaDataTime",get:function(){if(typeof this._lastGetMetaDataTime=="number"&&this._lastGetMetaDataTime)return this._lastGetMetaDataTime;throw new Ib("Cannot get illegal lastGetMetaDataTime")},set:function(_){if(this.log("lastGetMetaDataTime is set to %s",_),typeof _!="number"||!_)throw new Ib;this._lastGetMetaDataTime=_}},{key:"lastSubscribeMetaDataTime",get:function(){if(typeof this._lastSubscribeMetaDataTime=="number"&&this._lastSubscribeMetaDataTime)return this._lastSubscribeMetaDataTime;throw new Ib("Cannot get illegal lastSubscribeMetaDataTime")},set:function(_){if(this.log("lastSubscribeMetaDataTime is set to %s",_),typeof _!="number"||!_)throw new Ib;this._lastGetMetaDataTime=_}}]),i}(Dd());tu("of",function(){for(var h=0,i=arguments.length,g=new(wh(this))(i);i>h;)g[h]=arguments[h++];return g},Nn),wa({target:"Array",proto:!0,forced:Rn!==[].lastIndexOf},{lastIndexOf:Rn}),wa({target:"Array",proto:!0},{flatMap:function(h){var i=Zb(this),g=xb(i.length);Rc(h);var _=Ei(i,0);return _.length=px(_,i,i,g,0,1,h,1<arguments.length?arguments[1]:void 0),_}}),wf("flatMap");var zL=gg("reduceRight"),AL=!qe&&79<oe&&83>oe;wa({target:"Array",proto:!0,forced:!zL||AL},{reduceRight:function(h){return Cu(this,h,arguments.length,1<arguments.length?arguments[1]:void 0)}});var tp=function(h){return Ga(function(){return!!`	
\v\f\r                　\u2028\u2029\uFEFF`[h]()||"​᠎"[h]()!="​᠎"||`	
\v\f\r                　\u2028\u2029\uFEFF`[h].name!==h})};wa({target:"String",proto:!0,forced:tp("trim")},{trim:function(){return kk(this)}});var Hx=tp("trimEnd"),Ix=Hx?function(){return lD(this)}:"".trimEnd;wa({target:"String",proto:!0,forced:Hx},{trimEnd:Ix,trimRight:Ix});var Jx=tp("trimStart"),Kx=Jx?function(){return kD(this)}:"".trimStart;wa({target:"String",proto:!0,forced:Jx},{trimStart:Kx,trimLeft:Kx});var Pd=kc(function(h,i){(function(){function g(Xp,a0,zl){switch(zl.length){case 0:return Xp.call(a0);case 1:return Xp.call(a0,zl[0]);case 2:return Xp.call(a0,zl[0],zl[1]);case 3:return Xp.call(a0,zl[0],zl[1],zl[2])}return Xp.apply(a0,zl)}function _(Xp,a0,zl,M0){for(var V0=-1,T0=Xp==null?0:Xp.length;++V0<T0;){var T_=Xp[V0];a0(M0,T_,zl(T_),Xp)}return M0}function j(Xp,a0){for(var zl=-1,M0=Xp==null?0:Xp.length;++zl<M0&&a0(Xp[zl],zl,Xp)!==!1;);return Xp}function $(Xp,a0){for(var zl=Xp==null?0:Xp.length;zl--&&a0(Xp[zl],zl,Xp)!==!1;);return Xp}function _n(Xp,a0){for(var zl=-1,M0=Xp==null?0:Xp.length;++zl<M0;)if(!a0(Xp[zl],zl,Xp))return!1;return!0}function _i(Xp,a0){for(var zl=-1,M0=Xp==null?0:Xp.length,V0=0,T0=[];++zl<M0;){var T_=Xp[zl];a0(T_,zl,Xp)&&(T0[V0++]=T_)}return T0}function _s(Xp,a0){return!(Xp==null||!Xp.length)&&-1<Nl(Xp,a0,0)}function ga(Xp,a0,zl){for(var M0=-1,V0=Xp==null?0:Xp.length;++M0<V0;)if(zl(a0,Xp[M0]))return!0;return!1}function ba(Xp,a0){for(var zl=-1,M0=Xp==null?0:Xp.length,V0=Array(M0);++zl<M0;)V0[zl]=a0(Xp[zl],zl,Xp);return V0}function xa(Xp,a0){for(var zl=-1,M0=a0.length,V0=Xp.length;++zl<M0;)Xp[V0+zl]=a0[zl];return Xp}function El(Xp,a0,zl,M0){var V0=-1,T0=Xp==null?0:Xp.length;for(M0&&T0&&(zl=Xp[++V0]);++V0<T0;)zl=a0(zl,Xp[V0],V0,Xp);return zl}function Tl(Xp,a0,zl,M0){var V0=Xp==null?0:Xp.length;for(M0&&V0&&(zl=Xp[--V0]);V0--;)zl=a0(zl,Xp[V0],V0,Xp);return zl}function Sl(Xp,a0){for(var zl=-1,M0=Xp==null?0:Xp.length;++zl<M0;)if(a0(Xp[zl],zl,Xp))return!0;return!1}function Il(Xp,a0,zl){var M0;return zl(Xp,function(V0,T0,T_){if(a0(V0,T0,T_))return M0=T0,!1}),M0}function Cl(Xp,a0,zl,M0){var V0=Xp.length;for(zl+=M0?1:-1;M0?zl--:++zl<V0;)if(a0(Xp[zl],zl,Xp))return zl;return-1}function Nl(Xp,a0,zl){if(a0==a0)e:{--zl;for(var M0=Xp.length;++zl<M0;)if(Xp[zl]===a0){Xp=zl;break e}Xp=-1}else Xp=Cl(Xp,Ul,zl);return Xp}function Dl(Xp,a0,zl,M0){--zl;for(var V0=Xp.length;++zl<V0;)if(M0(Xp[zl],a0))return zl;return-1}function Ul(Xp){return Xp!=Xp}function Kl(Xp,a0){var zl=Xp==null?0:Xp.length;return zl?Ip(Xp,a0)/zl:dy}function Jl(Xp){return function(a0){return a0==null?Op:a0[Xp]}}function Ep(Xp){return function(a0){return Xp==null?Op:Xp[a0]}}function _p(Xp,a0,zl,M0,V0){return V0(Xp,function(T0,T_,DT){zl=M0?(M0=!1,T0):a0(zl,T0,T_,DT)}),zl}function Ip(Xp,a0){for(var zl,M0=-1,V0=Xp.length;++M0<V0;){var T0=a0(Xp[M0]);T0!==Op&&(zl=zl===Op?T0:zl+T0)}return zl}function Up(Xp,a0){for(var zl=-1,M0=Array(Xp);++zl<Xp;)M0[zl]=a0(zl);return M0}function yp(Xp){return Xp&&Xp.slice(0,C0(Xp)+1).replace(ey,"")}function Ap(Xp){return function(a0){return Xp(a0)}}function Cp(Xp,a0){return ba(a0,function(zl){return Xp[zl]})}function Mp(Xp,a0){return Xp.has(a0)}function wp(Xp,a0){for(var zl=-1,M0=Xp.length;++zl<M0&&-1<Nl(a0,Xp[zl],0););return zl}function Np(Xp,a0){for(var zl=Xp.length;zl--&&-1<Nl(a0,Xp[zl],0););return zl}function Fp(Xp){return"\\"+L2[Xp]}function Hp(Xp){var a0=-1,zl=Array(Xp.size);return Xp.forEach(function(M0,V0){zl[++a0]=[V0,M0]}),zl}function xp(Xp,a0){return function(zl){return Xp(a0(zl))}}function Gp(Xp,a0){for(var zl=-1,M0=Xp.length,V0=0,T0=[];++zl<M0;){var T_=Xp[zl];T_!==a0&&T_!=="__lodash_placeholder__"||(Xp[zl]="__lodash_placeholder__",T0[V0++]=zl)}return T0}function $p(Xp){var a0=-1,zl=Array(Xp.size);return Xp.forEach(function(M0){zl[++a0]=M0}),zl}function c0(Xp){if(zS.test(Xp)){for(var a0=JT.lastIndex=0;JT.test(Xp);)++a0;Xp=a0}else Xp=jU(Xp);return Xp}function n0(Xp){return zS.test(Xp)?Xp.match(JT)||[]:Xp.split("")}function C0(Xp){for(var a0=Xp.length;a0--&&w_.test(Xp.charAt(a0)););return a0}var Op,Q0=1/0,dy=NaN,Yy=[["ary",128],["bind",1],["bindKey",2],["curry",8],["curryRight",16],["flip",512],["partial",32],["partialRight",64],["rearg",256]],J_=/\b__p \+= '';/g,R0=/\b(__p \+=) '' \+/g,ry=/(__e\(.*?\)|\b__t\)) \+\n'';/g,q0=/&(?:amp|lt|gt|quot|#39);/g,d0=/[&<>"']/g,Cy=RegExp(q0.source),vy=RegExp(d0.source),A_=/<%-([\s\S]+?)%>/g,I_=/<%([\s\S]+?)%>/g,IT=/<%=([\s\S]+?)%>/g,HS=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,NT=/^\w*$/,KS=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,S0=/[\\^$.*+?()[\]{}|]/g,$0=RegExp(S0.source),ey=/^\s+/,w_=/\s/,Ay=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,Jy=/\{\n\/\* \[wrapped with (.+)\] \*/,Iy=/,? & /,qS=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,SN=/[()=,{}\[\]\/\s]/,I1=/\\(\\)?/g,P2=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,N2=/\w*$/,wU=/^[-+]0x[0-9a-f]+$/i,OU=/^0b[01]+$/i,CU=/^\[object .+?Constructor\]$/,xU=/^0o[0-7]+$/i,RN=/^(?:0|[1-9]\d*)$/,kU=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,fR=/($^)/,PU=/['\n\r\u2028\u2029\\]/g,NU=/['\u2019]/g,LU=/[\u0300-\u036f\ufe20-\ufe2f\u20d0-\u20ff]/g,JT=/\ud83c[\udffb-\udfff](?=\ud83c[\udffb-\udfff])|(?:[^\ud800-\udfff][\u0300-\u036f\ufe20-\ufe2f\u20d0-\u20ff]?|[\u0300-\u036f\ufe20-\ufe2f\u20d0-\u20ff]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff])[\ufe0e\ufe0f]?(?:[\u0300-\u036f\ufe20-\ufe2f\u20d0-\u20ff]|\ud83c[\udffb-\udfff])?(?:\u200d(?:[^\ud800-\udfff]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff])[\ufe0e\ufe0f]?(?:[\u0300-\u036f\ufe20-\ufe2f\u20d0-\u20ff]|\ud83c[\udffb-\udfff])?)*/g,DU=/[A-Z\xc0-\xd6\xd8-\xde]?[a-z\xdf-\xf6\xf8-\xff]+(?:['\u2019](?:d|ll|m|re|s|t|ve))?(?=[\xac\xb1\xd7\xf7\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\xbf\u2000-\u206f \t\x0b\f\xa0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000]|[A-Z\xc0-\xd6\xd8-\xde]|$)|(?:[A-Z\xc0-\xd6\xd8-\xde]|[^\ud800-\udfff\xac\xb1\xd7\xf7\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\xbf\u2000-\u206f \t\x0b\f\xa0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\d+\u2700-\u27bfa-z\xdf-\xf6\xf8-\xffA-Z\xc0-\xd6\xd8-\xde])+(?:['\u2019](?:D|LL|M|RE|S|T|VE))?(?=[\xac\xb1\xd7\xf7\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\xbf\u2000-\u206f \t\x0b\f\xa0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000]|[A-Z\xc0-\xd6\xd8-\xde](?:[a-z\xdf-\xf6\xf8-\xff]|[^\ud800-\udfff\xac\xb1\xd7\xf7\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\xbf\u2000-\u206f \t\x0b\f\xa0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\d+\u2700-\u27bfa-z\xdf-\xf6\xf8-\xffA-Z\xc0-\xd6\xd8-\xde])|$)|[A-Z\xc0-\xd6\xd8-\xde]?(?:[a-z\xdf-\xf6\xf8-\xff]|[^\ud800-\udfff\xac\xb1\xd7\xf7\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\xbf\u2000-\u206f \t\x0b\f\xa0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\d+\u2700-\u27bfa-z\xdf-\xf6\xf8-\xffA-Z\xc0-\xd6\xd8-\xde])+(?:['\u2019](?:d|ll|m|re|s|t|ve))?|[A-Z\xc0-\xd6\xd8-\xde]+(?:['\u2019](?:D|LL|M|RE|S|T|VE))?|\d*(?:1ST|2ND|3RD|(?![123])\dTH)(?=\b|[a-z_])|\d*(?:1st|2nd|3rd|(?![123])\dth)(?=\b|[A-Z_])|\d+|(?:[\u2700-\u27bf]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff])[\ufe0e\ufe0f]?(?:[\u0300-\u036f\ufe20-\ufe2f\u20d0-\u20ff]|\ud83c[\udffb-\udfff])?(?:\u200d(?:[^\ud800-\udfff]|(?:\ud83c[\udde6-\uddff]){2}|[\ud800-\udbff][\udc00-\udfff])[\ufe0e\ufe0f]?(?:[\u0300-\u036f\ufe20-\ufe2f\u20d0-\u20ff]|\ud83c[\udffb-\udfff])?)*/g,zS=/[\u200d\ud800-\udfff\u0300-\u036f\ufe20-\ufe2f\u20d0-\u20ff\ufe0e\ufe0f]/,AN=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,IN="Array Buffer DataView Date Error Float32Array Float64Array Function Int8Array Int16Array Int32Array Map Math Object Promise RegExp Set String Symbol TypeError Uint8Array Uint8ClampedArray Uint16Array Uint32Array WeakMap _ clearTimeout isFinite parseInt setTimeout".split(" "),wN=-1,Qy={};Qy["[object Float32Array]"]=Qy["[object Float64Array]"]=Qy["[object Int8Array]"]=Qy["[object Int16Array]"]=Qy["[object Int32Array]"]=Qy["[object Uint8Array]"]=Qy["[object Uint8ClampedArray]"]=Qy["[object Uint16Array]"]=Qy["[object Uint32Array]"]=!0,Qy["[object Arguments]"]=Qy["[object Array]"]=Qy["[object ArrayBuffer]"]=Qy["[object Boolean]"]=Qy["[object DataView]"]=Qy["[object Date]"]=Qy["[object Error]"]=Qy["[object Function]"]=Qy["[object Map]"]=Qy["[object Number]"]=Qy["[object Object]"]=Qy["[object RegExp]"]=Qy["[object Set]"]=Qy["[object String]"]=Qy["[object WeakMap]"]=!1;var My={};My["[object Arguments]"]=My["[object Array]"]=My["[object ArrayBuffer]"]=My["[object DataView]"]=My["[object Boolean]"]=My["[object Date]"]=My["[object Float32Array]"]=My["[object Float64Array]"]=My["[object Int8Array]"]=My["[object Int16Array]"]=My["[object Int32Array]"]=My["[object Map]"]=My["[object Number]"]=My["[object Object]"]=My["[object RegExp]"]=My["[object Set]"]=My["[object String]"]=My["[object Symbol]"]=My["[object Uint8Array]"]=My["[object Uint8ClampedArray]"]=My["[object Uint16Array]"]=My["[object Uint32Array]"]=!0,My["[object Error]"]=My["[object Function]"]=My["[object WeakMap]"]=!1;var L2={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},MU=parseFloat,UU=parseInt,ON=Ia(qb)=="object"&&qb&&qb.Object===Object&&qb,CN=(typeof self>"u"?"undefined":Ia(self))=="object"&&self&&self.Object===Object&&self,L_=ON||CN||Function("return this")(),xN=i&&!i.nodeType&&i,pR=xN&&h&&!h.nodeType&&h,kS=pR&&pR.exports===xN,kN=kS&&ON.process,LT=function(){try{var Xp=pR&&pR.require&&pR.require("util").types;return Xp||kN&&kN.binding&&kN.binding("util")}catch{}}(),Q_=LT&&LT.isArrayBuffer,D2=LT&&LT.isDate,M2=LT&&LT.isMap,U2=LT&&LT.isRegExp,j2=LT&&LT.isSet,gO=LT&&LT.isTypedArray,jU=Jl("length"),FU=Ep({À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"}),F2=Ep({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}),BU=Ep({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"}),gR=function Xp(a0){function zl(_c){if(g_(_c)&&!iy(_c)&&!(_c instanceof T0)){if(_c instanceof V0)return _c;if(Uy.call(_c,"__wrapped__"))return F1(_c)}return new V0(_c)}function M0(){}function V0(_c,_l){this.__wrapped__=_c,this.__actions__=[],this.__chain__=!!_l,this.__index__=0,this.__values__=Op}function T0(_c){this.__wrapped__=_c,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=4294967295,this.__views__=[]}function T_(_c){var _l=-1,Pl=_c==null?0:_c.length;for(this.clear();++_l<Pl;){var Gl=_c[_l];this.set(Gl[0],Gl[1])}}function DT(_c){var _l=-1,Pl=_c==null?0:_c.length;for(this.clear();++_l<Pl;){var Gl=_c[_l];this.set(Gl[0],Gl[1])}}function yS(_c){var _l=-1,Pl=_c==null?0:_c.length;for(this.clear();++_l<Pl;){var Gl=_c[_l];this.set(Gl[0],Gl[1])}}function mR(_c){var _l=-1,Pl=_c==null?0:_c.length;for(this.__data__=new yS;++_l<Pl;)this.add(_c[_l])}function QT(_c){this.size=(this.__data__=new DT(_c)).size}function B2(_c,_l){var Pl,Gl=iy(_c),_d=!Gl&&OR(_c),Sp=!Gl&&!_d&&eR(_c),Lp=!Gl&&!_d&&!Sp&&s1(_c),Wp=(_d=(Gl=Gl||_d||Sp||Lp)?Up(_c.length,kM):[]).length;for(Pl in _c)!_l&&!Uy.call(_c,Pl)||Gl&&(Pl=="length"||Sp&&(Pl=="offset"||Pl=="parent")||Lp&&(Pl=="buffer"||Pl=="byteLength"||Pl=="byteOffset")||MS(Pl,Wp))||_d.push(Pl);return _d}function $2(_c){var _l=_c.length;return _l?_c[k1(0,_l-1)]:Op}function $U(_c,_l){return GO(pT(_c),XS(_l,0,_c.length))}function VU(_c){return GO(pT(_c))}function PN(_c,_l,Pl){(Pl===Op||CT(_c[_l],Pl))&&(Pl!==Op||_l in _c)||ZT(_c,_l,Pl)}function YS(_c,_l,Pl){var Gl=_c[_l];Uy.call(_c,_l)&&CT(Gl,Pl)&&(Pl!==Op||_l in _c)||ZT(_c,_l,Pl)}function w1(_c,_l){for(var Pl=_c.length;Pl--;)if(CT(_c[Pl][0],_l))return Pl;return-1}function NN(_c,_l,Pl,Gl){return ZS(_c,function(_d,Sp,Lp){_l(Gl,_d,Pl(_d),Lp)}),Gl}function V2(_c,_l){return _c&&ES(_l,C_(_l),_c)}function ZT(_c,_l,Pl){_l=="__proto__"&&Wx?Wx(_c,_l,{configurable:!0,enumerable:!0,value:Pl,writable:!0}):_c[_l]=Pl}function LN(_c,_l){for(var Pl=-1,Gl=_l.length,_d=x_(Gl),Sp=_c==null;++Pl<Gl;)_d[Pl]=Sp?Op:TL(_c,_l[Pl]);return _d}function XS(_c,_l,Pl){return _c==_c&&(Pl!==Op&&(_c=_c<=Pl?_c:Pl),_l!==Op&&(_c=_c>=_l?_c:_l)),_c}function MT(_c,_l,Pl,Gl,_d,Sp){var Lp,Wp=1&_l,Kp=2&_l,Qp=4&_l;if(Pl&&(Lp=_d?Pl(_c,Gl,_d,Sp):Pl(_c)),Lp!==Op)return Lp;if(!Zy(_c))return _c;if(Gl=iy(_c)){if(Lp=function(f0){var L0=f0.length,G0=new f0.constructor(L0);return L0&&typeof f0[0]=="string"&&Uy.call(f0,"index")&&(G0.index=f0.index,G0.input=f0.input),G0}(_c),!Wp)return pT(_c,Lp)}else{var i0=M_(_c),v0=i0=="[object Function]"||i0=="[object GeneratorFunction]";if(eR(_c))return eM(_c,Wp);if(i0=="[object Object]"||i0=="[object Arguments]"||v0&&!_d){if(Lp=Kp||v0?{}:hM(_c),!Wp)return Kp?function(f0,L0){return ES(f0,z1(f0),L0)}(_c,function(f0,L0){return f0&&ES(L0,mT(L0),f0)}(Lp,_c)):function(f0,L0){return ES(f0,RR(f0),L0)}(_c,V2(Lp,_c))}else{if(!My[i0])return _d?_c:{};Lp=function(f0,L0,G0){var ay=f0.constructor;switch(L0){case"[object ArrayBuffer]":return KN(f0);case"[object Boolean]":case"[object Date]":return new ay(+f0);case"[object DataView]":return L0=G0?KN(f0.buffer):f0.buffer,new f0.constructor(L0,f0.byteOffset,f0.byteLength);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return LS(f0,G0);case"[object Map]":return new ay;case"[object Number]":case"[object String]":return new ay(f0);case"[object RegExp]":return(L0=new f0.constructor(f0.source,N2.exec(f0))).lastIndex=f0.lastIndex,L0;case"[object Set]":return new ay;case"[object Symbol]":return K1?_v(K1.call(f0)):{}}}(_c,i0,Wp)}}if(Sp||(Sp=new QT),_d=Sp.get(_c))return _d;Sp.set(_c,Lp),o1(_c)?_c.forEach(function(f0){Lp.add(MT(f0,_l,Pl,f0,_c,Sp))}):ZM(_c)&&_c.forEach(function(f0,L0){Lp.set(L0,MT(f0,_l,Pl,L0,_c,Sp))}),Kp=Qp?Kp?jO:DO:Kp?mT:C_;var A0=Gl?Op:Kp(_c);return j(A0||_c,function(f0,L0){A0&&(f0=_c[L0=f0]),YS(Lp,L0,MT(f0,_l,Pl,L0,_c,Sp))}),Lp}function G2(_c,_l,Pl){var Gl=Pl.length;if(_c==null)return!Gl;for(_c=_v(_c);Gl--;){var _d=Pl[Gl],Sp=_l[_d],Lp=_c[_d];if(Lp===Op&&!(_d in _c)||!Sp(Lp))return!1}return!0}function W2(_c,_l,Pl){if(typeof _c!="function")throw new yT("Expected a function");return r1(function(){_c.apply(Op,Pl)},_l)}function O1(_c,_l,Pl,Gl){var _d=-1,Sp=_s,Lp=!0,Wp=_c.length,Kp=[],Qp=_l.length;if(!Wp)return Kp;Pl&&(_l=ba(_l,Ap(Pl))),Gl?(Sp=ga,Lp=!1):200<=_l.length&&(Sp=Mp,Lp=!1,_l=new mR(_l));e:for(;++_d<Wp;){var i0=_c[_d],v0=Pl==null?i0:Pl(i0);if(i0=Gl||i0!==0?i0:0,Lp&&v0==v0){for(var A0=Qp;A0--;)if(_l[A0]===v0)continue e;Kp.push(i0)}else Sp(_l,v0,Gl)||Kp.push(i0)}return Kp}function GU(_c,_l){var Pl=!0;return ZS(_c,function(Gl,_d,Sp){return Pl=!!_l(Gl,_d,Sp)}),Pl}function mO(_c,_l,Pl){for(var Gl=-1,_d=_c.length;++Gl<_d;){var Sp=_c[Gl],Lp=_l(Sp);if(Lp!=null&&(Wp===Op?Lp==Lp&&!xT(Lp):Pl(Lp,Wp)))var Wp=Lp,Kp=Sp}return Kp}function H2(_c,_l){var Pl=[];return ZS(_c,function(Gl,_d,Sp){_l(Gl,_d,Sp)&&Pl.push(Gl)}),Pl}function K_(_c,_l,Pl,Gl,_d){var Sp=-1,Lp=_c.length;for(Pl||(Pl=YU),_d||(_d=[]);++Sp<Lp;){var Wp=_c[Sp];0<_l&&Pl(Wp)?1<_l?K_(Wp,_l-1,Pl,Gl,_d):xa(_d,Wp):Gl||(_d[_d.length]=Wp)}return _d}function eS(_c,_l){return _c&&DL(_c,_l,C_)}function DN(_c,_l){return _c&&e1(_c,_l,C_)}function yO(_c,_l){return _i(_l,function(Pl){return US(_c[Pl])})}function PS(_c,_l){for(var Pl=0,Gl=(_l=vS(_l,_c)).length;_c!=null&&Pl<Gl;)_c=_c[_S(_l[Pl++])];return Pl&&Pl==Gl?_c:Op}function FR(_c,_l,Pl){return _l=_l(_c),iy(_c)?_l:xa(_l,Pl(_c))}function oT(_c){if(_c==null)return _c===Op?"[object Undefined]":"[object Null]";if(SR&&SR in _v(_c)){var _l=Uy.call(_c,SR),Pl=_c[SR];try{_c[SR]=Op;var Gl=!0}catch{}var _d=iS.call(_c);Gl&&(_l?_c[SR]=Pl:delete _c[SR]),_c=_d}else _c=iS.call(_c);return _c}function MN(_c,_l){return _c>_l}function WU(_c,_l){return _c!=null&&Uy.call(_c,_l)}function HU(_c,_l){return _c!=null&&_l in _v(_c)}function vO(_c,_l,Pl){for(var Gl=Pl?ga:_s,_d=_c[0].length,Sp=_c.length,Lp=Sp,Wp=x_(Sp),Kp=1/0,Qp=[];Lp--;){var i0=_c[Lp];Lp&&_l&&(i0=ba(i0,Ap(_l))),Kp=q_(i0.length,Kp),Wp[Lp]=!Pl&&(_l||120<=_d&&120<=i0.length)?new mR(Lp&&i0):Op}i0=_c[0];var v0=-1,A0=Wp[0];e:for(;++v0<_d&&Qp.length<Kp;){var f0=i0[v0],L0=_l?_l(f0):f0;if(f0=Pl||f0!==0?f0:0,A0?!A0.has(L0):!Gl(Qp,L0,Pl)){for(Lp=Sp;--Lp;){var G0=Wp[Lp];if(G0?!G0.has(L0):!Gl(_c[Lp],L0,Pl))continue e}A0&&A0.push(L0),Qp.push(f0)}}return Qp}function C1(_c,_l,Pl){return(_l=(_c=2>(_l=vS(_l,_c)).length?_c:PS(_c,O_(_l,0,-1)))==null?_c:_c[_S(FT(_l))])==null?Op:g(_l,_c,Pl)}function K2(_c){return g_(_c)&&oT(_c)=="[object Arguments]"}function JS(_c,_l,Pl,Gl,_d){if(_c===_l)return!0;if(_c==null||_l==null||!g_(_c)&&!g_(_l))return _c!=_c&&_l!=_l;e:{var Sp=iy(_c),Lp=iy(_l),Wp=Sp?"[object Array]":M_(_c),Kp=Lp?"[object Array]":M_(_l),Qp=(Wp=Wp=="[object Arguments]"?"[object Object]":Wp)=="[object Object]";if(Lp=(Kp=Kp=="[object Arguments]"?"[object Object]":Kp)=="[object Object]",(Kp=Wp==Kp)&&eR(_c)){if(!eR(_l)){_l=!1;break e}Sp=!0,Qp=!1}if(Kp&&!Qp)_d||(_d=new QT),_l=Sp||s1(_c)?kO(_c,_l,Pl,Gl,JS,_d):function(G0,ay,a_,j0,xy,_E,S_){switch(a_){case"[object DataView]":if(G0.byteLength!=ay.byteLength||G0.byteOffset!=ay.byteOffset)break;G0=G0.buffer,ay=ay.buffer;case"[object ArrayBuffer]":if(G0.byteLength!=ay.byteLength||!_E(new Ux(G0),new Ux(ay)))break;return!0;case"[object Boolean]":case"[object Date]":case"[object Number]":return CT(+G0,+ay);case"[object Error]":return G0.name==ay.name&&G0.message==ay.message;case"[object RegExp]":case"[object String]":return G0==ay+"";case"[object Map]":var e_=Hp;case"[object Set]":if(e_||(e_=$p),G0.size!=ay.size&&!(1&j0))break;return(a_=S_.get(G0))?a_==ay:(j0|=2,S_.set(G0,ay),ay=kO(e_(G0),e_(ay),j0,xy,_E,S_),S_.delete(G0),ay);case"[object Symbol]":if(K1)return K1.call(G0)==K1.call(ay)}return!1}(_c,_l,Wp,Pl,Gl,JS,_d);else{if(!(1&Pl)&&(Sp=Qp&&Uy.call(_c,"__wrapped__"),Wp=Lp&&Uy.call(_l,"__wrapped__"),Sp||Wp)){_c=Sp?_c.value():_c,_l=Wp?_l.value():_l,_d||(_d=new QT),_l=JS(_c,_l,Pl,Gl,_d);break e}if(Kp)t:if(_d||(_d=new QT),Sp=1&Pl,Wp=DO(_c),Lp=Wp.length,Kp=DO(_l).length,Lp==Kp||Sp){for(Kp=Lp;Kp--;){var i0=Wp[Kp];if(!(Sp?i0 in _l:Uy.call(_l,i0))){_l=!1;break t}}if(Qp=_d.get(_c),i0=_d.get(_l),Qp&&i0)_l=Qp==_l&&i0==_c;else{Qp=!0,_d.set(_c,_l),_d.set(_l,_c);for(var v0=Sp;++Kp<Lp;){var A0=_c[i0=Wp[Kp]],f0=_l[i0];if(Gl)var L0=Sp?Gl(f0,A0,i0,_l,_c,_d):Gl(A0,f0,i0,_c,_l,_d);if(L0===Op?A0!==f0&&!JS(A0,f0,Pl,Gl,_d):!L0){Qp=!1;break}v0||(v0=i0=="constructor")}Qp&&!v0&&(Pl=_c.constructor)!=(Gl=_l.constructor)&&"constructor"in _c&&"constructor"in _l&&!(typeof Pl=="function"&&Pl instanceof Pl&&typeof Gl=="function"&&Gl instanceof Gl)&&(Qp=!1),_d.delete(_c),_d.delete(_l),_l=Qp}}else _l=!1;else _l=!1}}return _l}function yR(_c,_l,Pl,Gl){var _d=Pl.length,Sp=_d,Lp=!Gl;if(_c==null)return!Sp;for(_c=_v(_c);_d--;){var Wp=Pl[_d];if(Lp&&Wp[2]?Wp[1]!==_c[Wp[0]]:!(Wp[0]in _c))return!1}for(;++_d<Sp;){var Kp=(Wp=Pl[_d])[0],Qp=_c[Kp],i0=Wp[1];if(Lp&&Wp[2]){if(Qp===Op&&!(Kp in _c))return!1}else{if(Wp=new QT,Gl)var v0=Gl(Qp,i0,Kp,_c,_l,Wp);if(v0===Op?!JS(i0,Qp,3,Gl,Wp):!v0)return!1}}return!0}function UT(_c){return!(!Zy(_c)||PM&&PM in _c)&&(US(_c)?ZU:CU).test(ER(_c))}function UN(_c){return typeof _c=="function"?_c:_c==null?Z_:Ia(_c)=="object"?iy(_c)?jT(_c[0],_c[1]):z2(_c):V1(_c)}function EO(_c){if(!j1(_c))return i3(_c);var _l,Pl=[];for(_l in _v(_c))Uy.call(_c,_l)&&_l!="constructor"&&Pl.push(_l);return Pl}function jN(_c,_l){return _c<_l}function q2(_c,_l){var Pl=-1,Gl=gT(_c)?x_(_c.length):[];return ZS(_c,function(_d,Sp,Lp){Gl[++Pl]=_l(_d,Sp,Lp)}),Gl}function z2(_c){var _l=KR(_c);return _l.length==1&&_l[0][2]?BO(_l[0][0],_l[0][1]):function(Pl){return Pl===_c||yR(Pl,_c,_l)}}function jT(_c,_l){return FO(_c)&&_l==_l&&!Zy(_l)?BO(_S(_c),_l):function(Pl){var Gl=TL(Pl,_c);return Gl===Op&&Gl===_l?YR(Pl,_c):JS(_l,Gl,3)}}function _O(_c,_l,Pl,Gl,_d){_c!==_l&&DL(_l,function(Sp,Lp){if(_d||(_d=new QT),Zy(Sp)){Sp=_d;var Wp=JN(_c,Lp),Kp=JN(_l,Lp),Qp=Sp.get(Kp);if(Qp)PN(_c,Lp,Qp);else{var i0=(Qp=Gl?Gl(Wp,Kp,Lp+"",_c,_l,Sp):Op)===Op;if(i0){var v0=iy(Kp),A0=!v0&&eR(Kp),f0=!v0&&!A0&&s1(Kp);Qp=Kp,v0||A0||f0?iy(Wp)?Qp=Wp:E_(Wp)?Qp=pT(Wp):A0?(i0=!1,Qp=eM(Kp,!0)):f0?(i0=!1,Qp=LS(Kp,!0)):Qp=[]:$1(Kp)||OR(Kp)?(Qp=Wp,OR(Wp)?Qp=IM(Wp):Zy(Wp)&&!US(Wp)||(Qp=hM(Kp))):i0=!1}i0&&(Sp.set(Kp,Qp),_O(Qp,Kp,Pl,Gl,Sp),Sp.delete(Kp)),PN(_c,Lp,Qp)}}else(Wp=Gl?Gl(JN(_c,Lp),Sp,Lp+"",_c,_l,_d):Op)===Op&&(Wp=Sp),PN(_c,Lp,Wp)},mT)}function Y2(_c,_l){var Pl=_c.length;if(Pl)return MS(_l+=0>_l?Pl:0,Pl)?_c[_l]:Op}function X2(_c,_l,Pl){_l=_l.length?ba(_l,function(_d){return iy(_d)?function(Sp){return PS(Sp,_d.length===1?_d[0]:_d)}:_d}):[Z_];var Gl=-1;return _l=ba(_l,Ap(F0())),function(_d,Sp){var Lp=_d.length;for(_d.sort(Sp);Lp--;)_d[Lp]=_d[Lp].value;return _d}(_c=q2(_c,function(_d,Sp,Lp){return{criteria:ba(_l,function(Wp){return Wp(_d)}),index:++Gl,value:_d}}),function(_d,Sp){e:{for(var Lp=-1,Wp=_d.criteria,Kp=Sp.criteria,Qp=Wp.length,i0=Pl.length;++Lp<Qp;){var v0=tM(Wp[Lp],Kp[Lp]);if(v0){if(Lp>=i0){_d=v0;break e}_d=v0*(Pl[Lp]=="desc"?-1:1);break e}}_d=_d.index-Sp.index}return _d})}function x1(_c,_l,Pl){for(var Gl=-1,_d=_l.length,Sp={};++Gl<_d;){var Lp=_l[Gl],Wp=PS(_c,Lp);Pl(Wp,Lp)&&BR(Sp,vS(Lp,_c),Wp)}return Sp}function bO(_c,_l,Pl,Gl){var _d=Gl?Dl:Nl,Sp=-1,Lp=_l.length,Wp=_c;for(_c===_l&&(_l=pT(_l)),Pl&&(Wp=ba(_c,Ap(Pl)));++Sp<Lp;){var Kp=0,Qp=_l[Sp];for(Qp=Pl?Pl(Qp):Qp;-1<(Kp=_d(Wp,Qp,Kp,Gl));)Wp!==_c&&Vx.call(Wp,Kp,1),Vx.call(_c,Kp,1)}return _c}function J2(_c,_l){for(var Pl=_c?_l.length:0,Gl=Pl-1;Pl--;){var _d=_l[Pl];if(Pl==Gl||_d!==Sp){var Sp=_d;MS(_d)?Vx.call(_c,_d,1):$N(_c,_d)}}return _c}function k1(_c,_l){return _c+Xx(BM()*(_l-_c+1))}function FN(_c,_l){var Pl="";if(!_c||1>_l||9007199254740991<_l)return Pl;do _l%2&&(Pl+=_c),(_l=Xx(_l/2))&&(_c+=_c);while(_l);return Pl}function hy(_c,_l){return ML(XN(_c,_l,Z_),_c+"")}function KU(_c){return $2(_R(_c))}function qU(_c,_l){return GO(_c=_R(_c),XS(_l,0,_c.length))}function BR(_c,_l,Pl,Gl){if(!Zy(_c))return _c;for(var _d=-1,Sp=(_l=vS(_l,_c)).length,Lp=Sp-1,Wp=_c;Wp!=null&&++_d<Sp;){var Kp=_S(_l[_d]),Qp=Pl;if(Kp==="__proto__"||Kp==="constructor"||Kp==="prototype")break;if(_d!=Lp){var i0=Wp[Kp];(Qp=Gl?Gl(i0,Kp,Wp):Op)===Op&&(Qp=Zy(i0)?i0:MS(_l[_d+1])?[]:{})}YS(Wp,Kp,Qp),Wp=Wp[Kp]}return _c}function zU(_c){return GO(_R(_c))}function O_(_c,_l,Pl){var Gl=-1,_d=_c.length;for(0>_l&&(_l=-_l>_d?0:_d+_l),0>(Pl=Pl>_d?_d:Pl)&&(Pl+=_d),_d=_l>Pl?0:Pl-_l>>>0,_l>>>=0,Pl=x_(_d);++Gl<_d;)Pl[Gl]=_c[Gl+_l];return Pl}function AO(_c,_l){var Pl;return ZS(_c,function(Gl,_d,Sp){return!(Pl=_l(Gl,_d,Sp))}),!!Pl}function IO(_c,_l,Pl){var Gl=0,_d=_c==null?Gl:_c.length;if(typeof _l=="number"&&_l==_l&&2147483647>=_d){for(;Gl<_d;){var Sp=Gl+_d>>>1,Lp=_c[Sp];Lp!==null&&!xT(Lp)&&(Pl?Lp<=_l:Lp<_l)?Gl=Sp+1:_d=Sp}return _d}return BN(_c,_l,Z_,Pl)}function BN(_c,_l,Pl,Gl){var _d=0,Sp=_c==null?0:_c.length;if(Sp===0)return 0;for(var Lp=(_l=Pl(_l))!=_l,Wp=_l===null,Kp=xT(_l),Qp=_l===Op;_d<Sp;){var i0=Xx((_d+Sp)/2),v0=Pl(_c[i0]),A0=v0!==Op,f0=v0===null,L0=v0==v0,G0=xT(v0);(Lp?Gl||L0:Qp?L0&&(Gl||A0):Wp?L0&&A0&&(Gl||!f0):Kp?L0&&A0&&!f0&&(Gl||!G0):!f0&&!G0&&(Gl?v0<=_l:v0<_l))?_d=i0+1:Sp=i0}return q_(Sp,4294967294)}function Q2(_c,_l){for(var Pl=-1,Gl=_c.length,_d=0,Sp=[];++Pl<Gl;){var Lp=_c[Pl],Wp=_l?_l(Lp):Lp;if(!Pl||!CT(Wp,Kp)){var Kp=Wp;Sp[_d++]=Lp===0?0:Lp}}return Sp}function Z2(_c){return typeof _c=="number"?_c:xT(_c)?dy:+_c}function wT(_c){if(typeof _c=="string")return _c;if(iy(_c))return ba(_c,wT)+"";if(xT(_c))return VM?VM.call(_c):"";var _l=_c+"";return _l=="0"&&1/_c==-Q0?"-0":_l}function OT(_c,_l,Pl){var Gl=-1,_d=_s,Sp=_c.length,Lp=!0,Wp=[],Kp=Wp;if(Pl)Lp=!1,_d=ga;else if(200<=Sp){if(_d=_l?null:u3(_c))return $p(_d);Lp=!1,_d=Mp,Kp=new mR}else Kp=_l?[]:Wp;e:for(;++Gl<Sp;){var Qp=_c[Gl],i0=_l?_l(Qp):Qp;if(Qp=Pl||Qp!==0?Qp:0,Lp&&i0==i0){for(var v0=Kp.length;v0--;)if(Kp[v0]===i0)continue e;_l&&Kp.push(i0),Wp.push(Qp)}else _d(Kp,i0,Pl)||(Kp!==Wp&&Kp.push(i0),Wp.push(Qp))}return Wp}function $N(_c,_l){return(_c=2>(_l=vS(_l,_c)).length?_c:PS(_c,O_(_l,0,-1)))==null||delete _c[_S(FT(_l))]}function NS(_c,_l,Pl,Gl){for(var _d=_c.length,Sp=Gl?_d:-1;(Gl?Sp--:++Sp<_d)&&_l(_c[Sp],Sp,_c););return Pl?O_(_c,Gl?0:Sp,Gl?Sp+1:_d):O_(_c,Gl?Sp+1:0,Gl?_d:Sp)}function VN(_c,_l){return _c instanceof T0&&(_c=_c.value()),El(_l,function(Pl,Gl){return Gl.func.apply(Gl.thisArg,xa([Pl],Gl.args))},_c)}function GN(_c,_l,Pl){var Gl=_c.length;if(2>Gl)return Gl?OT(_c[0]):[];for(var _d=-1,Sp=x_(Gl);++_d<Gl;)for(var Lp=_c[_d],Wp=-1;++Wp<Gl;)Wp!=_d&&(Sp[_d]=O1(Sp[_d]||Lp,_c[Wp],_l,Pl));return OT(K_(Sp,1),_l,Pl)}function D_(_c,_l,Pl){for(var Gl=-1,_d=_c.length,Sp=_l.length,Lp={};++Gl<_d;)Pl(Lp,_c[Gl],Gl<Sp?_l[Gl]:Op);return Lp}function WN(_c){return E_(_c)?_c:[]}function HN(_c){return typeof _c=="function"?_c:Z_}function vS(_c,_l){return iy(_c)?_c:FO(_c,_l)?[_c]:UL(Ly(_c))}function QS(_c,_l,Pl){var Gl=_c.length;return Pl=Pl===Op?Gl:Pl,!_l&&Pl>=Gl?_c:O_(_c,_l,Pl)}function eM(_c,_l){return _l?_c.slice():(_l=_c.length,_l=LM?LM(_l):new _c.constructor(_l),_c.copy(_l),_l)}function KN(_c){var _l=new _c.constructor(_c.byteLength);return new Ux(_l).set(new Ux(_c)),_l}function LS(_c,_l){return _l=_l?KN(_c.buffer):_c.buffer,new _c.constructor(_l,_c.byteOffset,_c.length)}function tM(_c,_l){if(_c!==_l){var Pl=_c!==Op,Gl=_c===null,_d=_c==_c,Sp=xT(_c),Lp=_l!==Op,Wp=_l===null,Kp=_l==_l,Qp=xT(_l);if(!Wp&&!Qp&&!Sp&&_c>_l||Sp&&Lp&&Kp&&!Wp&&!Qp||Gl&&Lp&&Kp||!Pl&&Kp||!_d)return 1;if(!Gl&&!Sp&&!Qp&&_c<_l||Qp&&Pl&&_d&&!Gl&&!Sp||Wp&&Pl&&_d||!Lp&&_d||!Kp)return-1}return 0}function nM(_c,_l,Pl,Gl){var _d=-1,Sp=_c.length,Lp=Pl.length,Wp=-1,Kp=_l.length,Qp=m_(Sp-Lp,0),i0=x_(Kp+Qp);for(Gl=!Gl;++Wp<Kp;)i0[Wp]=_l[Wp];for(;++_d<Lp;)(Gl||_d<Sp)&&(i0[Pl[_d]]=_c[_d]);for(;Qp--;)i0[Wp++]=_c[_d++];return i0}function rM(_c,_l,Pl,Gl){var _d=-1,Sp=_c.length,Lp=-1,Wp=Pl.length,Kp=-1,Qp=_l.length,i0=m_(Sp-Wp,0),v0=x_(i0+Qp);for(Gl=!Gl;++_d<i0;)v0[_d]=_c[_d];for(i0=_d;++Kp<Qp;)v0[i0+Kp]=_l[Kp];for(;++Lp<Wp;)(Gl||_d<Sp)&&(v0[i0+Pl[Lp]]=_c[_d++]);return v0}function pT(_c,_l){var Pl=-1,Gl=_c.length;for(_l||(_l=x_(Gl));++Pl<Gl;)_l[Pl]=_c[Pl];return _l}function ES(_c,_l,Pl,Gl){var _d=!Pl;Pl||(Pl={});for(var Sp=-1,Lp=_l.length;++Sp<Lp;){var Wp=_l[Sp],Kp=Gl?Gl(Pl[Wp],_c[Wp],Wp,Pl,_c):Op;Kp===Op&&(Kp=_c[Wp]),_d?ZT(Pl,Wp,Kp):YS(Pl,Wp,Kp)}return Pl}function P1(_c,_l){return function(Pl,Gl){var _d=iy(Pl)?_:NN,Sp=_l?_l():{};return _d(Pl,_c,F0(Gl,2),Sp)}}function $R(_c){return hy(function(_l,Pl){var Gl=-1,_d=Pl.length,Sp=1<_d?Pl[_d-1]:Op,Lp=2<_d?Pl[2]:Op;for(Sp=3<_c.length&&typeof Sp=="function"?(_d--,Sp):Op,Lp&&aT(Pl[0],Pl[1],Lp)&&(Sp=3>_d?Op:Sp,_d=1),_l=_v(_l);++Gl<_d;)(Lp=Pl[Gl])&&_c(_l,Lp,Gl,Sp);return _l})}function iM(_c,_l){return function(Pl,Gl){if(Pl==null)return Pl;if(!gT(Pl))return _c(Pl,Gl);for(var _d=Pl.length,Sp=_l?_d:-1,Lp=_v(Pl);(_l?Sp--:++Sp<_d)&&Gl(Lp[Sp],Sp,Lp)!==!1;);return Pl}}function wO(_c){return function(_l,Pl,Gl){for(var _d=-1,Sp=_v(_l),Lp=(Gl=Gl(_l)).length;Lp--;){var Wp=Gl[_c?Lp:++_d];if(Pl(Sp[Wp],Wp,Sp)===!1)break}return _l}}function N1(_c){return function(_l){_l=Ly(_l);var Pl=zS.test(_l)?n0(_l):Op,Gl=Pl?Pl[0]:_l.charAt(0);return _l=Pl?QS(Pl,1).join(""):_l.slice(1),Gl[_c]()+_l}}function VR(_c){return function(_l){return El(xM(CM(_l).replace(NU,"")),_c,"")}}function GR(_c){return function(){var _l=arguments;switch(_l.length){case 0:return new _c;case 1:return new _c(_l[0]);case 2:return new _c(_l[0],_l[1]);case 3:return new _c(_l[0],_l[1],_l[2]);case 4:return new _c(_l[0],_l[1],_l[2],_l[3]);case 5:return new _c(_l[0],_l[1],_l[2],_l[3],_l[4]);case 6:return new _c(_l[0],_l[1],_l[2],_l[3],_l[4],_l[5]);case 7:return new _c(_l[0],_l[1],_l[2],_l[3],_l[4],_l[5],_l[6])}var Pl=_w(_c.prototype);return Zy(_l=_c.apply(Pl,_l))?_l:Pl}}function oM(_c){return function(_l,Pl,Gl){var _d=_v(_l);if(!gT(_l)){var Sp=F0(Pl,3);_l=C_(_l),Pl=function(Lp){return Sp(_d[Lp],Lp,_d)}}return-1<(Pl=_c(_l,Pl,Gl))?_d[Sp?_l[Pl]:Pl]:Op}}function sM(_c){return DS(function(_l){var Pl=_l.length,Gl=Pl,_d=V0.prototype.thru;for(_c&&_l.reverse();Gl--;){var Sp=_l[Gl];if(typeof Sp!="function")throw new yT("Expected a function");if(_d&&!Lp&&D1(Sp)=="wrapper")var Lp=new V0([],!0)}for(Gl=Lp?Gl:Pl;++Gl<Pl;){var Wp=(_d=D1(Sp=_l[Gl]))=="wrapper"?n1(Sp):Op;Lp=Wp&&U1(Wp[0])&&Wp[1]==424&&!Wp[4].length&&Wp[9]==1?Lp[D1(Wp[0])].apply(Lp,Wp[3]):Sp.length==1&&U1(Sp)?Lp[_d]():Lp.thru(Sp)}return function(){var Kp=arguments,Qp=Kp[0];if(Lp&&Kp.length==1&&iy(Qp))return Lp.plant(Qp).value();var i0=0;for(Kp=Pl?_l[i0].apply(this,Kp):Qp;++i0<Pl;)Kp=_l[i0].call(this,Kp);return Kp}})}function tS(_c,_l,Pl,Gl,_d,Sp,Lp,Wp,Kp,Qp){var i0=128&_l,v0=1&_l,A0=2&_l,f0=24&_l,L0=512&_l,G0=A0?Op:GR(_c);return function ay(){for(var a_=arguments.length,j0=x_(a_),xy=a_;xy--;)j0[xy]=arguments[xy];if(f0){var _E,S_=HR(ay);for(xy=j0.length,_E=0;xy--;)j0[xy]===S_&&++_E}if(Gl&&(j0=nM(j0,Gl,_d,f0)),Sp&&(j0=rM(j0,Sp,Lp,f0)),a_-=_E,f0&&a_<Qp)return S_=Gp(j0,S_),YN(_c,_l,tS,ay.placeholder,Pl,j0,S_,Wp,Kp,Qp-a_);if(S_=v0?Pl:this,xy=A0?S_[_c]:_c,a_=j0.length,Wp){_E=j0.length;for(var e_=q_(Wp.length,_E),LP=pT(j0);e_--;){var a1=Wp[e_];j0[e_]=MS(a1,_E)?LP[a1]:Op}}else L0&&1<a_&&j0.reverse();return i0&&Kp<a_&&(j0.length=Kp),this&&this!==L_&&this instanceof ay&&(xy=G0||GR(xy)),xy.apply(S_,j0)}}function aM(_c,_l){return function(Pl,Gl){return function(_d,Sp,Lp,Wp){return eS(_d,function(Kp,Qp,i0){Sp(Wp,Lp(Kp),Qp,i0)}),Wp}(Pl,_c,_l(Gl),{})}}function CO(_c,_l){return function(Pl,Gl){var _d;if(Pl===Op&&Gl===Op)return _l;if(Pl!==Op&&(_d=Pl),Gl!==Op){if(_d===Op)return Gl;typeof Pl=="string"||typeof Gl=="string"?(Pl=wT(Pl),Gl=wT(Gl)):(Pl=Z2(Pl),Gl=Z2(Gl)),_d=_c(Pl,Gl)}return _d}}function qN(_c){return DS(function(_l){return _l=ba(_l,Ap(F0())),hy(function(Pl){var Gl=this;return _c(_l,function(_d){return g(_d,Gl,Pl)})})})}function WR(_c,_l){var Pl=(_l=_l===Op?" ":wT(_l)).length;return 2>Pl?Pl?FN(_l,_c):_l:(Pl=FN(_l,Yx(_c/c0(_l))),zS.test(_l)?QS(n0(Pl),0,_c).join(""):Pl.slice(0,_c))}function zN(_c){return function(_l,Pl,Gl){Gl&&typeof Gl!="number"&&aT(_l,Pl,Gl)&&(Pl=Gl=Op),_l=rS(_l),Pl===Op?(Pl=_l,_l=0):Pl=rS(Pl),Gl=Gl===Op?_l<Pl?1:-1:rS(Gl);var _d=-1;Pl=m_(Yx((Pl-_l)/(Gl||1)),0);for(var Sp=x_(Pl);Pl--;)Sp[_c?Pl:++_d]=_l,_l+=Gl;return Sp}}function nS(_c){return function(_l,Pl){return typeof _l=="string"&&typeof Pl=="string"||(_l=BT(_l),Pl=BT(Pl)),_c(_l,Pl)}}function YN(_c,_l,Pl,Gl,_d,Sp,Lp,Wp,Kp,Qp){var i0=8&_l;return 4&(_l=(_l|(i0?32:64))&~(i0?64:32))||(_l&=-4),_d=[_c,_l,_d,i0?Sp:Op,i0?Lp:Op,Sp=i0?Op:Sp,Lp=i0?Op:Lp,Wp,Kp,Qp],Pl=Pl.apply(Op,_d),U1(_c)&&GM(Pl,_d),Pl.placeholder=Gl,fM(Pl,_c,_l)}function xO(_c){var _l=JR[_c];return function(Pl,Gl){return Pl=BT(Pl),(Gl=Gl==null?0:q_(sy(Gl),292))&&jM(Pl)?(Pl=(Ly(Pl)+"e").split("e"),+((Pl=(Ly(Pl=_l(Pl[0]+"e"+(+Pl[1]+Gl)))+"e").split("e"))[0]+"e"+(+Pl[1]-Gl))):_l(Pl)}}function L1(_c){return function(_l){var Pl=M_(_l);return Pl=="[object Map]"?Hp(_l):Pl=="[object Set]"?function(Gl){var _d=-1,Sp=Array(Gl.size);return Gl.forEach(function(Lp){Sp[++_d]=[Lp,Lp]}),Sp}(_l):function(Gl,_d){return ba(_d,function(Sp){return[Sp,Gl[Sp]]})}(_l,_c(_l))}}function sT(_c,_l,Pl,Gl,_d,Sp,Lp,Wp){var Kp=2&_l;if(!Kp&&typeof _c!="function")throw new yT("Expected a function");var Qp=Gl?Gl.length:0;if(Qp||(_l&=-97,Gl=_d=Op),Lp=Lp===Op?Lp:m_(sy(Lp),0),Wp=Wp===Op?Wp:sy(Wp),Qp-=_d?_d.length:0,64&_l){var i0=Gl,v0=_d;Gl=_d=Op}var A0=Kp?Op:n1(_c);return Sp=[_c,_l,Pl,Gl,_d,i0,v0,Sp,Lp,Wp],A0&&(_l=(Pl=Sp[1])|(_c=A0[1]),Gl=_c==128&&Pl==8||_c==128&&Pl==256&&Sp[7].length<=A0[8]||_c==384&&A0[7].length<=A0[8]&&Pl==8,131>_l||Gl)&&(1&_c&&(Sp[2]=A0[2],_l|=1&Pl?0:4),(Pl=A0[3])&&(Gl=Sp[3],Sp[3]=Gl?nM(Gl,Pl,A0[4]):Pl,Sp[4]=Gl?Gp(Sp[3],"__lodash_placeholder__"):A0[4]),(Pl=A0[5])&&(Gl=Sp[5],Sp[5]=Gl?rM(Gl,Pl,A0[6]):Pl,Sp[6]=Gl?Gp(Sp[5],"__lodash_placeholder__"):A0[6]),(Pl=A0[7])&&(Sp[7]=Pl),128&_c&&(Sp[8]=Sp[8]==null?A0[8]:q_(Sp[8],A0[8])),Sp[9]==null&&(Sp[9]=A0[9]),Sp[0]=A0[0],Sp[1]=_l),_c=Sp[0],_l=Sp[1],Pl=Sp[2],Gl=Sp[3],_d=Sp[4],!(Wp=Sp[9]=Sp[9]===Op?Kp?0:_c.length:m_(Sp[9]-Qp,0))&&24&_l&&(_l&=-25),Kp=_l&&_l!=1?_l==8||_l==16?function(f0,L0,G0){var ay=GR(f0);return function a_(){for(var j0=arguments.length,xy=x_(j0),_E=j0,S_=HR(a_);_E--;)xy[_E]=arguments[_E];return(j0-=(_E=3>j0&&xy[0]!==S_&&xy[j0-1]!==S_?[]:Gp(xy,S_)).length)<G0?YN(f0,L0,tS,a_.placeholder,Op,xy,_E,Op,Op,G0-j0):g(this&&this!==L_&&this instanceof a_?ay:f0,this,xy)}}(_c,_l,Wp):_l!=32&&_l!=33||_d.length?tS.apply(Op,Sp):function(f0,L0,G0,ay){var a_=1&L0,j0=GR(f0);return function xy(){for(var _E=-1,S_=arguments.length,e_=-1,LP=ay.length,a1=x_(LP+S_),m5=this&&this!==L_&&this instanceof xy?j0:f0;++e_<LP;)a1[e_]=ay[e_];for(;S_--;)a1[e_++]=arguments[++_E];return g(m5,a_?G0:this,a1)}}(_c,_l,Pl,Gl):function(f0,L0,G0){var ay=1&L0,a_=GR(f0);return function j0(){return(this&&this!==L_&&this instanceof j0?a_:f0).apply(ay?G0:this,arguments)}}(_c,_l,Pl),fM((A0?SP:GM)(Kp,Sp),_c,_l)}function cM(_c,_l,Pl,Gl){return _c===Op||CT(_c,QR[Pl])&&!Uy.call(Gl,Pl)?_l:_c}function uM(_c,_l,Pl,Gl,_d,Sp){return Zy(_c)&&Zy(_l)&&(Sp.set(_l,_c),_O(_c,_l,Op,uM,Sp),Sp.delete(_l)),_c}function lM(_c){return $1(_c)?Op:_c}function kO(_c,_l,Pl,Gl,_d,Sp){var Lp=1&Pl,Wp=_c.length,Kp=_l.length;if(Wp!=Kp&&!(Lp&&Kp>Wp))return!1;Kp=Sp.get(_c);var Qp=Sp.get(_l);if(Kp&&Qp)return Kp==_l&&Qp==_c;Kp=-1,Qp=!0;var i0=2&Pl?new mR:Op;for(Sp.set(_c,_l),Sp.set(_l,_c);++Kp<Wp;){var v0=_c[Kp],A0=_l[Kp];if(Gl)var f0=Lp?Gl(A0,v0,Kp,_l,_c,Sp):Gl(v0,A0,Kp,_c,_l,Sp);if(f0!==Op){if(f0)continue;Qp=!1;break}if(i0){if(!Sl(_l,function(L0,G0){if(!i0.has(G0)&&(v0===L0||_d(v0,L0,Pl,Gl,Sp)))return i0.push(G0)})){Qp=!1;break}}else if(v0!==A0&&!_d(v0,A0,Pl,Gl,Sp)){Qp=!1;break}}return Sp.delete(_c),Sp.delete(_l),Qp}function DS(_c){return ML(XN(_c,Op,yM),_c+"")}function DO(_c){return FR(_c,C_,RR)}function jO(_c){return FR(_c,mT,z1)}function D1(_c){for(var _l=_c.name+"",Pl=FS[_l],Gl=Uy.call(FS,_l)?Pl.length:0;Gl--;){var _d=Pl[Gl],Sp=_d.func;if(Sp==null||Sp==_c)return _d.name}return _l}function HR(_c){return(Uy.call(zl,"placeholder")?zl:_c).placeholder}function F0(){var _c=zl.iteratee||Rx;return _c=_c===Rx?UN:_c,arguments.length?_c(arguments[0],arguments[1]):_c}function M1(_c,_l){_c=_c.__data__;var Pl=Ia(_l);return(Pl=="string"||Pl=="number"||Pl=="symbol"||Pl=="boolean"?_l!=="__proto__":_l===null)?_c[typeof _l=="string"?"string":"hash"]:_c.map}function KR(_c){for(var _l=C_(_c),Pl=_l.length;Pl--;){var Gl=_l[Pl],_d=_c[Gl];_l[Pl]=[Gl,_d,_d==_d&&!Zy(_d)]}return _l}function vR(_c,_l){return UT(_c=_c==null?Op:_c[_l])?_c:Op}function dM(_c,_l,Pl){for(var Gl=-1,_d=(_l=vS(_l,_c)).length,Sp=!1;++Gl<_d;){var Lp=_S(_l[Gl]);if(!(Sp=_c!=null&&Pl(_c,Lp)))break;_c=_c[Lp]}return Sp||++Gl!=_d?Sp:!!(_d=_c==null?0:_c.length)&&Tx(_d)&&MS(Lp,_d)&&(iy(_c)||OR(_c))}function hM(_c){return typeof _c.constructor!="function"||j1(_c)?{}:_w($x(_c))}function YU(_c){return iy(_c)||OR(_c)||!!(UM&&_c&&_c[UM])}function MS(_c,_l){var Pl=Ia(_c);return!!(_l=_l??9007199254740991)&&(Pl=="number"||Pl!="symbol"&&RN.test(_c))&&-1<_c&&_c%1==0&&_c<_l}function aT(_c,_l,Pl){if(!Zy(Pl))return!1;var Gl=Ia(_l);return!!(Gl=="number"?gT(Pl)&&MS(_l,Pl.length):Gl=="string"&&_l in Pl)&&CT(Pl[_l],_c)}function FO(_c,_l){if(iy(_c))return!1;var Pl=Ia(_c);return!(Pl!="number"&&Pl!="symbol"&&Pl!="boolean"&&_c!=null&&!xT(_c))||NT.test(_c)||!HS.test(_c)||_l!=null&&_c in _v(_l)}function U1(_c){var _l=D1(_c),Pl=zl[_l];return typeof Pl=="function"&&_l in T0.prototype&&(_c===Pl||!!(_l=n1(Pl))&&_c===_l[0])}function j1(_c){var _l=_c&&_c.constructor;return _c===(typeof _l=="function"&&_l.prototype||QR)}function BO(_c,_l){return function(Pl){return Pl!=null&&Pl[_c]===_l&&(_l!==Op||_c in _v(Pl))}}function XN(_c,_l,Pl){return _l=m_(_l===Op?_c.length-1:_l,0),function(){for(var Gl=arguments,_d=-1,Sp=m_(Gl.length-_l,0),Lp=x_(Sp);++_d<Sp;)Lp[_d]=Gl[_l+_d];for(_d=-1,Sp=x_(_l+1);++_d<_l;)Sp[_d]=Gl[_d];return Sp[_l]=Pl(Lp),g(_c,this,Sp)}}function JN(_c,_l){if((_l!=="constructor"||typeof _c[_l]!="function")&&_l!="__proto__")return _c[_l]}function fM(_c,_l,Pl){var Gl=_l+"";_l=ML;var _d=XU,Sp=(Sp=Gl.match(Jy))?Sp[1].split(Iy):[];return Pl=_d(Sp,Pl),(_d=Pl.length)&&(Pl[Sp=_d-1]=(1<_d?"& ":"")+Pl[Sp],Pl=Pl.join(2<_d?", ":" "),Gl=Gl.replace(Ay,`{
/* [wrapped with `+Pl+`] */
`)),_l(_c,Gl)}function pM(_c){var _l=0,Pl=0;return function(){var Gl=Zx(),_d=16-(Gl-Pl);if(Pl=Gl,0<_d){if(800<=++_l)return arguments[0]}else _l=0;return _c.apply(Op,arguments)}}function GO(_c,_l){var Pl=-1,Gl=_c.length,_d=Gl-1;for(_l=_l===Op?Gl:_l;++Pl<_l;){var Sp=_c[Gl=k1(Pl,_d)];_c[Gl]=_c[Pl],_c[Pl]=Sp}return _c.length=_l,_c}function _S(_c){if(typeof _c=="string"||xT(_c))return _c;var _l=_c+"";return _l=="0"&&1/_c==-Q0?"-0":_l}function ER(_c){if(_c!=null){try{return TR.call(_c)}catch{}return _c+""}return""}function XU(_c,_l){return j(Yy,function(Pl){var Gl="_."+Pl[0];_l&Pl[1]&&!_s(_c,Gl)&&_c.push(Gl)}),_c.sort()}function F1(_c){if(_c instanceof T0)return _c.clone();var _l=new V0(_c.__wrapped__,_c.__chain__);return _l.__actions__=pT(_c.__actions__),_l.__index__=_c.__index__,_l.__values__=_c.__values__,_l}function gM(_c,_l,Pl){var Gl=_c==null?0:_c.length;return Gl?(0>(Pl=Pl==null?0:sy(Pl))&&(Pl=m_(Gl+Pl,0)),Cl(_c,F0(_l,3),Pl)):-1}function mM(_c,_l,Pl){var Gl=_c==null?0:_c.length;if(!Gl)return-1;var _d=Gl-1;return Pl!==Op&&(_d=sy(Pl),_d=0>Pl?m_(Gl+_d,0):q_(_d,Gl-1)),Cl(_c,F0(_l,3),_d,!0)}function yM(_c){return _c!=null&&_c.length?K_(_c,1):[]}function HO(_c){return _c&&_c.length?_c[0]:Op}function FT(_c){var _l=_c==null?0:_c.length;return _l?_c[_l-1]:Op}function vM(_c,_l){return _c&&_c.length&&_l&&_l.length?bO(_c,_l):_c}function QN(_c){return _c==null?_c:_A.call(_c)}function qO(_c){if(!_c||!_c.length)return[];var _l=0;return _c=_i(_c,function(Pl){if(E_(Pl))return _l=m_(Pl.length,_l),!0}),Up(_l,function(Pl){return ba(_c,Jl(Pl))})}function EM(_c,_l){return _c&&_c.length?(_c=qO(_c),_l==null?_c:ba(_c,function(Pl){return g(_l,Op,Pl)})):[]}function B1(_c){return(_c=zl(_c)).__chain__=!0,_c}function qR(_c,_l){return _l(_c)}function _M(_c,_l){return(iy(_c)?j:ZS)(_c,F0(_l,3))}function bM(_c,_l){return(iy(_c)?$:q1)(_c,F0(_l,3))}function zO(_c,_l){return(iy(_c)?ba:q2)(_c,F0(_l,3))}function ZN(_c,_l,Pl){return _l=Pl?Op:_l,_l=_c&&_l==null?_c.length:_l,sT(_c,128,Op,Op,Op,Op,_l)}function EL(_c,_l){var Pl;if(typeof _l!="function")throw new yT("Expected a function");return _c=sy(_c),function(){return 0<--_c&&(Pl=_l.apply(this,arguments)),1>=_c&&(_l=Op),Pl}}function JO(_c,_l,Pl){function Gl(j0){var xy=Kp,_E=Qp;return Kp=Qp=Op,f0=j0,i0=_c.apply(_E,xy)}function _d(j0){var xy=j0-A0;return j0-=f0,A0===Op||xy>=_l||0>xy||G0&&j0>=a_}function Sp(){var j0=wR();if(_d(j0))return Lp(j0);var xy=r1,_E=j0-f0;j0=_l-(j0-A0),_E=G0?q_(j0,a_-_E):j0,v0=xy(Sp,_E)}function Lp(j0){return v0=Op,ay&&Kp?Gl(j0):(Kp=Qp=Op,i0)}function Wp(){var j0=wR(),xy=_d(j0);if(Kp=arguments,Qp=this,A0=j0,xy){if(v0===Op)return f0=j0=A0,v0=r1(Sp,_l),L0?Gl(j0):i0;if(G0)return RP(v0),v0=r1(Sp,_l),Gl(A0)}return v0===Op&&(v0=r1(Sp,_l)),i0}var Kp,Qp,i0,v0,A0,f0=0,L0=!1,G0=!1,ay=!0;if(typeof _c!="function")throw new yT("Expected a function");if(_l=BT(_l)||0,Zy(Pl)){L0=!!Pl.leading;var a_=(G0="maxWait"in Pl)?m_(BT(Pl.maxWait)||0,_l):a_;ay="trailing"in Pl?!!Pl.trailing:ay}return Wp.cancel=function(){v0!==Op&&RP(v0),f0=0,Kp=A0=Qp=v0=Op},Wp.flush=function(){return v0===Op?i0:Lp(wR())},Wp}function _C(_c,_l){if(typeof _c!="function"||_l!=null&&typeof _l!="function")throw new yT("Expected a function");var Pl=function Gl(){var _d=arguments,Sp=_l?_l.apply(this,_d):_d[0],Lp=Gl.cache;return Lp.has(Sp)?Lp.get(Sp):(_d=_c.apply(this,_d),Gl.cache=Lp.set(Sp,_d)||Lp,_d)};return Pl.cache=new(_C.Cache||yS),Pl}function _x(_c){if(typeof _c!="function")throw new yT("Expected a function");return function(){var _l=arguments;switch(_l.length){case 0:return!_c.call(this);case 1:return!_c.call(this,_l[0]);case 2:return!_c.call(this,_l[0],_l[1]);case 3:return!_c.call(this,_l[0],_l[1],_l[2])}return!_c.apply(this,_l)}}function CT(_c,_l){return _c===_l||_c!=_c&&_l!=_l}function gT(_c){return _c!=null&&Tx(_c.length)&&!US(_c)}function E_(_c){return g_(_c)&&gT(_c)}function _L(_c){if(!g_(_c))return!1;var _l=oT(_c);return _l=="[object Error]"||_l=="[object DOMException]"||typeof _c.message=="string"&&typeof _c.name=="string"&&!$1(_c)}function US(_c){return!!Zy(_c)&&((_c=oT(_c))=="[object Function]"||_c=="[object GeneratorFunction]"||_c=="[object AsyncFunction]"||_c=="[object Proxy]")}function TM(_c){return typeof _c=="number"&&_c==sy(_c)}function Tx(_c){return typeof _c=="number"&&-1<_c&&_c%1==0&&9007199254740991>=_c}function Zy(_c){var _l=Ia(_c);return _c!=null&&(_l=="object"||_l=="function")}function g_(_c){return _c!=null&&Ia(_c)=="object"}function SM(_c){return typeof _c=="number"||g_(_c)&&oT(_c)=="[object Number]"}function $1(_c){return!(!g_(_c)||oT(_c)!="[object Object]")&&((_c=$x(_c))===null||typeof(_c=Uy.call(_c,"constructor")&&_c.constructor)=="function"&&_c instanceof _c&&TR.call(_c)==QU)}function zR(_c){return typeof _c=="string"||!iy(_c)&&g_(_c)&&oT(_c)=="[object String]"}function xT(_c){return Ia(_c)=="symbol"||g_(_c)&&oT(_c)=="[object Symbol]"}function RM(_c){if(!_c)return[];if(gT(_c))return zR(_c)?n0(_c):pT(_c);if(ZR&&_c[ZR]){_c=_c[ZR]();for(var _l,Pl=[];!(_l=_c.next()).done;)Pl.push(_l.value);return Pl}return((_l=M_(_c))=="[object Map]"?Hp:_l=="[object Set]"?$p:_R)(_c)}function rS(_c){return _c?(_c=BT(_c))===Q0||_c===-Q0?17976931348623157e292*(0>_c?-1:1):_c==_c?_c:0:_c===0?_c:0}function sy(_c){var _l=(_c=rS(_c))%1;return _c==_c?_l?_c-_l:_c:0}function AM(_c){return _c?XS(sy(_c),0,4294967295):0}function BT(_c){if(typeof _c=="number")return _c;if(xT(_c))return dy;if(Zy(_c)&&(_c=Zy(_c=typeof _c.valueOf=="function"?_c.valueOf():_c)?_c+"":_c),typeof _c!="string")return _c===0?_c:+_c;_c=yp(_c);var _l=OU.test(_c);return _l||xU.test(_c)?UU(_c.slice(2),_l?2:8):wU.test(_c)?dy:+_c}function IM(_c){return ES(_c,mT(_c))}function Ly(_c){return _c==null?"":wT(_c)}function TL(_c,_l,Pl){return(_c=_c==null?Op:PS(_c,_l))===Op?Pl:_c}function YR(_c,_l){return _c!=null&&dM(_c,_l,HU)}function C_(_c){return gT(_c)?B2(_c):EO(_c)}function mT(_c){if(gT(_c))_c=B2(_c,!0);else if(Zy(_c)){var _l=j1(_c),Pl=[];for(Gl in _c)(Gl!="constructor"||!_l&&Uy.call(_c,Gl))&&Pl.push(Gl);_c=Pl}else{var Gl=[];if(_c!=null)for(_l in _v(_c))Gl.push(_l);_c=Gl}return _c}function wM(_c,_l){if(_c==null)return{};var Pl=ba(jO(_c),function(Gl){return[Gl]});return _l=F0(_l),x1(_c,Pl,function(Gl,_d){return _l(Gl,_d[0])})}function _R(_c){return _c==null?[]:Cp(_c,C_(_c))}function OM(_c){return JL(Ly(_c).toLowerCase())}function CM(_c){return(_c=Ly(_c))&&_c.replace(kU,FU).replace(LU,"")}function xM(_c,_l,Pl){return _c=Ly(_c),(_l=Pl?Op:_l)===Op?AN.test(_c)?_c.match(DU)||[]:_c.match(qS)||[]:_c.match(_l)||[]}function Sx(_c){return function(){return _c}}function Z_(_c){return _c}function Rx(_c){return UN(typeof _c=="function"?_c:MT(_c,1))}function Ox(_c,_l,Pl){var Gl=C_(_l),_d=yO(_l,Gl);Pl!=null||Zy(_l)&&(_d.length||!Gl.length)||(Pl=_l,_l=_c,_c=this,_d=yO(_l,C_(_l)));var Sp=!(Zy(Pl)&&"chain"in Pl&&!Pl.chain),Lp=US(_c);return j(_d,function(Wp){var Kp=_l[Wp];_c[Wp]=Kp,Lp&&(_c.prototype[Wp]=function(){var Qp=this.__chain__;if(Sp||Qp){var i0=_c(this.__wrapped__);return(i0.__actions__=pT(this.__actions__)).push({func:Kp,args:arguments,thisArg:_c}),i0.__chain__=Qp,i0}return Kp.apply(_c,xa([this.value()],arguments))})}),_c}function XR(){}function V1(_c){return FO(_c)?Jl(_S(_c)):function(_l){return function(Pl){return PS(Pl,_l)}}(_c)}function SL(){return[]}function RL(){return!1}var IL,x_=(a0=a0==null?L_:gR.defaults(L_.Object(),a0,gR.pick(L_,IN))).Array,Px=a0.Date,OL=a0.Error,bR=a0.Function,JR=a0.Math,_v=a0.Object,CL=a0.RegExp,kM=a0.String,yT=a0.TypeError,Nx=x_.prototype,QR=_v.prototype,Lx=a0["__core-js_shared__"],TR=bR.prototype.toString,Uy=QR.hasOwnProperty,JU=0,PM=(IL=/[^.]+$/.exec(Lx&&Lx.keys&&Lx.keys.IE_PROTO||""))?"Symbol(src)_1."+IL:"",iS=QR.toString,QU=TR.call(_v),NM=L_._,ZU=CL("^"+TR.call(Uy).replace(S0,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Mx=kS?a0.Buffer:Op,jS=a0.Symbol,Ux=a0.Uint8Array,LM=Mx?Mx.allocUnsafe:Op,$x=xp(_v.getPrototypeOf,_v),DM=_v.create,MM=QR.propertyIsEnumerable,Vx=Nx.splice,UM=jS?jS.isConcatSpreadable:Op,ZR=jS?jS.iterator:Op,SR=jS?jS.toStringTag:Op,Wx=function(){try{var _c=vR(_v,"defineProperty");return _c({},"",{}),_c}catch{}}(),e3=a0.clearTimeout!==L_.clearTimeout&&a0.clearTimeout,t3=Px&&Px.now!==L_.Date.now&&Px.now,n3=a0.setTimeout!==L_.setTimeout&&a0.setTimeout,Yx=JR.ceil,Xx=JR.floor,Qx=_v.getOwnPropertySymbols,r3=Mx?Mx.isBuffer:Op,jM=a0.isFinite,FM=Nx.join,i3=xp(_v.keys,_v),m_=JR.max,q_=JR.min,Zx=Px.now,o3=a0.parseInt,BM=JR.random,_A=Nx.reverse,PL=vR(a0,"DataView"),G1=vR(a0,"Map"),NL=vR(a0,"Promise"),_I=vR(a0,"Set"),W1=vR(a0,"WeakMap"),H1=vR(_v,"create"),_k=W1&&new W1,FS={},s3=ER(PL),$M=ER(G1),_P=ER(NL),LL=ER(_I),a3=ER(W1),TP=jS?jS.prototype:Op,K1=TP?TP.valueOf:Op,VM=TP?TP.toString:Op,_w=function(){function _c(){}return function(_l){return Zy(_l)?DM?DM(_l):(_c.prototype=_l,_l=new _c,_c.prototype=Op,_l):{}}}();zl.templateSettings={escape:A_,evaluate:I_,interpolate:IT,variable:"",imports:{_:zl}},zl.prototype=M0.prototype,zl.prototype.constructor=zl,V0.prototype=_w(M0.prototype),V0.prototype.constructor=V0,T0.prototype=_w(M0.prototype),T0.prototype.constructor=T0,T_.prototype.clear=function(){this.__data__=H1?H1(null):{},this.size=0},T_.prototype.delete=function(_c){return _c=this.has(_c)&&delete this.__data__[_c],this.size-=_c?1:0,_c},T_.prototype.get=function(_c){var _l=this.__data__;return H1?(_c=_l[_c])==="__lodash_hash_undefined__"?Op:_c:Uy.call(_l,_c)?_l[_c]:Op},T_.prototype.has=function(_c){var _l=this.__data__;return H1?_l[_c]!==Op:Uy.call(_l,_c)},T_.prototype.set=function(_c,_l){var Pl=this.__data__;return this.size+=this.has(_c)?0:1,Pl[_c]=H1&&_l===Op?"__lodash_hash_undefined__":_l,this},DT.prototype.clear=function(){this.__data__=[],this.size=0},DT.prototype.delete=function(_c){var _l=this.__data__;return!(0>(_c=w1(_l,_c)))&&(_c==_l.length-1?_l.pop():Vx.call(_l,_c,1),--this.size,!0)},DT.prototype.get=function(_c){var _l=this.__data__;return 0>(_c=w1(_l,_c))?Op:_l[_c][1]},DT.prototype.has=function(_c){return-1<w1(this.__data__,_c)},DT.prototype.set=function(_c,_l){var Pl=this.__data__,Gl=w1(Pl,_c);return 0>Gl?(++this.size,Pl.push([_c,_l])):Pl[Gl][1]=_l,this},yS.prototype.clear=function(){this.size=0,this.__data__={hash:new T_,map:new(G1||DT),string:new T_}},yS.prototype.delete=function(_c){return _c=M1(this,_c).delete(_c),this.size-=_c?1:0,_c},yS.prototype.get=function(_c){return M1(this,_c).get(_c)},yS.prototype.has=function(_c){return M1(this,_c).has(_c)},yS.prototype.set=function(_c,_l){var Pl=M1(this,_c),Gl=Pl.size;return Pl.set(_c,_l),this.size+=Pl.size==Gl?0:1,this},mR.prototype.add=mR.prototype.push=function(_c){return this.__data__.set(_c,"__lodash_hash_undefined__"),this},mR.prototype.has=function(_c){return this.__data__.has(_c)},QT.prototype.clear=function(){this.__data__=new DT,this.size=0},QT.prototype.delete=function(_c){var _l=this.__data__;return _c=_l.delete(_c),this.size=_l.size,_c},QT.prototype.get=function(_c){return this.__data__.get(_c)},QT.prototype.has=function(_c){return this.__data__.has(_c)},QT.prototype.set=function(_c,_l){var Pl=this.__data__;if(Pl instanceof DT){var Gl=Pl.__data__;if(!G1||199>Gl.length)return Gl.push([_c,_l]),this.size=++Pl.size,this;Pl=this.__data__=new yS(Gl)}return Pl.set(_c,_l),this.size=Pl.size,this};var ZS=iM(eS),q1=iM(DN,!0),DL=wO(),e1=wO(!0),SP=_k?function(_c,_l){return _k.set(_c,_l),_c}:Z_,c3=Wx?function(_c,_l){return Wx(_c,"toString",{configurable:!0,enumerable:!1,value:Sx(_l),writable:!0})}:Z_,RP=e3||function(_c){return L_.clearTimeout(_c)},u3=_I&&1/$p(new _I([,-0]))[1]==Q0?function(_c){return new _I(_c)}:XR,n1=_k?function(_c){return _k.get(_c)}:XR,RR=Qx?function(_c){return _c==null?[]:(_c=_v(_c),_i(Qx(_c),function(_l){return MM.call(_c,_l)}))}:SL,z1=Qx?function(_c){for(var _l=[];_c;)xa(_l,RR(_c)),_c=$x(_c);return _l}:SL,M_=oT;(PL&&M_(new PL(new ArrayBuffer(1)))!="[object DataView]"||G1&&M_(new G1)!="[object Map]"||NL&&M_(NL.resolve())!="[object Promise]"||_I&&M_(new _I)!="[object Set]"||W1&&M_(new W1)!="[object WeakMap]")&&(M_=function(_c){var _l=oT(_c);if(_c=(_c=_l=="[object Object]"?_c.constructor:Op)?ER(_c):"")switch(_c){case s3:return"[object DataView]";case $M:return"[object Map]";case _P:return"[object Promise]";case LL:return"[object Set]";case a3:return"[object WeakMap]"}return _l});var l3=Lx?US:RL,GM=pM(SP),r1=n3||function(_c,_l){return L_.setTimeout(_c,_l)},ML=pM(c3),UL=function(_c){var _l=(_c=_C(_c,function(Pl){return _l.size===500&&_l.clear(),Pl})).cache;return _c}(function(_c){var _l=[];return _c.charCodeAt(0)===46&&_l.push(""),_c.replace(KS,function(Pl,Gl,_d,Sp){_l.push(_d?Sp.replace(I1,"$1"):Gl||Pl)}),_l}),FL=hy(function(_c,_l){return E_(_c)?O1(_c,K_(_l,1,E_,!0)):[]}),d3=hy(function(_c,_l){var Pl=FT(_l);return E_(Pl)&&(Pl=Op),E_(_c)?O1(_c,K_(_l,1,E_,!0),F0(Pl,2)):[]}),h3=hy(function(_c,_l){var Pl=FT(_l);return E_(Pl)&&(Pl=Op),E_(_c)?O1(_c,K_(_l,1,E_,!0),Op,Pl):[]}),BL=hy(function(_c){var _l=ba(_c,WN);return _l.length&&_l[0]===_c[0]?vO(_l):[]}),$L=hy(function(_c){var _l=FT(_c),Pl=ba(_c,WN);return _l===FT(Pl)?_l=Op:Pl.pop(),Pl.length&&Pl[0]===_c[0]?vO(Pl,F0(_l,2)):[]}),f3=hy(function(_c){var _l=FT(_c),Pl=ba(_c,WN);return(_l=typeof _l=="function"?_l:Op)&&Pl.pop(),Pl.length&&Pl[0]===_c[0]?vO(Pl,Op,_l):[]}),p3=hy(vM),WM=DS(function(_c,_l){var Pl=_c==null?0:_c.length,Gl=LN(_c,_l);return J2(_c,ba(_l,function(_d){return MS(_d,Pl)?+_d:_d}).sort(tM)),Gl}),VL=hy(function(_c){return OT(K_(_c,1,E_,!0))}),g3=hy(function(_c){var _l=FT(_c);return E_(_l)&&(_l=Op),OT(K_(_c,1,E_,!0),F0(_l,2))}),AR=hy(function(_c){var _l=FT(_c);return _l=typeof _l=="function"?_l:Op,OT(K_(_c,1,E_,!0),Op,_l)}),m3=hy(function(_c,_l){return E_(_c)?O1(_c,_l):[]}),HM=hy(function(_c){return GN(_i(_c,E_))}),y3=hy(function(_c){var _l=FT(_c);return E_(_l)&&(_l=Op),GN(_i(_c,E_),F0(_l,2))}),i1=hy(function(_c){var _l=FT(_c);return _l=typeof _l=="function"?_l:Op,GN(_i(_c,E_),Op,_l)}),IR=hy(qO),KM=hy(function(_c){var _l=_c.length;return _l=typeof(_l=1<_l?_c[_l-1]:Op)=="function"?(_c.pop(),_l):Op,EM(_c,_l)}),qM=DS(function(_c){var _l=_c.length,Pl=_l?_c[0]:0,Gl=this.__wrapped__,_d=function(Sp){return LN(Sp,_c)};return!(1<_l||this.__actions__.length)&&Gl instanceof T0&&MS(Pl)?((Gl=Gl.slice(Pl,+Pl+(_l?1:0))).__actions__.push({func:qR,args:[_d],thisArg:Op}),new V0(Gl,this.__chain__).thru(function(Sp){return _l&&!Sp.length&&Sp.push(Op),Sp})):this.thru(_d)}),OP=P1(function(_c,_l,Pl){Uy.call(_c,Pl)?++_c[Pl]:ZT(_c,Pl,1)}),GL=oM(gM),v3=oM(mM),zM=P1(function(_c,_l,Pl){Uy.call(_c,Pl)?_c[Pl].push(_l):ZT(_c,Pl,[_l])}),E3=hy(function(_c,_l,Pl){var Gl=-1,_d=typeof _l=="function",Sp=gT(_c)?x_(_c.length):[];return ZS(_c,function(Lp){Sp[++Gl]=_d?g(_l,Lp,Pl):C1(Lp,_l,Pl)}),Sp}),WL=P1(function(_c,_l,Pl){ZT(_c,Pl,_l)}),YM=P1(function(_c,_l,Pl){_c[Pl?0:1].push(_l)},function(){return[[],[]]}),_3=hy(function(_c,_l){if(_c==null)return[];var Pl=_l.length;return 1<Pl&&aT(_c,_l[0],_l[1])?_l=[]:2<Pl&&aT(_l[0],_l[1],_l[2])&&(_l=[_l[0]]),X2(_c,K_(_l,1),[])}),wR=t3||function(){return L_.Date.now()},HL=hy(function(_c,_l,Pl){var Gl=1;if(Pl.length){var _d=Gp(Pl,HR(HL));Gl|=32}return sT(_c,Gl,_l,Pl,_d)}),XM=hy(function(_c,_l,Pl){var Gl=3;if(Pl.length){var _d=Gp(Pl,HR(XM));Gl|=32}return sT(_l,Gl,_c,Pl,_d)}),T3=hy(function(_c,_l){return W2(_c,1,_l)}),JM=hy(function(_c,_l,Pl){return W2(_c,BT(_l)||0,Pl)});_C.Cache=yS;var S3=hy(function(_c,_l){var Pl=(_l=_l.length==1&&iy(_l[0])?ba(_l[0],Ap(F0())):ba(K_(_l,1),Ap(F0()))).length;return hy(function(Gl){for(var _d=-1,Sp=q_(Gl.length,Pl);++_d<Sp;)Gl[_d]=_l[_d].call(this,Gl[_d]);return g(_c,this,Gl)})}),Y1=hy(function(_c,_l){var Pl=Gp(_l,HR(Y1));return sT(_c,32,Op,_l,Pl)}),KL=hy(function(_c,_l){var Pl=Gp(_l,HR(KL));return sT(_c,64,Op,_l,Pl)}),R3=DS(function(_c,_l){return sT(_c,256,Op,Op,Op,_l)}),QM=nS(MN),A3=nS(function(_c,_l){return _c>=_l}),OR=K2(function(){return arguments}())?K2:function(_c){return g_(_c)&&Uy.call(_c,"callee")&&!MM.call(_c,"callee")},iy=x_.isArray,I3=Q_?Ap(Q_):function(_c){return g_(_c)&&oT(_c)=="[object ArrayBuffer]"},eR=r3||RL,O3=D2?Ap(D2):function(_c){return g_(_c)&&oT(_c)=="[object Date]"},ZM=M2?Ap(M2):function(_c){return g_(_c)&&M_(_c)=="[object Map]"},PP=U2?Ap(U2):function(_c){return g_(_c)&&oT(_c)=="[object RegExp]"},o1=j2?Ap(j2):function(_c){return g_(_c)&&M_(_c)=="[object Set]"},s1=gO?Ap(gO):function(_c){return g_(_c)&&Tx(_c.length)&&!!Qy[oT(_c)]},C3=nS(jN),x3=nS(function(_c,_l){return _c<=_l}),k3=$R(function(_c,_l){if(j1(_l)||gT(_l))ES(_l,C_(_l),_c);else for(var Pl in _l)Uy.call(_l,Pl)&&YS(_c,Pl,_l[Pl])}),t5=$R(function(_c,_l){ES(_l,mT(_l),_c)}),NP=$R(function(_c,_l,Pl,Gl){ES(_l,mT(_l),_c,Gl)}),P3=$R(function(_c,_l,Pl,Gl){ES(_l,C_(_l),_c,Gl)}),N3=DS(LN),L3=hy(function(_c,_l){_c=_v(_c);var Pl=-1,Gl=_l.length,_d=2<Gl?_l[2]:Op;for(_d&&aT(_l[0],_l[1],_d)&&(Gl=1);++Pl<Gl;)for(var Sp=mT(_d=_l[Pl]),Lp=-1,Wp=Sp.length;++Lp<Wp;){var Kp=Sp[Lp],Qp=_c[Kp];(Qp===Op||CT(Qp,QR[Kp])&&!Uy.call(_c,Kp))&&(_c[Kp]=_d[Kp])}return _c}),D3=hy(function(_c){return _c.push(Op,uM),g(X1,Op,_c)}),M3=aM(function(_c,_l,Pl){_l!=null&&typeof _l.toString!="function"&&(_l=iS.call(_l)),_c[_l]=Pl},Sx(Z_)),n5=aM(function(_c,_l,Pl){_l!=null&&typeof _l.toString!="function"&&(_l=iS.call(_l)),Uy.call(_c,_l)?_c[_l].push(Pl):_c[_l]=[Pl]},F0),r5=hy(C1),U3=$R(function(_c,_l,Pl){_O(_c,_l,Pl)}),X1=$R(function(_c,_l,Pl,Gl){_O(_c,_l,Pl,Gl)}),YL=DS(function(_c,_l){var Pl={};if(_c==null)return Pl;var Gl=!1;_l=ba(_l,function(Sp){return Sp=vS(Sp,_c),Gl||(Gl=1<Sp.length),Sp}),ES(_c,jO(_c),Pl),Gl&&(Pl=MT(Pl,7,lM));for(var _d=_l.length;_d--;)$N(Pl,_l[_d]);return Pl}),i5=DS(function(_c,_l){return _c==null?{}:function(Pl,Gl){return x1(Pl,Gl,function(_d,Sp){return YR(Pl,Sp)})}(_c,_l)}),J1=L1(C_),XL=L1(mT),j3=VR(function(_c,_l,Pl){return _l=_l.toLowerCase(),_c+(Pl?OM(_l):_l)}),o5=VR(function(_c,_l,Pl){return _c+(Pl?"-":"")+_l.toLowerCase()}),F3=VR(function(_c,_l,Pl){return _c+(Pl?" ":"")+_l.toLowerCase()}),s5=N1("toLowerCase"),a5=VR(function(_c,_l,Pl){return _c+(Pl?"_":"")+_l.toLowerCase()}),B3=VR(function(_c,_l,Pl){return _c+(Pl?" ":"")+JL(_l)}),c5=VR(function(_c,_l,Pl){return _c+(Pl?" ":"")+_l.toUpperCase()}),JL=N1("toUpperCase"),u5=hy(function(_c,_l){try{return g(_c,Op,_l)}catch(Pl){return _L(Pl)?Pl:new OL(Pl)}}),l5=DS(function(_c,_l){return j(_l,function(Pl){Pl=_S(Pl),ZT(_c,Pl,HL(_c[Pl],_c))}),_c}),$3=sM(),V3=sM(!0),G3=hy(function(_c,_l){return function(Pl){return C1(Pl,_c,_l)}}),W3=hy(function(_c,_l){return function(Pl){return C1(_c,Pl,_l)}}),d5=qN(ba),H3=qN(_n),K3=qN(Sl),h5=zN(),f5=zN(!0),q3=CO(function(_c,_l){return _c+_l},0),p5=xO("ceil"),z3=CO(function(_c,_l){return _c/_l},1),Y3=xO("floor"),g5=CO(function(_c,_l){return _c*_l},1),X3=xO("round"),J3=CO(function(_c,_l){return _c-_l},0);return zl.after=function(_c,_l){if(typeof _l!="function")throw new yT("Expected a function");return _c=sy(_c),function(){if(1>--_c)return _l.apply(this,arguments)}},zl.ary=ZN,zl.assign=k3,zl.assignIn=t5,zl.assignInWith=NP,zl.assignWith=P3,zl.at=N3,zl.before=EL,zl.bind=HL,zl.bindAll=l5,zl.bindKey=XM,zl.castArray=function(){if(!arguments.length)return[];var _c=arguments[0];return iy(_c)?_c:[_c]},zl.chain=B1,zl.chunk=function(_c,_l,Pl){if(_l=(Pl?aT(_c,_l,Pl):_l===Op)?1:m_(sy(_l),0),!(Pl=_c==null?0:_c.length)||1>_l)return[];for(var Gl=0,_d=0,Sp=x_(Yx(Pl/_l));Gl<Pl;)Sp[_d++]=O_(_c,Gl,Gl+=_l);return Sp},zl.compact=function(_c){for(var _l=-1,Pl=_c==null?0:_c.length,Gl=0,_d=[];++_l<Pl;){var Sp=_c[_l];Sp&&(_d[Gl++]=Sp)}return _d},zl.concat=function(){var _c=arguments.length;if(!_c)return[];for(var _l=x_(_c-1),Pl=arguments[0];_c--;)_l[_c-1]=arguments[_c];return xa(iy(Pl)?pT(Pl):[Pl],K_(_l,1))},zl.cond=function(_c){var _l=_c==null?0:_c.length,Pl=F0();return _c=_l?ba(_c,function(Gl){if(typeof Gl[1]!="function")throw new yT("Expected a function");return[Pl(Gl[0]),Gl[1]]}):[],hy(function(Gl){for(var _d=-1;++_d<_l;){var Sp=_c[_d];if(g(Sp[0],this,Gl))return g(Sp[1],this,Gl)}})},zl.conforms=function(_c){return function(_l){var Pl=C_(_l);return function(Gl){return G2(Gl,_l,Pl)}}(MT(_c,1))},zl.constant=Sx,zl.countBy=OP,zl.create=function(_c,_l){return _c=_w(_c),_l==null?_c:V2(_c,_l)},zl.curry=function _c(_l,Pl,Gl){return(_l=sT(_l,8,Op,Op,Op,Op,Op,Pl=Gl?Op:Pl)).placeholder=_c.placeholder,_l},zl.curryRight=function _c(_l,Pl,Gl){return(_l=sT(_l,16,Op,Op,Op,Op,Op,Pl=Gl?Op:Pl)).placeholder=_c.placeholder,_l},zl.debounce=JO,zl.defaults=L3,zl.defaultsDeep=D3,zl.defer=T3,zl.delay=JM,zl.difference=FL,zl.differenceBy=d3,zl.differenceWith=h3,zl.drop=function(_c,_l,Pl){var Gl=_c==null?0:_c.length;return Gl?O_(_c,0>(_l=Pl||_l===Op?1:sy(_l))?0:_l,Gl):[]},zl.dropRight=function(_c,_l,Pl){var Gl=_c==null?0:_c.length;return Gl?O_(_c,0,0>(_l=Gl-(_l=Pl||_l===Op?1:sy(_l)))?0:_l):[]},zl.dropRightWhile=function(_c,_l){return _c&&_c.length?NS(_c,F0(_l,3),!0,!0):[]},zl.dropWhile=function(_c,_l){return _c&&_c.length?NS(_c,F0(_l,3),!0):[]},zl.fill=function(_c,_l,Pl,Gl){var _d=_c==null?0:_c.length;if(!_d)return[];for(Pl&&typeof Pl!="number"&&aT(_c,_l,Pl)&&(Pl=0,Gl=_d),_d=_c.length,0>(Pl=sy(Pl))&&(Pl=-Pl>_d?0:_d+Pl),0>(Gl=Gl===Op||Gl>_d?_d:sy(Gl))&&(Gl+=_d),Gl=Pl>Gl?0:AM(Gl);Pl<Gl;)_c[Pl++]=_l;return _c},zl.filter=function(_c,_l){return(iy(_c)?_i:H2)(_c,F0(_l,3))},zl.flatMap=function(_c,_l){return K_(zO(_c,_l),1)},zl.flatMapDeep=function(_c,_l){return K_(zO(_c,_l),Q0)},zl.flatMapDepth=function(_c,_l,Pl){return Pl=Pl===Op?1:sy(Pl),K_(zO(_c,_l),Pl)},zl.flatten=yM,zl.flattenDeep=function(_c){return _c!=null&&_c.length?K_(_c,Q0):[]},zl.flattenDepth=function(_c,_l){return _c!=null&&_c.length?K_(_c,_l=_l===Op?1:sy(_l)):[]},zl.flip=function(_c){return sT(_c,512)},zl.flow=$3,zl.flowRight=V3,zl.fromPairs=function(_c){for(var _l=-1,Pl=_c==null?0:_c.length,Gl={};++_l<Pl;){var _d=_c[_l];Gl[_d[0]]=_d[1]}return Gl},zl.functions=function(_c){return _c==null?[]:yO(_c,C_(_c))},zl.functionsIn=function(_c){return _c==null?[]:yO(_c,mT(_c))},zl.groupBy=zM,zl.initial=function(_c){return _c!=null&&_c.length?O_(_c,0,-1):[]},zl.intersection=BL,zl.intersectionBy=$L,zl.intersectionWith=f3,zl.invert=M3,zl.invertBy=n5,zl.invokeMap=E3,zl.iteratee=Rx,zl.keyBy=WL,zl.keys=C_,zl.keysIn=mT,zl.map=zO,zl.mapKeys=function(_c,_l){var Pl={};return _l=F0(_l,3),eS(_c,function(Gl,_d,Sp){ZT(Pl,_l(Gl,_d,Sp),Gl)}),Pl},zl.mapValues=function(_c,_l){var Pl={};return _l=F0(_l,3),eS(_c,function(Gl,_d,Sp){ZT(Pl,_d,_l(Gl,_d,Sp))}),Pl},zl.matches=function(_c){return z2(MT(_c,1))},zl.matchesProperty=function(_c,_l){return jT(_c,MT(_l,1))},zl.memoize=_C,zl.merge=U3,zl.mergeWith=X1,zl.method=G3,zl.methodOf=W3,zl.mixin=Ox,zl.negate=_x,zl.nthArg=function(_c){return _c=sy(_c),hy(function(_l){return Y2(_l,_c)})},zl.omit=YL,zl.omitBy=function(_c,_l){return wM(_c,_x(F0(_l)))},zl.once=function(_c){return EL(2,_c)},zl.orderBy=function(_c,_l,Pl,Gl){return _c==null?[]:(iy(_l)||(_l=_l==null?[]:[_l]),iy(Pl=Gl?Op:Pl)||(Pl=Pl==null?[]:[Pl]),X2(_c,_l,Pl))},zl.over=d5,zl.overArgs=S3,zl.overEvery=H3,zl.overSome=K3,zl.partial=Y1,zl.partialRight=KL,zl.partition=YM,zl.pick=i5,zl.pickBy=wM,zl.property=V1,zl.propertyOf=function(_c){return function(_l){return _c==null?Op:PS(_c,_l)}},zl.pull=p3,zl.pullAll=vM,zl.pullAllBy=function(_c,_l,Pl){return _c&&_c.length&&_l&&_l.length?bO(_c,_l,F0(Pl,2)):_c},zl.pullAllWith=function(_c,_l,Pl){return _c&&_c.length&&_l&&_l.length?bO(_c,_l,Op,Pl):_c},zl.pullAt=WM,zl.range=h5,zl.rangeRight=f5,zl.rearg=R3,zl.reject=function(_c,_l){return(iy(_c)?_i:H2)(_c,_x(F0(_l,3)))},zl.remove=function(_c,_l){var Pl=[];if(!_c||!_c.length)return Pl;var Gl=-1,_d=[],Sp=_c.length;for(_l=F0(_l,3);++Gl<Sp;){var Lp=_c[Gl];_l(Lp,Gl,_c)&&(Pl.push(Lp),_d.push(Gl))}return J2(_c,_d),Pl},zl.rest=function(_c,_l){if(typeof _c!="function")throw new yT("Expected a function");return hy(_c,_l=_l===Op?_l:sy(_l))},zl.reverse=QN,zl.sampleSize=function(_c,_l,Pl){return _l=(Pl?aT(_c,_l,Pl):_l===Op)?1:sy(_l),(iy(_c)?$U:qU)(_c,_l)},zl.set=function(_c,_l,Pl){return _c==null?_c:BR(_c,_l,Pl)},zl.setWith=function(_c,_l,Pl,Gl){return Gl=typeof Gl=="function"?Gl:Op,_c==null?_c:BR(_c,_l,Pl,Gl)},zl.shuffle=function(_c){return(iy(_c)?VU:zU)(_c)},zl.slice=function(_c,_l,Pl){var Gl=_c==null?0:_c.length;return Gl?(Pl&&typeof Pl!="number"&&aT(_c,_l,Pl)?(_l=0,Pl=Gl):(_l=_l==null?0:sy(_l),Pl=Pl===Op?Gl:sy(Pl)),O_(_c,_l,Pl)):[]},zl.sortBy=_3,zl.sortedUniq=function(_c){return _c&&_c.length?Q2(_c):[]},zl.sortedUniqBy=function(_c,_l){return _c&&_c.length?Q2(_c,F0(_l,2)):[]},zl.split=function(_c,_l,Pl){return Pl&&typeof Pl!="number"&&aT(_c,_l,Pl)&&(_l=Pl=Op),(Pl=Pl===Op?4294967295:Pl>>>0)?(_c=Ly(_c))&&(typeof _l=="string"||_l!=null&&!PP(_l))&&!(_l=wT(_l))&&zS.test(_c)?QS(n0(_c),0,Pl):_c.split(_l,Pl):[]},zl.spread=function(_c,_l){if(typeof _c!="function")throw new yT("Expected a function");return _l=_l==null?0:m_(sy(_l),0),hy(function(Pl){var Gl=Pl[_l];return Pl=QS(Pl,0,_l),Gl&&xa(Pl,Gl),g(_c,this,Pl)})},zl.tail=function(_c){var _l=_c==null?0:_c.length;return _l?O_(_c,1,_l):[]},zl.take=function(_c,_l,Pl){return _c&&_c.length?O_(_c,0,0>(_l=Pl||_l===Op?1:sy(_l))?0:_l):[]},zl.takeRight=function(_c,_l,Pl){var Gl=_c==null?0:_c.length;return Gl?O_(_c,0>(_l=Gl-(_l=Pl||_l===Op?1:sy(_l)))?0:_l,Gl):[]},zl.takeRightWhile=function(_c,_l){return _c&&_c.length?NS(_c,F0(_l,3),!1,!0):[]},zl.takeWhile=function(_c,_l){return _c&&_c.length?NS(_c,F0(_l,3)):[]},zl.tap=function(_c,_l){return _l(_c),_c},zl.throttle=function(_c,_l,Pl){var Gl=!0,_d=!0;if(typeof _c!="function")throw new yT("Expected a function");return Zy(Pl)&&(Gl="leading"in Pl?!!Pl.leading:Gl,_d="trailing"in Pl?!!Pl.trailing:_d),JO(_c,_l,{leading:Gl,maxWait:_l,trailing:_d})},zl.thru=qR,zl.toArray=RM,zl.toPairs=J1,zl.toPairsIn=XL,zl.toPath=function(_c){return iy(_c)?ba(_c,_S):xT(_c)?[_c]:pT(UL(Ly(_c)))},zl.toPlainObject=IM,zl.transform=function(_c,_l,Pl){var Gl=iy(_c),_d=Gl||eR(_c)||s1(_c);if(_l=F0(_l,4),Pl==null){var Sp=_c&&_c.constructor;Pl=_d?Gl?new Sp:[]:Zy(_c)&&US(Sp)?_w($x(_c)):{}}return(_d?j:eS)(_c,function(Lp,Wp,Kp){return _l(Pl,Lp,Wp,Kp)}),Pl},zl.unary=function(_c){return ZN(_c,1)},zl.union=VL,zl.unionBy=g3,zl.unionWith=AR,zl.uniq=function(_c){return _c&&_c.length?OT(_c):[]},zl.uniqBy=function(_c,_l){return _c&&_c.length?OT(_c,F0(_l,2)):[]},zl.uniqWith=function(_c,_l){return _l=typeof _l=="function"?_l:Op,_c&&_c.length?OT(_c,Op,_l):[]},zl.unset=function(_c,_l){return _c==null||$N(_c,_l)},zl.unzip=qO,zl.unzipWith=EM,zl.update=function(_c,_l,Pl){return _c!=null&&(_c=BR(_c,_l,(Pl=HN(Pl))(PS(_c,_l)),void 0)),_c},zl.updateWith=function(_c,_l,Pl,Gl){return Gl=typeof Gl=="function"?Gl:Op,_c!=null&&(_c=BR(_c,_l,(Pl=HN(Pl))(PS(_c,_l)),Gl)),_c},zl.values=_R,zl.valuesIn=function(_c){return _c==null?[]:Cp(_c,mT(_c))},zl.without=m3,zl.words=xM,zl.wrap=function(_c,_l){return Y1(HN(_l),_c)},zl.xor=HM,zl.xorBy=y3,zl.xorWith=i1,zl.zip=IR,zl.zipObject=function(_c,_l){return D_(_c||[],_l||[],YS)},zl.zipObjectDeep=function(_c,_l){return D_(_c||[],_l||[],BR)},zl.zipWith=KM,zl.entries=J1,zl.entriesIn=XL,zl.extend=t5,zl.extendWith=NP,Ox(zl,zl),zl.add=q3,zl.attempt=u5,zl.camelCase=j3,zl.capitalize=OM,zl.ceil=p5,zl.clamp=function(_c,_l,Pl){return Pl===Op&&(Pl=_l,_l=Op),Pl!==Op&&(Pl=(Pl=BT(Pl))==Pl?Pl:0),_l!==Op&&(_l=(_l=BT(_l))==_l?_l:0),XS(BT(_c),_l,Pl)},zl.clone=function(_c){return MT(_c,4)},zl.cloneDeep=function(_c){return MT(_c,5)},zl.cloneDeepWith=function(_c,_l){return MT(_c,5,_l=typeof _l=="function"?_l:Op)},zl.cloneWith=function(_c,_l){return MT(_c,4,_l=typeof _l=="function"?_l:Op)},zl.conformsTo=function(_c,_l){return _l==null||G2(_c,_l,C_(_l))},zl.deburr=CM,zl.defaultTo=function(_c,_l){return _c==null||_c!=_c?_l:_c},zl.divide=z3,zl.endsWith=function(_c,_l,Pl){_c=Ly(_c),_l=wT(_l);var Gl=_c.length;return Gl=Pl=Pl===Op?Gl:XS(sy(Pl),0,Gl),0<=(Pl-=_l.length)&&_c.slice(Pl,Gl)==_l},zl.eq=CT,zl.escape=function(_c){return(_c=Ly(_c))&&vy.test(_c)?_c.replace(d0,F2):_c},zl.escapeRegExp=function(_c){return(_c=Ly(_c))&&$0.test(_c)?_c.replace(S0,"\\$&"):_c},zl.every=function(_c,_l,Pl){var Gl=iy(_c)?_n:GU;return Pl&&aT(_c,_l,Pl)&&(_l=Op),Gl(_c,F0(_l,3))},zl.find=GL,zl.findIndex=gM,zl.findKey=function(_c,_l){return Il(_c,F0(_l,3),eS)},zl.findLast=v3,zl.findLastIndex=mM,zl.findLastKey=function(_c,_l){return Il(_c,F0(_l,3),DN)},zl.floor=Y3,zl.forEach=_M,zl.forEachRight=bM,zl.forIn=function(_c,_l){return _c==null?_c:DL(_c,F0(_l,3),mT)},zl.forInRight=function(_c,_l){return _c==null?_c:e1(_c,F0(_l,3),mT)},zl.forOwn=function(_c,_l){return _c&&eS(_c,F0(_l,3))},zl.forOwnRight=function(_c,_l){return _c&&DN(_c,F0(_l,3))},zl.get=TL,zl.gt=QM,zl.gte=A3,zl.has=function(_c,_l){return _c!=null&&dM(_c,_l,WU)},zl.hasIn=YR,zl.head=HO,zl.identity=Z_,zl.includes=function(_c,_l,Pl,Gl){return _c=gT(_c)?_c:_R(_c),Pl=Pl&&!Gl?sy(Pl):0,Gl=_c.length,0>Pl&&(Pl=m_(Gl+Pl,0)),zR(_c)?Pl<=Gl&&-1<_c.indexOf(_l,Pl):!!Gl&&-1<Nl(_c,_l,Pl)},zl.indexOf=function(_c,_l,Pl){var Gl=_c==null?0:_c.length;return Gl?(0>(Pl=Pl==null?0:sy(Pl))&&(Pl=m_(Gl+Pl,0)),Nl(_c,_l,Pl)):-1},zl.inRange=function(_c,_l,Pl){return _l=rS(_l),Pl===Op?(Pl=_l,_l=0):Pl=rS(Pl),(_c=BT(_c))>=q_(_l,Pl)&&_c<m_(_l,Pl)},zl.invoke=r5,zl.isArguments=OR,zl.isArray=iy,zl.isArrayBuffer=I3,zl.isArrayLike=gT,zl.isArrayLikeObject=E_,zl.isBoolean=function(_c){return _c===!0||_c===!1||g_(_c)&&oT(_c)=="[object Boolean]"},zl.isBuffer=eR,zl.isDate=O3,zl.isElement=function(_c){return g_(_c)&&_c.nodeType===1&&!$1(_c)},zl.isEmpty=function(_c){if(_c==null)return!0;if(gT(_c)&&(iy(_c)||typeof _c=="string"||typeof _c.splice=="function"||eR(_c)||s1(_c)||OR(_c)))return!_c.length;var _l=M_(_c);if(_l=="[object Map]"||_l=="[object Set]")return!_c.size;if(j1(_c))return!EO(_c).length;for(var Pl in _c)if(Uy.call(_c,Pl))return!1;return!0},zl.isEqual=function(_c,_l){return JS(_c,_l)},zl.isEqualWith=function(_c,_l,Pl){var Gl=(Pl=typeof Pl=="function"?Pl:Op)?Pl(_c,_l):Op;return Gl===Op?JS(_c,_l,Op,Pl):!!Gl},zl.isError=_L,zl.isFinite=function(_c){return typeof _c=="number"&&jM(_c)},zl.isFunction=US,zl.isInteger=TM,zl.isLength=Tx,zl.isMap=ZM,zl.isMatch=function(_c,_l){return _c===_l||yR(_c,_l,KR(_l))},zl.isMatchWith=function(_c,_l,Pl){return Pl=typeof Pl=="function"?Pl:Op,yR(_c,_l,KR(_l),Pl)},zl.isNaN=function(_c){return SM(_c)&&_c!=+_c},zl.isNative=function(_c){if(l3(_c))throw new OL("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return UT(_c)},zl.isNil=function(_c){return _c==null},zl.isNull=function(_c){return _c===null},zl.isNumber=SM,zl.isObject=Zy,zl.isObjectLike=g_,zl.isPlainObject=$1,zl.isRegExp=PP,zl.isSafeInteger=function(_c){return TM(_c)&&-9007199254740991<=_c&&9007199254740991>=_c},zl.isSet=o1,zl.isString=zR,zl.isSymbol=xT,zl.isTypedArray=s1,zl.isUndefined=function(_c){return _c===Op},zl.isWeakMap=function(_c){return g_(_c)&&M_(_c)=="[object WeakMap]"},zl.isWeakSet=function(_c){return g_(_c)&&oT(_c)=="[object WeakSet]"},zl.join=function(_c,_l){return _c==null?"":FM.call(_c,_l)},zl.kebabCase=o5,zl.last=FT,zl.lastIndexOf=function(_c,_l,Pl){var Gl=_c==null?0:_c.length;if(!Gl)return-1;var _d=Gl;if(Pl!==Op&&(_d=0>(_d=sy(Pl))?m_(Gl+_d,0):q_(_d,Gl-1)),_l==_l)e:{for(Pl=_d+1;Pl--;)if(_c[Pl]===_l){_c=Pl;break e}_c=Pl}else _c=Cl(_c,Ul,_d,!0);return _c},zl.lowerCase=F3,zl.lowerFirst=s5,zl.lt=C3,zl.lte=x3,zl.max=function(_c){return _c&&_c.length?mO(_c,Z_,MN):Op},zl.maxBy=function(_c,_l){return _c&&_c.length?mO(_c,F0(_l,2),MN):Op},zl.mean=function(_c){return Kl(_c,Z_)},zl.meanBy=function(_c,_l){return Kl(_c,F0(_l,2))},zl.min=function(_c){return _c&&_c.length?mO(_c,Z_,jN):Op},zl.minBy=function(_c,_l){return _c&&_c.length?mO(_c,F0(_l,2),jN):Op},zl.stubArray=SL,zl.stubFalse=RL,zl.stubObject=function(){return{}},zl.stubString=function(){return""},zl.stubTrue=function(){return!0},zl.multiply=g5,zl.nth=function(_c,_l){return _c&&_c.length?Y2(_c,sy(_l)):Op},zl.noConflict=function(){return L_._===this&&(L_._=NM),this},zl.noop=XR,zl.now=wR,zl.pad=function(_c,_l,Pl){_c=Ly(_c);var Gl=(_l=sy(_l))?c0(_c):0;return!_l||Gl>=_l?_c:WR(Xx(_l=(_l-Gl)/2),Pl)+_c+WR(Yx(_l),Pl)},zl.padEnd=function(_c,_l,Pl){_c=Ly(_c);var Gl=(_l=sy(_l))?c0(_c):0;return _l&&Gl<_l?_c+WR(_l-Gl,Pl):_c},zl.padStart=function(_c,_l,Pl){_c=Ly(_c);var Gl=(_l=sy(_l))?c0(_c):0;return _l&&Gl<_l?WR(_l-Gl,Pl)+_c:_c},zl.parseInt=function(_c,_l,Pl){return Pl||_l==null?_l=0:_l&&(_l=+_l),o3(Ly(_c).replace(ey,""),_l||0)},zl.random=function(_c,_l,Pl){if(Pl&&typeof Pl!="boolean"&&aT(_c,_l,Pl)&&(_l=Pl=Op),Pl===Op&&(typeof _l=="boolean"?(Pl=_l,_l=Op):typeof _c=="boolean"&&(Pl=_c,_c=Op)),_c===Op&&_l===Op?(_c=0,_l=1):(_c=rS(_c),_l===Op?(_l=_c,_c=0):_l=rS(_l)),_c>_l){var Gl=_c;_c=_l,_l=Gl}return Pl||_c%1||_l%1?(Pl=BM(),q_(_c+Pl*(_l-_c+MU("1e-"+((Pl+"").length-1))),_l)):k1(_c,_l)},zl.reduce=function(_c,_l,Pl){var Gl=iy(_c)?El:_p,_d=3>arguments.length;return Gl(_c,F0(_l,4),Pl,_d,ZS)},zl.reduceRight=function(_c,_l,Pl){var Gl=iy(_c)?Tl:_p,_d=3>arguments.length;return Gl(_c,F0(_l,4),Pl,_d,q1)},zl.repeat=function(_c,_l,Pl){return _l=(Pl?aT(_c,_l,Pl):_l===Op)?1:sy(_l),FN(Ly(_c),_l)},zl.replace=function(){var _c=arguments,_l=Ly(_c[0]);return 3>_c.length?_l:_l.replace(_c[1],_c[2])},zl.result=function(_c,_l,Pl){var Gl=-1,_d=(_l=vS(_l,_c)).length;for(_d||(_d=1,_c=Op);++Gl<_d;){var Sp=_c==null?Op:_c[_S(_l[Gl])];Sp===Op&&(Gl=_d,Sp=Pl),_c=US(Sp)?Sp.call(_c):Sp}return _c},zl.round=X3,zl.runInContext=Xp,zl.sample=function(_c){return(iy(_c)?$2:KU)(_c)},zl.size=function(_c){if(_c==null)return 0;if(gT(_c))return zR(_c)?c0(_c):_c.length;var _l=M_(_c);return _l=="[object Map]"||_l=="[object Set]"?_c.size:EO(_c).length},zl.snakeCase=a5,zl.some=function(_c,_l,Pl){var Gl=iy(_c)?Sl:AO;return Pl&&aT(_c,_l,Pl)&&(_l=Op),Gl(_c,F0(_l,3))},zl.sortedIndex=function(_c,_l){return IO(_c,_l)},zl.sortedIndexBy=function(_c,_l,Pl){return BN(_c,_l,F0(Pl,2))},zl.sortedIndexOf=function(_c,_l){var Pl=_c==null?0:_c.length;if(Pl){var Gl=IO(_c,_l);if(Gl<Pl&&CT(_c[Gl],_l))return Gl}return-1},zl.sortedLastIndex=function(_c,_l){return IO(_c,_l,!0)},zl.sortedLastIndexBy=function(_c,_l,Pl){return BN(_c,_l,F0(Pl,2),!0)},zl.sortedLastIndexOf=function(_c,_l){if(_c!=null&&_c.length){var Pl=IO(_c,_l,!0)-1;if(CT(_c[Pl],_l))return Pl}return-1},zl.startCase=B3,zl.startsWith=function(_c,_l,Pl){return _c=Ly(_c),Pl=Pl==null?0:XS(sy(Pl),0,_c.length),_l=wT(_l),_c.slice(Pl,Pl+_l.length)==_l},zl.subtract=J3,zl.sum=function(_c){return _c&&_c.length?Ip(_c,Z_):0},zl.sumBy=function(_c,_l){return _c&&_c.length?Ip(_c,F0(_l,2)):0},zl.template=function(_c,_l,Pl){var Gl=zl.templateSettings;Pl&&aT(_c,_l,Pl)&&(_l=Op),_c=Ly(_c),_l=NP({},_l,Gl,cM);var _d,Sp,Lp=C_(Pl=NP({},_l.imports,Gl.imports,cM)),Wp=Cp(Pl,Lp),Kp=0;Pl=_l.interpolate||fR;var Qp="__p += '";Pl=CL((_l.escape||fR).source+"|"+Pl.source+"|"+(Pl===IT?P2:fR).source+"|"+(_l.evaluate||fR).source+"|$","g");var i0="//# sourceURL="+(Uy.call(_l,"sourceURL")?(_l.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++wN+"]")+`
`;if(_c.replace(Pl,function(v0,A0,f0,L0,G0,ay){return f0||(f0=L0),Qp+=_c.slice(Kp,ay).replace(PU,Fp),A0&&(_d=!0,Qp+=`' +
__e(`+A0+`) +
'`),G0&&(Sp=!0,Qp+=`';
`+G0+`;
__p += '`),f0&&(Qp+=`' +
((__t = (`+f0+`)) == null ? '' : __t) +
'`),Kp=ay+v0.length,v0}),Qp+=`';
`,_l=Uy.call(_l,"variable")&&_l.variable){if(SN.test(_l))throw new OL("Invalid `variable` option passed into `_.template`")}else Qp=`with (obj) {
`+Qp+`
}
`;if(Qp=(Sp?Qp.replace(J_,""):Qp).replace(R0,"$1").replace(ry,"$1;"),Qp="function("+(_l||"obj")+`) {
`+(_l?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(_d?", __e = _.escape":"")+(Sp?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+Qp+`return __p
}`,(_l=u5(function(){return bR(Lp,i0+"return "+Qp).apply(Op,Wp)})).source=Qp,_L(_l))throw _l;return _l},zl.times=function(_c,_l){if(1>(_c=sy(_c))||9007199254740991<_c)return[];var Pl=4294967295,Gl=q_(_c,4294967295);for(_c-=4294967295,Gl=Up(Gl,_l=F0(_l));++Pl<_c;)_l(Pl);return Gl},zl.toFinite=rS,zl.toInteger=sy,zl.toLength=AM,zl.toLower=function(_c){return Ly(_c).toLowerCase()},zl.toNumber=BT,zl.toSafeInteger=function(_c){return _c?XS(sy(_c),-9007199254740991,9007199254740991):_c===0?_c:0},zl.toString=Ly,zl.toUpper=function(_c){return Ly(_c).toUpperCase()},zl.trim=function(_c,_l,Pl){return(_c=Ly(_c))&&(Pl||_l===Op)?yp(_c):_c&&(_l=wT(_l))?QS(_c=n0(_c),_l=wp(_c,Pl=n0(_l)),Pl=Np(_c,Pl)+1).join(""):_c},zl.trimEnd=function(_c,_l,Pl){return(_c=Ly(_c))&&(Pl||_l===Op)?_c.slice(0,C0(_c)+1):_c&&(_l=wT(_l))?QS(_c=n0(_c),0,_l=Np(_c,n0(_l))+1).join(""):_c},zl.trimStart=function(_c,_l,Pl){return(_c=Ly(_c))&&(Pl||_l===Op)?_c.replace(ey,""):_c&&(_l=wT(_l))?QS(_c=n0(_c),_l=wp(_c,n0(_l))).join(""):_c},zl.truncate=function(_c,_l){var Pl=30,Gl="...";if(Zy(_l)){var _d="separator"in _l?_l.separator:_d;Pl="length"in _l?sy(_l.length):Pl,Gl="omission"in _l?wT(_l.omission):Gl}if(_l=(_c=Ly(_c)).length,zS.test(_c)){var Sp=n0(_c);_l=Sp.length}if(Pl>=_l)return _c;if(1>(_l=Pl-c0(Gl)))return Gl;if(Pl=Sp?QS(Sp,0,_l).join(""):_c.slice(0,_l),_d===Op)return Pl+Gl;if(Sp&&(_l+=Pl.length-_l),PP(_d)){if(_c.slice(_l).search(_d)){for(Sp=Pl,_d.global||(_d=CL(_d.source,Ly(N2.exec(_d))+"g")),_d.lastIndex=0;_c=_d.exec(Sp);)var Lp=_c.index;Pl=Pl.slice(0,Lp===Op?_l:Lp)}}else _c.indexOf(wT(_d),_l)!=_l&&-1<(_d=Pl.lastIndexOf(_d))&&(Pl=Pl.slice(0,_d));return Pl+Gl},zl.unescape=function(_c){return(_c=Ly(_c))&&Cy.test(_c)?_c.replace(q0,BU):_c},zl.uniqueId=function(_c){var _l=++JU;return Ly(_c)+_l},zl.upperCase=c5,zl.upperFirst=JL,zl.each=_M,zl.eachRight=bM,zl.first=HO,Ox(zl,function(){var _c={};return eS(zl,function(_l,Pl){Uy.call(zl.prototype,Pl)||(_c[Pl]=_l)}),_c}(),{chain:!1}),zl.VERSION="4.17.21",j("bind bindKey curry curryRight partial partialRight".split(" "),function(_c){zl[_c].placeholder=zl}),j(["drop","take"],function(_c,_l){T0.prototype[_c]=function(Pl){Pl=Pl===Op?1:m_(sy(Pl),0);var Gl=this.__filtered__&&!_l?new T0(this):this.clone();return Gl.__filtered__?Gl.__takeCount__=q_(Pl,Gl.__takeCount__):Gl.__views__.push({size:q_(Pl,4294967295),type:_c+(0>Gl.__dir__?"Right":"")}),Gl},T0.prototype[_c+"Right"]=function(Pl){return this.reverse()[_c](Pl).reverse()}}),j(["filter","map","takeWhile"],function(_c,_l){var Pl=_l+1,Gl=Pl==1||Pl==3;T0.prototype[_c]=function(_d){var Sp=this.clone();return Sp.__iteratees__.push({iteratee:F0(_d,3),type:Pl}),Sp.__filtered__=Sp.__filtered__||Gl,Sp}}),j(["head","last"],function(_c,_l){var Pl="take"+(_l?"Right":"");T0.prototype[_c]=function(){return this[Pl](1).value()[0]}}),j(["initial","tail"],function(_c,_l){var Pl="drop"+(_l?"":"Right");T0.prototype[_c]=function(){return this.__filtered__?new T0(this):this[Pl](1)}}),T0.prototype.compact=function(){return this.filter(Z_)},T0.prototype.find=function(_c){return this.filter(_c).head()},T0.prototype.findLast=function(_c){return this.reverse().find(_c)},T0.prototype.invokeMap=hy(function(_c,_l){return typeof _c=="function"?new T0(this):this.map(function(Pl){return C1(Pl,_c,_l)})}),T0.prototype.reject=function(_c){return this.filter(_x(F0(_c)))},T0.prototype.slice=function(_c,_l){_c=sy(_c);var Pl=this;return Pl.__filtered__&&(0<_c||0>_l)?new T0(Pl):(0>_c?Pl=Pl.takeRight(-_c):_c&&(Pl=Pl.drop(_c)),_l!==Op&&(Pl=0>(_l=sy(_l))?Pl.dropRight(-_l):Pl.take(_l-_c)),Pl)},T0.prototype.takeRightWhile=function(_c){return this.reverse().takeWhile(_c).reverse()},T0.prototype.toArray=function(){return this.take(4294967295)},eS(T0.prototype,function(_c,_l){var Pl=/^(?:filter|find|map|reject)|While$/.test(_l),Gl=/^(?:head|last)$/.test(_l),_d=zl[Gl?"take"+(_l=="last"?"Right":""):_l],Sp=Gl||/^find/.test(_l);_d&&(zl.prototype[_l]=function(){var Lp=this.__wrapped__,Wp=Gl?[1]:arguments,Kp=Lp instanceof T0,Qp=Wp[0],i0=Kp||iy(Lp),v0=function(L0){return L0=_d.apply(zl,xa([L0],Wp)),Gl&&A0?L0[0]:L0};i0&&Pl&&typeof Qp=="function"&&Qp.length!=1&&(Kp=i0=!1);var A0=this.__chain__,f0=!!this.__actions__.length;return Qp=Sp&&!A0,Kp=Kp&&!f0,!Sp&&i0?(Lp=Kp?Lp:new T0(this),(Lp=_c.apply(Lp,Wp)).__actions__.push({func:qR,args:[v0],thisArg:Op}),new V0(Lp,A0)):Qp&&Kp?_c.apply(this,Wp):(Lp=this.thru(v0),Qp?Gl?Lp.value()[0]:Lp.value():Lp)})}),j("pop push shift sort splice unshift".split(" "),function(_c){var _l=Nx[_c],Pl=/^(?:push|sort|unshift)$/.test(_c)?"tap":"thru",Gl=/^(?:pop|shift)$/.test(_c);zl.prototype[_c]=function(){var _d=arguments;if(Gl&&!this.__chain__){var Sp=this.value();return _l.apply(iy(Sp)?Sp:[],_d)}return this[Pl](function(Lp){return _l.apply(iy(Lp)?Lp:[],_d)})}}),eS(T0.prototype,function(_c,_l){if(_c=zl[_l]){var Pl=_c.name+"";Uy.call(FS,Pl)||(FS[Pl]=[]),FS[Pl].push({name:_l,func:_c})}}),FS[tS(Op,2).name]=[{name:"wrapper",func:Op}],T0.prototype.clone=function(){var _c=new T0(this.__wrapped__);return _c.__actions__=pT(this.__actions__),_c.__dir__=this.__dir__,_c.__filtered__=this.__filtered__,_c.__iteratees__=pT(this.__iteratees__),_c.__takeCount__=this.__takeCount__,_c.__views__=pT(this.__views__),_c},T0.prototype.reverse=function(){if(this.__filtered__){var _c=new T0(this);_c.__dir__=-1,_c.__filtered__=!0}else(_c=this.clone()).__dir__*=-1;return _c},T0.prototype.value=function(){for(var _c=this.__wrapped__.value(),_l=this.__dir__,Pl=iy(_c),Gl=0>_l,_d=Pl?_c.length:0,Sp=0,Lp=_d,Wp=this.__views__,Kp=-1,Qp=Wp.length;++Kp<Qp;){var i0=Wp[Kp],v0=i0.size;switch(i0.type){case"drop":Sp+=v0;break;case"dropRight":Lp-=v0;break;case"take":Lp=q_(Lp,Sp+v0);break;case"takeRight":Sp=m_(Sp,Lp-v0)}}if(Lp=(Wp=Lp)-Sp,Sp=Gl?Wp:Sp-1,Kp=(Wp=this.__iteratees__).length,Qp=0,i0=q_(Lp,this.__takeCount__),!Pl||!Gl&&_d==Lp&&i0==Lp)return VN(_c,this.__actions__);Pl=[];e:for(;Lp--&&Qp<i0;){for(Gl=-1,_d=_c[Sp+=_l];++Gl<Kp;){var A0=Wp[Gl];if(v0=A0.iteratee,A0=A0.type,v0=v0(_d),A0==2)_d=v0;else if(!v0){if(A0==1)continue e;break e}}Pl[Qp++]=_d}return Pl},zl.prototype.at=qM,zl.prototype.chain=function(){return B1(this)},zl.prototype.commit=function(){return new V0(this.value(),this.__chain__)},zl.prototype.next=function(){this.__values__===Op&&(this.__values__=RM(this.value()));var _c=this.__index__>=this.__values__.length;return{done:_c,value:_c?Op:this.__values__[this.__index__++]}},zl.prototype.plant=function(_c){for(var _l,Pl=this;Pl instanceof M0;){var Gl=F1(Pl);Gl.__index__=0,Gl.__values__=Op,_l?_d.__wrapped__=Gl:_l=Gl;var _d=Gl;Pl=Pl.__wrapped__}return _d.__wrapped__=_c,_l},zl.prototype.reverse=function(){var _c=this.__wrapped__;return _c instanceof T0?(this.__actions__.length&&(_c=new T0(this)),(_c=_c.reverse()).__actions__.push({func:qR,args:[QN],thisArg:Op}),new V0(_c,this.__chain__)):this.thru(QN)},zl.prototype.toJSON=zl.prototype.valueOf=zl.prototype.value=function(){return VN(this.__wrapped__,this.__actions__)},zl.prototype.first=zl.prototype.head,ZR&&(zl.prototype[ZR]=function(){return this}),zl}();pR?((pR.exports=gR)._=gR,xN._=gR):L_._=gR}).call(qb)}),Nz=1/0,wq=function(h){return h?(h=hl(h))===Nz||h===-Nz?17976931348623157e292*(0>h?-1:1):h==h?h:0:h===0?h:0},KO=Math.max,AC=function(h,i,g){var _=Object(h);if(!$f(h)){var j=Ch(i);h=Wf(h),i=function($){return j(_[$],$,_)}}return-1<(i=function($,_n,_i){var _s=$==null?0:$.length;if(!_s)return-1;if(_i==null)_i=0;else{var ga=(_i=wq(_i))%1;_i=_i==_i?ga?_i-ga:_i:0}return 0>_i&&(_i=KO(_s+_i,0)),Cv($,Ch(_n),_i)}(h,i,g))?_[j?h[i]:i]:void 0},zC=function(h,i){return h&&h.length?Do(h,void 0,typeof i=="function"?i:void 0):[]},Oz=function(){function h(){ab(this,h),E(this,"size",0),E(this,"fields",new Map)}return Qb(h,[{key:"define",value:function(i,g,_){if(this.size+=_,64<this.size)throw new RangeError("the struct over 64 bits is not supported");ak(g={val:0,isNumber:g==="number",isBoolean:g==="boolean",oneof:g==="number"||g==="boolean"?void 0:g,len:_}),this.fields.set(i,g)}},{key:"set",value:function(i,g){if(!(i=this.fields.get(i)))throw Error("field not found");var _=i.oneof;if(!D.isLong(g)&&typeof g!="number")if(typeof g=="boolean")g=g?1:0;else{if(_===void 0)throw Error("invalid field type");if((g=_[g])===void 0)throw Error("field type not found")}ak(i,g),i.val=g}},{key:"toNumber",value:function(){for(var i=0,g=0,_=0,j=Array.from(this.fields);_<j.length;_++){var $=Lb(j[_],2)[1],_n=$.len;($=$.val)!==void 0&&(i+=D.fromValue($).shiftLeft(g).toNumber(),g+=_n)}return i}},{key:"toLong",value:function(){for(var i=D.fromNumber(0,!0),g=0,_=0,j=Array.from(this.fields);_<j.length;_++){var $=Lb(j[_],2)[1],_n=$.len;($=$.val)!==void 0&&(i=D.fromValue($).shiftLeft(g).add(i),g+=_n)}return i}},{key:"assert",value:function(i,g){function _(_n){if(!D.isLong(_n)&&typeof _n!="number")if(typeof _n=="boolean")_n=_n?1:0;else{if($===void 0)throw Error("invalid field type");if((_n=$[_n])===void 0)throw Error("field type not found")}return ak(j,_n),Zj(_n,j.val)}var j=this.fields.get(i);if(!j)throw Error("field not found");var $=j.oneof;if(!Array.isArray(g))return _(g);if(g.length===1)return _(g[0]);if(g.every(function(_n){return typeof _n=="string"})&&$!==void 0)return g.some(function(_n){return _(_n)});throw Error("invalid valueTypes")}},{key:"from",value:function(i){i=D.fromValue(i);for(var g=0,_=0,j=Array.from(this.fields);_<j.length;_++){var $=Lb(j[_],2)[1],_n=$.len,_i=D.fromNumber(Math.pow(2,_n)-1,!0).shiftLeft(g);ak($,_i=i.and(_i).shiftRightUnsigned(g)),$.val=_i,g+=_n}}},{key:"typeOf",value:function(i){if((i=this.fields.get(i))!==void 0){var g=i.oneof;if(i=i.val,g!==void 0){var _=0;for(g=Object.entries(g);_<g.length;_++){var j=Lb(g[_],2),$=j[0];if(Zj(i,j[1]))return $}}}throw new TypeError("can only get type of oneof type")}}]),h}(),Pz=function(h){function i(_){ab(this,i);var j=g.call(this);return j.define("Rejoin","boolean",1),j.define("Unused","number",31),j.define("Platform","number",8),j.define("Version","number",12),j.define("Subversion","number",12),j.set("Platform",7),j.set("Version",7),j.set("Subversion",228),j.set("Rejoin",_),j}nb(i,h);var g=ob(i);return i}(Oz),LO=tb(tb({},{PeerTextMessage:0,ChannelTextMessage:1,VendorTextMessage:2}),{PeerRawMessage:3,ChannelRawMessage:4,VendorRawMessage:5}),Qz={CallInvite:101,CallAccept:102,CallReject:103,CallCancel:104},MO=tb(tb({},LO),Qz),NO={Uncompressed:0,Zlib:1},Yh=function(h){function i(_){ab(this,i);var j=g.call(this);if(j.define("MessageType",MO,8),j.define("BroadcastJumps","number",2),j.define("ToCache","boolean",1),j.define("FromCache","boolean",1),j.define("CompressionMethod",NO,2),j.define("IterationNumber","number",4),j.define("BufferedMessage","boolean",1),j.define("ToArchive","boolean",1),j.define("FromArchive","boolean",1),typeof _=="number"||D.isLong(_))j.from(_);else if(_!==void 0){var $=0;for(_=Vj(_);$<_.length;$++){var _n=Lb(_[$],2);j.set(_n[0],_n[1])}}return j}nb(i,h);var g=ob(i);return Qb(i,[{key:"isTextMessage",value:function(){return this.assert("MessageType",["PeerTextMessage","ChannelTextMessage","VendorTextMessage"])}},{key:"isRawMessage",value:function(){return this.assert("MessageType",["ChannelRawMessage","PeerRawMessage","VendorRawMessage"])}},{key:"isRawPeerMessage",value:function(){return this.assert("MessageType","PeerRawMessage")}},{key:"isRawChannelMessage",value:function(){return this.assert("MessageType","ChannelRawMessage")}},{key:"isPeerTextMessage",value:function(){return this.assert("MessageType","PeerTextMessage")}},{key:"isChannelTextMessage",value:function(){return this.assert("MessageType","ChannelTextMessage")}},{key:"isInvitation",value:function(_){var j=this;return _!==void 0?this.assert("MessageType",_):vi(Qz).some(function($){return j.assert("MessageType",$)})}},{key:"isPeerMessage",value:function(){return this.assert("MessageType",["PeerTextMessage","PeerRawMessage"])}},{key:"isZlibCompressed",value:function(){return this.assert("CompressionMethod","Zlib")}},{key:"isFromCache",value:function(){return this.assert("FromCache",!0)}},{key:"isBufferedMessage",value:function(){return this.assert("BufferedMessage",!0)}},{key:"getInvitationType",value:function(){if(!this.isInvitation())throw new TypeError("cannot get InvitationType of a normal message type");return this.typeOf("MessageType")}}]),i}(Oz),Fs=function(){function h(i){var g,_,j,$,_n;ab(this,h),E(this,"key",void 0),E(this,"value",void 0),E(this,"revision",void 0),E(this,"updateTs",void 0),E(this,"authorUserId",void 0),this.key=(g=i==null?void 0:i.key)!==null&&g!==void 0?g:"",this.value=(_=i==null?void 0:i.value)!==null&&_!==void 0?_:"",this.revision=(j=i==null?void 0:i.revision)!==null&&j!==void 0?j:-1,this.updateTs=($=i==null?void 0:i.updateTs)!==null&&$!==void 0?$:0,this.authorUserId=(_n=i==null?void 0:i.authorUserId)!==null&&_n!==void 0?_n:""}return Qb(h,[{key:"setKey",value:function(i){if(typeof i!="string")throw new Ib("Cannot set MetaDataItem key as ".concat(i));this.key=i,this.key=i}},{key:"getKey",value:function(){if(typeof this.key=="string")return this.key;throw new Ib("Cannot get MetaDataItem key")}},{key:"setValue",value:function(i){if(typeof i!="string"&&!Pd.isNull(null))throw new Ib("Cannot set MetaDataItem value as ".concat(i));this.value=i}},{key:"getValue",value:function(){if(typeof this.value=="string"||Pd.isNull(null))return this.value;throw new Ib("Cannot get MetaDataItem value")}},{key:"setRevision",value:function(i){if(typeof i!="number"||i%1!=0)throw new Ib("Cannot set MetaDataItem revision as ".concat(i));this.revision=i}},{key:"getRevision",value:function(){if(typeof this.revision=="number")return this.revision;throw new Ib("Cannot get MetaDataItem revision")}},{key:"getUpdateTs",value:function(){return this.updateTs}},{key:"getAuthorUserId",value:function(){return this.authorUserId}}]),h}(),Ge,bg;(function(h){h.STATE_REVISION_KEY_PREFIX="_rev_",h.STATE_TIMESTAMP_PREFIX="_t_",h.STATE_AUTHOR_PREFIX="_m_",h.STATE_REVISION="_rev",h.STATE_INTERNAL_PREFIX="_"})(Ge||(Ge={})),function(h){h[h.StateOk=0]="StateOk",h[h.DuplicatedOperation=1]="DuplicatedOperation",h[h.SyncServerError=2]="SyncServerError",h[h.ArgumentError=3]="ArgumentError",h[h.AuthicationError=4]="AuthicationError",h[h.ExceedLimitationError=5]="ExceedLimitationError",h[h.OutdateRevision=6]="OutdateRevision",h[h.LockAcquireFailed=7]="LockAcquireFailed",h[h.LockExpired=8]="LockExpired",h[h.LockWatching=9]="LockWatching",h[h.InvalidLock=10]="InvalidLock",h[h.TimeOutError=100]="TimeOutError",h[h.UnknownError=255]="UnknownError"}(bg||(bg={}));var OO=Math.max,PO=Math.min,Rz=function(h,i,g){return i=wq(i),g===void 0?(g=i,i=0):g=wq(g),(h=hl(h))>=PO(i,g)&&h<OO(i,g)},Wl=function(h){function i(_,j,$){return ab(this,i),E(L(j=g.call(this,j,"MessageReport")),"messagecount",j.getInitMessageCount()),E(L(j),"context",void 0),E(L(j),"rtmMessageCategory",void 0),E(L(j),"seq",D.fromNumber(1,!0)),j.context=_,j.rtmMessageCategory=$,j}nb(i,h);var g=ob(i);return Qb(i,[{key:"incGetSeq",value:function(){return this.seq=this.seq.add(1)}},{key:"getInitMessageCount",value:function(){return{peerack10mscount:D.fromNumber(0),peerack25mscount:D.fromNumber(0),peerack50mscount:D.fromNumber(0),peerack75mscount:D.fromNumber(0),peerack100mscount:D.fromNumber(0),peerack150mscount:D.fromNumber(0),peerack200mscount:D.fromNumber(0),peerack250mscount:D.fromNumber(0),peerack300mscount:D.fromNumber(0),peerack400mscount:D.fromNumber(0),peerack500mscount:D.fromNumber(0),peerack600mscount:D.fromNumber(0),peerack800mscount:D.fromNumber(0),peerack1000mscount:D.fromNumber(0),peerack2000mscount:D.fromNumber(0),peerack3000mscount:D.fromNumber(0),peerack5000mscount:D.fromNumber(0),peerack7000mscount:D.fromNumber(0),peerackslowcount:D.fromNumber(0),norecipientack10mscount:D.fromNumber(0),norecipientack25mscount:D.fromNumber(0),norecipientack50mscount:D.fromNumber(0),norecipientack75mscount:D.fromNumber(0),norecipientack100mscount:D.fromNumber(0),norecipientack150mscount:D.fromNumber(0),norecipientack200mscount:D.fromNumber(0),norecipientack250mscount:D.fromNumber(0),norecipientack300mscount:D.fromNumber(0),norecipientack400mscount:D.fromNumber(0),norecipientack500mscount:D.fromNumber(0),norecipientack600mscount:D.fromNumber(0),norecipientack800mscount:D.fromNumber(0),norecipientack1000mscount:D.fromNumber(0),norecipientack2000mscount:D.fromNumber(0),norecipientack3000mscount:D.fromNumber(0),norecipientack5000mscount:D.fromNumber(0),norecipientack7000mscount:D.fromNumber(0),norecipientackslowcount:D.fromNumber(0),sentcount:D.fromNumber(0),receivedcount:D.fromNumber(0),acktimeoutcount:D.fromNumber(0),toooftencount:0,receiverofflinecount:0,invalidmessagecount:0,unknowerrorcount:0,servercachedcount:0,timeoutcount:0,successcount:0}}},{key:"updatePeerAckCount",value:function(_){_/=2;for(var j=[[0,10],[10,25],[25,50],[50,75],[75,100],[100,150],[150,200],[200,250],[250,300],[300,400],[400,500],[500,600],[600,800],[800,1e3],[1e3,2e3],[2e3,3e3],[3e3,5e3],[5e3,7e3]],$=0;$<j.length;$++){var _n,_i=j[$];if(Rz(_,_i[0],_i[1]))_i="peerack".concat(_i[1],"mscount"),this.messagecount[_i]=(_n=this.messagecount[_i])===null||_n===void 0?void 0:_n.add(1);else if(7e3<_){var _s;this.messagecount.peerackslowcount=(_s=this.messagecount.peerackslowcount)===null||_s===void 0?void 0:_s.add(1)}}}},{key:"updateNorecipientackCount",value:function(_){_/=2;for(var j=[[0,10],[10,25],[25,50],[50,75],[75,100],[100,150],[150,200],[200,250],[250,300],[300,400],[400,500],[500,600],[600,800],[800,1e3],[1e3,2e3],[2e3,3e3],[3e3,5e3],[5e3,7e3]],$=0;$<j.length;$++){var _n,_i=j[$];if(Rz(_,_i[0],_i[1]))_i="norecipientack".concat(_i[1],"mscount"),this.messagecount[_i]=(_n=this.messagecount[_i])===null||_n===void 0?void 0:_n.add(1);else if(7e3<_){var _s;this.messagecount.norecipientackslowcount=(_s=this.messagecount.norecipientackslowcount)===null||_s===void 0?void 0:_s.add(1)}}}},{key:"updateCommonCount",value:function(_){var j=this.messagecount[_];D.isLong(j)?this.messagecount[_]=j.add(1):this.messagecount[_]=j+1}},{key:"report",value:function(){var _,j;$a("RtmSdkMessageCount",new Bx(tb(tb({},this.messagecount),{},{vid:D.fromString((_=this.context.vid)!==null&&_!==void 0?_:"0"),os:7,lts:D.fromNumber(Date.now()),sid:this.context.sid,reportsequence:this.incGetSeq(),apimajorversion:7,apiminorversion:228,userid:this.context.uid,messagecategory:this.rtmMessageCategory})),(j=this.context.config.enableCloudProxy)!==null&&j!==void 0&&j),this.messagecount=tb(tb({},this.messagecount),{},{toooftencount:0,receiverofflinecount:0,invalidmessagecount:0,unknowerrorcount:0,servercachedcount:0,timeoutcount:0,successcount:0})}}]),i}(Dd()),QO=function(h){function i(_){return ab(this,i),E(L(_=g.call(this,_,"ChatManager")),"dialogueLru",new kG(void 0,{maxlen:1e4,ttl:1e4})),_}nb(i,h);var g=ob(i);return Qb(i,[{key:"getChatInfo",value:function(_){var j=this.dialogueLru.get(_);if(this.dialogueLru.prune(),j){var $=j.dialogue,_n={dialogue:$,sequence:j=j.sequence.add(1)};return this.dialogueLru.set(_,{dialogue:$,sequence:j}),_n}return $={dialogue:Rj(),sequence:D.fromNumber(1,!0)},this.dialogueLru.set(_,$),$}}]),i}(Dd()),X={};Ia(module)=="object"&&(module.exports=X),X.parse=function(h,i){var g,_=X.bin.readUshort,j=X.bin.readUint,$={};for(g=(h=new Uint8Array(h)).length-4;j(h,g)!=101010256;)g--;var _n=_(h,g=g+4+4);_(h,g+=2),j(h,g+=2),g=j(h,g+=4);for(var _i=0;_i<_n;_i++){j(h,g),g+=4,g+=4,g+=4,j(h,g+=4);var _s=j(h,g+=4),ga=j(h,g+=4),ba=_(h,g+=4),xa=_(h,g+2),El=_(h,g+4);g+=6;var Tl=j(h,g+=8);g+=4,g+=ba+xa+El,X._readLocal(h,Tl,$,_s,ga,i)}return $},X._readLocal=function(h,i,g,_,j,$){var _n=X.bin.readUshort,_i=X.bin.readUint;_i(h,i),_n(h,i+=4),_n(h,i+=2);var _s=_n(h,i+=2);_i(h,i+=2),_i(h,i+=4),_i=_n(h,i=i+4+8);var ga=_n(h,i+=2);if(i+=2,_n=X.bin.readUTF8(h,i,_i),i=i+_i+ga,$)g[_n]={size:j,csize:_};else if(h=new Uint8Array(h.buffer,i),_s==0)g[_n]=new Uint8Array(h.buffer.slice(i,i+_));else{if(_s!=8)throw"unknown compression method: "+_s;i=new Uint8Array(j),X.inflateRaw(h,i),g[_n]=i}},X.inflateRaw=function(h,i){return X.F.inflate(h,i)},X.inflate=function(h,i){return h[0],h[1],X.inflateRaw(new Uint8Array(h.buffer,h.byteOffset+2,h.length-2),i)},X.deflate=function(h,i){i==null&&(i={level:6});var g=0,_=new Uint8Array(50+Math.floor(1.1*h.length));return _[g]=120,_[g+1]=156,g=X.F.deflateRaw(h,_,g+2,i.level),h=X.adler(h,0,h.length),_[g+0]=h>>>24&255,_[g+1]=h>>>16&255,_[g+2]=h>>>8&255,_[g+3]=h>>>0&255,new Uint8Array(_.buffer,0,g+4)},X.deflateRaw=function(h,i){i==null&&(i={level:6});var g=new Uint8Array(50+Math.floor(1.1*h.length)),_=X.F.deflateRaw(h,g,_,i.level);return new Uint8Array(g.buffer,0,_)},X.encode=function(h,i){i==null&&(i=!1);var g,_=0,j=X.bin.writeUint,$=X.bin.writeUshort,_n={};for(g in h){var _i=!X._noNeed(g)&&!i,_s=h[g],ga=X.crc.crc(_s,0,_s.length);_n[g]={cpr:_i,usize:_s.length,crc:ga,file:_i?X.deflateRaw(_s):_s}}for(g in _n)_+=_n[g].file.length+30+46+2*X.bin.sizeUTF8(g);for(g in h=new Uint8Array(_+22),i=0,_s=[],_n)ga=_n[g],_s.push(i),i=X._writeHeader(h,i,g,ga,0);for(g in _=0,_i=i,_n)ga=_n[g],_s.push(i),i=X._writeHeader(h,i,g,ga,1,_s[_++]);return _n=i-_i,j(h,i,101010256),$(h,i=i+4+4,_),$(h,i+=2,_),j(h,i+=2,_n),j(h,i+4,_i),h.buffer},X._noNeed=function(h){return h=h.split(".").pop().toLowerCase(),"png,jpg,jpeg,zip".indexOf(h)!=-1},X._writeHeader=function(h,i,g,_,j,$){var _n=X.bin.writeUint,_i=X.bin.writeUshort,_s=_.file;return _n(h,i,j==0?67324752:33639248),i+=4,j==1&&(i+=2),_i(h,i,20),_i(h,i+=2,0),_i(h,i+=2,_.cpr?8:0),_n(h,i+=2,0),_n(h,i+=4,_.crc),_n(h,i+=4,_s.length),_n(h,i+=4,_.usize),_i(h,i+=4,X.bin.sizeUTF8(g)),_i(h,i+=2,0),i+=2,j==1&&(_n(h,i=i+2+2+6,$),i+=4),i+=g=X.bin.writeUTF8(h,i,g),j==0&&(h.set(_s,i),i+=_s.length),i},X.crc={table:function(){for(var h=new Uint32Array(256),i=0;256>i;i++){for(var g=i,_=0;8>_;_++)g=1&g?3988292384^g>>>1:g>>>1;h[i]=g}return h}(),update:function(h,i,g,_){for(var j=0;j<_;j++)h=X.crc.table[255&(h^i[g+j])]^h>>>8;return h},crc:function(h,i,g){return 4294967295^X.crc.update(4294967295,h,i,g)}},X.adler=function(h,i,g){var _=1,j=0,$=i;for(i+=g;$<i;){for(g=Math.min($+5552,i);$<g;)j+=_+=h[$++];_%=65521,j%=65521}return j<<16|_},X.bin={readUshort:function(h,i){return h[i]|h[i+1]<<8},writeUshort:function(h,i,g){h[i]=255&g,h[i+1]=g>>8&255},readUint:function(h,i){return 16777216*h[i+3]+(h[i+2]<<16|h[i+1]<<8|h[i])},writeUint:function(h,i,g){h[i]=255&g,h[i+1]=g>>8&255,h[i+2]=g>>16&255,h[i+3]=g>>24&255},readASCII:function(h,i,g){for(var _="",j=0;j<g;j++)_+=String.fromCharCode(h[i+j]);return _},writeASCII:function(h,i,g){for(var _=0;_<g.length;_++)h[i+_]=g.charCodeAt(_)},pad:function(h){return 2>h.length?"0"+h:h},readUTF8:function(h,i,g){for(var _,j="",$=0;$<g;$++)j+="%"+X.bin.pad(h[i+$].toString(16));try{_=decodeURIComponent(j)}catch{return X.bin.readASCII(h,i,g)}return _},writeUTF8:function(h,i,g){for(var _=g.length,j=0,$=0;$<_;$++){var _n=g.charCodeAt($);if(!(4294967168&_n))h[i+j]=_n,j++;else if(!(4294965248&_n))h[i+j]=192|_n>>6,h[i+j+1]=128|_n>>0&63,j+=2;else if(!(4294901760&_n))h[i+j]=224|_n>>12,h[i+j+1]=128|_n>>6&63,h[i+j+2]=128|_n>>0&63,j+=3;else{if(4292870144&_n)throw"e";h[i+j]=240|_n>>18,h[i+j+1]=128|_n>>12&63,h[i+j+2]=128|_n>>6&63,h[i+j+3]=128|_n>>0&63,j+=4}}return j},sizeUTF8:function(h){for(var i=h.length,g=0,_=0;_<i;_++){var j=h.charCodeAt(_);if(!(4294967168&j))g++;else if(!(4294965248&j))g+=2;else if(!(4294901760&j))g+=3;else{if(4292870144&j)throw"e";g+=4}}return g}},X.F={},X.F.deflateRaw=function(h,i,g,_){var j=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]][_],$=X.F.U,_n=X.F._goodIndex;X.F._hash;var _i=X.F._putsE,_s=0;g<<=3;var ga=0,ba=h.length;if(_==0){for(;_s<ba;){var xa=Math.min(65535,ba-_s);_i(i,g,_s+xa==ba?1:0),g=X.F._copyExact(h,_s,xa,i,g+8),_s+=xa}return g>>>3}_i=$.lits,_=$.strt;var El=$.prev,Tl=0,Sl=0,Il=0,Cl=0,Nl=0;for(2<ba&&(_[Nl=X.F._hash(h,0)]=0),_s=0;_s<ba;_s++){if(xa=Nl,_s+1<ba-2){Nl=X.F._hash(h,_s+1);var Dl=_s+1&32767;El[Dl]=_[Nl],_[Nl]=Dl}if(ga<=_s){if((14e3<Tl||26697<Sl)&&100<ba-_s&&(ga<_s&&(_i[Tl]=_s-ga,Tl+=2,ga=_s),g=X.F._writeBlock(_s==ba-1||ga==ba?1:0,_i,Tl,Cl,h,Il,_s-Il,i,g),Tl=Sl=Cl=0,Il=_s),Dl=0,_s<ba-2&&(Dl=X.F._bestMatch(h,_s,El,xa,Math.min(j[2],ba-_s),j[3])),Dl!=0){xa=Dl>>>16,Dl&=65535;var Ul=_n(xa,$.of0);$.lhst[257+Ul]++;var Kl=_n(Dl,$.df0);$.dhst[Kl]++,Cl+=$.exb[Ul]+$.dxb[Kl],_i[Tl]=xa<<23|_s-ga,_i[Tl+1]=Dl<<16|Ul<<8|Kl,Tl+=2,ga=_s+xa}else $.lhst[h[_s]]++;Sl++}}for(Il==_s&&h.length!=0||(ga<_s&&(_i[Tl]=_s-ga,Tl+=2),g=X.F._writeBlock(1,_i,Tl,Cl,h,Il,_s-Il,i,g));7&g;)g++;return g>>>3},X.F._bestMatch=function(h,i,g,_,j,$){var _n=32767&i,_i=g[_n],_s=_n-_i+32768&32767;if(_i==_n||_!=X.F._hash(h,i-_s))return 0;for(var ga=_=0,ba=Math.min(32767,i);_s<=ba&&--$!=0&&_i!=_n;){if((_==0||h[i+_]==h[i+_-_s])&&(_n=X.F._howLong(h,i,_s))>_){if(ga=_s,(_=_n)>=j)break;_s+2<_n&&(_n=_s+2);for(var xa=0,El=0;El<_n-2;El++){var Tl=i-_s+El+32768&32767,Sl=Tl-g[Tl]+32768&32767;Sl>xa&&(xa=Sl,_i=Tl)}}_s+=(_n=_i)-(_i=g[_n])+32768&32767}return _<<16|ga},X.F._howLong=function(h,i,g){if(h[i]!=h[i-g]||h[i+1]!=h[i+1-g]||h[i+2]!=h[i+2-g])return 0;var _=i,j=Math.min(h.length,i+258);for(i+=3;i<j&&h[i]==h[i-g];)i++;return i-_},X.F._hash=function(h,i){return(h[i]<<8|h[i+1])+(h[i+2]<<4)&65535},X.saved=0,X.F._writeBlock=function(h,i,g,_,j,$,_n,_i,_s){var ga=X.F.U,ba=X.F._putsF,xa=X.F._putsE;ga.lhst[256]++;var El=X.F.getTrees(),Tl=El[0],Sl=El[1],Il=El[2],Cl=El[3],Nl=El[4],Dl=El[5],Ul=El[6];El=El[7];var Kl=32+(_s+3&7?8-(_s+3&7):0)+(_n<<3),Jl=_+X.F.contSize(ga.fltree,ga.lhst)+X.F.contSize(ga.fdtree,ga.dhst);_=_+X.F.contSize(ga.ltree,ga.lhst)+X.F.contSize(ga.dtree,ga.dhst),_+=14+3*Dl+X.F.contSize(ga.itree,ga.ihst)+(2*ga.ihst[16]+3*ga.ihst[17]+7*ga.ihst[18]);for(var Ep=0;286>Ep;Ep++)ga.lhst[Ep]=0;for(Ep=0;30>Ep;Ep++)ga.dhst[Ep]=0;for(Ep=0;19>Ep;Ep++)ga.ihst[Ep]=0;if(Kl=Kl<Jl&&Kl<_?0:Jl<_?1:2,ba(_i,_s,h),ba(_i,_s+1,Kl),_s+=3,Kl==0){for(;7&_s;)_s++;_s=X.F._copyExact(j,$,_n,_i,_s)}else{if(Kl==1)var _p=ga.fltree,Ip=ga.fdtree;if(Kl==2){for(X.F.makeCodes(ga.ltree,Tl),X.F.revCodes(ga.ltree,Tl),X.F.makeCodes(ga.dtree,Sl),X.F.revCodes(ga.dtree,Sl),X.F.makeCodes(ga.itree,Il),X.F.revCodes(ga.itree,Il),_p=ga.ltree,Ip=ga.dtree,xa(_i,_s,Cl-257),xa(_i,_s+=5,Nl-1),xa(_i,_s+=5,Dl-4),_s+=4,h=0;h<Dl;h++)xa(_i,_s+3*h,ga.itree[1+(ga.ordr[h]<<1)]);_s=X.F._codeTiny(Ul,ga.itree,_i,_s+3*Dl),_s=X.F._codeTiny(El,ga.itree,_i,_s)}for(Dl=0;Dl<g;Dl+=2){for(Ul=(h=i[Dl])>>>23,h=$+(8388607&h);$<h;)_s=X.F._writeLit(j[$++],_p,_i,_s);Ul!=0&&(h=(Tl=i[Dl+1])>>16,_n=Tl>>8&255,Tl&=255,xa(_i,_s=X.F._writeLit(257+_n,_p,_i,_s),Ul-ga.of0[_n]),_s+=ga.exb[_n],ba(_i,_s=X.F._writeLit(Tl,Ip,_i,_s),h-ga.df0[Tl]),_s+=ga.dxb[Tl],$+=Ul)}_s=X.F._writeLit(256,_p,_i,_s)}return _s},X.F._copyExact=function(h,i,g,_,j){var $=j>>>3;return _[$]=g,_[$+1]=g>>>8,_[$+2]=255-_[$],_[$+3]=255-_[$+1],$+=4,_.set(new Uint8Array(h.buffer,i,g),$),j+(g+4<<3)},X.F.getTrees=function(){for(var h=X.F.U,i=X.F._hufTree(h.lhst,h.ltree,15),g=X.F._hufTree(h.dhst,h.dtree,15),_=[],j=X.F._lenCodes(h.ltree,_),$=[],_n=X.F._lenCodes(h.dtree,$),_i=0;_i<_.length;_i+=2)h.ihst[_[_i]]++;for(_i=0;_i<$.length;_i+=2)h.ihst[$[_i]]++;_i=X.F._hufTree(h.ihst,h.itree,7);for(var _s=19;4<_s&&h.itree[1+(h.ordr[_s-1]<<1)]==0;)_s--;return[i,g,_i,j,_n,_s,_,$]},X.F.getSecond=function(h){for(var i=[],g=0;g<h.length;g+=2)i.push(h[g+1]);return i},X.F.nonZero=function(h){for(var i="",g=0;g<h.length;g+=2)h[g+1]!=0&&(i+=(g>>1)+",");return i},X.F.contSize=function(h,i){for(var g=0,_=0;_<i.length;_++)g+=i[_]*h[1+(_<<1)];return g},X.F._codeTiny=function(h,i,g,_){for(var j=0;j<h.length;j+=2){var $=h[j],_n=h[j+1];_=X.F._writeLit($,i,g,_);var _i=$==16?2:$==17?3:7;15<$&&(X.F._putsE(g,_,_n,_i),_+=_i)}return _},X.F._lenCodes=function(h,i){for(var g=h.length;g!=2&&h[g-1]==0;)g-=2;for(var _=0;_<g;_+=2){var j=h[_+1],$=_+3<g?h[_+3]:-1,_n=_+5<g?h[_+5]:-1,_i=_==0?-1:h[_-1];if(j==0&&$==j&&_n==j){for($=_+5;$+2<g&&h[$+2]==j;)$+=2;11>(j=Math.min($+1-_>>>1,138))?i.push(17,j-3):i.push(18,j-11),_+=2*j-2}else if(j==_i&&$==j&&_n==j){for($=_+5;$+2<g&&h[$+2]==j;)$+=2;j=Math.min($+1-_>>>1,6),i.push(16,j-3),_+=2*j-2}else i.push(j,0)}return g>>>1},X.F._hufTree=function(h,i,g){var _=[],j=h.length,$=i.length,_n=0;for(_n=0;_n<$;_n+=2)i[_n]=0,i[_n+1]=0;for(_n=0;_n<j;_n++)h[_n]!=0&&_.push({lit:_n,f:h[_n]});if(h=_.length,j=_.slice(0),h==0)return 0;if(h==1)return i[1+((g=_[0].lit)<<1)]=1,i[1+((g==0?1:0)<<1)]=1;_.sort(function(ba,xa){return ba.f-xa.f}),_n=_[0],$=_[1];var _i=0,_s=1,ga=2;for(_[0]={lit:-1,f:_n.f+$.f,l:_n,r:$,d:0};_s!=h-1;)_n=_i!=_s&&(ga==h||_[_i].f<_[ga].f)?_[_i++]:_[ga++],$=_i!=_s&&(ga==h||_[_i].f<_[ga].f)?_[_i++]:_[ga++],_[_s++]={lit:-1,f:_n.f+$.f,l:_n,r:$};for((_=X.F.setDepth(_[_s-1],0))>g&&(X.F.restrictDepth(j,g,_),_=g),_n=0;_n<h;_n++)i[1+(j[_n].lit<<1)]=j[_n].d;return _},X.F.setDepth=function(h,i){return h.lit!=-1?h.d=i:Math.max(X.F.setDepth(h.l,i+1),X.F.setDepth(h.r,i+1))},X.F.restrictDepth=function(h,i,g){var _=0,j=1<<g-i,$=0;for(h.sort(function(_i,_s){return _s.d==_i.d?_i.f-_s.f:_s.d-_i.d}),_=0;_<h.length&&h[_].d>i;_++){var _n=h[_].d;h[_].d=i,$+=j-(1<<g-_n)}for($>>>=g-i;0<$;)(_n=h[_].d)<i?(h[_].d++,$-=1<<i-_n-1):_++;for(;0<=_;_--)h[_].d==i&&0>$&&(h[_].d--,$++);$!=0&&console.log("debt left")},X.F._goodIndex=function(h,i){var g=0;return i[16|g]<=h&&(g|=16),i[8|g]<=h&&(g|=8),i[4|g]<=h&&(g|=4),i[2|g]<=h&&(g|=2),i[1|g]<=h&&(g|=1),g},X.F._writeLit=function(h,i,g,_){return X.F._putsF(g,_,i[h<<1]),_+i[1+(h<<1)]},X.F.inflate=function(h,i){var g=Uint8Array;if(h[0]==3&&h[1]==0)return i||new g(0);var _=X.F,j=_._bitsF,$=_._bitsE,_n=_._decodeTiny,_i=_.makeCodes,_s=_.codes2map,ga=_._get17,ba=_.U,xa=i==null;xa&&(i=new g(h.length>>>2<<3));for(var El,Tl,Sl,Il,Cl=0,Nl=0,Dl=Tl=0,Ul=0;Cl==0;)if(Cl=j(h,Ul,1),El=j(h,Ul+1,2),Ul+=3,El==0)7&Ul&&(Ul+=8-(7&Ul)),El=h[(Ul=4+(Ul>>>3))-4]|h[Ul-3]<<8,xa&&(i=X.F._check(i,Dl+El)),i.set(new g(h.buffer,h.byteOffset+Ul,El),Dl),Ul=Ul+El<<3,Dl+=El;else{if(xa&&(i=X.F._check(i,Dl+131072)),El==1&&(Sl=ba.flmap,Il=ba.fdmap,Nl=511,Tl=31),El==2){for(Tl=$(h,Ul,5)+257,El=$(h,Ul+5,5)+1,Sl=$(h,Ul+10,4)+4,Ul+=14,Il=0;38>Il;Il+=2)ba.itree[Il]=0,ba.itree[Il+1]=0;for(Nl=1,Il=0;Il<Sl;Il++){var Kl=$(h,Ul+3*Il,3);ba.itree[1+(ba.ordr[Il]<<1)]=Kl,Kl>Nl&&(Nl=Kl)}Ul+=3*Sl,_i(ba.itree,Nl),_s(ba.itree,Nl,ba.imap),Sl=ba.lmap,Il=ba.dmap,Ul=_n(ba.imap,(1<<Nl)-1,Tl+El,h,Ul,ba.ttree),Nl=(1<<(Kl=_._copyOut(ba.ttree,0,Tl,ba.ltree)))-1,Tl=(1<<(El=_._copyOut(ba.ttree,Tl,El,ba.dtree)))-1,_i(ba.ltree,Kl),_s(ba.ltree,Kl,Sl),_i(ba.dtree,El),_s(ba.dtree,El,Il)}for(;;)if(Ul+=15&(El=Sl[ga(h,Ul)&Nl]),(Kl=El>>>4)>>>8==0)i[Dl++]=Kl;else{if(Kl==256)break;El=Dl+Kl-254,264<Kl&&(El=Dl+((Kl=ba.ldef[Kl-257])>>>3)+$(h,Ul,7&Kl),Ul+=7&Kl),Ul+=15&(Kl=Il[ga(h,Ul)&Tl]);var Jl=((Kl=ba.ddef[Kl>>>4])>>>4)+j(h,Ul,15&Kl);for(Ul+=15&Kl,xa&&(i=X.F._check(i,Dl+131072));Dl<El;)i[Dl]=i[Dl++-Jl],i[Dl]=i[Dl++-Jl],i[Dl]=i[Dl++-Jl],i[Dl]=i[Dl++-Jl];Dl=El}}return i.length==Dl?i:i.slice(0,Dl)},X.F._check=function(h,i){var g=h.length;return i<=g?h:((i=new Uint8Array(Math.max(g<<1,i))).set(h,0),i)},X.F._decodeTiny=function(h,i,g,_,j,$){for(var _n=X.F._bitsE,_i=X.F._get17,_s=0;_s<g;){var ga=h[_i(_,j)&i];j+=15&ga;var ba=ga>>>4;if(15>=ba)$[_s]=ba,_s++;else{var xa=ga=0;for(ba==16?(xa=3+_n(_,j,2),j+=2,ga=$[_s-1]):ba==17?(xa=3+_n(_,j,3),j+=3):ba==18&&(xa=11+_n(_,j,7),j+=7),ba=_s+xa;_s<ba;)$[_s]=ga,_s++}}return j},X.F._copyOut=function(h,i,g,_){for(var j=0,$=0,_n=_.length>>>1;$<g;){var _i=h[$+i];_[$<<1]=0,_[1+($<<1)]=_i,_i>j&&(j=_i),$++}for(;$<_n;)_[$<<1]=0,_[1+($<<1)]=0,$++;return j},X.F.makeCodes=function(h,i){var g,_,j=X.F.U,$=h.length,_n=j.bl_count;for(g=0;g<=i;g++)_n[g]=0;for(g=1;g<$;g+=2)_n[h[g]]++;for(j=j.next_code,g=0,_n[0]=0,_=1;_<=i;_++)g=g+_n[_-1]<<1,j[_]=g;for(i=0;i<$;i+=2)(_n=h[i+1])!=0&&(h[i]=j[_n],j[_n]++)},X.F.codes2map=function(h,i,g){for(var _=h.length,j=X.F.U.rev15,$=0;$<_;$+=2)if(h[$+1]!=0){var _n=h[$+1],_i=$>>1<<4|_n,_s=i-_n;for(_s=(_n=h[$]<<_s)+(1<<_s);_n!=_s;)g[j[_n]>>>15-i]=_i,_n++}},X.F.revCodes=function(h,i){for(var g=X.F.U.rev15,_=15-i,j=0;j<h.length;j+=2)h[j]=g[h[j]<<i-h[j+1]]>>>_},X.F._putsE=function(h,i,g){g<<=7&i,h[i>>>=3]|=g,h[i+1]|=g>>>8},X.F._putsF=function(h,i,g){g<<=7&i,h[i>>>=3]|=g,h[i+1]|=g>>>8,h[i+2]|=g>>>16},X.F._bitsE=function(h,i,g){return(h[i>>>3]|h[1+(i>>>3)]<<8)>>>(7&i)&(1<<g)-1},X.F._bitsF=function(h,i,g){return(h[i>>>3]|h[1+(i>>>3)]<<8|h[2+(i>>>3)]<<16)>>>(7&i)&(1<<g)-1},X.F._get17=function(h,i){return(h[i>>>3]|h[1+(i>>>3)]<<8|h[2+(i>>>3)]<<16)>>>(7&i)},X.F._get25=function(h,i){return(h[i>>>3]|h[1+(i>>>3)]<<8|h[2+(i>>>3)]<<16|h[3+(i>>>3)]<<24)>>>(7&i)},X.F.U=function(){var h=Uint16Array,i=Uint32Array;return{next_code:new h(16),bl_count:new h(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new h(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new i(32),flmap:new h(512),fltree:[],fdmap:new h(32),fdtree:[],lmap:new h(32768),ltree:[],ttree:[],dmap:new h(32768),dtree:[],imap:new h(512),itree:[],rev15:new h(32768),lhst:new i(286),dhst:new i(30),ihst:new i(19),lits:new i(15e3),strt:new h(65536),prev:new h(32768)}}(),function(){function h(j,$,_n){for(;$--!=0;)j.push(0,_n)}for(var i=X.F.U,g=0;32768>g;g++){var _=g;_=(4278255360&(_=(4042322160&(_=(3435973836&(_=(2863311530&_)>>>1|(1431655765&_)<<1))>>>2|(858993459&_)<<2))>>>4|(252645135&_)<<4))>>>8|(16711935&_)<<8,i.rev15[g]=(_>>>16|_<<16)>>>17}for(g=0;32>g;g++)i.ldef[g]=i.of0[g]<<3|i.exb[g],i.ddef[g]=i.df0[g]<<4|i.dxb[g];h(i.fltree,144,8),h(i.fltree,112,9),h(i.fltree,24,7),h(i.fltree,8,8),X.F.makeCodes(i.fltree,9),X.F.codes2map(i.fltree,9,i.flmap),X.F.revCodes(i.fltree,9),h(i.fdtree,32,5),X.F.makeCodes(i.fdtree,5),X.F.codes2map(i.fdtree,5,i.fdmap),X.F.revCodes(i.fdtree,5),h(i.itree,19,0),h(i.ltree,286,0),h(i.dtree,30,0),h(i.ttree,320,0)}();var RO=Array.isArray||function(h){return h&&typeof h.length=="number"},SO=Object.defineProperty({isArray:RO},"__esModule",{value:!0}),TO=Object.defineProperty({isObject:function(h){return h!==null&&Ia(h)==="object"}},"__esModule",{value:!0}),UO=Object.defineProperty({isFunction:function(h){return typeof h=="function"}},"__esModule",{value:!0}),VO=function(){function h(i){return Error.call(this),this.message=i?i.length+` errors occurred during unsubscription:
`+i.map(function(g,_){return _+1+") "+g.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=i,this}return h.prototype=Object.create(Error.prototype),h}(),bk=Object.defineProperty({UnsubscriptionError:VO},"__esModule",{value:!0}),WO=function(){function h(g){this.closed=!1,this._subscriptions=this._parentOrParents=null,g&&(this._ctorUnsubscribe=!0,this._unsubscribe=g)}var i;return h.prototype.unsubscribe=function(){if(!this.closed){var g=this._parentOrParents,_=this._ctorUnsubscribe,j=this._unsubscribe,$=this._subscriptions;if(this.closed=!0,this._subscriptions=this._parentOrParents=null,g instanceof h)g.remove(this);else if(g!==null)for(var _n=0;_n<g.length;++_n)g[_n].remove(this);if(UO.isFunction(j)){_&&(this._unsubscribe=void 0);try{j.call(this)}catch(_s){var _i=_s instanceof bk.UnsubscriptionError?Gs(_s.errors):[_s]}}if(SO.isArray($)){for(_n=-1,g=$.length;++_n<g;)if(_=$[_n],TO.isObject(_))try{_.unsubscribe()}catch(_s){_i=_i||[],_s instanceof bk.UnsubscriptionError?_i=_i.concat(Gs(_s.errors)):_i.push(_s)}}if(_i)throw new bk.UnsubscriptionError(_i)}},h.prototype.add=function(g){var _=g;if(!g)return h.EMPTY;switch(Ia(g)){case"function":_=new h(g);case"object":if(_===this||_.closed||typeof _.unsubscribe!="function")return _;if(this.closed)return _.unsubscribe(),_;_ instanceof h||(g=_,(_=new h)._subscriptions=[g]);break;default:throw Error("unrecognized teardown "+g+" added to Subscription.")}if((g=_._parentOrParents)===null)_._parentOrParents=this;else if(g instanceof h){if(g===this)return _;_._parentOrParents=[g,this]}else{if(g.indexOf(this)!==-1)return _;g.push(this)}return(g=this._subscriptions)===null?this._subscriptions=[_]:g.push(_),_},h.prototype.remove=function(g){var _=this._subscriptions;_&&(g=_.indexOf(g))!==-1&&_.splice(g,1)},h.EMPTY=((i=new h).closed=!0,i),h}(),XO=Object.defineProperty({Subscription:WO},"__esModule",{value:!0}),YO=qb&&qb.__extends||function(){var h=function(i,g){return(h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(_,j){_.__proto__=j}||function(_,j){for(var $ in j)j.hasOwnProperty($)&&(_[$]=j[$])})(i,g)};return function(i,g){function _(){this.constructor=i}h(i,g),i.prototype=g===null?Object.create(g):(_.prototype=g.prototype,new _)}}(),ZO=function(h){function i(g,_){return h.call(this)||this}return YO(i,h),i.prototype.schedule=function(g,_){return this},i}(XO.Subscription),$O=Object.defineProperty({Action:ZO},"__esModule",{value:!0}),aP=qb&&qb.__extends||function(){var h=function(i,g){return(h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(_,j){_.__proto__=j}||function(_,j){for(var $ in j)j.hasOwnProperty($)&&(_[$]=j[$])})(i,g)};return function(i,g){function _(){this.constructor=i}h(i,g),i.prototype=g===null?Object.create(g):(_.prototype=g.prototype,new _)}}(),Sz=function(h){function i(g,_){var j=h.call(this,g,_)||this;return j.scheduler=g,j.work=_,j.pending=!1,j}return aP(i,h),i.prototype.schedule=function(g,_){if(_===void 0&&(_=0),this.closed)return this;this.state=g,g=this.id;var j=this.scheduler;return g!=null&&(this.id=this.recycleAsyncId(j,g,_)),this.pending=!0,this.delay=_,this.id=this.id||this.requestAsyncId(j,this.id,_),this},i.prototype.requestAsyncId=function(g,_,j){return j===void 0&&(j=0),setInterval(g.flush.bind(g,this),j)},i.prototype.recycleAsyncId=function(g,_,j){if(j===void 0&&(j=0),j!==null&&this.delay===j&&this.pending===!1)return _;clearInterval(_)},i.prototype.execute=function(g,_){return this.closed?Error("executing a cancelled action"):(this.pending=!1,(g=this._execute(g,_))?g:void(this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))))},i.prototype._execute=function(g,_){_=!1;var j=void 0;try{this.work(g)}catch($){_=!0,j=!!$&&$||Error($)}if(_)return this.unsubscribe(),j},i.prototype._unsubscribe=function(){var g=this.id,_=this.scheduler,j=_.actions,$=j.indexOf(this);this.state=this.work=null,this.pending=!1,this.scheduler=null,$!==-1&&j.splice($,1),g!=null&&(this.id=this.recycleAsyncId(_,g,null)),this.delay=null},i}($O.Action),bP=function(){function h(i,g){g===void 0&&(g=h.now),this.SchedulerAction=i,this.now=g}return h.prototype.schedule=function(i,g,_){return g===void 0&&(g=0),new this.SchedulerAction(this,i).schedule(_,g)},h.now=function(){return Date.now()},h}(),Tz=Object.defineProperty({Scheduler:bP},"__esModule",{value:!0}),cP=qb&&qb.__extends||function(){var h=function(i,g){return(h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(_,j){_.__proto__=j}||function(_,j){for(var $ in j)j.hasOwnProperty($)&&(_[$]=j[$])})(i,g)};return function(i,g){function _(){this.constructor=i}h(i,g),i.prototype=g===null?Object.create(g):(_.prototype=g.prototype,new _)}}(),Uz=function(h){function i(g,_){_===void 0&&(_=Tz.Scheduler.now);var j=h.call(this,g,function(){return i.delegate&&i.delegate!==j?i.delegate.now():_()})||this;return j.actions=[],j.active=!1,j.scheduled=void 0,j}return cP(i,h),i.prototype.schedule=function(g,_,j){return _===void 0&&(_=0),i.delegate&&i.delegate!==this?i.delegate.schedule(g,_,j):h.prototype.schedule.call(this,g,_,j)},i.prototype.flush=function(g){var _=this.actions;if(this.active)_.push(g);else{var j;this.active=!0;do if(j=g.execute(g.state,g.delay))break;while(g=_.shift());if(this.active=!1,j){for(;g=_.shift();)g.unsubscribe();throw j}}},i}(Tz.Scheduler),dP=mb("iterator"),xq=!Ga(function(){var h=new URL("b?a=1&b=2&c=3","http://a"),i=h.searchParams,g="";return h.pathname="c%20d",i.forEach(function(_,j){i.delete("b"),g+=j+_}),!i.sort||h.href!=="http://a/c%20d?a=1&c=3"||i.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!i[dP]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("http://тест").host!=="xn--e1aybc"||new URL("http://a#б").hash!=="#%D0%B1"||g!=="a1c3"||new URL("http://x",void 0).host!=="x"}),eP=/[^\0-\u007E]/,fP=/[.\u3002\uFF0E\uFF61]/g,Zh=Math.floor,yq=String.fromCharCode,Vz=function(h){var i=Gi(h);if(typeof i!="function")throw TypeError(String(h)+" is not iterable");return ub(i.call(h))},Wz=me("fetch"),zq=me("Headers"),gP=mb("iterator"),Xz=Sb.set,od=Sb.getterFor("URLSearchParams"),hP=Sb.getterFor("URLSearchParamsIterator"),iP=/\+/g,Yz=Array(4),jP=function(h){try{return decodeURIComponent(h)}catch{return h}},Zz=function(h){var i=h.replace(iP," ");h=4;try{return decodeURIComponent(i)}catch{for(;h;){var g=i.replace,_=h--;_=Yz[_-1]||(Yz[_-1]=RegExp("((?:%[\\da-f]{2}){"+_+"})","gi")),i=g.call(i,_,jP)}return i}},$z=/[!'()~]|%20/g,kP={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},aA=function(h){return kP[h]},bA=function(h,i){if(i){i=i.split("&");for(var g,_=0;_<i.length;)(g=i[_++]).length&&(g=g.split("="),h.push({key:Zz(g.shift()),value:Zz(g.join("="))}))}},lP=function(h){this.entries.length=0,bA(this.entries,h)},$h=function(h,i){if(h<i)throw TypeError("Not enough arguments")},Aq=yt(function(h,i){Xz(this,{type:"URLSearchParamsIterator",iterator:Vz(od(h).entries),kind:i})},"Iterator",function(){var h=hP(this),i=h.kind,g=(h=h.iterator.next()).value;return h.done||(h.value=i==="keys"?g.key:i==="values"?g.value:[g.key,g.value]),h}),xj=function(){Ud(this,xj,"URLSearchParams");var h,i,g,_=0<arguments.length?arguments[0]:void 0,j=[];if(Xz(this,{type:"URLSearchParams",entries:j,updateURL:function(){},updateSearchParams:lP}),_!==void 0)if(fb(_)){var $=Gi(_);if(typeof $=="function")for(_=$.call(_),$=_.next;!(h=$.call(_)).done;){var _n=(h=Vz(ub(h.value))).next;if((i=_n.call(h)).done||(g=_n.call(h)).done||!_n.call(h).done)throw TypeError("Expected sequence with length 2");j.push({key:i.value+"",value:g.value+""})}else for(h in _)Fa(_,h)&&j.push({key:h,value:_[h]+""})}else bA(j,typeof _=="string"?_.charAt(0)==="?"?_.slice(1):_:_+"")},Xl=xj.prototype;qh(Xl,{append:function(h,i){$h(arguments.length,2);var g=od(this);g.entries.push({key:h+"",value:i+""}),g.updateURL()},delete:function(h){$h(arguments.length,1);for(var i=od(this),g=i.entries,_=h+"",j=0;j<g.length;)g[j].key===_?g.splice(j,1):j++;i.updateURL()},get:function(h){$h(arguments.length,1);for(var i=od(this).entries,g=h+"",_=0;_<i.length;_++)if(i[_].key===g)return i[_].value;return null},getAll:function(h){$h(arguments.length,1);for(var i=od(this).entries,g=h+"",_=[],j=0;j<i.length;j++)i[j].key===g&&_.push(i[j].value);return _},has:function(h){$h(arguments.length,1);for(var i=od(this).entries,g=h+"",_=0;_<i.length;)if(i[_++].key===g)return!0;return!1},set:function(h,i){$h(arguments.length,1);for(var g,_=od(this),j=_.entries,$=!1,_n=h+"",_i=i+"",_s=0;_s<j.length;_s++)(g=j[_s]).key===_n&&($?j.splice(_s--,1):($=!0,g.value=_i));$||j.push({key:_n,value:_i}),_.updateURL()},sort:function(){var h,i,g=od(this),_=g.entries,j=_.slice();for(i=_.length=0;i<j.length;i++){var $=j[i];for(h=0;h<i;h++)if(_[h].key>$.key){_.splice(h,0,$);break}h===i&&_.push($)}g.updateURL()},forEach:function(h){for(var i,g=od(this).entries,_=tf(h,1<arguments.length?arguments[1]:void 0,3),j=0;j<g.length;)_((i=g[j++]).value,i.key,this)},keys:function(){return new Aq(this,"keys")},values:function(){return new Aq(this,"values")},entries:function(){return new Aq(this,"entries")}},{enumerable:!0}),Ob(Xl,gP,Xl.entries),Ob(Xl,"toString",function(){for(var h,i=od(this).entries,g=[],_=0;_<i.length;)h=i[_++],g.push(encodeURIComponent(h.key).replace($z,aA)+"="+encodeURIComponent(h.value).replace($z,aA));return g.join("&")},{enumerable:!0}),Td(xj,"URLSearchParams"),wa({global:!0,forced:!xq},{URLSearchParams:xj}),xq||typeof Wz!="function"||typeof zq!="function"||wa({global:!0,enumerable:!0,forced:!0},{fetch:function(h){var i=[h];if(1<arguments.length){var g=arguments[1];if(fb(g)){var _=g.body;if(ph(_)==="URLSearchParams"){var j=g.headers?new zq(g.headers):new zq;j.has("content-type")||j.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"),g=vd(g,{body:ke(0,String(_)),headers:ke(0,j)})}}i.push(g)}return Wz.apply(this,i)}});var yj=na.URL,mP=xj,nP=Sb.set,Tb=Sb.getterFor("URL"),oP=Math.floor,cA=Math.pow,dA=/[A-Za-z]/,pP=/[\d+-.A-Za-z]/,Bq=/\d/,qP=/^(0x|0X)/,rP=/^[0-7]+$/,sP=/^\d+$/,eA=/^[\dA-Fa-f]+$/,tP=/[\0\t\n\r #%/:?@[\\]]/,uP=/[\0\t\n\r #/:?@[\\]]/,vP=/^[\u0000-\u001F ]+|[\u0000-\u001F ]+$/g,wP=/[\t\n\r]/g,Cq=function(h,i){var g;if(i.charAt(0)=="["){if(i.charAt(i.length-1)!="]")return"Invalid host";var _=xP(i.slice(1,-1));if(!_)return"Invalid host"}else if(rc(h)){for(_=[],i=i.toLowerCase().replace(fP,".").split("."),g=0;g<i.length;g++){var j=i[g],$=_,_n=$.push;if(eP.test(j)){var _i=j;j=[];var _s=_i;_i=[];for(var ga=0,ba=_s.length;ga<ba;){var xa=_s.charCodeAt(ga++);if(55296<=xa&&56319>=xa&&ga<ba){var El=_s.charCodeAt(ga++);(64512&El)==56320?_i.push(((1023&xa)<<10)+(1023&El)+65536):(_i.push(xa),ga--)}else _i.push(xa)}ga=_i.length,ba=128;var Tl=0,Sl=72;for(_s=0;_s<_i.length;_s++){var Il=_i[_s];128>Il&&j.push(yq(Il))}for((El=xa=j.length)&&j.push("-");El<ga;){var Cl=2147483647;for(_s=0;_s<_i.length;_s++)(Il=_i[_s])>=ba&&Il<Cl&&(Cl=Il);var Nl=El+1;if(Cl-ba>Zh((2147483647-Tl)/Nl))throw RangeError("Overflow: input needs wider integers to process");for(Tl+=(Cl-ba)*Nl,ba=Cl,_s=0;_s<_i.length;_s++){if((Il=_i[_s])<ba&&2147483647<++Tl)throw RangeError("Overflow: input needs wider integers to process");if(Il==ba){var Dl=Tl;for(Il=36;!(Dl<(Cl=Il<=Sl?1:Il>=Sl+26?26:Il-Sl));Il+=36){var Ul=36-Cl,Kl=j;Cl+=(Dl-=Cl)%Ul,Kl.push.call(Kl,yq(Cl+22+75*(26>Cl))),Dl=Zh(Dl/Ul)}for(j.push(yq(Dl+22+75*(26>Dl))),Sl=Nl,Il=0,Tl=El==xa?Zh(Tl/700):Tl>>1,Tl+=Zh(Tl/Sl);455<Tl;Il+=36)Tl=Zh(Tl/35);Sl=Zh(Il+36*Tl/(Tl+38)),Tl=0,++El}}++Tl,++ba}j="xn--"+j.join("")}_n.call($,j)}if(i=_.join("."),tP.test(i)||(_=yP(i))===null)return"Invalid host"}else{if(uP.test(i))return"Invalid host";for(_="",i=hg(i),g=0;g<i.length;g++)_+=Qf(i[g],Yl)}h.host=_},yP=function(h){var i,g=h.split(".");g.length&&g[g.length-1]==""&&g.pop();var _=g.length;if(4<_)return h;var j=[];for(i=0;i<_;i++){var $=g[i];if($=="")return h;var _n=10;if(1<$.length&&$.charAt(0)=="0"&&(_n=qP.test($)?16:8,$=$.slice(_n==8?1:2)),$==="")$=0;else{if(!(_n==10?sP:_n==8?rP:eA).test($))return h;$=parseInt($,_n)}j.push($)}for(i=0;i<_;i++)if($=j[i],i==_-1){if($>=cA(256,5-_))return null}else if(255<$)return null;for(h=j.pop(),i=0;i<j.length;i++)h+=j[i]*cA(256,3-i);return h},xP=function(h){var i,g,_=[0,0,0,0,0,0,0,0],j=0,$=null,_n=0,_i=function(){return h.charAt(_n)};if(_i()==":"){if(h.charAt(1)!=":")return;_n+=2,$=++j}for(;_i();){if(j==8)return;if(_i()==":"){if($!==null)return;_n++,$=++j}else{for(i=g=0;4>g&&eA.test(_i());)i=16*i+parseInt(_i(),16),_n++,g++;if(_i()=="."){if(g==0||(_n-=g,6<j))return;for(i=0;_i();){if(g=null,0<i){if(!(_i()=="."&&4>i))return;_n++}if(!Bq.test(_i()))return;for(;Bq.test(_i());){var _s=parseInt(_i(),10);if(g===null)g=_s;else{if(g==0)return;g=10*g+_s}if(255<g)return;_n++}_[j]=256*_[j]+g,++i!=2&&i!=4||j++}if(i!=4)return;break}if(_i()==":"){if(_n++,!_i())return}else if(_i())return;_[j++]=i}}if($!==null)for(_i=j-$,j=7;j!=0&&0<_i;)i=_[j],_[j--]=_[$+_i-1],_[$+--_i]=i;else if(j!=8)return;return _},zj=function(h){var i,g;if(typeof h=="number"){var _=[];for(i=0;4>i;i++)_.unshift(h%256),h=oP(h/256);return _.join(".")}if(typeof h=="object"){_="",i=null;for(var j=1,$=null,_n=0,_i=0;8>_i;_i++)h[_i]!==0?(_n>j&&(i=$,j=_n),$=null,_n=0):($===null&&($=_i),++_n);for(_n>j&&(i=$),j=i,i=0;8>i;i++)g&&h[i]===0||(g&&(g=!1),j===i?(_+=i?":":"::",g=!0):(_+=h[i].toString(16),7>i&&(_+=":")));return"["+_+"]"}return h},Yl={},fA=Vi({},Yl,{" ":1,'"':1,"<":1,">":1,"`":1}),gA=Vi({},fA,{"#":1,"?":1,"{":1,"}":1}),Dq=Vi({},gA,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),Qf=function(h,i){var g=fD(h,0);return 32<g&&127>g&&!Fa(i,h)?h:encodeURIComponent(h)},Zl={ftp:21,file:null,http:80,https:443,ws:80,wss:443},rc=function(h){return Fa(Zl,h.scheme)},Eq=function(h){return!h.host||h.cannotBeABaseURL||h.scheme=="file"},Aj=function(h,i){var g;return h.length==2&&dA.test(h.charAt(0))&&((g=h.charAt(1))==":"||!i&&g=="|")},hA=function(h){var i;return 1<h.length&&Aj(h.slice(0,2))&&(h.length==2||(i=h.charAt(2))==="/"||i==="\\"||i==="?"||i==="#")},iA=function(h){var i=h.path,g=i.length;!g||h.scheme=="file"&&g==1&&Aj(i[0],!0)||i.pop()},Fq={},jA={},Gq={},kA={},lA={},Hq={},mA={},nA={},$l={},am={},Iq={},Jq={},Kq={},Lq={},oA={},Mq={},Bj={},ze={},pA={},Gg={},hf={},Ae=function(h,i,g,_){var j=g||Fq,$=0,_n="",_i=!1,_s=!1,ga=!1;for(g||(h.scheme="",h.username="",h.password="",h.host=null,h.port=null,h.path=[],h.query=null,h.fragment=null,h.cannotBeABaseURL=!1,i=i.replace(vP,"")),i=i.replace(wP,""),i=hg(i);$<=i.length;){var ba=i[$];switch(j){case Fq:if(!ba||!dA.test(ba)){if(g)return"Invalid scheme";j=Gq;continue}_n+=ba.toLowerCase(),j=jA;break;case jA:if(ba&&(pP.test(ba)||ba=="+"||ba=="-"||ba=="."))_n+=ba.toLowerCase();else{if(ba!=":"){if(g)return"Invalid scheme";_n="",j=Gq,$=0;continue}if(g&&(rc(h)!=Fa(Zl,_n)||_n=="file"&&(h.username!=""||h.password!=""||h.port!==null)||h.scheme=="file"&&!h.host))return;if(h.scheme=_n,g)return void(rc(h)&&Zl[h.scheme]==h.port&&(h.port=null));_n="",h.scheme=="file"?j=Lq:rc(h)&&_&&_.scheme==h.scheme?j=kA:rc(h)?j=nA:i[$+1]=="/"?(j=lA,$++):(h.cannotBeABaseURL=!0,h.path.push(""),j=pA)}break;case Gq:if(!_||_.cannotBeABaseURL&&ba!="#")return"Invalid scheme";if(_.cannotBeABaseURL&&ba=="#"){h.scheme=_.scheme,h.path=_.path.slice(),h.query=_.query,h.fragment="",h.cannotBeABaseURL=!0,j=hf;break}j=_.scheme=="file"?Lq:Hq;continue;case kA:if(ba!="/"||i[$+1]!="/"){j=Hq;continue}j=$l,$++;break;case lA:if(ba=="/"){j=am;break}j=ze;continue;case Hq:if(h.scheme=_.scheme,ba==null)h.username=_.username,h.password=_.password,h.host=_.host,h.port=_.port,h.path=_.path.slice(),h.query=_.query;else if(ba=="/"||ba=="\\"&&rc(h))j=mA;else if(ba=="?")h.username=_.username,h.password=_.password,h.host=_.host,h.port=_.port,h.path=_.path.slice(),h.query="",j=Gg;else{if(ba!="#"){h.username=_.username,h.password=_.password,h.host=_.host,h.port=_.port,h.path=_.path.slice(),h.path.pop(),j=ze;continue}h.username=_.username,h.password=_.password,h.host=_.host,h.port=_.port,h.path=_.path.slice(),h.query=_.query,h.fragment="",j=hf}break;case mA:if(!rc(h)||ba!="/"&&ba!="\\"){if(ba!="/"){h.username=_.username,h.password=_.password,h.host=_.host,h.port=_.port,j=ze;continue}j=am}else j=$l;break;case nA:if(j=$l,ba!="/"||_n.charAt($+1)!="/")continue;$++;break;case $l:if(ba!="/"&&ba!="\\"){j=am;continue}break;case am:if(ba=="@"){for(_i&&(_n="%40"+_n),_i=!0,_n=hg(_n),ba=0;ba<_n.length;ba++){var xa=_n[ba];xa!=":"||ga?(xa=Qf(xa,Dq),ga?h.password+=xa:h.username+=xa):ga=!0}_n=""}else if(ba==null||ba=="/"||ba=="?"||ba=="#"||ba=="\\"&&rc(h)){if(_i&&_n=="")return"Invalid authority";$-=hg(_n).length+1,_n="",j=Iq}else _n+=ba;break;case Iq:case Jq:if(g&&h.scheme=="file"){j=Mq;continue}if(ba!=":"||_s){if(ba==null||ba=="/"||ba=="?"||ba=="#"||ba=="\\"&&rc(h)){if(rc(h)&&_n=="")return"Invalid host";if(g&&_n==""&&(h.username!=""||h.password!=""||h.port!==null))return;if(j=Cq(h,_n))return j;if(_n="",j=Bj,g)return;continue}ba=="["?_s=!0:ba=="]"&&(_s=!1),_n+=ba}else{if(_n=="")return"Invalid host";if(j=Cq(h,_n))return j;if(_n="",j=Kq,g==Jq)return}break;case Kq:if(!Bq.test(ba)){if(ba==null||ba=="/"||ba=="?"||ba=="#"||ba=="\\"&&rc(h)||g){if(_n!=""){if(65535<(j=parseInt(_n,10)))return"Invalid port";h.port=rc(h)&&j===Zl[h.scheme]?null:j,_n=""}if(g)return;j=Bj;continue}return"Invalid port"}_n+=ba;break;case Lq:if(h.scheme="file",ba=="/"||ba=="\\")j=oA;else{if(!_||_.scheme!="file"){j=ze;continue}if(ba==null)h.host=_.host,h.path=_.path.slice(),h.query=_.query;else if(ba=="?")h.host=_.host,h.path=_.path.slice(),h.query="",j=Gg;else{if(ba!="#"){hA(i.slice($).join(""))||(h.host=_.host,h.path=_.path.slice(),iA(h)),j=ze;continue}h.host=_.host,h.path=_.path.slice(),h.query=_.query,h.fragment="",j=hf}}break;case oA:if(ba=="/"||ba=="\\"){j=Mq;break}_&&_.scheme=="file"&&!hA(i.slice($).join(""))&&(Aj(_.path[0],!0)?h.path.push(_.path[0]):h.host=_.host),j=ze;continue;case Mq:if(ba==null||ba=="/"||ba=="\\"||ba=="?"||ba=="#"){if(!g&&Aj(_n))j=ze;else{if(_n==""){if(h.host="",g)return}else{if(j=Cq(h,_n))return j;if(h.host=="localhost"&&(h.host=""),g)return;_n=""}j=Bj}continue}_n+=ba;break;case Bj:if(rc(h)){if(j=ze,ba!="/"&&ba!="\\")continue}else if(g||ba!="?")if(g||ba!="#"){if(ba!=null&&(j=ze,ba!="/"))continue}else h.fragment="",j=hf;else h.query="",j=Gg;break;case ze:if(ba==null||ba=="/"||ba=="\\"&&rc(h)||!g&&(ba=="?"||ba=="#")){if((xa=(xa=_n).toLowerCase())===".."||xa==="%2e."||xa===".%2e"||xa==="%2e%2e"?(iA(h),ba=="/"||ba=="\\"&&rc(h)||h.path.push("")):_n==="."||_n.toLowerCase()==="%2e"?ba=="/"||ba=="\\"&&rc(h)||h.path.push(""):(h.scheme=="file"&&!h.path.length&&Aj(_n)&&(h.host&&(h.host=""),_n=_n.charAt(0)+":"),h.path.push(_n)),_n="",h.scheme=="file"&&(ba==null||ba=="?"||ba=="#"))for(;1<h.path.length&&h.path[0]==="";)h.path.shift();ba=="?"?(h.query="",j=Gg):ba=="#"&&(h.fragment="",j=hf)}else _n+=Qf(ba,gA);break;case pA:ba=="?"?(h.query="",j=Gg):ba=="#"?(h.fragment="",j=hf):ba!=null&&(h.path[0]+=Qf(ba,Yl));break;case Gg:g||ba!="#"?ba!=null&&(ba=="'"&&rc(h)?h.query+="%27":h.query=ba=="#"?h.query+"%23":h.query+Qf(ba,Yl)):(h.fragment="",j=hf);break;case hf:ba!=null&&(h.fragment+=Qf(ba,fA))}$++}},Rf=function(h){var i=Ud(this,Rf,"URL"),g=1<arguments.length?arguments[1]:void 0,_=String(h),j=nP(i,{type:"URL"});if(g!==void 0){if(g instanceof Rf)var $=Tb(g);else if(g=Ae($={},String(g)))throw TypeError(g)}if(g=Ae(j,_,null,$))throw TypeError(g);var _n=j.searchParams=new mP;(_=od(_n)).updateSearchParams(j.query),_.updateURL=function(){j.query=String(_n)||null},cb||(i.href=bm.call(i),i.origin=qA.call(i),i.protocol=rA.call(i),i.username=sA.call(i),i.password=tA.call(i),i.host=uA.call(i),i.hostname=vA.call(i),i.port=wA.call(i),i.pathname=xA.call(i),i.search=yA.call(i),i.searchParams=zA.call(i),i.hash=AA.call(i))},Nq=Rf.prototype,bm=function(){var h=Tb(this),i=h.scheme,g=h.username,_=h.password,j=h.host,$=h.port,_n=h.path,_i=h.query,_s=h.fragment,ga=i+":";return j!==null?(ga+="//",h.username==""&&h.password==""||(ga+=g+(_?":"+_:"")+"@"),ga+=zj(j),$!==null&&(ga+=":"+$)):i=="file"&&(ga+="//"),ga+=h.cannotBeABaseURL?_n[0]:_n.length?"/"+_n.join("/"):"",_i!==null&&(ga+="?"+_i),_s!==null&&(ga+="#"+_s),ga},qA=function(){var h=Tb(this),i=h.scheme,g=h.port;if(i=="blob")try{return new Rf(i.path[0]).origin}catch{return"null"}return i!="file"&&rc(h)?i+"://"+zj(h.host)+(g!==null?":"+g:""):"null"},rA=function(){return Tb(this).scheme+":"},sA=function(){return Tb(this).username},tA=function(){return Tb(this).password},uA=function(){var h=Tb(this),i=h.host;return h=h.port,i===null?"":h===null?zj(i):zj(i)+":"+h},vA=function(){var h=Tb(this).host;return h===null?"":zj(h)},wA=function(){var h=Tb(this).port;return h===null?"":String(h)},xA=function(){var h=Tb(this),i=h.path;return h.cannotBeABaseURL?i[0]:i.length?"/"+i.join("/"):""},yA=function(){var h=Tb(this).query;return h?"?"+h:""},zA=function(){return Tb(this).searchParams},AA=function(){var h=Tb(this).fragment;return h?"#"+h:""},Kd=function(h,i){return{get:h,set:i,configurable:!0,enumerable:!0}};if(cb&&vt(Nq,{href:Kd(bm,function(h){var i=Tb(this);if(h=Ae(i,String(h)))throw TypeError(h);od(i.searchParams).updateSearchParams(i.query)}),origin:Kd(qA),protocol:Kd(rA,function(h){var i=Tb(this);Ae(i,String(h)+":",Fq)}),username:Kd(sA,function(h){var i=Tb(this);if(h=hg(String(h)),!Eq(i)){i.username="";for(var g=0;g<h.length;g++)i.username+=Qf(h[g],Dq)}}),password:Kd(tA,function(h){var i=Tb(this);if(h=hg(String(h)),!Eq(i)){i.password="";for(var g=0;g<h.length;g++)i.password+=Qf(h[g],Dq)}}),host:Kd(uA,function(h){var i=Tb(this);i.cannotBeABaseURL||Ae(i,String(h),Iq)}),hostname:Kd(vA,function(h){var i=Tb(this);i.cannotBeABaseURL||Ae(i,String(h),Jq)}),port:Kd(wA,function(h){var i=Tb(this);Eq(i)||((h=String(h))==""?i.port=null:Ae(i,h,Kq))}),pathname:Kd(xA,function(h){var i=Tb(this);i.cannotBeABaseURL||(i.path=[],Ae(i,h+"",Bj))}),search:Kd(yA,function(h){var i=Tb(this);(h=String(h))==""?i.query=null:(h.charAt(0)=="?"&&(h=h.slice(1)),i.query="",Ae(i,h,Gg)),od(i.searchParams).updateSearchParams(i.query)}),searchParams:Kd(zA),hash:Kd(AA,function(h){var i=Tb(this);(h=String(h))==""?i.fragment=null:(h.charAt(0)=="#"&&(h=h.slice(1)),i.fragment="",Ae(i,h,hf))})}),Ob(Nq,"toJSON",function(){return bm.call(this)},{enumerable:!0}),Ob(Nq,"toString",function(){return bm.call(this)},{enumerable:!0}),yj){var BA=yj.createObjectURL,CA=yj.revokeObjectURL;BA&&Ob(Rf,"createObjectURL",function(h){return BA.apply(yj,arguments)}),CA&&Ob(Rf,"revokeObjectURL",function(h){return CA.apply(yj,arguments)})}Td(Rf,"URL"),wa({global:!0,forced:!xq,sham:!cb},{URL:Rf});var zP=new Blob(["var fakeIdToId = {};onmessage = function (event) {	var data = event.data,		name = data.name,		fakeId = data.fakeId,		time;	if(data.hasOwnProperty('time')) {		time = data.time;	}	switch (name) {		case 'setInterval':			fakeIdToId[fakeId] = setInterval(function () {				postMessage({fakeId: fakeId});			}, time);			break;		case 'clearInterval':			if (fakeIdToId.hasOwnProperty (fakeId)) {				clearInterval(fakeIdToId[fakeId]);				delete fakeIdToId[fakeId];			}			break;	}}"]),AP=window.URL.createObjectURL(zP),gh={},xi=0,Xm=new Worker(AP);Xm.onmessage=function(h){if(h=h.data.fakeId,gh.hasOwnProperty(h)){var i=gh[h];h=i.callback,i=i.parameters,h.apply(window,i)}};var BP=function(h){function i(){return ab(this,i),g.apply(this,arguments)}nb(i,h);var g=ob(i);return Qb(i,[{key:"requestAsyncId",value:function(_,j){var $=2<arguments.length&&arguments[2]!==void 0?arguments[2]:0;return BC(_.flush.bind(_,this),$)}},{key:"recycleAsyncId",value:function(_,j){var $=2<arguments.length&&arguments[2]!==void 0?arguments[2]:0;if($!==null&&this.delay===$&&this.pending===!1)return j;gh.hasOwnProperty(j)&&(delete gh[j],Xm.postMessage({name:"clearInterval",fakeId:j}))}}]),i}(Sz),CP=new Uz(BP),DP=["group"],Oq=X.inflate,DA=X.deflate,Pq=function(h){function i(j,$,_n,_i){ab(this,i);var _s=_.call(this,_i,"Session");return E(L(_s),"lastNoticeTicket",""),E(L(_s),"chatManager",void 0),E(L(_s),"usedChannelIds",[]),E(L(_s),"lastUserMeteUpdateRecord",{}),E(L(_s),"lastChannelMetaUpdateRecord",{}),E(L(_s),"msgDedupLru",new ue(void 0,{maxlen:200})),E(L(_s),"startTime",Date.now()),E(L(_s),"seq",D.fromNumber(1,!0)),E(L(_s),"userJoinOptions",new Pz(!1)),E(L(_s),"seqSentStatuses",[!1,!1]),E(L(_s),"dialogueSequenceLru",new ue(void 0,{maxlen:1e4})),E(L(_s),"loggedOut",!1),E(L(_s),"messageSentTimes",[]),E(L(_s),"curLoginSockets",[void 0,void 0]),E(L(_s),"loginSocketSubs",[{channels:new Map,receivers:[]},{channels:new Map,receivers:[]}]),E(L(_s),"lastLoginSockets",[new ah(1),new ah(1)]),E(L(_s),"dialPendingMsgSubjectMap",new Map),E(L(_s),"context",void 0),E(L(_s),"connection",void 0),E(L(_s),"instanceId",void 0),E(L(_s),"lastPingTime",void 0),E(L(_s),"chanelStringMessageReport",void 0),E(L(_s),"chanelRawMessageReport",void 0),E(L(_s),"p2pSMsgNoOfflineReport",void 0),E(L(_s),"p2pRMsgNoOfflineReport",void 0),E(L(_s),"registerSocketsFailureListener",function(){_s.connection.once("socketsFailure",function(){_s.log("socketsFailure, creating a new connection"),lf(function(){return _s.connection.removeAllListeners(),_s.connection=new Gx(_s.context,_s.logger,!0),_s.loginHandler(15e3,!0)}).pipe(Zg(function(ga){return ga.pipe(mf(wg.getParameter("RECONNECTING_AP_INTERVAL")))}),he(_s.connection.apClient.apFinish$)).subscribe(function(){_s.log("new connection connected")})}),_s.connection.listenerCount("tokenExpired")===0&&_s.connection.on("tokenExpired",function(){_s.emit("tokenExpired")})}),_s.context=j,_s.context.startTime=_s.startTime,_s.connection=$,_s.instanceId=_n,_s.chatManager=new QO(_i),_s.lastPingTime=[0,0],_s.setMaxListeners(512),_s.log("The instanceId is %s",_s.instanceId.toString()),_s.chanelStringMessageReport=new Wl(j,_i,vb.ChannelSMsg),_s.chanelRawMessageReport=new Wl(j,_i,vb.ChannelRMsg),_s.p2pSMsgNoOfflineReport=new Wl(j,_i,vb.P2pSMsgNoOfflineFlag),_s.p2pRMsgNoOfflineReport=new Wl(j,_i,vb.P2pRMsgNoOfflineFlag),_s}nb(i,h);var g,_=ob(i);return Qb(i,[{key:"loginHandler",value:function(){var j=this,$=0<arguments.length&&arguments[0]!==void 0?arguments[0]:12e3,_n=1<arguments.length&&arguments[1]!==void 0&&arguments[1];if(this.loggedOut&&_n)throw new ia("Already logged out, request ignored");_n&&this.registerSocketsFailureListener(),this.connection.initConnection();var _i=this.getSocketLoginObservables(this.connection.lastOpenSockets,this.seq),_s=Date.now();return _i.forEach(function(ga,ba){var xa=j.loginSocketSubs[ba].login;xa!==void 0&&xa.unsubscribe(),j.loginSocketSubs[ba].login=ga.pipe(Ka(function(El){var Tl;j.curLoginSockets[ba]=El;var Sl=Date.now();$a("Link",{ackedServerIp:El.address,destServerIp:El.ip,ec:0,sc:0,elapse:Nb(j.startTime),lts:D.fromNumber(Sl),responseTime:Sl-_s,sid:fc(j.instanceId),userId:j.context.uid},(Tl=j.context.config.enableCloudProxy)!==null&&Tl!==void 0&&Tl),j.emit("userJoined",El.env),_n&&j.connection.apClient.apFinish$.next(void 0)})).subscribe(j.lastLoginSockets[ba])}),this.initKeepAliveSender(),this.initKeepAliveReconnector(),this.initLoginReceiver(),Nc.apply(void 0,ra(_i).concat([Bc(this.connection,"connectionInitFailure").pipe(Ka(function(ga){throw Sa(ga)||uc(ga)?ga:new Pa("Login failure",{code:Ew,originalError:ga})}))])).pipe(Xb(1),Oc($),Rb(function(ga){return ga instanceof ad&&j.warn("Client login timeout"),ga&&ga.code===bl&&(j.connection.emit("tokenExpired"),j.connection.apClient.apFinish$.next(void 0)),j.clearSockets(0,_n),Va(ga)}),Ka(function(){_n||j.registerSocketsFailureListener()}),Mj(function(){_n||j.connection.apClient.apFinish$.next(void 0)}))}},{key:"logoutHandler",value:(g=za(W.mark(function j(){var $,_n,_i,_s,ga=this;return W.wrap(function(ba){for(;;)switch(ba.prev=ba.next){case 0:return this.loggedOut=!0,this.connection.apClient.apFinish$.next(void 0),$=this.incGetSeq(),_n=this.getLoginSockets(),_i=_n.map(function(xa){var El,Tl;return xa.sendPacket("StateUnsubscribe",{sequence:$,target:ga.context.uid,subTarget:"",flags:D.fromNumber(0)}),delete ga.lastUserMeteUpdateRecord[ga.context.sid],$a("SyncSubscribeEvent",{lts:D.fromNumber(Date.now()),userid:ga.context.uid,vid:(El=ga.context)!==null&&El!==void 0&&El.vid?D.fromString(ga.context.vid):D.fromNumber(0),sid:"",usersid:ga.context.sid,target:ga.context.uid,requestts:D.fromNumber(Date.now()),replyts:D.fromNumber(Date.now()),eventtype:"UnSubscribe",sdktype:3,flags:D.fromNumber(0),code:0,seq:$,index:{index1:ga.context.uid,index2:ga.context.appId,index3:"enableLogUpload=".concat(ga.context.config.enableLogUpload)},subtarget:ga.context.uid},(Tl=ga.context.config.enableCloudProxy)!==null&&Tl!==void 0&&Tl),xa.sendPacket("UserQuit",{}),ga.connection.waitClosing(xa)}),this.clearSockets(5e3),_s=_n.map(function(xa){return xa.env}),[0,1].filter(function(xa){return!_s.includes(xa)}).forEach(function(xa){ga.connection.closeSocket(xa,0)}),ba.abrupt("return",Nc.apply(void 0,ra(_i)).toPromise());case 10:case"end":return ba.stop()}},j,this)})),function(){return g.apply(this,arguments)})},{key:"requestChannelJoin",value:function(){var j=za(W.mark(function $(_n){var _i,_s,ga,ba=this;return W.wrap(function(xa){for(;;)switch(xa.prev=xa.next){case 0:if(this.getLoginSockets().length!==0){xa.next=2;break}throw new ia("Client is not logged in. Cannot join the channel",Aw);case 2:return _i=Bc(this,"channelLeft").pipe(sc(function(El){return _n===El}),Xb(1)),_s=this.incGetSeq(),(ga=this.lastLoginSockets.map(function(El){return El.pipe(Cc(function(Tl,Sl){Sl!==0&&ba.incSeqIfNeeded(Tl.env);var Il=Sl===0?_s:ba.seq;return Tl.sendPacket("GroupEnter",{account:_n,seq:Il}),Tl.fromReceived("GroupReply").pipe(La(function(Cl){return Il.eq(Cl.seq)}),Ka(function(Cl){if((Cl=Cl.code)!==0)throw new Pa(["Channel join failure. The response code is %d",Cl],ww)}))}),he(_i),$g())})).forEach(function(El,Tl){var Sl=function(){return ba.loginSocketSubs[Tl].channels.delete(_n)};ba.loginSocketSubs[Tl].channels.set(_n,El.subscribe({error:Sl,complete:Sl}))}),xa.next=8,Nc.apply(void 0,ra(ga)).pipe(Xb(1),Oc(1e4),Rb(function(El){return El instanceof ad&&ba.warn("Channel join timeout"),Va(El)})).toPromise();case 8:case"end":return xa.stop()}},$,this)}));return function($){return j.apply(this,arguments)}}()},{key:"requestChannelLeave",value:function(j){this.getLoginSockets().forEach(function($){$.sendPacket("GroupLeave",{account:j})})}},{key:"requestUpdateEdgeTicket",value:function(j){var $=this,_n=this.getLoginSockets();if(_n.length===0)throw new ia("Client is not logged in. Cannot renew token",Mw);var _i=this.incGetSeq();return _n.forEach(function(_s){_s.sendPacket("UserRenewTokenReq",{instance:$.instanceId,seq:_i,account:$.context.uid,ticket:j})}),bb.apply(void 0,[i.genTimeoutError(jp)].concat(ra(_n.map(function(_s){return _s.fromReceived("UserRenewTokenResp").pipe(La(function(ga){var ba=ga.code;return _i.eq(ga.seq)&&ba===0}))}))))}},{key:"requestChannelMemberList",value:function(j){var $=this.getLoginSockets();if($.length===0)throw new ia("Client is not logged in. Cannot get the channel members",wI);var _n=this.incGetSeq();return $.forEach(function(_i){_i.sendPacket("GroupAllUsersList",{group:j,pageNumber:0,pageSize:200,seq:_n})}),bb.apply(void 0,[i.genTimeoutError(uw)].concat(ra($.map(function(_i){return _i.fromReceived("GroupAllUsersResult").pipe(La(function(_s){var ga=_s.seq;return _s.group===j&&_n.eq(ga)}))}))))}},{key:"requestPeersOnlineStatus",value:function(j){var $=this.getLoginSockets();if($.length===0)throw new ia("Client is not logged in");var _n=this.incGetSeq();return $.forEach(function(_i){_i.sendPacket("UserStatusList",{users:j,seq:_n})}),bb.apply(void 0,[i.genTimeoutError(II)].concat(ra($.map(function(_i){return _i.fromReceived("UserStatusResult").pipe(La(function(_s){return _n.eq(_s.seq)}))}))))}},{key:"requestSetLocalUserAttributes",value:function(j,$){var _n=this,_i=this.getLoginSockets();if(_i.length===0)throw new ia("Client is not logged in");var _s=this.incGetSeq();return _i.forEach(function(ga,ba){$!==void 0&&ba!==$||ga.sendPacket("UserAttributeSet",{account:_n.context.uid,attributeInfos:Object.entries(j).map(function(xa){return{key:(xa=Lb(xa,2))[0],value:xa[1]}}),seq:_s})}),bb.apply(void 0,ra(_i.map(function(ga){return ga.fromReceived("UserAttributeErr").pipe(La(function(ba){return _s.eq(ba.seq)}),Wa(function(ba){throw new Pa(["The user attributes set failure, code %d",ba.code],Ad)}))})).concat([i.genTimeoutError(Bd)],ra(_i.map(function(ga){return ga.fromReceived("UserAttributeRsp").pipe(La(function(ba){return _s.eq(ba.seq)}))}))))}},{key:"requestSetChannelAttributes",value:function(j,$,_n){var _i=this.getLoginSockets();if(_i.length===0)throw new ia("Client is not logged in");var _s=this.incGetSeq();return _i.forEach(function(ga){ga.sendPacket("GroupAttributeSet",{broadcast:_n,group:j,attributeInfos:Object.entries($).map(function(ba){return{key:(ba=Lb(ba,2))[0],value:ba[1]}}),seq:_s})}),bb.apply(void 0,ra(_i.map(function(ga){return ga.fromReceived("GroupAttributeErr").pipe(La(function(ba){return _s.eq(ba.seq)}),Wa(function(ba){throw new Pa(["The group attributes set failure, code %d",ba.code],Ad)}))})).concat([i.genTimeoutError(Bd)],ra(_i.map(function(ga){return ga.fromReceived("GroupAttributeRsp").pipe(La(function(ba){return _s.eq(ba.seq)}))}))))}},{key:"requestAddOrUpdateLocalUserAttributes",value:function(j){var $=this,_n=this.getLoginSockets();if(_n.length===0)throw new ia("Client is not logged in");var _i=this.incGetSeq();return _n.forEach(function(_s){_s.sendPacket("UserAttributeMod",{account:$.context.uid,attributeInfos:Object.entries(j).map(function(ga){return{key:(ga=Lb(ga,2))[0],value:ga[1]}}),seq:_i})}),bb.apply(void 0,ra(_n.map(function(_s){return _s.fromReceived("UserAttributeErr").pipe(La(function(ga){return _i.eq(ga.seq)}),Wa(function(ga){throw new Pa(["The user attributes add or update failure, code %d",ga.code],Ad)}))})).concat([i.genTimeoutError(Bd)],ra(_n.map(function(_s){return _s.fromReceived("UserAttributeRsp").pipe(La(function(ga){return _i.eq(ga.seq)}))}))))}},{key:"requestAddOrUpdateChannelAttributes",value:function(j,$,_n){var _i=this.getLoginSockets();if(_i.length===0)throw new ia("Client is not logged in");var _s=this.incGetSeq();return _i.forEach(function(ga){ga.sendPacket("GroupAttributeMod",{broadcast:_n,group:j,attributeInfos:Object.entries($).map(function(ba){return{key:(ba=Lb(ba,2))[0],value:ba[1]}}),seq:_s})}),bb.apply(void 0,ra(_i.map(function(ga){return ga.fromReceived("GroupAttributeErr").pipe(La(function(ba){return _s.eq(ba.seq)}),Wa(function(ba){throw new Pa(["The group attributes add or update failure, code %d",ba.code],Ad)}))})).concat([i.genTimeoutError(Bd)],ra(_i.map(function(ga){return ga.fromReceived("GroupAttributeRsp").pipe(La(function(ba){return _s.eq(ba.seq)}))}))))}},{key:"requestDeleteLocalUserAttributesByKeys",value:function(j){var $=this,_n=this.getLoginSockets();if(_n.length===0)throw new ia("Client is not logged in");var _i=this.incGetSeq();return _n.forEach(function(_s){_s.sendPacket("UserAttributeDel",{account:$.context.uid,attributes:j,seq:_i})}),bb.apply(void 0,ra(_n.map(function(_s){return _s.fromReceived("UserAttributeErr").pipe(La(function(ga){return _i.eq(ga.seq)}),Wa(function(ga){throw new Pa(["The user attributes delete failure, code %d",ga.code],Ad)}))})).concat([i.genTimeoutError(Bd)],ra(_n.map(function(_s){return _s.fromReceived("UserAttributeRsp").pipe(La(function(ga){return _i.eq(ga.seq)}))}))))}},{key:"requestGetChannelMetaData",value:function(j){var $=this.getLoginSockets();if($.length===0)throw new ia("Client is not logged in. Cannot get the channel metadata",oc);if(this.context.lastGetMetaDataTime!==void 0&&250>Date.now()-this.context.lastGetMetaDataTime)throw new Fc(["The frequency of metedata operation exceeded the limit of %d queries per %d second",20,5e3],Vc);this.context.lastGetMetaDataTime=Date.now();var _n=this.incGetSeq();return $.forEach(function(_i){_i.sendPacket("StateGet",{target:j,subTarget:"",lock:"",sequence:_n,flags:new D(1,0,!0),lockRev:D.fromNumber(0)})}),bb.apply(void 0,[i.genTimeoutError(cd)].concat(ra($.map(function(_i){return _i.fromReceived("StateGetResult").pipe(La(function(_s){return _n.eq(_s.sequence)}),Wa(function(_s){var ga=_s.code;if(_s=_s.allStates,ud(ga)!==bd)throw new Pa(["Get metaData failure. The response code from the RTM service is %d",ga],He);return _s}))}))))}},{key:"requestGetLocalMetaData",value:function(j){var $=this.getLoginSockets();if($.length===0)throw new ia("Client is not logged in. Cannot get the local metaData",oc);if(this.context.lastGetMetaDataTime!==void 0&&250>Date.now()-this.context.lastGetMetaDataTime)throw new Fc(["The frequency of metedata operation exceeded the limit of %d queries per %d second",20,5e3],Vc);this.context.lastGetMetaDataTime=Date.now();var _n=this.incGetSeq();return $.forEach(function(_i){_i.sendPacket("StateGet",{target:j,subTarget:"",lock:"",sequence:_n,flags:D.fromNumber(0),lockRev:D.fromNumber(0)})}),bb.apply(void 0,[i.genTimeoutError(cd)].concat(ra($.map(function(_i){return _i.fromReceived("StateGetResult").pipe(La(function(_s){return _n.eq(_s.sequence)}),Wa(function(_s){var ga=_s.code;if(_s=_s.allStates,ud(ga)!==bd)throw new Pa(["Get metaData failure. The response code from the RTM service is %d",ga],He);return _s}))}))))}},{key:"requestDeleteChannelAttributesByKeys",value:function(j,$,_n){var _i=this.getLoginSockets();if(_i.length===0)throw new ia("Client is not logged in");var _s=this.incGetSeq();return _i.forEach(function(ga){ga.sendPacket("GroupAttributeDel",{group:j,broadcast:_n,attributes:$,seq:_s})}),bb.apply(void 0,ra(_i.map(function(ga){return ga.fromReceived("GroupAttributeErr").pipe(La(function(ba){return _s.eq(ba.seq)}),Wa(function(ba){throw new Pa(["The channel attributes delete failure, code %d",ba.code],Ad)}))})).concat([i.genTimeoutError(Bd)],ra(_i.map(function(ga){return ga.fromReceived("GroupAttributeRsp").pipe(La(function(ba){return _s.eq(ba.seq)}))}))))}},{key:"requestClearLocalUserAttributes",value:function(){var j=this,$=this.getLoginSockets();if($.length===0)throw new ia("Client is not logged in");var _n=this.incGetSeq();return $.forEach(function(_i){_i.sendPacket("UserAttributeSet",{account:j.context.uid,seq:_n,attributeInfos:[]})}),bb.apply(void 0,ra($.map(function(_i){return _i.fromReceived("UserAttributeErr").pipe(La(function(_s){return _n.eq(_s.seq)}),Wa(function(_s){throw new Pa(["The user attributes clear failure, code %d",_s.code],Ad)}))})).concat([i.genTimeoutError(Bd)],ra($.map(function(_i){return _i.fromReceived("UserAttributeRsp").pipe(La(function(_s){return _n.eq(_s.seq)}))}))))}},{key:"requestClearChannelAttributes",value:function(j,$){var _n=this.getLoginSockets();if(_n.length===0)throw new ia("Client is not logged in");var _i=this.incGetSeq();return _n.forEach(function(_s){_s.sendPacket("GroupAttributeSet",{group:j,seq:_i,attributeInfos:[],broadcast:$})}),bb.apply(void 0,ra(_n.map(function(_s){return _s.fromReceived("GroupAttributeErr").pipe(La(function(ga){return _i.eq(ga.seq)}),Wa(function(ga){throw new Pa(["The channel attributes clear failure, code %d",ga.code],Ad)}))})).concat([i.genTimeoutError(Bd)],ra(_n.map(function(_s){return _s.fromReceived("GroupAttributeRsp").pipe(La(function(ga){return _i.eq(ga.seq)}))}))))}},{key:"requestAddChannelMetadata",value:function(j){var $=this,_n=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{majorRevision:-1,enableRecordTs:!1,enableRecordUserId:!1},_i=2<arguments.length?arguments[2]:void 0,_s=this.getLoginSockets();if(_s.length===0)throw new ia("Client is not logged in");if(_n.majorRevision&&(-1>_n.majorRevision||_n.majorRevision%1!=0))throw new ja("MajorRevision should be set to a value greater than  -1",Mb);if(nf({items:j,maxMetaDataCount:32,maxMetaValueSize:16384,type:"Add"}),this.context.lastModifyMeteDataTime!==void 0&&250>Date.now()-this.context.lastModifyMeteDataTime)throw new Fc(["The frequency of metedata operation exceeded the limit of %d queries per %d second",20,5e3],Vc);this.context.lastModifyMeteDataTime=Date.now();var ga=this.incGetSeq(),ba=JSON.stringify(pf(Pd.cloneDeep(j).map(function(El){return El.setRevision(0),El}),_n.majorRevision)),xa=Date.now();return _s.forEach(function(El){El.sendPacket("StateModify",{sequence:ga,target:_i,requestUuid:"".concat(ga,"_").concat($.instanceId),lock:"",lockRev:D.fromNumber(0),value:ba,baseRevision:D.fromNumber(0),author:_n.enableRecordUserId?$.context.uid:"",flags:_n.enableRecordTs?new D(524289,0,!0):new D(1,0,!0)})}),bb.apply(void 0,[i.genTimeoutError(cd)].concat(ra(_s.map(function(El){return El.fromReceived("StateRequestResult").pipe(La(function(Tl){return ga.eq(Tl.sequence)}),Wa(function(Tl){var Sl,Il,Cl=ud(Tl=Tl.code);if($a("SyncOperateEvent",{lts:D.fromNumber(Date.now()),userid:$.context.uid,vid:D.fromString((Sl=$.context.vid)!==null&&Sl!==void 0?Sl:"0"),sid:"",usersid:$.context.sid,requestts:D.fromNumber(xa),replyts:D.fromNumber(Date.now()),target:_i,eventtype:"Add",revision:D.fromNumber(0),uuid:"".concat(ga,"_").concat($.instanceId),sdktype:3,flags:_n.enableRecordTs?new D(524289,0,!0):new D(1,0,!0),code:Cl,seq:ga,index:{index1:_i,index2:$.context.appId,index3:"enableLogUpload=".concat($.context.config.enableLogUpload)},lock:"",lockrev:D.fromNumber(0),subtarget:$.context.uid},(Il=$.context.config.enableCloudProxy)!==null&&Il!==void 0&&Il),Cl!==bd)throw new Pa(["MetaData modify failure. The response code from the RTM service is %d",Tl],Cl)}))}))))}},{key:"requestUpdateChannelMetadata",value:function(j){var $=this,_n=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{majorRevision:-1,enableRecordTs:!1,enableRecordUserId:!1},_i=2<arguments.length?arguments[2]:void 0,_s=this.getLoginSockets();if(_s.length===0)throw new ia("Client is not logged in");if(_n.majorRevision&&(-1>_n.majorRevision||_n.majorRevision%1!=0))throw new ja("MajorRevision should be set to a value greater than  -1",Mb);if(_n.majorRevision===0)throw new ja("MajorRevision can not be set to 0",of);if(nf({items:j,maxMetaDataCount:32,maxMetaValueSize:16384,type:"Update"}),this.context.lastModifyMeteDataTime!==void 0&&250>Date.now()-this.context.lastModifyMeteDataTime)throw new Fc(["The frequency of metedata operation exceeded the limit of %d queries per %d second",20,5e3],Vc);this.context.lastModifyMeteDataTime=Date.now();var ga=this.incGetSeq(),ba=JSON.stringify(pf(Pd.cloneDeep(j).map(function(El){return El.getRevision()===-1&&El.setRevision(-2),El}),_n.majorRevision)),xa=Date.now();return _s.forEach(function(El){El.sendPacket("StateModify",{sequence:ga,target:_i,requestUuid:"".concat(ga,"_").concat($.instanceId),lock:"",lockRev:D.fromNumber(0),value:ba,baseRevision:D.fromNumber(0),author:_n.enableRecordUserId?$.context.uid:"",flags:_n.enableRecordTs?new D(524289,0,!0):new D(1,0,!0)})}),bb.apply(void 0,[i.genTimeoutError(cd)].concat(ra(_s.map(function(El){return El.fromReceived("StateRequestResult").pipe(La(function(Tl){return ga.eq(Tl.sequence)}),Wa(function(Tl){var Sl,Il,Cl=ud(Tl=Tl.code);if($a("SyncOperateEvent",{lts:D.fromNumber(Date.now()),userid:$.context.uid,vid:D.fromString((Sl=$.context.vid)!==null&&Sl!==void 0?Sl:"0"),sid:"",usersid:$.context.sid,requestts:D.fromNumber(xa),replyts:D.fromNumber(Date.now()),target:_i,eventtype:"Update",revision:D.fromNumber(0),uuid:"".concat(ga,"_").concat($.instanceId),sdktype:3,flags:_n.enableRecordTs?new D(524289,0,!0):new D(1,0,!0),code:Cl,seq:ga,index:{index1:$.context.uid,index2:$.context.appId,index3:"enableLogUpload=".concat($.context.config.enableLogUpload)},lock:"",lockrev:D.fromNumber(0),subtarget:$.context.uid},(Il=$.context.config.enableCloudProxy)!==null&&Il!==void 0&&Il),Cl!==bd)throw new Pa(["MetaData modify failure. The response code from the RTM service is %d",Tl],Cl)}))}))))}},{key:"requestDeleteChannelMetadata",value:function(j){var $=this,_n=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{majorRevision:-1,enableRecordTs:!1,enableRecordUserId:!1},_i=2<arguments.length?arguments[2]:void 0,_s=this.getLoginSockets();if(_s.length===0)throw new ia("Client is not logged in");if(_n.majorRevision&&(-1>_n.majorRevision||_n.majorRevision%1!=0))throw new ja("MajorRevision should be set to a value greater than  -1",Mb);if(_n.majorRevision===0)throw new ja("MajorRevision can not be set to 0",of);if(nf({items:j,maxMetaDataCount:32,maxMetaValueSize:16384,type:"Delete"}),this.context.lastModifyMeteDataTime!==void 0&&250>Date.now()-this.context.lastModifyMeteDataTime)throw new Fc(["The frequency of metedata operation exceeded the limit of %d queries per %d second",20,5e3],Vc);this.context.lastModifyMeteDataTime=Date.now();var ga=this.incGetSeq(),ba=JSON.stringify(pf(Pd.cloneDeep(j).map(function(El){return El.setValue(null),El}),_n.majorRevision)),xa=Date.now();return _s.forEach(function(El){El.sendPacket("StateModify",{sequence:ga,target:_i,requestUuid:"".concat(ga,"_").concat($.instanceId),lock:"",lockRev:D.fromNumber(0),value:ba,baseRevision:D.fromNumber(0),author:_n.enableRecordUserId?$.context.uid:"",flags:_n.enableRecordTs?new D(524289,0,!0):new D(1,0,!0)})}),bb.apply(void 0,[i.genTimeoutError(cd)].concat(ra(_s.map(function(El){return El.fromReceived("StateRequestResult").pipe(La(function(Tl){return ga.eq(Tl.sequence)}),Wa(function(Tl){var Sl,Il,Cl=ud(Tl=Tl.code);if($a("SyncOperateEvent",{lts:D.fromNumber(Date.now()),userid:$.context.uid,vid:D.fromString((Sl=$.context.vid)!==null&&Sl!==void 0?Sl:"0"),sid:"",usersid:$.context.sid,requestts:D.fromNumber(xa),replyts:D.fromNumber(Date.now()),target:_i,eventtype:"Delete",revision:D.fromNumber(0),uuid:"".concat(ga,"_").concat($.instanceId),sdktype:3,flags:_n.enableRecordTs?new D(524289,0,!0):new D(1,0,!0),code:Cl,seq:ga,index:{index1:$.context.uid,index2:$.context.appId,index3:"enableLogUpload=".concat($.context.config.enableLogUpload)},lock:"",lockrev:D.fromNumber(0),subtarget:$.context.uid},(Il=$.context.config.enableCloudProxy)!==null&&Il!==void 0&&Il),Cl!==bd)throw new Pa(["MetaData modify failure. The response code from the RTM service is %d",Tl],He)}))}))))}},{key:"requestSetChannelMetadata",value:function(j){var $=this,_n=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{majorRevision:-1,enableRecordTs:!1,enableRecordUserId:!1},_i=2<arguments.length?arguments[2]:void 0,_s=this.getLoginSockets();if(_s.length===0)throw new ia("Client is not logged in");if(_n.majorRevision&&(-1>_n.majorRevision||_n.majorRevision%1!=0))throw new ja("MajorRevision should be set to a value greater than  -1",Mb);if(nf({items:j,maxMetaDataCount:32,maxMetaValueSize:16384,type:"Set"}),this.context.lastModifyMeteDataTime!==void 0&&250>Date.now()-this.context.lastModifyMeteDataTime)throw new Fc(["The frequency of metedata operation exceeded the limit of %d queries per %d second",20,5e3],Vc);this.context.lastModifyMeteDataTime=Date.now();var ga=this.incGetSeq(),ba=Date.now();return _s.forEach(function(xa){xa.sendPacket("StateSet",{sequence:ga,target:_i,requestUuid:"".concat(ga,"_").concat($.instanceId),value:JSON.stringify(pf(j,_n.majorRevision)),lock:"",lockRev:D.fromNumber(0),baseRevision:D.fromNumber(0),author:_n.enableRecordUserId?$.context.uid:"",flags:_n.enableRecordTs?new D(524289,0,!0):new D(1,0,!0)})}),bb.apply(void 0,[i.genTimeoutError(cd)].concat(ra(_s.map(function(xa){return xa.fromReceived("StateRequestResult").pipe(La(function(El){return ga.eq(El.sequence)}),Wa(function(El){var Tl,Sl,Il=ud(El=El.code);if($a("SyncOperateEvent",{lts:D.fromNumber(Date.now()),userid:$.context.uid,vid:D.fromString((Tl=$.context.vid)!==null&&Tl!==void 0?Tl:"0"),sid:"",usersid:$.context.sid,requestts:D.fromNumber(ba),replyts:D.fromNumber(Date.now()),target:_i,eventtype:"Set",revision:D.fromNumber(0),uuid:"".concat(ga,"_").concat($.instanceId),sdktype:3,flags:_n.enableRecordTs?new D(524289,0,!0):new D(1,0,!0),code:Il,seq:ga,index:{index1:$.context.uid,index2:$.context.appId,index3:"enableLogUpload=".concat($.context.config.enableLogUpload)},lock:"",lockrev:D.fromNumber(0),subtarget:$.context.uid},(Sl=$.context.config.enableCloudProxy)!==null&&Sl!==void 0&&Sl),Il!==bd)throw new Pa(["MetaData modify failure. The response code from the RTM service is %d",El],Il)}))}))))}},{key:"requestClearChannelMetadata",value:function(){var j=this,$=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{majorRevision:-1,enableRecordTs:!1,enableRecordUserId:!1},_n=1<arguments.length?arguments[1]:void 0,_i=this.getLoginSockets();if(_i.length===0)throw new ia("Client is not logged in");if($.majorRevision&&-1>$.majorRevision&&$.majorRevision%1==0)throw new ja("MajorRevision should be set to a value greater than  -1",Mb);if($.majorRevision===0)throw new ja("MajorRevision can not be set to 0",of);if(this.context.lastModifyMeteDataTime!==void 0&&250>Date.now()-this.context.lastModifyMeteDataTime)throw new Fc(["The frequency of metedata operation exceeded the limit of %d queries per %d second",20,5e3],Vc);this.context.lastModifyMeteDataTime=Date.now();var _s=this.incGetSeq(),ga=Date.now();return _i.forEach(function(ba){ba.sendPacket("StateSet",{sequence:_s,target:_n,requestUuid:"".concat(_s,"_").concat(j.instanceId),lock:"",lockRev:D.fromNumber(0),value:JSON.stringify({}),baseRevision:D.fromNumber(0),author:$.enableRecordUserId?j.context.uid:"",flags:$.enableRecordTs?new D(589825,0,!0):new D(65537,0,!0)})}),bb.apply(void 0,[i.genTimeoutError(cd)].concat(ra(_i.map(function(ba){return ba.fromReceived("StateRequestResult").pipe(La(function(xa){return _s.eq(xa.sequence)}),Wa(function(xa){var El,Tl,Sl=ud(xa=xa.code);if($a("SyncOperateEvent",{lts:D.fromNumber(Date.now()),userid:j.context.uid,vid:D.fromString((El=j.context.vid)!==null&&El!==void 0?El:"0"),sid:"",usersid:j.context.sid,requestts:D.fromNumber(ga),replyts:D.fromNumber(Date.now()),target:_n,eventtype:"Clear",revision:D.fromNumber(0),uuid:"".concat(_s,"_").concat(j.instanceId),sdktype:3,flags:$.enableRecordTs?new D(589825,0,!0):new D(65537,0,!0),code:Sl,seq:_s,index:{index1:j.context.uid,index2:j.context.appId,index3:"enableLogUpload=".concat(j.context.config.enableLogUpload)},lock:"",lockrev:D.fromNumber(0),subtarget:j.context.uid},(Tl=j.context.config.enableCloudProxy)!==null&&Tl!==void 0&&Tl),Sl!==bd)throw new Pa(["MetaData modify failure. The response code from the RTM service is %d",xa],Sl)}))}))))}},{key:"requestAddLocalMetadata",value:function(j){var $=this,_n=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{majorRevision:-1,enableRecordTs:!1,enableRecordUserId:!1},_i=this.getLoginSockets();if(_i.length===0)throw new ia("Client is not logged in");if(_n.majorRevision&&(-1>_n.majorRevision||_n.majorRevision%1!=0))throw new ja("MajorRevision should be set to a value greater than  -1",Mb);if(nf({items:j,maxMetaDataCount:32,maxMetaValueSize:16384,type:"Add"}),this.context.lastModifyMeteDataTime!==void 0&&250>Date.now()-this.context.lastModifyMeteDataTime)throw new Fc(["The frequency of metedata operation exceeded the limit of %d queries per %d second",20,5e3],Vc);this.context.lastModifyMeteDataTime=Date.now();var _s=this.incGetSeq(),ga=JSON.stringify(pf(Pd.cloneDeep(j).map(function(xa){return xa.setRevision(0),xa}),_n.majorRevision)),ba=Date.now();return _i.forEach(function(xa){xa.sendPacket("StateModify",{sequence:_s,target:$.context.uid,requestUuid:"".concat(_s,"_").concat($.instanceId),lock:"",lockRev:D.fromNumber(0),value:ga,baseRevision:D.fromNumber(0),author:_n.enableRecordUserId?$.context.uid:"",flags:_n.enableRecordTs?new D(524288,0,!0):D.fromNumber(0)})}),bb.apply(void 0,[i.genTimeoutError(cd)].concat(ra(_i.map(function(xa){return xa.fromReceived("StateRequestResult").pipe(La(function(El){return _s.eq(El.sequence)}),Ka(function(El){var Tl,Sl,Il=ud(El=El.code);if($a("SyncOperateEvent",{lts:D.fromNumber(Date.now()),userid:$.context.uid,vid:D.fromString((Tl=$.context.vid)!==null&&Tl!==void 0?Tl:"0"),sid:"",usersid:$.context.sid,requestts:D.fromNumber(ba),replyts:D.fromNumber(Date.now()),target:$.context.uid,eventtype:"Add",revision:D.fromNumber(0),uuid:"".concat(_s,"_").concat($.instanceId),sdktype:3,flags:_n.enableRecordTs?new D(524288,0,!0):D.fromNumber(0),code:Il,seq:_s,index:{index1:$.context.uid,index2:$.context.appId,index3:"enableLogUpload=".concat($.context.config.enableLogUpload)},lock:"",lockrev:D.fromNumber(0),subtarget:$.context.uid},(Sl=$.context.config.enableCloudProxy)!==null&&Sl!==void 0&&Sl),Il!==bd)throw new Pa(["MetaData modify failure. The response code from the RTM service is %d",El],Il)}))}))))}},{key:"requestUpdateLocalMetadata",value:function(j){var $=this,_n=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{majorRevision:-1,enableRecordTs:!1,enableRecordUserId:!1},_i=this.getLoginSockets();if(_i.length===0)throw new ia("Client is not logged in");if(_n.majorRevision&&(-1>_n.majorRevision||_n.majorRevision%1!=0))throw new ja("MajorRevision should be set to a value greater than  -1",Mb);if(_n.majorRevision===0)throw new ja("MajorRevision can not be set to 0",of);if(nf({items:j,maxMetaDataCount:32,maxMetaValueSize:16384,type:"Update"}),this.context.lastModifyMeteDataTime!==void 0&&250>Date.now()-this.context.lastModifyMeteDataTime)throw new Fc(["The frequency of metedata operation exceeded the limit of %d queries per %d second",20,5e3],Vc);this.context.lastModifyMeteDataTime=Date.now();var _s=this.incGetSeq(),ga=JSON.stringify(pf(Pd.cloneDeep(j).map(function(xa){return xa.getRevision()===-1&&xa.setRevision(-2),xa}),_n.majorRevision)),ba=Date.now();return _i.forEach(function(xa){xa.sendPacket("StateModify",{sequence:_s,target:$.context.uid,requestUuid:"".concat(_s,"_").concat($.instanceId),lock:"",lockRev:D.fromNumber(0),value:ga,baseRevision:D.fromNumber(0),author:_n.enableRecordUserId?$.context.uid:"",flags:_n.enableRecordTs?new D(524288,0,!0):D.fromNumber(0)})}),bb.apply(void 0,[i.genTimeoutError(cd)].concat(ra(_i.map(function(xa){return xa.fromReceived("StateRequestResult").pipe(La(function(El){return _s.eq(El.sequence)}),Ka(function(El){var Tl,Sl,Il=ud(El=El.code);if($a("SyncOperateEvent",{lts:D.fromNumber(Date.now()),userid:$.context.uid,vid:D.fromString((Tl=$.context.vid)!==null&&Tl!==void 0?Tl:"0"),sid:"",usersid:$.context.sid,requestts:D.fromNumber(ba),replyts:D.fromNumber(Date.now()),target:$.context.uid,eventtype:"Update",revision:D.fromNumber(0),uuid:"".concat(_s,"_").concat($.instanceId),sdktype:3,flags:_n.enableRecordTs?new D(524288,0,!0):D.fromNumber(0),code:Il,seq:_s,index:{index1:$.context.uid,index2:$.context.appId,index3:"enableLogUpload=".concat($.context.config.enableLogUpload)},lock:"",lockrev:D.fromNumber(0),subtarget:$.context.uid},(Sl=$.context.config.enableCloudProxy)!==null&&Sl!==void 0&&Sl),Il!==bd)throw new Pa(["MetaData modify failure. The response code from the RTM service is %d",El],Il)}))}))))}},{key:"requestDeleteLocalMetadata",value:function(j){var $=this,_n=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{majorRevision:-1,enableRecordTs:!1,enableRecordUserId:!1},_i=this.getLoginSockets();if(_i.length===0)throw new ia("Client is not logged in");if(_n.majorRevision&&(-1>_n.majorRevision||_n.majorRevision%1!=0))throw new ja("MajorRevision should be set to a value greater than  -1",Mb);if(_n.majorRevision===0)throw new ja("MajorRevision can not be set to 0",of);if(nf({items:j,maxMetaDataCount:32,maxMetaValueSize:16384,type:"Delete"}),this.context.lastModifyMeteDataTime!==void 0&&250>Date.now()-this.context.lastModifyMeteDataTime)throw new Fc(["The frequency of metedata operation exceeded the limit of %d queries per %d second",20,5e3],Vc);this.context.lastModifyMeteDataTime=Date.now();var _s=this.incGetSeq(),ga=JSON.stringify(pf(Pd.cloneDeep(j).map(function(xa){return xa.setValue(null),xa}),_n.majorRevision)),ba=Date.now();return _i.forEach(function(xa){xa.sendPacket("StateModify",{sequence:_s,target:$.context.uid,requestUuid:"".concat(_s,"_").concat($.instanceId),lock:"",lockRev:D.fromNumber(0),value:ga,baseRevision:D.fromNumber(0),author:_n.enableRecordUserId?$.context.uid:"",flags:_n.enableRecordTs?new D(524288,0,!0):D.fromNumber(0)})}),bb.apply(void 0,[i.genTimeoutError(cd)].concat(ra(_i.map(function(xa){return xa.fromReceived("StateRequestResult").pipe(La(function(El){return _s.eq(El.sequence)}),Ka(function(El){var Tl,Sl,Il=ud(El=El.code);if($a("SyncOperateEvent",{lts:D.fromNumber(Date.now()),userid:$.context.uid,vid:D.fromString((Tl=$.context.vid)!==null&&Tl!==void 0?Tl:"0"),sid:"",usersid:$.context.sid,requestts:D.fromNumber(ba),replyts:D.fromNumber(Date.now()),target:$.context.uid,eventtype:"Delete",revision:D.fromNumber(0),uuid:"".concat(_s,"_").concat($.instanceId),sdktype:3,flags:_n.enableRecordTs?new D(524288,0,!0):D.fromNumber(0),code:Il,seq:_s,index:{index1:$.context.uid,index2:$.context.appId,index3:"enableLogUpload=".concat($.context.config.enableLogUpload)},lock:"",lockrev:D.fromNumber(0),subtarget:$.context.uid},(Sl=$.context.config.enableCloudProxy)!==null&&Sl!==void 0&&Sl),Il!==bd)throw new Pa(["MetaData modify failure. The response code from the RTM service is %d",El],Il)}))}))))}},{key:"requestSetLocalMetadata",value:function(j){var $=this,_n=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{majorRevision:-1,enableRecordTs:!1,enableRecordUserId:!1},_i=this.getLoginSockets();if(_i.length===0)throw new ia("Client is not logged in");if(_n.majorRevision&&(-1>_n.majorRevision||_n.majorRevision%1!=0))throw new ja("MajorRevision should be set to a value greater than  -1",Mb);if(nf({items:j,maxMetaDataCount:32,maxMetaValueSize:16384,type:"Set"}),this.context.lastModifyMeteDataTime!==void 0&&250>Date.now()-this.context.lastModifyMeteDataTime)throw new Fc(["The frequency of metedata operation exceeded the limit of %d queries per %d second",20,5e3],Vc);this.context.lastModifyMeteDataTime=Date.now();var _s=this.incGetSeq(),ga=Date.now();return _i.forEach(function(ba){ba.sendPacket("StateSet",{sequence:_s,target:$.context.uid,requestUuid:"".concat(_s,"_").concat($.instanceId),value:JSON.stringify(pf(j,_n.majorRevision)),lock:"",lockRev:D.fromNumber(0),baseRevision:D.fromNumber(0),author:_n.enableRecordUserId?$.context.uid:"",flags:_n.enableRecordTs?new D(524288,0,!0):new D(0,0,!0)})}),bb.apply(void 0,[i.genTimeoutError(cd)].concat(ra(_i.map(function(ba){return ba.fromReceived("StateRequestResult").pipe(La(function(xa){return _s.eq(xa.sequence)}),Ka(function(xa){var El,Tl,Sl=ud(xa=xa.code);if($a("SyncOperateEvent",{lts:D.fromNumber(Date.now()),userid:$.context.uid,vid:D.fromString((El=$.context.vid)!==null&&El!==void 0?El:"0"),sid:"",usersid:$.context.sid,requestts:D.fromNumber(ga),replyts:D.fromNumber(Date.now()),target:$.context.uid,eventtype:"Set",revision:D.fromNumber(0),uuid:"".concat(_s,"_").concat($.instanceId),sdktype:3,flags:_n.enableRecordTs?new D(524288,0,!0):D.fromNumber(0),code:Sl,seq:_s,index:{index1:$.context.uid,index2:$.context.appId,index3:"enableLogUpload=".concat($.context.config.enableLogUpload)},lock:"",lockrev:D.fromNumber(0),subtarget:$.context.uid},(Tl=$.context.config.enableCloudProxy)!==null&&Tl!==void 0&&Tl),Sl!==bd)throw new Pa(["MetaData modify failure. The response code from the RTM service is %d",xa],Sl)}))}))))}},{key:"requestClearLocalMetadata",value:function(){var j=this,$=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{majorRevision:-1,enableRecordTs:!1,enableRecordUserId:!1},_n=this.getLoginSockets();if(_n.length===0)throw new ia("Client is not logged in");if($.majorRevision&&(-1>$.majorRevision||$.majorRevision%1!=0))throw new ja("MajorRevision should be set to a value greater than  -1",Mb);if($.majorRevision===0)throw new ja("MajorRevision can not be set to 0",of);if(this.context.lastModifyMeteDataTime!==void 0&&250>Date.now()-this.context.lastModifyMeteDataTime)throw new Fc(["The frequency of metedata operation exceeded the limit of %d queries per %d second",20,5e3],Vc);this.context.lastModifyMeteDataTime=Date.now();var _i=this.incGetSeq(),_s=Date.now();return _n.forEach(function(ga){ga.sendPacket("StateSet",{sequence:_i,target:j.context.uid,requestUuid:"".concat(_i,"_").concat(j.instanceId),lock:"",lockRev:D.fromNumber(0),value:JSON.stringify({}),baseRevision:D.fromNumber(0),author:$.enableRecordUserId?j.context.uid:"",flags:$.enableRecordTs?new D(589824,0,!0):new D(65536,0,!0)})}),bb.apply(void 0,[i.genTimeoutError(cd)].concat(ra(_n.map(function(ga){return ga.fromReceived("StateRequestResult").pipe(La(function(ba){return _i.eq(ba.sequence)}),Ka(function(ba){var xa,El,Tl=ud(ba=ba.code);if($a("SyncOperateEvent",{lts:D.fromNumber(Date.now()),userid:j.context.uid,vid:D.fromString((xa=j.context.vid)!==null&&xa!==void 0?xa:"0"),sid:"",usersid:j.context.sid,requestts:D.fromNumber(_s),replyts:D.fromNumber(Date.now()),target:j.context.uid,eventtype:"Clear",revision:D.fromNumber(0),uuid:"".concat(_i,"_").concat(j.instanceId),sdktype:3,flags:$.enableRecordTs?new D(524288,0,!0):D.fromNumber(0),code:Tl,seq:_i,index:{index1:j.context.uid,index2:j.context.appId,index3:"enableLogUpload=".concat(j.context.config.enableLogUpload)},lock:"",lockrev:D.fromNumber(0),subtarget:j.context.uid},(El=j.context.config.enableCloudProxy)!==null&&El!==void 0&&El),Tl!==bd)throw new Pa(["MetaData modify failure. The response code from the RTM service is %d",ba],Tl)}))}))))}},{key:"requestSubscribeUserMetadata",value:function(j,$){var _n=this,_i=this.getLoginSockets();if(_i.length===0)throw new ia("Client is not logged in");if(this.context.lastSubscribeMetaDataTime!==void 0&&500>Date.now()-this.context.lastSubscribeMetaDataTime)throw new Fc(["The frequency of subscription metedata exceeded the limit of %d queries per %d second",10,5e3],Vc);this.context.lastSubscribeMetaDataTime=Date.now();var _s=this.incGetSeq(),ga=Date.now();return _i.forEach(function(ba){ba.sendPacket("StateSubscribe",{sequence:_s,target:j,subTarget:"",flags:D.fromNumber(0)})}),bb.apply(void 0,[i.genTimeoutErrorWithoutNotice(cl,void 0,$)].concat(ra(_i.map(function(ba){return ba.fromReceived("StateSubscribeResult").pipe(La(function(xa){return _s.eq(xa.sequence)}),Ka(function(xa){var El,Tl;xa=xa.code;var Sl=Pw;if(xa!==0&&xa!==1&&(Sl=xa===100?cl:lp),Sl!==Pw)throw new Pa(["User metaData Subscribe failure. The response code from the RTM service is %d",xa],Sl);$!=="RECONNECTED"&&_n.lastUserMeteUpdateRecord[j]===void 0&&(_n.lastUserMeteUpdateRecord[j]=-1),$a("SyncSubscribeEvent",{lts:D.fromNumber(Date.now()),userid:_n.context.uid,vid:D.fromString((El=_n.context.vid)!==null&&El!==void 0?El:"0"),sid:"",usersid:_n.context.sid,target:j,requestts:D.fromNumber(ga),replyts:D.fromNumber(Date.now()),eventtype:"Subscribe",sdktype:3,flags:D.fromNumber(0),code:0,seq:_s,index:{index1:_n.context.uid,index2:_n.context.appId,index3:"enableLogUpload=".concat(_n.context.config.enableLogUpload)},subtarget:_n.context.uid},(Tl=_n.context.config.enableCloudProxy)!==null&&Tl!==void 0&&Tl)}))}))))}},{key:"requestUnsubscribeUserMetadata",value:function(j){var $,_n,_i=this.getLoginSockets();if(_i.length===0)throw new ia("Client is not logged in");var _s=this.incGetSeq(),ga=Date.now();_i.forEach(function(ba){ba.sendPacket("StateUnsubscribe",{sequence:_s,target:j,subTarget:"",flags:D.fromNumber(0)})}),delete this.lastUserMeteUpdateRecord[j],$a("SyncSubscribeEvent",{lts:D.fromNumber(Date.now()),userid:this.context.uid,vid:D.fromString(($=this.context.vid)!==null&&$!==void 0?$:"0"),sid:"",usersid:this.context.sid,target:j,requestts:D.fromNumber(ga),replyts:D.fromNumber(Date.now()),eventtype:"UnSubscribe",sdktype:3,flags:D.fromNumber(0),code:0,seq:_s,index:{index1:this.context.uid,index2:this.context.appId,index3:"enableLogUpload=".concat(this.context.config.enableLogUpload)},subtarget:this.context.uid},(_n=this.context.config.enableCloudProxy)!==null&&_n!==void 0&&_n)}},{key:"requestUnsubscribeChannelMetadata",value:function(j){var $,_n,_i=this.getLoginSockets();if(_i.length===0)throw new ia("Client is not logged in");var _s=this.incGetSeq();_i.forEach(function(ga){ga.sendPacket("StateUnsubscribe",{sequence:_s,target:j,subTarget:"",flags:new D(1,0,!0)})}),delete this.lastChannelMetaUpdateRecord[j],$a("SyncSubscribeEvent",{lts:D.fromNumber(Date.now()),userid:this.context.uid,vid:D.fromString(($=this.context.vid)!==null&&$!==void 0?$:"0"),sid:"",usersid:this.context.sid,target:j,requestts:D.fromNumber(Date.now()),replyts:D.fromNumber(Date.now()),eventtype:"UnSubscribe",sdktype:3,flags:new D(1,0,!0),code:0,seq:_s,index:{index1:this.context.uid,index2:this.context.appId,index3:"enableLogUpload=".concat(this.context.config.enableLogUpload)},subtarget:this.context.uid},(_n=this.context.config.enableCloudProxy)!==null&&_n!==void 0&&_n)}},{key:"requestSubscribeChannelMetadata",value:function(j,$){var _n=this,_i=this.getLoginSockets();if(_i.length===0)throw new ia("Client is not logged in");if(this.context.lastSubscribeMetaDataTime!==void 0&&500>Date.now()-this.context.lastSubscribeMetaDataTime)throw new Fc(["The frequency of subscription metedata exceeded the limit of %d queries per %d second",10,5e3],Vc);var _s=this.incGetSeq(),ga=Date.now();return _i.forEach(function(ba){ba.sendPacket("StateSubscribe",{sequence:_s,target:j,subTarget:"",flags:new D(1,0,!0)})}),bb.apply(void 0,[i.genTimeoutError(cl)].concat(ra(_i.map(function(ba){return ba.fromReceived("StateSubscribeResult").pipe(La(function(xa){return _s.eq(xa.sequence)}),Ka(function(xa){var El,Tl;if((xa=xa.code)!==0&&xa!==1)throw xa===100?new Pa(["MetaData Subscribe failure. The response code from the RTM service is %d",xa],cl):new Pa(["MetaData Subscribe failure. The response code from the RTM service is %d",xa],lp);$==="JOIN"&&(_n.lastChannelMetaUpdateRecord[j]=-1),$a("SyncSubscribeEvent",{lts:D.fromNumber(Date.now()),userid:_n.context.uid,vid:D.fromString((El=_n.context.vid)!==null&&El!==void 0?El:"0"),sid:"",usersid:_n.context.sid,target:j,requestts:D.fromNumber(ga),replyts:D.fromNumber(Date.now()),eventtype:"Subscribe",sdktype:3,flags:D.fromNumber(0),code:xa,seq:_s,index:{index1:_n.context.uid,index2:_n.context.appId,index3:"enableLogUpload=".concat(_n.context.config.enableLogUpload)},subtarget:_n.context.uid},(Tl=_n.context.config.enableCloudProxy)!==null&&Tl!==void 0&&Tl)}))}))))}},{key:"requestGetUserAttributesByKeys",value:function(j,$){var _n=this.getLoginSockets();if(_n.length===0)throw new ia("Client is not logged in");var _i=this.incGetSeq();return _n.forEach(function(_s){_s.sendPacket("UserAttributeGet",{account:j,seq:_i,attributes:$})}),bb.apply(void 0,[i.genTimeoutError(Bd)].concat(ra(_n.map(function(_s){return _s.fromReceived("UserAttributeErr").pipe(La(function(ga){return _i.eq(ga.seq)}),Wa(function(ga){throw(ga=ga.code)===10008?new Pa("The user requested is not online",qw):new id(["User attribute operation unknown error code: %d",ga],Ad)}))})),ra(_n.map(function(_s){return _s.fromReceived("UserAttributeRet").pipe(La(function(ga){return _i.eq(ga.seq)}))}))))}},{key:"requestGetChannelAttributesByKeys",value:function(j,$){var _n=this.getLoginSockets();if(_n.length===0)throw new ia("Client is not logged in");var _i=this.incGetSeq();return _n.forEach(function(_s){_s.sendPacket("GroupAttributeGet",{group:j,seq:_i,attributes:$})}),bb.apply(void 0,[i.genTimeoutError(Bd)].concat(ra(_n.map(function(_s){return _s.fromReceived("GroupAttributeErr").pipe(La(function(ga){return _i.eq(ga.seq)}),Wa(function(ga){throw new Pa(["The channel attributes get failure, code %d",ga.code],Ad)}))})),ra(_n.map(function(_s){return _s.fromReceived("GroupAttributeRet").pipe(La(function(ga){return _i.eq(ga.seq)}))}))))}},{key:"requestGetUserAttributeKeys",value:function(j){var $=this.getLoginSockets();if($.length===0)throw new ia("Client is not logged in");var _n=this.incGetSeq();return $.forEach(function(_i){_i.sendPacket("UserAttributeKeysGet",{account:j,seq:_n})}),bb.apply(void 0,[i.genTimeoutError(Bd)].concat(ra($.map(function(_i){return _i.fromReceived("UserAttributeErr").pipe(La(function(_s){return _n.eq(_s.seq)}),Wa(function(_s){throw(_s=_s.code)===10008?new Pa("The user requested is not online",qw):new id(["User attribute operation unknown error code: %d",_s],Ad)}))})),ra($.map(function(_i){return _i.fromReceived("UserAttributeKeysRet").pipe(La(function(_s){return _n.eq(_s.seq)}))}))))}},{key:"requestGetChannelAttributesKeys",value:function(j){var $=this.getLoginSockets();if($.length===0)throw new ia("Client is not logged in");var _n=this.incGetSeq();return $.forEach(function(_i){_i.sendPacket("GroupAttributeKeysGet",{group:j,seq:_n})}),bb.apply(void 0,[i.genTimeoutError(Bd)].concat(ra($.map(function(_i){return _i.fromReceived("GroupAttributeErr").pipe(La(function(_s){return _n.eq(_s.seq)}),Wa(function(_s){throw new id(["Channel attribute operation unknown error code: %d",_s.code],Ad)}))})),ra($.map(function(_i){return _i.fromReceived("GroupAttributeKeysRet").pipe(La(function(_s){return _n.eq(_s.seq)}))}))))}},{key:"requestGetChannelMemberCount",value:function(j){var $=this.getLoginSockets();if($.length===0)throw new ia("Client is not logged in");var _n=this.incGetSeq();return $.forEach(function(_i){_i.sendPacket("GroupStatusList",{groups:j,seq:_n})}),bb.apply(void 0,[i.genTimeoutError(uw)].concat(ra($.map(function(_i){return _i.fromReceived("GroupStatusResult").pipe(La(function(_s){return _n.eq(_s.seq)}))}))))}},{key:"requestSubscribePeersOnlineStatus",value:function(j){var $=this.getLoginSockets();if($.length===0)throw new ia("Client is not logged in");var _n=this.incGetSeq();return $.forEach(function(_i){_i.sendPacket("SubscribeUserStatus",{seq:_n,users:j})}),bb.apply(void 0,[i.genTimeoutError(NI)].concat(ra($.map(function(_i){return _i.fromReceived("SubscribeResponse").pipe(La(function(_s){return _n.eq(_s.seq)}))}))))}},{key:"requestUnsubscribePeersOnlineStatus",value:function(j){var $=this.getLoginSockets();if($.length===0)throw new ia("Client is not logged in");var _n=this.incGetSeq();$.forEach(function(_i){_i.sendPacket("UnsubscribeUserStatus",{seq:_n,users:j})})}},{key:"sendInvitationMessage",value:function(){var j=za(W.mark(function $(_n){var _i,_s,ga,ba,xa,El,Tl,Sl,Il,Cl,Nl,Dl,Ul=this;return W.wrap(function(Kl){for(;;)switch(Kl.prev=Kl.next){case 0:if(_i=_n.peerId,_s=_n.callId,ga=_n.extra,ba=_n.isAcceptAck,xa=_n.channelId,El=_n.type,Tl={callId:_s},ba===void 0){Kl.next=6;break}if(El==="CallAccept"){Kl.next=5;break}throw Error("invalid invitation type");case 5:Tl.type=ba?"ack":"request";case 6:return Tl.channel=xa,(El==="CallInvite"||El==="CallCancel"||El==="CallReject"||El==="CallAccept"&&ba===!1)&&ga!==void 0&&(Tl.extra=ga),Sl=Rj(),this.log("The sent invitation body is %o",Tl),Il=function(Jl){return{MiscMap:{},sequence:D.fromNumber(1),dialogue:Sl,instance:Ul.instanceId,dst:_i,ms:D.fromNumber(Date.now(),!0),options:new Yh({IterationNumber:Jl,MessageType:El}).toLong(),payload:new TextEncoder().encode(JSON.stringify(Tl)),src:Ul.context.uid}},Kl.next=14,ge(this.sendMessageToRetry(Il,!0)).pipe(Oc(1e4),Rb(function(Jl){return Jl instanceof ad&&Ul.warn("Send invitation timeout"),Va(Jl)})).toPromise();case 14:return Cl=Kl.sent,Nl=Cl.code,Dl=Cl.retryTimes,Kl.abrupt("return",{hasPeerReceived:Nl===0,hasReSent:Dl!==0});case 18:case"end":return Kl.stop()}},$,this)}));return function($){return j.apply(this,arguments)}}()},{key:"sendRawMessage",value:function(){var j=za(W.mark(function $(_n,_i,_s,ga,ba){var xa,El,Tl,Sl,Il,Cl,Nl,Dl,Ul,Kl,Jl,Ep=this;return W.wrap(function(_p){for(;;)switch(_p.prev=_p.next){case 0:if(xa=Date.now(),El=ga?vb.P2pRMsgNoOfflineFlag:vb.ChannelRMsg,yb(_s)&&_n instanceof Uint8Array&&typeof _i=="string"){_p.next=4;break}throw new ja("The send message arguments are not valid",ga?Kw:Zk);case 4:if(!(32768<_n.byteLength+new Blob([_i]).size)){_p.next=8;break}throw this.emit("messageCount",{messageCategory:El,type:"common",key:"sentcount"}),this.emit("messageCount",{messageCategory:El,type:"common",key:"invalidmessagecount"}),new Dc("The message size is over the 32KB limit",ga?si:fp);case 8:return Tl=!wg.getParameter("DISABLE_MESSAGE_COMPRESSION")&&128<=_n.byteLength,Sl=this.chatManager.getChatInfo(_s),Il=Sl.dialogue,Cl=Sl.sequence,Nl=this.instanceId,this.log('A%s %s raw message is sending to %s: "'.concat(Nl,"-").concat(Il,"#").concat(Cl,'"'),Tl?" compressed":"",ga?"peer":"channel",wb(_s)),Dl=function(Ip){return{MiscMap:{description:new TextEncoder().encode(_i)},sequence:Cl,dialogue:Il,instance:Nl,dst:_s,ms:D.fromNumber(Date.now(),!0),options:new Yh({IterationNumber:Ip,CompressionMethod:Tl?"Zlib":"Uncompressed",MessageType:ga?"PeerRawMessage":"ChannelRawMessage",ToCache:!1,ToArchive:!1}).toLong(),payload:Tl?DA(_n):_n,src:Ep.context.uid}},_p.next=15,ge(this.sendMessageToRetry(Dl,!0)).pipe(Oc(ba===void 0?1e4:ba),Rb(function(Ip){return Ip instanceof ad&&Ep.warn("Send message timeout"),Va(Ip)})).toPromise();case 15:return Ul=_p.sent,Kl=Ul.code,Jl=Kl===0,this.emit("messageCount",{messageCategory:El,type:"common",key:"sentcount"}),Jl&&(this.emit("messageCount",{messageCategory:El,type:"common",key:"successcount"}),this.emit("messageCount",{messageCategory:El,type:ga?"peer":"recipient",delay:Nb(xa).toNumber()})),_p.abrupt("return",{hasPeerReceived:Jl});case 21:case"end":return _p.stop()}},$,this)}));return function($,_n,_i,_s,ga){return j.apply(this,arguments)}}()},{key:"sendTextMessage",value:function(){var j=za(W.mark(function $(_n,_i,_s,ga){var ba,xa,El,Tl,Sl,Il,Cl,Nl,Dl,Ul,Kl,Jl,Ep=this;return W.wrap(function(_p){for(;;)switch(_p.prev=_p.next){case 0:if(ba=Date.now(),xa=_s?vb.P2pSMsgNoOfflineFlag:vb.ChannelSMsg,yb(_i)){_p.next=4;break}throw new ja("The send message arguments are not valid",_s?Kw:Zk);case 4:if(!(32768<new Blob([_n]).size)){_p.next=8;break}throw this.emit("messageCount",{messageCategory:xa,type:"common",key:"sentcount"}),this.emit("messageCount",{messageCategory:xa,type:"common",key:"invalidmessagecount"}),new Dc("The message size is over the 32KB limit",_s?si:fp);case 8:return El=!wg.getParameter("DISABLE_MESSAGE_COMPRESSION")&&128<=new Blob([_n]).size,Tl=this.chatManager.getChatInfo(_i),Sl=Tl.dialogue,Il=Tl.sequence,Cl=this.instanceId,this.log('A%s %s message is sending to %s: "'.concat(Cl,"-").concat(Sl,"#").concat(Il,'"'),El?" compressed":"",_s?"peer":"channel",wb(_i)),Nl=new TextEncoder().encode(_n),Dl=function(Ip){return{MiscMap:{},sequence:Il,dialogue:Sl,instance:Cl,dst:_i,ms:D.fromNumber(Date.now(),!0),options:new Yh({IterationNumber:Ip,CompressionMethod:El?"Zlib":"Uncompressed",MessageType:_s?"PeerTextMessage":"ChannelTextMessage",ToCache:!1,ToArchive:!1}).toLong(),payload:El?DA(Nl):Nl,src:Ep.context.uid}},_p.next=16,ge(this.sendMessageToRetry(Dl,!0)).pipe(Oc(ga===void 0?1e4:ga),Rb(function(Ip){return Ip instanceof ad&&(Ep.emit("messageCount",{messageCategory:xa,type:"common",key:"sentcount"}),Ep.emit("messageCount",{messageCategory:xa,type:"common",key:"timeoutcount"}),Ep.warn("Send message timeout")),Va(Ip)})).toPromise();case 16:return Ul=_p.sent,Kl=Ul.code,Jl=Kl===0,this.emit("messageCount",{messageCategory:xa,type:"common",key:"sentcount"}),Jl&&(this.emit("messageCount",{messageCategory:xa,type:"common",key:"successcount"}),this.emit("messageCount",{messageCategory:xa,type:_s?"peer":"recipient",delay:Nb(ba).toNumber()})),_p.abrupt("return",{hasPeerReceived:Jl});case 22:case"end":return _p.stop()}},$,this)}));return function($,_n,_i,_s){return j.apply(this,arguments)}}()},{key:"cleanLoginSubs",value:function(j,$){Object.entries(this.loginSocketSubs[j]).forEach(function(_n){var _i=(_n=Lb(_n,2))[1];_n[0]==="channels"&&$||(Array.isArray(_i)||_i instanceof Map?_i.forEach(function(_s){return _s.unsubscribe()}):_i&&_i.unsubscribe())}),this.loginSocketSubs[j]={channels:$?this.loginSocketSubs[j].channels:new Map,receivers:[]}}},{key:"sendMessageToRetry",value:function(){var j=za(W.mark(function $(_n,_i){var _s,ga,ba,xa,El,Tl,Sl,Il,Cl,Nl=this,Dl=arguments;return W.wrap(function(Ul){for(;;)switch(Ul.prev=Ul.next){case 0:if(_s=2<Dl.length&&Dl[2]!==void 0?Dl[2]:0,this.log("Attempt to send the message ".concat(_i?" with retrying, %o":"without retrying"),{retryTimes:_s}),(ga=this.getLoginSockets()).length!==0){Ul.next=5;break}throw Error("no logged-in sockets");case 5:return ba=_n(_s),ga.forEach(function(Kl){Kl.sendPacket("Message",ba)}),xa=ba.dialogue,El=ba.sequence,Tl=ba.instance,Sl=ga.map(function(Kl){return Kl.fromReceived("Ack").pipe(sc(function(Jl){return xa.eq(Jl.dialogue)&&El.eq(Jl.sequence)&&Tl.eq(Jl.instance)}))}),Ul.prev=9,Ul.next=12,Nc.apply(void 0,ra(Sl)).pipe(Oc(6e3),Rb(function(Kl){return uc(Kl)&&Nl.warn("Message send timeout, retry times %d",_s),Va(Kl)}),Xb(1)).toPromise();case 12:return Il=Ul.sent,Cl=Il.code,this.log("The message has been acked, %o",{code:Cl}),Ul.abrupt("return",{code:Cl,retryTimes:_s});case 18:if(Ul.prev=18,Ul.t0=Ul.catch(9),!(Ul.t0 instanceof ad&&_i)){Ul.next=22;break}return Ul.abrupt("return",this.sendMessageToRetry(_n,!1,_s+1));case 22:throw Ul.t0;case 23:case"end":return Ul.stop()}},$,this,[[9,18]])}));return function($,_n){return j.apply(this,arguments)}}()},{key:"initKeepAliveSender",value:function(){var j=this;this.lastLoginSockets.map(function($){return $.pipe(Cc(function(_n){return Fe(0,2500,Kg()?void 0:CP).pipe(Ka(function(){j.sendPing(_n)}))}))}).forEach(function($,_n){var _i=j.loginSocketSubs[_n].keepAlive;_i!==void 0&&_i.unsubscribe(),j.loginSocketSubs[_n].keepAlive=$.subscribe({error:function(){}})})}},{key:"initKeepAliveReconnector",value:function(){var j=this;this.lastLoginSockets.map(function($){return $.pipe(Cc(function(_n){var _i,_s=!1,ga=_n.userJoin$.pipe(Ka(function(){_s=!0})),ba=_n.input$.pipe(Ka(function(xa){Tm[xa.uri].slice(0,-3)!=="Ping"&&(_s=!1)}));return Nc(Fe(6e3,1e4).pipe(iC(_n.receivedPacket),Ka(function(xa){xa=Lb(xa,2),xa=Lb(xa[1],2)[1],_i!==xa||_s||_n.forceReconnect(),_i=xa})),ga,ba)}))}).forEach(function($,_n){var _i=j.loginSocketSubs[_n].keepAliveReconnector;_i!==void 0&&_i.unsubscribe(),j.loginSocketSubs[_n].keepAliveReconnector=$.subscribe({error:function(){}})})}},{key:"initLoginReceiver",value:function(){var j=this;bb.apply(void 0,ra(this.lastLoginSockets.map(function(_i){return _i.pipe(Cc(function(_s){return _s.fromReceived("UserTicketNearlyExpire").pipe(cC(5e3),Ka(j.onUserTicketNearlyExpire(_s)))}))}))).subscribe(),bb.apply(void 0,ra(this.lastLoginSockets.map(function(_i){return _i.pipe(Cc(function(_s){return _s.fromReceived("StateUpdate").pipe(Ka(j.onStateUpdate()))}))}))).subscribe();var $=Bc(this,"messageCount"),_n=$.pipe(sc(function(_i){return _i.messageCategory===vb.ChannelSMsg}));_n.subscribe(function(_i){return j.updateMessageCount(_i)}),_n.pipe(Kj(6e3)).subscribe(function(_i){_i.length&&j.chanelStringMessageReport.report()}),Nc(Wb(void 0),_n).pipe(Cc(function(){return Yg(36e5)})).subscribe(function(){j.chanelStringMessageReport.report()}),(_n=$.pipe(sc(function(_i){return _i.messageCategory===vb.ChannelRMsg}))).subscribe(function(_i){return j.updateMessageCount(_i)}),_n.pipe(Kj(6e3)).subscribe(function(_i){_i.length&&j.chanelRawMessageReport.report()}),Nc(Wb(void 0),_n).pipe(Cc(function(){return Yg(36e5)})).subscribe(function(){j.chanelRawMessageReport.report()}),(_n=$.pipe(sc(function(_i){return _i.messageCategory===vb.P2pSMsgNoOfflineFlag}))).subscribe(function(_i){return j.updateMessageCount(_i)}),_n.pipe(Kj(6e3)).subscribe(function(_i){_i.length&&j.p2pSMsgNoOfflineReport.report()}),Nc(Wb(void 0),_n).pipe(Cc(function(){return Yg(36e5)})).subscribe(function(){j.p2pSMsgNoOfflineReport.report()}),($=$.pipe(sc(function(_i){return _i.messageCategory===vb.P2pRMsgNoOfflineFlag}))).subscribe(function(_i){return j.updateMessageCount(_i)}),$.pipe(Kj(6e3)).subscribe(function(_i){_i.length&&j.p2pRMsgNoOfflineReport.report()}),Nc(Wb(void 0),$).pipe(Cc(function(){return Yg(36e5)})).subscribe(function(){j.p2pSMsgNoOfflineReport.report()}),this.lastLoginSockets.map(function(_i){return _i.pipe(Cc(function(_s){return Nc(Bc(_s,"reconnect").pipe(Ka(j.onSocketReconnect(_s))),_s.fromReceived("Message").pipe(Ka(j.onMessage(_s))),_s.fromReceived("GroupEnterNotice").pipe(Ka(j.onGroupEnterNotice())),_s.fromReceived("GroupLeaveNotice").pipe(Ka(j.onGroupLeaveNotice())),_s.fromReceived("GroupCountNotice").pipe(Ka(j.onGroupCountNotice())),_s.fromReceived("GroupAttributeAlt").pipe(Ka(j.onGroupAttributeAlt())),_s.fromReceived("UserJoinNotice").pipe(Ka(j.onUserNotice(Oa.PeerOnlineState.ONLINE))),_s.fromReceived("UserQuitNotice").pipe(Ka(j.onUserNotice(Oa.PeerOnlineState.OFFLINE))),_s.fromReceived("UserWaitNotice").pipe(Ka(j.onUserNotice(Oa.PeerOnlineState.UNREACHABLE))),_s.fromReceived("Pong").pipe(Ka(j.onPong())),_s.fromReceived("UserDrop").pipe(Ka(j.onUserDrop(_s))),_s.fromReceived("GroupDrop").pipe(Ka(j.onGroupDrop()))).pipe(ni(void 0))}))}).forEach(function(_i,_s){j.loginSocketSubs[_s].receivers.push(_i.subscribe({error:function(){}}))})}},{key:"requestSocketLogin",value:function(j,$,_n){var _i=this;return Pr(lf(function(){_i.userJoinOptions=new Pz($),j.sendPacket("UserJoin",{account:_i.context.uid,instance:_i.instanceId,opt:_i.userJoinOptions.toLong(),seq:_n,ticket:j.ticket})}),j.fromReceived("UserResp").pipe(La(function(_s){return _n.eq(_s.seq)}),Ka(function(_s){if((_s=_s.code)!==0)throw _i.clearSockets(),_i.logError("Connected to gateway success but the Rtm server rejected login"),new Pa(["Login failure. The response code from the RTM service is %d",_s],ij);j.attemptsSinceLastError=0,j.loggedIn=!0,_i.log("ENV_%d logged in",j.env)}),ni(j),Oc(6e3))).pipe(sc(function(_s){return _s!==void 0}),Rb(function(_s){_s instanceof ad&&_i.warn("Login response timeout, rejoin: %s",$);var ga=_i.getLoginSockets();if(0<ga.length){var ba=ga.map(function(xa){return xa.env});[0,1].filter(function(xa){return!ba.includes(xa)}).forEach(function(xa){_i.cleanLoginSubs(xa,!1),_i.connection.closeSocket(xa,0)})}return _s.name="loginRespTimeout",_i.emit("banEdgeIP",j.ip),Va(_s)}))}},{key:"getSocketLoginObservables",value:function(j,$){var _n=this;return j.map(function(_i){return _i.pipe(Cc(function(_s,ga){return _n.incSeqIfNeeded(_s.env),_n.requestSocketLogin(_s,ga!==0,ga===0?$:_n.seq)}),$g())})}},{key:"incSeqIfNeeded",value:function(j){if(![0,1].includes(j))throw new rb({INVALID_ENV:"The env argument is not 0 or 1"});this.seqSentStatuses[j]&&(this.seq=this.seq.add(1),this.seqSentStatuses=[!1,!1]),this.seqSentStatuses[j]=!0}},{key:"incGetSeq",value:function(){return this.seq=this.seq.add(1),this.seqSentStatuses=[!0,!0],this.seq}},{key:"getLoginSockets",value:function(){for(var j=this.curLoginSockets,$=-1,_n=j==null?0:j.length,_i=0,_s=[];++$<_n;){var ga=j[$];ga&&(_s[_i++]=ga)}return _s}},{key:"emitMessage",value:function(j,$){var _n,_i=j.options,_s=j.payload,ga=j.src,ba=j.dst,xa=j.instance,El=j.dialogue,Tl=j.sequence,Sl=j.ms,Il=j.MiscMap;this.dialogueSequenceLru.set(El.toString(),Tl),xa="".concat(xa,"-").concat(El,"#").concat(Tl),this.msgDedupLru.has(xa)?this.warn("Env_%d: Messages out-of-order or not start with 1: %s",$,xa):(this.msgDedupLru.set(xa,void 0),_i=new Yh(_i),this.lastLoginSockets.forEach((_n=za(W.mark(function Cl(Nl){var Dl;return W.wrap(function(Ul){for(;;)switch(Ul.prev=Ul.next){case 0:return Ul.next=2,Nl.pipe(Xb(1)).toPromise();case 2:Dl=Ul.sent,i.sendMessageAck(j,Dl);case 4:case"end":return Ul.stop()}},Cl)})),function(Cl){return _n.apply(this,arguments)})),$=_i.isZlibCompressed(),_i.isInvitation()?(ba=ti($?Oq(zs(_s,Uint8Array.of(0,0,0,0))):_s),ba=JSON.parse(ba),this.log("The received invitation body is %o",ba),this.emit("invitationMessage",{body:ba,type:_i.getInvitationType(),peerId:ga,serverReceivedTs:Sl.toNumber()})):_i.isTextMessage()?(Il=_i.isPeerTextMessage(),_s=ti($?Oq(zs(_s,Uint8Array.of(0,0,0,0))):_s),this.info("Received a %s %s text message from %s to %s, %s",$?" compressed":"",Il?"peer":"channel",wb(ga),wb(ba),xa),Il?(ga={text:_s,peerId:ga,properties:{serverReceivedTs:Sl.toNumber()}},this.emit("peerTextMessage",ga),this.emit("messageCount",{messageCategory:vb.P2pSMsgNoOfflineFlag,type:"common",key:"receivedcount"})):(this.emit("channelTextMessage",{channelId:ba,memberId:ga,text:_s,properties:{serverReceivedTs:Sl.toNumber()}}),this.emit("messageCount",{messageCategory:vb.ChannelSMsg,type:"common",key:"receivedcount"}))):_i.isRawMessage()&&(_i=_i.isRawPeerMessage(),Il=(Il=Il.description)===void 0?"":ti(Il),_s=$?Oq(_s):_s,this.info("Received a %s %s raw message from %s to %s, %s",$?" compressed":"",_i?"peer":"channel",wb(ga),wb(ba),xa),_i?(ga={desc:Il,raw:_s,peerId:ga,properties:{serverReceivedTs:Sl.toNumber()}},this.emit("peerRawMessage",ga),this.emit("messageCount",{messageCategory:vb.P2pRMsgNoOfflineFlag,type:"common",key:"receivedcount"})):(this.emit("channelRawMessage",{desc:Il,raw:_s,channelId:ba,memberId:ga,properties:{serverReceivedTs:Sl.toNumber()}}),this.emit("messageCount",{messageCategory:vb.ChannelRMsg,type:"common",key:"receivedcount"}))))}},{key:"onSocketReconnect",value:function(j){var $=this;return function(){var _n=[0,1].filter(function(_i){return _i!==j.env})[0];(_n=$.connection.curOpenSockets[_n])&&!_n.loggedIn&&$.emit("connectionLost")}}},{key:"onUserTicketNearlyExpire",value:function(j){var $=this;return function(_n){(_n=_n.ticket)!==$.lastNoticeTicket&&_n===j.ticket?($.lastNoticeTicket=_n,$.emit("tokenPrivilegeWillExpire")):$.requestUpdateEdgeTicket(j.ticket).toPromise()}}},{key:"onGroupDrop",value:function(){var j=this;return function($){var _n,_i=$.account;$a("ChnLeave",{cname:_i,lts:D.fromNumber(Date.now()),elapse:Nb(j.startTime),errCode:EI,sid:fc(j.instanceId),userId:j.context.uid},(_n=j.context.config.enableCloudProxy)!==null&&_n!==void 0&&_n),[0,1].forEach(function(_s){return j.loginSocketSubs[_s].channels.delete(_i)}),j.logError("the user is kicked out of the current channel")}}},{key:"onStateUpdate",value:function(){var j=this;return function($){var _n=$.flags,_i=$.target;$=Wm($.allStates),_n.and(new D(1,0,!0)).isZero()?j.lastUserMeteUpdateRecord[_i]!==void 0&&$.majorRevision>j.lastUserMeteUpdateRecord[_i]&&(j.emit("userMetaDataUpdated",{uid:_i,data:_n.and(new D(0,2,!0)).isZero()?$:tb(tb({},$),{},{majorRevision:0})}),j.lastUserMeteUpdateRecord[_i]=$.majorRevision):j.lastChannelMetaUpdateRecord[_i]!==void 0&&$.majorRevision>j.lastChannelMetaUpdateRecord[_i]&&(j.emit("channelMetaDataUpdated",{channelId:_i,data:_n.and(new D(0,2,!0)).isZero()?$:tb(tb({},$),{},{majorRevision:0})}),j.lastChannelMetaUpdateRecord[_i]=$.majorRevision)}}},{key:"onUserDrop",value:function(j){var $=this;return function(_n){var _i;_n=_n.code,$a("KickedOff",{code:0,elapse:Nb($.startTime),linkId:parseInt(j.name.split("-")[1],10),lts:D.fromNumber(Date.now()),server:j.address,serverCode:_n,sid:fc($.instanceId),userId:$.context.uid},(_i=$.context.config.enableCloudProxy)!==null&&_i!==void 0&&_i),_n===10006||_n===10001?$.warn("Login too often and kicked off, reconnect and login"):_n===10009?($.warn("The instance ID conflicts, reconnecting"),$.instanceId=Rj(),$.context.sid=fc($.instanceId),$.emit("instanceChanged",$.instanceId)):[2,11,14,15,16,10019].includes(_n)&&($.emit("userDrop",_n),$.clearSockets())}}},{key:"clearSockets",value:function(){var j=this,$=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0,_n=1<arguments.length&&arguments[1]!==void 0&&arguments[1];[0,1].forEach(function(_i){j.cleanLoginSubs(_i,_n),j.connection.closeSocket(_i,$)})}},{key:"onMessage",value:function(j){var $=this;return function(_n){var _i=_n.dialogue,_s=_n.instance,ga=_n.sequence,ba=_n.options;if(_n.src===$.context.uid)$.log("The message is from the local account, ignored");else{var xa=_i.toString(),El=$.dialPendingMsgSubjectMap.get(xa);if(_i="".concat(_s,"-").concat(_i,"#").concat(ga),El)El.next(_n),$.log("Env_%d: The dialogue has pending messages, next: %s",j.env,_i);else{var Tl=$.dialogueSequenceLru.get(xa);if(El=!Tl&&ga.eq(1),_s=Tl!==void 0&&ga.sub(Tl).eq(1),El||_s)$.emitMessage(_n,j.env);else{if(Tl){if(ga.lte(Tl))return;$.log("Env_%d: The message pended, the sequence is not continuous with the last: %s",j.env,_i)}else $.log("Env_%d: The message pended, the first sequence is not equal to 1: %s",j.env,_i);ga=new ec,$.dialPendingMsgSubjectMap.set(xa,ga);var Sl=ga.pipe(kB(Xo),Nj(function(Il,Cl){return[].concat(ra(Il),[Cl])},[]),Wa(function(Il){return ra(Il).sort(function(Cl,Nl){return Cl=Cl.sequence,Nl=Nl.sequence,Cl.eq(Nl)?0:Cl.gt(Nl)?1:-1})}),Yr(1));ba=!(ba=new Yh(ba)).isFromCache()&&!ba.isBufferedMessage(),Sl.pipe(he(Fe(ba?750:1500)),La(function(Il){if(2>Il.length)return!1;for(var Cl=Tl===void 0?D.fromNumber(1,!0):Tl.add(1),Nl=0;Nl<Il.length;Cl=Cl.add(1),Nl++)if(!Il[Nl].sequence.eq(Cl))return!1;return!0}),Mj(function(){$.dialPendingMsgSubjectMap.delete(xa)})).subscribe(function(Il){Il.forEach(function(Cl){$.emitMessage(Cl,j.env),$.log("Env_%d: The message queue has fully ordered, emitting: %s",j.env,"".concat(Cl.instance,"-").concat(Cl.dialogue,"#").concat(Cl.sequence))})},function(Il){Il instanceof Lj&&Sl.pipe(Xb(1)).subscribe(function(Cl){return Cl.forEach(function(Nl){$.log("Env_%d: The message pending queue expired, emitting: %s",j.env,"".concat(Nl.instance,"-").concat(Nl.dialogue,"#").concat(Nl.sequence)),$.emitMessage(Nl,j.env)})})}),ga.next(_n)}}}}}},{key:"onPong",value:function(){var j=this;return function(){document.hidden&&j.getLoginSockets().forEach(function($){j.sendPing($)})}}},{key:"onGroupEnterNotice",value:function(){var j=this;return function($){j.emit("memberNotice",{channelId:$.group,seq:$.seq,instance:$.instance,memberId:$.user,type:"MemberJoined",size:$.size})}}},{key:"onGroupLeaveNotice",value:function(){var j=this;return function($){j.emit("memberNotice",{channelId:$.group,seq:$.seq,instance:$.instance,memberId:$.user,type:"MemberLeft",size:$.size})}}},{key:"onGroupCountNotice",value:function(){var j=this;return function($){j.emit("memberNotice",{channelId:$.group,seq:$.seq,instance:$.instance,type:"MemberCountUpdated",size:$.size})}}},{key:"onGroupAttributeAlt",value:function(){var j=this;return function($){var _n=$.group;$=em($,DP),j.emit("channelAttributesUpdated",tb({channelId:_n},$))}}},{key:"onUserNotice",value:function(j){var $=this;return function(_n){$.emit("peerOnlineStatusChanged",{peerId:_n.user,instance:_n.instance,seq:_n.seq,state:j})}}},{key:"sendPing",value:function(j){2500>=Date.now()-this.lastPingTime[j.env]||(this.incSeqIfNeeded(j.env),j.sendPacket("Ping",{ms:D.fromNumber(Date.now(),!0),seq:this.seq}),this.lastPingTime[j.env]=Date.now())}},{key:"updateMessageCount",value:function(j){var $,_n=($={},E($,vb.ChannelRMsg,this.chanelRawMessageReport),E($,vb.ChannelSMsg,this.chanelStringMessageReport),E($,vb.P2pRMsgNoOfflineFlag,this.p2pRMsgNoOfflineReport),E($,vb.P2pSMsgNoOfflineFlag,this.p2pSMsgNoOfflineReport),E($,3,void 0),E($,4,void 0),E($,7,void 0),E($,8,void 0),E($,9,void 0),E($,10,void 0),$)[j.messageCategory];j.type==="common"?_n==null||_n.updateCommonCount(j.key):j.type==="peer"?_n==null||_n.updatePeerAckCount(j.delay):_n==null||_n.updateNorecipientackCount(j.delay)}}],[{key:"sendMessageAck",value:function(j,$){var _n=new Yh(j.options);(_n.isInvitation()||_n.isPeerMessage())&&$.sendPacket("Ack",{code:0,dialogue:j.dialogue,instance:j.instance,sequence:j.sequence})}}]),i}(Dd());E(Pq,"genTimeoutErrorWithoutNotice",function(h,i,g){return Wb(void 0).pipe(mf(i===void 0?1e4:i),Wa(function(){if(g!=="JOIN")throw new Pc(["Request timed out after %ds",(i===void 0?1e4:i)/1e3],h)}))}),E(Pq,"genTimeoutError",function(h,i){return Wb(void 0).pipe(mf(i===void 0?1e4:i),Wa(function(){throw new Pc(["Request timed out after %ds",(i===void 0?1e4:i)/1e3],h)}))});var EA,Qq,Rq=0,Sq=0;gj.v1=function(h,i,g){g=i&&g||0;var _=i||[],j=(h=h||{}).node||EA,$=h.clockseq!==void 0?h.clockseq:Qq;if(j==null||$==null){var _n=ow();j==null&&(j=EA=[1|_n[0],_n[1],_n[2],_n[3],_n[4],_n[5]]),$==null&&($=Qq=16383&(_n[6]<<8|_n[7]))}_n=h.msecs!==void 0?h.msecs:new Date().getTime();var _i=h.nsecs!==void 0?h.nsecs:Sq+1,_s=_n-Rq+(_i-Sq)/1e4;if(0>_s&&h.clockseq===void 0&&($=$+1&16383),(0>_s||_n>Rq)&&h.nsecs===void 0&&(_i=0),1e4<=_i)throw Error("uuid.v1(): Can't create more than 10M uuids/sec");for(Rq=_n,Sq=_i,Qq=$,h=(1e4*(268435455&(_n+=122192928e5))+_i)%4294967296,_[g++]=h>>>24&255,_[g++]=h>>>16&255,_[g++]=h>>>8&255,_[g++]=255&h,h=_n/4294967296*1e4&268435455,_[g++]=h>>>8&255,_[g++]=255&h,_[g++]=h>>>24&15|16,_[g++]=h>>>16&255,_[g++]=$>>>8|128,_[g++]=255&$,$=0;6>$;++$)_[g+$]=j[$];return i||pw(_)},gj.v4=gj;var Tq=il(),Sf,ai=Oa.LocalInvitationFailureReason,Fb=Oa.LocalInvitationState,EP=(Sf=function(h){function i(_,j,$){ab(this,i);var _n=g.call(this,$,"RtmLocalInvitation",!0);return E(L(_n),"state",Fb.IDLE),E(L(_n),"localInvitationEnd$",bb(Bc(L(_n),"LocalInvitationAccepted"),Bc(L(_n),"LocalInvitationRefused"),Bc(L(_n),"LocalInvitationFailure"),Bc(L(_n),"LocalInvitationCanceled")).pipe(Xb(1))),E(L(_n),"callId",gj.v4()),E(L(_n),"_content",""),E(L(_n),"_channelId",""),E(L(_n),"_response",""),E(L(_n),"calleeId",void 0),E(L(_n),"logger",void 0),E(L(_n),"getSession",void 0),_n.calleeId=_,_n.getSession=j,_n.logger=$,_n}nb(i,h);var g=ob(i);return Qb(i,[{key:"channelId",get:function(){return this._channelId},set:function(_){this.state!==Fb.IDLE?this.info("set channelId only allow before invitation sent to remote"):(this.log("set channelId for %s",this.callId),this._channelId=_)}},{key:"content",get:function(){return this._content},set:function(_){this.log("set content for %s",this.callId),this._content=_}},{key:"response",get:function(){return this._response},set:function(_){throw new ja('Cannot set the "response" of the LocalInvitation instance.',ve)}},{key:"send",value:function(){var _,j=this;if(this.state===Fb.SENT_TO_REMOTE||this.state===Fb.RECEIVED_BY_REMOTE)throw new ia("The local invitation send failure. The call invitation has already been sent.",AI);if(this.isLocalInvitationEnd())throw new ia("The local invitation send failure. The call invitation has ended.",$k);if(0<this._channelId.length&&!yb(this._channelId))throw new ja("Illegal invitation channel ID",ve);if(!yb(this.calleeId))throw new ja("Illegal invitation callee user ID",ve);if(8192<Wj(this._content))throw new ja('The length of the "content" overflows. The number of bytes representing content must not exceed 8 × 1024 if encoded in UTF-8.',ve);this.state=Fb.SENT_TO_REMOTE,lf(za(W.mark(function $(){var _n,_i,_s;return W.wrap(function(ga){for(;;)switch(ga.prev=ga.next){case 0:return ga.next=2,j.getSession().sendInvitationMessage({peerId:j.calleeId,callId:j.callId,extra:j._content,type:"CallInvite",channelId:j._channelId});case 2:if(_n=ga.sent,_i=_n.hasPeerReceived,_s=_n.hasReSent,!j.isLocalInvitationEnd()){ga.next=7;break}throw new Pc("send invitation timeout");case 7:if(j.log("The local invitation has sent to the callee"),_i||_s){ga.next=11;break}throw _=new Tq({PEER_NOT_ONLINE:"The peer of the invitation is not online"});case 11:if(_i){ga.next=14;break}throw _=new Tq({RESENT_AND_OFFLINE:"Resent and the peer of the invitation is not online"});case 14:case"end":return ga.stop()}},$)}))).pipe(Zg(function($){return $.pipe(Ka(function(_n){if(!(_n instanceof Tq))throw _n}),mf(2e3))}),Oc(3e4),Rb(function($){return uc($)&&j.warn("local invitation ack timed out"),Va($)}),he(this.localInvitationEnd$)).subscribe({next:function(){j.state===Fb.RECEIVED_BY_REMOTE?j.log('The local invitation state is already "RECEIVED_BY_REMOTE", skipped emitting "LocalInvitationReceivedByPeer"'):j.state!==Fb.SENT_TO_REMOTE?j.log("The invitation has ended, skipped emitting the %s event","LocalInvitationReceivedByPeer"):(j.info("The peer received the local invitation %s.",j.callId),j.state=Fb.RECEIVED_BY_REMOTE,j.emit("LocalInvitationReceivedByPeer"),j.localInvitationEnd$.pipe(Oc(6e4),Rb(function($){return uc($)&&j.warn("local invitation expired"),Va($)})).subscribe({error:function(){j.state=Fb.FAILURE,j.emit("LocalInvitationFailure",ai.INVITATION_EXPIRE)}}))},error:function($){j.isLocalInvitationEnd()?j.log("The invitation has ended, skipped emitting the %s event","LocalInvitationFailure"):(j.state=Fb.FAILURE,uc($)&&_?_.code==="PEER_NOT_ONLINE"?j.emit("LocalInvitationFailure",ai.PEER_OFFLINE):_.code==="RESENT_AND_OFFLINE"&&j.emit("LocalInvitationFailure",ai.PEER_NO_RESPONSE):uc($)?j.emit("LocalInvitationFailure",ai.PEER_NO_RESPONSE):$.name==="RtmInvalidStatusError"?j.emit("LocalInvitationFailure",ai.NOT_LOGGEDIN):j.emit("LocalInvitationFailure",ai.UNKNOWN))}})}},{key:"cancel",value:function(){if(this.isLocalInvitationEnd())throw new ia("The local invitation cancel failure",$k);if(this.state===Fb.IDLE)throw new ia("The local invitation has not been sent",zI);if(8192<Wj(this._content))throw new ja('The length of the "content" overflows. The number of bytes representing content must not exceed 8 × 1024 if encoded in UTF-8.',ve);this.getSession().sendInvitationMessage({callId:this.callId,peerId:this.calleeId,type:"CallCancel",channelId:this._channelId,extra:this._content}),this.state=Fb.CANCELED,this.emit("LocalInvitationCanceled")}},{key:"onAcceptReceived",value:function(_){if(this.isLocalInvitationEnd()&&this.state!==Fb.ACCEPTED_BY_REMOTE)this.log("The invitation has ended, skipped emitting the %s event","LocalInvitationAccepted");else{if(this.state===Fb.IDLE)throw new ia("the local have not sent the invitation, how can remote accept it?");this.getSession().sendInvitationMessage({callId:this.callId,isAcceptAck:!0,type:"CallAccept",peerId:this.calleeId,channelId:this.channelId}),this.state===Fb.ACCEPTED_BY_REMOTE?this.log("already in ACCEPTED_BY_REMOTE state, ignore emit ACCEPTED_BY_REMOTE"):(this.state===Fb.SENT_TO_REMOTE&&(this.log("receive LocalInvitationAccepted before remote response to the invitation"),this.state=Fb.RECEIVED_BY_REMOTE,this.emit("LocalInvitationReceivedByPeer")),this.state=Fb.ACCEPTED_BY_REMOTE,this._response=_,this.emit("LocalInvitationAccepted",_))}}},{key:"onRefuseReceived",value:function(_){if(this.isLocalInvitationEnd())this.log("The invitation has ended, skipped emitting the %s event","LocalInvitationRefused");else{if(this.state===Fb.IDLE)throw new ia("the local have not sent the invitation, how can remote refuse it?");this.state===Fb.SENT_TO_REMOTE&&(this.log("receive LocalInvitationRefused before remote response to the invitation"),this.state=Fb.RECEIVED_BY_REMOTE,this.emit("LocalInvitationReceivedByPeer")),this._response=_,this.state=Fb.REFUSED_BY_REMOTE,this.emit("LocalInvitationRefused",_)}}},{key:"isLocalInvitationEnd",value:function(){return[Fb.CANCELED,Fb.FAILURE,Fb.ACCEPTED_BY_REMOTE,Fb.REFUSED_BY_REMOTE].includes(this.state)}}]),i}(Dd()),Na(Sf.prototype,"send",[je],Object.getOwnPropertyDescriptor(Sf.prototype,"send"),Sf.prototype),Na(Sf.prototype,"cancel",[je],Object.getOwnPropertyDescriptor(Sf.prototype,"cancel"),Sf.prototype),Sf),cm=Oa.RemoteInvitationFailureReason,Ic=Oa.RemoteInvitationState,FP=function(h){function i(_){var j=_.invitationChannel,$=_.extraContent,_n=_.callId,_i=_.callerId,_s=_.logger;_=_.getSession,ab(this,i);var ga=g.call(this,_s,"RtmRemoteInvitation",!0);return E(L(ga),"state",Ic.INVITATION_RECEIVED),E(L(ga),"remoteInvitationEnd$",bb(Bc(L(ga),"RemoteInvitationCanceled"),Bc(L(ga),"RemoteInvitationRefused"),Bc(L(ga),"RemoteInvitationAccepted"),Bc(L(ga),"RemoteInvitationFailure")).pipe(Xb(1))),E(L(ga),"callerId",void 0),E(L(ga),"callId",void 0),E(L(ga),"_getSession",void 0),E(L(ga),"logger",void 0),E(L(ga),"_content",void 0),E(L(ga),"_channelId",void 0),E(L(ga),"_response",""),ga._channelId=j,ga._content=$,ga.callId=_n,ga.callerId=_i,ga._getSession=_,ga.logger=_s,ga.remoteInvitationEnd$.pipe(Oc(6e4),Rb(function(ba){return uc(ba)&&ga.warn("Remote invitation expired"),Va(ba)})).subscribe({error:function(){ga.state=Ic.FAILURE,ga.emit("RemoteInvitationFailure",cm.INVITATION_EXPIRE)}}),ga}nb(i,h);var g=ob(i);return Qb(i,[{key:"channelId",get:function(){return this._channelId},set:function(_){throw new ja('Cannot set the "response" of the RemoteInvitation instance.',ve)}},{key:"content",get:function(){return this._content},set:function(_){throw new ja('Cannot set the "content" of the RemoteInvitation instance.',ve)}},{key:"response",get:function(){return this._response},set:function(_){this._response=_}},{key:"accept",value:function(){var _,j=this;if(this.isRemoteInvitationEnd())throw new ia("The local invitation has ended. Cannot accept.",$k);if(this.state===Ic.ACCEPT_SENT_TO_LOCAL)throw new ia("The remote invitation is accepting. Cannot do the operation.",vw);if(8192<Wj(this._response))throw new ja('The length of the "response" overflows. The number of bytes representing content must not exceed 8 × 1024 if encoded in UTF-8.',ve);this.state=Ic.ACCEPT_SENT_TO_LOCAL,Nc(Yg(1e3).pipe(Ac(function(){return lf(za(W.mark(function $(){return W.wrap(function(_n){for(;;)switch(_n.prev=_n.next){case 0:return _n.abrupt("return",j._getSession().sendInvitationMessage({peerId:j.callerId,callId:j.callId,extra:j.response,type:"CallAccept",isAcceptAck:!1,channelId:j.channelId}));case 1:case"end":return _n.stop()}},$)})))}),sc(function($){return _=$.hasPeerReceived}),Xb(1)),Bc(this,"RemoteInvitationAccepted")).pipe(Oc(5e3),he(this.remoteInvitationEnd$)).subscribe({error:function($){if(j.logError($),j.state=Ic.FAILURE,uc($))switch(_){case void 0:case!0:return void j.emit("RemoteInvitationFailure",cm.ACCEPT_FAILURE);case!1:return void j.emit("RemoteInvitationFailure",cm.PEER_OFFLINE)}j.emit("RemoteInvitationFailure",cm.UNKNOWN)}})}},{key:"refuse",value:function(){if(this.state===Ic.ACCEPT_SENT_TO_LOCAL)throw new ia("The remote invitation is accepting. Cannot do the operation.",vw);if(this.isRemoteInvitationEnd())throw new ia("The invitation is end. Cannot refuse",$k);if(8192<Wj(this._response))throw new ja('The length of the "response" overflows. The number of bytes representing content must not exceed 8 × 1024 if encoded in UTF-8.',ve);this._getSession().sendInvitationMessage({peerId:this.callerId,callId:this.callId,extra:this.response,type:"CallReject",channelId:this.channelId}),this.state=Ic.REFUSED,this.emit("RemoteInvitationRefused")}},{key:"onCancelReceived",value:function(_){this.isRemoteInvitationEnd()?this.log("The invitation has ended, skipped emitting the %s event","RemoteInvitationCanceled"):(this.state===Ic.ACCEPT_SENT_TO_LOCAL&&this.log("caller canceled before receive accept"),this._content=_,this.state=Ic.CANCELED,this.emit("RemoteInvitationCanceled",_))}},{key:"onAcceptAckReceived",value:function(){this.state!==Ic.ACCEPT_SENT_TO_LOCAL?this.log("The invitation has ended, skipped emitting the %s event","ori:".concat(this.state,", to: RemoteInvitationAccepted")):(this.state=Ic.ACCEPTED,this.emit("RemoteInvitationAccepted"))}},{key:"isRemoteInvitationEnd",value:function(){return[Ic.ACCEPTED,Ic.REFUSED,Ic.CANCELED,Ic.FAILURE].includes(this.state)}}]),i}(Dd()),GP=function(h){function i(_,j){ab(this,i);var $=g.call(this,j,"InvitationManager");return E(L($),"getSession",void 0),E(L($),"invitationDispatcher",new kb.EventEmitter),E(L($),"outgoingLocalInvitations",new Map),E(L($),"receivedRemoteInvitations",new ue(void 0,{maxlen:1e4})),E(L($),"logger",void 0),$.getSession=Hs(_),$.logger=j,$.invitationDispatcher.on("remoteInvitationToManager",function(_n){var _i=_n.callId,_s=_n.extra,ga=_n.callerId;_n=_n.channelId,$.receivedRemoteInvitations.has(_i)||((_s=new FP({callerId:ga,callId:_i,getSession:$.getSession,logger:j,extraContent:_s,invitationChannel:_n})).remoteInvitationEnd$.subscribe(function(){$.receivedRemoteInvitations.delete(_i)}),$.receivedRemoteInvitations.set(_i,_s),$.emit("remoteInvitationInstance",_s))}),$.invitationDispatcher.on("acceptAckToRemoteInvitation",function(_n){(_n=$.receivedRemoteInvitations.get(_n.callId))&&_n.onAcceptAckReceived()}),$.invitationDispatcher.on("cancelToRemoteInvitation",function(_n){var _i=_n.extra;(_n=$.receivedRemoteInvitations.get(_n.callId))&&_n.onCancelReceived(_i)}),$.invitationDispatcher.on("acceptToLocalInvitation",function(_n){var _i=_n.extra;(_n=$.outgoingLocalInvitations.get(_n.callId))&&_n.onAcceptReceived(_i)}),$.invitationDispatcher.on("refuseToLocalInvitation",function(_n){var _i=_n.extra;(_n=$.outgoingLocalInvitations.get(_n.callId))&&_n.onRefuseReceived(_i)}),$}nb(i,h);var g=ob(i);return Qb(i,[{key:"invitationMessageHandler",value:function(_){var j=_.body,$=j.callId,_n=j.extra;_n=_n===void 0?"":_n;var _i=j.type,_s=(j=j.channel)===void 0?"":j,ga=_.type;switch(j=_.peerId,_=_.serverReceivedTs,ga){case"CallAccept":_i==="ack"?this.invitationDispatcher.emit("acceptAckToRemoteInvitation",{callId:$}):_i==="request"&&this.invitationDispatcher.emit("acceptToLocalInvitation",{callId:$,extra:_n});break;case"CallInvite":this.invitationDispatcher.emit("remoteInvitationToManager",{callId:$,callerId:j,extra:_n,channelId:_s});break;case"CallCancel":if($==="0"){$="".concat("AgoraRTMLegacyEndcallCompatibleMessagePrefix","_").concat(_s,"_").concat(_n),this.getSession().emit("peerTextMessage",{peerId:j,properties:{serverReceivedTs:_},text:$});break}this.invitationDispatcher.emit("cancelToRemoteInvitation",{callId:$,extra:_n});break;case"CallReject":this.invitationDispatcher.emit("refuseToLocalInvitation",{callId:$,extra:_n});break;default:throw ps("invitationType",ga)}}},{key:"genLocalInvitation",value:function(_){var j=this,$=new EP(_,this.getSession,this.logger);return $.localInvitationEnd$.subscribe(function(){j.outgoingLocalInvitations.delete($.callId)}),this.outgoingLocalInvitations.set($.callId,$),$}}]),i}(Dd()),HP=function(h,i,g){var _=!0,j=!0;if(typeof h!="function")throw new TypeError("Expected a function");return Kc(g)&&(_="leading"in g?!!g.leading:_,j="trailing"in g?!!g.trailing:j),LK(h,i,{leading:_,maxWait:i,trailing:j})},lb,bi;(function(h){h[h.JOINED=0]="JOINED",h[h.LEFT=1]="LEFT"})(bi||(bi={}));var Ld=Oa.ConnectionState,IP=(lb=function(h){function i(j,$,_n,_i){ab(this,i);var _s=_.call(this,_i,"RtmChannel",!0);return E(L(_s),"onMemberCountUpdated",HP(function(ga){ga!==_s.memberCount&&(_s.memberCount=ga,_s.emit("MemberCountUpdated",ga))},1e3)),E(L(_s),"onMetadataUpdated",function(ga){_s.emit("MetaDataUpdated",ga)}),E(L(_s),"getSession",void 0),E(L(_s),"memberCount",0),E(L(_s),"joinState","LEFT"),E(L(_s),"joinPromise",void 0),E(L(_s),"memberJoinedLru",new ue(void 0,{maxlen:1e4})),E(L(_s),"memberLeftLru",new ue(void 0,{maxlen:1e4})),E(L(_s),"memberJoinStateLru",new ue(void 0,{maxlen:1e4})),E(L(_s),"attributesSeqLru",new ue(void 0,{maxlen:1e4})),E(L(_s),"channelId",void 0),E(L(_s),"client",void 0),E(L(_s),"onChannelMetaDataUpdated",function(ga){var ba=ga.data;_s.channelId===ga.channelId&&_s.onMetadataUpdated(ba)}),E(L(_s),"onChannelMemberCountUpdated",function(ga,ba){_s.channelId===ga&&_s.onMemberCountUpdated(ba)}),E(L(_s),"onLogout",function(){try{_s.clearChannel(_s.getSession())}catch{}}),E(L(_s),"onAttributesUpdated",function(ga){var ba=ga.channelId,xa=ga.attributeMaps,El=ga.seq;ga=ga.instance.toString();var Tl=_s.attributesSeqLru.get(ga);if((!Tl||El.greaterThan(Tl))&&(_s.attributesSeqLru.set(ga,El),ba===_s.channelId)){for(ba={},El=0;El<xa.length;El++){var Sl=xa[El];ga=Sl.key,Tl=Sl.ms;var Il=Sl.value;if(Sl=Sl.origin,typeof ga!="string"||!D.isLong(Tl)||typeof Il!="string"||!yb(Sl))break;ba[ga]={value:Il,lastUpdateUserId:Sl,lastUpdateTs:Tl.toNumber()}}_s.emit("AttributesUpdated",ba)}}),E(L(_s),"onChannelTextMessage",function(ga){var ba=ga.memberId,xa=ga.text,El=ga.properties;ga.channelId===_s.channelId&&_s.emit("ChannelMessage",{text:xa,messageType:Oa.MessageType.TEXT},ba,El)}),E(L(_s),"onChannelRawMessage",function(ga){var ba=ga.desc,xa=ga.raw,El=ga.memberId,Tl=ga.properties;ga.channelId===_s.channelId&&_s.emit("ChannelMessage",{messageType:Oa.MessageType.RAW,rawMessage:xa,description:ba},El,Tl)}),E(L(_s),"onMemberNotice",function(ga){var ba=ga.memberId,xa=ga.type,El=ga.size;if(ga.channelId===_s.channelId){var Tl=ga.instance.toString();ga=ga.seq.toString();var Sl={MemberLeft:_s.memberLeftLru,MemberJoined:_s.memberJoinedLru,MemberCountUpdated:void 0}[xa];if(Sl){if(Sl.has(Tl+ga))return void _s.log("received duplicated %s notice (seq: %s), channel '%s', member '%s'",xa,ga,wb(_s.channelId),wb(ba||""));if(Sl.set(Tl+ga,void 0),typeof ba!="string")return;if(ba!==_s.getSession().context.uid&&((Tl=_s.memberJoinStateLru.get(ba))===bi.JOINED&&xa==="MemberJoined"||Tl===bi.LEFT&&xa==="MemberLeft"))return void _s.log("received duplicated %s state (seq: %s), channel '%s', member '%s'",xa,ga,wb(_s.channelId),wb(ba||""));_s.memberJoinStateLru.set(ba,xa==="MemberJoined"?bi.JOINED:bi.LEFT)}_s.info("Channel %s - %s, memberId: %s",xa,wb(_s.channelId),xa==="MemberCountUpdated"?"[unknown]":wb(ba||"")),Tl=ba===_s.getSession().context.uid,xa==="MemberLeft"&&yb(ba)||xa==="MemberJoined"&&yb(ba)?(Tl||_s.emit(xa,ba),_s.onMemberCountUpdated(El)):xa==="MemberCountUpdated"&&typeof El=="number"&&_s.onMemberCountUpdated(El)}}),_s.getSession=Hs($),_s.channelId=j,_s.client=_n,_s.info("A channel created, id %s",wb(j)),_s}nb(i,h);var g,_=ob(i);return Qb(i,[{key:"join",value:(g=za(W.mark(function j(){var $,_n,_i,_s,ga,ba,xa,El=this;return W.wrap(function(Tl){for(;;)switch(Tl.prev=Tl.next){case 0:if(this.client.connectionState===Ld.CONNECTED){Tl.next=2;break}throw new ia("The client is not logged in. Cannot do the operation",oc);case 2:Tl.prev=2,$=this.getSession(),Tl.next=9;break;case 6:throw Tl.prev=6,Tl.t0=Tl.catch(2),new ia("The client is not logged in. Cannot do the operation",Aw);case 9:if(Tl.prev=9,yb(this.channelId)){Tl.next=12;break}throw new ja(["The %s in the arguments is invalid","channelId"],BI);case 12:if(this.joinState==="LEFT"){Tl.next=15;break}throw $a("ChnJoin",{cname:this.channelId,lts:D.fromNumber(Date.now()),userId:$.context.uid,elapse:Nb($.startTime),errCode:zw,sid:fc($.instanceId)},(_s=this.client.context.config.enableCloudProxy)!==null&&_s!==void 0&&_s),new ia("The channel has joined. Cannot rejoin",zw);case 15:if(!$.usedChannelIds.includes(this.channelId)){Tl.next=18;break}throw $a("ChnJoin",{cname:this.channelId,lts:D.fromNumber(Date.now()),userId:$.context.uid,elapse:Nb($.startTime),errCode:Bw,sid:fc($.instanceId)},(ga=this.client.context.config.enableCloudProxy)!==null&&ga!==void 0&&ga),new ia("A channel of the same channel ID has already joined. Cannot rejoin",Bw);case 18:if(!(20<=$.usedChannelIds.length)){Tl.next=21;break}throw $a("ChnJoin",{cname:this.channelId,lts:D.fromNumber(Date.now()),userId:$.context.uid,elapse:Nb($.startTime),errCode:yw,sid:fc($.instanceId)},(ba=this.client.context.config.enableCloudProxy)!==null&&ba!==void 0&&ba),new Dc("The joined channels has exceeded the limit of 20",yw);case 21:return $a("ChnJoin",{cname:this.channelId,lts:D.fromNumber(Date.now()),userId:$.context.uid,elapse:Nb($.startTime),errCode:0,sid:fc($.instanceId)},(_n=this.client.context.config.enableCloudProxy)!==null&&_n!==void 0&&_n),this.log("Joining the channel %s",wb(this.channelId)),this.joinState="JOINING",$.usedChannelIds.push(this.channelId),this.joinPromise=$.requestChannelJoin(this.channelId).then(function(){El.joinState="JOINED",$.requestSubscribeChannelMetadata(El.channelId,"JOIN").toPromise()}),Tl.next=28,this.joinPromise;case 28:$a("ChnJoinRes",{cname:this.channelId,lts:D.fromNumber(Date.now()),elapse:Nb($.startTime),errCode:0,sid:fc($.instanceId),serverErrCode:0,userId:$.context.uid},(_i=this.client.context.config.enableCloudProxy)!==null&&_i!==void 0&&_i),this.info("The channel %s joined successfully",wb(this.channelId)),$.on("channelTextMessage",this.onChannelTextMessage),$.on("channelRawMessage",this.onChannelRawMessage),$.on("memberNotice",this.onMemberNotice),$.on("channelAttributesUpdated",this.onAttributesUpdated),$.on("channelMetaDataUpdated",this.onChannelMetaDataUpdated),this.client.internalEmitter.on("channelMemberCountUpdated",this.onChannelMemberCountUpdated),this.client.internalEmitter.once("LOGOUT",this.onLogout),Tl.next=49;break;case 39:if(Tl.prev=39,Tl.t1=Tl.catch(9),this.joinState==="JOINING"&&(this.joinState="LEFT"),this.logError(Tl.t1),!Sa(Tl.t1)){Tl.next=45;break}throw Tl.t1;case 45:if(!uc(Tl.t1)){Tl.next=48;break}throw $a("ChnJoinRes",{cname:this.channelId,lts:D.fromNumber(Date.now()),elapse:Nb($.startTime),errCode:xw,sid:fc($.instanceId),serverErrCode:0,userId:$.context.uid},(xa=this.client.context.config.enableCloudProxy)!==null&&xa!==void 0&&xa),new Pc(["Join channel %s timed out",wb(this.channelId)],xw);case 48:throw new id(["The channel %s join failure",wb(this.channelId)],{code:ww,originalError:Tl.t1});case 49:case"end":return Tl.stop()}},j,this,[[2,6],[9,39]])})),function(){return g.apply(this,arguments)})},{key:"leave",value:function(){var j=za(W.mark(function $(){var _n,_i,_s,ga;return W.wrap(function(ba){for(;;)switch(ba.prev=ba.next){case 0:if(this.client.connectionState===Ld.CONNECTED){ba.next=2;break}throw new ia("The client is not logged in. Cannot do the operation",oc);case 2:ba.prev=2,_i=this.getSession(),ba.next=9;break;case 6:throw ba.prev=6,ba.t0=ba.catch(2),new ia("The client is not logged in. Cannot do the operation",DI);case 9:if(this.joinState!=="LEFT"){ba.next=11;break}throw new ia("The channel does not join. Cannot do the operation",CI);case 11:return ba.prev=11,_i.requestChannelLeave(this.channelId),ba.next=15,_i.requestUnsubscribeChannelMetadata(this.channelId);case 15:return ba.next=17,this.clearChannel(_i);case 17:ba.next=28;break;case 19:if(ba.prev=19,ba.t1=ba.catch(11),this.logError(ba.t1),!Sa(ba.t1)){ba.next=26;break}throw ba.t1.code===void 0&&(ba.t1.code=Dw),$a("ChnLeave",{cname:this.channelId,lts:D.fromNumber(Date.now()),elapse:Nb(_i.startTime),errCode:Dw,sid:fc(_i.instanceId),userId:_i.context.uid},(ga=this.client.context.config.enableCloudProxy)!==null&&ga!==void 0&&ga),ba.t1;case 26:throw $a("ChnLeave",{cname:this.channelId,lts:D.fromNumber(Date.now()),elapse:Nb(_i.startTime),errCode:Cw,sid:fc(_i.instanceId),userId:_i.context.uid},(_s=this.client.context.config.enableCloudProxy)!==null&&_s!==void 0&&_s),new id("The channel leave failure",{code:Cw,originalError:ba.t1});case 28:$a("ChnLeave",{cname:this.channelId,lts:D.fromNumber(Date.now()),elapse:Nb(_i.startTime),errCode:0,sid:fc(_i.instanceId),userId:_i.context.uid},(_n=this.client.context.config.enableCloudProxy)!==null&&_n!==void 0&&_n);case 29:case"end":return ba.stop()}},$,this,[[2,6],[11,19]])}));return function(){return j.apply(this,arguments)}}()},{key:"sendMessage",value:function(){var j=za(W.mark(function $(_n){var _i,_s=this;return W.wrap(function(ga){for(;;)switch(ga.prev=ga.next){case 0:if(vs(_n,fp),this.client.connectionState!==Ld.CONNECTED||this.joinState==="JOINED"){ga.next=3;break}throw new ia("The channel does not join. Cannot do the operation",rI);case 3:if(this.client.connectionState!==Ld.RECONNECTING){ga.next=8;break}return _i=Date.now(),ga.next=7,new Promise(function(ba,xa){var El,Tl=(El=za(W.mark(function Il(){var Cl;return W.wrap(function(Nl){for(;;)switch(Nl.prev=Nl.next){case 0:return Cl=Date.now()-_i,Nl.prev=1,Nl.next=4,Uj({message:_n,peerId:_s.channelId,toPeer:!1,session:_s.getSession(),errorCodes:{NOT_LOGGED_IN:gp,TOO_OFTEN:rw},diff:Cl,logger:_s.logger});case 4:ba(),Nl.next=12;break;case 7:Nl.prev=7,Nl.t0=Nl.catch(1),uc(Nl.t0)&&xa(new Pc(vg(_s.name,"sendMessageToPeer",1e4),ep)),Sa(Nl.t0)&&xa(Nl.t0),xa(new Pa("Channel message send failure",{code:Zk,originalError:Nl.t0}));case 12:return Nl.prev=12,clearTimeout(Sl),Nl.finish(12);case 15:case"end":return Nl.stop()}},Il,null,[[1,7,12,15]])})),function(){return El.apply(this,arguments)});_s.client.internalEmitter.once("RECONNECTED",Tl);var Sl=setTimeout(function(){_s.client.internalEmitter.off("RECONNECTED",Tl),xa(new Pc(vg(_s.name,"sendMessageToPeer",1e4),ep))},9e3)});case 7:return ga.abrupt("return");case 8:if(this.client.connectionState===Ld.CONNECTED){ga.next=10;break}throw new ia("The client is not logged in. Cannot do the operation",gp);case 10:return ga.prev=10,ga.next=13,Uj({message:_n,peerId:this.channelId,toPeer:!1,session:this.getSession(),errorCodes:{NOT_LOGGED_IN:gp,TOO_OFTEN:rw},diff:0,logger:this.logger});case 13:ga.next=23;break;case 15:if(ga.prev=15,ga.t0=ga.catch(10),!uc(ga.t0)){ga.next=19;break}throw new Pc(vg(this.name,"sendMessage",1e4),ep);case 19:if(!Sa(ga.t0)){ga.next=22;break}throw this.logError(ga.t0),ga.t0;case 22:throw new id("The channel message send failure",Zk);case 23:case"end":return ga.stop()}},$,this,[[10,15]])}));return function($){return j.apply(this,arguments)}}()},{key:"getChannelMetadata",value:function(){var j=za(W.mark(function $(){var _n,_i;return W.wrap(function(_s){for(;;)switch(_s.prev=_s.next){case 0:if(this.client.connectionState===Ld.CONNECTED){_s.next=2;break}throw new ia("The client is not logged in. Cannot do the operation",oc);case 2:return _s.prev=2,_n=this.getSession().requestGetChannelMetaData(this.channelId),_s.next=6,_n.pipe(Wa(function(ga){return Wm(ga)})).toPromise();case 6:return _i=_s.sent,_s.abrupt("return",_i);case 10:if(_s.prev=10,_s.t0=_s.catch(2),!Sa(_s.t0)){_s.next=15;break}throw this.logError(_s.t0),_s.t0;case 15:throw new id("The channel metadata get failure",lp);case 16:case"end":return _s.stop()}},$,this,[[2,10]])}));return function(){return j.apply(this,arguments)}}()},{key:"setChannelMetadata",value:function(){var j=za(W.mark(function $(_n,_i){var _s;return W.wrap(function(ga){for(;;)switch(ga.prev=ga.next){case 0:if(this.client.connectionState===Ld.CONNECTED){ga.next=2;break}throw new ia("The client is not logged in. Cannot do the operation",oc);case 2:if(this.joinState==="JOINED"){ga.next=4;break}throw new ia("The channel does not join. Cannot do the operation",kj);case 4:return ga.prev=4,_s=this.getSession().requestSetChannelMetadata(_n,_i,this.channelId).toPromise(),ga.next=8,_s;case 8:ga.next=16;break;case 10:if(ga.prev=10,ga.t0=ga.catch(4),!Sa(ga.t0)){ga.next=15;break}throw this.logError(ga.t0),ga.t0;case 15:throw new id("The channel metadata set failure",He);case 16:case"end":return ga.stop()}},$,this,[[4,10]])}));return function($,_n){return j.apply(this,arguments)}}()},{key:"clearChannelMetadata",value:function(){var j=za(W.mark(function $(_n){var _i;return W.wrap(function(_s){for(;;)switch(_s.prev=_s.next){case 0:if(this.client.connectionState===Ld.CONNECTED){_s.next=2;break}throw new ia("The client is not logged in. Cannot do the operation",oc);case 2:if(this.joinState==="JOINED"){_s.next=4;break}throw new ia("The channel does not join. Cannot do the operation",kj);case 4:return _s.prev=4,_i=this.getSession().requestClearChannelMetadata(_n,this.channelId).toPromise(),_s.next=8,_i;case 8:_s.next=16;break;case 10:if(_s.prev=10,_s.t0=_s.catch(4),!Sa(_s.t0)){_s.next=15;break}throw this.logError(_s.t0),_s.t0;case 15:throw new id("The channel metadata clear failure",He);case 16:case"end":return _s.stop()}},$,this,[[4,10]])}));return function($){return j.apply(this,arguments)}}()},{key:"addChannelMetadata",value:function(){var j=za(W.mark(function $(_n,_i){var _s;return W.wrap(function(ga){for(;;)switch(ga.prev=ga.next){case 0:if(this.client.connectionState===Ld.CONNECTED){ga.next=2;break}throw new ia("The client is not logged in. Cannot do the operation",oc);case 2:if(this.joinState==="JOINED"){ga.next=4;break}throw new ia("The channel does not join. Cannot do the operation",kj);case 4:return ga.prev=4,_s=this.getSession().requestAddChannelMetadata(_n,_i,this.channelId).toPromise(),ga.next=8,_s;case 8:ga.next=16;break;case 10:if(ga.prev=10,ga.t0=ga.catch(4),!Sa(ga.t0)){ga.next=15;break}throw this.logError(ga.t0),ga.t0;case 15:throw new id("The channel metadata clear failure",He);case 16:case"end":return ga.stop()}},$,this,[[4,10]])}));return function($,_n){return j.apply(this,arguments)}}()},{key:"updateChannelMetadata",value:function(){var j=za(W.mark(function $(_n,_i){var _s;return W.wrap(function(ga){for(;;)switch(ga.prev=ga.next){case 0:if(this.client.connectionState===Ld.CONNECTED){ga.next=2;break}throw new ia("The client is not logged in. Cannot do the operation",oc);case 2:if(this.joinState==="JOINED"){ga.next=4;break}throw new ia("The channel does not join. Cannot do the operation",kj);case 4:return ga.prev=4,_s=this.getSession().requestUpdateChannelMetadata(_n,_i,this.channelId).toPromise(),ga.next=8,_s;case 8:ga.next=16;break;case 10:if(ga.prev=10,ga.t0=ga.catch(4),!Sa(ga.t0)){ga.next=15;break}throw this.logError(ga.t0),ga.t0;case 15:throw new id("The channel metadata clear failure",He);case 16:case"end":return ga.stop()}},$,this,[[4,10]])}));return function($,_n){return j.apply(this,arguments)}}()},{key:"deleteChannelMetadata",value:function(){var j=za(W.mark(function $(_n,_i){var _s;return W.wrap(function(ga){for(;;)switch(ga.prev=ga.next){case 0:if(this.client.connectionState===Ld.CONNECTED){ga.next=2;break}throw new ia("The client is not logged in. Cannot do the operation",oc);case 2:if(this.joinState==="JOINED"){ga.next=4;break}throw new ia("The channel does not join. Cannot do the operation",kj);case 4:return ga.prev=4,_s=this.getSession().requestDeleteChannelMetadata(_n,_i,this.channelId).toPromise(),ga.next=8,_s;case 8:ga.next=16;break;case 10:if(ga.prev=10,ga.t0=ga.catch(4),!Sa(ga.t0)){ga.next=15;break}throw this.logError(ga.t0),ga.t0;case 15:throw new id("The channel metadata clear failure",He);case 16:case"end":return ga.stop()}},$,this,[[4,10]])}));return function($,_n){return j.apply(this,arguments)}}()},{key:"getMembers",value:function(){var j=za(W.mark(function $(){var _n,_i;return W.wrap(function(_s){for(;;)switch(_s.prev=_s.next){case 0:if(_s.prev=0,this.client.connectionState===Ld.CONNECTED){_s.next=3;break}throw new ia("The client is not logged in. Cannot do the operation",yI);case 3:if(this.joinState==="JOINED"){_s.next=5;break}throw new ia("The channel does not join. Cannot do the operation",xI);case 5:return _n=this.getSession().requestChannelMemberList(this.channelId),_s.next=8,_n.pipe(Wa(function(ga){return ga.memberInfos.map(function(ba){return ba.account})})).toPromise();case 8:return _i=_s.sent,this.info("Channel %s - get members success, %o",wb(this.channelId),_i.map(wb)),_s.abrupt("return",_i);case 13:if(_s.prev=13,_s.t0=_s.catch(0),!Sa(_s.t0)){_s.next=18;break}throw this.logError(_s.t0),_s.t0;case 18:throw new id("The channel members get failure",vI);case 19:case"end":return _s.stop()}},$,this,[[0,13]])}));return function(){return j.apply(this,arguments)}}()},{key:"clearChannel",value:function(){var j=za(W.mark(function $(_n){var _i=this;return W.wrap(function(_s){for(;;)switch(_s.prev=_s.next){case 0:if(_n.emit("channelLeft",this.channelId),this.joinState!=="JOINING"){_s.next=4;break}return _s.next=4,this.joinPromise;case 4:this.joinState="LEFT",this.memberLeftLru.empty(),this.memberJoinedLru.empty(),this.attributesSeqLru.empty(),this.memberJoinStateLru.empty(),this.memberCount=0,_n.removeListener("channelTextMessage",this.onChannelTextMessage),_n.removeListener("channelRawMessage",this.onChannelRawMessage),_n.removeListener("memberNotice",this.onMemberNotice),_n.removeListener("channelAttributesUpdated",this.onAttributesUpdated),_n.removeListener("channelMetaDataUpdated",this.onChannelMetaDataUpdated),this.client.internalEmitter.removeListener("channelMemberCountUpdated",this.onChannelMemberCountUpdated),this.client.internalEmitter.removeListener("LOGOUT",this.onLogout),_n.usedChannelIds=_n.usedChannelIds.filter(function(ga){return ga!==_i.channelId});case 18:case"end":return _s.stop()}},$,this)}));return function($){return j.apply(this,arguments)}}()}]),i}(Dd()),Na(lb.prototype,"join",[je],Object.getOwnPropertyDescriptor(lb.prototype,"join"),lb.prototype),Na(lb.prototype,"leave",[je],Object.getOwnPropertyDescriptor(lb.prototype,"leave"),lb.prototype),Na(lb.prototype,"sendMessage",[je],Object.getOwnPropertyDescriptor(lb.prototype,"sendMessage"),lb.prototype),Na(lb.prototype,"getChannelMetadata",[gb],Object.getOwnPropertyDescriptor(lb.prototype,"getChannelMetadata"),lb.prototype),Na(lb.prototype,"setChannelMetadata",[gb],Object.getOwnPropertyDescriptor(lb.prototype,"setChannelMetadata"),lb.prototype),Na(lb.prototype,"clearChannelMetadata",[gb],Object.getOwnPropertyDescriptor(lb.prototype,"clearChannelMetadata"),lb.prototype),Na(lb.prototype,"addChannelMetadata",[gb],Object.getOwnPropertyDescriptor(lb.prototype,"addChannelMetadata"),lb.prototype),Na(lb.prototype,"updateChannelMetadata",[gb],Object.getOwnPropertyDescriptor(lb.prototype,"updateChannelMetadata"),lb.prototype),Na(lb.prototype,"deleteChannelMetadata",[gb],Object.getOwnPropertyDescriptor(lb.prototype,"deleteChannelMetadata"),lb.prototype),Na(lb.prototype,"getMembers",[gb],Object.getOwnPropertyDescriptor(lb.prototype,"getMembers"),lb.prototype),lb),ka,Jc=Oa.ConnectionChangeReason,Ea=Oa.ConnectionState,FA={DISCONNECTED:1,CONNECTING:2,CONNECTED:3,RECONNECTING:4,ABORTED:5},JP={LOGIN:1,LOGIN_SUCCESS:2,LOGIN_FAILURE:3,LOGIN_TIMEOUT:4,INTERRUPTED:5,LOGOUT:6,BANNED_BY_SERVER:7,REMOTE_LOGIN:8,TOKEN_EXPIRED:9},KP=(ka=function(h){function i(j,$,_n,_i){ab(this,i);var _s=_.call(this,$,"RtmClient",!0);return E(L(_s),"connectionState",Ea.DISCONNECTED),E(L(_s),"internalEmitter",new kb),E(L(_s),"context",void 0),E(L(_s),"attributes",{}),E(L(_s),"loginPromise",void 0),E(L(_s),"attributeDrafts",new Set),E(L(_s),"session",void 0),E(L(_s),"lastLoginTime",void 0),E(L(_s),"reconnId",0),E(L(_s),"channelAttributesCacheLru",new ue(void 0,{maxlen:1e4})),E(L(_s),"invitationManager",void 0),E(L(_s),"subscribedPeerStatusCache",{}),E(L(_s),"subscribedUserMetaCache",{}),E(L(_s),"pendingPeerStatusSubCount",0),E(L(_s),"peerStatusSeqLru",new ue(void 0,{maxlen:1e4})),E(L(_s),"peerUnreachableTimers",{}),E(L(_s),"setParameters",void 0),E(L(_s),"updateConfig",void 0),E(L(_s),"blacklistedIP",{}),E(L(_s),"TokenPrivilegeWillExpireHandler",function(){_s.emit("TokenPrivilegeWillExpire")}),E(L(_s),"userMetaDataUpdatedHandler",function(ga){var ba=ga.uid;ga=ga.data,_s.subscribedUserMetaCache[ba]&&_s.emit("UserMetaDataUpdated",ba,ga)}),E(L(_s),"userDropHandler",function(ga){if(_s.connectionState!==Ea.ABORTED)switch(ga){case 2:_s.logError("Server banned because of token is expired"),_s.onConnectionStateChanged(Ea.ABORTED,Jc.TOKEN_EXPIRED),_s.emit("TokenExpired");break;case 11:_s.logError("Kicked off by remote session"),_s.onConnectionStateChanged(Ea.ABORTED,Jc.REMOTE_LOGIN);break;case 14:case 15:case 16:_s.logError("Server banned because of illegal ".concat({14:"User ID",15:"IP",16:"Channel Name"}[ga])),_s.onConnectionStateChanged(Ea.ABORTED,Jc.BANNED_BY_SERVER);break;case 10019:_s.logError("Kicked off by authorization"),_s.onConnectionStateChanged(Ea.ABORTED,Jc.BANNED_BY_SERVER);break;default:_s.logError("User kicked off for unknown code: ".concat(ga)),_s.onConnectionStateChanged(Ea.ABORTED,Jc.INTERRUPTED)}}),_s.context=new yL(j,_n,$),_s.context.config=_n,_s.setParameters=_i.bind(L(_s)),_s.updateConfig=_i.bind(L(_s)),_s.invitationManager=new GP(function(){return _s.session},$),_s.invitationManager.on("remoteInvitationInstance",function(ga){_s.emit("RemoteInvitationReceived",ga)}),_s.setMaxListeners(512),_s.internalEmitter.setMaxListeners(512),_s}nb(i,h);var g,_=ob(i);return Qb(i,[{key:"renewToken",value:(g=za(W.mark(function j($){var _n,_i,_s,ga,ba=this;return W.wrap(function(xa){for(;;)switch(xa.prev=xa.next){case 0:if(typeof $=="string"&&$.length!==0){xa.next=2;break}throw new ja("Invalid argument",KI);case 2:if(this.connectionState!==Ea.ABORTED){xa.next=5;break}return xa.next=5,new Promise(function(){});case 5:if(this.connectionState===Ea.CONNECTED||this.connectionState===Ea.RECONNECTING){xa.next=7;break}throw new ia("The client is not logged in",Mw);case 7:if(this.session!==void 0){xa.next=9;break}throw new rb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 9:return xa.prev=9,_n=this.context.token,this.context.token=$,xa.next=14,this.session.connection.apClient.getApEdgeInfo$(!1).pipe(Zf(function(){return Error("No available edge address to connect")}),Zg(function(El){return El.pipe(Ka(function(Tl){if(Sa(Tl))throw Tl}),mf(2500),Xb(4))}),Xb(1),Oc(2e4),Rb(function(El){return uc(El)&&ba.warn("renewToken timed out"),Va(El)})).toPromise();case 14:_i=xa.sent,_s=_i.ticket,xa.next=27;break;case 18:if(xa.prev=18,xa.t0=xa.catch(9),this.context.token=_n,xa.t0.code!==Fw&&xa.t0.code!==Gw){xa.next=23;break}throw new Gh("Invalid token",MI);case 23:if(xa.t0.code!==bl){xa.next=25;break}throw new Gh("The token expired",LI);case 25:if(!uc(xa.t0)){xa.next=27;break}throw new Pc("Renew token timed out",jp);case 27:ga=this.session,this.session.requestUpdateEdgeTicket(_s).toPromise().then(function(El){if(El.code!==0)throw new Pa(["RenewToken failure. The response code is %d",El.code],jp);ga.curLoginSockets.filter(function(Tl){return Tl!==void 0}).forEach(function(Tl){return Tl.ticket=_s})});case 29:case"end":return xa.stop()}},j,this,[[9,18]])})),function(j){return g.apply(this,arguments)})},{key:"queryPeersOnlineStatus",value:function(){var j=za(W.mark(function $(_n){var _i,_s,ga=this;return W.wrap(function(ba){for(;;)switch(ba.prev=ba.next){case 0:if(this.connectionState===Ea.CONNECTED){ba.next=2;break}throw new ia("The client is not logged in",JI);case 2:if(this.session!==void 0){ba.next=4;break}throw new rb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(!(!Array.isArray(_n)||_n.length===0||_n.some(function(xa){return!yb(xa)})||256<_n.length)){ba.next=6;break}throw new ja("invalid arguments",Lw);case 6:return ba.next=8,this.session.requestPeersOnlineStatus(_n).toPromise();case 8:return _i=ba.sent,_s=Pe(Ro(_i.userInfos,"account"),function(xa){return!!xa.ts}),Object.keys(_s).forEach(function(xa){if(xa in ga.subscribedPeerStatusCache&&ga.subscribedPeerStatusCache[xa]!==Oa.PeerOnlineState.UNREACHABLE){var El=_s[xa]?Oa.PeerOnlineState.ONLINE:Oa.PeerOnlineState.OFFLINE;ga.emit("PeersOnlineStatusChanged",E({},xa,El)),ga.subscribedPeerStatusCache[xa]=El}}),ba.abrupt("return",_s);case 12:case"end":return ba.stop()}},$,this)}));return function($){return j.apply(this,arguments)}}()},{key:"getChannelMemberCount",value:function(){var j=za(W.mark(function $(_n){var _i,_s,ga,ba,xa,El,Tl,Sl,Il;return W.wrap(function(Cl){for(;;)switch(Cl.prev=Cl.next){case 0:if(this.connectionState===Ea.CONNECTED){Cl.next=2;break}throw new ia("The client is not logged in",uI);case 2:if(this.session!==void 0){Cl.next=4;break}throw new rb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(Array.isArray(_n)&&_n.every(function(Nl){return typeof Nl=="string"})&&_n.length!==0){Cl.next=6;break}throw new ja("Invalid arguments: channelIds",tw);case 6:if(!(32<_n.length)){Cl.next=8;break}throw new ja("getChannelMemberCount exceed limit of 32 channelIds",tI);case 8:_i=0;case 9:if(!(_i<_n.length)){Cl.next=16;break}if(yb(_s=_n[_i])){Cl.next=13;break}throw new ja(["getChannelMemberCount channel id %s is invalid",_s],tw);case 13:_i++,Cl.next=9;break;case 16:return Cl.next=18,this.session.requestGetChannelMemberCount(_n).toPromise();case 18:for(ga=Cl.sent,ba=ga.groupInfos,xa={},El=0;El<ba.length;El++)Tl=ba[El],Sl=Tl.group,Il=Tl.memberCount,yb(Sl)&&typeof Il=="number"&&(this.internalEmitter.emit("channelMemberCountUpdated",Sl,Il),xa[Sl]=Il);return Cl.abrupt("return",xa);case 23:case"end":return Cl.stop()}},$,this)}));return function($){return j.apply(this,arguments)}}()},{key:"setLocalUserAttributes",value:function(){var j=za(W.mark(function $(_n){var _i,_s;return W.wrap(function(ga){for(;;)switch(ga.prev=ga.next){case 0:if(ri({attributes:_n,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:16384}),this.connectionState===Ea.CONNECTED){ga.next=3;break}throw new ia("The client is not logged in",Cd);case 3:if(this.session!==void 0){ga.next=5;break}throw new rb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 5:return _i=this.session.requestSetLocalUserAttributes(_n).toPromise(),_s={attribute:_n,promise:_i},this.attributeDrafts.add(_s),ga.prev=8,ga.next=11,_i;case 11:this.attributes=_n,ga.next=19;break;case 14:if(ga.prev=14,ga.t0=ga.catch(8),!Sa(ga.t0)){ga.next=18;break}throw ga.t0;case 18:throw new ja("arguments is not valid",Ub);case 19:return ga.prev=19,this.attributeDrafts.delete(_s),ga.finish(19);case 22:case"end":return ga.stop()}},$,this,[[8,14,19,22]])}));return function($){return j.apply(this,arguments)}}()},{key:"setChannelAttributes",value:function(){var j=za(W.mark(function $(_n,_i){var _s,ga,ba,xa,El,Tl=arguments;return W.wrap(function(Sl){for(;;)switch(Sl.prev=Sl.next){case 0:if(_s=2<Tl.length&&Tl[2]!==void 0?Tl[2]:{},ga=_s.enableNotificationToChannelMembers,ba=ga!==void 0&&ga,ri({attributes:_i,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:32768}),this.connectionState===Ea.CONNECTED){Sl.next=4;break}throw new ia("The client is not logged in",Cd);case 4:if(this.session!==void 0){Sl.next=6;break}throw new rb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 6:return xa=this.session.requestSetChannelAttributes(_n,_i,ba).toPromise(),Sl.prev=7,Sl.next=10,xa;case 10:El=Pe(_i,function(Il){return new Blob([Il]).size}),this.channelAttributesCacheLru.set(_n,El),Sl.next=19;break;case 14:if(Sl.prev=14,Sl.t0=Sl.catch(7),!Sa(Sl.t0)){Sl.next=18;break}throw Sl.t0;case 18:throw new ja("arguments is not valid",Ub);case 19:case"end":return Sl.stop()}},$,this,[[7,14]])}));return function($,_n){return j.apply(this,arguments)}}()},{key:"addOrUpdateLocalUserAttributes",value:function(){var j=za(W.mark(function $(_n){var _i,_s,ga;return W.wrap(function(ba){for(;;)switch(ba.prev=ba.next){case 0:if(_i=tb(tb({},this.attributes),_n),ri({attributes:_n,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:16384}),ri({attributes:_i,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:16384}),this.connectionState===Ea.CONNECTED){ba.next=5;break}throw new ia("The client is not logged in",Cd);case 5:if(this.session!==void 0){ba.next=7;break}throw new rb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 7:return _s=this.session.requestAddOrUpdateLocalUserAttributes(_n).toPromise(),ga={attribute:_i,promise:_s},this.attributeDrafts.add(ga),ba.prev=10,ba.next=13,_s;case 13:this.attributes=_i,ba.next=21;break;case 16:if(ba.prev=16,ba.t0=ba.catch(10),!Sa(ba.t0)){ba.next=20;break}throw ba.t0;case 20:throw new ja("arguments is not valid",Lw);case 21:return ba.prev=21,this.attributeDrafts.delete(ga),ba.finish(21);case 24:case"end":return ba.stop()}},$,this,[[10,16,21,24]])}));return function($){return j.apply(this,arguments)}}()},{key:"addOrUpdateChannelAttributes",value:function(){var j=za(W.mark(function $(_n,_i){var _s,ga,ba,xa,El,Tl,Sl,Il=arguments;return W.wrap(function(Cl){for(;;)switch(Cl.prev=Cl.next){case 0:if(_s=2<Il.length&&Il[2]!==void 0?Il[2]:{},ga=_s.enableNotificationToChannelMembers,ba=ga!==void 0&&ga,xa=this.channelAttributesCacheLru.get(_n,{}),El=Pe(_i,function(Nl){return new Blob([Nl]).size}),Tl=tb(tb({},xa),El),ri({attributes:_i,attrSizeMap:Tl,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:32768}),this.connectionState===Ea.CONNECTED){Cl.next=7;break}throw new ia("The client is not logged in",Cd);case 7:if(this.session!==void 0){Cl.next=9;break}throw new rb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 9:return Sl=this.session.requestAddOrUpdateChannelAttributes(_n,_i,ba).toPromise(),Cl.prev=10,Cl.next=13,Sl;case 13:this.channelAttributesCacheLru.set(_n,Tl),Cl.next=21;break;case 16:if(Cl.prev=16,Cl.t0=Cl.catch(10),!Sa(Cl.t0)){Cl.next=20;break}throw Cl.t0;case 20:throw new ja("arguments is not valid",Ub);case 21:case"end":return Cl.stop()}},$,this,[[10,16]])}));return function($,_n){return j.apply(this,arguments)}}()},{key:"deleteLocalUserAttributesByKeys",value:function(){var j=za(W.mark(function $(_n){var _i,_s,ga,ba;return W.wrap(function(xa){for(;;)switch(xa.prev=xa.next){case 0:if(Array.isArray(_n)&&_n.length!==0&&!_n.some(function(El){return El.length===0})){xa.next=2;break}throw new ia("arguments is not valid",Ub);case 2:if(this.connectionState===Ea.CONNECTED){xa.next=4;break}throw new ia("The client is not logged in",Cd);case 4:if(this.session!==void 0){xa.next=6;break}throw new rb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 6:return _i=this.session.requestDeleteLocalUserAttributesByKeys(_n).toPromise(),_s={attribute:Oo(this.attributes,_n),promise:_i},this.attributeDrafts.add(_s),xa.prev=9,xa.next=12,_i;case 12:for(ga=0;ga<_n.length;ga++)ba=_n[ga],delete this.attributes[ba];xa.next=20;break;case 15:if(xa.prev=15,xa.t0=xa.catch(9),!Sa(xa.t0)){xa.next=19;break}throw xa.t0;case 19:throw new ja("arguments is not valid",Ub);case 20:return xa.prev=20,this.attributeDrafts.delete(_s),xa.finish(20);case 23:case"end":return xa.stop()}},$,this,[[9,15,20,23]])}));return function($){return j.apply(this,arguments)}}()},{key:"deleteChannelAttributesByKeys",value:function(){var j=za(W.mark(function $(_n,_i){var _s,ga,ba,xa,El,Tl,Sl,Il=arguments;return W.wrap(function(Cl){for(;;)switch(Cl.prev=Cl.next){case 0:if(_s=2<Il.length&&Il[2]!==void 0?Il[2]:{},ga=_s.enableNotificationToChannelMembers,ba=ga!==void 0&&ga,Array.isArray(_i)&&_i.length!==0&&yb(_n)&&!_i.some(function(Nl){return Nl.length===0||512<Nl.length})){Cl.next=3;break}throw new ia("arguments is not valid",Ub);case 3:if(this.connectionState===Ea.CONNECTED){Cl.next=5;break}throw new ia("The client is not logged in",Cd);case 5:if(this.session!==void 0){Cl.next=7;break}throw new rb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 7:return xa=this.session.requestDeleteChannelAttributesByKeys(_n,_i,ba).toPromise(),Cl.prev=8,Cl.next=11,xa;case 11:if(El=this.channelAttributesCacheLru.get(_n))for(Tl=0;Tl<_i.length;Tl++)Sl=_i[Tl],delete El[Sl];Cl.next=20;break;case 15:if(Cl.prev=15,Cl.t0=Cl.catch(8),!Sa(Cl.t0)){Cl.next=19;break}throw Cl.t0;case 19:throw new ja("arguments is not valid",Ub);case 20:case"end":return Cl.stop()}},$,this,[[8,15]])}));return function($,_n){return j.apply(this,arguments)}}()},{key:"clearLocalUserAttributes",value:function(){var j=za(W.mark(function $(){var _n,_i;return W.wrap(function(_s){for(;;)switch(_s.prev=_s.next){case 0:if(this.connectionState===Ea.CONNECTED){_s.next=2;break}throw new ia("The client is not logged in",Cd);case 2:if(this.session!==void 0){_s.next=4;break}throw new rb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:return _n=this.session.requestClearLocalUserAttributes().toPromise(),_i={attribute:{},promise:_n},this.attributeDrafts.add(_i),_s.prev=7,_s.next=10,_n;case 10:this.attributes={},_s.next=18;break;case 13:if(_s.prev=13,_s.t0=_s.catch(7),!Sa(_s.t0)){_s.next=17;break}throw _s.t0;case 17:throw new ja("arguments is not valid",Ub);case 18:return _s.prev=18,this.attributeDrafts.delete(_i),_s.finish(18);case 21:case"end":return _s.stop()}},$,this,[[7,13,18,21]])}));return function(){return j.apply(this,arguments)}}()},{key:"clearChannelAttributes",value:function(){var j=za(W.mark(function $(_n){var _i,_s,ga,ba,xa=arguments;return W.wrap(function(El){for(;;)switch(El.prev=El.next){case 0:if(_i=1<xa.length&&xa[1]!==void 0?xa[1]:{},_s=_i.enableNotificationToChannelMembers,ga=_s!==void 0&&_s,this.connectionState===Ea.CONNECTED){El.next=3;break}throw new ia("The client is not logged in",Cd);case 3:if(this.session!==void 0){El.next=5;break}throw new rb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 5:return ba=this.session.requestClearChannelAttributes(_n,ga).toPromise(),El.prev=6,El.next=9,ba;case 9:this.channelAttributesCacheLru.delete(_n),El.next=17;break;case 12:if(El.prev=12,El.t0=El.catch(6),!Sa(El.t0)){El.next=16;break}throw El.t0;case 16:throw new ja("arguments is not valid",Ub);case 17:case"end":return El.stop()}},$,this,[[6,12]])}));return function($){return j.apply(this,arguments)}}()},{key:"getUserAttributes",value:function(){var j=za(W.mark(function $(_n){var _i,_s,ga;return W.wrap(function(ba){for(;;)switch(ba.prev=ba.next){case 0:if(yb(_n)){ba.next=2;break}throw new ja("Not a valid user ID",Ub);case 2:if(this.connectionState===Ea.CONNECTED){ba.next=4;break}throw new ia("The client is not logged in",Cd);case 4:if(this.session!==void 0){ba.next=6;break}throw new rb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 6:return ba.prev=6,ba.next=9,this.session.requestGetUserAttributeKeys(_n).toPromise();case 9:return _i=ba.sent,_s=_i.keys,ba.next=13,this.session.requestGetUserAttributesByKeys(_n,_s.slice(0,512)).toPromise();case 13:ga=ba.sent,ba.next=21;break;case 16:if(ba.prev=16,ba.t0=ba.catch(6),!Sa(ba.t0)){ba.next=20;break}throw ba.t0;case 20:throw new ja("arguments is not valid",Ub);case 21:return ba.abrupt("return",Dv(ga.attributeInfos.map(function(xa){return[xa.key,xa.value]})));case 22:case"end":return ba.stop()}},$,this,[[6,16]])}));return function($){return j.apply(this,arguments)}}()},{key:"getChannelAttributes",value:function(){var j=za(W.mark(function $(_n){var _i,_s,ga,ba,xa,El,Tl,Sl,Il,Cl,Nl;return W.wrap(function(Dl){for(;;)switch(Dl.prev=Dl.next){case 0:if(yb(_n)){Dl.next=2;break}throw new ja("Not a valid channel ID",Ub);case 2:if(this.connectionState===Ea.CONNECTED){Dl.next=4;break}throw new ia("The client is not logged in",Cd);case 4:if(this.session!==void 0){Dl.next=6;break}throw new rb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 6:return Dl.prev=6,Dl.next=9,this.session.requestGetChannelAttributesKeys(_n).toPromise();case 9:return _i=Dl.sent,_s=_i.keys,Dl.next=13,this.session.requestGetChannelAttributesByKeys(_n,_s).toPromise();case 13:ga=Dl.sent,ba=ga.attributeMaps,Dl.next=22;break;case 17:if(Dl.prev=17,Dl.t0=Dl.catch(6),!Sa(Dl.t0)){Dl.next=21;break}throw Dl.t0;case 21:throw new ja("arguments is not valid",Ub);case 22:xa={},El=0;case 24:if(!(El<ba.length)){Dl.next=32;break}if(Tl=ba[El],Sl=Tl.key,Il=Tl.ms,Cl=Tl.value,Nl=Tl.origin,typeof Sl=="string"&&D.isLong(Il)&&typeof Cl=="string"&&yb(Nl)){Dl.next=28;break}return Dl.abrupt("break",32);case 28:xa[Sl]={value:Cl,lastUpdateUserId:Nl,lastUpdateTs:Il.toNumber()};case 29:El++,Dl.next=24;break;case 32:return this.channelAttributesCacheLru.set(_n,Pe(xa,function(Ul){return new Blob([Ul.value]).size})),Dl.abrupt("return",xa);case 34:case"end":return Dl.stop()}},$,this,[[6,17]])}));return function($){return j.apply(this,arguments)}}()},{key:"getChannelAttributesByKeys",value:function(){var j=za(W.mark(function $(_n,_i){var _s,ga,ba,xa,El,Tl,Sl,Il,Cl,Nl;return W.wrap(function(Dl){for(;;)switch(Dl.prev=Dl.next){case 0:if(this.connectionState===Ea.CONNECTED){Dl.next=2;break}throw new ia("The client is not logged in",Cd);case 2:if(this.session!==void 0){Dl.next=4;break}throw new rb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:return os(_n,_i),Dl.prev=5,Dl.next=8,this.session.requestGetChannelAttributesByKeys(_n,_i).toPromise();case 8:_s=Dl.sent,ga=_s.attributeMaps,Dl.next=17;break;case 12:if(Dl.prev=12,Dl.t0=Dl.catch(5),!Sa(Dl.t0)){Dl.next=16;break}throw Dl.t0;case 16:throw new ja("arguments is not valid",Ub);case 17:ba={},xa=this.channelAttributesCacheLru.get(_n,{}),El=0;case 20:if(!(El<ga.length)){Dl.next=29;break}if(Tl=ga[El],Sl=Tl.key,Il=Tl.ms,Cl=Tl.value,Nl=Tl.origin,typeof Sl=="string"&&D.isLong(Il)&&typeof Cl=="string"&&yb(Nl)){Dl.next=24;break}return Dl.abrupt("break",29);case 24:xa[Sl]=new Blob([Cl]).size,ba[Sl]={value:Cl,lastUpdateUserId:Nl,lastUpdateTs:Il.toNumber()};case 26:El++,Dl.next=20;break;case 29:return this.channelAttributesCacheLru.set(_n,xa),Dl.abrupt("return",ba);case 31:case"end":return Dl.stop()}},$,this,[[5,12]])}));return function($,_n){return j.apply(this,arguments)}}()},{key:"getUserAttributesByKeys",value:function(){var j=za(W.mark(function $(_n,_i){var _s;return W.wrap(function(ga){for(;;)switch(ga.prev=ga.next){case 0:if(this.connectionState===Ea.CONNECTED){ga.next=2;break}throw new ia("The client is not logged in",Cd);case 2:if(this.session!==void 0){ga.next=4;break}throw new rb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:return os(_n,_i),ga.prev=5,ga.next=8,this.session.requestGetUserAttributesByKeys(_n,_i).toPromise();case 8:_s=ga.sent,ga.next=16;break;case 11:if(ga.prev=11,ga.t0=ga.catch(5),!Sa(ga.t0)){ga.next=15;break}throw ga.t0;case 15:throw new ja("arguments is not valid",Ub);case 16:return ga.abrupt("return",Dv(_s.attributeInfos.map(function(ba){return[ba.key,ba.value]})));case 17:case"end":return ga.stop()}},$,this,[[5,11]])}));return function($,_n){return j.apply(this,arguments)}}()},{key:"getUserMetadata",value:function(){var j=za(W.mark(function $(_n){var _i,_s;return W.wrap(function(ga){for(;;)switch(ga.prev=ga.next){case 0:if(this.connectionState===Ea.CONNECTED){ga.next=2;break}throw new ia("The client is not logged in",oc);case 2:if(this.session!==void 0){ga.next=4;break}throw new rb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(!_n.split("").includes(".")){ga.next=6;break}throw new ja("The uid cannot contain the character .",Mb);case 6:return ga.prev=6,ga.next=9,this.session.requestGetLocalMetaData(_n).toPromise();case 9:return _i=ga.sent,_s=Wm(_i),ga.abrupt("return",_s);case 14:if(ga.prev=14,ga.t0=ga.catch(6),!Sa(ga.t0)){ga.next=18;break}throw ga.t0;case 18:throw new ja("arguments is not valid",Mb);case 19:case"end":return ga.stop()}},$,this,[[6,14]])}));return function($){return j.apply(this,arguments)}}()},{key:"setLocalUserMetadata",value:function(){var j=za(W.mark(function $(_n,_i){return W.wrap(function(_s){for(;;)switch(_s.prev=_s.next){case 0:if(this.connectionState===Ea.CONNECTED){_s.next=2;break}throw new ia("The client is not logged in",oc);case 2:if(this.session!==void 0){_s.next=4;break}throw new rb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:return _s.prev=4,_s.next=7,this.session.requestSetLocalMetadata(_n,_i).toPromise();case 7:_s.next=14;break;case 9:if(_s.prev=9,_s.t0=_s.catch(4),!Sa(_s.t0)){_s.next=13;break}throw _s.t0;case 13:throw new ja("arguments is not valid",Mb);case 14:case"end":return _s.stop()}},$,this,[[4,9]])}));return function($,_n){return j.apply(this,arguments)}}()},{key:"clearLocalUserMetadata",value:function(){var j=za(W.mark(function $(_n){return W.wrap(function(_i){for(;;)switch(_i.prev=_i.next){case 0:if(this.connectionState===Ea.CONNECTED){_i.next=2;break}throw new ia("The client is not logged in",oc);case 2:if(this.session!==void 0){_i.next=4;break}throw new rb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:return _i.prev=4,_i.next=7,this.session.requestClearLocalMetadata(_n).toPromise();case 7:_i.next=14;break;case 9:if(_i.prev=9,_i.t0=_i.catch(4),!Sa(_i.t0)){_i.next=13;break}throw _i.t0;case 13:throw new ja("arguments is not valid",Mb);case 14:case"end":return _i.stop()}},$,this,[[4,9]])}));return function($){return j.apply(this,arguments)}}()},{key:"addLocalUserMetadata",value:function(){var j=za(W.mark(function $(_n,_i){return W.wrap(function(_s){for(;;)switch(_s.prev=_s.next){case 0:if(this.connectionState===Ea.CONNECTED){_s.next=2;break}throw new ia("The client is not logged in",oc);case 2:if(this.session!==void 0){_s.next=4;break}throw new rb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:return _s.prev=4,_s.next=7,this.session.requestAddLocalMetadata(_n,_i).toPromise();case 7:_s.next=14;break;case 9:if(_s.prev=9,_s.t0=_s.catch(4),!Sa(_s.t0)){_s.next=13;break}throw _s.t0;case 13:throw new ja("arguments is not valid",Mb);case 14:case"end":return _s.stop()}},$,this,[[4,9]])}));return function($,_n){return j.apply(this,arguments)}}()},{key:"updateLocalUserMetadata",value:function(){var j=za(W.mark(function $(_n,_i){return W.wrap(function(_s){for(;;)switch(_s.prev=_s.next){case 0:if(this.connectionState===Ea.CONNECTED){_s.next=2;break}throw new ia("The client is not logged in",oc);case 2:if(this.session!==void 0){_s.next=4;break}throw new rb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:return _s.prev=4,_s.next=7,this.session.requestUpdateLocalMetadata(_n,_i).toPromise();case 7:_s.next=14;break;case 9:if(_s.prev=9,_s.t0=_s.catch(4),!Sa(_s.t0)){_s.next=13;break}throw _s.t0;case 13:throw new ja("arguments is not valid",Mb);case 14:case"end":return _s.stop()}},$,this,[[4,9]])}));return function($,_n){return j.apply(this,arguments)}}()},{key:"deleteLocalUserMetadata",value:function(){var j=za(W.mark(function $(_n,_i){return W.wrap(function(_s){for(;;)switch(_s.prev=_s.next){case 0:if(this.connectionState===Ea.CONNECTED){_s.next=2;break}throw new ia("The client is not logged in",oc);case 2:if(this.session!==void 0){_s.next=4;break}throw new rb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:return _s.prev=4,_s.next=7,this.session.requestDeleteLocalMetadata(_n,_i).toPromise();case 7:_s.next=14;break;case 9:if(_s.prev=9,_s.t0=_s.catch(4),!Sa(_s.t0)){_s.next=13;break}throw _s.t0;case 13:throw new ja("arguments is not valid",Mb);case 14:case"end":return _s.stop()}},$,this,[[4,9]])}));return function($,_n){return j.apply(this,arguments)}}()},{key:"subscribeUserMetadata",value:function(){var j=za(W.mark(function $(_n){return W.wrap(function(_i){for(;;)switch(_i.prev=_i.next){case 0:if(this.connectionState===Ea.CONNECTED){_i.next=2;break}throw new ia("The client is not logged in",oc);case 2:if(this.session!==void 0){_i.next=4;break}throw new rb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(yb(_n)){_i.next=6;break}throw new ja("Not a valid user ID",dl);case 6:if(!_n.split("").includes(".")){_i.next=8;break}throw new ja("The uid cannot contain the character .",dl);case 8:if(!(51<=Object.values(this.subscribedUserMetaCache).filter(function(_s){return _s===Oa.subscribedState.SUBSCRIBED}).length)){_i.next=10;break}throw new Dc("Subscribed user metadata overflows",OI);case 10:return _i.prev=10,_i.next=13,this.session.requestSubscribeUserMetadata(_n,"NORMAL").toPromise();case 13:this.subscribedUserMetaCache[_n]=Oa.subscribedState.SUBSCRIBED,_i.next=21;break;case 16:if(_i.prev=16,_i.t0=_i.catch(10),!Sa(_i.t0)){_i.next=20;break}throw _i.t0;case 20:throw new ja("arguments is not valid",Mb);case 21:case"end":return _i.stop()}},$,this,[[10,16]])}));return function($){return j.apply(this,arguments)}}()},{key:"unsubscribeUserMetadata",value:function(){var j=za(W.mark(function $(_n){return W.wrap(function(_i){for(;;)switch(_i.prev=_i.next){case 0:if(this.connectionState===Ea.CONNECTED){_i.next=2;break}throw new ia("The client is not logged in",oc);case 2:if(this.session!==void 0){_i.next=4;break}throw new rb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(yb(_n)){_i.next=6;break}throw new ja("Not a valid user ID",dl);case 6:if(!_n.split("").includes(".")){_i.next=8;break}throw new ja("The uid cannot contain the character .",dl);case 8:if(this.subscribedUserMetaCache[_n]&&this.subscribedUserMetaCache[_n]!==Oa.subscribedState.UNSUBSCRIBED){_i.next=10;break}throw new ia("The user can not be unsubscribed",PI);case 10:return _i.prev=10,_i.next=13,this.session.requestUnsubscribeUserMetadata(_n);case 13:this.subscribedUserMetaCache[_n]=Oa.subscribedState.UNSUBSCRIBED,_i.next=21;break;case 16:if(_i.prev=16,_i.t0=_i.catch(10),!Sa(_i.t0)){_i.next=20;break}throw _i.t0;case 20:throw new ja("arguments is not valid",Mb);case 21:case"end":return _i.stop()}},$,this,[[10,16]])}));return function($){return j.apply(this,arguments)}}()},{key:"login",value:function(){var j=za(W.mark(function $(_n){var _i,_s,ga,ba,xa,El;return W.wrap(function(Tl){for(;;)switch(Tl.prev=Tl.next){case 0:if(Zr(!0),_s=Rj(),ga=_n.token,_n.token===this.context.appId&&(ga=void 0),$a("Session",{appId:this.context.appId,did:navigator.userAgent,elapse:Nb(this.session&&this.session.startTime),index:{index1:_n.uid,index2:this.context.appId,index3:"enableLogUpload=".concat(this.context.config.enableLogUpload)},installId:hj,lts:D.fromNumber(Date.now()),os:7,sid:fc(_s),token:ga||"",userId:_n.uid,ver:"1.6.0-205",buildno:928,subVersion:228,version:7},(_i=this.context.config.enableCloudProxy)!==null&&_i!==void 0&&_i,!0),Lg(_n)&&yb(_n.uid)){Tl.next=7;break}throw new ja("not a valid user id",al);case 7:if(typeof ga!="string"||!ga){Tl.next=11;break}this.context.token=ga,Tl.next=13;break;case 11:if(typeof ga=="string"||ga==null){Tl.next=13;break}throw new ja('The "token" is not a valid string.',al);case 13:return ba=Date.now(),this.context.sid=fc(_s),this.loginPromise=this.loginImpl({uid:_n.uid,instanceId:_s}),this.info("RTM Client logging in as ".concat(wb(_n.uid))),Tl.prev=17,Tl.next=20,this.loginPromise;case 20:return Tl.next=22,(xa=this.session)===null||xa===void 0?void 0:xa.requestSubscribeUserMetadata(_n.uid,"JOIN").toPromise();case 22:this.subscribedUserMetaCache[_n.uid]=Oa.subscribedState.SUBSCRIBED,Tl.next=31;break;case 25:throw Tl.prev=25,Tl.t0=Tl.catch(17),Sa(Tl.t0)&&$a("Link",{ackedServerIp:"",destServerIp:"",ec:Tl.t0.code||1,sc:Tl.t0.serverCode,elapse:Nb(this.session&&this.session.startTime),lts:D.fromNumber(Date.now()),responseTime:Date.now()-ba,sid:fc(_s),userId:_n.uid},(El=this.context.config.enableCloudProxy)!==null&&El!==void 0&&El),this.context.token=void 0,this.context.socketUseProxy=!1,Tl.t0;case 31:return Tl.prev=31,this.loginPromise=void 0,Tl.finish(31);case 34:this.context.socketUseProxy&&this.emit("FallbackProxyConnected"),Zr(!1);case 36:case"end":return Tl.stop()}},$,this,[[17,25,31,34]])}));return function($){return j.apply(this,arguments)}}()},{key:"logout",value:function(){var j=za(W.mark(function $(){var _n;return W.wrap(function(_i){for(;;)switch(_i.prev=_i.next){case 0:if(!this.loginPromise){_i.next=3;break}return _i.next=3,this.loginPromise;case 3:if(this.connectionState!==Ea.DISCONNECTED){_i.next=6;break}throw this.logError("Already in logout state"),new ia("Logout failure. The client has already been logged out",Hw);case 6:if(this.internalEmitter.emit("LOGOUT"),this.connectionState!==Ea.ABORTED){_i.next=11;break}return this.info('Reset connection state from "ABORTED" to "DISCONNECTED"'),this.onConnectionStateChanged(Ea.DISCONNECTED,Jc.LOGOUT),_i.abrupt("return");case 11:if(this.session!==void 0){_i.next=14;break}return this.onConnectionStateChanged(Ea.DISCONNECTED,Jc.LOGOUT),_i.abrupt("return");case 14:return $a("Logout",{elapse:Nb(this.session.startTime),lts:D.fromNumber(Date.now()),sid:fc(this.session.instanceId),userId:this.context.uid},(_n=this.context.config.enableCloudProxy)!==null&&_n!==void 0&&_n),_i.next=17,this.session.logoutHandler();case 17:this.onConnectionStateChanged(Ea.DISCONNECTED,Jc.LOGOUT),this.log("Log out success");case 19:case"end":return _i.stop()}},$,this)}));return function(){return j.apply(this,arguments)}}()},{key:"logoutSync",value:function(){var j,$=this;if(this.connectionState===Ea.DISCONNECTED)throw this.logError("Already in logout state"),new ia("Logout failure. The client has already been logged out",Hw);this.connectionState===Ea.ABORTED?this.info('Reset connection state from "ABORTED" to "DISCONNECTED"'):this.session!==void 0&&($a("Logout",{elapse:Nb(this.session.startTime),lts:D.fromNumber(Date.now()),sid:fc(this.session.instanceId),userId:this.context.uid},(j=this.context.config.enableCloudProxy)!==null&&j!==void 0&&j),this.session.logoutHandler().then(function(){$.log("Log out success")})),this.onConnectionStateChanged(Ea.DISCONNECTED,Jc.LOGOUT)}},{key:"sendMessageToPeer",value:function(){var j=za(W.mark(function $(_n,_i){var _s,ga,ba=this;return W.wrap(function(xa){for(;;)switch(xa.prev=xa.next){case 0:if(vs(_n,si),_s=_n.messageType==="TEXT"?vb.P2pSMsgNoOfflineFlag:vb.P2pRMsgNoOfflineFlag,this.connectionState!==Ea.RECONNECTING){xa.next=5;break}return ga=Date.now(),xa.abrupt("return",new Promise(function(El,Tl){var Sl,Il=(Sl=za(W.mark(function Nl(){var Dl;return W.wrap(function(Ul){for(;;)switch(Ul.prev=Ul.next){case 0:if(ba.session!==void 0){Ul.next=2;break}throw new rb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 2:return Dl=Date.now()-ga,Ul.prev=3,Ul.t0=El,Ul.next=7,Uj({message:_n,peerId:_i,toPeer:!0,session:ba.session,errorCodes:{NOT_LOGGED_IN:ip,TOO_OFTEN:Jw},diff:Dl,logger:ba.logger});case 7:Ul.t1=Ul.sent,(0,Ul.t0)(Ul.t1),Ul.next=18;break;case 11:Ul.prev=11,Ul.t2=Ul.catch(3),uc(Ul.t2)&&(ba.session.emit("messageCount",{messageCategory:_s,type:"common",key:"sentcount"}),ba.session.emit("messageCount",{messageCategory:_s,type:"common",key:"timeoutcount"}),Tl(new Pc(vg(ba.name,"sendMessageToPeer",1e4),hp))),Sa(Ul.t2)&&Tl(Ul.t2),ba.session.emit("messageCount",{messageCategory:_s,type:"common",key:"sentcount"}),ba.session.emit("messageCount",{messageCategory:_s,type:"common",key:"unknowerrorcount"}),Tl(new Pa("Peer-to-peer message send failure",{code:Iw,originalError:Ul.t2}));case 18:return Ul.prev=18,clearTimeout(Cl),Ul.finish(18);case 21:case"end":return Ul.stop()}},Nl,null,[[3,11,18,21]])})),function(){return Sl.apply(this,arguments)});ba.internalEmitter.once("RECONNECTED",Il);var Cl=setTimeout(function(){ba.internalEmitter.off("RECONNECTED",Il),Tl(new Pc(vg(ba.name,"sendMessageToPeer",1e4),hp))},9e3)}));case 5:if(this.connectionState===Ea.CONNECTED){xa.next=7;break}throw new ia("Failed to send the peer-to-peer message. The client is not logged in",ip);case 7:if(this.session!==void 0){xa.next=9;break}throw new rb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 9:return xa.prev=9,xa.next=12,Uj({message:_n,peerId:_i,toPeer:!0,session:this.session,errorCodes:{NOT_LOGGED_IN:ip,TOO_OFTEN:Jw},diff:0,logger:this.logger});case 12:return xa.abrupt("return",xa.sent);case 15:if(xa.prev=15,xa.t0=xa.catch(9),!uc(xa.t0)){xa.next=21;break}throw this.session.emit("messageCount",{messageCategory:_s,type:"common",key:"sentcount"}),this.session.emit("messageCount",{messageCategory:_s,type:"common",key:"timeoutcount"}),new Pc(vg(this.name,"sendMessageToPeer",1e4),hp);case 21:if(!Sa(xa.t0)){xa.next=23;break}throw xa.t0;case 23:throw this.session.emit("messageCount",{messageCategory:_s,type:"common",key:"sentcount"}),this.session.emit("messageCount",{messageCategory:_s,type:"common",key:"unknowerrorcount"}),new Pa("Peer-to-peer message send failure",{code:Iw,originalError:xa.t0});case 26:case"end":return xa.stop()}},$,this,[[9,15]])}));return function($,_n){return j.apply(this,arguments)}}()},{key:"createChannel",value:function(j){var $=this;if(!yb(j))throw new ja(["The %s in the arguments is invalid",Object.keys({channelId:j})[0]],sI);return new IP(j,function(){return $.session},this,this.logger)}},{key:"createMetadataItem",value:function(){return new Fs}},{key:"createLocalInvitation",value:function(j){if(!yb(j))throw new ja(["The %s in the arguments is invalid",Object.keys({calleeId:j})[0]],ve);return this.invitationManager.genLocalInvitation(j)}},{key:"subscribePeersOnlineStatus",value:function(){var j=za(W.mark(function $(_n){var _i,_s,ga,ba,xa,El,Tl,Sl,Il,Cl,Nl,Dl,Ul,Kl=this;return W.wrap(function(Jl){for(;;)switch(Jl.prev=Jl.next){case 0:if(this.connectionState===Ea.CONNECTED){Jl.next=2;break}throw new ia("The client is not logged in",kp);case 2:if(this.session!==void 0){Jl.next=4;break}throw new rb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(Array.isArray(_n)&&_n.length!==0){Jl.next=6;break}throw new ja("Invalid arguments: peerIds",jj);case 6:_i=0;case 7:if(!(_i<_n.length)){Jl.next=14;break}if(yb(_s=_n[_i])){Jl.next=11;break}throw new ja(["subscribePeersOnlineStatus peer id %s is invalid",_s],jj);case 11:_i++,Jl.next=7;break;case 14:if(!(512<(ga=_n&&_n.length?Do(_n):[]).length+Object.keys(this.subscribedPeerStatusCache).length+this.pendingPeerStatusSubCount)){Jl.next=17;break}throw new Dc("Subscribed peers overflows",Ow);case 17:return this.pendingPeerStatusSubCount+=ga.length,Jl.next=20,this.session.requestSubscribePeersOnlineStatus(ga).toPromise();case 20:ba=Jl.sent,xa=ba.errors,this.pendingPeerStatusSubCount-=ga.length,El=[],Tl=[],Sl=0;case 26:if(!(Sl<xa.length)){Jl.next=34;break}if(Il=xa[Sl],Cl=Il.code,typeof(Nl=Il.account)=="string"){Jl.next=30;break}throw new Pa("Returned account is invalid",Nw);case 30:Cl!==0&&El.push(Nl);case 31:Sl++,Jl.next=26;break;case 34:for(Dl=0;Dl<ga.length;Dl++)Ul=ga[Dl],El.includes(Ul)||(Tl.push(Ul),this.subscribedPeerStatusCache[Ul]=void 0);if(this.session.requestPeersOnlineStatus(Tl).pipe(Wa(function(Ep){return Pe(Ro(Ep.userInfos,"account"),function(_p){return!!_p.ts})})).subscribe(function(Ep){Ep=Pe(Ep,function(_p,Ip){return _p=_p?Oa.PeerOnlineState.ONLINE:Oa.PeerOnlineState.OFFLINE,Kl.subscribedPeerStatusCache[Ip]=_p}),Kl.emit("PeersOnlineStatusChanged",Ep)}),El.length===0){Jl.next=38;break}throw new Pa("Subscription failed",Nw);case 38:case"end":return Jl.stop()}},$,this)}));return function($){return j.apply(this,arguments)}}()},{key:"unsubscribePeersOnlineStatus",value:function(){var j=za(W.mark(function $(_n){var _i,_s,ga,ba,xa;return W.wrap(function(El){for(;;)switch(El.prev=El.next){case 0:if(this.connectionState===Ea.CONNECTED){El.next=2;break}throw new ia("The client is not logged in",kp);case 2:if(this.session!==void 0){El.next=4;break}throw new rb({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(Array.isArray(_n)&&_n.length!==0){El.next=6;break}throw new ja("Invalid arguments: peerIds",jj);case 6:_i=0;case 7:if(!(_i<_n.length)){El.next=14;break}if(yb(_s=_n[_i])){El.next=11;break}throw new ja(["subscribePeersOnlineStatus peer id %s is invalid",_s],jj);case 11:_i++,El.next=7;break;case 14:if(!(512<_n.length)){El.next=16;break}throw new Dc("Unsubscribed peers overflows",Ow);case 16:for(ga=_n&&_n.length?Do(_n):[],this.session.requestUnsubscribePeersOnlineStatus(ga),ba=0;ba<ga.length;ba++)xa=ga[ba],delete this.subscribedPeerStatusCache[xa];case 19:case"end":return El.stop()}},$,this)}));return function($){return j.apply(this,arguments)}}()},{key:"queryPeersBySubscriptionOption",value:function(){var j=za(W.mark(function $(_n){return W.wrap(function(_i){for(;;)switch(_i.prev=_i.next){case 0:if(this.connectionState===Ea.CONNECTED){_i.next=2;break}throw new ia("The client is not logged in",kp);case 2:if(_n!==Oa.PeerSubscriptionOption.ONLINE_STATUS){_i.next=4;break}return _i.abrupt("return",Object.keys(this.subscribedPeerStatusCache));case 4:throw new ja("Subscription option not supported",jj);case 5:case"end":return _i.stop()}},$,this)}));return function($){return j.apply(this,arguments)}}()},{key:"createMessage",value:function(j){return j}},{key:"loginImpl",value:function(){var j=za(W.mark(function $(_n){var _i,_s,ga,ba,xa,El,Tl,Sl,Il=this;return W.wrap(function(Cl){for(;;)switch(Cl.prev=Cl.next){case 0:if(_i=_n.uid,_s=_n.instanceId,ga=_n.forceLoginTime,ba=ga===void 0?0:ga,xa=_s,!(this.lastLoginTime!==void 0&&500>Date.now()-this.lastLoginTime)){Cl.next=4;break}throw new Fc(["The frequency of login exceeded the limit of %d queries per second",2],HI);case 4:if(this.connectionState===Ea.DISCONNECTED||ba!==0){Cl.next=6;break}throw new ia("The SDK is either logging in or has logged in the Agora RTM system",FI);case 6:Cl.prev=6,this.context.uid=_i,Cl.next=13;break;case 10:throw Cl.prev=10,Cl.t0=Cl.catch(6),new ja(["The %s in the arguments is invalid",Object.keys({uid:_i})[0]],al);case 13:return ba===0&&this.onConnectionStateChanged(Ea.CONNECTING,Jc.LOGIN),(El=new Gx(this.context,this.logger,!1)).blacklistedIP=this.blacklistedIP,this.session=Tl=new Pq(this.context,El,xa,this.logger),Sl=function(){Il.connectionState===Ea.CONNECTED&&(Il.onConnectionStateChanged(Ea.RECONNECTING,Jc.INTERRUPTED),Il.session)&&Il.session.once("userJoined",function(){Il.onConnectionStateChanged(Ea.CONNECTED,Jc.LOGIN_SUCCESS)})},Tl.on("connectionLost",Sl),Tl.on("tokenExpired",function(){Il.emit("TokenExpired")}),Tl.on("tokenPrivilegeWillExpire",this.TokenPrivilegeWillExpireHandler),Tl.once("userDrop",this.userDropHandler),this.session.on("peerTextMessage",function(Nl){Il.emit("MessageFromPeer",{text:Nl.text,messageType:Oa.MessageType.TEXT},Nl.peerId,Nl.properties)}),this.session.on("peerRawMessage",function(Nl){Il.emit("MessageFromPeer",{rawMessage:Nl.raw,description:Nl.desc,messageType:Oa.MessageType.RAW},Nl.peerId,Nl.properties)}),Tl.on("instanceChanged",function(Nl){return xa=Nl}),Tl.on("peerOnlineStatusChanged",function(Nl){var Dl=Nl.instance.toString()+Nl.state,Ul=Il.peerStatusSeqLru.get(Dl);!Ul||Nl.seq.greaterThan(Ul)?(Il.peerStatusSeqLru.set(Dl,Nl.seq),Nl.state!==Il.subscribedPeerStatusCache[Nl.peerId]&&Il.emit("PeersOnlineStatusChanged",E({},Nl.peerId,Nl.state)),Il.subscribedPeerStatusCache[Nl.peerId]=Nl.state,clearTimeout(Il.peerUnreachableTimers[Dl]),Nl.state===Oa.PeerOnlineState.UNREACHABLE&&(Il.peerUnreachableTimers[Dl]=setTimeout(function(){Il.subscribedPeerStatusCache[Nl.peerId]===Oa.PeerOnlineState.UNREACHABLE&&(Il.subscribedPeerStatusCache[Nl.peerId]=Oa.PeerOnlineState.ONLINE,Il.emit("PeersOnlineStatusChanged",E({},Nl.peerId,Oa.PeerOnlineState.ONLINE)))},3e4))):Il.log("peerOnlineStatusChanged dedup for %s, %d",Dl,Nl.seq.toNumber())}),Tl.on("invitationMessage",this.invitationManager.invitationMessageHandler.bind(this.invitationManager)),Tl.on("channelAttributesUpdated",function(Nl){var Dl=Nl.channelId;Nl=Nl.attributeMaps;for(var Ul={},Kl=0;Kl<Nl.length;Kl++){var Jl=Nl[Kl],Ep=Jl.key,_p=Jl.ms,Ip=Jl.value;if(Jl=Jl.origin,typeof Ep!="string"||!D.isLong(_p)||typeof Ip!="string"||!yb(Jl))break;Ul[Ep]=new Blob([Ip]).size}Il.channelAttributesCacheLru.set(Dl,Ul)}),Tl.on("userJoined",function(Nl){if(Object.keys(Il.attributes).length!==0){if(Il.session===void 0)return;Il.session.requestSetLocalUserAttributes(Il.attributes,Nl).toPromise()}if(Il.attributeDrafts.size!==0)for(var Dl=function(Jl,Ep){var _p=(Jl=Ep[Jl]).attribute;Jl.promise.then(function(){Il.session!==void 0&&Il.session.requestSetLocalUserAttributes(_p,Nl).toPromise()})},Ul=0,Kl=Array.from(Il.attributeDrafts);Ul<Kl.length;Ul++)Dl(Ul,Kl);Object.keys(Il.subscribedPeerStatusCache).length!==0&&Tl.requestSubscribePeersOnlineStatus(Object.keys(Il.subscribedPeerStatusCache))}),Tl.on("banEdgeIP",function(Nl){Il.banIP(Nl)}),Tl.on("userMetaDataUpdated",this.userMetaDataUpdatedHandler),this.lastLoginTime=Date.now(),Cl.prev=33,Cl.next=36,Tl.loginHandler().toPromise();case 36:Cl.next=54;break;case 38:if(Cl.prev=38,Cl.t1=Cl.catch(33),!(Cl.t1.name==="loginRespTimeout"&&2>ba)){Cl.next=47;break}return Tl.removeAllListeners(),Cl.next=44,this.loginImpl({uid:_i,instanceId:_s,forceLoginTime:ba+1});case 44:return Cl.abrupt("return");case 47:if(!uc(Cl.t1)){Cl.next=50;break}throw this.onConnectionStateChanged(Ea.DISCONNECTED,Jc.LOGIN_TIMEOUT),new Pc(vg(this.name,"login",12e3),GI);case 50:if(this.onConnectionStateChanged(Ea.DISCONNECTED,Jc.LOGIN_FAILURE),!Sa(Cl.t1)){Cl.next=53;break}throw Cl.t1;case 53:throw new Pa("Login failure",{code:Ew,originalError:Cl.t1});case 54:this.onConnectionStateChanged(Ea.CONNECTED,Jc.LOGIN_SUCCESS);case 55:case"end":return Cl.stop()}},$,this,[[6,10],[33,38]])}));return function($){return j.apply(this,arguments)}}()},{key:"rennectSubscribeduserMetadata",value:function(){var j=za(W.mark(function $(_n){var _i,_s;return W.wrap(function(ga){for(;;)switch(ga.prev=ga.next){case 0:_i=0;case 1:if(!(_i<_n.length)){ga.next=10;break}if(_s=_n[_i],!this.session){ga.next=7;break}return ga.next=6,this.session.requestSubscribeUserMetadata(_s,"RECONNECTED").toPromise();case 6:this.subscribedUserMetaCache[_s]=Oa.subscribedState.SUBSCRIBED;case 7:_i++,ga.next=1;break;case 10:case"end":return ga.stop()}},$,this)}));return function($){return j.apply(this,arguments)}}()},{key:"onConnectionStateChanged",value:function(j,$){var _n,_i,_s,ga=this;j===Ea.RECONNECTING&&(this.reconnId+=1),$a("ConnectionStateChange",{elapse:Nb(this.session&&this.session.startTime),lts:D.fromNumber(Date.now()),newState:FA[j],oldState:FA[this.connectionState],reason:JP[$],sid:fc(this.session&&this.session.instanceId||D.fromNumber(0)),userId:this.context.uid,reconnId:this.reconnId},(_n=this.context.config.enableCloudProxy)!==null&&_n!==void 0&&_n),this.connectionState===Ea.RECONNECTING&&j===Ea.CONNECTED&&(Object.keys(this.subscribedPeerStatusCache).length!==0&&this.session!==void 0&&this.session.requestPeersOnlineStatus(Object.keys(this.subscribedPeerStatusCache)).pipe(Wa(function(ba){return Pe(Ro(ba.userInfos,"account"),function(xa){return!!xa.ts})})).subscribe(function(ba){ba=Pe(ba,function(xa,El){return xa=xa?Oa.PeerOnlineState.ONLINE:Oa.PeerOnlineState.OFFLINE,ga.subscribedPeerStatusCache[El]=xa}),ga.emit("PeersOnlineStatusChanged",ba)}),Object.keys(this.subscribedUserMetaCache).length!==0&&this.session!==void 0&&this.rennectSubscribeduserMetadata(Object.keys(this.subscribedUserMetaCache)),(_i=this.session)!==null&&_i!==void 0&&_i.usedChannelIds&&0<((_s=this.session)===null||_s===void 0?void 0:_s.usedChannelIds.length)&&this.session.usedChannelIds.map(function(ba){var xa;return(xa=ga.session)===null||xa===void 0?void 0:xa.requestSubscribeChannelMetadata(ba,"RECONNECTED")}),this.internalEmitter.emit("RECONNECTED")),this.connectionState=j,j!==Ea.ABORTED&&j!==Ea.DISCONNECTED||(this.pendingPeerStatusSubCount=this.reconnId=0,this.attributes={},this.session&&(this.session.removeAllListeners(),this.session.msgDedupLru.empty(),this.session.dialogueSequenceLru.empty(),this.session.dialPendingMsgSubjectMap.clear()),this.channelAttributesCacheLru.empty(),this.peerStatusSeqLru.empty(),this.peerUnreachableTimers={},this.subscribedPeerStatusCache={},this.subscribedUserMetaCache={},this.attributeDrafts.clear(),this.context.token=void 0),this.emit("ConnectionStateChanged",j,$)}},{key:"banIP",value:function(j){var $;this.log("ip banned",j);var _n=($=this.blacklistedIP[j])!==null&&$!==void 0?$:0;this.blacklistedIP[j]=_n+1}}]),i}(Dd()),Na(ka.prototype,"renewToken",[gb],Object.getOwnPropertyDescriptor(ka.prototype,"renewToken"),ka.prototype),Na(ka.prototype,"queryPeersOnlineStatus",[gb],Object.getOwnPropertyDescriptor(ka.prototype,"queryPeersOnlineStatus"),ka.prototype),Na(ka.prototype,"getChannelMemberCount",[gb],Object.getOwnPropertyDescriptor(ka.prototype,"getChannelMemberCount"),ka.prototype),Na(ka.prototype,"setLocalUserAttributes",[gb],Object.getOwnPropertyDescriptor(ka.prototype,"setLocalUserAttributes"),ka.prototype),Na(ka.prototype,"setChannelAttributes",[gb],Object.getOwnPropertyDescriptor(ka.prototype,"setChannelAttributes"),ka.prototype),Na(ka.prototype,"addOrUpdateLocalUserAttributes",[gb],Object.getOwnPropertyDescriptor(ka.prototype,"addOrUpdateLocalUserAttributes"),ka.prototype),Na(ka.prototype,"addOrUpdateChannelAttributes",[gb],Object.getOwnPropertyDescriptor(ka.prototype,"addOrUpdateChannelAttributes"),ka.prototype),Na(ka.prototype,"deleteLocalUserAttributesByKeys",[gb],Object.getOwnPropertyDescriptor(ka.prototype,"deleteLocalUserAttributesByKeys"),ka.prototype),Na(ka.prototype,"deleteChannelAttributesByKeys",[gb],Object.getOwnPropertyDescriptor(ka.prototype,"deleteChannelAttributesByKeys"),ka.prototype),Na(ka.prototype,"clearLocalUserAttributes",[je],Object.getOwnPropertyDescriptor(ka.prototype,"clearLocalUserAttributes"),ka.prototype),Na(ka.prototype,"clearChannelAttributes",[gb],Object.getOwnPropertyDescriptor(ka.prototype,"clearChannelAttributes"),ka.prototype),Na(ka.prototype,"getUserAttributes",[gb],Object.getOwnPropertyDescriptor(ka.prototype,"getUserAttributes"),ka.prototype),Na(ka.prototype,"getChannelAttributes",[gb],Object.getOwnPropertyDescriptor(ka.prototype,"getChannelAttributes"),ka.prototype),Na(ka.prototype,"getChannelAttributesByKeys",[gb],Object.getOwnPropertyDescriptor(ka.prototype,"getChannelAttributesByKeys"),ka.prototype),Na(ka.prototype,"getUserAttributesByKeys",[gb],Object.getOwnPropertyDescriptor(ka.prototype,"getUserAttributesByKeys"),ka.prototype),Na(ka.prototype,"getUserMetadata",[gb],Object.getOwnPropertyDescriptor(ka.prototype,"getUserMetadata"),ka.prototype),Na(ka.prototype,"setLocalUserMetadata",[gb],Object.getOwnPropertyDescriptor(ka.prototype,"setLocalUserMetadata"),ka.prototype),Na(ka.prototype,"clearLocalUserMetadata",[gb],Object.getOwnPropertyDescriptor(ka.prototype,"clearLocalUserMetadata"),ka.prototype),Na(ka.prototype,"addLocalUserMetadata",[gb],Object.getOwnPropertyDescriptor(ka.prototype,"addLocalUserMetadata"),ka.prototype),Na(ka.prototype,"updateLocalUserMetadata",[gb],Object.getOwnPropertyDescriptor(ka.prototype,"updateLocalUserMetadata"),ka.prototype),Na(ka.prototype,"deleteLocalUserMetadata",[gb],Object.getOwnPropertyDescriptor(ka.prototype,"deleteLocalUserMetadata"),ka.prototype),Na(ka.prototype,"subscribeUserMetadata",[gb],Object.getOwnPropertyDescriptor(ka.prototype,"subscribeUserMetadata"),ka.prototype),Na(ka.prototype,"login",[je],Object.getOwnPropertyDescriptor(ka.prototype,"login"),ka.prototype),Na(ka.prototype,"logout",[je],Object.getOwnPropertyDescriptor(ka.prototype,"logout"),ka.prototype),Na(ka.prototype,"logoutSync",[je],Object.getOwnPropertyDescriptor(ka.prototype,"logoutSync"),ka.prototype),Na(ka.prototype,"sendMessageToPeer",[gb],Object.getOwnPropertyDescriptor(ka.prototype,"sendMessageToPeer"),ka.prototype),Na(ka.prototype,"createChannel",[gb],Object.getOwnPropertyDescriptor(ka.prototype,"createChannel"),ka.prototype),Na(ka.prototype,"createMetadataItem",[gb],Object.getOwnPropertyDescriptor(ka.prototype,"createMetadataItem"),ka.prototype),Na(ka.prototype,"createLocalInvitation",[gb],Object.getOwnPropertyDescriptor(ka.prototype,"createLocalInvitation"),ka.prototype),Na(ka.prototype,"subscribePeersOnlineStatus",[gb],Object.getOwnPropertyDescriptor(ka.prototype,"subscribePeersOnlineStatus"),ka.prototype),Na(ka.prototype,"unsubscribePeersOnlineStatus",[gb],Object.getOwnPropertyDescriptor(ka.prototype,"unsubscribePeersOnlineStatus"),ka.prototype),Na(ka.prototype,"queryPeersBySubscriptionOption",[gb],Object.getOwnPropertyDescriptor(ka.prototype,"queryPeersBySubscriptionOption"),ka.prototype),Na(ka.prototype,"createMessage",[je],Object.getOwnPropertyDescriptor(ka.prototype,"createMessage"),ka.prototype),ka),Uq,Vq,Wq,Xq,GA=(Uq=/Chrome\/([0-9.]+)/.exec((Wq=window)===null||Wq===void 0||(Xq=Wq.navigator)===null||Xq===void 0?void 0:Xq.userAgent))===null||Uq===void 0||(Vq=Uq[1])===null||Vq===void 0?void 0:Vq.split(".")[0];if(GA&&88<=parseInt(GA,10)&&!Kg()){var Yq,Hg=document.createElement("video"),Ig=document.createElement("canvas");Hg.setAttribute("style","display:none"),Hg.setAttribute("muted",""),Hg.muted=!0,Hg.setAttribute("autoplay",""),Hg.autoplay=!0,Hg.setAttribute("playsinline",""),Ig.setAttribute("style","display:none"),Ig.setAttribute("width","2"),Ig.setAttribute("height","2"),(Yq=Ig.getContext("2d"))===null||Yq===void 0||Yq.fillRect(0,0,1,1),Hg.srcObject=Ig==null?void 0:Ig.captureStream()}var HA={LOG_FILTER_OFF:{error:!1,warn:!1,info:!1,track:!1,debug:!1},LOG_FILTER_ERROR:{error:!0,warn:!1,info:!1,track:!1,debug:!1},LOG_FILTER_WARNING:{error:!0,warn:!0,info:!1,track:!1,debug:!1},LOG_FILTER_INFO:{error:!0,warn:!0,info:!0,track:!1,debug:!1},LOG_FILTER_DEBUG:{error:!0,warn:!0,info:!0,track:!0,debug:!0}},IA={enableLogUpload:!1,logFilter:HA.LOG_FILTER_INFO,enableCloudProxy:!1},wg=tb(tb({createInstance:function(h){var i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{},g=2<arguments.length?arguments[2]:void 0;if(!/^[\dA-Za-z]{32}$/.test(h))throw new ja(["The %s in the arguments is invalid",Object.keys({appId:h})[0]],sw);var _=Object.keys(i).filter(function(ba){return!(ba in IA)});if(_.length!==0)throw new ja("Invalid RTM config: ".concat(_.join(", ")),sw);var j=tb(tb({},IA),i);if(g!==void 0&&(!Array.isArray(g)||g.length===0))throw new ja("Invalid area config");if(g!=null){if(!g.every(function(ba){return ba in Oa.LegacyAreaCode}))throw new ja("Invalid area codes: ".concat(g.filter(function(ba){return!(ba in Oa)}).join(", ")));Ba=eh(g.map(function(ba){return SK[ba]}))}g=qp=qb.__global_unique_id__=(qb.__global_unique_id__||0)+1;var $=WK(j);_=XK(j);var _n=YK(j),_i=ZK(g,j),_s=zx(g,j),ga=_s("RTM:DEBUG","<Entry> ");return sx.rtmConfig=j,$("The Agora RTM Web SDK version is %s","1.6.0-205"),i.enableCloudProxy&&$("RTM cloud proxy enabled"),i.enableLogUpload&&$("Log upload enabled"),Ba&&ga("Area is set to %s",Array.from(Ba.CODES).map(function(ba){return vi(oa).find(function(xa){return oa[xa]===ba})}).join(", ")),ga("Creating an RtmClient instance"),ga('The Git commit ID is "'.concat("v1.5.1-67-g0f6d3600",'"')),ga("The App ID is %s",ws(h,4,10,"*".repeat(6))),$("The process ID is %s",hj),ga("The build is %s","v1.5.1-67-g0f6d3600"),ga("NODE_ENV is %s","production"),new KP(h,{genLogger:_s,genTracker:_i,info:$,warn:_,logError:_n,loggerId:g},j,function(ba){for(var xa=0,El=vi(ba);xa<El.length;xa++){var Tl=El[xa];try{var Sl=ba[Tl];Sl!=null&&(ba.enableCloudProxy&&$("RTM cloud proxy enabled"),ba.enableLogUpload&&$("Log upload enabled"),j[Tl]=Sl)}catch{throw new ja(["The %s in the arguments is invalid",Tl],void 0)}}})},BUILD:"v1.5.1-67-g0f6d3600",VERSION:"1.6.0-205",END_CALL_PREFIX:"AgoraRTMLegacyEndcallCompatibleMessagePrefix",processId:hj,ConnectionChangeReason:Oa.ConnectionChangeReason,ConnectionState:Oa.ConnectionState,LocalInvitationFailureReason:Oa.LocalInvitationFailureReason,LocalInvitationState:Oa.LocalInvitationState,RemoteInvitationFailureReason:Oa.RemoteInvitationFailureReason,RemoteInvitationState:Oa.RemoteInvitationState,MessageType:Oa.MessageType,PeerOnlineState:Oa.PeerOnlineState,PeerSubscriptionOption:Oa.PeerSubscriptionOption},HA),{},{setParameter:function(h,i){Object.keys(Yd).includes(h)&&(Yd[h]=i)},getParameter:function(h){return Yd[h]},setArea:function(h){var i=h.areaCodes;if(h=h.excludedArea,!Array.isArray(i)||i.length===0||!i.every(function(g){return g in Oa.AreaCode}))throw new ja("Invalid area config");if(h!==void 0&&h===Oa.AreaCode.GLOBAL)throw new ja("Excluded area cannot be global");if(h===void 0)Ba=eh(i.map(function(g){return oa[g]}));else{if(i.includes(h))throw new ja("Excluded area cannot be in areaCodes");if(!(h in oa))throw new ja("Invalid excludedArea:",h);Ba=tC({areas:i.map(function(g){return oa[g]}),excludedArea:oa[h]})}}});return wg})})(agoraRtmSdk);const AgoraRTM=getDefaultExportFromCjs$1(agoraRtmSdkExports),appId="51335c0cafd248d6b0e30d4a0f722e96",Call=()=>{const{channelCode:h}=useParams(),[i,g]=reactExports.useState(!0),[_,j]=reactExports.useState(!0),[$,_n]=reactExports.useState(!1),[_i,_s]=reactExports.useState(new Array),[ga,ba]=reactExports.useState(),[xa,El]=reactExports.useState(),[Tl,Sl]=reactExports.useState(),[Il,Cl]=reactExports.useState(),[Nl,Dl]=reactExports.useState(!1),[Ul,Kl]=reactExports.useState(!1),[Jl,Ep]=reactExports.useState(),[_p,Ip]=reactExports.useState(""),[Up,yp]=reactExports.useState(""),[Ap,Cp]=reactExports.useState(""),Mp=reactExports.useRef(null),[wp,Np]=reactExports.useState({}),[Fp,Hp]=reactExports.useState({}),[xp,Gp]=reactExports.useState("audience"),[$p,c0]=reactExports.useState(!0),[n0,C0]=reactExports.useState(),[Op,Q0]=reactExports.useState(),[dy,Yy]=reactExports.useState([]),J_=()=>{getSessionInfo(h).then(S0=>{var w_,Ay;Np(S0);const $0=localStorage.getItem("token"),ey=decodetoken($0);console.log("__USER",ey),Hp(ey),((Ay=(w_=S0.lecturer)==null?void 0:w_.id)==null?void 0:Ay.toString())==decodetoken($0)._id?Gp("host"):Gp("audience")}).catch(console.error)};reactExports.useEffect(()=>{Tl&&(Tl.setEnabled(!0),Tl.play(Mp.current))},[Tl]);const R0=S0=>new Promise(($0,ey)=>{getUser(S0).then(w_=>{console.log("Username:",w_.username),$0(w_.username)}).catch(w_=>{console.log(w_),ey(w_)})}),ry=S0=>{for(let $0 of S0)q0($0)},q0=S0=>{if(_i.find(ey=>ey.uid==S0.uid))return;let $0=S0;if(R0($0.uid.toString()).then(ey=>{console.log("____Username is",ey,"for",$0.uid),$0.username=ey,_s(w_=>[...w_,$0])}).catch(ey=>{console.log(ey)}),S0.hasAudio){const ey=S0.audioTrack;ey==null||ey.play()}if(S0.hasVideo){console.log("___USER:",S0,"_____");const ey=S0.videoTrack;ey==null||ey.play(document.getElementById(`remote-video-${S0.uid}`))}};reactExports.useEffect(()=>{if(Nl)for(let S0 of ga.remoteUsers)S0.hasAudio&&ga.subscribe(S0,"audio").then(()=>{const $0=S0.audioTrack;$0==null||$0.play()}),S0.hasVideo&&ga.subscribe(S0,"video").then(()=>{const $0=S0.videoTrack;$0==null||$0.play(document.getElementById(`remote-video-${S0.uid}`))})},[_i]),reactExports.useEffect(()=>{J_(),joinSession(h).then(S0=>{console.log(S0)}).catch(S0=>{console.log(S0)})},[]);const d0=S0=>{Op.sendMessage({text:S0}).then(()=>{console.log("Message sent successfully")}).catch(ey=>{console.log("Message failed to send",ey)});let $0={text:S0,sender:Fp.username,timestamp:new Date};vy(wp.shareUrl,$0),Yy(ey=>[...ey,$0])},Cy=S0=>{let $0={text:S0,sender:"System",timestamp:new Date};Yy(ey=>[...ey,$0])},vy=(S0,$0)=>{uploadChatMessage(S0,$0).then(ey=>{console.log(ey)}).catch(ey=>{console.log(ey)})},A_=async()=>{if(Nl)return $&&(Il==null||Il.stop(),Il==null||Il.close(),Tl==null||Tl.close(),Tl==null||Tl.stop(),Cl(void 0),Tl==null||Tl.setEnabled(!1),Tl&&(ga==null||ga.unpublish([Tl])),Sl(void 0),_n(!1)),i||(xa==null||xa.setMuted(!0),g(!0),ga==null||ga.unpublish(xa),xa==null||xa.close(),El(void 0)),($||!_)&&(ga==null||ga.unpublish([Tl]),Tl.setEnabled(!1),Tl.close(),j(!0),Sl(void 0)),await ga.leave();const S0=AgoraRTC.createClient({mode:"rtc",codec:"vp8"}),$0=AgoraRTM.createInstance(appId);ba(S0),C0($0);const ey=await fetchToken(wp.channelName,Fp._id),w_=await fetchRTMToken(Fp._id);console.log("__TOKEN:",ey),console.log("__CHAT_TOKEN:",w_),console.log("DEBUG",appId,wp.channelName,ey,`${Fp._id}`),S0.join(appId,wp.channelName,ey,`${Fp._id}`).then(Ay=>{Dl(!0),ry(S0.remoteUsers)}),$0.login({token:w_,uid:`${Fp._id}`}).then(()=>{console.log("AgoraRTM client login success");let Ay=$0.createChannel(wp.channelName);Cy(`Successfully joined channel ${wp.channelName}`),Ay.on("ChannelMessage",({text:Jy},Iy)=>{console.log("Message from user "+Iy+": "+Jy),console.log(_i),R0(Iy).then(qS=>{let SN={text:Jy,sender:qS,timestamp:new Date};Yy(I1=>[...I1,SN])}).catch(qS=>{console.log(qS)})}),Ay.on("MemberJoined",Jy=>{console.log(`${Jy} has joined!`),R0(Jy).then(Iy=>{Cy(`${Iy} has joined the channel!`)}).catch(Iy=>{console.log(Iy)})}),Ay.on("MemberLeft",Jy=>{console.log(`${Jy} has left!`),R0(Jy).then(Iy=>{Cy(`${Iy} has left the channel!`)}).catch(Iy=>{console.log(Iy)})}),Ay.join().then(()=>{console.log("AgoraRTM client channel join success"),Q0(Ay)}).catch(Jy=>{console.log("AgoraRTM client channel join failure",Jy)})}).catch(Ay=>{console.log("AgoraRTM client login failure",Ay)}),S0.on("user-published",async(Ay,Jy)=>{await S0.subscribe(Ay,Jy),console.log("__DEBUG:",Ay),Ay.hasAudio&&S0.subscribe(Ay,"audio").then(()=>{const Iy=Ay.audioTrack;Iy==null||Iy.play()}),Ay.hasVideo&&S0.subscribe(Ay,"video").then(()=>{const Iy=Ay.videoTrack;Iy==null||Iy.play(document.getElementById(`remote-video-${Ay.uid}`))})}),S0.on("user-unpublished",(Ay,Jy)=>{if(Jy==="video"){const Iy=Ay.videoTrack;Iy==null||Iy.stop()}}),S0.on("published-user-list",Ay=>{console.log("____USERRRR",Ay)}),S0.on("user-left",Ay=>{_s(Jy=>{let Iy=Jy;return Iy=Iy.filter(qS=>qS.uid!==Ay.uid),Iy})}),S0.on("user-joined",Ay=>{q0(Ay)}),console.log("REMOTE:",S0.remoteUsers)},I_=()=>{if(i){AgoraRTC.createMicrophoneAudioTrack().then(S0=>ga==null?void 0:ga.publish([S0]).then(()=>{El(S0),g(!1),S0.setMuted(!1)}));return}else xa==null||xa.setMuted(!0),g(!0),ga==null||ga.unpublish(xa),xa==null||xa.close(),El(void 0)},IT=()=>{if(_){$&&HS(),AgoraRTC.createCameraVideoTrack().then(S0=>ga==null?void 0:ga.publish([S0]).then(()=>{Sl(S0),j(!1),S0.play(Mp.current),S0.setEnabled(!0)}).catch($0=>{console.log("Error CAMERA",$0)}));return}else ga==null||ga.unpublish([Tl]),Tl.setEnabled(!1),Tl.close(),j(!0),Sl(void 0)},HS=async()=>{if($)_n(!1),Il==null||Il.stop(),Il==null||Il.close(),ga==null||ga.unpublish([Il]),Cl(void 0);else{_||IT(),_n(!0);const S0={width:1280,height:720,frameRate:30};await AgoraRTC.createScreenVideoTrack({encoderConfig:S0},"disable").then($0=>{ga==null||ga.publish([$0]).then(()=>{Cl($0),$0.play(Mp.current),$0.setEnabled(!0)})}).catch($0=>{console.log($0)})}},NT=async()=>{var S0;if(Ul){const $0=await stopRecording(wp.channelName,_p,Jl,Ap);$0&&(Kl(!1),console.log("___",$0),setUrl(wp.channelName,Ap,(S0=$0.serverResponse)==null?void 0:S0.fileList))}else{const $0=ga.remoteUsers;console.log("____users",$0),console.log("____R.users",_i);const ey=Math.floor(Math.random()*99999),w_=await getResourceID(wp.channelName,ey);Ep(w_);const Ay=await fetchToken(wp.channelName,ey);yp(Up),Ip(`${ey}`);const Jy=await startRecording(wp.channelName,`${ey}`,w_,"0",Ay);Jy&&(Kl(!0),Cp(Jy.sid),console.log("___",Jy),sendRecordingInfo(wp.channelName,`${ey}`,Jy.resourceId,Jy.sid))}};return jsxs(Fragment$1,{children:[jsx(Header,{}),jsx(LiveChat,{isOpen:$p,setIsOpen:c0,chatMessages:dy,sendChatMessage:d0}),(()=>jsx("div",{className:"w3-container w3-row",children:Array.from(_i).map(S0=>jsx("div",{className:"w3-col m4 l2 s6 w3-card w3-margin-right w3-margin-bottom",children:jsxs("div",{id:`player-${S0.uid}`,className:" w3-display-container w3-hover-text w3-dark-grey ",style:{width:"100%",aspectRatio:4/3},children:[jsx("div",{className:"w3-display-bottomleft w3-container ",children:jsx("span",{className:"hidden-text w3-text-white",children:`${S0.username} ${S0.uid}`})}),jsx("div",{className:"w3-display-topright w3-container ",children:S0.hasAudio&&S0.audioTrack.isPlaying?jsx(Fragment$1,{}):jsx("img",{className:"w3-margin-top w3-right",src:mutedIcon,alt:"muted",style:{width:"60%",height:"60%"}})}),jsx("video",{id:`remote-video-${S0.uid}`,autoPlay:!0,playsInline:!0,style:{width:"100%"}})]},S0.uid)},`${S0.uid}`))}))(),$||!_?jsx("div",{className:"w3-container w3-padding-small w3-round w3-card w3-grey w3-right",children:jsx("video",{ref:Mp,className:"w3-margin",style:{maxHeight:"240px"},autoPlay:!0,playsInline:!0})}):jsx(Fragment$1,{children:" "}),jsx(CommsButtons,{toggleMute:I_,isMuted:i,toggleVideo:IT,isVideoOff:_,toggleScreenShare:HS,isScreenSharing:$,joinRTC:A_,isJoined:Nl,handleRecording:NT,isRecording:Ul,toggleChat:()=>c0(!$p),isLecturer:xp})]})},Join=()=>{React.useState("");const[h,i]=React.useState(""),[g,_]=React.useState("");React.useState(!1);const j=useNavigate(),$=_i=>{_i.preventDefault(),j(`/prejoin/${h}`)};return jsxs("div",{style:{height:"100%"},children:[jsx(Header,{}),jsxs("div",{className:"w3-container",style:{display:"flex",alignItems:"center",justifyContent:"center"},children:[jsxs("div",{className:"w3-card-4 w3-margin w3-padding w3-half w3-round-xlarge w3-light-grey",style:{minHeight:"300px"},children:[jsx("h3",{children:"Join a call"}),jsxs("form",{onSubmit:_i=>{$(_i)},children:[jsx("div",{className:"w3-section",children:jsx("label",{children:"You can join a call, as a participant"})}),jsxs("div",{className:"w3-section",children:[jsx("label",{children:"Room Id"}),jsx("input",{className:"w3-input w3-round-large w3-padding w3-margin-top",type:"text",placeholder:"Enter Room ID",value:h,onChange:_i=>{i(_i.target.value)}})]}),jsx("button",{type:"submit",className:"w3-button w3-teal w3-margin-bottom w3-round",children:"Join"})]})]}),jsxs("div",{className:"w3-card-4 w3-margin w3-padding w3-half w3-round-xlarge w3-light-grey",style:{minHeight:"300px",justifyContent:"center"},children:[jsx("h3",{children:"Create a call"}),jsxs("form",{onSubmit:_i=>{_i.preventDefault(),createSession(g).then(_s=>{console.log(_s),j(`/prejoin/${_s.shareUrl}`)}).catch(_s=>{console.log(_s)})},children:[jsx("div",{className:"w3-section",children:jsx("label",{children:"You can create a call, as a Lecturer"})}),jsxs("div",{className:"w3-section",children:[jsx("label",{children:"Room Name"}),jsx("input",{className:"w3-input w3-round-large w3-padding w3-margin-top",type:"text",placeholder:"Enter Room Name",value:g,onChange:_i=>{_(_i.target.value)}})]}),jsx("button",{type:"submit",className:"w3-button w3-teal w3-margin-bottom w3-display-bottom w3-round",children:"Create"})]})]})]})]})},SearchBar=({options:h,selectedOptions:i,setSelectedOptions:g})=>{const[_,j]=reactExports.useState(""),[$,_n]=reactExports.useState(!1),_i=ga=>{const{value:ba}=ga.target;j(ba),_n(ba!=="")},_s=ga=>{g([...i,ga]),j(""),_n(!1)};return jsxs("div",{className:"w3-dropdown-hover",children:[jsx("input",{className:"w3-input w3-border",type:"text",placeholder:"Add tags",value:_,onChange:_i}),$&&jsx("div",{className:"w3-dropdown-content w3-bar-block",children:h.filter(ga=>ga.tag_name.toLowerCase().includes(_.toLowerCase())).map(ga=>jsx("button",{className:"w3-bar-item w3-button",onClick:()=>_s(ga),children:ga.tag_name},ga.id))})]})},Prejoin=()=>{var yp;const{channelCode:h}=useParams(),i=useNavigate(),[g,_]=reactExports.useState(!1),[j,$]=reactExports.useState(!1),[_n,_i]=reactExports.useState([]),[_s,ga]=reactExports.useState([]);reactExports.useState("");const[ba,xa]=reactExports.useState({}),[El,Tl]=reactExports.useState(),Sl=React.useRef(null),[Il,Cl]=reactExports.useState({}),[Nl,Dl]=reactExports.useState("audience"),Ul=()=>{getTags().then(Ap=>{ga(Ap)}).catch(console.error)},Kl=()=>{getSessionInfo(h).then(Ap=>{var Mp,wp;xa(Ap);const Cp=localStorage.getItem("token");Cl(decodetoken(Cp)),((wp=(Mp=Ap.lecturer)==null?void 0:Mp.id)==null?void 0:wp.toString())==decodetoken(Cp)._id?Dl("host"):Dl("audience"),Ap.tags&&_i(Ap.tags)}).catch(console.error)},Jl=()=>{_(!g)};reactExports.useEffect(()=>{El&&El.play(Sl.current)},[El]),reactExports.useEffect(()=>{Ul(),Kl()},[]);const Ep=()=>{j?(El.stop(),El.close(),Tl(void 0),$(!j)):AgoraRTC.createCameraVideoTrack().then(Ap=>{Tl(Ap),$(!j)}).catch(Ap=>alert(Ap))},_p=Ap=>{_i(_n.filter(Cp=>Cp.id!==Ap))},Ip=()=>{joinSession(h).then(Ap=>{console.log(Ap),i(`/stream/${h}`)}).catch(Ap=>{console.log(Ap)})},Up=()=>{i("/join")};return jsx("div",{className:"w3-container",children:jsxs("div",{className:"w3-card",children:[jsxs("h2",{className:"w3-container",children:["Room: ",ba.channelName??""]}),jsxs("h3",{className:"w3-container",children:["Lecturer: ",((yp=ba.lecturer)==null?void 0:yp.username)??""]}),jsxs("h4",{className:"w3-container",children:["You are joining as ",Nl==="host"?"the host.":`: "${Il.username}" `]}),jsxs("p",{children:[" Share this code for people to join : ",ba.shareUrl]}),jsxs("div",{className:"w3-container w3-center",children:[jsxs("div",{className:"w3-block",children:[jsx("button",{className:"w3-button w3-green w3-round w3-margin",onClick:Ip,children:"Join Call"}),jsx("button",{className:"w3-button w3-blue w3-round w3-margin",onClick:Up,children:"Go Back"}),jsxs("button",{className:`w3-button w3-${g?"red":"green"} w3-round w3-margin`,onClick:Jl,children:[g?"Unmute Mic":"Mute Mic",jsx("img",{})]}),jsx("button",{className:`w3-button w3-${j?"red":"green"} w3-round w3-margin`,onClick:Ep,children:j?"Turn Camera Off":"Test Your Camera"})]}),El&&jsx("div",{className:"w3-container w3-card w3-padding w3-margin w3-round-large w3-dark-grey",style:{display:"inline-flex"},children:jsx("video",{ref:Sl,className:"",style:{width:"300px",height:"200px"}})})]}),jsxs("div",{className:"w3-container",children:[Nl==="host"&&jsx("div",{children:jsx(SearchBar,{options:_s,selectedOptions:_n,setSelectedOptions:_i})}),jsxs("div",{className:"w3-container w3-center",children:[jsx("p",{children:"Tags:"}),jsx("div",{className:"w3-container w3-center",children:_n.map(Ap=>jsx("span",{className:"w3-tag w3-round w3-light-grey w3-margin-right w3-margin-bottom",children:jsxs("button",{className:"w3-button w3-round w3-margin-left",onClick:()=>_p(Ap.id),children:[Ap.tag_name," ",jsx("label",{className:"w3-text-lightgrey",children:" x"})]})},Ap.id))})]})]})]})})},useAuth=()=>localStorage.getItem("token");function AuthGuard(){return useAuth()?jsx(Outlet,{}):jsx(Navigate,{to:"/auth"})}const NotFound=()=>jsx("div",{className:"w3-container",style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},children:jsxs("div",{className:"w3-card-4 w3-margin w3-padding w3-half",style:{minHeight:"300px",justifyContent:"center"},children:[jsx("img",{src:"https://abl.gtu.edu.tr/html/mobil/gtu_logo_tr_500.png",style:{width:"50%"}}),jsx("h1",{className:"w3-text-indigo",children:"Education Portal"}),jsx("img",{src:"https://cdn.dribbble.com/users/285475/screenshots/2083086/dribbble_1.gif",style:{width:"50%"}}),jsx("h3",{children:"404 Not Found"}),jsx("p",{children:"The page you are looking for does not exist."})]})}),Courses=()=>{const h=useNavigate(),[i,g]=reactExports.useState([]),_=$=>{const _n=$.split(".").slice(0,-1).join(".");h(`/player/${_n}`)},j=async()=>{g([]);const $=await getLectureInfo();console.log($);for(let _n of $)if(_n.recordings.length>0)for(let _i of _n.recordings){if(_i.end==null)continue;const _s=new Date(new Date(_i.end).getTime()-new Date(_i.start).getTime());let ga={name:_n.channelName,lecturer:_n.lecturer.username,length:`${_s.getUTCHours()}:${_s.getUTCMinutes()}:${_s.getUTCSeconds()}`,filename:_i.url,date:new Date(_i.start)};g(ba=>[...ba,ga])}};return reactExports.useEffect(()=>{j().then($=>{}).catch($=>{console.error("Error retrieving filenames:",$)})},[]),jsxs(Fragment$1,{children:[jsx(Header,{}),jsxs("div",{className:"w3-container",children:[jsx("h2",{children:"Video Catalogue"}),jsx("div",{className:"w3-row",children:i.map($=>jsx("div",{className:"w3-col l3 m6 w3-margin-bottom",children:jsx("div",{className:"w3-col l3 m6 w3-margin-bottom",children:jsx("div",{className:"w3-card w3-margin",children:jsxs("div",{className:"w3-container w3-padding",children:[jsx("h4",{children:$.name}),jsxs("p",{children:["Lecturer: ",$.lecturer]}),jsxs("p",{children:["Length: ",$.length]}),jsx("button",{className:"w3-button w3-blue",onClick:()=>_($.filename),children:"Join Course"})]})})})},$.filename))})]})]})};var propTypesExports={},propTypes={get exports(){return propTypesExports},set exports(h){propTypesExports=h}},ReactPropTypesSecret$1="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",ReactPropTypesSecret_1=ReactPropTypesSecret$1,ReactPropTypesSecret=ReactPropTypesSecret_1;function emptyFunction(){}function emptyFunctionWithReset(){}emptyFunctionWithReset.resetWarningCache=emptyFunction;var factoryWithThrowingShims=function(){function h(_,j,$,_n,_i,_s){if(_s!==ReactPropTypesSecret){var ga=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw ga.name="Invariant Violation",ga}}h.isRequired=h;function i(){return h}var g={array:h,bigint:h,bool:h,func:h,number:h,object:h,string:h,symbol:h,any:h,arrayOf:i,element:h,elementType:h,instanceOf:i,node:h,objectOf:i,oneOf:i,oneOfType:i,shape:i,exact:i,checkPropTypes:emptyFunctionWithReset,resetWarningCache:emptyFunction};return g.PropTypes=g,g};propTypes.exports=factoryWithThrowingShims();function isNil(h){return h==null}var isNil_1=isNil,freeGlobal$1=typeof commonjsGlobal=="object"&&commonjsGlobal&&commonjsGlobal.Object===Object&&commonjsGlobal,_freeGlobal=freeGlobal$1,freeGlobal=_freeGlobal,freeSelf=typeof self=="object"&&self&&self.Object===Object&&self,root$8=freeGlobal||freeSelf||Function("return this")(),_root=root$8,root$7=_root,Symbol$7=root$7.Symbol,_Symbol=Symbol$7,Symbol$6=_Symbol,objectProto$j=Object.prototype,hasOwnProperty$f=objectProto$j.hasOwnProperty,nativeObjectToString$2=objectProto$j.toString,symToStringTag$1=Symbol$6?Symbol$6.toStringTag:void 0;function getRawTag$1(h){var i=hasOwnProperty$f.call(h,symToStringTag$1),g=h[symToStringTag$1];try{h[symToStringTag$1]=void 0;var _=!0}catch{}var j=nativeObjectToString$2.call(h);return _&&(i?h[symToStringTag$1]=g:delete h[symToStringTag$1]),j}var _getRawTag=getRawTag$1,objectProto$i=Object.prototype,nativeObjectToString$1=objectProto$i.toString;function objectToString$1(h){return nativeObjectToString$1.call(h)}var _objectToString=objectToString$1,Symbol$5=_Symbol,getRawTag=_getRawTag,objectToString=_objectToString,nullTag="[object Null]",undefinedTag="[object Undefined]",symToStringTag=Symbol$5?Symbol$5.toStringTag:void 0;function baseGetTag$9(h){return h==null?h===void 0?undefinedTag:nullTag:symToStringTag&&symToStringTag in Object(h)?getRawTag(h):objectToString(h)}var _baseGetTag=baseGetTag$9;function isObject$7(h){var i=typeof h;return h!=null&&(i=="object"||i=="function")}var isObject_1=isObject$7,baseGetTag$8=_baseGetTag,isObject$6=isObject_1,asyncTag="[object AsyncFunction]",funcTag$1="[object Function]",genTag="[object GeneratorFunction]",proxyTag="[object Proxy]";function isFunction$2(h){if(!isObject$6(h))return!1;var i=baseGetTag$8(h);return i==funcTag$1||i==genTag||i==asyncTag||i==proxyTag}var isFunction_1=isFunction$2,root$6=_root,coreJsData$1=root$6["__core-js_shared__"],_coreJsData=coreJsData$1,coreJsData=_coreJsData,maskSrcKey=function(){var h=/[^.]+$/.exec(coreJsData&&coreJsData.keys&&coreJsData.keys.IE_PROTO||"");return h?"Symbol(src)_1."+h:""}();function isMasked$1(h){return!!maskSrcKey&&maskSrcKey in h}var _isMasked=isMasked$1,funcProto$2=Function.prototype,funcToString$2=funcProto$2.toString;function toSource$2(h){if(h!=null){try{return funcToString$2.call(h)}catch{}try{return h+""}catch{}}return""}var _toSource=toSource$2,isFunction$1=isFunction_1,isMasked=_isMasked,isObject$5=isObject_1,toSource$1=_toSource,reRegExpChar=/[\\^$.*+?()[\]{}|]/g,reIsHostCtor=/^\[object .+?Constructor\]$/,funcProto$1=Function.prototype,objectProto$h=Object.prototype,funcToString$1=funcProto$1.toString,hasOwnProperty$e=objectProto$h.hasOwnProperty,reIsNative=RegExp("^"+funcToString$1.call(hasOwnProperty$e).replace(reRegExpChar,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function baseIsNative$1(h){if(!isObject$5(h)||isMasked(h))return!1;var i=isFunction$1(h)?reIsNative:reIsHostCtor;return i.test(toSource$1(h))}var _baseIsNative=baseIsNative$1;function getValue$2(h,i){return h==null?void 0:h[i]}var _getValue=getValue$2,baseIsNative=_baseIsNative,getValue$1=_getValue;function getNative$7(h,i){var g=getValue$1(h,i);return baseIsNative(g)?g:void 0}var _getNative=getNative$7,getNative$6=_getNative,defineProperty$2=function(){try{var h=getNative$6(Object,"defineProperty");return h({},"",{}),h}catch{}}(),_defineProperty$m=defineProperty$2,defineProperty$1=_defineProperty$m;function baseAssignValue$3(h,i,g){i=="__proto__"&&defineProperty$1?defineProperty$1(h,i,{configurable:!0,enumerable:!0,value:g,writable:!0}):h[i]=g}var _baseAssignValue=baseAssignValue$3;function eq$6(h,i){return h===i||h!==h&&i!==i}var eq_1=eq$6,baseAssignValue$2=_baseAssignValue,eq$5=eq_1,objectProto$g=Object.prototype,hasOwnProperty$d=objectProto$g.hasOwnProperty;function assignValue$3(h,i,g){var _=h[i];(!(hasOwnProperty$d.call(h,i)&&eq$5(_,g))||g===void 0&&!(i in h))&&baseAssignValue$2(h,i,g)}var _assignValue=assignValue$3,assignValue$2=_assignValue,baseAssignValue$1=_baseAssignValue;function copyObject$1(h,i,g,_){var j=!g;g||(g={});for(var $=-1,_n=i.length;++$<_n;){var _i=i[$],_s=_?_(g[_i],h[_i],_i,g,h):void 0;_s===void 0&&(_s=h[_i]),j?baseAssignValue$1(g,_i,_s):assignValue$2(g,_i,_s)}return g}var _copyObject=copyObject$1;function identity$9(h){return h}var identity_1=identity$9;function apply$1(h,i,g){switch(g.length){case 0:return h.call(i);case 1:return h.call(i,g[0]);case 2:return h.call(i,g[0],g[1]);case 3:return h.call(i,g[0],g[1],g[2])}return h.apply(i,g)}var _apply=apply$1,apply=_apply,nativeMax$3=Math.max;function overRest$2(h,i,g){return i=nativeMax$3(i===void 0?h.length-1:i,0),function(){for(var _=arguments,j=-1,$=nativeMax$3(_.length-i,0),_n=Array($);++j<$;)_n[j]=_[i+j];j=-1;for(var _i=Array(i+1);++j<i;)_i[j]=_[j];return _i[i]=g(_n),apply(h,this,_i)}}var _overRest=overRest$2;function constant$4(h){return function(){return h}}var constant_1=constant$4,constant$3=constant_1,defineProperty=_defineProperty$m,identity$8=identity_1,baseSetToString$1=defineProperty?function(h,i){return defineProperty(h,"toString",{configurable:!0,enumerable:!1,value:constant$3(i),writable:!0})}:identity$8,_baseSetToString=baseSetToString$1,HOT_COUNT=800,HOT_SPAN=16,nativeNow=Date.now;function shortOut$1(h){var i=0,g=0;return function(){var _=nativeNow(),j=HOT_SPAN-(_-g);if(g=_,j>0){if(++i>=HOT_COUNT)return arguments[0]}else i=0;return h.apply(void 0,arguments)}}var _shortOut=shortOut$1,baseSetToString=_baseSetToString,shortOut=_shortOut,setToString$2=shortOut(baseSetToString),_setToString=setToString$2,identity$7=identity_1,overRest$1=_overRest,setToString$1=_setToString;function baseRest$4(h,i){return setToString$1(overRest$1(h,i,identity$7),h+"")}var _baseRest=baseRest$4,MAX_SAFE_INTEGER$1=9007199254740991;function isLength$3(h){return typeof h=="number"&&h>-1&&h%1==0&&h<=MAX_SAFE_INTEGER$1}var isLength_1=isLength$3,isFunction=isFunction_1,isLength$2=isLength_1;function isArrayLike$a(h){return h!=null&&isLength$2(h.length)&&!isFunction(h)}var isArrayLike_1=isArrayLike$a,MAX_SAFE_INTEGER=9007199254740991,reIsUint=/^(?:0|[1-9]\d*)$/;function isIndex$4(h,i){var g=typeof h;return i=i??MAX_SAFE_INTEGER,!!i&&(g=="number"||g!="symbol"&&reIsUint.test(h))&&h>-1&&h%1==0&&h<i}var _isIndex=isIndex$4,eq$4=eq_1,isArrayLike$9=isArrayLike_1,isIndex$3=_isIndex,isObject$4=isObject_1;function isIterateeCall$4(h,i,g){if(!isObject$4(g))return!1;var _=typeof i;return(_=="number"?isArrayLike$9(g)&&isIndex$3(i,g.length):_=="string"&&i in g)?eq$4(g[i],h):!1}var _isIterateeCall=isIterateeCall$4,baseRest$3=_baseRest,isIterateeCall$3=_isIterateeCall;function createAssigner$1(h){return baseRest$3(function(i,g){var _=-1,j=g.length,$=j>1?g[j-1]:void 0,_n=j>2?g[2]:void 0;for($=h.length>3&&typeof $=="function"?(j--,$):void 0,_n&&isIterateeCall$3(g[0],g[1],_n)&&($=j<3?void 0:$,j=1),i=Object(i);++_<j;){var _i=g[_];_i&&h(i,_i,_,$)}return i})}var _createAssigner=createAssigner$1,objectProto$f=Object.prototype;function isPrototype$4(h){var i=h&&h.constructor,g=typeof i=="function"&&i.prototype||objectProto$f;return h===g}var _isPrototype=isPrototype$4;function baseTimes$1(h,i){for(var g=-1,_=Array(h);++g<h;)_[g]=i(g);return _}var _baseTimes=baseTimes$1;function isObjectLike$a(h){return h!=null&&typeof h=="object"}var isObjectLike_1=isObjectLike$a,baseGetTag$7=_baseGetTag,isObjectLike$9=isObjectLike_1,argsTag$2="[object Arguments]";function baseIsArguments$1(h){return isObjectLike$9(h)&&baseGetTag$7(h)==argsTag$2}var _baseIsArguments=baseIsArguments$1,baseIsArguments=_baseIsArguments,isObjectLike$8=isObjectLike_1,objectProto$e=Object.prototype,hasOwnProperty$c=objectProto$e.hasOwnProperty,propertyIsEnumerable$1=objectProto$e.propertyIsEnumerable,isArguments$4=baseIsArguments(function(){return arguments}())?baseIsArguments:function(h){return isObjectLike$8(h)&&hasOwnProperty$c.call(h,"callee")&&!propertyIsEnumerable$1.call(h,"callee")},isArguments_1=isArguments$4,isArray$f=Array.isArray,isArray_1=isArray$f,isBufferExports={},isBuffer$3={get exports(){return isBufferExports},set exports(h){isBufferExports=h}};function stubFalse(){return!1}var stubFalse_1=stubFalse;(function(h,i){var g=_root,_=stubFalse_1,j=i&&!i.nodeType&&i,$=j&&!0&&h&&!h.nodeType&&h,_n=$&&$.exports===j,_i=_n?g.Buffer:void 0,_s=_i?_i.isBuffer:void 0,ga=_s||_;h.exports=ga})(isBuffer$3,isBufferExports);var baseGetTag$6=_baseGetTag,isLength$1=isLength_1,isObjectLike$7=isObjectLike_1,argsTag$1="[object Arguments]",arrayTag$1="[object Array]",boolTag$1="[object Boolean]",dateTag$2="[object Date]",errorTag$1="[object Error]",funcTag="[object Function]",mapTag$3="[object Map]",numberTag$1="[object Number]",objectTag$3="[object Object]",regexpTag$2="[object RegExp]",setTag$3="[object Set]",stringTag$2="[object String]",weakMapTag$1="[object WeakMap]",arrayBufferTag$1="[object ArrayBuffer]",dataViewTag$2="[object DataView]",float32Tag="[object Float32Array]",float64Tag="[object Float64Array]",int8Tag="[object Int8Array]",int16Tag="[object Int16Array]",int32Tag="[object Int32Array]",uint8Tag="[object Uint8Array]",uint8ClampedTag="[object Uint8ClampedArray]",uint16Tag="[object Uint16Array]",uint32Tag="[object Uint32Array]",typedArrayTags={};typedArrayTags[float32Tag]=typedArrayTags[float64Tag]=typedArrayTags[int8Tag]=typedArrayTags[int16Tag]=typedArrayTags[int32Tag]=typedArrayTags[uint8Tag]=typedArrayTags[uint8ClampedTag]=typedArrayTags[uint16Tag]=typedArrayTags[uint32Tag]=!0;typedArrayTags[argsTag$1]=typedArrayTags[arrayTag$1]=typedArrayTags[arrayBufferTag$1]=typedArrayTags[boolTag$1]=typedArrayTags[dataViewTag$2]=typedArrayTags[dateTag$2]=typedArrayTags[errorTag$1]=typedArrayTags[funcTag]=typedArrayTags[mapTag$3]=typedArrayTags[numberTag$1]=typedArrayTags[objectTag$3]=typedArrayTags[regexpTag$2]=typedArrayTags[setTag$3]=typedArrayTags[stringTag$2]=typedArrayTags[weakMapTag$1]=!1;function baseIsTypedArray$1(h){return isObjectLike$7(h)&&isLength$1(h.length)&&!!typedArrayTags[baseGetTag$6(h)]}var _baseIsTypedArray=baseIsTypedArray$1;function baseUnary$5(h){return function(i){return h(i)}}var _baseUnary=baseUnary$5,_nodeUtilExports={},_nodeUtil={get exports(){return _nodeUtilExports},set exports(h){_nodeUtilExports=h}};(function(h,i){var g=_freeGlobal,_=i&&!i.nodeType&&i,j=_&&!0&&h&&!h.nodeType&&h,$=j&&j.exports===_,_n=$&&g.process,_i=function(){try{var _s=j&&j.require&&j.require("util").types;return _s||_n&&_n.binding&&_n.binding("util")}catch{}}();h.exports=_i})(_nodeUtil,_nodeUtilExports);var baseIsTypedArray=_baseIsTypedArray,baseUnary$4=_baseUnary,nodeUtil$2=_nodeUtilExports,nodeIsTypedArray=nodeUtil$2&&nodeUtil$2.isTypedArray,isTypedArray$3=nodeIsTypedArray?baseUnary$4(nodeIsTypedArray):baseIsTypedArray,isTypedArray_1=isTypedArray$3,baseTimes=_baseTimes,isArguments$3=isArguments_1,isArray$e=isArray_1,isBuffer$2=isBufferExports,isIndex$2=_isIndex,isTypedArray$2=isTypedArray_1,objectProto$d=Object.prototype,hasOwnProperty$b=objectProto$d.hasOwnProperty;function arrayLikeKeys$2(h,i){var g=isArray$e(h),_=!g&&isArguments$3(h),j=!g&&!_&&isBuffer$2(h),$=!g&&!_&&!j&&isTypedArray$2(h),_n=g||_||j||$,_i=_n?baseTimes(h.length,String):[],_s=_i.length;for(var ga in h)(i||hasOwnProperty$b.call(h,ga))&&!(_n&&(ga=="length"||j&&(ga=="offset"||ga=="parent")||$&&(ga=="buffer"||ga=="byteLength"||ga=="byteOffset")||isIndex$2(ga,_s)))&&_i.push(ga);return _i}var _arrayLikeKeys=arrayLikeKeys$2;function overArg$2(h,i){return function(g){return h(i(g))}}var _overArg=overArg$2,overArg$1=_overArg,nativeKeys$1=overArg$1(Object.keys,Object),_nativeKeys=nativeKeys$1,isPrototype$3=_isPrototype,nativeKeys=_nativeKeys,objectProto$c=Object.prototype,hasOwnProperty$a=objectProto$c.hasOwnProperty;function baseKeys$2(h){if(!isPrototype$3(h))return nativeKeys(h);var i=[];for(var g in Object(h))hasOwnProperty$a.call(h,g)&&g!="constructor"&&i.push(g);return i}var _baseKeys=baseKeys$2,arrayLikeKeys$1=_arrayLikeKeys,baseKeys$1=_baseKeys,isArrayLike$8=isArrayLike_1;function keys$6(h){return isArrayLike$8(h)?arrayLikeKeys$1(h):baseKeys$1(h)}var keys_1=keys$6,assignValue$1=_assignValue,copyObject=_copyObject,createAssigner=_createAssigner,isArrayLike$7=isArrayLike_1,isPrototype$2=_isPrototype,keys$5=keys_1,objectProto$b=Object.prototype,hasOwnProperty$9=objectProto$b.hasOwnProperty,assign=createAssigner(function(h,i){if(isPrototype$2(i)||isArrayLike$7(i)){copyObject(i,keys$5(i),h);return}for(var g in i)hasOwnProperty$9.call(i,g)&&assignValue$1(h,g,i[g])}),assign_1=assign;const linear$2=h=>+h;function quadIn(h){return h*h}function quadOut(h){return h*(2-h)}function quadInOut(h){return((h*=2)<=1?h*h:--h*(2-h)+1)/2}function cubicIn(h){return h*h*h}function cubicOut(h){return--h*h*h+1}function cubicInOut(h){return((h*=2)<=1?h*h*h:(h-=2)*h*h+2)/2}var exponent$1=3,polyIn=function h(i){i=+i;function g(_){return Math.pow(_,i)}return g.exponent=h,g}(exponent$1),polyOut=function h(i){i=+i;function g(_){return 1-Math.pow(1-_,i)}return g.exponent=h,g}(exponent$1),polyInOut=function h(i){i=+i;function g(_){return((_*=2)<=1?Math.pow(_,i):2-Math.pow(2-_,i))/2}return g.exponent=h,g}(exponent$1),pi$2=Math.PI,halfPi$1=pi$2/2;function sinIn(h){return+h==1?1:1-Math.cos(h*halfPi$1)}function sinOut(h){return Math.sin(h*halfPi$1)}function sinInOut(h){return(1-Math.cos(pi$2*h))/2}function tpmt(h){return(Math.pow(2,-10*h)-.0009765625)*1.0009775171065494}function expIn(h){return tpmt(1-+h)}function expOut(h){return 1-tpmt(h)}function expInOut(h){return((h*=2)<=1?tpmt(1-h):2-tpmt(h-1))/2}function circleIn(h){return 1-Math.sqrt(1-h*h)}function circleOut(h){return Math.sqrt(1- --h*h)}function circleInOut(h){return((h*=2)<=1?1-Math.sqrt(1-h*h):Math.sqrt(1-(h-=2)*h)+1)/2}var b1=4/11,b2=6/11,b3=8/11,b4=3/4,b5=9/11,b6=10/11,b7=15/16,b8=21/22,b9=63/64,b0=1/b1/b1;function bounceIn(h){return 1-bounceOut(1-h)}function bounceOut(h){return(h=+h)<b1?b0*h*h:h<b3?b0*(h-=b2)*h+b4:h<b6?b0*(h-=b5)*h+b7:b0*(h-=b8)*h+b9}function bounceInOut(h){return((h*=2)<=1?1-bounceOut(1-h):bounceOut(h-1)+1)/2}var overshoot=1.70158,backIn=function h(i){i=+i;function g(_){return(_=+_)*_*(i*(_-1)+_)}return g.overshoot=h,g}(overshoot),backOut=function h(i){i=+i;function g(_){return--_*_*((_+1)*i+_)+1}return g.overshoot=h,g}(overshoot),backInOut=function h(i){i=+i;function g(_){return((_*=2)<1?_*_*((i+1)*_-i):(_-=2)*_*((i+1)*_+i)+2)/2}return g.overshoot=h,g}(overshoot),tau$2=2*Math.PI,amplitude=1,period=.3,elasticIn=function h(i,g){var _=Math.asin(1/(i=Math.max(1,i)))*(g/=tau$2);function j($){return i*tpmt(- --$)*Math.sin((_-$)/g)}return j.amplitude=function($){return h($,g*tau$2)},j.period=function($){return h(i,$)},j}(amplitude,period),elasticOut=function h(i,g){var _=Math.asin(1/(i=Math.max(1,i)))*(g/=tau$2);function j($){return 1-i*tpmt($=+$)*Math.sin(($+_)/g)}return j.amplitude=function($){return h($,g*tau$2)},j.period=function($){return h(i,$)},j}(amplitude,period),elasticInOut=function h(i,g){var _=Math.asin(1/(i=Math.max(1,i)))*(g/=tau$2);function j($){return(($=$*2-1)<0?i*tpmt(-$)*Math.sin((_-$)/g):2-i*tpmt($)*Math.sin((_+$)/g))/2}return j.amplitude=function($){return h($,g*tau$2)},j.period=function($){return h(i,$)},j}(amplitude,period);const d3Ease=Object.freeze(Object.defineProperty({__proto__:null,easeBack:backInOut,easeBackIn:backIn,easeBackInOut:backInOut,easeBackOut:backOut,easeBounce:bounceOut,easeBounceIn:bounceIn,easeBounceInOut:bounceInOut,easeBounceOut:bounceOut,easeCircle:circleInOut,easeCircleIn:circleIn,easeCircleInOut:circleInOut,easeCircleOut:circleOut,easeCubic:cubicInOut,easeCubicIn:cubicIn,easeCubicInOut:cubicInOut,easeCubicOut:cubicOut,easeElastic:elasticOut,easeElasticIn:elasticIn,easeElasticInOut:elasticInOut,easeElasticOut:elasticOut,easeExp:expInOut,easeExpIn:expIn,easeExpInOut:expInOut,easeExpOut:expOut,easeLinear:linear$2,easePoly:polyInOut,easePolyIn:polyIn,easePolyInOut:polyInOut,easePolyOut:polyOut,easeQuad:quadInOut,easeQuadIn:quadIn,easeQuadInOut:quadInOut,easeQuadOut:quadOut,easeSin:sinInOut,easeSinIn:sinIn,easeSinInOut:sinInOut,easeSinOut:sinOut},Symbol.toStringTag,{value:"Module"}));function arrayMap$5(h,i){for(var g=-1,_=h==null?0:h.length,j=Array(_);++g<_;)j[g]=i(h[g],g,h);return j}var _arrayMap=arrayMap$5,baseGetTag$5=_baseGetTag,isObjectLike$6=isObjectLike_1,symbolTag$1="[object Symbol]";function isSymbol$5(h){return typeof h=="symbol"||isObjectLike$6(h)&&baseGetTag$5(h)==symbolTag$1}var isSymbol_1=isSymbol$5,isArray$d=isArray_1,isSymbol$4=isSymbol_1,reIsDeepProp=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,reIsPlainProp=/^\w*$/;function isKey$3(h,i){if(isArray$d(h))return!1;var g=typeof h;return g=="number"||g=="symbol"||g=="boolean"||h==null||isSymbol$4(h)?!0:reIsPlainProp.test(h)||!reIsDeepProp.test(h)||i!=null&&h in Object(i)}var _isKey=isKey$3,getNative$5=_getNative,nativeCreate$4=getNative$5(Object,"create"),_nativeCreate=nativeCreate$4,nativeCreate$3=_nativeCreate;function hashClear$1(){this.__data__=nativeCreate$3?nativeCreate$3(null):{},this.size=0}var _hashClear=hashClear$1;function hashDelete$1(h){var i=this.has(h)&&delete this.__data__[h];return this.size-=i?1:0,i}var _hashDelete=hashDelete$1,nativeCreate$2=_nativeCreate,HASH_UNDEFINED$2="__lodash_hash_undefined__",objectProto$a=Object.prototype,hasOwnProperty$8=objectProto$a.hasOwnProperty;function hashGet$1(h){var i=this.__data__;if(nativeCreate$2){var g=i[h];return g===HASH_UNDEFINED$2?void 0:g}return hasOwnProperty$8.call(i,h)?i[h]:void 0}var _hashGet=hashGet$1,nativeCreate$1=_nativeCreate,objectProto$9=Object.prototype,hasOwnProperty$7=objectProto$9.hasOwnProperty;function hashHas$1(h){var i=this.__data__;return nativeCreate$1?i[h]!==void 0:hasOwnProperty$7.call(i,h)}var _hashHas=hashHas$1,nativeCreate=_nativeCreate,HASH_UNDEFINED$1="__lodash_hash_undefined__";function hashSet$1(h,i){var g=this.__data__;return this.size+=this.has(h)?0:1,g[h]=nativeCreate&&i===void 0?HASH_UNDEFINED$1:i,this}var _hashSet=hashSet$1,hashClear=_hashClear,hashDelete=_hashDelete,hashGet=_hashGet,hashHas=_hashHas,hashSet=_hashSet;function Hash$1(h){var i=-1,g=h==null?0:h.length;for(this.clear();++i<g;){var _=h[i];this.set(_[0],_[1])}}Hash$1.prototype.clear=hashClear;Hash$1.prototype.delete=hashDelete;Hash$1.prototype.get=hashGet;Hash$1.prototype.has=hashHas;Hash$1.prototype.set=hashSet;var _Hash=Hash$1;function listCacheClear$1(){this.__data__=[],this.size=0}var _listCacheClear=listCacheClear$1,eq$3=eq_1;function assocIndexOf$4(h,i){for(var g=h.length;g--;)if(eq$3(h[g][0],i))return g;return-1}var _assocIndexOf=assocIndexOf$4,assocIndexOf$3=_assocIndexOf,arrayProto=Array.prototype,splice=arrayProto.splice;function listCacheDelete$1(h){var i=this.__data__,g=assocIndexOf$3(i,h);if(g<0)return!1;var _=i.length-1;return g==_?i.pop():splice.call(i,g,1),--this.size,!0}var _listCacheDelete=listCacheDelete$1,assocIndexOf$2=_assocIndexOf;function listCacheGet$1(h){var i=this.__data__,g=assocIndexOf$2(i,h);return g<0?void 0:i[g][1]}var _listCacheGet=listCacheGet$1,assocIndexOf$1=_assocIndexOf;function listCacheHas$1(h){return assocIndexOf$1(this.__data__,h)>-1}var _listCacheHas=listCacheHas$1,assocIndexOf=_assocIndexOf;function listCacheSet$1(h,i){var g=this.__data__,_=assocIndexOf(g,h);return _<0?(++this.size,g.push([h,i])):g[_][1]=i,this}var _listCacheSet=listCacheSet$1,listCacheClear=_listCacheClear,listCacheDelete=_listCacheDelete,listCacheGet=_listCacheGet,listCacheHas=_listCacheHas,listCacheSet=_listCacheSet;function ListCache$4(h){var i=-1,g=h==null?0:h.length;for(this.clear();++i<g;){var _=h[i];this.set(_[0],_[1])}}ListCache$4.prototype.clear=listCacheClear;ListCache$4.prototype.delete=listCacheDelete;ListCache$4.prototype.get=listCacheGet;ListCache$4.prototype.has=listCacheHas;ListCache$4.prototype.set=listCacheSet;var _ListCache=ListCache$4,getNative$4=_getNative,root$5=_root,Map$4=getNative$4(root$5,"Map"),_Map=Map$4,Hash=_Hash,ListCache$3=_ListCache,Map$3=_Map;function mapCacheClear$1(){this.size=0,this.__data__={hash:new Hash,map:new(Map$3||ListCache$3),string:new Hash}}var _mapCacheClear=mapCacheClear$1;function isKeyable$1(h){var i=typeof h;return i=="string"||i=="number"||i=="symbol"||i=="boolean"?h!=="__proto__":h===null}var _isKeyable=isKeyable$1,isKeyable=_isKeyable;function getMapData$4(h,i){var g=h.__data__;return isKeyable(i)?g[typeof i=="string"?"string":"hash"]:g.map}var _getMapData=getMapData$4,getMapData$3=_getMapData;function mapCacheDelete$1(h){var i=getMapData$3(this,h).delete(h);return this.size-=i?1:0,i}var _mapCacheDelete=mapCacheDelete$1,getMapData$2=_getMapData;function mapCacheGet$1(h){return getMapData$2(this,h).get(h)}var _mapCacheGet=mapCacheGet$1,getMapData$1=_getMapData;function mapCacheHas$1(h){return getMapData$1(this,h).has(h)}var _mapCacheHas=mapCacheHas$1,getMapData=_getMapData;function mapCacheSet$1(h,i){var g=getMapData(this,h),_=g.size;return g.set(h,i),this.size+=g.size==_?0:1,this}var _mapCacheSet=mapCacheSet$1,mapCacheClear=_mapCacheClear,mapCacheDelete=_mapCacheDelete,mapCacheGet=_mapCacheGet,mapCacheHas=_mapCacheHas,mapCacheSet=_mapCacheSet;function MapCache$3(h){var i=-1,g=h==null?0:h.length;for(this.clear();++i<g;){var _=h[i];this.set(_[0],_[1])}}MapCache$3.prototype.clear=mapCacheClear;MapCache$3.prototype.delete=mapCacheDelete;MapCache$3.prototype.get=mapCacheGet;MapCache$3.prototype.has=mapCacheHas;MapCache$3.prototype.set=mapCacheSet;var _MapCache=MapCache$3,MapCache$2=_MapCache,FUNC_ERROR_TEXT$1="Expected a function";function memoize$1(h,i){if(typeof h!="function"||i!=null&&typeof i!="function")throw new TypeError(FUNC_ERROR_TEXT$1);var g=function(){var _=arguments,j=i?i.apply(this,_):_[0],$=g.cache;if($.has(j))return $.get(j);var _n=h.apply(this,_);return g.cache=$.set(j,_n)||$,_n};return g.cache=new(memoize$1.Cache||MapCache$2),g}memoize$1.Cache=MapCache$2;var memoize_1=memoize$1,memoize=memoize_1,MAX_MEMOIZE_SIZE=500;function memoizeCapped$1(h){var i=memoize(h,function(_){return g.size===MAX_MEMOIZE_SIZE&&g.clear(),_}),g=i.cache;return i}var _memoizeCapped=memoizeCapped$1,memoizeCapped=_memoizeCapped,rePropName=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,reEscapeChar=/\\(\\)?/g,stringToPath$1=memoizeCapped(function(h){var i=[];return h.charCodeAt(0)===46&&i.push(""),h.replace(rePropName,function(g,_,j,$){i.push(j?$.replace(reEscapeChar,"$1"):_||g)}),i}),_stringToPath=stringToPath$1,Symbol$4=_Symbol,arrayMap$4=_arrayMap,isArray$c=isArray_1,isSymbol$3=isSymbol_1,INFINITY$3=1/0,symbolProto$1=Symbol$4?Symbol$4.prototype:void 0,symbolToString=symbolProto$1?symbolProto$1.toString:void 0;function baseToString$1(h){if(typeof h=="string")return h;if(isArray$c(h))return arrayMap$4(h,baseToString$1)+"";if(isSymbol$3(h))return symbolToString?symbolToString.call(h):"";var i=h+"";return i=="0"&&1/h==-INFINITY$3?"-0":i}var _baseToString=baseToString$1,baseToString=_baseToString;function toString$2(h){return h==null?"":baseToString(h)}var toString_1=toString$2,isArray$b=isArray_1,isKey$2=_isKey,stringToPath=_stringToPath,toString$1=toString_1;function castPath$4(h,i){return isArray$b(h)?h:isKey$2(h,i)?[h]:stringToPath(toString$1(h))}var _castPath=castPath$4,isSymbol$2=isSymbol_1,INFINITY$2=1/0;function toKey$5(h){if(typeof h=="string"||isSymbol$2(h))return h;var i=h+"";return i=="0"&&1/h==-INFINITY$2?"-0":i}var _toKey=toKey$5,castPath$3=_castPath,toKey$4=_toKey;function baseGet$4(h,i){i=castPath$3(i,h);for(var g=0,_=i.length;h!=null&&g<_;)h=h[toKey$4(i[g++])];return g&&g==_?h:void 0}var _baseGet=baseGet$4,ListCache$2=_ListCache;function stackClear$1(){this.__data__=new ListCache$2,this.size=0}var _stackClear=stackClear$1;function stackDelete$1(h){var i=this.__data__,g=i.delete(h);return this.size=i.size,g}var _stackDelete=stackDelete$1;function stackGet$1(h){return this.__data__.get(h)}var _stackGet=stackGet$1;function stackHas$1(h){return this.__data__.has(h)}var _stackHas=stackHas$1,ListCache$1=_ListCache,Map$2=_Map,MapCache$1=_MapCache,LARGE_ARRAY_SIZE$2=200;function stackSet$1(h,i){var g=this.__data__;if(g instanceof ListCache$1){var _=g.__data__;if(!Map$2||_.length<LARGE_ARRAY_SIZE$2-1)return _.push([h,i]),this.size=++g.size,this;g=this.__data__=new MapCache$1(_)}return g.set(h,i),this.size=g.size,this}var _stackSet=stackSet$1,ListCache=_ListCache,stackClear=_stackClear,stackDelete=_stackDelete,stackGet=_stackGet,stackHas=_stackHas,stackSet=_stackSet;function Stack$2(h){var i=this.__data__=new ListCache(h);this.size=i.size}Stack$2.prototype.clear=stackClear;Stack$2.prototype.delete=stackDelete;Stack$2.prototype.get=stackGet;Stack$2.prototype.has=stackHas;Stack$2.prototype.set=stackSet;var _Stack=Stack$2,HASH_UNDEFINED="__lodash_hash_undefined__";function setCacheAdd$1(h){return this.__data__.set(h,HASH_UNDEFINED),this}var _setCacheAdd=setCacheAdd$1;function setCacheHas$1(h){return this.__data__.has(h)}var _setCacheHas=setCacheHas$1,MapCache=_MapCache,setCacheAdd=_setCacheAdd,setCacheHas=_setCacheHas;function SetCache$3(h){var i=-1,g=h==null?0:h.length;for(this.__data__=new MapCache;++i<g;)this.add(h[i])}SetCache$3.prototype.add=SetCache$3.prototype.push=setCacheAdd;SetCache$3.prototype.has=setCacheHas;var _SetCache=SetCache$3;function arraySome$2(h,i){for(var g=-1,_=h==null?0:h.length;++g<_;)if(i(h[g],g,h))return!0;return!1}var _arraySome=arraySome$2;function cacheHas$3(h,i){return h.has(i)}var _cacheHas=cacheHas$3,SetCache$2=_SetCache,arraySome$1=_arraySome,cacheHas$2=_cacheHas,COMPARE_PARTIAL_FLAG$5=1,COMPARE_UNORDERED_FLAG$3=2;function equalArrays$2(h,i,g,_,j,$){var _n=g&COMPARE_PARTIAL_FLAG$5,_i=h.length,_s=i.length;if(_i!=_s&&!(_n&&_s>_i))return!1;var ga=$.get(h),ba=$.get(i);if(ga&&ba)return ga==i&&ba==h;var xa=-1,El=!0,Tl=g&COMPARE_UNORDERED_FLAG$3?new SetCache$2:void 0;for($.set(h,i),$.set(i,h);++xa<_i;){var Sl=h[xa],Il=i[xa];if(_)var Cl=_n?_(Il,Sl,xa,i,h,$):_(Sl,Il,xa,h,i,$);if(Cl!==void 0){if(Cl)continue;El=!1;break}if(Tl){if(!arraySome$1(i,function(Nl,Dl){if(!cacheHas$2(Tl,Dl)&&(Sl===Nl||j(Sl,Nl,g,_,$)))return Tl.push(Dl)})){El=!1;break}}else if(!(Sl===Il||j(Sl,Il,g,_,$))){El=!1;break}}return $.delete(h),$.delete(i),El}var _equalArrays=equalArrays$2,root$4=_root,Uint8Array$2=root$4.Uint8Array,_Uint8Array=Uint8Array$2;function mapToArray$1(h){var i=-1,g=Array(h.size);return h.forEach(function(_,j){g[++i]=[j,_]}),g}var _mapToArray=mapToArray$1;function setToArray$3(h){var i=-1,g=Array(h.size);return h.forEach(function(_){g[++i]=_}),g}var _setToArray=setToArray$3,Symbol$3=_Symbol,Uint8Array$1=_Uint8Array,eq$2=eq_1,equalArrays$1=_equalArrays,mapToArray=_mapToArray,setToArray$2=_setToArray,COMPARE_PARTIAL_FLAG$4=1,COMPARE_UNORDERED_FLAG$2=2,boolTag="[object Boolean]",dateTag$1="[object Date]",errorTag="[object Error]",mapTag$2="[object Map]",numberTag="[object Number]",regexpTag$1="[object RegExp]",setTag$2="[object Set]",stringTag$1="[object String]",symbolTag="[object Symbol]",arrayBufferTag="[object ArrayBuffer]",dataViewTag$1="[object DataView]",symbolProto=Symbol$3?Symbol$3.prototype:void 0,symbolValueOf=symbolProto?symbolProto.valueOf:void 0;function equalByTag$1(h,i,g,_,j,$,_n){switch(g){case dataViewTag$1:if(h.byteLength!=i.byteLength||h.byteOffset!=i.byteOffset)return!1;h=h.buffer,i=i.buffer;case arrayBufferTag:return!(h.byteLength!=i.byteLength||!$(new Uint8Array$1(h),new Uint8Array$1(i)));case boolTag:case dateTag$1:case numberTag:return eq$2(+h,+i);case errorTag:return h.name==i.name&&h.message==i.message;case regexpTag$1:case stringTag$1:return h==i+"";case mapTag$2:var _i=mapToArray;case setTag$2:var _s=_&COMPARE_PARTIAL_FLAG$4;if(_i||(_i=setToArray$2),h.size!=i.size&&!_s)return!1;var ga=_n.get(h);if(ga)return ga==i;_|=COMPARE_UNORDERED_FLAG$2,_n.set(h,i);var ba=equalArrays$1(_i(h),_i(i),_,j,$,_n);return _n.delete(h),ba;case symbolTag:if(symbolValueOf)return symbolValueOf.call(h)==symbolValueOf.call(i)}return!1}var _equalByTag=equalByTag$1;function arrayPush$3(h,i){for(var g=-1,_=i.length,j=h.length;++g<_;)h[j+g]=i[g];return h}var _arrayPush=arrayPush$3,arrayPush$2=_arrayPush,isArray$a=isArray_1;function baseGetAllKeys$2(h,i,g){var _=i(h);return isArray$a(h)?_:arrayPush$2(_,g(h))}var _baseGetAllKeys=baseGetAllKeys$2;function arrayFilter$1(h,i){for(var g=-1,_=h==null?0:h.length,j=0,$=[];++g<_;){var _n=h[g];i(_n,g,h)&&($[j++]=_n)}return $}var _arrayFilter=arrayFilter$1;function stubArray$2(){return[]}var stubArray_1=stubArray$2,arrayFilter=_arrayFilter,stubArray$1=stubArray_1,objectProto$8=Object.prototype,propertyIsEnumerable=objectProto$8.propertyIsEnumerable,nativeGetSymbols$1=Object.getOwnPropertySymbols,getSymbols$2=nativeGetSymbols$1?function(h){return h==null?[]:(h=Object(h),arrayFilter(nativeGetSymbols$1(h),function(i){return propertyIsEnumerable.call(h,i)}))}:stubArray$1,_getSymbols=getSymbols$2,baseGetAllKeys$1=_baseGetAllKeys,getSymbols$1=_getSymbols,keys$4=keys_1;function getAllKeys$1(h){return baseGetAllKeys$1(h,keys$4,getSymbols$1)}var _getAllKeys=getAllKeys$1,getAllKeys=_getAllKeys,COMPARE_PARTIAL_FLAG$3=1,objectProto$7=Object.prototype,hasOwnProperty$6=objectProto$7.hasOwnProperty;function equalObjects$1(h,i,g,_,j,$){var _n=g&COMPARE_PARTIAL_FLAG$3,_i=getAllKeys(h),_s=_i.length,ga=getAllKeys(i),ba=ga.length;if(_s!=ba&&!_n)return!1;for(var xa=_s;xa--;){var El=_i[xa];if(!(_n?El in i:hasOwnProperty$6.call(i,El)))return!1}var Tl=$.get(h),Sl=$.get(i);if(Tl&&Sl)return Tl==i&&Sl==h;var Il=!0;$.set(h,i),$.set(i,h);for(var Cl=_n;++xa<_s;){El=_i[xa];var Nl=h[El],Dl=i[El];if(_)var Ul=_n?_(Dl,Nl,El,i,h,$):_(Nl,Dl,El,h,i,$);if(!(Ul===void 0?Nl===Dl||j(Nl,Dl,g,_,$):Ul)){Il=!1;break}Cl||(Cl=El=="constructor")}if(Il&&!Cl){var Kl=h.constructor,Jl=i.constructor;Kl!=Jl&&"constructor"in h&&"constructor"in i&&!(typeof Kl=="function"&&Kl instanceof Kl&&typeof Jl=="function"&&Jl instanceof Jl)&&(Il=!1)}return $.delete(h),$.delete(i),Il}var _equalObjects=equalObjects$1,getNative$3=_getNative,root$3=_root,DataView$2=getNative$3(root$3,"DataView"),_DataView=DataView$2,getNative$2=_getNative,root$2=_root,Promise$2=getNative$2(root$2,"Promise"),_Promise=Promise$2,getNative$1=_getNative,root$1=_root,Set$3=getNative$1(root$1,"Set"),_Set=Set$3,getNative=_getNative,root=_root,WeakMap$2=getNative(root,"WeakMap"),_WeakMap=WeakMap$2,DataView$1=_DataView,Map$1=_Map,Promise$1=_Promise,Set$2=_Set,WeakMap$1=_WeakMap,baseGetTag$4=_baseGetTag,toSource=_toSource,mapTag$1="[object Map]",objectTag$2="[object Object]",promiseTag="[object Promise]",setTag$1="[object Set]",weakMapTag="[object WeakMap]",dataViewTag="[object DataView]",dataViewCtorString=toSource(DataView$1),mapCtorString=toSource(Map$1),promiseCtorString=toSource(Promise$1),setCtorString=toSource(Set$2),weakMapCtorString=toSource(WeakMap$1),getTag$2=baseGetTag$4;(DataView$1&&getTag$2(new DataView$1(new ArrayBuffer(1)))!=dataViewTag||Map$1&&getTag$2(new Map$1)!=mapTag$1||Promise$1&&getTag$2(Promise$1.resolve())!=promiseTag||Set$2&&getTag$2(new Set$2)!=setTag$1||WeakMap$1&&getTag$2(new WeakMap$1)!=weakMapTag)&&(getTag$2=function(h){var i=baseGetTag$4(h),g=i==objectTag$2?h.constructor:void 0,_=g?toSource(g):"";if(_)switch(_){case dataViewCtorString:return dataViewTag;case mapCtorString:return mapTag$1;case promiseCtorString:return promiseTag;case setCtorString:return setTag$1;case weakMapCtorString:return weakMapTag}return i});var _getTag=getTag$2,Stack$1=_Stack,equalArrays=_equalArrays,equalByTag=_equalByTag,equalObjects=_equalObjects,getTag$1=_getTag,isArray$9=isArray_1,isBuffer$1=isBufferExports,isTypedArray$1=isTypedArray_1,COMPARE_PARTIAL_FLAG$2=1,argsTag="[object Arguments]",arrayTag="[object Array]",objectTag$1="[object Object]",objectProto$6=Object.prototype,hasOwnProperty$5=objectProto$6.hasOwnProperty;function baseIsEqualDeep$1(h,i,g,_,j,$){var _n=isArray$9(h),_i=isArray$9(i),_s=_n?arrayTag:getTag$1(h),ga=_i?arrayTag:getTag$1(i);_s=_s==argsTag?objectTag$1:_s,ga=ga==argsTag?objectTag$1:ga;var ba=_s==objectTag$1,xa=ga==objectTag$1,El=_s==ga;if(El&&isBuffer$1(h)){if(!isBuffer$1(i))return!1;_n=!0,ba=!1}if(El&&!ba)return $||($=new Stack$1),_n||isTypedArray$1(h)?equalArrays(h,i,g,_,j,$):equalByTag(h,i,_s,g,_,j,$);if(!(g&COMPARE_PARTIAL_FLAG$2)){var Tl=ba&&hasOwnProperty$5.call(h,"__wrapped__"),Sl=xa&&hasOwnProperty$5.call(i,"__wrapped__");if(Tl||Sl){var Il=Tl?h.value():h,Cl=Sl?i.value():i;return $||($=new Stack$1),j(Il,Cl,g,_,$)}}return El?($||($=new Stack$1),equalObjects(h,i,g,_,j,$)):!1}var _baseIsEqualDeep=baseIsEqualDeep$1,baseIsEqualDeep=_baseIsEqualDeep,isObjectLike$5=isObjectLike_1;function baseIsEqual$3(h,i,g,_,j){return h===i?!0:h==null||i==null||!isObjectLike$5(h)&&!isObjectLike$5(i)?h!==h&&i!==i:baseIsEqualDeep(h,i,g,_,baseIsEqual$3,j)}var _baseIsEqual=baseIsEqual$3,Stack=_Stack,baseIsEqual$2=_baseIsEqual,COMPARE_PARTIAL_FLAG$1=1,COMPARE_UNORDERED_FLAG$1=2;function baseIsMatch$1(h,i,g,_){var j=g.length,$=j,_n=!_;if(h==null)return!$;for(h=Object(h);j--;){var _i=g[j];if(_n&&_i[2]?_i[1]!==h[_i[0]]:!(_i[0]in h))return!1}for(;++j<$;){_i=g[j];var _s=_i[0],ga=h[_s],ba=_i[1];if(_n&&_i[2]){if(ga===void 0&&!(_s in h))return!1}else{var xa=new Stack;if(_)var El=_(ga,ba,_s,h,i,xa);if(!(El===void 0?baseIsEqual$2(ba,ga,COMPARE_PARTIAL_FLAG$1|COMPARE_UNORDERED_FLAG$1,_,xa):El))return!1}}return!0}var _baseIsMatch=baseIsMatch$1,isObject$3=isObject_1;function isStrictComparable$2(h){return h===h&&!isObject$3(h)}var _isStrictComparable=isStrictComparable$2,isStrictComparable$1=_isStrictComparable,keys$3=keys_1;function getMatchData$1(h){for(var i=keys$3(h),g=i.length;g--;){var _=i[g],j=h[_];i[g]=[_,j,isStrictComparable$1(j)]}return i}var _getMatchData=getMatchData$1;function matchesStrictComparable$2(h,i){return function(g){return g==null?!1:g[h]===i&&(i!==void 0||h in Object(g))}}var _matchesStrictComparable=matchesStrictComparable$2,baseIsMatch=_baseIsMatch,getMatchData=_getMatchData,matchesStrictComparable$1=_matchesStrictComparable;function baseMatches$1(h){var i=getMatchData(h);return i.length==1&&i[0][2]?matchesStrictComparable$1(i[0][0],i[0][1]):function(g){return g===h||baseIsMatch(g,h,i)}}var _baseMatches=baseMatches$1,baseGet$3=_baseGet;function get$1(h,i,g){var _=h==null?void 0:baseGet$3(h,i);return _===void 0?g:_}var get_1=get$1;function baseHasIn$1(h,i){return h!=null&&i in Object(h)}var _baseHasIn=baseHasIn$1,castPath$2=_castPath,isArguments$2=isArguments_1,isArray$8=isArray_1,isIndex$1=_isIndex,isLength=isLength_1,toKey$3=_toKey;function hasPath$1(h,i,g){i=castPath$2(i,h);for(var _=-1,j=i.length,$=!1;++_<j;){var _n=toKey$3(i[_]);if(!($=h!=null&&g(h,_n)))break;h=h[_n]}return $||++_!=j?$:(j=h==null?0:h.length,!!j&&isLength(j)&&isIndex$1(_n,j)&&(isArray$8(h)||isArguments$2(h)))}var _hasPath=hasPath$1,baseHasIn=_baseHasIn,hasPath=_hasPath;function hasIn$2(h,i){return h!=null&&hasPath(h,i,baseHasIn)}var hasIn_1=hasIn$2,baseIsEqual$1=_baseIsEqual,get=get_1,hasIn$1=hasIn_1,isKey$1=_isKey,isStrictComparable=_isStrictComparable,matchesStrictComparable=_matchesStrictComparable,toKey$2=_toKey,COMPARE_PARTIAL_FLAG=1,COMPARE_UNORDERED_FLAG=2;function baseMatchesProperty$1(h,i){return isKey$1(h)&&isStrictComparable(i)?matchesStrictComparable(toKey$2(h),i):function(g){var _=get(g,h);return _===void 0&&_===i?hasIn$1(g,h):baseIsEqual$1(i,_,COMPARE_PARTIAL_FLAG|COMPARE_UNORDERED_FLAG)}}var _baseMatchesProperty=baseMatchesProperty$1;function baseProperty$1(h){return function(i){return i==null?void 0:i[h]}}var _baseProperty=baseProperty$1,baseGet$2=_baseGet;function basePropertyDeep$1(h){return function(i){return baseGet$2(i,h)}}var _basePropertyDeep=basePropertyDeep$1,baseProperty=_baseProperty,basePropertyDeep=_basePropertyDeep,isKey=_isKey,toKey$1=_toKey;function property$1(h){return isKey(h)?baseProperty(toKey$1(h)):basePropertyDeep(h)}var property_1=property$1,baseMatches=_baseMatches,baseMatchesProperty=_baseMatchesProperty,identity$6=identity_1,isArray$7=isArray_1,property=property_1;function baseIteratee$8(h){return typeof h=="function"?h:h==null?identity$6:typeof h=="object"?isArray$7(h)?baseMatchesProperty(h[0],h[1]):baseMatches(h):property(h)}var _baseIteratee=baseIteratee$8;function createBaseFor$1(h){return function(i,g,_){for(var j=-1,$=Object(i),_n=_(i),_i=_n.length;_i--;){var _s=_n[h?_i:++j];if(g($[_s],_s,$)===!1)break}return i}}var _createBaseFor=createBaseFor$1,createBaseFor=_createBaseFor,baseFor$1=createBaseFor(),_baseFor=baseFor$1,baseFor=_baseFor,keys$2=keys_1;function baseForOwn$2(h,i){return h&&baseFor(h,i,keys$2)}var _baseForOwn=baseForOwn$2,isArrayLike$6=isArrayLike_1;function createBaseEach$1(h,i){return function(g,_){if(g==null)return g;if(!isArrayLike$6(g))return h(g,_);for(var j=g.length,$=i?j:-1,_n=Object(g);(i?$--:++$<j)&&_(_n[$],$,_n)!==!1;);return g}}var _createBaseEach=createBaseEach$1,baseForOwn$1=_baseForOwn,createBaseEach=_createBaseEach,baseEach$3=createBaseEach(baseForOwn$1),_baseEach=baseEach$3,baseEach$2=_baseEach,isArrayLike$5=isArrayLike_1;function baseMap$1(h,i){var g=-1,_=isArrayLike$5(h)?Array(h.length):[];return baseEach$2(h,function(j,$,_n){_[++g]=i(j,$,_n)}),_}var _baseMap=baseMap$1;function baseSortBy$1(h,i){var g=h.length;for(h.sort(i);g--;)h[g]=h[g].value;return h}var _baseSortBy=baseSortBy$1,isSymbol$1=isSymbol_1;function compareAscending$1(h,i){if(h!==i){var g=h!==void 0,_=h===null,j=h===h,$=isSymbol$1(h),_n=i!==void 0,_i=i===null,_s=i===i,ga=isSymbol$1(i);if(!_i&&!ga&&!$&&h>i||$&&_n&&_s&&!_i&&!ga||_&&_n&&_s||!g&&_s||!j)return 1;if(!_&&!$&&!ga&&h<i||ga&&g&&j&&!_&&!$||_i&&g&&j||!_n&&j||!_s)return-1}return 0}var _compareAscending=compareAscending$1,compareAscending=_compareAscending;function compareMultiple$1(h,i,g){for(var _=-1,j=h.criteria,$=i.criteria,_n=j.length,_i=g.length;++_<_n;){var _s=compareAscending(j[_],$[_]);if(_s){if(_>=_i)return _s;var ga=g[_];return _s*(ga=="desc"?-1:1)}}return h.index-i.index}var _compareMultiple=compareMultiple$1,arrayMap$3=_arrayMap,baseGet$1=_baseGet,baseIteratee$7=_baseIteratee,baseMap=_baseMap,baseSortBy=_baseSortBy,baseUnary$3=_baseUnary,compareMultiple=_compareMultiple,identity$5=identity_1,isArray$6=isArray_1;function baseOrderBy$1(h,i,g){i.length?i=arrayMap$3(i,function($){return isArray$6($)?function(_n){return baseGet$1(_n,$.length===1?$[0]:$)}:$}):i=[identity$5];var _=-1;i=arrayMap$3(i,baseUnary$3(baseIteratee$7));var j=baseMap(h,function($,_n,_i){var _s=arrayMap$3(i,function(ga){return ga($)});return{criteria:_s,index:++_,value:$}});return baseSortBy(j,function($,_n){return compareMultiple($,_n,g)})}var _baseOrderBy=baseOrderBy$1,baseOrderBy=_baseOrderBy,isArray$5=isArray_1;function orderBy(h,i,g,_){return h==null?[]:(isArray$5(i)||(i=i==null?[]:[i]),g=_?void 0:g,isArray$5(g)||(g=g==null?[]:[g]),baseOrderBy(h,i,g))}var orderBy_1=orderBy,overArg=_overArg,getPrototype$2=overArg(Object.getPrototypeOf,Object),_getPrototype=getPrototype$2,baseGetTag$3=_baseGetTag,getPrototype$1=_getPrototype,isObjectLike$4=isObjectLike_1,objectTag="[object Object]",funcProto=Function.prototype,objectProto$5=Object.prototype,funcToString=funcProto.toString,hasOwnProperty$4=objectProto$5.hasOwnProperty,objectCtorString=funcToString.call(Object);function isPlainObject(h){if(!isObjectLike$4(h)||baseGetTag$3(h)!=objectTag)return!1;var i=getPrototype$1(h);if(i===null)return!0;var g=hasOwnProperty$4.call(i,"constructor")&&i.constructor;return typeof g=="function"&&g instanceof g&&funcToString.call(g)==objectCtorString}var isPlainObject_1=isPlainObject;function define(h,i,g){h.prototype=i.prototype=g,g.constructor=h}function extend(h,i){var g=Object.create(h.prototype);for(var _ in i)g[_]=i[_];return g}function Color(){}var darker=.7,brighter=1/darker,reI="\\s*([+-]?\\d+)\\s*",reN="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",reP="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",reHex=/^#([0-9a-f]{3,8})$/,reRgbInteger=new RegExp(`^rgb\\(${reI},${reI},${reI}\\)$`),reRgbPercent=new RegExp(`^rgb\\(${reP},${reP},${reP}\\)$`),reRgbaInteger=new RegExp(`^rgba\\(${reI},${reI},${reI},${reN}\\)$`),reRgbaPercent=new RegExp(`^rgba\\(${reP},${reP},${reP},${reN}\\)$`),reHslPercent=new RegExp(`^hsl\\(${reN},${reP},${reP}\\)$`),reHslaPercent=new RegExp(`^hsla\\(${reN},${reP},${reP},${reN}\\)$`),named={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};define(Color,color,{copy(h){return Object.assign(new this.constructor,this,h)},displayable(){return this.rgb().displayable()},hex:color_formatHex,formatHex:color_formatHex,formatHex8:color_formatHex8,formatHsl:color_formatHsl,formatRgb:color_formatRgb,toString:color_formatRgb});function color_formatHex(){return this.rgb().formatHex()}function color_formatHex8(){return this.rgb().formatHex8()}function color_formatHsl(){return hslConvert(this).formatHsl()}function color_formatRgb(){return this.rgb().formatRgb()}function color(h){var i,g;return h=(h+"").trim().toLowerCase(),(i=reHex.exec(h))?(g=i[1].length,i=parseInt(i[1],16),g===6?rgbn(i):g===3?new Rgb(i>>8&15|i>>4&240,i>>4&15|i&240,(i&15)<<4|i&15,1):g===8?rgba(i>>24&255,i>>16&255,i>>8&255,(i&255)/255):g===4?rgba(i>>12&15|i>>8&240,i>>8&15|i>>4&240,i>>4&15|i&240,((i&15)<<4|i&15)/255):null):(i=reRgbInteger.exec(h))?new Rgb(i[1],i[2],i[3],1):(i=reRgbPercent.exec(h))?new Rgb(i[1]*255/100,i[2]*255/100,i[3]*255/100,1):(i=reRgbaInteger.exec(h))?rgba(i[1],i[2],i[3],i[4]):(i=reRgbaPercent.exec(h))?rgba(i[1]*255/100,i[2]*255/100,i[3]*255/100,i[4]):(i=reHslPercent.exec(h))?hsla(i[1],i[2]/100,i[3]/100,1):(i=reHslaPercent.exec(h))?hsla(i[1],i[2]/100,i[3]/100,i[4]):named.hasOwnProperty(h)?rgbn(named[h]):h==="transparent"?new Rgb(NaN,NaN,NaN,0):null}function rgbn(h){return new Rgb(h>>16&255,h>>8&255,h&255,1)}function rgba(h,i,g,_){return _<=0&&(h=i=g=NaN),new Rgb(h,i,g,_)}function rgbConvert(h){return h instanceof Color||(h=color(h)),h?(h=h.rgb(),new Rgb(h.r,h.g,h.b,h.opacity)):new Rgb}function rgb$1(h,i,g,_){return arguments.length===1?rgbConvert(h):new Rgb(h,i,g,_??1)}function Rgb(h,i,g,_){this.r=+h,this.g=+i,this.b=+g,this.opacity=+_}define(Rgb,rgb$1,extend(Color,{brighter(h){return h=h==null?brighter:Math.pow(brighter,h),new Rgb(this.r*h,this.g*h,this.b*h,this.opacity)},darker(h){return h=h==null?darker:Math.pow(darker,h),new Rgb(this.r*h,this.g*h,this.b*h,this.opacity)},rgb(){return this},clamp(){return new Rgb(clampi(this.r),clampi(this.g),clampi(this.b),clampa(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:rgb_formatHex,formatHex:rgb_formatHex,formatHex8:rgb_formatHex8,formatRgb:rgb_formatRgb,toString:rgb_formatRgb}));function rgb_formatHex(){return`#${hex(this.r)}${hex(this.g)}${hex(this.b)}`}function rgb_formatHex8(){return`#${hex(this.r)}${hex(this.g)}${hex(this.b)}${hex((isNaN(this.opacity)?1:this.opacity)*255)}`}function rgb_formatRgb(){const h=clampa(this.opacity);return`${h===1?"rgb(":"rgba("}${clampi(this.r)}, ${clampi(this.g)}, ${clampi(this.b)}${h===1?")":`, ${h})`}`}function clampa(h){return isNaN(h)?1:Math.max(0,Math.min(1,h))}function clampi(h){return Math.max(0,Math.min(255,Math.round(h)||0))}function hex(h){return h=clampi(h),(h<16?"0":"")+h.toString(16)}function hsla(h,i,g,_){return _<=0?h=i=g=NaN:g<=0||g>=1?h=i=NaN:i<=0&&(h=NaN),new Hsl(h,i,g,_)}function hslConvert(h){if(h instanceof Hsl)return new Hsl(h.h,h.s,h.l,h.opacity);if(h instanceof Color||(h=color(h)),!h)return new Hsl;if(h instanceof Hsl)return h;h=h.rgb();var i=h.r/255,g=h.g/255,_=h.b/255,j=Math.min(i,g,_),$=Math.max(i,g,_),_n=NaN,_i=$-j,_s=($+j)/2;return _i?(i===$?_n=(g-_)/_i+(g<_)*6:g===$?_n=(_-i)/_i+2:_n=(i-g)/_i+4,_i/=_s<.5?$+j:2-$-j,_n*=60):_i=_s>0&&_s<1?0:_n,new Hsl(_n,_i,_s,h.opacity)}function hsl(h,i,g,_){return arguments.length===1?hslConvert(h):new Hsl(h,i,g,_??1)}function Hsl(h,i,g,_){this.h=+h,this.s=+i,this.l=+g,this.opacity=+_}define(Hsl,hsl,extend(Color,{brighter(h){return h=h==null?brighter:Math.pow(brighter,h),new Hsl(this.h,this.s,this.l*h,this.opacity)},darker(h){return h=h==null?darker:Math.pow(darker,h),new Hsl(this.h,this.s,this.l*h,this.opacity)},rgb(){var h=this.h%360+(this.h<0)*360,i=isNaN(h)||isNaN(this.s)?0:this.s,g=this.l,_=g+(g<.5?g:1-g)*i,j=2*g-_;return new Rgb(hsl2rgb(h>=240?h-240:h+120,j,_),hsl2rgb(h,j,_),hsl2rgb(h<120?h+240:h-120,j,_),this.opacity)},clamp(){return new Hsl(clamph(this.h),clampt(this.s),clampt(this.l),clampa(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const h=clampa(this.opacity);return`${h===1?"hsl(":"hsla("}${clamph(this.h)}, ${clampt(this.s)*100}%, ${clampt(this.l)*100}%${h===1?")":`, ${h})`}`}}));function clamph(h){return h=(h||0)%360,h<0?h+360:h}function clampt(h){return Math.max(0,Math.min(1,h||0))}function hsl2rgb(h,i,g){return(h<60?i+(g-i)*h/60:h<180?g:h<240?i+(g-i)*(240-h)/60:i)*255}const constant$2=h=>()=>h;function linear$1(h,i){return function(g){return h+g*i}}function exponential(h,i,g){return h=Math.pow(h,g),i=Math.pow(i,g)-h,g=1/g,function(_){return Math.pow(h+_*i,g)}}function gamma(h){return(h=+h)==1?nogamma:function(i,g){return g-i?exponential(i,g,h):constant$2(isNaN(i)?g:i)}}function nogamma(h,i){var g=i-h;return g?linear$1(h,g):constant$2(isNaN(h)?i:h)}const rgb=function h(i){var g=gamma(i);function _(j,$){var _n=g((j=rgb$1(j)).r,($=rgb$1($)).r),_i=g(j.g,$.g),_s=g(j.b,$.b),ga=nogamma(j.opacity,$.opacity);return function(ba){return j.r=_n(ba),j.g=_i(ba),j.b=_s(ba),j.opacity=ga(ba),j+""}}return _.gamma=h,_}(1);function numberArray(h,i){i||(i=[]);var g=h?Math.min(i.length,h.length):0,_=i.slice(),j;return function($){for(j=0;j<g;++j)_[j]=h[j]*(1-$)+i[j]*$;return _}}function isNumberArray(h){return ArrayBuffer.isView(h)&&!(h instanceof DataView)}function genericArray(h,i){var g=i?i.length:0,_=h?Math.min(g,h.length):0,j=new Array(_),$=new Array(g),_n;for(_n=0;_n<_;++_n)j[_n]=interpolate(h[_n],i[_n]);for(;_n<g;++_n)$[_n]=i[_n];return function(_i){for(_n=0;_n<_;++_n)$[_n]=j[_n](_i);return $}}function date$1(h,i){var g=new Date;return h=+h,i=+i,function(_){return g.setTime(h*(1-_)+i*_),g}}function interpolateNumber(h,i){return h=+h,i=+i,function(g){return h*(1-g)+i*g}}function object(h,i){var g={},_={},j;(h===null||typeof h!="object")&&(h={}),(i===null||typeof i!="object")&&(i={});for(j in i)j in h?g[j]=interpolate(h[j],i[j]):_[j]=i[j];return function($){for(j in g)_[j]=g[j]($);return _}}var reA=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,reB=new RegExp(reA.source,"g");function zero$1(h){return function(){return h}}function one(h){return function(i){return h(i)+""}}function string(h,i){var g=reA.lastIndex=reB.lastIndex=0,_,j,$,_n=-1,_i=[],_s=[];for(h=h+"",i=i+"";(_=reA.exec(h))&&(j=reB.exec(i));)($=j.index)>g&&($=i.slice(g,$),_i[_n]?_i[_n]+=$:_i[++_n]=$),(_=_[0])===(j=j[0])?_i[_n]?_i[_n]+=j:_i[++_n]=j:(_i[++_n]=null,_s.push({i:_n,x:interpolateNumber(_,j)})),g=reB.lastIndex;return g<i.length&&($=i.slice(g),_i[_n]?_i[_n]+=$:_i[++_n]=$),_i.length<2?_s[0]?one(_s[0].x):zero$1(i):(i=_s.length,function(ga){for(var ba=0,xa;ba<i;++ba)_i[(xa=_s[ba]).i]=xa.x(ga);return _i.join("")})}function interpolate(h,i){var g=typeof i,_;return i==null||g==="boolean"?constant$2(i):(g==="number"?interpolateNumber:g==="string"?(_=color(i))?(i=_,rgb):string:i instanceof color?rgb:i instanceof Date?date$1:isNumberArray(i)?numberArray:Array.isArray(i)?genericArray:typeof i.valueOf!="function"&&typeof i.toString!="function"||isNaN(i)?object:interpolateNumber)(h,i)}function interpolateRound(h,i){return h=+h,i=+i,function(g){return Math.round(h*(1-g)+i*g)}}function piecewise(h,i){i===void 0&&(i=h,h=interpolate);for(var g=0,_=i.length-1,j=i[0],$=new Array(_<0?0:_);g<_;)$[g]=h(j,j=i[++g]);return function(_n){var _i=Math.max(0,Math.min(_-1,Math.floor(_n*=_)));return $[_i](_n-_i)}}var isInterpolatable=function(h){if(h!==null)switch(typeof h){case"undefined":return!1;case"number":return!isNaN(h)&&h!==Number.POSITIVE_INFINITY&&h!==Number.NEGATIVE_INFINITY;case"string":return!0;case"boolean":return!1;case"object":return h instanceof Date||Array.isArray(h)||isPlainObject_1(h);case"function":return!0}return!1},interpolateImmediate=function(h,i){var g=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return function(_){return _<g?h:i}},interpolateFunction=function(h,i){return function(g){return g>=1?i:function(){var _=typeof h=="function"?h.apply(this,arguments):h,j=typeof i=="function"?i.apply(this,arguments):i;return interpolate(_,j)(g)}}},interpolateObject=function(h,i){var g=function(_i,_s){return _i===_s||!isInterpolatable(_i)||!isInterpolatable(_s)?interpolateImmediate(_i,_s):typeof _i=="function"||typeof _s=="function"?interpolateFunction(_i,_s):typeof _i=="object"&&isPlainObject_1(_i)||typeof _s=="object"&&isPlainObject_1(_s)?interpolateObject(_i,_s):interpolate(_i,_s)},_=function(_i){return Array.isArray(_i)?orderBy_1(_i,"key"):_i},j={},$={},_n;(h===null||typeof h!="object")&&(h={}),(i===null||typeof i!="object")&&(i={});for(_n in i)_n in h?j[_n]=g(_(h[_n]),_(i[_n])):$[_n]=i[_n];return function(_i){for(_n in j)$[_n]=j[_n](_i);return $}},interpolateString=function(h,i){var g=function(_){return typeof _=="string"?_.replace(/,/g,""):_};return interpolate(g(h),g(i))},victoryInterpolator=function(h,i){return h===i||!isInterpolatable(h)||!isInterpolatable(i)?interpolateImmediate(h,i):typeof h=="function"||typeof i=="function"?interpolateFunction(h,i):isPlainObject_1(h)||isPlainObject_1(i)?interpolateObject(h,i):typeof h=="string"||typeof i=="string"?interpolateString(h,i):interpolate(h,i)},frame=0,timeout=0,interval=0,pokeDelay=1e3,taskHead,taskTail,clockLast=0,clockNow=0,clockSkew=0,clock=typeof performance=="object"&&performance.now?performance:Date,setFrame=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(h){setTimeout(h,17)};function now(){return clockNow||(setFrame(clearNow),clockNow=clock.now()+clockSkew)}function clearNow(){clockNow=0}function Timer$1(){this._call=this._time=this._next=null}Timer$1.prototype=timer.prototype={constructor:Timer$1,restart:function(h,i,g){if(typeof h!="function")throw new TypeError("callback is not a function");g=(g==null?now():+g)+(i==null?0:+i),!this._next&&taskTail!==this&&(taskTail?taskTail._next=this:taskHead=this,taskTail=this),this._call=h,this._time=g,sleep()},stop:function(){this._call&&(this._call=null,this._time=1/0,sleep())}};function timer(h,i,g){var _=new Timer$1;return _.restart(h,i,g),_}function timerFlush(){now(),++frame;for(var h=taskHead,i;h;)(i=clockNow-h._time)>=0&&h._call.call(void 0,i),h=h._next;--frame}function wake(){clockNow=(clockLast=clock.now())+clockSkew,frame=timeout=0;try{timerFlush()}finally{frame=0,nap(),clockNow=0}}function poke(){var h=clock.now(),i=h-clockLast;i>pokeDelay&&(clockSkew-=i,clockLast=h)}function nap(){for(var h,i=taskHead,g,_=1/0;i;)i._call?(_>i._time&&(_=i._time),h=i,i=i._next):(g=i._next,i._next=null,i=h?h._next=g:taskHead=g);taskTail=h,sleep(_)}function sleep(h){if(!frame){timeout&&(timeout=clearTimeout(timeout));var i=h-clockNow;i>24?(h<1/0&&(timeout=setTimeout(wake,h-clock.now()-clockSkew)),interval&&(interval=clearInterval(interval))):(interval||(clockLast=clock.now(),interval=setInterval(poke,pokeDelay)),frame=1,setFrame(wake))}}function _classCallCheck$c(h,i){if(!(h instanceof i))throw new TypeError("Cannot call a class as a function")}function _defineProperties$c(h,i){for(var g=0;g<i.length;g++){var _=i[g];_.enumerable=_.enumerable||!1,_.configurable=!0,"value"in _&&(_.writable=!0),Object.defineProperty(h,_.key,_)}}function _createClass$c(h,i,g){return i&&_defineProperties$c(h.prototype,i),g&&_defineProperties$c(h,g),Object.defineProperty(h,"prototype",{writable:!1}),h}var Timer=function(){function h(){var i=this;_classCallCheck$c(this,h),this.shouldAnimate=void 0,this.subscribers=void 0,this.activeSubscriptions=void 0,this.timer=void 0,this.loop=function(){i.subscribers.forEach(function(g){g.callback(now()-g.startTime,g.duration)})},this.shouldAnimate=!0,this.subscribers=[],this.timer=null,this.activeSubscriptions=0}return _createClass$c(h,[{key:"bypassAnimation",value:function(){this.shouldAnimate=!1}},{key:"resumeAnimation",value:function(){this.shouldAnimate=!0}},{key:"start",value:function(){this.timer||(this.timer=timer(this.loop))}},{key:"stop",value:function(){this.timer&&(this.timer.stop(),this.timer=null)}},{key:"subscribe",value:function(g,_){_=this.shouldAnimate?_:0;var j=this.subscribers.push({startTime:now(),callback:g,duration:_});return this.activeSubscriptions++,this.start(),j}},{key:"unsubscribe",value:function(g){g!==null&&this.subscribers[g-1]&&(delete this.subscribers[g-1],this.activeSubscriptions--),this.activeSubscriptions===0&&this.stop()}}]),h}(),TimerContext=React.createContext({transitionTimer:new Timer,animationTimer:new Timer});TimerContext.displayName="TimerContext";const TimerContext$1=TimerContext;var hasElementType=typeof Element<"u",hasMap=typeof Map=="function",hasSet=typeof Set=="function",hasArrayBuffer=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function equal(h,i){if(h===i)return!0;if(h&&i&&typeof h=="object"&&typeof i=="object"){if(h.constructor!==i.constructor)return!1;var g,_,j;if(Array.isArray(h)){if(g=h.length,g!=i.length)return!1;for(_=g;_--!==0;)if(!equal(h[_],i[_]))return!1;return!0}var $;if(hasMap&&h instanceof Map&&i instanceof Map){if(h.size!==i.size)return!1;for($=h.entries();!(_=$.next()).done;)if(!i.has(_.value[0]))return!1;for($=h.entries();!(_=$.next()).done;)if(!equal(_.value[1],i.get(_.value[0])))return!1;return!0}if(hasSet&&h instanceof Set&&i instanceof Set){if(h.size!==i.size)return!1;for($=h.entries();!(_=$.next()).done;)if(!i.has(_.value[0]))return!1;return!0}if(hasArrayBuffer&&ArrayBuffer.isView(h)&&ArrayBuffer.isView(i)){if(g=h.length,g!=i.length)return!1;for(_=g;_--!==0;)if(h[_]!==i[_])return!1;return!0}if(h.constructor===RegExp)return h.source===i.source&&h.flags===i.flags;if(h.valueOf!==Object.prototype.valueOf&&typeof h.valueOf=="function"&&typeof i.valueOf=="function")return h.valueOf()===i.valueOf();if(h.toString!==Object.prototype.toString&&typeof h.toString=="function"&&typeof i.toString=="function")return h.toString()===i.toString();if(j=Object.keys(h),g=j.length,g!==Object.keys(i).length)return!1;for(_=g;_--!==0;)if(!Object.prototype.hasOwnProperty.call(i,j[_]))return!1;if(hasElementType&&h instanceof Element)return!1;for(_=g;_--!==0;)if(!((j[_]==="_owner"||j[_]==="__v"||j[_]==="__o")&&h.$$typeof)&&!equal(h[j[_]],i[j[_]]))return!1;return!0}return h!==h&&i!==i}var reactFastCompare=function h(i,g){try{return equal(i,g)}catch(_){if((_.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw _}};function _toConsumableArray$g(h){return _arrayWithoutHoles$g(h)||_iterableToArray$g(h)||_unsupportedIterableToArray$j(h)||_nonIterableSpread$g()}function _nonIterableSpread$g(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _unsupportedIterableToArray$j(h,i){if(h){if(typeof h=="string")return _arrayLikeToArray$j(h,i);var g=Object.prototype.toString.call(h).slice(8,-1);if(g==="Object"&&h.constructor&&(g=h.constructor.name),g==="Map"||g==="Set")return Array.from(h);if(g==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(g))return _arrayLikeToArray$j(h,i)}}function _iterableToArray$g(h){if(typeof Symbol<"u"&&h[Symbol.iterator]!=null||h["@@iterator"]!=null)return Array.from(h)}function _arrayWithoutHoles$g(h){if(Array.isArray(h))return _arrayLikeToArray$j(h)}function _arrayLikeToArray$j(h,i){(i==null||i>h.length)&&(i=h.length);for(var g=0,_=new Array(i);g<i;g++)_[g]=h[g];return _}function _classCallCheck$b(h,i){if(!(h instanceof i))throw new TypeError("Cannot call a class as a function")}function _defineProperties$b(h,i){for(var g=0;g<i.length;g++){var _=i[g];_.enumerable=_.enumerable||!1,_.configurable=!0,"value"in _&&(_.writable=!0),Object.defineProperty(h,_.key,_)}}function _createClass$b(h,i,g){return i&&_defineProperties$b(h.prototype,i),g&&_defineProperties$b(h,g),Object.defineProperty(h,"prototype",{writable:!1}),h}function _inherits$b(h,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");h.prototype=Object.create(i&&i.prototype,{constructor:{value:h,writable:!0,configurable:!0}}),Object.defineProperty(h,"prototype",{writable:!1}),i&&_setPrototypeOf$b(h,i)}function _setPrototypeOf$b(h,i){return _setPrototypeOf$b=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(_,j){return _.__proto__=j,_},_setPrototypeOf$b(h,i)}function _createSuper$b(h){var i=_isNativeReflectConstruct$b();return function(){var _=_getPrototypeOf$b(h),j;if(i){var $=_getPrototypeOf$b(this).constructor;j=Reflect.construct(_,arguments,$)}else j=_.apply(this,arguments);return _possibleConstructorReturn$b(this,j)}}function _possibleConstructorReturn$b(h,i){if(i&&(typeof i=="object"||typeof i=="function"))return i;if(i!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$b(h)}function _assertThisInitialized$b(h){if(h===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return h}function _isNativeReflectConstruct$b(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function _getPrototypeOf$b(h){return _getPrototypeOf$b=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(g){return g.__proto__||Object.getPrototypeOf(g)},_getPrototypeOf$b(h)}var VictoryAnimation=function(h){_inherits$b(g,h);var i=_createSuper$b(g);function g(_,j){var $;return _classCallCheck$b(this,g),$=i.call(this,_,j),$.interpolator=void 0,$.queue=void 0,$.ease=void 0,$.timer=void 0,$.loopID=void 0,$.functionToBeRunEachFrame=function(_n,_i){_i=_i!==void 0?_i:$.props.duration;var _s=_i?_n/_i:1;if(_s>=1){$.setState({data:$.interpolator(1),animationInfo:{progress:1,animating:!1,terminating:!0}}),$.loopID&&$.timer.unsubscribe($.loopID),$.queue.shift(),$.traverseQueue();return}$.setState({data:$.interpolator($.ease(_s)),animationInfo:{progress:_s,animating:_s<1}})},$.state={data:Array.isArray($.props.data)?$.props.data[0]:$.props.data,animationInfo:{progress:0,animating:!1}},$.interpolator=null,$.queue=Array.isArray($.props.data)?$.props.data.slice(1):[],$.ease=d3Ease[$.toNewName($.props.easing)],$.timer=$.context.animationTimer,$}return _createClass$b(g,[{key:"componentDidMount",value:function(){this.queue.length&&this.traverseQueue()}},{key:"componentDidUpdate",value:function(j){var $=reactFastCompare(this.props,j);if(!$)if(this.interpolator&&this.state.animationInfo&&this.state.animationInfo.progress<1)this.setState({data:this.interpolator(1),animationInfo:{progress:1,animating:!1,terminating:!0}});else{if(this.timer.unsubscribe(this.loopID),!Array.isArray(this.props.data))this.queue.length=0,this.queue.push(this.props.data);else{var _n;(_n=this.queue).push.apply(_n,_toConsumableArray$g(this.props.data))}this.traverseQueue()}}},{key:"componentWillUnmount",value:function(){this.loopID?this.timer.unsubscribe(this.loopID):this.timer.stop()}},{key:"toNewName",value:function(j){var $=function(_n){return _n&&_n[0].toUpperCase()+_n.slice(1)};return"ease".concat($(j))}},{key:"traverseQueue",value:function(){var j=this;if(this.queue.length){var $=this.queue[0];this.interpolator=victoryInterpolator(this.state.data,$),this.props.delay?setTimeout(function(){j.loopID=j.timer.subscribe(j.functionToBeRunEachFrame,j.props.duration)},this.props.delay):this.loopID=this.timer.subscribe(this.functionToBeRunEachFrame,this.props.duration)}else this.props.onEnd&&this.props.onEnd()}},{key:"render",value:function(){return this.props.children(this.state.data,this.state.animationInfo)}}]),g}(React.Component);VictoryAnimation.displayName="VictoryAnimation";VictoryAnimation.propTypes={children:propTypesExports.func,data:propTypesExports.oneOfType([propTypesExports.object,propTypesExports.array]),delay:propTypesExports.number,duration:propTypesExports.number,easing:propTypesExports.oneOf(["back","backIn","backOut","backInOut","bounce","bounceIn","bounceOut","bounceInOut","circle","circleIn","circleOut","circleInOut","linear","linearIn","linearOut","linearInOut","cubic","cubicIn","cubicOut","cubicInOut","elastic","elasticIn","elasticOut","elasticInOut","exp","expIn","expOut","expInOut","poly","polyIn","polyOut","polyInOut","quad","quadIn","quadOut","quadInOut","sin","sinIn","sinOut","sinInOut"]),onEnd:propTypesExports.func};VictoryAnimation.defaultProps={data:{},delay:0,duration:1e3,easing:"quadInOut"};VictoryAnimation.contextType=TimerContext$1;var toString=toString_1,idCounter=0;function uniqueId(h){var i=++idCounter;return toString(h)+i}var uniqueId_1=uniqueId;function nativeKeysIn$1(h){var i=[];if(h!=null)for(var g in Object(h))i.push(g);return i}var _nativeKeysIn=nativeKeysIn$1,isObject$2=isObject_1,isPrototype$1=_isPrototype,nativeKeysIn=_nativeKeysIn,objectProto$4=Object.prototype,hasOwnProperty$3=objectProto$4.hasOwnProperty;function baseKeysIn$1(h){if(!isObject$2(h))return nativeKeysIn(h);var i=isPrototype$1(h),g=[];for(var _ in h)_=="constructor"&&(i||!hasOwnProperty$3.call(h,_))||g.push(_);return g}var _baseKeysIn=baseKeysIn$1,arrayLikeKeys=_arrayLikeKeys,baseKeysIn=_baseKeysIn,isArrayLike$4=isArrayLike_1;function keysIn$2(h){return isArrayLike$4(h)?arrayLikeKeys(h,!0):baseKeysIn(h)}var keysIn_1=keysIn$2,baseRest$2=_baseRest,eq$1=eq_1,isIterateeCall$2=_isIterateeCall,keysIn$1=keysIn_1,objectProto$3=Object.prototype,hasOwnProperty$2=objectProto$3.hasOwnProperty,defaults=baseRest$2(function(h,i){h=Object(h);var g=-1,_=i.length,j=_>2?i[2]:void 0;for(j&&isIterateeCall$2(i[0],i[1],j)&&(_=1);++g<_;)for(var $=i[g],_n=keysIn$1($),_i=-1,_s=_n.length;++_i<_s;){var ga=_n[_i],ba=h[ga];(ba===void 0||eq$1(ba,objectProto$3[ga])&&!hasOwnProperty$2.call(h,ga))&&(h[ga]=$[ga])}return h}),defaults_1=defaults,baseGetTag$2=_baseGetTag,isObjectLike$3=isObjectLike_1,regexpTag="[object RegExp]";function baseIsRegExp$1(h){return isObjectLike$3(h)&&baseGetTag$2(h)==regexpTag}var _baseIsRegExp=baseIsRegExp$1,baseIsRegExp=_baseIsRegExp,baseUnary$2=_baseUnary,nodeUtil$1=_nodeUtilExports,nodeIsRegExp=nodeUtil$1&&nodeUtil$1.isRegExp,isRegExp=nodeIsRegExp?baseUnary$2(nodeIsRegExp):baseIsRegExp,isRegExp_1=isRegExp,baseIteratee$6=_baseIteratee,isArrayLike$3=isArrayLike_1,keys$1=keys_1;function createFind$1(h){return function(i,g,_){var j=Object(i);if(!isArrayLike$3(i)){var $=baseIteratee$6(g);i=keys$1(i),g=function(_i){return $(j[_i],_i,j)}}var _n=h(i,g,_);return _n>-1?j[$?i[_n]:_n]:void 0}}var _createFind=createFind$1;function baseFindIndex$2(h,i,g,_){for(var j=h.length,$=g+(_?1:-1);_?$--:++$<j;)if(i(h[$],$,h))return $;return-1}var _baseFindIndex=baseFindIndex$2,reWhitespace=/\s/;function trimmedEndIndex$1(h){for(var i=h.length;i--&&reWhitespace.test(h.charAt(i)););return i}var _trimmedEndIndex=trimmedEndIndex$1,trimmedEndIndex=_trimmedEndIndex,reTrimStart=/^\s+/;function baseTrim$1(h){return h&&h.slice(0,trimmedEndIndex(h)+1).replace(reTrimStart,"")}var _baseTrim=baseTrim$1,baseTrim=_baseTrim,isObject$1=isObject_1,isSymbol=isSymbol_1,NAN=0/0,reIsBadHex=/^[-+]0x[0-9a-f]+$/i,reIsBinary=/^0b[01]+$/i,reIsOctal=/^0o[0-7]+$/i,freeParseInt=parseInt;function toNumber$1(h){if(typeof h=="number")return h;if(isSymbol(h))return NAN;if(isObject$1(h)){var i=typeof h.valueOf=="function"?h.valueOf():h;h=isObject$1(i)?i+"":i}if(typeof h!="string")return h===0?h:+h;h=baseTrim(h);var g=reIsBinary.test(h);return g||reIsOctal.test(h)?freeParseInt(h.slice(2),g?2:8):reIsBadHex.test(h)?NAN:+h}var toNumber_1=toNumber$1,toNumber=toNumber_1,INFINITY$1=1/0,MAX_INTEGER=17976931348623157e292;function toFinite$2(h){if(!h)return h===0?h:0;if(h=toNumber(h),h===INFINITY$1||h===-INFINITY$1){var i=h<0?-1:1;return i*MAX_INTEGER}return h===h?h:0}var toFinite_1=toFinite$2,toFinite$1=toFinite_1;function toInteger$2(h){var i=toFinite$1(h),g=i%1;return i===i?g?i-g:i:0}var toInteger_1=toInteger$2,baseFindIndex$1=_baseFindIndex,baseIteratee$5=_baseIteratee,toInteger$1=toInteger_1,nativeMax$2=Math.max;function findIndex$1(h,i,g){var _=h==null?0:h.length;if(!_)return-1;var j=g==null?0:toInteger$1(g);return j<0&&(j=nativeMax$2(_+j,0)),baseFindIndex$1(h,baseIteratee$5(i),j)}var findIndex_1=findIndex$1,createFind=_createFind,findIndex=findIndex_1,find=createFind(findIndex),find_1=find;function baseIsNaN$1(h){return h!==h}var _baseIsNaN=baseIsNaN$1;function strictIndexOf$1(h,i,g){for(var _=g-1,j=h.length;++_<j;)if(h[_]===i)return _;return-1}var _strictIndexOf=strictIndexOf$1,baseFindIndex=_baseFindIndex,baseIsNaN=_baseIsNaN,strictIndexOf=_strictIndexOf;function baseIndexOf$2(h,i,g){return i===i?strictIndexOf(h,i,g):baseFindIndex(h,baseIsNaN,g)}var _baseIndexOf=baseIndexOf$2,baseGetTag$1=_baseGetTag,isArray$4=isArray_1,isObjectLike$2=isObjectLike_1,stringTag="[object String]";function isString$1(h){return typeof h=="string"||!isArray$4(h)&&isObjectLike$2(h)&&baseGetTag$1(h)==stringTag}var isString_1=isString$1,arrayMap$2=_arrayMap;function baseValues$1(h,i){return arrayMap$2(i,function(g){return h[g]})}var _baseValues=baseValues$1,baseValues=_baseValues,keys=keys_1;function values$1(h){return h==null?[]:baseValues(h,keys(h))}var values_1=values$1,baseIndexOf$1=_baseIndexOf,isArrayLike$2=isArrayLike_1,isString=isString_1,toInteger=toInteger_1,values=values_1,nativeMax$1=Math.max;function includes(h,i,g,_){h=isArrayLike$2(h)?h:values(h),g=g&&!_?toInteger(g):0;var j=h.length;return g<0&&(g=nativeMax$1(j+g,0)),isString(h)?g<=j&&h.indexOf(i,g)>-1:!!j&&baseIndexOf$1(h,i,g)>-1}var includes_1=includes,assignValue=_assignValue,castPath$1=_castPath,isIndex=_isIndex,isObject=isObject_1,toKey=_toKey;function baseSet$1(h,i,g,_){if(!isObject(h))return h;i=castPath$1(i,h);for(var j=-1,$=i.length,_n=$-1,_i=h;_i!=null&&++j<$;){var _s=toKey(i[j]),ga=g;if(_s==="__proto__"||_s==="constructor"||_s==="prototype")return h;if(j!=_n){var ba=_i[_s];ga=_?_(ba,_s,_i):void 0,ga===void 0&&(ga=isObject(ba)?ba:isIndex(i[j+1])?[]:{})}assignValue(_i,_s,ga),_i=_i[_s]}return h}var _baseSet=baseSet$1,baseGet=_baseGet,baseSet=_baseSet,castPath=_castPath;function basePickBy$2(h,i,g){for(var _=-1,j=i.length,$={};++_<j;){var _n=i[_],_i=baseGet(h,_n);g(_i,_n)&&baseSet($,castPath(_n,h),_i)}return $}var _basePickBy=basePickBy$2,basePickBy$1=_basePickBy,hasIn=hasIn_1;function basePick$1(h,i){return basePickBy$1(h,i,function(g,_){return hasIn(h,_)})}var _basePick=basePick$1,Symbol$2=_Symbol,isArguments$1=isArguments_1,isArray$3=isArray_1,spreadableSymbol=Symbol$2?Symbol$2.isConcatSpreadable:void 0;function isFlattenable$1(h){return isArray$3(h)||isArguments$1(h)||!!(spreadableSymbol&&h&&h[spreadableSymbol])}var _isFlattenable=isFlattenable$1,arrayPush$1=_arrayPush,isFlattenable=_isFlattenable;function baseFlatten$2(h,i,g,_,j){var $=-1,_n=h.length;for(g||(g=isFlattenable),j||(j=[]);++$<_n;){var _i=h[$];i>0&&g(_i)?i>1?baseFlatten$2(_i,i-1,g,_,j):arrayPush$1(j,_i):_||(j[j.length]=_i)}return j}var _baseFlatten=baseFlatten$2,baseFlatten$1=_baseFlatten;function flatten$1(h){var i=h==null?0:h.length;return i?baseFlatten$1(h,1):[]}var flatten_1=flatten$1,flatten=flatten_1,overRest=_overRest,setToString=_setToString;function flatRest$1(h){return setToString(overRest(h,void 0,flatten),h+"")}var _flatRest=flatRest$1,basePick=_basePick,flatRest=_flatRest,pick=flatRest(function(h,i){return h==null?{}:basePick(h,i)}),pick_1=pick;function getCartesianRange(h,i){var g=i!=="x",_=getPadding$1(h);return g?[h.height-_.bottom,_.top]:[_.left,h.width-_.right]}function getPolarRange(h,i){if(i==="x"){var g=degreesToRadians(h.startAngle||0),_=degreesToRadians(h.endAngle||360);return[g,_]}return[h.innerRadius||0,getRadius$1(h)]}function omit(h){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],g={};for(var _ in h)i.indexOf(_)>=0||Object.prototype.hasOwnProperty.call(h,_)&&(g[_]=h[_]);return g}function getPoint(h){var i=function(Tl){return Tl!==void 0},g=h._x,_=h._x1,j=h._x0,$=h._voronoiX,_n=h._y,_i=h._y1,_s=h._y0,ga=h._voronoiY,ba=i(_)?_:g,xa=i(_i)?_i:_n,El={x:i($)?$:ba,x0:i(j)?j:g,y:i(ga)?ga:xa,y0:i(_s)?_s:_n};return defaults_1({},El,h)}function scalePoint(h,i){var g=h.scale,_=h.polar,j=h.horizontal,$=getPoint(i),_n=h.origin||{x:0,y:0},_i=j?g.y($.y):g.x($.x),_s=j?g.y($.y0):g.x($.x0),ga=j?g.x($.x):g.y($.y),ba=j?g.x($.x0):g.y($.y0);return{x:_?ga*Math.cos(_i)+_n.x:_i,x0:_?ba*Math.cos(_s)+_n.x:_s,y:_?-ga*Math.sin(_i)+_n.y:ga,y0:_?-ba*Math.sin(_s)+_n.x:ba}}function getPadding$1(h){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"padding",g=h[i],_=typeof g=="number"?g:0,j=typeof g=="object"?g:{};return{top:j.top||_,bottom:j.bottom||_,left:j.left||_,right:j.right||_}}function isTooltip(h){var i=h&&h.type&&h.type.role;return i==="tooltip"}function getDefaultStyles(h,i){var g=h.theme,_=g===void 0?{}:g,j=h.labelComponent,$=_[i]&&_[i].style||{};if(!isTooltip(j))return $;var _n=_.tooltip&&_.tooltip.style||{},_i=defaults_1({},_n,$.labels);return defaults_1({},{labels:_i},$)}function getStyles$4(h,i){var g="100%",_="100%";if(!h)return defaults_1({parent:{height:_,width:g}},i);var j=h.data,$=h.labels,_n=h.parent,_i=i&&i.parent||{},_s=i&&i.labels||{},ga=i&&i.data||{};return{parent:defaults_1({},_n,_i,{width:g,height:_}),labels:defaults_1({},$,_s),data:defaults_1({},j,ga)}}function evaluateProp(h,i){return isFunction_1(h)?h(i):h}function evaluateStyle(h,i){return i.disableInlineStyles?{}:!h||!keys_1(h).some(function(g){return isFunction_1(h[g])})?h:keys_1(h).reduce(function(g,_){return g[_]=evaluateProp(h[_],i),g},{})}function degreesToRadians(h){return typeof h=="number"?h*(Math.PI/180):h}function radiansToDegrees(h){return typeof h=="number"?h/(Math.PI/180):h}function getRadius$1(h){var i=getPadding$1(h),g=i.left,_=i.right,j=i.top,$=i.bottom,_n=h.width,_i=h.height;return Math.min(_n-g-_,_i-j-$)/2}function getPolarOrigin(h){var i=h.width,g=h.height,_=getPadding$1(h),j=_.top,$=_.bottom,_n=_.left,_i=_.right,_s=Math.min(i-_n-_i,g-j-$)/2,ga=i/2+_n-_i,ba=g/2+j-$;return{x:ga+_s>i?_s+_n-_i:ga,y:ba+_s>g?_s+j-$:ba}}function getRange$1(h,i){return h.range&&h.range[i]?h.range[i]:h.range&&Array.isArray(h.range)?h.range:h.polar?getPolarRange(h,i):getCartesianRange(h,i)}function createAccessor(h){return isFunction_1(h)?h:h==null?function(i){return i}:property_1(h)}function modifyProps$1(h,i,g){var _=h.theme&&h.theme[g]?h.theme[g]:{},j=omit(_,["style"]),$=isHorizontal(h),_n=$===void 0?{}:{horizontal:$};return defaults_1(_n,h,j,i)}function getCurrentAxis$1(h,i){var g=h==="x"?"y":"x";return i?g:h}function reduceChildren(h,i){var g=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},_=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[],j=arguments.length>4&&arguments[4]!==void 0?arguments[4]:function(_s,ga){return _s.concat(ga)},$=["data","domain","categories","polar","startAngle","endAngle","minDomain","maxDomain","horizontal"],_n=function(_s,ga,ba){return _s.reduce(function(xa,El,Tl){var Sl=El.type&&El.type.role,Il=El.props.name||"".concat(Sl,"-").concat(ga[Tl]);if(El.props&&El.props.children){var Cl=assign_1({},El.props,pick_1(g,$)),Nl=El.type&&El.type.role==="stack"&&isFunction_1(El.type.getChildren)?El.type.getChildren(Cl):React.Children.toArray(El.props.children).map(function(Jl){var Ep=assign_1({},Jl.props,pick_1(Cl,$));return React.cloneElement(Jl,Ep)}),Dl=Nl.map(function(Jl,Ep){return"".concat(Il,"-").concat(Ep)}),Ul=_n(Nl,Dl,El);xa=j(xa,Ul)}else{var Kl=i(El,Il,ba);Kl&&(xa=j(xa,Kl))}return xa},_)},_i=h.map(function(_s,ga){return ga});return _n(h,_i)}function isHorizontal(h){if(h.horizontal!==void 0||!h.children)return h.horizontal;var i=function(g){return g.reduce(function(_,j){var $=j.props||{};return _||$.horizontal||!$.children?(_=_||$.horizontal,_):i(React.Children.toArray($.children))},!1)};return i(React.Children.toArray(h.children))}function _toConsumableArray$f(h){return _arrayWithoutHoles$f(h)||_iterableToArray$f(h)||_unsupportedIterableToArray$i(h)||_nonIterableSpread$f()}function _nonIterableSpread$f(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _unsupportedIterableToArray$i(h,i){if(h){if(typeof h=="string")return _arrayLikeToArray$i(h,i);var g=Object.prototype.toString.call(h).slice(8,-1);if(g==="Object"&&h.constructor&&(g=h.constructor.name),g==="Map"||g==="Set")return Array.from(h);if(g==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(g))return _arrayLikeToArray$i(h,i)}}function _iterableToArray$f(h){if(typeof Symbol<"u"&&h[Symbol.iterator]!=null||h["@@iterator"]!=null)return Array.from(h)}function _arrayWithoutHoles$f(h){if(Array.isArray(h))return _arrayLikeToArray$i(h)}function _arrayLikeToArray$i(h,i){(i==null||i>h.length)&&(i=h.length);for(var g=0,_=new Array(i);g<i;g++)_[g]=h[g];return _}function isNonEmptyArray(h){return Array.isArray(h)&&h.length>0}function containsStrings(h){return Array.isArray(h)&&h.some(function(i){return typeof i=="string"})}function containsDates(h){return Array.isArray(h)&&h.some(function(i){return i instanceof Date})}function containsOnlyStrings(h){return isNonEmptyArray(h)&&h.every(function(i){return typeof i=="string"})}function isArrayOfArrays(h){return isNonEmptyArray(h)&&h.every(Array.isArray)}function removeUndefined(h){return h.filter(function(i){return i!==void 0})}function getMaxValue(h){for(var i=arguments.length,g=new Array(i>1?i-1:0),_=1;_<i;_++)g[_-1]=arguments[_];var j=h.concat(g);return containsDates(j)?new Date(Math.max.apply(Math,_toConsumableArray$f(j))):Math.max.apply(Math,_toConsumableArray$f(j))}function getMinValue(h){for(var i=arguments.length,g=new Array(i>1?i-1:0),_=1;_<i;_++)g[_-1]=arguments[_];var j=h.concat(g);return containsDates(j)?new Date(Math.min.apply(Math,_toConsumableArray$f(j))):Math.min.apply(Math,_toConsumableArray$f(j))}function ascending$1(h,i){return h==null||i==null?NaN:h<i?-1:h>i?1:h>=i?0:NaN}function descending$2(h,i){return h==null||i==null?NaN:i<h?-1:i>h?1:i>=h?0:NaN}function bisector(h){let i,g,_;h.length!==2?(i=ascending$1,g=(_i,_s)=>ascending$1(h(_i),_s),_=(_i,_s)=>h(_i)-_s):(i=h===ascending$1||h===descending$2?h:zero,g=h,_=h);function j(_i,_s,ga=0,ba=_i.length){if(ga<ba){if(i(_s,_s)!==0)return ba;do{const xa=ga+ba>>>1;g(_i[xa],_s)<0?ga=xa+1:ba=xa}while(ga<ba)}return ga}function $(_i,_s,ga=0,ba=_i.length){if(ga<ba){if(i(_s,_s)!==0)return ba;do{const xa=ga+ba>>>1;g(_i[xa],_s)<=0?ga=xa+1:ba=xa}while(ga<ba)}return ga}function _n(_i,_s,ga=0,ba=_i.length){const xa=j(_i,_s,ga,ba-1);return xa>ga&&_(_i[xa-1],_s)>-_(_i[xa],_s)?xa-1:xa}return{left:j,center:_n,right:$}}function zero(){return 0}function number$2(h){return h===null?NaN:+h}function*numbers(h,i){if(i===void 0)for(let g of h)g!=null&&(g=+g)>=g&&(yield g);else{let g=-1;for(let _ of h)(_=i(_,++g,h))!=null&&(_=+_)>=_&&(yield _)}}const ascendingBisect=bisector(ascending$1),bisectRight=ascendingBisect.right;bisector(number$2).center;const bisect=bisectRight;class InternMap extends Map{constructor(i,g=keyof){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:g}}),i!=null)for(const[_,j]of i)this.set(_,j)}get(i){return super.get(intern_get(this,i))}has(i){return super.has(intern_get(this,i))}set(i,g){return super.set(intern_set(this,i),g)}delete(i){return super.delete(intern_delete(this,i))}}function intern_get({_intern:h,_key:i},g){const _=i(g);return h.has(_)?h.get(_):g}function intern_set({_intern:h,_key:i},g){const _=i(g);return h.has(_)?h.get(_):(h.set(_,g),g)}function intern_delete({_intern:h,_key:i},g){const _=i(g);return h.has(_)&&(g=h.get(_),h.delete(_)),g}function keyof(h){return h!==null&&typeof h=="object"?h.valueOf():h}function compareDefined(h=ascending$1){if(h===ascending$1)return ascendingDefined;if(typeof h!="function")throw new TypeError("compare is not a function");return(i,g)=>{const _=h(i,g);return _||_===0?_:(h(g,g)===0)-(h(i,i)===0)}}function ascendingDefined(h,i){return(h==null||!(h>=h))-(i==null||!(i>=i))||(h<i?-1:h>i?1:0)}const e10=Math.sqrt(50),e5=Math.sqrt(10),e2=Math.sqrt(2);function tickSpec(h,i,g){const _=(i-h)/Math.max(0,g),j=Math.floor(Math.log10(_)),$=_/Math.pow(10,j),_n=$>=e10?10:$>=e5?5:$>=e2?2:1;let _i,_s,ga;return j<0?(ga=Math.pow(10,-j)/_n,_i=Math.round(h*ga),_s=Math.round(i*ga),_i/ga<h&&++_i,_s/ga>i&&--_s,ga=-ga):(ga=Math.pow(10,j)*_n,_i=Math.round(h/ga),_s=Math.round(i/ga),_i*ga<h&&++_i,_s*ga>i&&--_s),_s<_i&&.5<=g&&g<2?tickSpec(h,i,g*2):[_i,_s,ga]}function ticks(h,i,g){if(i=+i,h=+h,g=+g,!(g>0))return[];if(h===i)return[h];const _=i<h,[j,$,_n]=_?tickSpec(i,h,g):tickSpec(h,i,g);if(!($>=j))return[];const _i=$-j+1,_s=new Array(_i);if(_)if(_n<0)for(let ga=0;ga<_i;++ga)_s[ga]=($-ga)/-_n;else for(let ga=0;ga<_i;++ga)_s[ga]=($-ga)*_n;else if(_n<0)for(let ga=0;ga<_i;++ga)_s[ga]=(j+ga)/-_n;else for(let ga=0;ga<_i;++ga)_s[ga]=(j+ga)*_n;return _s}function tickIncrement(h,i,g){return i=+i,h=+h,g=+g,tickSpec(h,i,g)[2]}function tickStep(h,i,g){i=+i,h=+h,g=+g;const _=i<h,j=_?tickIncrement(i,h,g):tickIncrement(h,i,g);return(_?-1:1)*(j<0?1/-j:j)}function max$1(h,i){let g;if(i===void 0)for(const _ of h)_!=null&&(g<_||g===void 0&&_>=_)&&(g=_);else{let _=-1;for(let j of h)(j=i(j,++_,h))!=null&&(g<j||g===void 0&&j>=j)&&(g=j)}return g}function min$1(h,i){let g;if(i===void 0)for(const _ of h)_!=null&&(g>_||g===void 0&&_>=_)&&(g=_);else{let _=-1;for(let j of h)(j=i(j,++_,h))!=null&&(g>j||g===void 0&&j>=j)&&(g=j)}return g}function quickselect(h,i,g=0,_=1/0,j){if(i=Math.floor(i),g=Math.floor(Math.max(0,g)),_=Math.floor(Math.min(h.length-1,_)),!(g<=i&&i<=_))return h;for(j=j===void 0?ascendingDefined:compareDefined(j);_>g;){if(_-g>600){const _s=_-g+1,ga=i-g+1,ba=Math.log(_s),xa=.5*Math.exp(2*ba/3),El=.5*Math.sqrt(ba*xa*(_s-xa)/_s)*(ga-_s/2<0?-1:1),Tl=Math.max(g,Math.floor(i-ga*xa/_s+El)),Sl=Math.min(_,Math.floor(i+(_s-ga)*xa/_s+El));quickselect(h,i,Tl,Sl,j)}const $=h[i];let _n=g,_i=_;for(swap(h,g,i),j(h[_],$)>0&&swap(h,g,_);_n<_i;){for(swap(h,_n,_i),++_n,--_i;j(h[_n],$)<0;)++_n;for(;j(h[_i],$)>0;)--_i}j(h[g],$)===0?swap(h,g,_i):(++_i,swap(h,_i,_)),_i<=i&&(g=_i+1),i<=_i&&(_=_i-1)}return h}function swap(h,i,g){const _=h[i];h[i]=h[g],h[g]=_}function quantile$1(h,i,g){if(h=Float64Array.from(numbers(h,g)),!(!(_=h.length)||isNaN(i=+i))){if(i<=0||_<2)return min$1(h);if(i>=1)return max$1(h);var _,j=(_-1)*i,$=Math.floor(j),_n=max$1(quickselect(h,$).subarray(0,$+1)),_i=min$1(h.subarray($+1));return _n+(_i-_n)*(j-$)}}function quantileSorted(h,i,g=number$2){if(!(!(_=h.length)||isNaN(i=+i))){if(i<=0||_<2)return+g(h[0],0,h);if(i>=1)return+g(h[_-1],_-1,h);var _,j=(_-1)*i,$=Math.floor(j),_n=+g(h[$],$,h),_i=+g(h[$+1],$+1,h);return _n+(_i-_n)*(j-$)}}function range$1(h,i,g){h=+h,i=+i,g=(j=arguments.length)<2?(i=h,h=0,1):j<3?1:+g;for(var _=-1,j=Math.max(0,Math.ceil((i-h)/g))|0,$=new Array(j);++_<j;)$[_]=h+_*g;return $}function initRange(h,i){switch(arguments.length){case 0:break;case 1:this.range(h);break;default:this.range(i).domain(h);break}return this}function initInterpolator(h,i){switch(arguments.length){case 0:break;case 1:{typeof h=="function"?this.interpolator(h):this.range(h);break}default:{this.domain(h),typeof i=="function"?this.interpolator(i):this.range(i);break}}return this}const implicit=Symbol("implicit");function ordinal(){var h=new InternMap,i=[],g=[],_=implicit;function j($){let _n=h.get($);if(_n===void 0){if(_!==implicit)return _;h.set($,_n=i.push($)-1)}return g[_n%g.length]}return j.domain=function($){if(!arguments.length)return i.slice();i=[],h=new InternMap;for(const _n of $)h.has(_n)||h.set(_n,i.push(_n)-1);return j},j.range=function($){return arguments.length?(g=Array.from($),j):g.slice()},j.unknown=function($){return arguments.length?(_=$,j):_},j.copy=function(){return ordinal(i,g).unknown(_)},initRange.apply(j,arguments),j}function band(){var h=ordinal().unknown(void 0),i=h.domain,g=h.range,_=0,j=1,$,_n,_i=!1,_s=0,ga=0,ba=.5;delete h.unknown;function xa(){var El=i().length,Tl=j<_,Sl=Tl?j:_,Il=Tl?_:j;$=(Il-Sl)/Math.max(1,El-_s+ga*2),_i&&($=Math.floor($)),Sl+=(Il-Sl-$*(El-_s))*ba,_n=$*(1-_s),_i&&(Sl=Math.round(Sl),_n=Math.round(_n));var Cl=range$1(El).map(function(Nl){return Sl+$*Nl});return g(Tl?Cl.reverse():Cl)}return h.domain=function(El){return arguments.length?(i(El),xa()):i()},h.range=function(El){return arguments.length?([_,j]=El,_=+_,j=+j,xa()):[_,j]},h.rangeRound=function(El){return[_,j]=El,_=+_,j=+j,_i=!0,xa()},h.bandwidth=function(){return _n},h.step=function(){return $},h.round=function(El){return arguments.length?(_i=!!El,xa()):_i},h.padding=function(El){return arguments.length?(_s=Math.min(1,ga=+El),xa()):_s},h.paddingInner=function(El){return arguments.length?(_s=Math.min(1,El),xa()):_s},h.paddingOuter=function(El){return arguments.length?(ga=+El,xa()):ga},h.align=function(El){return arguments.length?(ba=Math.max(0,Math.min(1,El)),xa()):ba},h.copy=function(){return band(i(),[_,j]).round(_i).paddingInner(_s).paddingOuter(ga).align(ba)},initRange.apply(xa(),arguments)}function pointish(h){var i=h.copy;return h.padding=h.paddingOuter,delete h.paddingInner,delete h.paddingOuter,h.copy=function(){return pointish(i())},h}function point$5(){return pointish(band.apply(null,arguments).paddingInner(1))}function constants(h){return function(){return h}}function number$1(h){return+h}var unit=[0,1];function identity$4(h){return h}function normalize(h,i){return(i-=h=+h)?function(g){return(g-h)/i}:constants(isNaN(i)?NaN:.5)}function clamper(h,i){var g;return h>i&&(g=h,h=i,i=g),function(_){return Math.max(h,Math.min(i,_))}}function bimap(h,i,g){var _=h[0],j=h[1],$=i[0],_n=i[1];return j<_?(_=normalize(j,_),$=g(_n,$)):(_=normalize(_,j),$=g($,_n)),function(_i){return $(_(_i))}}function polymap(h,i,g){var _=Math.min(h.length,i.length)-1,j=new Array(_),$=new Array(_),_n=-1;for(h[_]<h[0]&&(h=h.slice().reverse(),i=i.slice().reverse());++_n<_;)j[_n]=normalize(h[_n],h[_n+1]),$[_n]=g(i[_n],i[_n+1]);return function(_i){var _s=bisect(h,_i,1,_)-1;return $[_s](j[_s](_i))}}function copy$1(h,i){return i.domain(h.domain()).range(h.range()).interpolate(h.interpolate()).clamp(h.clamp()).unknown(h.unknown())}function transformer$2(){var h=unit,i=unit,g=interpolate,_,j,$,_n=identity$4,_i,_s,ga;function ba(){var El=Math.min(h.length,i.length);return _n!==identity$4&&(_n=clamper(h[0],h[El-1])),_i=El>2?polymap:bimap,_s=ga=null,xa}function xa(El){return El==null||isNaN(El=+El)?$:(_s||(_s=_i(h.map(_),i,g)))(_(_n(El)))}return xa.invert=function(El){return _n(j((ga||(ga=_i(i,h.map(_),interpolateNumber)))(El)))},xa.domain=function(El){return arguments.length?(h=Array.from(El,number$1),ba()):h.slice()},xa.range=function(El){return arguments.length?(i=Array.from(El),ba()):i.slice()},xa.rangeRound=function(El){return i=Array.from(El),g=interpolateRound,ba()},xa.clamp=function(El){return arguments.length?(_n=El?!0:identity$4,ba()):_n!==identity$4},xa.interpolate=function(El){return arguments.length?(g=El,ba()):g},xa.unknown=function(El){return arguments.length?($=El,xa):$},function(El,Tl){return _=El,j=Tl,ba()}}function continuous(){return transformer$2()(identity$4,identity$4)}function formatDecimal(h){return Math.abs(h=Math.round(h))>=1e21?h.toLocaleString("en").replace(/,/g,""):h.toString(10)}function formatDecimalParts(h,i){if((g=(h=i?h.toExponential(i-1):h.toExponential()).indexOf("e"))<0)return null;var g,_=h.slice(0,g);return[_.length>1?_[0]+_.slice(2):_,+h.slice(g+1)]}function exponent(h){return h=formatDecimalParts(Math.abs(h)),h?h[1]:NaN}function formatGroup(h,i){return function(g,_){for(var j=g.length,$=[],_n=0,_i=h[0],_s=0;j>0&&_i>0&&(_s+_i+1>_&&(_i=Math.max(1,_-_s)),$.push(g.substring(j-=_i,j+_i)),!((_s+=_i+1)>_));)_i=h[_n=(_n+1)%h.length];return $.reverse().join(i)}}function formatNumerals(h){return function(i){return i.replace(/[0-9]/g,function(g){return h[+g]})}}var re=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function formatSpecifier(h){if(!(i=re.exec(h)))throw new Error("invalid format: "+h);var i;return new FormatSpecifier({fill:i[1],align:i[2],sign:i[3],symbol:i[4],zero:i[5],width:i[6],comma:i[7],precision:i[8]&&i[8].slice(1),trim:i[9],type:i[10]})}formatSpecifier.prototype=FormatSpecifier.prototype;function FormatSpecifier(h){this.fill=h.fill===void 0?" ":h.fill+"",this.align=h.align===void 0?">":h.align+"",this.sign=h.sign===void 0?"-":h.sign+"",this.symbol=h.symbol===void 0?"":h.symbol+"",this.zero=!!h.zero,this.width=h.width===void 0?void 0:+h.width,this.comma=!!h.comma,this.precision=h.precision===void 0?void 0:+h.precision,this.trim=!!h.trim,this.type=h.type===void 0?"":h.type+""}FormatSpecifier.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function formatTrim(h){e:for(var i=h.length,g=1,_=-1,j;g<i;++g)switch(h[g]){case".":_=j=g;break;case"0":_===0&&(_=g),j=g;break;default:if(!+h[g])break e;_>0&&(_=0);break}return _>0?h.slice(0,_)+h.slice(j+1):h}var prefixExponent;function formatPrefixAuto(h,i){var g=formatDecimalParts(h,i);if(!g)return h+"";var _=g[0],j=g[1],$=j-(prefixExponent=Math.max(-8,Math.min(8,Math.floor(j/3)))*3)+1,_n=_.length;return $===_n?_:$>_n?_+new Array($-_n+1).join("0"):$>0?_.slice(0,$)+"."+_.slice($):"0."+new Array(1-$).join("0")+formatDecimalParts(h,Math.max(0,i+$-1))[0]}function formatRounded(h,i){var g=formatDecimalParts(h,i);if(!g)return h+"";var _=g[0],j=g[1];return j<0?"0."+new Array(-j).join("0")+_:_.length>j+1?_.slice(0,j+1)+"."+_.slice(j+1):_+new Array(j-_.length+2).join("0")}const formatTypes={"%":(h,i)=>(h*100).toFixed(i),b:h=>Math.round(h).toString(2),c:h=>h+"",d:formatDecimal,e:(h,i)=>h.toExponential(i),f:(h,i)=>h.toFixed(i),g:(h,i)=>h.toPrecision(i),o:h=>Math.round(h).toString(8),p:(h,i)=>formatRounded(h*100,i),r:formatRounded,s:formatPrefixAuto,X:h=>Math.round(h).toString(16).toUpperCase(),x:h=>Math.round(h).toString(16)};function identity$3(h){return h}var map=Array.prototype.map,prefixes=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function formatLocale$1(h){var i=h.grouping===void 0||h.thousands===void 0?identity$3:formatGroup(map.call(h.grouping,Number),h.thousands+""),g=h.currency===void 0?"":h.currency[0]+"",_=h.currency===void 0?"":h.currency[1]+"",j=h.decimal===void 0?".":h.decimal+"",$=h.numerals===void 0?identity$3:formatNumerals(map.call(h.numerals,String)),_n=h.percent===void 0?"%":h.percent+"",_i=h.minus===void 0?"−":h.minus+"",_s=h.nan===void 0?"NaN":h.nan+"";function ga(xa){xa=formatSpecifier(xa);var El=xa.fill,Tl=xa.align,Sl=xa.sign,Il=xa.symbol,Cl=xa.zero,Nl=xa.width,Dl=xa.comma,Ul=xa.precision,Kl=xa.trim,Jl=xa.type;Jl==="n"?(Dl=!0,Jl="g"):formatTypes[Jl]||(Ul===void 0&&(Ul=12),Kl=!0,Jl="g"),(Cl||El==="0"&&Tl==="=")&&(Cl=!0,El="0",Tl="=");var Ep=Il==="$"?g:Il==="#"&&/[boxX]/.test(Jl)?"0"+Jl.toLowerCase():"",_p=Il==="$"?_:/[%p]/.test(Jl)?_n:"",Ip=formatTypes[Jl],Up=/[defgprs%]/.test(Jl);Ul=Ul===void 0?6:/[gprs]/.test(Jl)?Math.max(1,Math.min(21,Ul)):Math.max(0,Math.min(20,Ul));function yp(Ap){var Cp=Ep,Mp=_p,wp,Np,Fp;if(Jl==="c")Mp=Ip(Ap)+Mp,Ap="";else{Ap=+Ap;var Hp=Ap<0||1/Ap<0;if(Ap=isNaN(Ap)?_s:Ip(Math.abs(Ap),Ul),Kl&&(Ap=formatTrim(Ap)),Hp&&+Ap==0&&Sl!=="+"&&(Hp=!1),Cp=(Hp?Sl==="("?Sl:_i:Sl==="-"||Sl==="("?"":Sl)+Cp,Mp=(Jl==="s"?prefixes[8+prefixExponent/3]:"")+Mp+(Hp&&Sl==="("?")":""),Up){for(wp=-1,Np=Ap.length;++wp<Np;)if(Fp=Ap.charCodeAt(wp),48>Fp||Fp>57){Mp=(Fp===46?j+Ap.slice(wp+1):Ap.slice(wp))+Mp,Ap=Ap.slice(0,wp);break}}}Dl&&!Cl&&(Ap=i(Ap,1/0));var xp=Cp.length+Ap.length+Mp.length,Gp=xp<Nl?new Array(Nl-xp+1).join(El):"";switch(Dl&&Cl&&(Ap=i(Gp+Ap,Gp.length?Nl-Mp.length:1/0),Gp=""),Tl){case"<":Ap=Cp+Ap+Mp+Gp;break;case"=":Ap=Cp+Gp+Ap+Mp;break;case"^":Ap=Gp.slice(0,xp=Gp.length>>1)+Cp+Ap+Mp+Gp.slice(xp);break;default:Ap=Gp+Cp+Ap+Mp;break}return $(Ap)}return yp.toString=function(){return xa+""},yp}function ba(xa,El){var Tl=ga((xa=formatSpecifier(xa),xa.type="f",xa)),Sl=Math.max(-8,Math.min(8,Math.floor(exponent(El)/3)))*3,Il=Math.pow(10,-Sl),Cl=prefixes[8+Sl/3];return function(Nl){return Tl(Il*Nl)+Cl}}return{format:ga,formatPrefix:ba}}var locale$1,format,formatPrefix;defaultLocale$1({thousands:",",grouping:[3],currency:["$",""]});function defaultLocale$1(h){return locale$1=formatLocale$1(h),format=locale$1.format,formatPrefix=locale$1.formatPrefix,locale$1}function precisionFixed(h){return Math.max(0,-exponent(Math.abs(h)))}function precisionPrefix(h,i){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(exponent(i)/3)))*3-exponent(Math.abs(h)))}function precisionRound(h,i){return h=Math.abs(h),i=Math.abs(i)-h,Math.max(0,exponent(i)-exponent(h))+1}function tickFormat(h,i,g,_){var j=tickStep(h,i,g),$;switch(_=formatSpecifier(_??",f"),_.type){case"s":{var _n=Math.max(Math.abs(h),Math.abs(i));return _.precision==null&&!isNaN($=precisionPrefix(j,_n))&&(_.precision=$),formatPrefix(_,_n)}case"":case"e":case"g":case"p":case"r":{_.precision==null&&!isNaN($=precisionRound(j,Math.max(Math.abs(h),Math.abs(i))))&&(_.precision=$-(_.type==="e"));break}case"f":case"%":{_.precision==null&&!isNaN($=precisionFixed(j))&&(_.precision=$-(_.type==="%")*2);break}}return format(_)}function linearish(h){var i=h.domain;return h.ticks=function(g){var _=i();return ticks(_[0],_[_.length-1],g??10)},h.tickFormat=function(g,_){var j=i();return tickFormat(j[0],j[j.length-1],g??10,_)},h.nice=function(g){g==null&&(g=10);var _=i(),j=0,$=_.length-1,_n=_[j],_i=_[$],_s,ga,ba=10;for(_i<_n&&(ga=_n,_n=_i,_i=ga,ga=j,j=$,$=ga);ba-- >0;){if(ga=tickIncrement(_n,_i,g),ga===_s)return _[j]=_n,_[$]=_i,i(_);if(ga>0)_n=Math.floor(_n/ga)*ga,_i=Math.ceil(_i/ga)*ga;else if(ga<0)_n=Math.ceil(_n*ga)/ga,_i=Math.floor(_i*ga)/ga;else break;_s=ga}return h},h}function linear(){var h=continuous();return h.copy=function(){return copy$1(h,linear())},initRange.apply(h,arguments),linearish(h)}function identity$2(h){var i;function g(_){return _==null||isNaN(_=+_)?i:_}return g.invert=g,g.domain=g.range=function(_){return arguments.length?(h=Array.from(_,number$1),g):h.slice()},g.unknown=function(_){return arguments.length?(i=_,g):i},g.copy=function(){return identity$2(h).unknown(i)},h=arguments.length?Array.from(h,number$1):[0,1],linearish(g)}function nice(h,i){h=h.slice();var g=0,_=h.length-1,j=h[g],$=h[_],_n;return $<j&&(_n=g,g=_,_=_n,_n=j,j=$,$=_n),h[g]=i.floor(j),h[_]=i.ceil($),h}function transformLog(h){return Math.log(h)}function transformExp(h){return Math.exp(h)}function transformLogn(h){return-Math.log(-h)}function transformExpn(h){return-Math.exp(-h)}function pow10(h){return isFinite(h)?+("1e"+h):h<0?0:h}function powp(h){return h===10?pow10:h===Math.E?Math.exp:i=>Math.pow(h,i)}function logp(h){return h===Math.E?Math.log:h===10&&Math.log10||h===2&&Math.log2||(h=Math.log(h),i=>Math.log(i)/h)}function reflect(h){return(i,g)=>-h(-i,g)}function loggish(h){const i=h(transformLog,transformExp),g=i.domain;let _=10,j,$;function _n(){return j=logp(_),$=powp(_),g()[0]<0?(j=reflect(j),$=reflect($),h(transformLogn,transformExpn)):h(transformLog,transformExp),i}return i.base=function(_i){return arguments.length?(_=+_i,_n()):_},i.domain=function(_i){return arguments.length?(g(_i),_n()):g()},i.ticks=_i=>{const _s=g();let ga=_s[0],ba=_s[_s.length-1];const xa=ba<ga;xa&&([ga,ba]=[ba,ga]);let El=j(ga),Tl=j(ba),Sl,Il;const Cl=_i==null?10:+_i;let Nl=[];if(!(_%1)&&Tl-El<Cl){if(El=Math.floor(El),Tl=Math.ceil(Tl),ga>0){for(;El<=Tl;++El)for(Sl=1;Sl<_;++Sl)if(Il=El<0?Sl/$(-El):Sl*$(El),!(Il<ga)){if(Il>ba)break;Nl.push(Il)}}else for(;El<=Tl;++El)for(Sl=_-1;Sl>=1;--Sl)if(Il=El>0?Sl/$(-El):Sl*$(El),!(Il<ga)){if(Il>ba)break;Nl.push(Il)}Nl.length*2<Cl&&(Nl=ticks(ga,ba,Cl))}else Nl=ticks(El,Tl,Math.min(Tl-El,Cl)).map($);return xa?Nl.reverse():Nl},i.tickFormat=(_i,_s)=>{if(_i==null&&(_i=10),_s==null&&(_s=_===10?"s":","),typeof _s!="function"&&(!(_%1)&&(_s=formatSpecifier(_s)).precision==null&&(_s.trim=!0),_s=format(_s)),_i===1/0)return _s;const ga=Math.max(1,_*_i/i.ticks().length);return ba=>{let xa=ba/$(Math.round(j(ba)));return xa*_<_-.5&&(xa*=_),xa<=ga?_s(ba):""}},i.nice=()=>g(nice(g(),{floor:_i=>$(Math.floor(j(_i))),ceil:_i=>$(Math.ceil(j(_i)))})),i}function log(){const h=loggish(transformer$2()).domain([1,10]);return h.copy=()=>copy$1(h,log()).base(h.base()),initRange.apply(h,arguments),h}function transformSymlog(h){return function(i){return Math.sign(i)*Math.log1p(Math.abs(i/h))}}function transformSymexp(h){return function(i){return Math.sign(i)*Math.expm1(Math.abs(i))*h}}function symlogish(h){var i=1,g=h(transformSymlog(i),transformSymexp(i));return g.constant=function(_){return arguments.length?h(transformSymlog(i=+_),transformSymexp(i)):i},linearish(g)}function symlog(){var h=symlogish(transformer$2());return h.copy=function(){return copy$1(h,symlog()).constant(h.constant())},initRange.apply(h,arguments)}function transformPow(h){return function(i){return i<0?-Math.pow(-i,h):Math.pow(i,h)}}function transformSqrt(h){return h<0?-Math.sqrt(-h):Math.sqrt(h)}function transformSquare(h){return h<0?-h*h:h*h}function powish(h){var i=h(identity$4,identity$4),g=1;function _(){return g===1?h(identity$4,identity$4):g===.5?h(transformSqrt,transformSquare):h(transformPow(g),transformPow(1/g))}return i.exponent=function(j){return arguments.length?(g=+j,_()):g},linearish(i)}function pow(){var h=powish(transformer$2());return h.copy=function(){return copy$1(h,pow()).exponent(h.exponent())},initRange.apply(h,arguments),h}function sqrt$1(){return pow.apply(null,arguments).exponent(.5)}function square$1(h){return Math.sign(h)*h*h}function unsquare(h){return Math.sign(h)*Math.sqrt(Math.abs(h))}function radial(){var h=continuous(),i=[0,1],g=!1,_;function j($){var _n=unsquare(h($));return isNaN(_n)?_:g?Math.round(_n):_n}return j.invert=function($){return h.invert(square$1($))},j.domain=function($){return arguments.length?(h.domain($),j):h.domain()},j.range=function($){return arguments.length?(h.range((i=Array.from($,number$1)).map(square$1)),j):i.slice()},j.rangeRound=function($){return j.range($).round(!0)},j.round=function($){return arguments.length?(g=!!$,j):g},j.clamp=function($){return arguments.length?(h.clamp($),j):h.clamp()},j.unknown=function($){return arguments.length?(_=$,j):_},j.copy=function(){return radial(h.domain(),i).round(g).clamp(h.clamp()).unknown(_)},initRange.apply(j,arguments),linearish(j)}function quantile(){var h=[],i=[],g=[],_;function j(){var _n=0,_i=Math.max(1,i.length);for(g=new Array(_i-1);++_n<_i;)g[_n-1]=quantileSorted(h,_n/_i);return $}function $(_n){return _n==null||isNaN(_n=+_n)?_:i[bisect(g,_n)]}return $.invertExtent=function(_n){var _i=i.indexOf(_n);return _i<0?[NaN,NaN]:[_i>0?g[_i-1]:h[0],_i<g.length?g[_i]:h[h.length-1]]},$.domain=function(_n){if(!arguments.length)return h.slice();h=[];for(let _i of _n)_i!=null&&!isNaN(_i=+_i)&&h.push(_i);return h.sort(ascending$1),j()},$.range=function(_n){return arguments.length?(i=Array.from(_n),j()):i.slice()},$.unknown=function(_n){return arguments.length?(_=_n,$):_},$.quantiles=function(){return g.slice()},$.copy=function(){return quantile().domain(h).range(i).unknown(_)},initRange.apply($,arguments)}function quantize(){var h=0,i=1,g=1,_=[.5],j=[0,1],$;function _n(_s){return _s!=null&&_s<=_s?j[bisect(_,_s,0,g)]:$}function _i(){var _s=-1;for(_=new Array(g);++_s<g;)_[_s]=((_s+1)*i-(_s-g)*h)/(g+1);return _n}return _n.domain=function(_s){return arguments.length?([h,i]=_s,h=+h,i=+i,_i()):[h,i]},_n.range=function(_s){return arguments.length?(g=(j=Array.from(_s)).length-1,_i()):j.slice()},_n.invertExtent=function(_s){var ga=j.indexOf(_s);return ga<0?[NaN,NaN]:ga<1?[h,_[0]]:ga>=g?[_[g-1],i]:[_[ga-1],_[ga]]},_n.unknown=function(_s){return arguments.length&&($=_s),_n},_n.thresholds=function(){return _.slice()},_n.copy=function(){return quantize().domain([h,i]).range(j).unknown($)},initRange.apply(linearish(_n),arguments)}function threshold(){var h=[.5],i=[0,1],g,_=1;function j($){return $!=null&&$<=$?i[bisect(h,$,0,_)]:g}return j.domain=function($){return arguments.length?(h=Array.from($),_=Math.min(h.length,i.length-1),j):h.slice()},j.range=function($){return arguments.length?(i=Array.from($),_=Math.min(h.length,i.length-1),j):i.slice()},j.invertExtent=function($){var _n=i.indexOf($);return[h[_n-1],h[_n]]},j.unknown=function($){return arguments.length?(g=$,j):g},j.copy=function(){return threshold().domain(h).range(i).unknown(g)},initRange.apply(j,arguments)}const t0=new Date,t1=new Date;function timeInterval(h,i,g,_){function j($){return h($=arguments.length===0?new Date:new Date(+$)),$}return j.floor=$=>(h($=new Date(+$)),$),j.ceil=$=>(h($=new Date($-1)),i($,1),h($),$),j.round=$=>{const _n=j($),_i=j.ceil($);return $-_n<_i-$?_n:_i},j.offset=($,_n)=>(i($=new Date(+$),_n==null?1:Math.floor(_n)),$),j.range=($,_n,_i)=>{const _s=[];if($=j.ceil($),_i=_i==null?1:Math.floor(_i),!($<_n)||!(_i>0))return _s;let ga;do _s.push(ga=new Date(+$)),i($,_i),h($);while(ga<$&&$<_n);return _s},j.filter=$=>timeInterval(_n=>{if(_n>=_n)for(;h(_n),!$(_n);)_n.setTime(_n-1)},(_n,_i)=>{if(_n>=_n)if(_i<0)for(;++_i<=0;)for(;i(_n,-1),!$(_n););else for(;--_i>=0;)for(;i(_n,1),!$(_n););}),g&&(j.count=($,_n)=>(t0.setTime(+$),t1.setTime(+_n),h(t0),h(t1),Math.floor(g(t0,t1))),j.every=$=>($=Math.floor($),!isFinite($)||!($>0)?null:$>1?j.filter(_?_n=>_(_n)%$===0:_n=>j.count(0,_n)%$===0):j)),j}const millisecond=timeInterval(()=>{},(h,i)=>{h.setTime(+h+i)},(h,i)=>i-h);millisecond.every=h=>(h=Math.floor(h),!isFinite(h)||!(h>0)?null:h>1?timeInterval(i=>{i.setTime(Math.floor(i/h)*h)},(i,g)=>{i.setTime(+i+g*h)},(i,g)=>(g-i)/h):millisecond);millisecond.range;const durationSecond=1e3,durationMinute=durationSecond*60,durationHour=durationMinute*60,durationDay=durationHour*24,durationWeek=durationDay*7,durationMonth=durationDay*30,durationYear=durationDay*365,second=timeInterval(h=>{h.setTime(h-h.getMilliseconds())},(h,i)=>{h.setTime(+h+i*durationSecond)},(h,i)=>(i-h)/durationSecond,h=>h.getUTCSeconds());second.range;const timeMinute=timeInterval(h=>{h.setTime(h-h.getMilliseconds()-h.getSeconds()*durationSecond)},(h,i)=>{h.setTime(+h+i*durationMinute)},(h,i)=>(i-h)/durationMinute,h=>h.getMinutes());timeMinute.range;const utcMinute=timeInterval(h=>{h.setUTCSeconds(0,0)},(h,i)=>{h.setTime(+h+i*durationMinute)},(h,i)=>(i-h)/durationMinute,h=>h.getUTCMinutes());utcMinute.range;const timeHour=timeInterval(h=>{h.setTime(h-h.getMilliseconds()-h.getSeconds()*durationSecond-h.getMinutes()*durationMinute)},(h,i)=>{h.setTime(+h+i*durationHour)},(h,i)=>(i-h)/durationHour,h=>h.getHours());timeHour.range;const utcHour=timeInterval(h=>{h.setUTCMinutes(0,0,0)},(h,i)=>{h.setTime(+h+i*durationHour)},(h,i)=>(i-h)/durationHour,h=>h.getUTCHours());utcHour.range;const timeDay=timeInterval(h=>h.setHours(0,0,0,0),(h,i)=>h.setDate(h.getDate()+i),(h,i)=>(i-h-(i.getTimezoneOffset()-h.getTimezoneOffset())*durationMinute)/durationDay,h=>h.getDate()-1);timeDay.range;const utcDay=timeInterval(h=>{h.setUTCHours(0,0,0,0)},(h,i)=>{h.setUTCDate(h.getUTCDate()+i)},(h,i)=>(i-h)/durationDay,h=>h.getUTCDate()-1);utcDay.range;const unixDay=timeInterval(h=>{h.setUTCHours(0,0,0,0)},(h,i)=>{h.setUTCDate(h.getUTCDate()+i)},(h,i)=>(i-h)/durationDay,h=>Math.floor(h/durationDay));unixDay.range;function timeWeekday(h){return timeInterval(i=>{i.setDate(i.getDate()-(i.getDay()+7-h)%7),i.setHours(0,0,0,0)},(i,g)=>{i.setDate(i.getDate()+g*7)},(i,g)=>(g-i-(g.getTimezoneOffset()-i.getTimezoneOffset())*durationMinute)/durationWeek)}const timeSunday=timeWeekday(0),timeMonday=timeWeekday(1),timeTuesday=timeWeekday(2),timeWednesday=timeWeekday(3),timeThursday=timeWeekday(4),timeFriday=timeWeekday(5),timeSaturday=timeWeekday(6);timeSunday.range;timeMonday.range;timeTuesday.range;timeWednesday.range;timeThursday.range;timeFriday.range;timeSaturday.range;function utcWeekday(h){return timeInterval(i=>{i.setUTCDate(i.getUTCDate()-(i.getUTCDay()+7-h)%7),i.setUTCHours(0,0,0,0)},(i,g)=>{i.setUTCDate(i.getUTCDate()+g*7)},(i,g)=>(g-i)/durationWeek)}const utcSunday=utcWeekday(0),utcMonday=utcWeekday(1),utcTuesday=utcWeekday(2),utcWednesday=utcWeekday(3),utcThursday=utcWeekday(4),utcFriday=utcWeekday(5),utcSaturday=utcWeekday(6);utcSunday.range;utcMonday.range;utcTuesday.range;utcWednesday.range;utcThursday.range;utcFriday.range;utcSaturday.range;const timeMonth=timeInterval(h=>{h.setDate(1),h.setHours(0,0,0,0)},(h,i)=>{h.setMonth(h.getMonth()+i)},(h,i)=>i.getMonth()-h.getMonth()+(i.getFullYear()-h.getFullYear())*12,h=>h.getMonth());timeMonth.range;const utcMonth=timeInterval(h=>{h.setUTCDate(1),h.setUTCHours(0,0,0,0)},(h,i)=>{h.setUTCMonth(h.getUTCMonth()+i)},(h,i)=>i.getUTCMonth()-h.getUTCMonth()+(i.getUTCFullYear()-h.getUTCFullYear())*12,h=>h.getUTCMonth());utcMonth.range;const timeYear=timeInterval(h=>{h.setMonth(0,1),h.setHours(0,0,0,0)},(h,i)=>{h.setFullYear(h.getFullYear()+i)},(h,i)=>i.getFullYear()-h.getFullYear(),h=>h.getFullYear());timeYear.every=h=>!isFinite(h=Math.floor(h))||!(h>0)?null:timeInterval(i=>{i.setFullYear(Math.floor(i.getFullYear()/h)*h),i.setMonth(0,1),i.setHours(0,0,0,0)},(i,g)=>{i.setFullYear(i.getFullYear()+g*h)});timeYear.range;const utcYear=timeInterval(h=>{h.setUTCMonth(0,1),h.setUTCHours(0,0,0,0)},(h,i)=>{h.setUTCFullYear(h.getUTCFullYear()+i)},(h,i)=>i.getUTCFullYear()-h.getUTCFullYear(),h=>h.getUTCFullYear());utcYear.every=h=>!isFinite(h=Math.floor(h))||!(h>0)?null:timeInterval(i=>{i.setUTCFullYear(Math.floor(i.getUTCFullYear()/h)*h),i.setUTCMonth(0,1),i.setUTCHours(0,0,0,0)},(i,g)=>{i.setUTCFullYear(i.getUTCFullYear()+g*h)});utcYear.range;function ticker(h,i,g,_,j,$){const _n=[[second,1,durationSecond],[second,5,5*durationSecond],[second,15,15*durationSecond],[second,30,30*durationSecond],[$,1,durationMinute],[$,5,5*durationMinute],[$,15,15*durationMinute],[$,30,30*durationMinute],[j,1,durationHour],[j,3,3*durationHour],[j,6,6*durationHour],[j,12,12*durationHour],[_,1,durationDay],[_,2,2*durationDay],[g,1,durationWeek],[i,1,durationMonth],[i,3,3*durationMonth],[h,1,durationYear]];function _i(ga,ba,xa){const El=ba<ga;El&&([ga,ba]=[ba,ga]);const Tl=xa&&typeof xa.range=="function"?xa:_s(ga,ba,xa),Sl=Tl?Tl.range(ga,+ba+1):[];return El?Sl.reverse():Sl}function _s(ga,ba,xa){const El=Math.abs(ba-ga)/xa,Tl=bisector(([,,Cl])=>Cl).right(_n,El);if(Tl===_n.length)return h.every(tickStep(ga/durationYear,ba/durationYear,xa));if(Tl===0)return millisecond.every(Math.max(tickStep(ga,ba,xa),1));const[Sl,Il]=_n[El/_n[Tl-1][2]<_n[Tl][2]/El?Tl-1:Tl];return Sl.every(Il)}return[_i,_s]}const[utcTicks,utcTickInterval]=ticker(utcYear,utcMonth,utcSunday,unixDay,utcHour,utcMinute),[timeTicks,timeTickInterval]=ticker(timeYear,timeMonth,timeSunday,timeDay,timeHour,timeMinute);function localDate(h){if(0<=h.y&&h.y<100){var i=new Date(-1,h.m,h.d,h.H,h.M,h.S,h.L);return i.setFullYear(h.y),i}return new Date(h.y,h.m,h.d,h.H,h.M,h.S,h.L)}function utcDate(h){if(0<=h.y&&h.y<100){var i=new Date(Date.UTC(-1,h.m,h.d,h.H,h.M,h.S,h.L));return i.setUTCFullYear(h.y),i}return new Date(Date.UTC(h.y,h.m,h.d,h.H,h.M,h.S,h.L))}function newDate(h,i,g){return{y:h,m:i,d:g,H:0,M:0,S:0,L:0}}function formatLocale(h){var i=h.dateTime,g=h.date,_=h.time,j=h.periods,$=h.days,_n=h.shortDays,_i=h.months,_s=h.shortMonths,ga=formatRe(j),ba=formatLookup(j),xa=formatRe($),El=formatLookup($),Tl=formatRe(_n),Sl=formatLookup(_n),Il=formatRe(_i),Cl=formatLookup(_i),Nl=formatRe(_s),Dl=formatLookup(_s),Ul={a:Hp,A:xp,b:Gp,B:$p,c:null,d:formatDayOfMonth,e:formatDayOfMonth,f:formatMicroseconds,g:formatYearISO,G:formatFullYearISO,H:formatHour24,I:formatHour12,j:formatDayOfYear,L:formatMilliseconds,m:formatMonthNumber,M:formatMinutes,p:c0,q:n0,Q:formatUnixTimestamp,s:formatUnixTimestampSeconds,S:formatSeconds,u:formatWeekdayNumberMonday,U:formatWeekNumberSunday,V:formatWeekNumberISO,w:formatWeekdayNumberSunday,W:formatWeekNumberMonday,x:null,X:null,y:formatYear,Y:formatFullYear,Z:formatZone,"%":formatLiteralPercent},Kl={a:C0,A:Op,b:Q0,B:dy,c:null,d:formatUTCDayOfMonth,e:formatUTCDayOfMonth,f:formatUTCMicroseconds,g:formatUTCYearISO,G:formatUTCFullYearISO,H:formatUTCHour24,I:formatUTCHour12,j:formatUTCDayOfYear,L:formatUTCMilliseconds,m:formatUTCMonthNumber,M:formatUTCMinutes,p:Yy,q:J_,Q:formatUnixTimestamp,s:formatUnixTimestampSeconds,S:formatUTCSeconds,u:formatUTCWeekdayNumberMonday,U:formatUTCWeekNumberSunday,V:formatUTCWeekNumberISO,w:formatUTCWeekdayNumberSunday,W:formatUTCWeekNumberMonday,x:null,X:null,y:formatUTCYear,Y:formatUTCFullYear,Z:formatUTCZone,"%":formatLiteralPercent},Jl={a:yp,A:Ap,b:Cp,B:Mp,c:wp,d:parseDayOfMonth,e:parseDayOfMonth,f:parseMicroseconds,g:parseYear,G:parseFullYear,H:parseHour24,I:parseHour24,j:parseDayOfYear,L:parseMilliseconds,m:parseMonthNumber,M:parseMinutes,p:Up,q:parseQuarter,Q:parseUnixTimestamp,s:parseUnixTimestampSeconds,S:parseSeconds,u:parseWeekdayNumberMonday,U:parseWeekNumberSunday,V:parseWeekNumberISO,w:parseWeekdayNumberSunday,W:parseWeekNumberMonday,x:Np,X:Fp,y:parseYear,Y:parseFullYear,Z:parseZone,"%":parseLiteralPercent};Ul.x=Ep(g,Ul),Ul.X=Ep(_,Ul),Ul.c=Ep(i,Ul),Kl.x=Ep(g,Kl),Kl.X=Ep(_,Kl),Kl.c=Ep(i,Kl);function Ep(R0,ry){return function(q0){var d0=[],Cy=-1,vy=0,A_=R0.length,I_,IT,HS;for(q0 instanceof Date||(q0=new Date(+q0));++Cy<A_;)R0.charCodeAt(Cy)===37&&(d0.push(R0.slice(vy,Cy)),(IT=pads[I_=R0.charAt(++Cy)])!=null?I_=R0.charAt(++Cy):IT=I_==="e"?" ":"0",(HS=ry[I_])&&(I_=HS(q0,IT)),d0.push(I_),vy=Cy+1);return d0.push(R0.slice(vy,Cy)),d0.join("")}}function _p(R0,ry){return function(q0){var d0=newDate(1900,void 0,1),Cy=Ip(d0,R0,q0+="",0),vy,A_;if(Cy!=q0.length)return null;if("Q"in d0)return new Date(d0.Q);if("s"in d0)return new Date(d0.s*1e3+("L"in d0?d0.L:0));if(ry&&!("Z"in d0)&&(d0.Z=0),"p"in d0&&(d0.H=d0.H%12+d0.p*12),d0.m===void 0&&(d0.m="q"in d0?d0.q:0),"V"in d0){if(d0.V<1||d0.V>53)return null;"w"in d0||(d0.w=1),"Z"in d0?(vy=utcDate(newDate(d0.y,0,1)),A_=vy.getUTCDay(),vy=A_>4||A_===0?utcMonday.ceil(vy):utcMonday(vy),vy=utcDay.offset(vy,(d0.V-1)*7),d0.y=vy.getUTCFullYear(),d0.m=vy.getUTCMonth(),d0.d=vy.getUTCDate()+(d0.w+6)%7):(vy=localDate(newDate(d0.y,0,1)),A_=vy.getDay(),vy=A_>4||A_===0?timeMonday.ceil(vy):timeMonday(vy),vy=timeDay.offset(vy,(d0.V-1)*7),d0.y=vy.getFullYear(),d0.m=vy.getMonth(),d0.d=vy.getDate()+(d0.w+6)%7)}else("W"in d0||"U"in d0)&&("w"in d0||(d0.w="u"in d0?d0.u%7:"W"in d0?1:0),A_="Z"in d0?utcDate(newDate(d0.y,0,1)).getUTCDay():localDate(newDate(d0.y,0,1)).getDay(),d0.m=0,d0.d="W"in d0?(d0.w+6)%7+d0.W*7-(A_+5)%7:d0.w+d0.U*7-(A_+6)%7);return"Z"in d0?(d0.H+=d0.Z/100|0,d0.M+=d0.Z%100,utcDate(d0)):localDate(d0)}}function Ip(R0,ry,q0,d0){for(var Cy=0,vy=ry.length,A_=q0.length,I_,IT;Cy<vy;){if(d0>=A_)return-1;if(I_=ry.charCodeAt(Cy++),I_===37){if(I_=ry.charAt(Cy++),IT=Jl[I_ in pads?ry.charAt(Cy++):I_],!IT||(d0=IT(R0,q0,d0))<0)return-1}else if(I_!=q0.charCodeAt(d0++))return-1}return d0}function Up(R0,ry,q0){var d0=ga.exec(ry.slice(q0));return d0?(R0.p=ba.get(d0[0].toLowerCase()),q0+d0[0].length):-1}function yp(R0,ry,q0){var d0=Tl.exec(ry.slice(q0));return d0?(R0.w=Sl.get(d0[0].toLowerCase()),q0+d0[0].length):-1}function Ap(R0,ry,q0){var d0=xa.exec(ry.slice(q0));return d0?(R0.w=El.get(d0[0].toLowerCase()),q0+d0[0].length):-1}function Cp(R0,ry,q0){var d0=Nl.exec(ry.slice(q0));return d0?(R0.m=Dl.get(d0[0].toLowerCase()),q0+d0[0].length):-1}function Mp(R0,ry,q0){var d0=Il.exec(ry.slice(q0));return d0?(R0.m=Cl.get(d0[0].toLowerCase()),q0+d0[0].length):-1}function wp(R0,ry,q0){return Ip(R0,i,ry,q0)}function Np(R0,ry,q0){return Ip(R0,g,ry,q0)}function Fp(R0,ry,q0){return Ip(R0,_,ry,q0)}function Hp(R0){return _n[R0.getDay()]}function xp(R0){return $[R0.getDay()]}function Gp(R0){return _s[R0.getMonth()]}function $p(R0){return _i[R0.getMonth()]}function c0(R0){return j[+(R0.getHours()>=12)]}function n0(R0){return 1+~~(R0.getMonth()/3)}function C0(R0){return _n[R0.getUTCDay()]}function Op(R0){return $[R0.getUTCDay()]}function Q0(R0){return _s[R0.getUTCMonth()]}function dy(R0){return _i[R0.getUTCMonth()]}function Yy(R0){return j[+(R0.getUTCHours()>=12)]}function J_(R0){return 1+~~(R0.getUTCMonth()/3)}return{format:function(R0){var ry=Ep(R0+="",Ul);return ry.toString=function(){return R0},ry},parse:function(R0){var ry=_p(R0+="",!1);return ry.toString=function(){return R0},ry},utcFormat:function(R0){var ry=Ep(R0+="",Kl);return ry.toString=function(){return R0},ry},utcParse:function(R0){var ry=_p(R0+="",!0);return ry.toString=function(){return R0},ry}}}var pads={"-":"",_:" ",0:"0"},numberRe=/^\s*\d+/,percentRe=/^%/,requoteRe=/[\\^$*+?|[\]().{}]/g;function pad(h,i,g){var _=h<0?"-":"",j=(_?-h:h)+"",$=j.length;return _+($<g?new Array(g-$+1).join(i)+j:j)}function requote(h){return h.replace(requoteRe,"\\$&")}function formatRe(h){return new RegExp("^(?:"+h.map(requote).join("|")+")","i")}function formatLookup(h){return new Map(h.map((i,g)=>[i.toLowerCase(),g]))}function parseWeekdayNumberSunday(h,i,g){var _=numberRe.exec(i.slice(g,g+1));return _?(h.w=+_[0],g+_[0].length):-1}function parseWeekdayNumberMonday(h,i,g){var _=numberRe.exec(i.slice(g,g+1));return _?(h.u=+_[0],g+_[0].length):-1}function parseWeekNumberSunday(h,i,g){var _=numberRe.exec(i.slice(g,g+2));return _?(h.U=+_[0],g+_[0].length):-1}function parseWeekNumberISO(h,i,g){var _=numberRe.exec(i.slice(g,g+2));return _?(h.V=+_[0],g+_[0].length):-1}function parseWeekNumberMonday(h,i,g){var _=numberRe.exec(i.slice(g,g+2));return _?(h.W=+_[0],g+_[0].length):-1}function parseFullYear(h,i,g){var _=numberRe.exec(i.slice(g,g+4));return _?(h.y=+_[0],g+_[0].length):-1}function parseYear(h,i,g){var _=numberRe.exec(i.slice(g,g+2));return _?(h.y=+_[0]+(+_[0]>68?1900:2e3),g+_[0].length):-1}function parseZone(h,i,g){var _=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(i.slice(g,g+6));return _?(h.Z=_[1]?0:-(_[2]+(_[3]||"00")),g+_[0].length):-1}function parseQuarter(h,i,g){var _=numberRe.exec(i.slice(g,g+1));return _?(h.q=_[0]*3-3,g+_[0].length):-1}function parseMonthNumber(h,i,g){var _=numberRe.exec(i.slice(g,g+2));return _?(h.m=_[0]-1,g+_[0].length):-1}function parseDayOfMonth(h,i,g){var _=numberRe.exec(i.slice(g,g+2));return _?(h.d=+_[0],g+_[0].length):-1}function parseDayOfYear(h,i,g){var _=numberRe.exec(i.slice(g,g+3));return _?(h.m=0,h.d=+_[0],g+_[0].length):-1}function parseHour24(h,i,g){var _=numberRe.exec(i.slice(g,g+2));return _?(h.H=+_[0],g+_[0].length):-1}function parseMinutes(h,i,g){var _=numberRe.exec(i.slice(g,g+2));return _?(h.M=+_[0],g+_[0].length):-1}function parseSeconds(h,i,g){var _=numberRe.exec(i.slice(g,g+2));return _?(h.S=+_[0],g+_[0].length):-1}function parseMilliseconds(h,i,g){var _=numberRe.exec(i.slice(g,g+3));return _?(h.L=+_[0],g+_[0].length):-1}function parseMicroseconds(h,i,g){var _=numberRe.exec(i.slice(g,g+6));return _?(h.L=Math.floor(_[0]/1e3),g+_[0].length):-1}function parseLiteralPercent(h,i,g){var _=percentRe.exec(i.slice(g,g+1));return _?g+_[0].length:-1}function parseUnixTimestamp(h,i,g){var _=numberRe.exec(i.slice(g));return _?(h.Q=+_[0],g+_[0].length):-1}function parseUnixTimestampSeconds(h,i,g){var _=numberRe.exec(i.slice(g));return _?(h.s=+_[0],g+_[0].length):-1}function formatDayOfMonth(h,i){return pad(h.getDate(),i,2)}function formatHour24(h,i){return pad(h.getHours(),i,2)}function formatHour12(h,i){return pad(h.getHours()%12||12,i,2)}function formatDayOfYear(h,i){return pad(1+timeDay.count(timeYear(h),h),i,3)}function formatMilliseconds(h,i){return pad(h.getMilliseconds(),i,3)}function formatMicroseconds(h,i){return formatMilliseconds(h,i)+"000"}function formatMonthNumber(h,i){return pad(h.getMonth()+1,i,2)}function formatMinutes(h,i){return pad(h.getMinutes(),i,2)}function formatSeconds(h,i){return pad(h.getSeconds(),i,2)}function formatWeekdayNumberMonday(h){var i=h.getDay();return i===0?7:i}function formatWeekNumberSunday(h,i){return pad(timeSunday.count(timeYear(h)-1,h),i,2)}function dISO(h){var i=h.getDay();return i>=4||i===0?timeThursday(h):timeThursday.ceil(h)}function formatWeekNumberISO(h,i){return h=dISO(h),pad(timeThursday.count(timeYear(h),h)+(timeYear(h).getDay()===4),i,2)}function formatWeekdayNumberSunday(h){return h.getDay()}function formatWeekNumberMonday(h,i){return pad(timeMonday.count(timeYear(h)-1,h),i,2)}function formatYear(h,i){return pad(h.getFullYear()%100,i,2)}function formatYearISO(h,i){return h=dISO(h),pad(h.getFullYear()%100,i,2)}function formatFullYear(h,i){return pad(h.getFullYear()%1e4,i,4)}function formatFullYearISO(h,i){var g=h.getDay();return h=g>=4||g===0?timeThursday(h):timeThursday.ceil(h),pad(h.getFullYear()%1e4,i,4)}function formatZone(h){var i=h.getTimezoneOffset();return(i>0?"-":(i*=-1,"+"))+pad(i/60|0,"0",2)+pad(i%60,"0",2)}function formatUTCDayOfMonth(h,i){return pad(h.getUTCDate(),i,2)}function formatUTCHour24(h,i){return pad(h.getUTCHours(),i,2)}function formatUTCHour12(h,i){return pad(h.getUTCHours()%12||12,i,2)}function formatUTCDayOfYear(h,i){return pad(1+utcDay.count(utcYear(h),h),i,3)}function formatUTCMilliseconds(h,i){return pad(h.getUTCMilliseconds(),i,3)}function formatUTCMicroseconds(h,i){return formatUTCMilliseconds(h,i)+"000"}function formatUTCMonthNumber(h,i){return pad(h.getUTCMonth()+1,i,2)}function formatUTCMinutes(h,i){return pad(h.getUTCMinutes(),i,2)}function formatUTCSeconds(h,i){return pad(h.getUTCSeconds(),i,2)}function formatUTCWeekdayNumberMonday(h){var i=h.getUTCDay();return i===0?7:i}function formatUTCWeekNumberSunday(h,i){return pad(utcSunday.count(utcYear(h)-1,h),i,2)}function UTCdISO(h){var i=h.getUTCDay();return i>=4||i===0?utcThursday(h):utcThursday.ceil(h)}function formatUTCWeekNumberISO(h,i){return h=UTCdISO(h),pad(utcThursday.count(utcYear(h),h)+(utcYear(h).getUTCDay()===4),i,2)}function formatUTCWeekdayNumberSunday(h){return h.getUTCDay()}function formatUTCWeekNumberMonday(h,i){return pad(utcMonday.count(utcYear(h)-1,h),i,2)}function formatUTCYear(h,i){return pad(h.getUTCFullYear()%100,i,2)}function formatUTCYearISO(h,i){return h=UTCdISO(h),pad(h.getUTCFullYear()%100,i,2)}function formatUTCFullYear(h,i){return pad(h.getUTCFullYear()%1e4,i,4)}function formatUTCFullYearISO(h,i){var g=h.getUTCDay();return h=g>=4||g===0?utcThursday(h):utcThursday.ceil(h),pad(h.getUTCFullYear()%1e4,i,4)}function formatUTCZone(){return"+0000"}function formatLiteralPercent(){return"%"}function formatUnixTimestamp(h){return+h}function formatUnixTimestampSeconds(h){return Math.floor(+h/1e3)}var locale,timeFormat,utcFormat;defaultLocale({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function defaultLocale(h){return locale=formatLocale(h),timeFormat=locale.format,locale.parse,utcFormat=locale.utcFormat,locale.utcParse,locale}function date(h){return new Date(h)}function number(h){return h instanceof Date?+h:+new Date(+h)}function calendar(h,i,g,_,j,$,_n,_i,_s,ga){var ba=continuous(),xa=ba.invert,El=ba.domain,Tl=ga(".%L"),Sl=ga(":%S"),Il=ga("%I:%M"),Cl=ga("%I %p"),Nl=ga("%a %d"),Dl=ga("%b %d"),Ul=ga("%B"),Kl=ga("%Y");function Jl(Ep){return(_s(Ep)<Ep?Tl:_i(Ep)<Ep?Sl:_n(Ep)<Ep?Il:$(Ep)<Ep?Cl:_(Ep)<Ep?j(Ep)<Ep?Nl:Dl:g(Ep)<Ep?Ul:Kl)(Ep)}return ba.invert=function(Ep){return new Date(xa(Ep))},ba.domain=function(Ep){return arguments.length?El(Array.from(Ep,number)):El().map(date)},ba.ticks=function(Ep){var _p=El();return h(_p[0],_p[_p.length-1],Ep??10)},ba.tickFormat=function(Ep,_p){return _p==null?Jl:ga(_p)},ba.nice=function(Ep){var _p=El();return(!Ep||typeof Ep.range!="function")&&(Ep=i(_p[0],_p[_p.length-1],Ep??10)),Ep?El(nice(_p,Ep)):ba},ba.copy=function(){return copy$1(ba,calendar(h,i,g,_,j,$,_n,_i,_s,ga))},ba}function time(){return initRange.apply(calendar(timeTicks,timeTickInterval,timeYear,timeMonth,timeSunday,timeDay,timeHour,timeMinute,second,timeFormat).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function utcTime(){return initRange.apply(calendar(utcTicks,utcTickInterval,utcYear,utcMonth,utcSunday,utcDay,utcHour,utcMinute,second,utcFormat).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function transformer$1(){var h=0,i=1,g,_,j,$,_n=identity$4,_i=!1,_s;function ga(xa){return xa==null||isNaN(xa=+xa)?_s:_n(j===0?.5:(xa=($(xa)-g)*j,_i?Math.max(0,Math.min(1,xa)):xa))}ga.domain=function(xa){return arguments.length?([h,i]=xa,g=$(h=+h),_=$(i=+i),j=g===_?0:1/(_-g),ga):[h,i]},ga.clamp=function(xa){return arguments.length?(_i=!!xa,ga):_i},ga.interpolator=function(xa){return arguments.length?(_n=xa,ga):_n};function ba(xa){return function(El){var Tl,Sl;return arguments.length?([Tl,Sl]=El,_n=xa(Tl,Sl),ga):[_n(0),_n(1)]}}return ga.range=ba(interpolate),ga.rangeRound=ba(interpolateRound),ga.unknown=function(xa){return arguments.length?(_s=xa,ga):_s},function(xa){return $=xa,g=xa(h),_=xa(i),j=g===_?0:1/(_-g),ga}}function copy(h,i){return i.domain(h.domain()).interpolator(h.interpolator()).clamp(h.clamp()).unknown(h.unknown())}function sequential(){var h=linearish(transformer$1()(identity$4));return h.copy=function(){return copy(h,sequential())},initInterpolator.apply(h,arguments)}function sequentialLog(){var h=loggish(transformer$1()).domain([1,10]);return h.copy=function(){return copy(h,sequentialLog()).base(h.base())},initInterpolator.apply(h,arguments)}function sequentialSymlog(){var h=symlogish(transformer$1());return h.copy=function(){return copy(h,sequentialSymlog()).constant(h.constant())},initInterpolator.apply(h,arguments)}function sequentialPow(){var h=powish(transformer$1());return h.copy=function(){return copy(h,sequentialPow()).exponent(h.exponent())},initInterpolator.apply(h,arguments)}function sequentialSqrt(){return sequentialPow.apply(null,arguments).exponent(.5)}function sequentialQuantile(){var h=[],i=identity$4;function g(_){if(_!=null&&!isNaN(_=+_))return i((bisect(h,_,1)-1)/(h.length-1))}return g.domain=function(_){if(!arguments.length)return h.slice();h=[];for(let j of _)j!=null&&!isNaN(j=+j)&&h.push(j);return h.sort(ascending$1),g},g.interpolator=function(_){return arguments.length?(i=_,g):i},g.range=function(){return h.map((_,j)=>i(j/(h.length-1)))},g.quantiles=function(_){return Array.from({length:_+1},(j,$)=>quantile$1(h,$/_))},g.copy=function(){return sequentialQuantile(i).domain(h)},initInterpolator.apply(g,arguments)}function transformer(){var h=0,i=.5,g=1,_=1,j,$,_n,_i,_s,ga=identity$4,ba,xa=!1,El;function Tl(Il){return isNaN(Il=+Il)?El:(Il=.5+((Il=+ba(Il))-$)*(_*Il<_*$?_i:_s),ga(xa?Math.max(0,Math.min(1,Il)):Il))}Tl.domain=function(Il){return arguments.length?([h,i,g]=Il,j=ba(h=+h),$=ba(i=+i),_n=ba(g=+g),_i=j===$?0:.5/($-j),_s=$===_n?0:.5/(_n-$),_=$<j?-1:1,Tl):[h,i,g]},Tl.clamp=function(Il){return arguments.length?(xa=!!Il,Tl):xa},Tl.interpolator=function(Il){return arguments.length?(ga=Il,Tl):ga};function Sl(Il){return function(Cl){var Nl,Dl,Ul;return arguments.length?([Nl,Dl,Ul]=Cl,ga=piecewise(Il,[Nl,Dl,Ul]),Tl):[ga(0),ga(.5),ga(1)]}}return Tl.range=Sl(interpolate),Tl.rangeRound=Sl(interpolateRound),Tl.unknown=function(Il){return arguments.length?(El=Il,Tl):El},function(Il){return ba=Il,j=Il(h),$=Il(i),_n=Il(g),_i=j===$?0:.5/($-j),_s=$===_n?0:.5/(_n-$),_=$<j?-1:1,Tl}}function diverging$1(){var h=linearish(transformer()(identity$4));return h.copy=function(){return copy(h,diverging$1())},initInterpolator.apply(h,arguments)}function divergingLog(){var h=loggish(transformer()).domain([.1,1,10]);return h.copy=function(){return copy(h,divergingLog()).base(h.base())},initInterpolator.apply(h,arguments)}function divergingSymlog(){var h=symlogish(transformer());return h.copy=function(){return copy(h,divergingSymlog()).constant(h.constant())},initInterpolator.apply(h,arguments)}function divergingPow(){var h=powish(transformer());return h.copy=function(){return copy(h,divergingPow()).exponent(h.exponent())},initInterpolator.apply(h,arguments)}function divergingSqrt(){return divergingPow.apply(null,arguments).exponent(.5)}const d3Scale=Object.freeze(Object.defineProperty({__proto__:null,scaleBand:band,scaleDiverging:diverging$1,scaleDivergingLog:divergingLog,scaleDivergingPow:divergingPow,scaleDivergingSqrt:divergingSqrt,scaleDivergingSymlog:divergingSymlog,scaleIdentity:identity$2,scaleImplicit:implicit,scaleLinear:linear,scaleLog:log,scaleOrdinal:ordinal,scalePoint:point$5,scalePow:pow,scaleQuantile:quantile,scaleQuantize:quantize,scaleRadial:radial,scaleSequential:sequential,scaleSequentialLog:sequentialLog,scaleSequentialPow:sequentialPow,scaleSequentialQuantile:sequentialQuantile,scaleSequentialSqrt:sequentialSqrt,scaleSequentialSymlog:sequentialSymlog,scaleSqrt:sqrt$1,scaleSymlog:symlog,scaleThreshold:threshold,scaleTime:time,scaleUtc:utcTime,tickFormat},Symbol.toStringTag,{value:"Module"}));var supportedScaleStrings=["linear","time","log","sqrt"];function toNewName$1(h){var i=function(g){return g&&g[0].toUpperCase()+g.slice(1)};return"scale".concat(i(h))}function validScale(h){return typeof h=="function"?isFunction_1(h.copy)&&isFunction_1(h.domain)&&isFunction_1(h.range):typeof h=="string"?includes_1(supportedScaleStrings,h):!1}function isScaleDefined(h,i){if(h.scale){if(h.scale.x||h.scale.y)return!!h.scale[i]}else return!1;return!0}function getScaleTypeFromProps(h,i){if(isScaleDefined(h,i)){var g=h.scale[i]||h.scale;return typeof g=="string"?g:getType(g)}}function getScaleFromDomain(h,i){var g;if(h.domain&&h.domain[i]?g=h.domain[i]:h.domain&&Array.isArray(h.domain)&&(g=h.domain),!!g)return containsDates(g)?"time":"linear"}function getScaleTypeFromData(h,i){if(!h.data)return"linear";var g=createAccessor(h[i]),_=h.data.map(function(j){var $=isPlainObject_1(g(j))?g(j)[i]:g(j);return $!==void 0?$:j[i]});return containsDates(_)?"time":"linear"}function getScaleFromName(h){if(validScale(h)){var i=toNewName$1(h);return d3Scale[i]()}return linear()}function getBaseScale(h,i){var g=getScaleFromProps(h,i);if(g)return typeof g=="string"?getScaleFromName(g):g;var _=getScaleFromDomain(h,i)||getScaleTypeFromData(h,i);return getScaleFromName(_)}function getScaleFromProps(h,i){if(isScaleDefined(h,i)){var g=h.scale[i]||h.scale;if(validScale(g))return isFunction_1(g)?g:getScaleFromName(g)}}function getScaleType(h,i){return getScaleTypeFromProps(h,i)||getScaleTypeFromData(h,i)}var DUCK_TYPES=[{name:"quantile",method:"quantiles"},{name:"log",method:"base"}];function getType(h){if(typeof h=="string")return h;var i=DUCK_TYPES.filter(function(g){return h[g.method]!==void 0})[0];return i?i.name:void 0}function _defineProperty$l(h,i,g){return i in h?Object.defineProperty(h,i,{value:g,enumerable:!0,configurable:!0,writable:!0}):h[i]=g,h}var makeChainable=function(h){var i=function(_){return function(j,$,_n){var _i=j[$];if(_i==null)return _?new Error("Required `".concat($,"` was not specified in `").concat(_n,"`.")):null;for(var _s=arguments.length,ga=new Array(_s>3?_s-3:0),ba=3;ba<_s;ba++)ga[ba-3]=arguments[ba];return h.apply(void 0,[j,$,_n].concat(ga))}},g=Object.assign(i(!1),{isRequired:i(!0)});return g},nullConstructor=function(){return null},undefinedConstructor=function(){},getConstructor=function(h){return h===void 0?undefinedConstructor:h===null?nullConstructor:h.constructor},getConstructorName=function(h){return h===void 0?"undefined":h===null?"null":Object.prototype.toString.call(h).slice(8,-1)};function deprecated(h,i){return function(g,_,j){return g[_],propTypesExports.checkPropTypes(_defineProperty$l({},_,h),g,_,j),null}}function allOfType(h){return makeChainable(function(i,g,_){for(var j=arguments.length,$=new Array(j>3?j-3:0),_n=3;_n<j;_n++)$[_n-3]=arguments[_n];return h.reduce(function(_i,_s){return _i||_s.apply(void 0,[i,g,_].concat($))},null)})}var nonNegative=makeChainable(function(h,i,g){var _=h[i];return typeof _!="number"||_<0?new Error("`".concat(i,"` in `").concat(g,"` must be a non-negative number.")):null}),integer=makeChainable(function(h,i,g){var _=h[i];return typeof _!="number"||_%1!==0?new Error("`".concat(i,"` in `").concat(g,"` must be an integer.")):null}),greaterThanZero=makeChainable(function(h,i,g){var _=h[i];return typeof _!="number"||_<=0?new Error("`".concat(i,"` in `").concat(g,"` must be a number greater than zero.")):null}),domain=makeChainable(function(h,i,g){var _=h[i];return!Array.isArray(_)||_.length!==2||_[1]===_[0]?new Error("`".concat(i,"` in `").concat(g,"` must be an array of two unique numeric values.")):null}),scale=makeChainable(function(h,i,g){var _=h[i];return validScale(_)?null:new Error("`".concat(i,"` in `").concat(g,"` must be a d3 scale."))}),homogeneousArray=makeChainable(function(h,i,g){var _=h[i];if(!Array.isArray(_))return new Error("`".concat(i,"` in `").concat(g,"` must be an array."));if(_.length<2)return null;var j=getConstructor(_[0]),$=find_1(_,function(_s){return j!==getConstructor(_s)});if($){var _n=getConstructorName(_[0]),_i=getConstructorName($);return new Error("Expected `".concat(i,"` in `").concat(g,"` to be a ")+"homogeneous array, but found types `".concat(_n,"` and ")+"`".concat(_i,"`."))}return null});makeChainable(function(h,i){return h[i]&&Array.isArray(h[i])&&h[i].length!==h.data.length?new Error("Length of data and ".concat(i," arrays must match.")):null});makeChainable(function(h,i,g){return h[i]&&!isRegExp_1(h[i])?new Error("`".concat(i,"` in `").concat(g,"` must be a regular expression.")):null});function _classCallCheck$a(h,i){if(!(h instanceof i))throw new TypeError("Cannot call a class as a function")}function _defineProperties$a(h,i){for(var g=0;g<i.length;g++){var _=i[g];_.enumerable=_.enumerable||!1,_.configurable=!0,"value"in _&&(_.writable=!0),Object.defineProperty(h,_.key,_)}}function _createClass$a(h,i,g){return i&&_defineProperties$a(h.prototype,i),g&&_defineProperties$a(h,g),Object.defineProperty(h,"prototype",{writable:!1}),h}function _inherits$a(h,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");h.prototype=Object.create(i&&i.prototype,{constructor:{value:h,writable:!0,configurable:!0}}),Object.defineProperty(h,"prototype",{writable:!1}),i&&_setPrototypeOf$a(h,i)}function _setPrototypeOf$a(h,i){return _setPrototypeOf$a=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(_,j){return _.__proto__=j,_},_setPrototypeOf$a(h,i)}function _createSuper$a(h){var i=_isNativeReflectConstruct$a();return function(){var _=_getPrototypeOf$a(h),j;if(i){var $=_getPrototypeOf$a(this).constructor;j=Reflect.construct(_,arguments,$)}else j=_.apply(this,arguments);return _possibleConstructorReturn$a(this,j)}}function _possibleConstructorReturn$a(h,i){if(i&&(typeof i=="object"||typeof i=="function"))return i;if(i!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$a(h)}function _assertThisInitialized$a(h){if(h===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return h}function _isNativeReflectConstruct$a(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function _getPrototypeOf$a(h){return _getPrototypeOf$a=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(g){return g.__proto__||Object.getPrototypeOf(g)},_getPrototypeOf$a(h)}var Portal=function(h){_inherits$a(g,h);var i=_createSuper$a(g);function g(_){var j;return _classCallCheck$a(this,g),j=i.call(this,_),j.map=void 0,j.index=void 0,j.portalRegister=function(){return++j.index},j.portalUpdate=function($,_n){j.map[$]=_n,j.forceUpdate()},j.portalDeregister=function($){delete j.map[$],j.forceUpdate()},j.map={},j.index=1,j}return _createClass$a(g,[{key:"getChildren",value:function(){var j=this;return keys_1(this.map).map(function($){var _n=j.map[$];return _n&&React.cloneElement(_n,{key:$})})}},{key:"render",value:function(){return React.createElement("svg",this.props,this.getChildren())}}]),g}(React.Component);Portal.displayName="Portal";Portal.propTypes={className:propTypesExports.string,height:nonNegative,style:propTypesExports.object,viewBox:propTypesExports.string,width:nonNegative};var PortalContext=React.createContext({});PortalContext.displayName="PortalContext";function _slicedToArray$4(h,i){return _arrayWithHoles$4(h)||_iterableToArrayLimit$4(h,i)||_unsupportedIterableToArray$h(h,i)||_nonIterableRest$4()}function _nonIterableRest$4(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _unsupportedIterableToArray$h(h,i){if(h){if(typeof h=="string")return _arrayLikeToArray$h(h,i);var g=Object.prototype.toString.call(h).slice(8,-1);if(g==="Object"&&h.constructor&&(g=h.constructor.name),g==="Map"||g==="Set")return Array.from(h);if(g==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(g))return _arrayLikeToArray$h(h,i)}}function _arrayLikeToArray$h(h,i){(i==null||i>h.length)&&(i=h.length);for(var g=0,_=new Array(i);g<i;g++)_[g]=h[g];return _}function _iterableToArrayLimit$4(h,i){var g=h==null?null:typeof Symbol<"u"&&h[Symbol.iterator]||h["@@iterator"];if(g!=null){var _=[],j=!0,$=!1,_n,_i;try{for(g=g.call(h);!(j=(_n=g.next()).done)&&(_.push(_n.value),!(i&&_.length===i));j=!0);}catch(_s){$=!0,_i=_s}finally{try{!j&&g.return!=null&&g.return()}finally{if($)throw _i}}return _}}function _arrayWithHoles$4(h){if(Array.isArray(h))return h}function ownKeys$i(h,i){var g=Object.keys(h);if(Object.getOwnPropertySymbols){var _=Object.getOwnPropertySymbols(h);i&&(_=_.filter(function(j){return Object.getOwnPropertyDescriptor(h,j).enumerable})),g.push.apply(g,_)}return g}function _objectSpread$i(h){for(var i=1;i<arguments.length;i++){var g=arguments[i]!=null?arguments[i]:{};i%2?ownKeys$i(Object(g),!0).forEach(function(_){_defineProperty$k(h,_,g[_])}):Object.getOwnPropertyDescriptors?Object.defineProperties(h,Object.getOwnPropertyDescriptors(g)):ownKeys$i(Object(g)).forEach(function(_){Object.defineProperty(h,_,Object.getOwnPropertyDescriptor(g,_))})}return h}function _defineProperty$k(h,i,g){return i in h?Object.defineProperty(h,i,{value:g,enumerable:!0,configurable:!0,writable:!0}):h[i]=g,h}var USER_PROPS_SAFELIST={startsWith:["data-","aria-"],exactMatch:[]},doesPropStartWith=function(h){var i=!1;return USER_PROPS_SAFELIST.startsWith.forEach(function(g){var _=new RegExp("\\b(".concat(g,")(\\w|-)+"),"g");_.test(h)&&(i=!0)}),i},isExactMatch=function(h){return USER_PROPS_SAFELIST.exactMatch.includes(h)},testIfSafeProp=function(h){return!!(doesPropStartWith(h)||isExactMatch(h))},getValue=function(h,i){return typeof h=="function"?h(i):h},getSafeUserProps=function(h){var i=_objectSpread$i({},h);return Object.fromEntries(Object.entries(i).filter(function(g){var _=_slicedToArray$4(g,1),j=_[0];return testIfSafeProp(j)}).map(function(g){var _=_slicedToArray$4(g,2),j=_[0],$=_[1];return[j,getValue($,h)]}))},withSafeUserProps=function(h,i){return reactExports.cloneElement(h,getSafeUserProps(i))};function _extends$4(){return _extends$4=Object.assign?Object.assign.bind():function(h){for(var i=1;i<arguments.length;i++){var g=arguments[i];for(var _ in g)Object.prototype.hasOwnProperty.call(g,_)&&(h[_]=g[_])}return h},_extends$4.apply(this,arguments)}function ownKeys$h(h,i){var g=Object.keys(h);if(Object.getOwnPropertySymbols){var _=Object.getOwnPropertySymbols(h);i&&(_=_.filter(function(j){return Object.getOwnPropertyDescriptor(h,j).enumerable})),g.push.apply(g,_)}return g}function _objectSpread$h(h){for(var i=1;i<arguments.length;i++){var g=arguments[i]!=null?arguments[i]:{};i%2?ownKeys$h(Object(g),!0).forEach(function(_){_defineProperty$j(h,_,g[_])}):Object.getOwnPropertyDescriptors?Object.defineProperties(h,Object.getOwnPropertyDescriptors(g)):ownKeys$h(Object(g)).forEach(function(_){Object.defineProperty(h,_,Object.getOwnPropertyDescriptor(g,_))})}return h}function _defineProperty$j(h,i,g){return i in h?Object.defineProperty(h,i,{value:g,enumerable:!0,configurable:!0,writable:!0}):h[i]=g,h}function _classCallCheck$9(h,i){if(!(h instanceof i))throw new TypeError("Cannot call a class as a function")}function _defineProperties$9(h,i){for(var g=0;g<i.length;g++){var _=i[g];_.enumerable=_.enumerable||!1,_.configurable=!0,"value"in _&&(_.writable=!0),Object.defineProperty(h,_.key,_)}}function _createClass$9(h,i,g){return i&&_defineProperties$9(h.prototype,i),g&&_defineProperties$9(h,g),Object.defineProperty(h,"prototype",{writable:!1}),h}function _inherits$9(h,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");h.prototype=Object.create(i&&i.prototype,{constructor:{value:h,writable:!0,configurable:!0}}),Object.defineProperty(h,"prototype",{writable:!1}),i&&_setPrototypeOf$9(h,i)}function _setPrototypeOf$9(h,i){return _setPrototypeOf$9=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(_,j){return _.__proto__=j,_},_setPrototypeOf$9(h,i)}function _createSuper$9(h){var i=_isNativeReflectConstruct$9();return function(){var _=_getPrototypeOf$9(h),j;if(i){var $=_getPrototypeOf$9(this).constructor;j=Reflect.construct(_,arguments,$)}else j=_.apply(this,arguments);return _possibleConstructorReturn$9(this,j)}}function _possibleConstructorReturn$9(h,i){if(i&&(typeof i=="object"||typeof i=="function"))return i;if(i!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$9(h)}function _assertThisInitialized$9(h){if(h===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return h}function _isNativeReflectConstruct$9(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function _getPrototypeOf$9(h){return _getPrototypeOf$9=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(g){return g.__proto__||Object.getPrototypeOf(g)},_getPrototypeOf$9(h)}var VictoryContainer=function(h){_inherits$9(g,h);var i=_createSuper$9(g);function g(_){var j;return _classCallCheck$9(this,g),j=i.call(this,_),j.containerId=void 0,j.portalRef=void 0,j.containerRef=void 0,j.shouldHandleWheel=void 0,j.savePortalRef=function($){return j.portalRef=$,$},j.portalUpdate=function($,_n){return j.portalRef.portalUpdate($,_n)},j.portalRegister=function(){return j.portalRef.portalRegister()},j.portalDeregister=function($){return j.portalRef.portalDeregister($)},j.saveContainerRef=function($){return isFunction_1(j.props.containerRef)&&j.props.containerRef($),j.containerRef=$,$},j.handleWheel=function($){return $.preventDefault()},j.containerId=!isObject_1(_)||_.containerId===void 0?uniqueId_1("victory-container-"):_.containerId,j.shouldHandleWheel=!!(_&&_.events&&_.events.onWheel),j}return _createClass$9(g,[{key:"componentDidMount",value:function(){this.shouldHandleWheel&&this.containerRef&&this.containerRef.addEventListener("wheel",this.handleWheel)}},{key:"componentWillUnmount",value:function(){this.shouldHandleWheel&&this.containerRef&&this.containerRef.removeEventListener("wheel",this.handleWheel)}},{key:"getIdForElement",value:function(j){return"".concat(this.containerId,"-").concat(j)}},{key:"getChildren",value:function(j){return j.children}},{key:"getOUIAProps",value:function(j){var $=j.ouiaId,_n=j.ouiaSafe,_i=j.ouiaType;return _objectSpread$h(_objectSpread$h(_objectSpread$h({},$&&{"data-ouia-component-id":$}),_i&&{"data-ouia-component-type":_i}),_n!==void 0&&{"data-ouia-safe":_n})}},{key:"renderContainer",value:function(j,$,_n){var _i=j.title,_s=j.desc,ga=j.portalComponent,ba=j.className,xa=j.width,El=j.height,Tl=j.portalZIndex,Sl=j.responsive,Il=this.getChildren(j),Cl=Sl?{width:"100%",height:"100%"}:{width:xa,height:El},Nl=assign_1({pointerEvents:"none",touchAction:"none",position:"relative"},Cl),Dl=assign_1({zIndex:Tl,position:"absolute",top:0,left:0},Cl),Ul=assign_1({pointerEvents:"all"},Cl),Kl=assign_1({overflow:"visible"},Cl),Jl={width:xa,height:El,viewBox:$.viewBox,preserveAspectRatio:$.preserveAspectRatio,style:Kl};return React.createElement(PortalContext.Provider,{value:{portalUpdate:this.portalUpdate,portalRegister:this.portalRegister,portalDeregister:this.portalDeregister}},React.createElement("div",_extends$4({style:defaults_1({},_n,Nl),className:ba,ref:this.saveContainerRef},this.getOUIAProps(j)),React.createElement("svg",_extends$4({},$,{style:Ul}),_i?React.createElement("title",{id:this.getIdForElement("title")},_i):null,_s?React.createElement("desc",{id:this.getIdForElement("desc")},_s):null,Il),React.createElement("div",{style:Dl},React.cloneElement(ga,_objectSpread$h(_objectSpread$h({},Jl),{},{ref:this.savePortalRef})))))}},{key:"render",value:function(){var j=this.props,$=j.width,_n=j.height,_i=j.responsive,_s=j.events,ga=j.title,ba=j.desc,xa=j.tabIndex,El=j.preserveAspectRatio,Tl=j.role,Sl=_i?this.props.style:omit(this.props.style,["height","width"]),Il=getSafeUserProps(this.props),Cl=assign_1(_objectSpread$h({width:$,height:_n,tabIndex:xa,role:Tl,"aria-labelledby":[ga&&this.getIdForElement("title"),this.props["aria-labelledby"]].filter(Boolean).join(" ")||void 0,"aria-describedby":[ba&&this.getIdForElement("desc"),this.props["aria-describedby"]].filter(Boolean).join(" ")||void 0,viewBox:_i?"0 0 ".concat($," ").concat(_n):void 0,preserveAspectRatio:_i?El:void 0},Il),_s);return this.renderContainer(this.props,Cl,Sl)}}]),g}(React.Component);VictoryContainer.displayName="VictoryContainer";VictoryContainer.role="container";VictoryContainer.propTypes={"aria-describedby":propTypesExports.string,"aria-labelledby":propTypesExports.string,children:propTypesExports.oneOfType([propTypesExports.arrayOf(propTypesExports.node),propTypesExports.node]),className:propTypesExports.string,containerId:propTypesExports.oneOfType([propTypesExports.number,propTypesExports.string]),containerRef:propTypesExports.func,desc:propTypesExports.string,events:propTypesExports.object,height:nonNegative,name:propTypesExports.string,origin:propTypesExports.shape({x:nonNegative,y:nonNegative}),ouiaId:propTypesExports.oneOfType([propTypesExports.number,propTypesExports.string]),ouiaSafe:propTypesExports.bool,ouiaType:propTypesExports.string,polar:propTypesExports.bool,portalComponent:propTypesExports.element,portalZIndex:integer,preserveAspectRatio:propTypesExports.string,responsive:propTypesExports.bool,role:propTypesExports.string,style:propTypesExports.object,tabIndex:propTypesExports.number,theme:propTypesExports.object,title:propTypesExports.string,width:nonNegative};VictoryContainer.defaultProps={className:"VictoryContainer",portalComponent:React.createElement(Portal,null),portalZIndex:99,responsive:!0,role:"img"};VictoryContainer.contextType=TimerContext$1;var baseKeys=_baseKeys,getTag=_getTag,isArguments=isArguments_1,isArray$2=isArray_1,isArrayLike$1=isArrayLike_1,isBuffer=isBufferExports,isPrototype=_isPrototype,isTypedArray=isTypedArray_1,mapTag="[object Map]",setTag="[object Set]",objectProto$2=Object.prototype,hasOwnProperty$1=objectProto$2.hasOwnProperty;function isEmpty(h){if(h==null)return!0;if(isArrayLike$1(h)&&(isArray$2(h)||typeof h=="string"||typeof h.splice=="function"||isBuffer(h)||isTypedArray(h)||isArguments(h)))return!h.length;var i=getTag(h);if(i==mapTag||i==setTag)return!h.size;if(isPrototype(h))return!baseKeys(h).length;for(var g in h)if(hasOwnProperty$1.call(h,g))return!1;return!0}var isEmpty_1=isEmpty;function _classCallCheck$8(h,i){if(!(h instanceof i))throw new TypeError("Cannot call a class as a function")}function _defineProperties$8(h,i){for(var g=0;g<i.length;g++){var _=i[g];_.enumerable=_.enumerable||!1,_.configurable=!0,"value"in _&&(_.writable=!0),Object.defineProperty(h,_.key,_)}}function _createClass$8(h,i,g){return i&&_defineProperties$8(h.prototype,i),g&&_defineProperties$8(h,g),Object.defineProperty(h,"prototype",{writable:!1}),h}function _inherits$8(h,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");h.prototype=Object.create(i&&i.prototype,{constructor:{value:h,writable:!0,configurable:!0}}),Object.defineProperty(h,"prototype",{writable:!1}),i&&_setPrototypeOf$8(h,i)}function _setPrototypeOf$8(h,i){return _setPrototypeOf$8=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(_,j){return _.__proto__=j,_},_setPrototypeOf$8(h,i)}function _createSuper$8(h){var i=_isNativeReflectConstruct$8();return function(){var _=_getPrototypeOf$8(h),j;if(i){var $=_getPrototypeOf$8(this).constructor;j=Reflect.construct(_,arguments,$)}else j=_.apply(this,arguments);return _possibleConstructorReturn$8(this,j)}}function _possibleConstructorReturn$8(h,i){if(i&&(typeof i=="object"||typeof i=="function"))return i;if(i!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$8(h)}function _assertThisInitialized$8(h){if(h===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return h}function _isNativeReflectConstruct$8(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function _getPrototypeOf$8(h){return _getPrototypeOf$8=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(g){return g.__proto__||Object.getPrototypeOf(g)},_getPrototypeOf$8(h)}var VictoryPortal=function(h){_inherits$8(g,h);var i=_createSuper$8(g);function g(){var _;_classCallCheck$8(this,g);for(var j=arguments.length,$=new Array(j),_n=0;_n<j;_n++)$[_n]=arguments[_n];return _=i.call.apply(i,[this].concat($)),_.checkedContext=void 0,_.renderInPlace=void 0,_.element=void 0,_.portalKey=void 0,_}return _createClass$8(g,[{key:"componentDidMount",value:function(){this.checkedContext||(typeof this.context.portalUpdate!="function"&&(this.renderInPlace=!0),this.checkedContext=!0),this.forceUpdate()}},{key:"componentDidUpdate",value:function(){this.renderInPlace||(this.portalKey=this.portalKey||this.context.portalRegister(),this.context.portalUpdate(this.portalKey,this.element))}},{key:"componentWillUnmount",value:function(){this.context&&this.context.portalDeregister&&this.context.portalDeregister(this.portalKey)}},{key:"renderPortal",value:function(j){return this.renderInPlace?j:(this.element=j,null)}},{key:"render",value:function(){var j=Array.isArray(this.props.children)?this.props.children[0]:this.props.children,$=this.props.groupComponent,_n=j&&j.props||{},_i=_n.groupComponent?{groupComponent:$,standalone:!1}:{},_s=defaults_1(_i,_n,omit(this.props,["children","groupComponent"])),ga=j&&React.cloneElement(j,_s);return this.renderPortal(ga)}}]),g}(React.Component);VictoryPortal.displayName="VictoryPortal";VictoryPortal.role="portal";VictoryPortal.propTypes={children:propTypesExports.node,groupComponent:propTypesExports.element};VictoryPortal.defaultProps={groupComponent:React.createElement("g",null)};VictoryPortal.contextType=PortalContext;var _excluded$4=["desc"];function _extends$3(){return _extends$3=Object.assign?Object.assign.bind():function(h){for(var i=1;i<arguments.length;i++){var g=arguments[i];for(var _ in g)Object.prototype.hasOwnProperty.call(g,_)&&(h[_]=g[_])}return h},_extends$3.apply(this,arguments)}function _objectWithoutProperties$4(h,i){if(h==null)return{};var g=_objectWithoutPropertiesLoose$4(h,i),_,j;if(Object.getOwnPropertySymbols){var $=Object.getOwnPropertySymbols(h);for(j=0;j<$.length;j++)_=$[j],!(i.indexOf(_)>=0)&&Object.prototype.propertyIsEnumerable.call(h,_)&&(g[_]=h[_])}return g}function _objectWithoutPropertiesLoose$4(h,i){if(h==null)return{};var g={},_=Object.keys(h),j,$;for($=0;$<_.length;$++)j=_[$],!(i.indexOf(j)>=0)&&(g[j]=h[j]);return g}var Rect=function(h){var i=h.desc,g=_objectWithoutProperties$4(h,_excluded$4);return i?React.createElement("rect",_extends$3({vectorEffect:"non-scaling-stroke"},g),React.createElement("desc",null,i)):React.createElement("rect",_extends$3({vectorEffect:"non-scaling-stroke"},g))},_excluded$3=["children","title","desc"];function _objectWithoutProperties$3(h,i){if(h==null)return{};var g=_objectWithoutPropertiesLoose$3(h,i),_,j;if(Object.getOwnPropertySymbols){var $=Object.getOwnPropertySymbols(h);for(j=0;j<$.length;j++)_=$[j],!(i.indexOf(_)>=0)&&Object.prototype.propertyIsEnumerable.call(h,_)&&(g[_]=h[_])}return g}function _objectWithoutPropertiesLoose$3(h,i){if(h==null)return{};var g={},_=Object.keys(h),j,$;for($=0;$<_.length;$++)j=_[$],!(i.indexOf(j)>=0)&&(g[j]=h[j]);return g}var Text=function(h){var i=h.children,g=h.title,_=h.desc,j=_objectWithoutProperties$3(h,_excluded$3);return React.createElement("text",j,g&&React.createElement("title",null,g),_&&React.createElement("desc",null,_),i)};Text.propTypes={children:propTypesExports.node,desc:propTypesExports.string,title:propTypesExports.string};var TSpan=function(h){return React.createElement("tspan",h)};function getVerticalAnchor(h,i){i=i||{};var g=i._y>=0?1:-1,_=h.style&&h.style.labels||{};return i.verticalAnchor||_.verticalAnchor?i.verticalAnchor||_.verticalAnchor:h.horizontal?"middle":g>=0?"end":"start"}function getTextAnchor(h,i){i=i||{};var g=h.style,_=h.horizontal,j=i._y>=0?1:-1,$=g&&g.labels||{};return i.verticalAnchor||$.verticalAnchor?i.verticalAnchor||$.verticalAnchor:_?j>=0?"start":"end":"middle"}function getAngle$1(h,i){i=i||{};var g=h.style&&h.style.labels||{};return i.angle===void 0?g.angle:i.angle}function getPadding(h,i){i=i||{};var g=h.horizontal,_=h.style,j=_.labels||{},$=evaluateProp(j.padding,h)||0,_n=i._y<0?-1:1;return{x:g?_n*$:0,y:g?0:-1*_n*$}}function getOffset$1(h,i){if(h.polar)return{};var g=getPadding(h,i);return{dx:g.x,dy:g.y}}function getPosition$3(h,i){var g=h.polar,_=scalePoint(h,i),j=_.x,$=_.y;if(!g)return{x:j,y:$};var _n=getPolarPadding(h,i);return{x:j+_n.x,y:$+_n.y}}function getPolarPadding(h,i){var g=h.style,_=getDegrees(h,i),j=g.labels||{},$=evaluateProp(j.padding,h)||0,_n=degreesToRadians(_);return{x:$*Math.cos(_n),y:-$*Math.sin(_n)}}function getLabelPlacement(h){var i=h.labelComponent,g=h.labelPlacement,_=h.polar,j=_?"perpendicular":"vertical";return g||i.props&&i.props.labelPlacement||j}function getPolarOrientation(h){return h<45||h>315?"right":h>=45&&h<=135?"top":h>135&&h<225?"left":"bottom"}function getText(h,i,g){return i=i||{},i.label!==void 0?i.label:Array.isArray(h.labels)?h.labels[g]:h.labels}function getPolarTextAnchor(h,i){var g=getLabelPlacement(h);return g==="perpendicular"||g==="vertical"&&(i===90||i===270)?"middle":i<=90||i>270?"start":"end"}function getPolarVerticalAnchor(h,i){var g=getLabelPlacement(h),_=getPolarOrientation(i);return g==="parallel"||_==="left"||_==="right"?"middle":_==="top"?"end":"start"}function getPolarAngle(h,i){var g=h.labelPlacement,_=h.datum;if(!g||g==="vertical")return 0;var j=i!==void 0?i%360:getDegrees(h,_),$=j>90&&j<180||j>270?1:-1,_n=0;j===0||j===180?_n=90:j>0&&j<180?_n=90-j:j>180&&j<360&&(_n=270-j);var _i=g==="perpendicular"?0:90;return _n+$*_i}function getDegrees(h,i){var g=getPoint(i),_=g.x;return radiansToDegrees(h.scale.x(_))%360}function getProps(h,i){var g=h.scale,_=h.data,j=h.style,$=h.horizontal,_n=h.polar,_i=h.width,_s=h.height,ga=h.theme,ba=h.labelComponent,xa=h.disableInlineStyles,El=_[i],Tl=getDegrees(h,El),Sl=_n?getPolarTextAnchor(h,Tl):getTextAnchor(h,El),Il=_n?getPolarVerticalAnchor(h,Tl):getVerticalAnchor(h,El),Cl=getAngle$1(h,El),Nl=getText(h,El,i),Dl=getLabelPlacement(h),Ul=getPosition$3(h,El),Kl=Ul.x,Jl=Ul.y,Ep=getOffset$1(h,El),_p=Ep.dx,Ip=Ep.dy,Up={angle:Cl,data:_,datum:El,disableInlineStyles:xa,horizontal:$,index:i,polar:_n,scale:g,labelPlacement:Dl,text:Nl,textAnchor:Sl,verticalAnchor:Il,x:Kl,y:Jl,dx:_p,dy:Ip,width:_i,height:_s,style:j.labels};if(!isTooltip(ba))return Up;var yp=ga&&ga.tooltip||{};return defaults_1({},Up,omit(yp,["style"]))}var toTransformString=function(h){for(var i=arguments.length,g=new Array(i>1?i-1:0),_=1;_<i;_++)g[_-1]=arguments[_];if(g.length>0)return g.reduce(function(_i,_s){return[_i,toTransformString(_s)].join(" ")},toTransformString(h)).trim();if(h==null||typeof h=="string")return h;var j=[];for(var $ in h)if(h.hasOwnProperty($)){var _n=h[$];j.push("".concat($,"(").concat(_n,")"))}return j.join(" ").trim()};function getColorScale$1(h){var i={grayscale:["#cccccc","#969696","#636363","#252525"],qualitative:["#334D5C","#45B29D","#EFC94C","#E27A3F","#DF5A49","#4F7DA1","#55DBC1","#EFDA97","#E2A37F","#DF948A"],heatmap:["#428517","#77D200","#D6D305","#EC8E19","#C92B05"],warm:["#940031","#C43343","#DC5429","#FF821D","#FFAF55"],cool:["#2746B9","#0B69D4","#2794DB","#31BB76","#60E83B"],red:["#FCAE91","#FB6A4A","#DE2D26","#A50F15","#750B0E"],blue:["#002C61","#004B8F","#006BC9","#3795E5","#65B4F4"],green:["#354722","#466631","#649146","#8AB25C","#A9C97E"]};return h?i[h]:i.grayscale}function _slicedToArray$3(h,i){return _arrayWithHoles$3(h)||_iterableToArrayLimit$3(h,i)||_unsupportedIterableToArray$g(h,i)||_nonIterableRest$3()}function _nonIterableRest$3(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _iterableToArrayLimit$3(h,i){var g=h==null?null:typeof Symbol<"u"&&h[Symbol.iterator]||h["@@iterator"];if(g!=null){var _=[],j=!0,$=!1,_n,_i;try{for(g=g.call(h);!(j=(_n=g.next()).done)&&(_.push(_n.value),!(i&&_.length===i));j=!0);}catch(_s){$=!0,_i=_s}finally{try{!j&&g.return!=null&&g.return()}finally{if($)throw _i}}return _}}function _arrayWithHoles$3(h){if(Array.isArray(h))return h}function _toConsumableArray$e(h){return _arrayWithoutHoles$e(h)||_iterableToArray$e(h)||_unsupportedIterableToArray$g(h)||_nonIterableSpread$e()}function _nonIterableSpread$e(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _unsupportedIterableToArray$g(h,i){if(h){if(typeof h=="string")return _arrayLikeToArray$g(h,i);var g=Object.prototype.toString.call(h).slice(8,-1);if(g==="Object"&&h.constructor&&(g=h.constructor.name),g==="Map"||g==="Set")return Array.from(h);if(g==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(g))return _arrayLikeToArray$g(h,i)}}function _iterableToArray$e(h){if(typeof Symbol<"u"&&h[Symbol.iterator]!=null||h["@@iterator"]!=null)return Array.from(h)}function _arrayWithoutHoles$e(h){if(Array.isArray(h))return _arrayLikeToArray$g(h)}function _arrayLikeToArray$g(h,i){(i==null||i>h.length)&&(i=h.length);for(var g=0,_=new Array(i);g<i;g++)_[g]=h[g];return _}var fonts={"American Typewriter":{widths:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.25,.4203125,.3296875,.6,.6375,.8015625,.8203125,.1875,.45625,.45625,.6375,.5,.2734375,.309375,.2734375,.4390625,.6375,.6375,.6375,.6375,.6375,.6375,.6375,.6375,.6375,.6375,.2734375,.2734375,.5,.5,.5,.6,.6921875,.7640625,.6921875,.6375,.728125,.6734375,.6203125,.7109375,.784375,.3828125,.6421875,.7859375,.6375,.9484375,.7640625,.65625,.6375,.65625,.7296875,.6203125,.6375,.7109375,.740625,.940625,.784375,.7578125,.6203125,.4375,.5,.4375,.5,.5,.4921875,.5734375,.5890625,.5109375,.6,.528125,.43125,.5578125,.6375,.3109375,.40625,.6234375,.309375,.928125,.6375,.546875,.6,.58125,.4921875,.4921875,.4,.6203125,.625,.825,.6375,.640625,.528125,.5,.5,.5,.6671875],avg:.5793421052631578},Arial:{widths:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.278125,.278125,.35625,.55625,.55625,.890625,.6671875,.1921875,.334375,.334375,.390625,.584375,.278125,.334375,.278125,.278125,.55625,.55625,.55625,.55625,.55625,.55625,.55625,.55625,.55625,.55625,.278125,.278125,.584375,.584375,.584375,.55625,1.015625,.6703125,.6671875,.7234375,.7234375,.6671875,.6109375,.778125,.7234375,.278125,.5,.6671875,.55625,.834375,.7234375,.778125,.6671875,.778125,.7234375,.6671875,.6109375,.7234375,.6671875,.9453125,.6671875,.6671875,.6109375,.278125,.278125,.278125,.4703125,.584375,.334375,.55625,.55625,.5,.55625,.55625,.3125,.55625,.55625,.2234375,.2703125,.5,.2234375,.834375,.55625,.55625,.55625,.55625,.346875,.5,.278125,.55625,.5,.7234375,.5,.5,.5,.334375,.2609375,.334375,.584375],avg:.528733552631579},"Arial Black":{widths:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.33125,.334375,.5,.6609375,.6671875,1,.890625,.278125,.390625,.390625,.55625,.6609375,.334375,.334375,.334375,.28125,.6671875,.6671875,.6671875,.6671875,.6671875,.6671875,.6671875,.6671875,.6671875,.6671875,.334375,.334375,.6609375,.6609375,.6609375,.6109375,.7453125,.78125,.778125,.778125,.778125,.7234375,.6671875,.834375,.834375,.390625,.6671875,.834375,.6671875,.9453125,.834375,.834375,.7234375,.834375,.78125,.7234375,.7234375,.834375,.7796875,1.003125,.78125,.78125,.7234375,.390625,.28125,.390625,.6609375,.5125,.334375,.6671875,.6671875,.6671875,.6671875,.6671875,.41875,.6671875,.6671875,.334375,.384375,.6671875,.334375,1,.6671875,.6671875,.6671875,.6671875,.4703125,.6109375,.4453125,.6671875,.6140625,.946875,.6671875,.615625,.55625,.390625,.278125,.390625,.6609375],avg:.6213157894736842},Baskerville:{widths:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.25,.25,.40625,.6671875,.490625,.875,.7015625,.178125,.2453125,.246875,.4171875,.6671875,.25,.3125,.25,.521875,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.25,.25,.6671875,.6671875,.6671875,.396875,.9171875,.684375,.615625,.71875,.7609375,.625,.553125,.771875,.803125,.3546875,.515625,.78125,.6046875,.928125,.75,.8234375,.5625,.96875,.7296875,.5421875,.6984375,.771875,.7296875,.9484375,.771875,.678125,.6359375,.3640625,.521875,.3640625,.46875,.5125,.334375,.46875,.521875,.428125,.521875,.4375,.3890625,.4765625,.53125,.25,.359375,.4640625,.240625,.803125,.53125,.5,.521875,.521875,.365625,.334375,.2921875,.521875,.4640625,.678125,.4796875,.465625,.428125,.4796875,.5109375,.4796875,.6671875],avg:.5323519736842108},Courier:{widths:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.5984375,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6078125,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.61875,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.615625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6140625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625],avg:.6020559210526316},"Courier New":{widths:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.5984375,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625],avg:.6015296052631579},cursive:{widths:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.1921875,.24375,.40625,.5671875,.3984375,.721875,.909375,.2328125,.434375,.365625,.4734375,.5578125,.19375,.3484375,.19375,.7734375,.503125,.4171875,.5453125,.45,.6046875,.4703125,.5984375,.55625,.503125,.5546875,.20625,.2,.5625,.5546875,.546875,.403125,.70625,.734375,.7078125,.64375,.85,.753125,.75,.6484375,1.0765625,.44375,.5359375,.8359375,.653125,1.0109375,1.1515625,.6796875,.6984375,1.0625,.8234375,.5125,.9234375,.8546875,.70625,.9109375,.7421875,.715625,.6015625,.4640625,.3359375,.4109375,.5421875,.5421875,.4328125,.5125,.5,.3859375,.7375,.359375,.75625,.540625,.5328125,.3203125,.5296875,.5015625,.484375,.7890625,.5640625,.4203125,.703125,.471875,.4734375,.35,.4125,.5640625,.471875,.6484375,.5296875,.575,.4140625,.415625,.20625,.3796875,.5421875],avg:.5604440789473684},fantasy:{widths:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.215625,.2625,.3265625,.6109375,.534375,.7625,.7828125,.2,.4359375,.4359375,.3765625,.5109375,.2796875,.4609375,.2796875,.5296875,.6640625,.253125,.521875,.4765625,.6640625,.490625,.528125,.5546875,.496875,.5421875,.2796875,.2796875,.5625,.4609375,.5625,.4828125,.609375,.740625,.7234375,.740625,.8265625,.7234375,.6171875,.7359375,.765625,.240625,.5453125,.715625,.6078125,.8640625,.653125,.9125,.6484375,.946875,.6921875,.653125,.6953125,.8015625,.58125,.784375,.671875,.6265625,.690625,.4359375,.5296875,.4359375,.53125,.5,.2875,.5375,.603125,.4984375,.60625,.53125,.434375,.6421875,.56875,.209375,.4671875,.5484375,.2203125,.709375,.55,.5984375,.6140625,.5765625,.40625,.4734375,.3734375,.559375,.4421875,.6421875,.4890625,.578125,.4484375,.2546875,.2203125,.2546875,.55],avg:.536496710526316},Geneva:{widths:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.3328125,.3046875,.5,.6671875,.6671875,.90625,.728125,.3046875,.446875,.446875,.5078125,.6671875,.3046875,.3796875,.3046875,.5390625,.6671875,.6671875,.6671875,.6671875,.6671875,.6671875,.6671875,.6671875,.6671875,.6671875,.3046875,.3046875,.6671875,.6671875,.6671875,.56875,.871875,.728125,.6375,.6515625,.7015625,.5765625,.5546875,.675,.690625,.2421875,.4921875,.6640625,.584375,.7890625,.709375,.7359375,.584375,.78125,.60625,.60625,.640625,.6671875,.728125,.946875,.6109375,.6109375,.5765625,.446875,.5390625,.446875,.6671875,.6671875,.5921875,.5546875,.6109375,.546875,.603125,.5765625,.390625,.6109375,.584375,.2359375,.334375,.5390625,.2359375,.8953125,.584375,.60625,.603125,.603125,.3875,.509375,.44375,.584375,.565625,.78125,.53125,.571875,.5546875,.4515625,.246875,.4515625,.6671875],avg:.5762664473684211},Georgia:{widths:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.2421875,.33125,.4125,.64375,.6109375,.81875,.7109375,.215625,.375,.375,.4734375,.64375,.2703125,.375,.2703125,.46875,.6140625,.4296875,.559375,.553125,.565625,.5296875,.5671875,.503125,.596875,.5671875,.3125,.3125,.64375,.64375,.64375,.4796875,.9296875,.715625,.6546875,.6421875,.75,.6546875,.6,.7265625,.815625,.390625,.51875,.7203125,.6046875,.928125,.7671875,.7453125,.6109375,.7453125,.7234375,.5625,.61875,.7578125,.70625,.99375,.7125,.6640625,.6015625,.375,.46875,.375,.64375,.65,.5,.5046875,.56875,.4546875,.575,.484375,.39375,.509375,.5828125,.29375,.3671875,.546875,.2875,.88125,.5921875,.5390625,.571875,.5640625,.4109375,.4328125,.3453125,.5765625,.5203125,.75625,.50625,.5171875,.4453125,.43125,.375,.43125,.64375],avg:.5551809210526316},"Gill Sans":{widths:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.2765625,.271875,.3546875,.584375,.5421875,.6765625,.625,.1890625,.3234375,.3234375,.4171875,.584375,.2203125,.3234375,.2203125,.28125,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.2203125,.2296875,.584375,.584375,.584375,.334375,1.0109375,.6671875,.5640625,.709375,.75,.5,.4703125,.740625,.7296875,.25,.3125,.65625,.490625,.78125,.78125,.8234375,.5109375,.8234375,.6046875,.459375,.6046875,.709375,.6046875,1.0421875,.709375,.6046875,.646875,.334375,.28125,.334375,.4703125,.5828125,.334375,.428125,.5,.4390625,.5109375,.4796875,.296875,.428125,.5,.2203125,.2265625,.5,.2203125,.771875,.5,.553125,.5,.5,.3984375,.3859375,.334375,.5,.4390625,.7203125,.5,.4390625,.4171875,.334375,.2609375,.334375,.584375],avg:.4933717105263159},Helvetica:{widths:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.2796875,.2765625,.3546875,.5546875,.5546875,.8890625,.665625,.190625,.3328125,.3328125,.3890625,.5828125,.2765625,.3328125,.2765625,.3015625,.5546875,.5546875,.5546875,.5546875,.5546875,.5546875,.5546875,.5546875,.5546875,.5546875,.2765625,.2765625,.584375,.5828125,.584375,.5546875,1.0140625,.665625,.665625,.721875,.721875,.665625,.609375,.7765625,.721875,.2765625,.5,.665625,.5546875,.8328125,.721875,.7765625,.665625,.7765625,.721875,.665625,.609375,.721875,.665625,.94375,.665625,.665625,.609375,.2765625,.3546875,.2765625,.4765625,.5546875,.3328125,.5546875,.5546875,.5,.5546875,.5546875,.2765625,.5546875,.5546875,.221875,.240625,.5,.221875,.8328125,.5546875,.5546875,.5546875,.5546875,.3328125,.5,.2765625,.5546875,.5,.721875,.5,.5,.5,.3546875,.259375,.353125,.5890625],avg:.5279276315789471},"Helvetica Neue":{widths:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.278125,.259375,.4265625,.55625,.55625,1,.6453125,.278125,.2703125,.26875,.353125,.6,.278125,.3890625,.278125,.36875,.55625,.55625,.55625,.55625,.55625,.55625,.55625,.55625,.55625,.55625,.278125,.278125,.6,.6,.6,.55625,.8,.6625,.6859375,.7234375,.7046875,.6125,.575,.759375,.7234375,.259375,.5203125,.6703125,.55625,.871875,.7234375,.7609375,.6484375,.7609375,.6859375,.6484375,.575,.7234375,.6140625,.9265625,.6125,.6484375,.6125,.259375,.36875,.259375,.6,.5,.25625,.5375,.59375,.5375,.59375,.5375,.2984375,.575,.55625,.2234375,.2375,.5203125,.2234375,.853125,.55625,.575,.59375,.59375,.334375,.5,.315625,.55625,.5,.759375,.51875,.5,.48125,.334375,.2234375,.334375,.6],avg:.5279440789473684},"Hoefler Text":{widths:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.2359375,.2234375,.3921875,.7125,.49375,.8859375,.771875,.2125,.3078125,.309375,.375,.4234375,.234375,.3125,.234375,.3,.5828125,.365625,.434375,.3921875,.5234375,.3984375,.5125,.4328125,.46875,.5125,.234375,.234375,.515625,.4234375,.515625,.340625,.7609375,.7359375,.6359375,.721875,.8125,.6375,.5875,.8078125,.853125,.4296875,.503125,.78125,.609375,.9609375,.8515625,.8140625,.6125,.8140625,.71875,.49375,.7125,.76875,.771875,1.125,.7765625,.7734375,.65625,.321875,.3078125,.321875,.3546875,.5,.3375,.446875,.5359375,.45,.5296875,.4546875,.425,.4921875,.54375,.2671875,.240625,.5390625,.25,.815625,.5375,.5234375,.5390625,.5421875,.365625,.36875,.35625,.5171875,.5015625,.75,.5,.509375,.44375,.2421875,.14375,.2421875,.35],avg:.5116447368421051},Montserrat:{widths:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.2625,.2609375,.3734375,.696875,.615625,.8296875,.6703125,.203125,.3296875,.3296875,.3875,.575,.2125,.3828125,.2125,.3953125,.6625,.3625,.56875,.5640625,.6625,.5671875,.609375,.5890625,.6390625,.609375,.2125,.2125,.575,.575,.575,.5671875,1.034375,.7171875,.7546875,.7203125,.8265625,.6703125,.634375,.7734375,.8140625,.303125,.5078125,.7125,.5890625,.95625,.8140625,.8390625,.71875,.8390625,.7234375,.615625,.575,.7921875,.6984375,1.1125,.65625,.6359375,.6515625,.31875,.396875,.31875,.5765625,.5,.6,.590625,.678125,.5640625,.678125,.6046875,.375,.6875,.678125,.2703125,.365625,.6015625,.2703125,1.0625,.678125,.628125,.678125,.678125,.4015625,.4890625,.40625,.6734375,.5421875,.8796875,.534375,.5671875,.5125,.334375,.2953125,.334375,.575],avg:.571792763157895},monospace:{widths:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.5984375,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6078125,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.61875,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.615625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6140625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625,.6015625],avg:.6020559210526316},Overpass:{widths:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.2296875,.2765625,.4203125,.68125,.584375,.8515625,.7015625,.2203125,.3453125,.3453125,.53125,.63125,.2234375,.3953125,.2234375,.509375,.65,.4046875,.6171875,.60625,.6484375,.60625,.6015625,.5375,.615625,.6015625,.2234375,.2234375,.63125,.63125,.63125,.5015625,.8203125,.696875,.6671875,.65,.6859375,.6015625,.559375,.690625,.7078125,.2953125,.565625,.678125,.58125,.8046875,.7109375,.740625,.6421875,.740625,.6765625,.6046875,.590625,.696875,.6640625,.853125,.65,.6671875,.6625,.3734375,.509375,.3734375,.63125,.5125,.4,.5328125,.5625,.51875,.5625,.546875,.3359375,.5625,.565625,.25625,.3203125,.55,.265625,.85,.565625,.5671875,.5625,.5625,.4046875,.4765625,.3796875,.565625,.521875,.7265625,.53125,.5390625,.5125,.3671875,.275,.3671875,.63125],avg:.5430756578947369},Palatino:{widths:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.25,.278125,.371875,.60625,.5,.840625,.778125,.209375,.334375,.334375,.390625,.60625,.2578125,.334375,.25,.60625,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.25,.25,.60625,.60625,.60625,.4453125,.7484375,.778125,.6109375,.709375,.775,.6109375,.55625,.7640625,.8328125,.3375,.346875,.7265625,.6109375,.946875,.83125,.7875,.6046875,.7875,.66875,.525,.6140625,.778125,.7234375,1,.6671875,.6671875,.6671875,.334375,.60625,.334375,.60625,.5,.334375,.5,.565625,.4453125,.6109375,.4796875,.340625,.55625,.5828125,.2921875,.2671875,.5640625,.2921875,.8828125,.5828125,.546875,.6015625,.5609375,.3953125,.425,.3265625,.603125,.565625,.834375,.5171875,.55625,.5,.334375,.60625,.334375,.60625],avg:.5408552631578947},RedHatText:{widths:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.2328125,.2203125,.35625,.6890625,.55,.7390625,.6703125,.2140625,.4015625,.4015625,.4546875,.53125,.2203125,.45625,.2203125,.515625,.6609375,.3078125,.5484375,.5875,.61875,.5703125,.6203125,.559375,.6140625,.6203125,.2203125,.2234375,.465625,.534375,.465625,.5125,.7671875,.6609375,.6703125,.7265625,.728125,.6203125,.6109375,.8,.73125,.253125,.6,.6125,.6078125,.8625,.7390625,.8109375,.6546875,.809375,.6484375,.6234375,.6171875,.7125,.6609375,.8984375,.6546875,.646875,.60625,.3625,.5203125,.3625,.540625,.4609375,.5234375,.5265625,.584375,.509375,.5828125,.5578125,.3703125,.5828125,.553125,.2234375,.24375,.4890625,.2234375,.8453125,.553125,.58125,.584375,.5828125,.353125,.453125,.378125,.553125,.5015625,.6984375,.4875,.4984375,.459375,.3953125,.2921875,.3953125,.58125],avg:.5341940789473685},"sans-serif":{widths:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.278125,.278125,.35625,.55625,.55625,.890625,.6671875,.1921875,.334375,.334375,.390625,.584375,.278125,.334375,.278125,.303125,.55625,.55625,.55625,.55625,.55625,.55625,.55625,.55625,.55625,.55625,.278125,.278125,.5859375,.584375,.5859375,.55625,1.015625,.6671875,.6671875,.7234375,.7234375,.6671875,.6109375,.778125,.7234375,.278125,.5,.6671875,.55625,.834375,.7234375,.778125,.6671875,.778125,.7234375,.6671875,.6109375,.7234375,.6671875,.9453125,.6671875,.6671875,.6109375,.278125,.35625,.278125,.478125,.55625,.334375,.55625,.55625,.5,.55625,.55625,.278125,.55625,.55625,.2234375,.2421875,.5,.2234375,.834375,.55625,.55625,.55625,.55625,.334375,.5,.278125,.55625,.5,.7234375,.5,.5,.5,.35625,.2609375,.3546875,.590625],avg:.5293256578947368},Seravek:{widths:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.215625,.296875,.4171875,.6734375,.4953125,.9125,.740625,.2421875,.3375,.3375,.409375,.60625,.2609375,.35625,.25625,.41875,.5921875,.3515625,.475,.4875,.5375,.509375,.5484375,.4546875,.5421875,.5484375,.25625,.2546875,.5875,.6171875,.5875,.4578125,.8140625,.6765625,.5703125,.6109375,.684375,.5109375,.4953125,.678125,.6859375,.2625,.2625,.5859375,.4734375,.846875,.709375,.740625,.509375,.740625,.584375,.5015625,.528125,.675,.5953125,.9453125,.596875,.540625,.540625,.359375,.4203125,.359375,.5109375,.421875,.4046875,.5015625,.5421875,.446875,.5453125,.484375,.38125,.5140625,.5546875,.240625,.2640625,.490625,.2765625,.8625,.5546875,.546875,.5453125,.5453125,.3625,.41875,.3890625,.5453125,.4703125,.7546875,.4921875,.4609375,.453125,.4015625,.2640625,.4015625,.58125],avg:.5044078947368421},serif:{widths:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.2484375,.334375,.409375,.5,.5,.834375,.778125,.18125,.334375,.334375,.5,.5640625,.25,.334375,.25,.278125,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.278125,.278125,.5640625,.5640625,.5640625,.4453125,.921875,.7234375,.6671875,.6671875,.7234375,.6109375,.55625,.7234375,.7234375,.334375,.390625,.7234375,.6109375,.890625,.7234375,.7234375,.55625,.7234375,.6671875,.55625,.6109375,.7234375,.7234375,.9453125,.7234375,.7234375,.6109375,.334375,.340625,.334375,.4703125,.5,.3453125,.4453125,.5,.4453125,.5,.4453125,.3828125,.5,.5,.278125,.3359375,.5,.278125,.778125,.5,.5,.5,.5,.3375,.390625,.2796875,.5,.5,.7234375,.5,.5,.4453125,.48125,.2015625,.48125,.5421875],avg:.5126315789473684},Tahoma:{widths:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.3109375,.3328125,.4015625,.728125,.546875,.9765625,.70625,.2109375,.3828125,.3828125,.546875,.728125,.303125,.3640625,.303125,.3953125,.546875,.546875,.546875,.546875,.546875,.546875,.546875,.546875,.546875,.546875,.3546875,.3546875,.728125,.728125,.728125,.475,.909375,.6109375,.590625,.6015625,.6796875,.5625,.521875,.66875,.6765625,.3734375,.4171875,.6046875,.4984375,.771875,.66875,.7078125,.5515625,.7078125,.6375,.5578125,.5875,.65625,.60625,.903125,.58125,.5890625,.559375,.3828125,.39375,.3828125,.728125,.5625,.546875,.525,.553125,.4625,.553125,.5265625,.3546875,.553125,.5578125,.2296875,.328125,.51875,.2296875,.840625,.5578125,.54375,.553125,.553125,.3609375,.446875,.3359375,.5578125,.4984375,.7421875,.4953125,.4984375,.4453125,.48125,.3828125,.48125,.728125],avg:.5384374999999998},"Times New Roman":{widths:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.2484375,.334375,.409375,.5,.5,.834375,.778125,.18125,.334375,.334375,.5,.5640625,.25,.334375,.25,.28125,.5,.5,.5,.5,.5,.5,.5,.5,.5,.5,.278125,.278125,.5640625,.5640625,.5640625,.4453125,.921875,.7234375,.6671875,.6671875,.7234375,.6109375,.55625,.7234375,.7234375,.334375,.390625,.73125,.6109375,.890625,.7375,.7234375,.55625,.7234375,.6765625,.55625,.6109375,.7234375,.7234375,.9453125,.7234375,.7234375,.6109375,.334375,.28125,.334375,.4703125,.51875,.334375,.4453125,.503125,.4453125,.503125,.4453125,.4359375,.5,.5,.278125,.35625,.50625,.278125,.778125,.5,.5,.5046875,.5,.340625,.390625,.2796875,.5,.5,.7234375,.5,.5,.4453125,.48125,.2015625,.48125,.5421875],avg:.5134375},"Trebuchet MS":{widths:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.3015625,.3671875,.325,.53125,.525,.6015625,.70625,.1609375,.3671875,.3671875,.3671875,.525,.3671875,.3671875,.3671875,.525,.525,.525,.525,.525,.525,.525,.525,.525,.525,.525,.3671875,.3671875,.525,.525,.525,.3671875,.771875,.590625,.5671875,.5984375,.6140625,.5359375,.525,.6765625,.6546875,.2796875,.4765625,.5765625,.5078125,.7109375,.6390625,.675,.5578125,.7421875,.5828125,.48125,.58125,.6484375,.5875,.853125,.5578125,.5703125,.5515625,.3671875,.3578125,.3671875,.525,.53125,.525,.5265625,.5578125,.4953125,.5578125,.546875,.375,.503125,.546875,.2859375,.3671875,.5046875,.2953125,.83125,.546875,.5375,.5578125,.5578125,.3890625,.40625,.396875,.546875,.490625,.7453125,.5015625,.49375,.475,.3671875,.525,.3671875,.525],avg:.5085197368421052},Verdana:{widths:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,.35,.39375,.459375,.81875,.6359375,1.0765625,.759375,.26875,.4546875,.4546875,.6359375,.81875,.3640625,.4546875,.3640625,.4703125,.6359375,.6359375,.6359375,.6359375,.6359375,.6359375,.6359375,.6359375,.6359375,.6359375,.4546875,.4546875,.81875,.81875,.81875,.546875,1,.684375,.6859375,.6984375,.771875,.6328125,.575,.7765625,.7515625,.421875,.4546875,.69375,.5578125,.84375,.7484375,.7875,.603125,.7875,.7,.684375,.6171875,.7328125,.684375,.9890625,.6859375,.615625,.6859375,.4546875,.46875,.4546875,.81875,.6421875,.6359375,.6015625,.6234375,.521875,.6234375,.596875,.384375,.6234375,.6328125,.275,.3765625,.5921875,.275,.9734375,.6328125,.6078125,.6234375,.6234375,.43125,.521875,.3953125,.6328125,.5921875,.81875,.5921875,.5921875,.5265625,.6359375,.4546875,.6359375,.81875],avg:.6171875000000003}},absoluteMeasurementUnitsToPixels={mm:3.8,sm:38,pt:1.33,pc:16,in:96,px:1},relativeMeasurementUnitsCoef={em:1,ex:.5},coefficients={heightOverlapCoef:1.05,lineCapitalCoef:1.15},defaultStyle={lineHeight:1,letterSpacing:"0px",fontSize:0,angle:0,fontFamily:""},_degreeToRadian=function(h){return h*Math.PI/180},_getFontData=function(h){var i=h.split(",").map(function(_){return _.replace(/'|"/g,"")}),g=i.find(function(_){return fonts[_]})||"Helvetica";return fonts[g]},_splitToLines=function(h){return Array.isArray(h)?h:h.toString().split(/\r\n|\r|\n/g)},_getSizeWithRotate=function(h,i,g){var _=_degreeToRadian(g);return Math.abs(Math.cos(_)*h)+Math.abs(Math.sin(_)*i)},convertLengthToPixels=function(h,i){var g,_=(g=h.match(/[a-zA-Z%]+/))===null||g===void 0?void 0:g[0],j=Number(h.match(/[0-9.,]+/)),$;return _?absoluteMeasurementUnitsToPixels.hasOwnProperty(_)?$=j*absoluteMeasurementUnitsToPixels[_]:relativeMeasurementUnitsCoef.hasOwnProperty(_)?$=(i?j*i:j*defaultStyle.fontSize)*relativeMeasurementUnitsCoef[_]:$=j:$=j||0,$},_prepareParams=function(h,i){var g=Array.isArray(h)?h[i]:h,_=defaults_1({},g,defaultStyle);return assign_1({},_,{fontFamily:_.fontFamily,letterSpacing:typeof _.letterSpacing=="number"?_.letterSpacing:convertLengthToPixels(String(_.letterSpacing),_.fontSize),fontSize:typeof _.fontSize=="number"?_.fontSize:convertLengthToPixels(String(_.fontSize))})},_approximateTextWidthInternal=function(h,i){if(h===void 0||h===""||h===null)return 0;var g=_splitToLines(h).map(function(_,j){var $=_.toString().length,_n=_prepareParams(i,j),_i=_n.fontSize,_s=_n.letterSpacing,ga=_n.fontFamily,ba=_getFontData(ga),xa=_.toString().split("").map(function(El){return El.charCodeAt(0)<ba.widths.length?ba.widths[El.charCodeAt(0)]:ba.avg}).reduce(function(El,Tl){return Tl+El},0)*_i;return xa+_s*Math.max($-1,0)});return Math.max.apply(Math,_toConsumableArray$e(g))},_approximateTextHeightInternal=function(h,i){return h===void 0||h===""||h===null?0:_splitToLines(h).reduce(function(g,_,j){var $=_prepareParams(i,j),_n=_.toString().match(/[(A-Z)(0-9)]/),_i=_n?$.fontSize*coefficients.lineCapitalCoef:$.fontSize;return g+$.lineHeight*_i},0)},_approximateDimensionsInternal=function(h,i){var g=Array.isArray(i)?i[0]&&i[0].angle:i&&i.angle,_=_approximateTextHeightInternal(h,i),j=_approximateTextWidthInternal(h,i),$=g?_getSizeWithRotate(j,_,g):j,_n=g?_getSizeWithRotate(_,j,g):_;return{width:$,height:_n*coefficients.heightOverlapCoef}},_getMeasurementContainer=memoize_1(function(){var h=document.createElementNS("http://www.w3.org/2000/svg","svg");h.setAttribute("xlink","http://www.w3.org/1999/xlink"),h.setAttribute("width","300"),h.setAttribute("height","300"),h.setAttribute("viewBox","0 0 300 300");var i=document.createElementNS("http://www.w3.org/2000/svg","text");return h.appendChild(i),h.style.position="fixed",h.style.top="-9999px",h.style.left="-9999px",document.body.appendChild(h),i}),styleToKeyComponent=function(h){return h?"".concat(h.angle,":").concat(h.fontFamily,":").concat(h.fontSize,":").concat(h.letterSpacing,":").concat(h.lineHeight):"null"},_measureDimensionsInternal=memoize_1(function(h,i){var g=_getMeasurementContainer(),_=_splitToLines(h),j=0;for(var $ of _.entries()){var _n=_slicedToArray$3($,2),_i=_n[0],_s=_n[1],ga=document.createElementNS("http://www.w3.org/2000/svg","tspan"),ba=_prepareParams(i,_i);ga.style.fontFamily=ba.fontFamily,ga.style.fontSize="".concat(ba.fontSize,"px"),ga.style.lineHeight=ba.lineHeight,ga.style.fontFamily=ba.fontFamily,ga.style.letterSpacing=ba.letterSpacing,ga.textContent=_s,ga.setAttribute("x","0"),ga.setAttribute("y","".concat(j)),g.appendChild(ga),j+=ba.lineHeight*ga.getBoundingClientRect().height}var xa=g.getBoundingClientRect(),El=xa.width;return g.innerHTML="",{width:i!=null&&i.angle?_getSizeWithRotate(El,j,i==null?void 0:i.angle):El,height:i!=null&&i.angle?_getSizeWithRotate(j,El,i==null?void 0:i.angle):j}},function(h,i){var g=Array.isArray(h)?h.join():h,_=Array.isArray(i)?i.map(styleToKeyComponent).join():styleToKeyComponent(i);return"".concat(g,"::").concat(_)}),_approximateTextSizeInternal={impl:function(h,i){var g=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,_=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";return!_||g?_approximateDimensionsInternal(h,i):_measureDimensionsInternal(h,i)}},approximateTextSize=function(h,i){return _approximateTextSizeInternal.impl(h,i)};function ownKeys$g(h,i){var g=Object.keys(h);if(Object.getOwnPropertySymbols){var _=Object.getOwnPropertySymbols(h);i&&(_=_.filter(function(j){return Object.getOwnPropertyDescriptor(h,j).enumerable})),g.push.apply(g,_)}return g}function _objectSpread$g(h){for(var i=1;i<arguments.length;i++){var g=arguments[i]!=null?arguments[i]:{};i%2?ownKeys$g(Object(g),!0).forEach(function(_){_defineProperty$i(h,_,g[_])}):Object.getOwnPropertyDescriptors?Object.defineProperties(h,Object.getOwnPropertyDescriptors(g)):ownKeys$g(Object(g)).forEach(function(_){Object.defineProperty(h,_,Object.getOwnPropertyDescriptor(g,_))})}return h}function _defineProperty$i(h,i,g){return i in h?Object.defineProperty(h,i,{value:g,enumerable:!0,configurable:!0,writable:!0}):h[i]=g,h}function _toConsumableArray$d(h){return _arrayWithoutHoles$d(h)||_iterableToArray$d(h)||_unsupportedIterableToArray$f(h)||_nonIterableSpread$d()}function _nonIterableSpread$d(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _unsupportedIterableToArray$f(h,i){if(h){if(typeof h=="string")return _arrayLikeToArray$f(h,i);var g=Object.prototype.toString.call(h).slice(8,-1);if(g==="Object"&&h.constructor&&(g=h.constructor.name),g==="Map"||g==="Set")return Array.from(h);if(g==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(g))return _arrayLikeToArray$f(h,i)}}function _iterableToArray$d(h){if(typeof Symbol<"u"&&h[Symbol.iterator]!=null||h["@@iterator"]!=null)return Array.from(h)}function _arrayWithoutHoles$d(h){if(Array.isArray(h))return _arrayLikeToArray$f(h)}function _arrayLikeToArray$f(h,i){(i==null||i>h.length)&&(i=h.length);for(var g=0,_=new Array(i);g<i;g++)_[g]=h[g];return _}var defaultStyles={fill:"#252525",fontSize:14,fontFamily:"'Gill Sans', 'Gill Sans MT', 'Ser­avek', 'Trebuchet MS', sans-serif",stroke:"transparent"},getPosition$2=function(h,i){if(!h.datum)return 0;var g=scalePoint(h,h.datum);return g[i]},getFontSize=function(h){var i=h&&h.fontSize;if(typeof i=="number")return i;if(i==null)return defaultStyles.fontSize;if(typeof i=="string"){var g=Number(i.replace("px",""));return isNaN(g)?defaultStyles.fontSize:g}return defaultStyles.fontSize},getSingleValue=function(h){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return Array.isArray(h)?h[i]||h[0]:h},shouldUseMultilineBackgrounds=function(h){var i=h.backgroundStyle,g=h.backgroundPadding;return Array.isArray(i)&&!isEmpty_1(i)||Array.isArray(g)&&!isEmpty_1(g)},getStyles$3=function(h,i){if(i.disableInlineStyles){var g=evaluateStyle(h,i);return{fontSize:getFontSize(g)}}var _=function(j){j=j?defaults_1({},j,defaultStyles):defaultStyles;var $=evaluateStyle(j,i);return assign_1({},$,{fontSize:getFontSize($)})};return Array.isArray(h)&&!isEmpty_1(h)?h.map(function(j){return _(j)}):_(h)},getBackgroundStyles=function(h,i){if(h)return Array.isArray(h)&&!isEmpty_1(h)?h.map(function(g){return evaluateStyle(g,i)}):evaluateStyle(h,i)},getBackgroundPadding=function(h){if(h.backgroundPadding&&Array.isArray(h.backgroundPadding))return h.backgroundPadding.map(function(g){var _=evaluateProp(g,h);return getPadding$1({padding:_})});var i=evaluateProp(h.backgroundPadding,h);return getPadding$1({padding:i})},getLineHeight=function(h){var i=evaluateProp(h.lineHeight,h);return Array.isArray(i)&&isEmpty_1(i)?[1]:i},getContent=function(h,i){if(h!=null){if(Array.isArray(h))return h.map(function(_){return evaluateProp(_,i)});var g=evaluateProp(h,i);if(g!=null)return Array.isArray(g)?g:"".concat(g).split(`
`)}},getDy=function(h,i,g){var _=h.dy?evaluateProp(h.dy,h):0,j=h.inline?1:h.text.length,$=evaluateProp(h.capHeight,h),_n=i?evaluateProp(i,h):"middle",_i=_toConsumableArray$d(Array(j).keys()).map(function(ba){return getSingleValue(h.style,ba).fontSize}),_s=_toConsumableArray$d(Array(j).keys()).map(function(ba){return getSingleValue(g,ba)});if(_n==="start")return _+($/2+_s[0]/2)*_i[0];if(h.inline)return _n==="end"?_+($/2-_s[0]/2)*_i[0]:_+$/2*_i[0];if(j===1)return _n==="end"?_+($/2+(.5-j)*_s[0])*_i[0]:_+($/2+(.5-j/2)*_s[0])*_i[0];var ga=_toConsumableArray$d(Array(j).keys()).reduce(function(ba,xa){return ba+($/2+(.5-j)*_s[xa])*_i[xa]/j},0);return _n==="end"?_+ga:_+ga/2+$/2*_s[j-1]*_i[j-1]},getTransform$1=function(h,i,g){var _=h.polar,j=getSingleValue(h.style),$=_?getPolarAngle(h):0,_n=j.angle===void 0?evaluateProp(h.angle,h):j.angle,_i=_n===void 0?$:_n,_s=h.transform||j.transform,ga=_s&&evaluateProp(_s,h),ba=_i&&{rotate:[_i,i,g]};return ga||_i?toTransformString(ga,ba):void 0},getXCoordinate=function(h,i){var g=h.direction,_=h.textAnchor,j=h.x,$=h.dx;if(g==="rtl")return j-i;switch(_){case"middle":return Math.round(j-i/2);case"end":return Math.round(j-i);default:return j+($||0)}},getYCoordinate=function(h,i){var g=h.verticalAnchor,_=h.y,j=h.originalDy,$=j===void 0?0:j,_n=_+$;switch(g){case"start":return Math.floor(_n);case"end":return Math.ceil(_n-i);default:return Math.floor(_n-i/2)}},getFullBackground=function(h,i){var g=h.dx,_=g===void 0?0:g,j=h.transform,$=h.backgroundComponent,_n=h.backgroundStyle,_i=h.inline,_s=h.backgroundPadding,ga=h.capHeight,ba=i.map(function(Cl){return Cl.textSize}),xa=_i?Math.max.apply(Math,_toConsumableArray$d(ba.map(function(Cl){return Cl.height}))):ba.reduce(function(Cl,Nl,Dl){var Ul=Dl?0:ga/2;return Cl+Nl.height*(i[Dl].lineHeight-Ul)},0),El=_i?ba.reduce(function(Cl,Nl,Dl){var Ul=Dl?_:0;return Cl+Nl.width+Ul},0):Math.max.apply(Math,_toConsumableArray$d(ba.map(function(Cl){return Cl.width}))),Tl=getXCoordinate(h,El),Sl=getYCoordinate(h,xa),Il={key:"background",height:xa+_s.top+_s.bottom,style:_n,transform:j,width:El+_s.left+_s.right,x:_i?Tl-_s.left:Tl+_-_s.left,y:Sl};return React.cloneElement($,defaults_1({},$.props,Il))},getInlineXOffset=function(h,i,g){var _=h.textAnchor,j=i.map(function(_i){return _i.widthWithPadding}),$=j.reduce(function(_i,_s){return _i+_s},0),_n=-$/2;switch(_){case"start":return j.reduce(function(_i,_s,ga){return _i=ga<g?_i+_s:_i,_i},0);case"end":return j.reduce(function(_i,_s,ga){return _i=ga>g?_i-_s:_i,_i},0);default:return j.reduce(function(_i,_s,ga){var ba=ga<g?_s:0;return _i=ga===g?_i+_s/2:_i+ba,_i},_n)}},getChildBackgrounds=function(h,i){var g=h.dy,_=h.dx,j=h.transform,$=h.backgroundStyle,_n=h.backgroundPadding,_i=h.backgroundComponent,_s=h.inline,ga=h.y,ba=i.map(function(xa,El){var Tl=getSingleValue(i,El-1),Sl=xa.textSize,Il=xa.fontSize*xa.lineHeight,Cl=Math.ceil(Il),Nl=getSingleValue(_n,El),Dl=getSingleValue(_n,El-1),Ul=_s&&_||0,Kl=El&&!_s?Tl.fontSize*Tl.lineHeight+Dl.top+Dl.bottom:g-Il*.5-(xa.fontSize-xa.capHeight);return{textHeight:Cl,labelSize:Sl,heightWithPadding:Cl+Nl.top+Nl.bottom,widthWithPadding:Sl.width+Nl.left+Nl.right+Ul,y:ga,fontSize:xa.fontSize,dy:Kl}});return ba.map(function(xa,El){var Tl=getXCoordinate(h,xa.labelSize.width),Sl=ba.slice(0,El+1).reduce(function(Kl,Jl){return Kl+Jl.dy},ga),Il=getSingleValue(_n,El),Cl=xa.heightWithPadding,Nl=_s?getInlineXOffset(h,ba,El)+Tl-Il.left:Tl,Dl=_s?getYCoordinate(h,Cl)-Il.top:Sl,Ul={key:"tspan-background-".concat(El),height:Cl,style:getSingleValue($,El),width:xa.widthWithPadding,transform:j,x:Nl-Il.left,y:Dl};return React.cloneElement(_i,defaults_1({},_i.props,Ul))})},getBackgroundElement=function(h,i){return shouldUseMultilineBackgrounds(h)?getChildBackgrounds(h,i):getFullBackground(h,i)},calculateSpanDy=function(h,i,g){var _=getSingleValue(h,i),j=getSingleValue(h,i-1),$=j.fontSize*j.lineHeight,_n=_.fontSize*_.lineHeight,_i=j.fontSize-j.capHeight,_s=_.fontSize-_.capHeight,ga=$-j.fontSize/2+_.fontSize/2-$/2+_n/2-_s/2+_i/2;return shouldUseMultilineBackgrounds(g)?ga+_.backgroundPadding.top+j.backgroundPadding.bottom:ga},getTSpanDy=function(h,i,g){var _=i.inline,j=getSingleValue(h,g);return g&&!_?calculateSpanDy(h,g,i):_?g===0?j.backgroundPadding.top:void 0:j.backgroundPadding.top},evaluateProps$5=function(h){var i=getContent(h.text,h),g=getStyles$3(h.style,assign_1({},h,{text:i})),_=getBackgroundStyles(h.backgroundStyle,assign_1({},h,{text:i,style:g})),j=getBackgroundPadding(assign_1({},h,{text:i,style:g,backgroundStyle:_})),$=evaluateProp(h.id,h);return assign_1({},h,{backgroundStyle:_,backgroundPadding:j,style:g,text:i,id:$})},getCalculatedProps$2=function(h){var i=evaluateProp(h.ariaLabel,h),g=getSingleValue(h.style),_=getLineHeight(h),j=h.direction?evaluateProp(h.direction,h):"inherit",$=h.textAnchor?evaluateProp(h.textAnchor,h):g.textAnchor||"start",_n=h.verticalAnchor?evaluateProp(h.verticalAnchor,h):g.verticalAnchor||"middle",_i=h.dx?evaluateProp(h.dx,h):0,_s=getDy(h,_n,_),ga=h.x!==void 0?h.x:getPosition$2(h,"x"),ba=h.y!==void 0?h.y:getPosition$2(h,"y"),xa=getTransform$1(h,ga,ba);return assign_1({},h,{ariaLabel:i,lineHeight:_,direction:j,textAnchor:$,verticalAnchor:_n,dx:_i,dy:_s,originalDy:h.dy,transform:xa,x:ga,y:ba})},renderLabel=function(h,i){var g=h.ariaLabel,_=h.inline,j=h.className,$=h.title,_n=h.events,_i=h.direction,_s=h.text,ga=h.textAnchor,ba=h.dx,xa=h.dy,El=h.transform,Tl=h.x,Sl=h.y,Il=h.desc,Cl=h.id,Nl=h.tabIndex,Dl=h.tspanComponent,Ul=h.textComponent,Kl=getSafeUserProps(h),Jl=_objectSpread$g(_objectSpread$g({"aria-label":g,key:"text"},_n),{},{direction:_i,dx:ba,x:Tl,y:Sl+xa,transform:El,className:j,title:$,desc:evaluateProp(Il,h),tabIndex:evaluateProp(Nl,h),id:Cl},Kl),Ep=_s.map(function(_p,Ip){var Up=i[Ip].style,yp={key:"".concat(Cl,"-key-").concat(Ip),x:_?void 0:Tl,dx:_?ba+i[Ip].backgroundPadding.left:ba,dy:getTSpanDy(i,h,Ip),textAnchor:Up.textAnchor||ga,style:Up,children:_p};return React.cloneElement(Dl,yp)});return React.cloneElement(Ul,Jl,Ep)},VictoryLabel=function(h){if(h=evaluateProps$5(h),h.text===null||h.text===void 0)return null;var i=getCalculatedProps$2(h),g=i.text,_=i.style,j=i.capHeight,$=i.backgroundPadding,_n=i.lineHeight,_i=g.map(function(El,Tl){var Sl=getSingleValue(_,Tl),Il=convertLengthToPixels("".concat(j,"em"),Sl.fontSize),Cl=getSingleValue(_n,Tl);return{style:Sl,fontSize:Sl.fontSize||defaultStyles.fontSize,capHeight:Il,text:El,textSize:approximateTextSize(El,Sl),lineHeight:Cl,backgroundPadding:getSingleValue($,Tl)}}),_s=renderLabel(i,_i);if(h.backgroundStyle){var ga=getBackgroundElement(i,_i),ba=[ga,_s],xa=React.cloneElement(h.groupComponent,{},ba);return h.renderInPortal?React.createElement(VictoryPortal,null,xa):xa}return h.renderInPortal?React.createElement(VictoryPortal,null,_s):_s};VictoryLabel.displayName="VictoryLabel";VictoryLabel.role="label";VictoryLabel.defaultStyles=defaultStyles;VictoryLabel.propTypes={active:propTypesExports.bool,angle:propTypesExports.oneOfType([propTypesExports.string,propTypesExports.number,propTypesExports.func]),ariaLabel:propTypesExports.oneOfType([propTypesExports.string,propTypesExports.func]),backgroundComponent:propTypesExports.element,backgroundPadding:propTypesExports.oneOfType([propTypesExports.number,propTypesExports.object,propTypesExports.array]),backgroundStyle:propTypesExports.oneOfType([propTypesExports.object,propTypesExports.array]),capHeight:propTypesExports.oneOfType([propTypesExports.string,nonNegative,propTypesExports.func]),className:propTypesExports.string,data:propTypesExports.array,datum:propTypesExports.any,desc:propTypesExports.oneOfType([propTypesExports.string,propTypesExports.func]),direction:propTypesExports.oneOf(["rtl","ltr","inherit"]),dx:propTypesExports.oneOfType([propTypesExports.number,propTypesExports.string,propTypesExports.func]),dy:propTypesExports.oneOfType([propTypesExports.number,propTypesExports.string,propTypesExports.func]),events:propTypesExports.object,groupComponent:propTypesExports.element,id:propTypesExports.oneOfType([propTypesExports.number,propTypesExports.string,propTypesExports.func]),index:propTypesExports.oneOfType([propTypesExports.number,propTypesExports.string]),inline:propTypesExports.bool,labelPlacement:propTypesExports.oneOf(["parallel","perpendicular","vertical"]),lineHeight:propTypesExports.oneOfType([propTypesExports.string,nonNegative,propTypesExports.func,propTypesExports.array]),origin:propTypesExports.shape({x:nonNegative.isRequired,y:nonNegative.isRequired}),polar:propTypesExports.bool,renderInPortal:propTypesExports.bool,scale:propTypesExports.shape({x:scale,y:scale}),style:propTypesExports.oneOfType([propTypesExports.object,propTypesExports.array]),tabIndex:propTypesExports.oneOfType([propTypesExports.number,propTypesExports.func]),text:propTypesExports.oneOfType([propTypesExports.string,propTypesExports.number,propTypesExports.func,propTypesExports.array]),textAnchor:propTypesExports.oneOfType([propTypesExports.oneOf(["start","middle","end","inherit"]),propTypesExports.func]),textComponent:propTypesExports.element,title:propTypesExports.string,transform:propTypesExports.oneOfType([propTypesExports.string,propTypesExports.object,propTypesExports.func]),tspanComponent:propTypesExports.element,verticalAnchor:propTypesExports.oneOfType([propTypesExports.oneOf(["start","middle","end"]),propTypesExports.func]),x:propTypesExports.oneOfType([propTypesExports.number,propTypesExports.string]),y:propTypesExports.oneOfType([propTypesExports.number,propTypesExports.string])};VictoryLabel.defaultProps={backgroundComponent:React.createElement(Rect,null),groupComponent:React.createElement("g",null),direction:"inherit",textComponent:React.createElement(Text,null),tspanComponent:React.createElement(TSpan,null),capHeight:.71,lineHeight:1};function getDatumKey(h,i){return(h.key||i).toString()}function getKeyedData(h){return h.reduce(function(i,g,_){var j=getDatumKey(g,_);return i[j]=g,i},{})}function getKeyedDataDifference(h,i){var g=!1,_=keys_1(h).reduce(function(j,$){return $ in i||(g=!0,j[$]=!0),j},{});return g&&_}function getNodeTransitions(h,i){var g=h&&getKeyedData(h),_=i&&getKeyedData(i);return{entering:g&&getKeyedDataDifference(_,g),exiting:_&&getKeyedDataDifference(g,_)}}function getChildData(h){return h.type&&h.type.getData?h.type.getData(h.props):h.props&&h.props.data||!1}function getInitialTransitionState(h,i){var g=!1,_=!1,j=function(_i,_s){if(!_s||_i.type!==_s.type)return{};var ga=getNodeTransitions(getChildData(_i),getChildData(_s))||{},ba=ga.entering,xa=ga.exiting;return g=g||!!xa,_=_||!!ba,{entering:ba||!1,exiting:xa||!1}},$=function(_i,_s){return _i.map(function(ga,ba){return ga&&ga.props&&ga.props.children&&_s[ba]?$(React.Children.toArray(_i[ba].props.children),React.Children.toArray(_s[ba].props.children)):j(ga,_s[ba])})},_n=$(React.Children.toArray(h),React.Children.toArray(i));return{nodesWillExit:g,nodesWillEnter:_,childrenTransitions:_n,nodesShouldEnter:!1}}function getInitialChildProps(h,i){var g=h.onEnter&&h.onEnter.after?h.onEnter.after:identity_1;return{data:i.map(function(_,j){return assign_1({},_,g(_,j,i))})}}function getChildBeforeLoad(h,i,g,_){if(h=assign_1({},h,{onEnd:_}),h&&h.onLoad&&!h.onLoad.duration)return{animate:h,data:g};var j=h.onLoad&&h.onLoad.before?h.onLoad.before:identity_1;return g=g.map(function($,_n){return assign_1({},$,j($,_n,g))}),{animate:h,data:g,clipWidth:0}}function getChildOnLoad(h,i,g){if(h=assign_1({},h,{onEnd:g}),h&&h.onLoad&&!h.onLoad.duration)return{animate:h,data:i};var _=h.onLoad&&h.onLoad.after?h.onLoad.after:identity_1;return i=i.map(function(j,$){return assign_1({},j,_(j,$,i))}),{animate:h,data:i}}function getChildPropsOnExit(h,i,g,_,j){var $=h&&h.onExit;if(h=assign_1({},h,$),_){h.onEnd=j;var _n=h.onExit&&h.onExit.before?h.onExit.before:identity_1;g=g.map(function(_i,_s){var ga=(_i.key||_s).toString();return _[ga]?assign_1({},_i,_n(_i,_s,g)):_i})}return{animate:h,data:g}}function getChildPropsBeforeEnter(h,i,g,_,j){if(_){h=assign_1({},h,{onEnd:j});var $=h.onEnter&&h.onEnter.before?h.onEnter.before:identity_1;g=g.map(function(_n,_i){var _s=(_n.key||_i).toString();return _[_s]?assign_1({},_n,$(_n,_i,g)):_n})}return{animate:h,data:g}}function getChildPropsOnEnter(h,i,g,_){var j=h&&h.onEnter;if(h=assign_1({},h,j),g){h.onEnd=_;var $=h.onEnter&&h.onEnter.after?h.onEnter.after:identity_1;i=i.map(function(_n,_i){var _s=getDatumKey(_n,_i);return g[_s]?assign_1({},_n,$(_n,_i,i)):_n})}return{animate:h,data:i}}function getTransitionPropsFactory(h,i,g){var _=i&&i.nodesWillExit,j=i&&i.nodesWillEnter,$=i&&i.nodesShouldEnter,_n=i&&i.nodesShouldLoad,_i=i&&i.nodesDoneLoad,_s=i&&i.childrenTransitions||[],ga={enter:h.animate&&h.animate.onEnter&&h.animate.onEnter.duration,exit:h.animate&&h.animate.onExit&&h.animate.onExit.duration,load:h.animate&&h.animate.onLoad&&h.animate.onLoad.duration,move:h.animate&&h.animate.duration},ba=function(Sl,Il,Cl){return _n?getChildOnLoad(Cl,Il,function(){g({nodesShouldLoad:!1,nodesDoneLoad:!0})}):getChildBeforeLoad(Cl,Sl,Il,function(){g({nodesDoneLoad:!0})})},xa=function(Sl,Il,Cl,Nl){return getChildPropsOnExit(Nl,Il,Cl,Sl,function(){g({nodesWillExit:!1})})},El=function(Sl,Il,Cl,Nl){return $?getChildPropsOnEnter(Nl,Cl,Sl,function(){g({nodesWillEnter:!1})}):getChildPropsBeforeEnter(Nl,Il,Cl,Sl,function(){g({nodesShouldEnter:!0})})},Tl=function(Sl,Il){var Cl=Sl.props.animate;if(!Sl.type)return{};var Nl=Sl.props&&Sl.props.polar&&Sl.type.defaultPolarTransitions||Sl.type.defaultTransitions;if(Nl){var Dl=Cl[Il]&&Cl[Il].duration;return Dl!==void 0?Dl:Nl[Il]&&Nl[Il].duration}return{}};return function(Il,Cl){var Nl=getChildData(Il)||[],Dl=defaults_1({},h.animate,Il.props.animate),Ul=Il.props.polar&&Il.type.defaultPolarTransitions||Il.type.defaultTransitions;Dl.onExit=defaults_1({},Dl.onExit,Ul&&Ul.onExit),Dl.onEnter=defaults_1({},Dl.onEnter,Ul&&Ul.onEnter),Dl.onLoad=defaults_1({},Dl.onLoad,Ul&&Ul.onLoad);var Kl=_s[Cl]||_s[0];if(_i){if(_){var _p=Kl&&Kl.exiting,Ip=ga.exit!==void 0?ga.exit:Tl(Il,"onExit"),Up=_p?{duration:Ip}:{delay:Ip};return xa(_p,Il,Nl,assign_1({},Dl,Up))}else if(j){var yp=Kl&&Kl.entering,Ap=ga.enter!==void 0?ga.enter:Tl(Il,"onEnter"),Cp=ga.move!==void 0?ga.move:Il.props.animate&&Il.props.animate.duration,Mp={duration:$&&yp?Ap:Cp};return El(yp,Il,Nl,assign_1({},Dl,Mp))}else if(!i&&Dl&&Dl.onExit)return getInitialChildProps(Dl,Nl)}else{var Jl=ga.load!==void 0?ga.load:Tl(Il,"onLoad"),Ep={duration:Jl};return ba(Il,Nl,assign_1({},Dl,Ep))}return{animate:Dl,data:Nl}}}function _extends$2(){return _extends$2=Object.assign?Object.assign.bind():function(h){for(var i=1;i<arguments.length;i++){var g=arguments[i];for(var _ in g)Object.prototype.hasOwnProperty.call(g,_)&&(h[_]=g[_])}return h},_extends$2.apply(this,arguments)}function _classCallCheck$7(h,i){if(!(h instanceof i))throw new TypeError("Cannot call a class as a function")}function _defineProperties$7(h,i){for(var g=0;g<i.length;g++){var _=i[g];_.enumerable=_.enumerable||!1,_.configurable=!0,"value"in _&&(_.writable=!0),Object.defineProperty(h,_.key,_)}}function _createClass$7(h,i,g){return i&&_defineProperties$7(h.prototype,i),g&&_defineProperties$7(h,g),Object.defineProperty(h,"prototype",{writable:!1}),h}function _inherits$7(h,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");h.prototype=Object.create(i&&i.prototype,{constructor:{value:h,writable:!0,configurable:!0}}),Object.defineProperty(h,"prototype",{writable:!1}),i&&_setPrototypeOf$7(h,i)}function _setPrototypeOf$7(h,i){return _setPrototypeOf$7=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(_,j){return _.__proto__=j,_},_setPrototypeOf$7(h,i)}function _createSuper$7(h){var i=_isNativeReflectConstruct$7();return function(){var _=_getPrototypeOf$7(h),j;if(i){var $=_getPrototypeOf$7(this).constructor;j=Reflect.construct(_,arguments,$)}else j=_.apply(this,arguments);return _possibleConstructorReturn$7(this,j)}}function _possibleConstructorReturn$7(h,i){if(i&&(typeof i=="object"||typeof i=="function"))return i;if(i!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$7(h)}function _assertThisInitialized$7(h){if(h===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return h}function _isNativeReflectConstruct$7(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function _getPrototypeOf$7(h){return _getPrototypeOf$7=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(g){return g.__proto__||Object.getPrototypeOf(g)},_getPrototypeOf$7(h)}var VictoryTransition=function(h){_inherits$7(g,h);var i=_createSuper$7(g);function g(_,j){var $;_classCallCheck$7(this,g),$=i.call(this,_,j),$.continuous=void 0,$.timer=void 0,$.transitionProps=void 0,$.state={nodesShouldLoad:!1,nodesDoneLoad:!1};var _n=$.props.children,_i=_n.props.polar;return $.continuous=!_i&&_n.type&&_n.type.continuous===!0,$.timer=$.context.transitionTimer,$}return _createClass$7(g,[{key:"componentDidMount",value:function(){this.setState({nodesShouldLoad:!0})}},{key:"shouldComponentUpdate",value:function(j){var $=this;return reactFastCompare(this.props,j)||(this.timer.bypassAnimation(),this.setState(this.getTransitionState(this.props,j),function(){return $.timer.resumeAnimation()})),!0}},{key:"componentWillUnmount",value:function(){this.timer.stop()}},{key:"getTransitionState",value:function(j,$){var _n=j.animate;if(_n){if(_n.parentState){var _i=_n.parentState,_s=_i.nodesWillExit?j:null;return{oldProps:_s,nextProps:$}}}else return{};var ga=React.Children.toArray(j.children),ba=React.Children.toArray($.children),xa=getInitialTransitionState(ga,ba),El=xa.nodesWillExit,Tl=xa.nodesWillEnter,Sl=xa.childrenTransitions,Il=xa.nodesShouldEnter;return{nodesWillExit:El,nodesWillEnter:Tl,childrenTransitions:Sl,nodesShouldEnter:Il,oldProps:El?j:null,nextProps:$}}},{key:"getDomainFromChildren",value:function(j,$){var _n=function(xa){return xa.reduce(function(El,Tl){if(Tl.type&&isFunction_1(Tl.type.getDomain)){var Sl=Tl.props&&Tl.type.getDomain(Tl.props,$);return Sl?El.concat(Sl):El}else if(Tl.props&&Tl.props.children)return El.concat(_n(React.Children.toArray(Tl.props.children)));return El},[])},_i=React.Children.toArray(j.children)[0],_s=_i.props||{},ga=Array.isArray(_s.domain)?_s.domain:_s.domain&&_s.domain[$];if(!_s.children&&ga)return ga;var ba=_n([_i]);return ba.length===0?[0,1]:[getMinValue(ba),getMaxValue(ba)]}},{key:"pickProps",value:function(){return this.state?this.state.nodesWillExit?this.state.oldProps||this.props:this.props:this.props}},{key:"pickDomainProps",value:function(j){var $,_n=($=j.animate)===null||$===void 0?void 0:$.parentState;return _n&&_n.nodesWillExit?(this.continuous||_n.continuous)&&(_n.nextProps||this.state.nextProps)||j:this.continuous&&this.state.nodesWillExit&&this.state.nextProps||j}},{key:"getClipWidth",value:function(j,$){var _n=function(){var _s=getRange$1($.props,"x");return _s?Math.abs(_s[1]-_s[0]):j.width},_i=this.transitionProps?this.transitionProps.clipWidth:void 0;return _i!==void 0?_i:_n()}},{key:"render",value:function(){var j,$=this,_n=this.pickProps(),_i=(j=this.props.animate)!==null&&j!==void 0&&j.getTransitions?this.props.animate.getTransitions:getTransitionPropsFactory(_n,this.state,function(Cl){return $.setState(Cl)}),_s=React.Children.toArray(_n.children)[0],ga=_i(_s);this.transitionProps=ga;var ba={x:this.getDomainFromChildren(this.pickDomainProps(_n),"x"),y:this.getDomainFromChildren(_n,"y")},xa=this.getClipWidth(_n,_s),El=defaults_1({domain:ba,clipWidth:xa},ga,_s.props),Tl=_n.animationWhitelist||[],Sl=Tl.concat(["clipWidth"]),Il=Sl.length?pick_1(El,Sl):El;return React.createElement(VictoryAnimation,_extends$2({},El.animate,{data:Il}),function(Cl){if(_s.props.groupComponent){var Nl=$.continuous?React.cloneElement(_s.props.groupComponent,{clipWidth:Cl.clipWidth||0}):_s.props.groupComponent;return React.cloneElement(_s,defaults_1({animate:null,animating:!0,groupComponent:Nl},Cl,El))}return React.cloneElement(_s,defaults_1({animate:null,animating:!0},Cl,El))})}}]),g}(React.Component);VictoryTransition.displayName="VictoryTransition";VictoryTransition.propTypes={animate:propTypesExports.oneOfType([propTypesExports.bool,propTypesExports.object]),animationWhitelist:propTypesExports.array,children:propTypesExports.node};VictoryTransition.contextType=TimerContext$1;var ClipPath=function(h){return React.createElement("defs",null,React.createElement("clipPath",{id:h.clipId},h.children))};ClipPath.propTypes={children:propTypesExports.oneOfType([propTypesExports.arrayOf(propTypesExports.node),propTypesExports.node]),clipId:propTypesExports.oneOfType([propTypesExports.number,propTypesExports.string])};var _excluded$2=["desc"];function _extends$1(){return _extends$1=Object.assign?Object.assign.bind():function(h){for(var i=1;i<arguments.length;i++){var g=arguments[i];for(var _ in g)Object.prototype.hasOwnProperty.call(g,_)&&(h[_]=g[_])}return h},_extends$1.apply(this,arguments)}function _objectWithoutProperties$2(h,i){if(h==null)return{};var g=_objectWithoutPropertiesLoose$2(h,i),_,j;if(Object.getOwnPropertySymbols){var $=Object.getOwnPropertySymbols(h);for(j=0;j<$.length;j++)_=$[j],!(i.indexOf(_)>=0)&&Object.prototype.propertyIsEnumerable.call(h,_)&&(g[_]=h[_])}return g}function _objectWithoutPropertiesLoose$2(h,i){if(h==null)return{};var g={},_=Object.keys(h),j,$;for($=0;$<_.length;$++)j=_[$],!(i.indexOf(j)>=0)&&(g[j]=h[j]);return g}var Circle=function(h){var i=h.desc,g=_objectWithoutProperties$2(h,_excluded$2);return i?React.createElement("circle",_extends$1({vectorEffect:"non-scaling-stroke"},g),React.createElement("desc",null,i)):React.createElement("circle",_extends$1({vectorEffect:"non-scaling-stroke"},g))};function _toConsumableArray$c(h){return _arrayWithoutHoles$c(h)||_iterableToArray$c(h)||_unsupportedIterableToArray$e(h)||_nonIterableSpread$c()}function _nonIterableSpread$c(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _unsupportedIterableToArray$e(h,i){if(h){if(typeof h=="string")return _arrayLikeToArray$e(h,i);var g=Object.prototype.toString.call(h).slice(8,-1);if(g==="Object"&&h.constructor&&(g=h.constructor.name),g==="Map"||g==="Set")return Array.from(h);if(g==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(g))return _arrayLikeToArray$e(h,i)}}function _iterableToArray$c(h){if(typeof Symbol<"u"&&h[Symbol.iterator]!=null||h["@@iterator"]!=null)return Array.from(h)}function _arrayWithoutHoles$c(h){if(Array.isArray(h))return _arrayLikeToArray$e(h)}function _arrayLikeToArray$e(h,i){(i==null||i>h.length)&&(i=h.length);for(var g=0,_=new Array(i);g<i;g++)_[g]=h[g];return _}function ownKeys$f(h,i){var g=Object.keys(h);if(Object.getOwnPropertySymbols){var _=Object.getOwnPropertySymbols(h);i&&(_=_.filter(function(j){return Object.getOwnPropertyDescriptor(h,j).enumerable})),g.push.apply(g,_)}return g}function _objectSpread$f(h){for(var i=1;i<arguments.length;i++){var g=arguments[i]!=null?arguments[i]:{};i%2?ownKeys$f(Object(g),!0).forEach(function(_){_defineProperty$h(h,_,g[_])}):Object.getOwnPropertyDescriptors?Object.defineProperties(h,Object.getOwnPropertyDescriptors(g)):ownKeys$f(Object(g)).forEach(function(_){Object.defineProperty(h,_,Object.getOwnPropertyDescriptor(g,_))})}return h}function _defineProperty$h(h,i,g){return i in h?Object.defineProperty(h,i,{value:g,enumerable:!0,configurable:!0,writable:!0}):h[i]=g,h}function _classCallCheck$6(h,i){if(!(h instanceof i))throw new TypeError("Cannot call a class as a function")}function _defineProperties$6(h,i){for(var g=0;g<i.length;g++){var _=i[g];_.enumerable=_.enumerable||!1,_.configurable=!0,"value"in _&&(_.writable=!0),Object.defineProperty(h,_.key,_)}}function _createClass$6(h,i,g){return i&&_defineProperties$6(h.prototype,i),g&&_defineProperties$6(h,g),Object.defineProperty(h,"prototype",{writable:!1}),h}function _inherits$6(h,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");h.prototype=Object.create(i&&i.prototype,{constructor:{value:h,writable:!0,configurable:!0}}),Object.defineProperty(h,"prototype",{writable:!1}),i&&_setPrototypeOf$6(h,i)}function _setPrototypeOf$6(h,i){return _setPrototypeOf$6=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(_,j){return _.__proto__=j,_},_setPrototypeOf$6(h,i)}function _createSuper$6(h){var i=_isNativeReflectConstruct$6();return function(){var _=_getPrototypeOf$6(h),j;if(i){var $=_getPrototypeOf$6(this).constructor;j=Reflect.construct(_,arguments,$)}else j=_.apply(this,arguments);return _possibleConstructorReturn$6(this,j)}}function _possibleConstructorReturn$6(h,i){if(i&&(typeof i=="object"||typeof i=="function"))return i;if(i!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$6(h)}function _assertThisInitialized$6(h){if(h===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return h}function _isNativeReflectConstruct$6(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function _getPrototypeOf$6(h){return _getPrototypeOf$6=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(g){return g.__proto__||Object.getPrototypeOf(g)},_getPrototypeOf$6(h)}var VictoryClipContainer=function(h){_inherits$6(g,h);var i=_createSuper$6(g);function g(_){var j;return _classCallCheck$6(this,g),j=i.call(this,_),j.clipId=void 0,j.clipId=!isObject_1(_)||_.clipId===void 0?uniqueId_1("victory-clip-"):_.clipId,j}return _createClass$6(g,[{key:"calculateAttributes",value:function(j){var $=j.polar,_n=j.origin,_i=j.clipWidth,_s=_i===void 0?0:_i,ga=j.clipHeight,ba=ga===void 0?0:ga,xa=j.translateX,El=xa===void 0?0:xa,Tl=j.translateY,Sl=Tl===void 0?0:Tl,Il=getPadding$1({padding:j.clipPadding}),Cl=j.radius||getRadius$1(j);return{x:($?_n.x:El)-Il.left,y:($?_n.y:Sl)-Il.top,width:Math.max(($?Cl:_s)+Il.left+Il.right,0),height:Math.max(($?Cl:ba)+Il.top+Il.bottom,0)}}},{key:"renderClippedGroup",value:function(j,$){var _n=getSafeUserProps(j),_i=j.style,_s=j.events,ga=j.transform,ba=j.children,xa=j.className,El=j.groupComponent,Tl=j.tabIndex,Sl=this.renderClipComponent(j,$),Il=assign_1({className:xa,style:_i,transform:ga,key:"clipped-group-".concat($),clipPath:"url(#".concat($,")")},_s);return React.cloneElement(El,_objectSpread$f(_objectSpread$f({},Il),{},{tabIndex:Tl},_n),[Sl].concat(_toConsumableArray$c(React.Children.toArray(ba))))}},{key:"renderGroup",value:function(j){var $=j.style,_n=j.events,_i=j.transform,_s=j.children,ga=j.className,ba=j.groupComponent,xa=j.tabIndex;return React.cloneElement(ba,assign_1({className:ga,style:$,transform:_i,"aria-label":j["aria-label"],tabIndex:xa},_n),_s)}},{key:"renderClipComponent",value:function(j,$){var _n=j.polar,_i=j.origin,_s=j.clipWidth,ga=_s===void 0?0:_s,ba=j.clipHeight,xa=ba===void 0?0:ba,El=j.translateX,Tl=El===void 0?0:El,Sl=j.translateY,Il=Sl===void 0?0:Sl,Cl=j.circleComponent,Nl=j.rectComponent,Dl=j.clipPathComponent,Ul=getPadding$1({padding:j.clipPadding}),Kl=Ul.top,Jl=Ul.bottom,Ep=Ul.left,_p=Ul.right,Ip;if(_n){var Up=j.radius||getRadius$1(j),yp={r:Math.max(Up+Ep+_p,Up+Kl+Jl,0),cx:_i.x-Ep,cy:_i.y-Kl};Ip=React.cloneElement(Cl,yp)}else{var Ap={x:Tl-Ep,y:Il-Kl,width:Math.max(ga+Ep+_p,0),height:Math.max(xa+Kl+Jl,0)};Ip=React.cloneElement(Nl,Ap)}return React.cloneElement(Dl,assign_1({key:"clip-path-".concat($)},j,{clipId:$}),Ip)}},{key:"getClipValue",value:function(j,$){var _n={x:j.clipWidth,y:j.clipHeight};if(_n[$]!==void 0)return _n[$];var _i=getRange$1(j,$);return _i&&Math.abs(_i[0]-_i[1])||void 0}},{key:"getTranslateValue",value:function(j,$){var _n={x:j.translateX,y:j.translateY};if(_n[$]!==void 0)return _n[$];var _i=getRange$1(j,$);return _i?Math.min.apply(Math,_toConsumableArray$c(_i)):void 0}},{key:"render",value:function(){var j=this.getClipValue(this.props,"y"),$=this.getClipValue(this.props,"x");if($===void 0||j===void 0)return this.renderGroup(this.props);var _n=this.getTranslateValue(this.props,"x"),_i=this.getTranslateValue(this.props,"y"),_s=defaults_1({},this.props,{clipHeight:j,clipWidth:$,translateX:_n,translateY:_i});return this.renderClippedGroup(_s,this.clipId)}}]),g}(React.Component);VictoryClipContainer.displayName="VictoryClipContainer";VictoryClipContainer.role="container";VictoryClipContainer.propTypes={"aria-label":propTypesExports.string,children:propTypesExports.oneOfType([propTypesExports.arrayOf(propTypesExports.node),propTypesExports.node]),circleComponent:propTypesExports.element,className:propTypesExports.string,clipHeight:nonNegative,clipId:propTypesExports.oneOfType([propTypesExports.number,propTypesExports.string]),clipPadding:propTypesExports.shape({top:propTypesExports.number,bottom:propTypesExports.number,left:propTypesExports.number,right:propTypesExports.number}),clipPathComponent:propTypesExports.element,clipWidth:nonNegative,events:propTypesExports.object,groupComponent:propTypesExports.element,origin:propTypesExports.shape({x:nonNegative,y:nonNegative}),polar:propTypesExports.bool,radius:nonNegative,style:propTypesExports.object,tabIndex:propTypesExports.number,transform:propTypesExports.string,translateX:propTypesExports.number,translateY:propTypesExports.number};VictoryClipContainer.defaultProps={circleComponent:React.createElement(Circle,null),rectComponent:React.createElement(Rect,null),clipPathComponent:React.createElement(ClipPath,null),groupComponent:React.createElement("g",null)};var colors$1=["#252525","#525252","#737373","#969696","#bdbdbd","#d9d9d9","#f0f0f0"],charcoal="#252525",grey="#969696",sansSerif$1="'Gill Sans', 'Seravek', 'Trebuchet MS', sans-serif",letterSpacing$1="normal",fontSize$1=14,baseProps$2={width:450,height:300,padding:50,colorScale:colors$1},baseLabelStyles$1={fontFamily:sansSerif$1,fontSize:fontSize$1,letterSpacing:letterSpacing$1,padding:10,fill:charcoal,stroke:"transparent"},centeredLabelStyles$1=assign_1({textAnchor:"middle"},baseLabelStyles$1),strokeLinecap$1="round",strokeLinejoin$1="round",grayscale={area:assign_1({style:{data:{fill:charcoal},labels:baseLabelStyles$1}},baseProps$2),axis:assign_1({style:{axis:{fill:"transparent",stroke:charcoal,strokeWidth:1,strokeLinecap:strokeLinecap$1,strokeLinejoin:strokeLinejoin$1},axisLabel:assign_1({},centeredLabelStyles$1,{padding:25}),grid:{fill:"none",stroke:"none",pointerEvents:"painted"},ticks:{fill:"transparent",size:1,stroke:"transparent"},tickLabels:baseLabelStyles$1}},baseProps$2),bar:assign_1({style:{data:{fill:charcoal,padding:8,strokeWidth:0},labels:baseLabelStyles$1}},baseProps$2),boxplot:assign_1({style:{max:{padding:8,stroke:charcoal,strokeWidth:1},maxLabels:assign_1({},baseLabelStyles$1,{padding:3}),median:{padding:8,stroke:charcoal,strokeWidth:1},medianLabels:assign_1({},baseLabelStyles$1,{padding:3}),min:{padding:8,stroke:charcoal,strokeWidth:1},minLabels:assign_1({},baseLabelStyles$1,{padding:3}),q1:{padding:8,fill:grey},q1Labels:assign_1({},baseLabelStyles$1,{padding:3}),q3:{padding:8,fill:grey},q3Labels:assign_1({},baseLabelStyles$1,{padding:3})},boxWidth:20},baseProps$2),candlestick:assign_1({style:{data:{stroke:charcoal,strokeWidth:1},labels:assign_1({},baseLabelStyles$1,{padding:5})},candleColors:{positive:"#ffffff",negative:charcoal}},baseProps$2),chart:baseProps$2,errorbar:assign_1({borderWidth:8,style:{data:{fill:"transparent",stroke:charcoal,strokeWidth:2},labels:baseLabelStyles$1}},baseProps$2),group:assign_1({colorScale:colors$1},baseProps$2),histogram:assign_1({style:{data:{fill:grey,stroke:charcoal,strokeWidth:2},labels:baseLabelStyles$1}},baseProps$2),legend:{colorScale:colors$1,gutter:10,orientation:"vertical",titleOrientation:"top",style:{data:{type:"circle"},labels:baseLabelStyles$1,title:assign_1({},baseLabelStyles$1,{padding:5})}},line:assign_1({style:{data:{fill:"transparent",stroke:charcoal,strokeWidth:2},labels:baseLabelStyles$1}},baseProps$2),pie:{style:{data:{padding:10,stroke:"transparent",strokeWidth:1},labels:assign_1({},baseLabelStyles$1,{padding:20})},colorScale:colors$1,width:400,height:400,padding:50},scatter:assign_1({style:{data:{fill:charcoal,stroke:"transparent",strokeWidth:0},labels:baseLabelStyles$1}},baseProps$2),stack:assign_1({colorScale:colors$1},baseProps$2),tooltip:{style:assign_1({},baseLabelStyles$1,{padding:0,pointerEvents:"none"}),flyoutStyle:{stroke:charcoal,strokeWidth:1,fill:"#f0f0f0",pointerEvents:"none"},flyoutPadding:5,cornerRadius:5,pointerLength:10},voronoi:assign_1({style:{data:{fill:"transparent",stroke:"transparent",strokeWidth:0},labels:assign_1({},baseLabelStyles$1,{padding:5,pointerEvents:"none"}),flyout:{stroke:charcoal,strokeWidth:1,fill:"#f0f0f0",pointerEvents:"none"}}},baseProps$2)},yellow200="#FFF59D",deepOrange600="#F4511E",lime300="#DCE775",lightGreen500="#8BC34A",teal700="#00796B",cyan900="#006064",colors=[deepOrange600,yellow200,lime300,lightGreen500,teal700,cyan900],blueGrey50="#ECEFF1",blueGrey300="#90A4AE",blueGrey700="#455A64",grey900="#212121",sansSerif="'Helvetica Neue', 'Helvetica', sans-serif",letterSpacing="normal",fontSize=12,padding=8,baseProps$1={width:350,height:350,padding:50},baseLabelStyles={fontFamily:sansSerif,fontSize,letterSpacing,padding,fill:blueGrey700,stroke:"transparent",strokeWidth:0},centeredLabelStyles=assign_1({textAnchor:"middle"},baseLabelStyles),strokeDasharray="10, 5",strokeLinecap="round",strokeLinejoin="round",material={area:assign_1({style:{data:{fill:grey900},labels:baseLabelStyles}},baseProps$1),axis:assign_1({style:{axis:{fill:"transparent",stroke:blueGrey300,strokeWidth:2,strokeLinecap,strokeLinejoin},axisLabel:assign_1({},centeredLabelStyles,{padding,stroke:"transparent"}),grid:{fill:"none",stroke:blueGrey50,strokeDasharray,strokeLinecap,strokeLinejoin,pointerEvents:"painted"},ticks:{fill:"transparent",size:5,stroke:blueGrey300,strokeWidth:1,strokeLinecap,strokeLinejoin},tickLabels:assign_1({},baseLabelStyles,{fill:blueGrey700})}},baseProps$1),polarDependentAxis:assign_1({style:{ticks:{fill:"transparent",size:1,stroke:"transparent"}}}),bar:assign_1({style:{data:{fill:blueGrey700,padding,strokeWidth:0},labels:baseLabelStyles}},baseProps$1),boxplot:assign_1({style:{max:{padding,stroke:blueGrey700,strokeWidth:1},maxLabels:assign_1({},baseLabelStyles,{padding:3}),median:{padding,stroke:blueGrey700,strokeWidth:1},medianLabels:assign_1({},baseLabelStyles,{padding:3}),min:{padding,stroke:blueGrey700,strokeWidth:1},minLabels:assign_1({},baseLabelStyles,{padding:3}),q1:{padding,fill:blueGrey700},q1Labels:assign_1({},baseLabelStyles,{padding:3}),q3:{padding,fill:blueGrey700},q3Labels:assign_1({},baseLabelStyles,{padding:3})},boxWidth:20},baseProps$1),candlestick:assign_1({style:{data:{stroke:blueGrey700},labels:assign_1({},baseLabelStyles,{padding:5})},candleColors:{positive:"#ffffff",negative:blueGrey700}},baseProps$1),chart:baseProps$1,errorbar:assign_1({borderWidth:8,style:{data:{fill:"transparent",opacity:1,stroke:blueGrey700,strokeWidth:2},labels:baseLabelStyles}},baseProps$1),group:assign_1({colorScale:colors},baseProps$1),histogram:assign_1({style:{data:{fill:blueGrey700,stroke:grey900,strokeWidth:2},labels:baseLabelStyles}},baseProps$1),legend:{colorScale:colors,gutter:10,orientation:"vertical",titleOrientation:"top",style:{data:{type:"circle"},labels:baseLabelStyles,title:assign_1({},baseLabelStyles,{padding:5})}},line:assign_1({style:{data:{fill:"transparent",opacity:1,stroke:blueGrey700,strokeWidth:2},labels:baseLabelStyles}},baseProps$1),pie:assign_1({colorScale:colors,style:{data:{padding,stroke:blueGrey50,strokeWidth:1},labels:assign_1({},baseLabelStyles,{padding:20})}},baseProps$1),scatter:assign_1({style:{data:{fill:blueGrey700,opacity:1,stroke:"transparent",strokeWidth:0},labels:baseLabelStyles}},baseProps$1),stack:assign_1({colorScale:colors},baseProps$1),tooltip:{style:assign_1({},baseLabelStyles,{padding:0,pointerEvents:"none"}),flyoutStyle:{stroke:grey900,strokeWidth:1,fill:"#f0f0f0",pointerEvents:"none"},flyoutPadding:5,cornerRadius:5,pointerLength:10},voronoi:assign_1({style:{data:{fill:"transparent",stroke:"transparent",strokeWidth:0},labels:assign_1({},baseLabelStyles,{padding:5,pointerEvents:"none"}),flyout:{stroke:grey900,strokeWidth:1,fill:"#f0f0f0",pointerEvents:"none"}}},baseProps$1)},VictoryTheme={grayscale,material},dataProps={categories:propTypesExports.oneOfType([propTypesExports.arrayOf(propTypesExports.string),propTypesExports.shape({x:propTypesExports.arrayOf(propTypesExports.string),y:propTypesExports.arrayOf(propTypesExports.string)})]),data:propTypesExports.oneOfType([propTypesExports.array,propTypesExports.object]),dataComponent:propTypesExports.element,disableInlineStyles:propTypesExports.bool,labelComponent:propTypesExports.element,labels:propTypesExports.oneOfType([propTypesExports.func,propTypesExports.array]),samples:nonNegative,sortKey:propTypesExports.oneOfType([propTypesExports.func,allOfType([integer,nonNegative]),propTypesExports.string,propTypesExports.arrayOf(propTypesExports.string.isRequired)]),sortOrder:propTypesExports.oneOf(["ascending","descending"]),style:propTypesExports.shape({parent:propTypesExports.object,data:propTypesExports.object,labels:propTypesExports.object}),x:propTypesExports.oneOfType([propTypesExports.func,allOfType([integer,nonNegative]),propTypesExports.string,propTypesExports.arrayOf(propTypesExports.string.isRequired)]),y:propTypesExports.oneOfType([propTypesExports.func,allOfType([integer,nonNegative]),propTypesExports.string,propTypesExports.arrayOf(propTypesExports.string.isRequired)]),y0:propTypesExports.oneOfType([propTypesExports.func,allOfType([integer,nonNegative]),propTypesExports.string,propTypesExports.arrayOf(propTypesExports.string.isRequired)])},baseProps={animate:propTypesExports.oneOfType([propTypesExports.bool,propTypesExports.object]),containerComponent:propTypesExports.element,domain:propTypesExports.oneOfType([domain,propTypesExports.shape({x:domain,y:domain})]),maxDomain:propTypesExports.oneOfType([propTypesExports.number,propTypesExports.instanceOf(Date),propTypesExports.shape({x:propTypesExports.oneOfType([propTypesExports.number,propTypesExports.instanceOf(Date)]),y:propTypesExports.oneOfType([propTypesExports.number,propTypesExports.instanceOf(Date)])})]),minDomain:propTypesExports.oneOfType([propTypesExports.number,propTypesExports.instanceOf(Date),propTypesExports.shape({x:propTypesExports.oneOfType([propTypesExports.number,propTypesExports.instanceOf(Date)]),y:propTypesExports.oneOfType([propTypesExports.number,propTypesExports.instanceOf(Date)])})]),domainPadding:propTypesExports.oneOfType([propTypesExports.shape({x:propTypesExports.oneOfType([propTypesExports.number,propTypesExports.arrayOf(propTypesExports.number)]),y:propTypesExports.oneOfType([propTypesExports.number,propTypesExports.arrayOf(propTypesExports.number)])}),propTypesExports.number,propTypesExports.arrayOf(propTypesExports.number)]),eventKey:propTypesExports.oneOfType([propTypesExports.func,allOfType([integer,nonNegative]),propTypesExports.string]),events:propTypesExports.arrayOf(propTypesExports.shape({target:propTypesExports.oneOf(["data","labels","parent"]),eventKey:propTypesExports.oneOfType([propTypesExports.array,allOfType([integer,nonNegative]),propTypesExports.string]),eventHandlers:propTypesExports.object})),externalEventMutations:propTypesExports.arrayOf(propTypesExports.shape({callback:propTypesExports.func,childName:propTypesExports.oneOfType([propTypesExports.string,propTypesExports.array]),eventKey:propTypesExports.oneOfType([propTypesExports.array,allOfType([integer,nonNegative]),propTypesExports.string]),mutation:propTypesExports.func,target:propTypesExports.oneOfType([propTypesExports.string,propTypesExports.array])})),groupComponent:propTypesExports.element,height:nonNegative,name:propTypesExports.string,origin:propTypesExports.shape({x:propTypesExports.number,y:propTypesExports.number}),padding:propTypesExports.oneOfType([propTypesExports.number,propTypesExports.shape({top:propTypesExports.number,bottom:propTypesExports.number,left:propTypesExports.number,right:propTypesExports.number})]),polar:propTypesExports.bool,range:propTypesExports.oneOfType([domain,propTypesExports.shape({x:domain.isRequired,y:domain.isRequired})]),scale:propTypesExports.oneOfType([scale,propTypesExports.shape({x:scale.isRequired,y:scale.isRequired})]),sharedEvents:propTypesExports.shape({events:propTypesExports.array,getEventState:propTypesExports.func}),singleQuadrantDomainPadding:propTypesExports.oneOfType([propTypesExports.bool,propTypesExports.shape({x:propTypesExports.oneOfType([propTypesExports.bool]),y:propTypesExports.oneOfType([propTypesExports.bool])})]),standalone:propTypesExports.bool,theme:propTypesExports.object,width:nonNegative},primitiveProps={active:propTypesExports.bool,ariaLabel:propTypesExports.oneOfType([propTypesExports.string,propTypesExports.func]),className:propTypesExports.string,clipPath:propTypesExports.string,data:propTypesExports.oneOfType([propTypesExports.array,propTypesExports.object]),desc:propTypesExports.oneOfType([propTypesExports.string,propTypesExports.func]),disableInlineStyles:propTypesExports.bool,events:propTypesExports.object,id:propTypesExports.oneOfType([propTypesExports.number,propTypesExports.string,propTypesExports.func]),index:propTypesExports.oneOfType([propTypesExports.number,propTypesExports.string]),origin:propTypesExports.shape({x:propTypesExports.number,y:propTypesExports.number}),polar:propTypesExports.bool,role:propTypesExports.string,scale:propTypesExports.oneOfType([scale,propTypesExports.shape({x:scale,y:scale})]),shapeRendering:propTypesExports.string,style:propTypesExports.object,tabIndex:propTypesExports.oneOfType([propTypesExports.number,propTypesExports.func]),transform:propTypesExports.string},CommonProps={dataProps,baseProps,primitiveProps},_excluded$1=["desc"];function _objectWithoutProperties$1(h,i){if(h==null)return{};var g=_objectWithoutPropertiesLoose$1(h,i),_,j;if(Object.getOwnPropertySymbols){var $=Object.getOwnPropertySymbols(h);for(j=0;j<$.length;j++)_=$[j],!(i.indexOf(_)>=0)&&Object.prototype.propertyIsEnumerable.call(h,_)&&(g[_]=h[_])}return g}function _objectWithoutPropertiesLoose$1(h,i){if(h==null)return{};var g={},_=Object.keys(h),j,$;for($=0;$<_.length;$++)j=_[$],!(i.indexOf(j)>=0)&&(g[j]=h[j]);return g}var Path$1=function(h){var i=h.desc,g=_objectWithoutProperties$1(h,_excluded$1);return i?React.createElement("path",g,React.createElement("desc",null,i)):React.createElement("path",g)};function ownKeys$e(h,i){var g=Object.keys(h);if(Object.getOwnPropertySymbols){var _=Object.getOwnPropertySymbols(h);i&&(_=_.filter(function(j){return Object.getOwnPropertyDescriptor(h,j).enumerable})),g.push.apply(g,_)}return g}function _objectSpread$e(h){for(var i=1;i<arguments.length;i++){var g=arguments[i]!=null?arguments[i]:{};i%2?ownKeys$e(Object(g),!0).forEach(function(_){_defineProperty$g(h,_,g[_])}):Object.getOwnPropertyDescriptors?Object.defineProperties(h,Object.getOwnPropertyDescriptors(g)):ownKeys$e(Object(g)).forEach(function(_){Object.defineProperty(h,_,Object.getOwnPropertyDescriptor(g,_))})}return h}function _defineProperty$g(h,i,g){return i in h?Object.defineProperty(h,i,{value:g,enumerable:!0,configurable:!0,writable:!0}):h[i]=g,h}var getArcPath=function(h){var i=h.cx,g=h.cy,_=h.r,j=h.startAngle,$=h.endAngle,_n=h.closedPath,_i=Math.abs($-j)/2+j,_s=i+_*Math.cos(degreesToRadians(j)),ga=g-_*Math.sin(degreesToRadians(j)),ba=i+_*Math.cos(degreesToRadians(_i)),xa=g-_*Math.sin(degreesToRadians(_i)),El=i+_*Math.cos(degreesToRadians($)),Tl=g-_*Math.sin(degreesToRadians($)),Sl=_i-j<=180?0:1,Il=$-_i<=180?0:1,Cl=_n?" M ".concat(i,", ").concat(g," L ").concat(_s,", ").concat(ga):"M ".concat(_s,", ").concat(ga),Nl="A ".concat(_,", ").concat(_,", 0, ").concat(Sl,", 0, ").concat(ba,", ").concat(xa),Dl="A ".concat(_,", ").concat(_,", 0, ").concat(Il,", 0, ").concat(El,", ").concat(Tl),Ul=_n?"Z":"";return"".concat(Cl," ").concat(Nl," ").concat(Dl," ").concat(Ul)},evaluateProps$4=function(h){var i=evaluateProp(h.ariaLabel,h),g=evaluateProp(h.desc,h),_=evaluateProp(h.id,h),j=evaluateStyle(assign_1({stroke:"black",fill:"none"},h.style),h),$=evaluateProp(h.tabIndex,h);return assign_1({},h,{ariaLabel:i,desc:g,id:_,style:j,tabIndex:$})},Arc=function(h){return h=evaluateProps$4(h),React.cloneElement(h.pathComponent,_objectSpread$e(_objectSpread$e({},h.events),{},{"aria-label":h.ariaLabel,d:getArcPath(h),style:h.style,desc:h.desc,tabIndex:h.tabIndex,className:h.className,role:h.role,shapeRendering:h.shapeRendering,transform:h.transform,clipPath:h.clipPath}))};Arc.propTypes=_objectSpread$e(_objectSpread$e({},CommonProps.primitiveProps),{},{closedPath:propTypesExports.bool,cx:propTypesExports.number,cy:propTypesExports.number,datum:propTypesExports.any,endAngle:propTypesExports.number,pathComponent:propTypesExports.element,r:propTypesExports.number,startAngle:propTypesExports.number});Arc.defaultProps={pathComponent:React.createElement(Path$1,null),role:"presentation",shapeRendering:"auto"};function ownKeys$d(h,i){var g=Object.keys(h);if(Object.getOwnPropertySymbols){var _=Object.getOwnPropertySymbols(h);i&&(_=_.filter(function(j){return Object.getOwnPropertyDescriptor(h,j).enumerable})),g.push.apply(g,_)}return g}function _objectSpread$d(h){for(var i=1;i<arguments.length;i++){var g=arguments[i]!=null?arguments[i]:{};i%2?ownKeys$d(Object(g),!0).forEach(function(_){_defineProperty$f(h,_,g[_])}):Object.getOwnPropertyDescriptors?Object.defineProperties(h,Object.getOwnPropertyDescriptors(g)):ownKeys$d(Object(g)).forEach(function(_){Object.defineProperty(h,_,Object.getOwnPropertyDescriptor(g,_))})}return h}function _defineProperty$f(h,i,g){return i in h?Object.defineProperty(h,i,{value:g,enumerable:!0,configurable:!0,writable:!0}):h[i]=g,h}var evaluateProps$3=function(h){var i=evaluateProp(h.id,h);return assign_1({},h,{id:i})},Background=function(h){return h=evaluateProps$3(h),h.polar?React.cloneElement(h.circleComponent,_objectSpread$d(_objectSpread$d({},h.events),{},{style:h.style,role:h.role,shapeRendering:h.shapeRendering,cx:h.x,cy:h.y,r:h.height,className:h.className})):React.cloneElement(h.rectComponent,_objectSpread$d(_objectSpread$d({},h.events),{},{style:h.style,role:h.role,shapeRendering:h.shapeRendering,x:h.x,y:h.y,rx:h.rx,ry:h.ry,width:h.width,height:h.height,className:h.className}))};Background.propTypes=_objectSpread$d(_objectSpread$d({},CommonProps.primitiveProps),{},{circleComponent:propTypesExports.element,height:propTypesExports.number,rectComponent:propTypesExports.element,rx:propTypesExports.number,ry:propTypesExports.number,width:propTypesExports.number,x:propTypesExports.number,y:propTypesExports.number});Background.defaultProps={circleComponent:React.createElement(Circle,null),rectComponent:React.createElement(Rect,null),role:"presentation",shapeRendering:"auto"};var _excluded=["desc"];function _extends(){return _extends=Object.assign?Object.assign.bind():function(h){for(var i=1;i<arguments.length;i++){var g=arguments[i];for(var _ in g)Object.prototype.hasOwnProperty.call(g,_)&&(h[_]=g[_])}return h},_extends.apply(this,arguments)}function _objectWithoutProperties(h,i){if(h==null)return{};var g=_objectWithoutPropertiesLoose(h,i),_,j;if(Object.getOwnPropertySymbols){var $=Object.getOwnPropertySymbols(h);for(j=0;j<$.length;j++)_=$[j],!(i.indexOf(_)>=0)&&Object.prototype.propertyIsEnumerable.call(h,_)&&(g[_]=h[_])}return g}function _objectWithoutPropertiesLoose(h,i){if(h==null)return{};var g={},_=Object.keys(h),j,$;for($=0;$<_.length;$++)j=_[$],!(i.indexOf(j)>=0)&&(g[j]=h[j]);return g}var Line=function(h){var i=h.desc,g=_objectWithoutProperties(h,_excluded);return i?React.createElement("line",_extends({vectorEffect:"non-scaling-stroke"},g),React.createElement("desc",null,i)):React.createElement("line",_extends({vectorEffect:"non-scaling-stroke"},g))};function ownKeys$c(h,i){var g=Object.keys(h);if(Object.getOwnPropertySymbols){var _=Object.getOwnPropertySymbols(h);i&&(_=_.filter(function(j){return Object.getOwnPropertyDescriptor(h,j).enumerable})),g.push.apply(g,_)}return g}function _objectSpread$c(h){for(var i=1;i<arguments.length;i++){var g=arguments[i]!=null?arguments[i]:{};i%2?ownKeys$c(Object(g),!0).forEach(function(_){_defineProperty$e(h,_,g[_])}):Object.getOwnPropertyDescriptors?Object.defineProperties(h,Object.getOwnPropertyDescriptors(g)):ownKeys$c(Object(g)).forEach(function(_){Object.defineProperty(h,_,Object.getOwnPropertyDescriptor(g,_))})}return h}function _defineProperty$e(h,i,g){return i in h?Object.defineProperty(h,i,{value:g,enumerable:!0,configurable:!0,writable:!0}):h[i]=g,h}var evaluateProps$2=function(h){var i=evaluateProp(h.ariaLabel,h),g=evaluateProp(h.desc,h),_=evaluateProp(h.id,h),j=evaluateStyle(assign_1({stroke:"black"},h.style),h),$=evaluateProp(h.tabIndex,h);return assign_1({},h,{ariaLabel:i,desc:g,id:_,style:j,tabIndex:$})},LineSegment=function(h){return h=evaluateProps$2(h),React.cloneElement(h.lineComponent,_objectSpread$c(_objectSpread$c({},h.events),{},{"aria-label":h.ariaLabel,style:h.style,desc:h.desc,tabIndex:h.tabIndex,className:h.className,role:h.role,shapeRendering:h.shapeRendering,x1:h.x1,x2:h.x2,y1:h.y1,y2:h.y2,transform:h.transform,clipPath:h.clipPath}))};LineSegment.propTypes=_objectSpread$c(_objectSpread$c({},CommonProps.primitiveProps),{},{datum:propTypesExports.any,lineComponent:propTypesExports.element,x1:propTypesExports.number,x2:propTypesExports.number,y1:propTypesExports.number,y2:propTypesExports.number});LineSegment.defaultProps={lineComponent:React.createElement(Line,null),role:"presentation",shapeRendering:"auto"};var nativeCeil=Math.ceil,nativeMax=Math.max;function baseRange$1(h,i,g,_){for(var j=-1,$=nativeMax(nativeCeil((i-h)/(g||1)),0),_n=Array($);$--;)_n[_?$:++j]=h,h+=g;return _n}var _baseRange=baseRange$1,baseRange=_baseRange,isIterateeCall$1=_isIterateeCall,toFinite=toFinite_1;function createRange$1(h){return function(i,g,_){return _&&typeof _!="number"&&isIterateeCall$1(i,g,_)&&(g=_=void 0),i=toFinite(i),g===void 0?(g=i,i=0):g=toFinite(g),_=_===void 0?i<g?1:-1:toFinite(_),baseRange(i,g,_,h)}}var _createRange=createRange$1,createRange=_createRange,range=createRange(),range_1=range,baseIndexOf=_baseIndexOf;function arrayIncludes$2(h,i){var g=h==null?0:h.length;return!!g&&baseIndexOf(h,i,0)>-1}var _arrayIncludes=arrayIncludes$2;function arrayIncludesWith$2(h,i,g){for(var _=-1,j=h==null?0:h.length;++_<j;)if(g(i,h[_]))return!0;return!1}var _arrayIncludesWith=arrayIncludesWith$2,SetCache$1=_SetCache,arrayIncludes$1=_arrayIncludes,arrayIncludesWith$1=_arrayIncludesWith,arrayMap$1=_arrayMap,baseUnary$1=_baseUnary,cacheHas$1=_cacheHas,LARGE_ARRAY_SIZE$1=200;function baseDifference$2(h,i,g,_){var j=-1,$=arrayIncludes$1,_n=!0,_i=h.length,_s=[],ga=i.length;if(!_i)return _s;g&&(i=arrayMap$1(i,baseUnary$1(g))),_?($=arrayIncludesWith$1,_n=!1):i.length>=LARGE_ARRAY_SIZE$1&&($=cacheHas$1,_n=!1,i=new SetCache$1(i));e:for(;++j<_i;){var ba=h[j],xa=g==null?ba:g(ba);if(ba=_||ba!==0?ba:0,_n&&xa===xa){for(var El=ga;El--;)if(i[El]===xa)continue e;_s.push(ba)}else $(i,xa,_)||_s.push(ba)}return _s}var _baseDifference=baseDifference$2,isArrayLike=isArrayLike_1,isObjectLike$1=isObjectLike_1;function isArrayLikeObject$2(h){return isObjectLike$1(h)&&isArrayLike(h)}var isArrayLikeObject_1=isArrayLikeObject$2,baseDifference$1=_baseDifference,baseRest$1=_baseRest,isArrayLikeObject$1=isArrayLikeObject_1,without=baseRest$1(function(h,i){return isArrayLikeObject$1(h)?baseDifference$1(h,i):[]}),without_1=without,baseDifference=_baseDifference,baseFlatten=_baseFlatten,baseRest=_baseRest,isArrayLikeObject=isArrayLikeObject_1,difference=baseRest(function(h,i){return isArrayLikeObject(h)?baseDifference(h,baseFlatten(i,1,isArrayLikeObject,!0)):[]}),difference_1=difference;function noop$2(){}var noop_1=noop$2,Set$1=_Set,noop$1=noop_1,setToArray$1=_setToArray,INFINITY=1/0,createSet$1=Set$1&&1/setToArray$1(new Set$1([,-0]))[1]==INFINITY?function(h){return new Set$1(h)}:noop$1,_createSet=createSet$1,SetCache=_SetCache,arrayIncludes=_arrayIncludes,arrayIncludesWith=_arrayIncludesWith,cacheHas=_cacheHas,createSet=_createSet,setToArray=_setToArray,LARGE_ARRAY_SIZE=200;function baseUniq$2(h,i,g){var _=-1,j=arrayIncludes,$=h.length,_n=!0,_i=[],_s=_i;if(g)_n=!1,j=arrayIncludesWith;else if($>=LARGE_ARRAY_SIZE){var ga=i?null:createSet(h);if(ga)return setToArray(ga);_n=!1,j=cacheHas,_s=new SetCache}else _s=i?[]:_i;e:for(;++_<$;){var ba=h[_],xa=i?i(ba):ba;if(ba=g||ba!==0?ba:0,_n&&xa===xa){for(var El=_s.length;El--;)if(_s[El]===xa)continue e;i&&_s.push(xa),_i.push(ba)}else j(_s,xa,g)||(_s!==_i&&_s.push(xa),_i.push(ba))}return _i}var _baseUniq=baseUniq$2,baseUniq$1=_baseUniq;function uniq(h){return h&&h.length?baseUniq$1(h):[]}var uniq_1=uniq,FUNC_ERROR_TEXT="Expected a function";function negate$1(h){if(typeof h!="function")throw new TypeError(FUNC_ERROR_TEXT);return function(){var i=arguments;switch(i.length){case 0:return!h.call(this);case 1:return!h.call(this,i[0]);case 2:return!h.call(this,i[0],i[1]);case 3:return!h.call(this,i[0],i[1],i[2])}return!h.apply(this,i)}}var negate_1=negate$1,arrayPush=_arrayPush,getPrototype=_getPrototype,getSymbols=_getSymbols,stubArray=stubArray_1,nativeGetSymbols=Object.getOwnPropertySymbols,getSymbolsIn$1=nativeGetSymbols?function(h){for(var i=[];h;)arrayPush(i,getSymbols(h)),h=getPrototype(h);return i}:stubArray,_getSymbolsIn=getSymbolsIn$1,baseGetAllKeys=_baseGetAllKeys,getSymbolsIn=_getSymbolsIn,keysIn=keysIn_1;function getAllKeysIn$1(h){return baseGetAllKeys(h,keysIn,getSymbolsIn)}var _getAllKeysIn=getAllKeysIn$1,arrayMap=_arrayMap,baseIteratee$4=_baseIteratee,basePickBy=_basePickBy,getAllKeysIn=_getAllKeysIn;function pickBy$1(h,i){if(h==null)return{};var g=arrayMap(getAllKeysIn(h),function(_){return[_]});return i=baseIteratee$4(i),basePickBy(h,g,function(_,j){return i(_,j[0])})}var pickBy_1=pickBy$1,baseIteratee$3=_baseIteratee,negate=negate_1,pickBy=pickBy_1;function omitBy(h,i){return pickBy(h,negate(baseIteratee$3(i)))}var omitBy_1=omitBy;function _defineProperty$d(h,i,g){return i in h?Object.defineProperty(h,i,{value:g,enumerable:!0,configurable:!0,writable:!0}):h[i]=g,h}function _toConsumableArray$b(h){return _arrayWithoutHoles$b(h)||_iterableToArray$b(h)||_unsupportedIterableToArray$d(h)||_nonIterableSpread$b()}function _nonIterableSpread$b(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _unsupportedIterableToArray$d(h,i){if(h){if(typeof h=="string")return _arrayLikeToArray$d(h,i);var g=Object.prototype.toString.call(h).slice(8,-1);if(g==="Object"&&h.constructor&&(g=h.constructor.name),g==="Map"||g==="Set")return Array.from(h);if(g==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(g))return _arrayLikeToArray$d(h,i)}}function _iterableToArray$b(h){if(typeof Symbol<"u"&&h[Symbol.iterator]!=null||h["@@iterator"]!=null)return Array.from(h)}function _arrayWithoutHoles$b(h){if(Array.isArray(h))return _arrayLikeToArray$d(h)}function _arrayLikeToArray$d(h,i){(i==null||i>h.length)&&(i=h.length);for(var g=0,_=new Array(i);g<i;g++)_[g]=h[g];return _}var GLOBAL_EVENT_REGEX=/^onGlobal(.*)$/;function getEvents(h,i,g,_){var j=this,$=function(xa){var El=function(){var Sl=xa.reduce(function(Il,Cl){if(Cl.target!==void 0){var Nl=Array.isArray(Cl.target)?includes_1(Cl.target,i):"".concat(Cl.target)==="".concat(i);return Nl?Il.concat(Cl):Il}return Il.concat(Cl)},[]);return g!==void 0&&i!=="parent"?Sl.filter(function(Il){var Cl=Il.eventKey,Nl=function(Dl){return Dl?"".concat(Dl)==="".concat(g):!0};return Array.isArray(Cl)?Cl.some(function(Dl){return Nl(Dl)}):Nl(Cl)}):Sl},Tl=El();return Array.isArray(Tl)&&Tl.reduce(function(Sl,Il){return Il?assign_1(Sl,Il.eventHandlers):Sl},{})},_n=function(){if(Array.isArray(j.componentEvents)){var xa;return Array.isArray(h.events)?(xa=j.componentEvents).concat.apply(xa,_toConsumableArray$b(h.events)):j.componentEvents}return h.events},_i=_n(),_s=_i&&isFunction_1(_)?_($(_i),i):void 0;if(!h.sharedEvents)return _s;var ga=h.sharedEvents.getEvents,ba=h.sharedEvents.events&&ga($(h.sharedEvents.events),i);return assign_1({},ba,_s)}function getScopedEvents(h,i,g,_){var j=this;if(isEmpty_1(h))return{};_=_||this.baseProps;var $=function(ba,xa){var El=ba.childName,Tl=ba.target,Sl=ba.key,Il=xa==="props"?_:j.state||{},Cl=El==null||!Il[El]?Il:Il[El];return Sl==="parent"?Cl.parent:Cl[Sl]&&Cl[Sl][Tl]},_n=function(ba,xa){var El=i==="parent"?ba.childName:ba.childName||g,Tl=ba.target||i,Sl=function(Dl){return Tl==="parent"?"parent":ba.eventKey==="all"?_[Dl]?without_1(keys_1(_[Dl]),"parent"):without_1(keys_1(_),"parent"):ba.eventKey===void 0&&xa==="parent"?_[Dl]?keys_1(_[Dl]):keys_1(_):ba.eventKey!==void 0?ba.eventKey:xa},Il=function(Dl,Ul){var Kl=j.state||{};if(!isFunction_1(ba.mutation))return Kl;var Jl=$({childName:Ul,key:Dl,target:Tl},"props"),Ep=$({childName:Ul,key:Dl,target:Tl},"state"),_p=ba.mutation(assign_1({},Jl,Ep),_),Ip=Kl[Ul]||{},Up=function(Cp){return Cp[Dl]&&Cp[Dl][Tl]&&delete Cp[Dl][Tl],Cp[Dl]&&!keys_1(Cp[Dl]).length&&delete Cp[Dl],Cp},yp=function(Cp){return Tl==="parent"?assign_1(Cp,_defineProperty$d({},Dl,assign_1(Cp[Dl],_p))):assign_1(Cp,_defineProperty$d({},Dl,assign_1(Cp[Dl],_defineProperty$d({},Tl,_p))))},Ap=function(Cp){return _p?yp(Cp):Up(Cp)};return Ul!=null?assign_1(Kl,_defineProperty$d({},Ul,Ap(Ip))):Ap(Kl)},Cl=function(Dl){var Ul=Sl(Dl);return Array.isArray(Ul)?Ul.reduce(function(Kl,Jl){return assign_1(Kl,Il(Jl,Dl))},{}):Il(Ul,Dl)},Nl=El==="all"?without_1(keys_1(_),"parent"):El;return Array.isArray(Nl)?Nl.reduce(function(Dl,Ul){return assign_1(Dl,Cl(Ul))},{}):Cl(Nl)},_i=function(ba,xa){return Array.isArray(ba)?ba.reduce(function(El,Tl){return El=assign_1({},El,_n(Tl,xa)),El},{}):_n(ba,xa)},_s=function(ba){var xa=function(Sl){return isFunction_1(Sl.callback)&&Sl.callback},El=Array.isArray(ba)?ba.map(function(Sl){return xa(Sl)}):[xa(ba)],Tl=El.filter(function(Sl){return Sl!==!1});return Tl.length?function(){return Tl.forEach(function(Sl){return Sl()})}:void 0},ga=function(ba,xa,El,Tl){var Sl=h[Tl](ba,xa,El,j);if(!isEmpty_1(Sl)){var Il=_s(Sl);j.setState(_i(Sl,El),Il)}};return keys_1(h).reduce(function(ba,xa){return ba[xa]=ga,ba},{})}function getPartialEvents(h,i,g){return h?keys_1(h).reduce(function(_,j){var $=function(_n){return h[j](_n,g,i,j)};return _[j]=$,_},{}):{}}function getEventState(h,i,g){var _=this.state||{};return g?_[g]&&_[g][h]&&_[g][h][i]:h==="parent"?_[h]&&_[h][i]||_[h]:_[h]&&_[h][i]}function getExternalMutationsWithChildren(h,i,g,_){return i=i||{},g=g||{},_.reduce(function(j,$){var _n=g[$],_i=getExternalMutations(h,i[$],g[$],$);return j[$]=_i||_n,pickBy_1(j,function(_s){return!isEmpty_1(_s)})},{})}function getExternalMutations(h,i,g,_){i=i||{},g=g||{};var j=keys_1(i);return j.reduce(function($,_n){var _i=g[_n]||{},_s=i[_n]||{};if(_n==="parent"){var ga={eventKey:_n,target:"parent"},ba=getExternalMutation(h,_s,_i,ga);$[_n]=ba!==void 0?assign_1({},_i,ba):_i}else{var xa=uniq_1(keys_1(_s).concat(keys_1(_i)));$[_n]=xa.reduce(function(El,Tl){var Sl={eventKey:_n,target:Tl,childName:_},Il=getExternalMutation(h,_s[Tl],_i[Tl],Sl);return El[Tl]=Il!==void 0?assign_1({},_i[Tl],Il):_i[Tl],pickBy_1(El,function(Cl){return!isEmpty_1(Cl)})},{})}return pickBy_1($,function(El){return!isEmpty_1(El)})},{})}function getExternalMutation(h,i,g,_){var j=function(_s,ga){if(typeof _s[ga]=="string")return _s[ga]==="all"||_s[ga]===_[ga];if(Array.isArray(_s[ga])){var ba=_s[ga].map(function(xa){return"".concat(xa)});return includes_1(ba,_[ga])}return!1};h=Array.isArray(h)?h:[h];var $=h;_.childName&&($=h.filter(function(_s){return j(_s,"childName")}));var _n=$.filter(function(_s){return j(_s,"target")});if(!isEmpty_1(_n)){var _i=_n.filter(function(_s){return j(_s,"eventKey")});if(!isEmpty_1(_i))return _i.reduce(function(_s,ga){var ba=ga&&isFunction_1(ga.mutation)?ga.mutation:function(){},xa=ba(assign_1({},i,g));return assign_1({},_s,xa)},{})}}function getComponentEvents(h,i){var g=Array.isArray(i)&&i.reduce(function(_,j){var $,_n=h[j],_i=_n&&_n.type&&_n.type.defaultEvents,_s=isFunction_1(_i)?_i(_n.props):_i;return _=Array.isArray(_s)?($=_).concat.apply($,_toConsumableArray$b(_s)):_,_},[]);return g&&g.length?g:void 0}function getGlobalEventNameFromKey(h){var i=h.match(GLOBAL_EVENT_REGEX);return i&&i[1]&&i[1].toLowerCase()}var getGlobalEvents=function(h){return pickBy_1(h,function(i,g){return GLOBAL_EVENT_REGEX.test(g)})},omitGlobalEvents=function(h){return omitBy_1(h,function(i,g){return GLOBAL_EVENT_REGEX.test(g)})},emulateReactEvent=function(h){return assign_1(h,{nativeEvent:h})};function _toConsumableArray$a(h){return _arrayWithoutHoles$a(h)||_iterableToArray$a(h)||_unsupportedIterableToArray$c(h)||_nonIterableSpread$a()}function _nonIterableSpread$a(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _unsupportedIterableToArray$c(h,i){if(h){if(typeof h=="string")return _arrayLikeToArray$c(h,i);var g=Object.prototype.toString.call(h).slice(8,-1);if(g==="Object"&&h.constructor&&(g=h.constructor.name),g==="Map"||g==="Set")return Array.from(h);if(g==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(g))return _arrayLikeToArray$c(h,i)}}function _iterableToArray$a(h){if(typeof Symbol<"u"&&h[Symbol.iterator]!=null||h["@@iterator"]!=null)return Array.from(h)}function _arrayWithoutHoles$a(h){if(Array.isArray(h))return _arrayLikeToArray$c(h)}function _arrayLikeToArray$c(h,i){(i==null||i>h.length)&&(i=h.length);for(var g=0,_=new Array(i);g<i;g++)_[g]=h[g];return _}function _classCallCheck$5(h,i){if(!(h instanceof i))throw new TypeError("Cannot call a class as a function")}function _defineProperties$5(h,i){for(var g=0;g<i.length;g++){var _=i[g];_.enumerable=_.enumerable||!1,_.configurable=!0,"value"in _&&(_.writable=!0),Object.defineProperty(h,_.key,_)}}function _createClass$5(h,i,g){return i&&_defineProperties$5(h.prototype,i),g&&_defineProperties$5(h,g),Object.defineProperty(h,"prototype",{writable:!1}),h}function _inherits$5(h,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");h.prototype=Object.create(i&&i.prototype,{constructor:{value:h,writable:!0,configurable:!0}}),Object.defineProperty(h,"prototype",{writable:!1}),i&&_setPrototypeOf$5(h,i)}function _setPrototypeOf$5(h,i){return _setPrototypeOf$5=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(_,j){return _.__proto__=j,_},_setPrototypeOf$5(h,i)}function _createSuper$5(h){var i=_isNativeReflectConstruct$5();return function(){var _=_getPrototypeOf$5(h),j;if(i){var $=_getPrototypeOf$5(this).constructor;j=Reflect.construct(_,arguments,$)}else j=_.apply(this,arguments);return _possibleConstructorReturn$5(this,j)}}function _possibleConstructorReturn$5(h,i){if(i&&(typeof i=="object"||typeof i=="function"))return i;if(i!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$5(h)}function _assertThisInitialized$5(h){if(h===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return h}function _isNativeReflectConstruct$5(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function _getPrototypeOf$5(h){return _getPrototypeOf$5=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(g){return g.__proto__||Object.getPrototypeOf(g)},_getPrototypeOf$5(h)}var datumHasXandY=function(h){return!isNil_1(h._x)&&!isNil_1(h._y)},defaultComponents=[{name:"parent",index:"parent"},{name:"data"},{name:"labels"}];function addEvents(h){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},g=function(_){_inherits$5($,_);var j=_createSuper$5($);function $(_n){var _i;return _classCallCheck$5(this,$),_i=j.call(this,_n),_i.state={},_i.getEventState=getEventState.bind(_assertThisInitialized$5(_i)),_i.getScopedEvents=getScopedEvents.bind(_assertThisInitialized$5(_i)),_i.getEvents=function(_s,ga,ba){return getEvents.call(_assertThisInitialized$5(_i),_s,ga,ba,_i.getScopedEvents)},_i.externalMutations=_i.getExternalMutations(_i.props),_i.calculatedState=_i.getStateChanges(_i.props),_i.globalEvents={},_i.prevGlobalEventKeys=[],_i.boundGlobalEvents={},_i.cacheValues(_i.getCalculatedValues(_n)),_i}return _createClass$5($,[{key:"shouldComponentUpdate",value:function(_i){var _s=this.getExternalMutations(_i),ga=this.props.animating||this.props.animate,ba=!reactFastCompare(_s,this.externalMutations);if(ga||ba)return this.cacheValues(this.getCalculatedValues(_i)),this.externalMutations=_s,this.applyExternalMutations(_i,_s),!0;var xa=this.getStateChanges(_i);return reactFastCompare(this.calculatedState,xa)?reactFastCompare(this.props,_i)?!1:(this.cacheValues(this.getCalculatedValues(_i)),!0):(this.cacheValues(this.getCalculatedValues(_i)),!0)}},{key:"componentDidMount",value:function(){var _i=this,_s=keys_1(this.globalEvents);_s.forEach(function(ga){return _i.addGlobalListener(ga)}),this.prevGlobalEventKeys=_s}},{key:"componentDidUpdate",value:function(_i){var _s=this,ga=this.getStateChanges(_i);this.calculatedState=ga;var ba=keys_1(this.globalEvents),xa=difference_1(this.prevGlobalEventKeys,ba);xa.forEach(function(Tl){return _s.removeGlobalListener(Tl)});var El=difference_1(ba,this.prevGlobalEventKeys);El.forEach(function(Tl){return _s.addGlobalListener(Tl)}),this.prevGlobalEventKeys=ba}},{key:"componentWillUnmount",value:function(){var _i=this;this.prevGlobalEventKeys.forEach(function(_s){return _i.removeGlobalListener(_s)})}},{key:"addGlobalListener",value:function(_i){var _s=this,ga=function(ba){var xa=_s.globalEvents[_i];return xa&&xa(emulateReactEvent(ba))};this.boundGlobalEvents[_i]=ga,window.addEventListener(getGlobalEventNameFromKey(_i),ga)}},{key:"removeGlobalListener",value:function(_i){window.removeEventListener(getGlobalEventNameFromKey(_i),this.boundGlobalEvents[_i])}},{key:"getStateChanges",value:function(_i){var _s=this;if(!this.hasEvents)return{};var ga=function(El,Tl){var Sl=defaults_1({},_s.getEventState(El,Tl),_s.getSharedEventState(El,Tl));return isEmpty_1(Sl)?void 0:Sl},ba=i.components||defaultComponents,xa=ba.map(function(El){if(!(!_i.standalone&&El.name==="parent"))return El.index!==void 0?ga(El.index,El.name):_s.dataKeys.map(function(Tl){return ga(Tl,El.name)}).filter(Boolean)}).filter(Boolean);return xa}},{key:"applyExternalMutations",value:function(_i,_s){if(!isEmpty_1(_s)){var ga=_i.externalEventMutations.reduce(function(xa,El){return xa=isFunction_1(El.callback)?xa.concat(El.callback):xa,xa},[]),ba=ga.length?function(){ga.forEach(function(xa){return xa()})}:void 0;this.setState(_s,ba)}}},{key:"getCalculatedValues",value:function(_i){var _s=_i.sharedEvents,ga=h.expectedComponents,ba=getComponentEvents(_i,ga),xa=_s&&isFunction_1(_s.getEventState)?_s.getEventState:function(){},El=this.getBaseProps(_i,xa),Tl=keys_1(El).filter(function(Cl){return Cl!=="parent"}),Sl=_i.events||_i.sharedEvents||ba,Il=this.getAllEvents(_i);return{componentEvents:ba,getSharedEventState:xa,baseProps:El,dataKeys:Tl,hasEvents:Sl,events:Il}}},{key:"getExternalMutations",value:function(_i){var _s=_i.sharedEvents,ga=_i.externalEventMutations;return isEmpty_1(ga)||_s?void 0:getExternalMutations(ga,this.baseProps,this.state)}},{key:"cacheValues",value:function(_i){var _s=this;keys_1(_i).forEach(function(ga){_s[ga]=_i[ga]})}},{key:"getBaseProps",value:function(_i,_s){_s=_s||this.getSharedEventState.bind(this);var ga=_s("parent","parent"),ba=this.getEventState("parent","parent"),xa=defaults_1({},ba,ga),El=xa.parentControlledProps,Tl=El?pick_1(xa,El):{},Sl=defaults_1({},Tl,_i);return typeof h.getBaseProps=="function"?h.getBaseProps(Sl):{}}},{key:"getAllEvents",value:function(_i){if(Array.isArray(this.componentEvents)){var _s;return Array.isArray(_i.events)?(_s=this.componentEvents).concat.apply(_s,_toConsumableArray$a(_i.events)):this.componentEvents}return _i.events}},{key:"getComponentProps",value:function(_i,_s,ga){var ba=this.props.name||h.role,xa=this.dataKeys&&this.dataKeys[ga]||ga,El="".concat(ba,"-").concat(_s,"-").concat(xa),Tl=this.baseProps[xa]&&this.baseProps[xa][_s]||this.baseProps[xa];if(!(!Tl&&!this.hasEvents)){if(this.hasEvents){var Sl=this.getEvents(this.props,_s,xa),Il=defaults_1({index:ga,key:El},this.getEventState(xa,_s),this.getSharedEventState(xa,_s),_i.props,Tl,{id:El}),Cl=defaults_1({},getPartialEvents(Sl,xa,Il),Il.events);return assign_1({},Il,{events:Cl})}return defaults_1({index:ga,key:El},_i.props,Tl,{id:El})}}},{key:"renderContainer",value:function(_i,_s){var ga=_i.type&&_i.type.role==="container",ba=ga?this.getComponentProps(_i,"parent","parent"):{};return ba.events&&(this.globalEvents=getGlobalEvents(ba.events),ba.events=omitGlobalEvents(ba.events)),React.cloneElement(_i,ba,_s)}},{key:"animateComponent",value:function(_i,_s){var ga,ba=typeof _i.animate=="object"&&((ga=_i.animate)===null||ga===void 0?void 0:ga.animationWhitelist)||_s,xa=this.constructor;return React.createElement(VictoryTransition,{animate:_i.animate,animationWhitelist:ba},React.createElement(xa,_i))}},{key:"renderContinuousData",value:function(_i){var _s=this,ga=_i.dataComponent,ba=_i.labelComponent,xa=_i.groupComponent,El=without_1(this.dataKeys,"all"),Tl=El.reduce(function(Cl,Nl){var Dl=_s.getComponentProps(ba,"labels",Nl);return Dl&&Dl.text!==void 0&&Dl.text!==null&&(Cl=Cl.concat(React.cloneElement(ba,Dl))),Cl},[]),Sl=this.getComponentProps(ga,"data","all"),Il=[React.cloneElement(ga,Sl)].concat(_toConsumableArray$a(Tl));return this.renderContainer(xa,Il)}},{key:"renderData",value:function(_i){var _s=this,ga=arguments.length>1&&arguments[1]!==void 0?arguments[1]:datumHasXandY,ba=_i.dataComponent,xa=_i.labelComponent,El=_i.groupComponent,Tl=this.dataKeys.reduce(function(Cl,Nl,Dl){var Ul=_s.getComponentProps(ba,"data",Dl);return ga(Ul.datum)&&Cl.push(React.cloneElement(ba,Ul)),Cl},[]),Sl=this.dataKeys.map(function(Cl,Nl){var Dl=_s.getComponentProps(xa,"labels",Nl);if(Dl.text!==void 0&&Dl.text!==null)return React.cloneElement(xa,Dl)}).filter(Boolean),Il=[].concat(_toConsumableArray$a(Tl),_toConsumableArray$a(Sl));return this.renderContainer(El,Il)}}]),$}(h);return g}var baseForOwn=_baseForOwn;function baseInverter$1(h,i,g,_){return baseForOwn(h,function(j,$,_n){i(_,g(j),$,_n)}),_}var _baseInverter=baseInverter$1,baseInverter=_baseInverter;function createInverter$1(h,i){return function(g,_){return baseInverter(g,h,i(_),{})}}var _createInverter=createInverter$1,constant$1=constant_1,createInverter=_createInverter,identity$1=identity_1,objectProto$1=Object.prototype,nativeObjectToString=objectProto$1.toString,invert=createInverter(function(h,i,g){i!=null&&typeof i.toString!="function"&&(i=nativeObjectToString.call(i)),h[i]=g},constant$1(identity$1)),invert_1=invert,baseGetTag=_baseGetTag,isObjectLike=isObjectLike_1,dateTag="[object Date]";function baseIsDate$1(h){return isObjectLike(h)&&baseGetTag(h)==dateTag}var _baseIsDate=baseIsDate$1,baseIsDate=_baseIsDate,baseUnary=_baseUnary,nodeUtil=_nodeUtilExports,nodeIsDate=nodeUtil&&nodeUtil.isDate,isDate=nodeIsDate?baseUnary(nodeIsDate):baseIsDate,isDate_1=isDate,eq=eq_1;function baseSortedUniq$1(h,i){for(var g=-1,_=h.length,j=0,$=[];++g<_;){var _n=h[g],_i=i?i(_n):_n;if(!g||!eq(_i,_s)){var _s=_i;$[j++]=_n===0?0:_n}}return $}var _baseSortedUniq=baseSortedUniq$1,baseSortedUniq=_baseSortedUniq;function sortedUniq(h){return h&&h.length?baseSortedUniq(h):[]}var sortedUniq_1=sortedUniq;function isUndefined(h){return h===void 0}var isUndefined_1=isUndefined,baseIsEqual=_baseIsEqual;function isEqual(h,i){return baseIsEqual(h,i)}var isEqual_1=isEqual;function last(h){var i=h==null?0:h.length;return i?h[i-1]:void 0}var last_1=last,IMMUTABLE_ITERABLE="@@__IMMUTABLE_ITERABLE__@@",IMMUTABLE_RECORD="@@__IMMUTABLE_RECORD__@@",IMMUTABLE_LIST="@@__IMMUTABLE_LIST__@@";function isIterable(h){return!!(h&&h[IMMUTABLE_ITERABLE])}function isRecord(h){return!!(h&&h[IMMUTABLE_RECORD])}function isImmutable(h){return isIterable(h)||isRecord(h)}function isList(h){return!!(h&&h[IMMUTABLE_LIST])}function shallowToJS(h,i){return isIterable(h)?h.reduce(function(g,_,j){return i&&i[j]&&(_=shallowToJS(_)),g[j]=_,g},isList(h)?[]:{}):h}function _toConsumableArray$9(h){return _arrayWithoutHoles$9(h)||_iterableToArray$9(h)||_unsupportedIterableToArray$b(h)||_nonIterableSpread$9()}function _nonIterableSpread$9(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _unsupportedIterableToArray$b(h,i){if(h){if(typeof h=="string")return _arrayLikeToArray$b(h,i);var g=Object.prototype.toString.call(h).slice(8,-1);if(g==="Object"&&h.constructor&&(g=h.constructor.name),g==="Map"||g==="Set")return Array.from(h);if(g==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(g))return _arrayLikeToArray$b(h,i)}}function _iterableToArray$9(h){if(typeof Symbol<"u"&&h[Symbol.iterator]!=null||h["@@iterator"]!=null)return Array.from(h)}function _arrayWithoutHoles$9(h){if(Array.isArray(h))return _arrayLikeToArray$b(h)}function _arrayLikeToArray$b(h,i){(i==null||i>h.length)&&(i=h.length);for(var g=0,_=new Array(i);g<i;g++)_[g]=h[g];return _}function parseDatum(h){var i={errorX:!0,errorY:!0};return isImmutable(h)?shallowToJS(h,i):h}function getLength(h){return isIterable(h)?h.size:h.length}function generateDataArray(h,i){var g=isPlainObject_1(h.domain)?h.domain[i]:h.domain,_=g||getBaseScale(h,i).domain(),j=h.samples||1,$=Math.max.apply(Math,_toConsumableArray$9(_)),_n=Math.min.apply(Math,_toConsumableArray$9(_)),_i=($-_n)/j,_s=range_1(_n,$,_i);return last_1(_s)===$?_s:_s.concat($)}function sortData(h,i){var g=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"ascending";if(!i)return h;(i==="x"||i==="y")&&(i="_".concat(i));var _=g==="ascending"?"asc":"desc";return orderBy_1(h,i,_)}function cleanData(h,i){var g=1/Number.MAX_SAFE_INTEGER,_={x:getScaleType(i,"x"),y:getScaleType(i,"y")};if(_.x!=="log"&&_.y!=="log")return h;var j=function(_n,_i){return _[_i]==="log"?_n["_".concat(_i)]!==0:!0},$=function(_n){var _i=j(_n,"x")?_n._x:g,_s=j(_n,"y")?_n._y:g,ga=j(_n,"y0")?_n._y0:g;return assign_1({},_n,{_x:_i,_y:_s,_y0:ga})};return h.map(function(_n){return j(_n,"x")&&j(_n,"y")&&j(_n,"y0")?_n:$(_n)})}function getEventKey(h){return isFunction_1(h)?h:h==null?function(){}:property_1(h)}function addEventKeys(h,i){var g=!!h.eventKey,_=getEventKey(h.eventKey);return i.map(function(j,$){if(j.eventKey!==void 0)return j;if(g){var _n=_(j,$);return _n!==void 0?assign_1({eventKey:_n},j):j}return j})}function formatDataFromDomain(h,i,g){var _=function(Sl){return Sl!==void 0},j=getMinValue(i.x),$=getMaxValue(i.x),_n=getMinValue(i.y),_i=getMaxValue(i.y),_s=function(Sl){return function(Il){return _(Il)&&Il<Sl}},ga=function(Sl){return function(Il){return _(Il)&&Il>Sl}},ba=_s(j),xa=_s(_n),El=ga($),Tl=ga(_i);return h.map(function(Sl){var Il=Sl._x,Cl=Sl._y,Nl=Sl._y0,Dl=Sl._y1;(ba(Il)||El(Il))&&(Il=null);var Ul=_(Nl)?Nl:g,Kl=_(Dl)?Dl:Cl;return _(Kl)?(!_(Ul)&&(xa(Kl)||Tl(Kl))&&(Cl=null),(xa(Ul)&&xa(Kl)||Tl(Ul)&&Tl(Kl))&&(Cl=Nl=Dl=null),xa(Ul)&&!xa(Kl)&&(Nl=_n),Tl(Ul)&&!Tl(Kl)&&(Nl=_i),assign_1({},Sl,omitBy_1({_x:Il,_y:Cl,_y0:Nl,_y1:Dl},isUndefined_1))):Sl})}function createStringMap$1(h,i){var g=getStringsFromAxes(h,i),_=getStringsFromCategories$1(h,i),j=getStringsFromData$1(h,i),$=uniq_1([].concat(_toConsumableArray$9(g),_toConsumableArray$9(_),_toConsumableArray$9(j)));return $.length===0?null:$.reduce(function(_n,_i,_s){return _n[_i]=_s+1,_n},{})}function formatData(h,i,g){var _=Array.isArray(h)||isIterable(h);if(!_||getLength(h)<1)return[];var j=["x","y","y0"];g=Array.isArray(g)?g:j;var $=function(El){return createAccessor(i[El]!==void 0?i[El]:El)},_n=g.reduce(function(El,Tl){return El[Tl]=$(Tl),El},{}),_i=isEqual_1(g,j)&&i.x==="_x"&&i.y==="_y"&&i.y0==="_y0",_s;_i===!1&&(_s={x:g.indexOf("x")!==-1?createStringMap$1(i,"x"):void 0,y:g.indexOf("y")!==-1?createStringMap$1(i,"y"):void 0,y0:g.indexOf("y0")!==-1?createStringMap$1(i,"y"):void 0});var ga=_i?h:h.reduce(function(El,Tl,Sl){Tl=parseDatum(Tl);var Il={x:Sl,y:Tl},Cl=g.reduce(function(Dl,Ul){var Kl=_n[Ul](Tl),Jl=Kl!==void 0?Kl:Il[Ul];return Jl!==void 0&&(typeof Jl=="string"&&_s[Ul]?(Dl["".concat(Ul,"Name")]=Jl,Dl["_".concat(Ul)]=_s[Ul][Jl]):Dl["_".concat(Ul)]=Jl),Dl},{}),Nl=assign_1({},Cl,Tl);return isEmpty_1(Nl)||El.push(Nl),El},[]),ba=sortData(ga,i.sortKey,i.sortOrder),xa=cleanData(ba,i);return addEventKeys(i,xa)}function generateData(h){var i=generateDataArray(h,"x"),g=generateDataArray(h,"y"),_=i.map(function(j,$){return{x:j,y:g[$]}});return _}function getCategories$1(h,i){return h.categories&&!Array.isArray(h.categories)?h.categories[i]:h.categories}function getData(h){return h.data?formatData(h.data,h):formatData(generateData(h),h)}function getStringsFromAxes(h,i){var g=h.tickValues,_=h.tickFormat,j;return!g||!Array.isArray(g)&&!g[i]?j=_&&Array.isArray(_)?_:[]:j=g[i]||g,j.filter(function($){return typeof $=="string"})}function getStringsFromCategories$1(h,i){if(!h.categories)return[];var g=getCategories$1(h,i),_=g&&g.filter(function(j){return typeof j=="string"});return _?removeUndefined(_):[]}function getStringsFromData$1(h,i){var g=Array.isArray(h.data)||isIterable(h.data);if(!g)return[];var _=h[i]===void 0?i:h[i],j=createAccessor(_),$=h.data.reduce(function(_s,ga){return _s.push(parseDatum(ga)),_s},[]),_n=sortData($,h.sortKey,h.sortOrder),_i=_n.reduce(function(_s,ga){return ga=parseDatum(ga),_s.push(j(ga)),_s},[]).filter(function(_s){return typeof _s=="string"});return _i.reduce(function(_s,ga){return ga!=null&&_s.indexOf(ga)===-1&&_s.push(ga),_s},[])}function isDataComponent(h){var i=function($){return $&&$.type?$.type.role:""},g=i(h);if(g==="portal"){var _=React.Children.toArray(h.props.children);g=_.length?i(_[0]):""}var j=["area","bar","boxplot","candlestick","errorbar","group","histogram","line","pie","scatter","stack","voronoi"];return includes_1(j,g)}function _toConsumableArray$8(h){return _arrayWithoutHoles$8(h)||_iterableToArray$8(h)||_unsupportedIterableToArray$a(h)||_nonIterableSpread$8()}function _nonIterableSpread$8(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _unsupportedIterableToArray$a(h,i){if(h){if(typeof h=="string")return _arrayLikeToArray$a(h,i);var g=Object.prototype.toString.call(h).slice(8,-1);if(g==="Object"&&h.constructor&&(g=h.constructor.name),g==="Map"||g==="Set")return Array.from(h);if(g==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(g))return _arrayLikeToArray$a(h,i)}}function _iterableToArray$8(h){if(typeof Symbol<"u"&&h[Symbol.iterator]!=null||h["@@iterator"]!=null)return Array.from(h)}function _arrayWithoutHoles$8(h){if(Array.isArray(h))return _arrayLikeToArray$a(h)}function _arrayLikeToArray$a(h,i){(i==null||i>h.length)&&(i=h.length);for(var g=0,_=new Array(i);g<i;g++)_[g]=h[g];return _}function cleanDomain(h,i,g){var _=getScaleType(i,g);if(_!=="log")return h;var j=function($){var _n=$[0]<0||$[1]<0?-1/Number.MAX_SAFE_INTEGER:1/Number.MAX_SAFE_INTEGER,_i=$[0]===0?_n:$[0],_s=$[1]===0?_n:$[1];return[_i,_s]};return j(h)}function getDomainPadding(h,i){var g=function(_){return Array.isArray(_)?{left:_[0],right:_[1]}:{left:_,right:_}};return isPlainObject_1(h.domainPadding)?g(h.domainPadding[i]):g(h.domainPadding)}function getFlatData(h,i){var g="_".concat(i);return flatten_1(h).map(function(_){return _[g]&&_[g][1]!==void 0?_[g][1]:_[g]})}function getExtremeFromData(h,i){var g=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"min",_=function(_i){return g==="max"?Math.max.apply(Math,_toConsumableArray$8(_i)):Math.min.apply(Math,_toConsumableArray$8(_i))},j=g==="max"?-1/0:1/0,$=!1,_n=flatten_1(h).reduce(function(_i,_s){var ga=_s["_".concat(i,"0")]!==void 0?_s["_".concat(i,"0")]:_s["_".concat(i)],ba=_s["_".concat(i,"1")]!==void 0?_s["_".concat(i,"1")]:_s["_".concat(i)],xa=_([ga,ba]);return $=$||ga instanceof Date||ba instanceof Date,_([_i,xa])},j);return $?new Date(_n):_n}function padDomain(h,i,g){if(!i.domainPadding)return h;var _=getMinFromProps(i,g),j=getMaxFromProps(i,g),$=getDomainPadding(i,g);if(!$.left&&!$.right)return h;var _n=getMinValue(h),_i=getMaxValue(h),_s=getCurrentAxis$1(g,i.horizontal),ga=getRange$1(i,_s),ba=Math.abs(ga[0]-ga[1]),xa=Math.max(ba-$.left-$.right,1),El=Math.abs(_i.valueOf()-_n.valueOf())/xa*ba,Tl={left:El*$.left/ba,right:El*$.right/ba},Sl={min:_n.valueOf()-Tl.left,max:_i.valueOf()+Tl.right},Il=isPlainObject_1(i.singleQuadrantDomainPadding)?i.singleQuadrantDomainPadding[g]:i.singleQuadrantDomainPadding,Cl=_n>=0&&Sl.min<=0||_i<=0&&Sl.max>=0,Nl=function(Ep,_p){var Ip=_p==="min"&&_n>=0&&Ep<=0||_p==="max"&&_i<=0&&Ep>=0;return Ip?0:Ep};if(Cl&&Il!==!1){var Dl={left:Math.abs(_i-_n)*$.left/ba,right:Math.abs(_i-_n)*$.right/ba},Ul={min:Nl(_n.valueOf()-Dl.left,"min"),max:Nl(_i.valueOf()+Dl.right,"max")},Kl={left:Math.abs(Ul.max-Ul.min)*$.left/ba,right:Math.abs(Ul.max-Ul.min)*$.right/ba};Sl={min:Nl(_n.valueOf()-Kl.left,"min"),max:Nl(_i.valueOf()+Kl.right,"max")}}var Jl={min:_!==void 0?_:Sl.min,max:j!==void 0?j:Sl.max};return _n instanceof Date||_i instanceof Date?getDomainFromMinMax(new Date(Jl.min),new Date(Jl.max)):getDomainFromMinMax(Jl.min,Jl.max)}function createDomainFunction(h,i){return h=isFunction_1(h)?h:getDomainFromData$1,i=isFunction_1(i)?i:formatDomain,function(g,_){var j=getDomainFromProps(g,_);if(j)return i(j,g,_);var $=getCategories$1(g,_),_n=$?getDomainFromCategories(g,_,$):h(g,_);return _n?i(_n,g,_):void 0}}function formatDomain(h,i,g){return cleanDomain(padDomain(h,i,g),i,g)}function getDomain$3(h,i){return createDomainFunction()(h,i)}function getDomainFromCategories(h,i,g){g=g||getCategories$1(h,i);var _=h.polar,j=h.startAngle,$=j===void 0?0:j,_n=h.endAngle,_i=_n===void 0?360:_n;if(g){var _s=getMinFromProps(h,i),ga=getMaxFromProps(h,i),ba=containsStrings(g)?getStringsFromCategories$1(h,i):[],xa=ba.length===0?null:ba.reduce(function(Cl,Nl,Dl){return Cl[Nl]=Dl+1,Cl},{}),El=xa?g.map(function(Cl){return xa[Cl]}):g,Tl=_s!==void 0?_s:getMinValue(El),Sl=ga!==void 0?ga:getMaxValue(El),Il=getDomainFromMinMax(Tl,Sl);return _&&i==="x"&&Math.abs($-_i)===360?getSymmetricDomain(Il,El):Il}}function getDomainFromData$1(h,i,g){g=g||getData(h);var _=h.polar,j=h.startAngle,$=j===void 0?0:j,_n=h.endAngle,_i=_n===void 0?360:_n,_s=getMinFromProps(h,i),ga=getMaxFromProps(h,i);if(g.length<1)return _s!==void 0&&ga!==void 0?getDomainFromMinMax(_s,ga):void 0;var ba=_s!==void 0?_s:getExtremeFromData(g,i,"min"),xa=ga!==void 0?ga:getExtremeFromData(g,i,"max"),El=getDomainFromMinMax(ba,xa);return _&&i==="x"&&Math.abs($-_i)===360?getSymmetricDomain(El,getFlatData(g,i)):El}function getDomainFromMinMax(h,i){var g=function(_){var j=_===0?2*Math.pow(10,-10):Math.pow(10,-10),$=1,_n=_ instanceof Date?new Date(Number(_)-$):Number(_)-j,_i=_ instanceof Date?new Date(Number(_)+$):Number(_)+j;return _===0?[0,_i]:[_n,_i]};return Number(h)===Number(i)?g(i):[h,i]}function getDomainFromProps(h,i){var g=getMinFromProps(h,i),_=getMaxFromProps(h,i);if(isPlainObject_1(h.domain)&&h.domain[i])return h.domain[i];if(Array.isArray(h.domain))return h.domain;if(g!==void 0&&_!==void 0)return getDomainFromMinMax(g,_)}function getDomainWithZero(h,i){var g=getDomainFromProps(h,i);if(g)return g;var _=getData(h),j=_.reduce(function(_s,ga){return ga._y0<_s?ga._y0:_s},1/0),$=function(_s){if(i==="x")return _s;var ga=j!==1/0?j:0,ba=getMaxFromProps(h,i),xa=getMinFromProps(h,i),El=ba!==void 0?ba:getMaxValue(_s,ga),Tl=xa!==void 0?xa:getMinValue(_s,ga);return getDomainFromMinMax(Tl,El)},_n=function(){return getDomainFromData$1(h,i,_)},_i=function(_s){return formatDomain($(_s),h,i)};return createDomainFunction(_n,_i)(h,i)}function getMaxFromProps(h,i){return isPlainObject_1(h.maxDomain)&&h.maxDomain[i]!==void 0?h.maxDomain[i]:typeof h.maxDomain=="number"||isDate_1(h.maxDomain)?h.maxDomain:void 0}function getMinFromProps(h,i){return isPlainObject_1(h.minDomain)&&h.minDomain[i]!==void 0?h.minDomain[i]:typeof h.minDomain=="number"||isDate_1(h.minDomain)?h.minDomain:void 0}function getSymmetricDomain(h,i){var g=sortedUniq_1(i.sort(function(j,$){return j-$})),_=g[1]-g[0];return[h[0],h[1]+_]}function isDomainComponent(h){var i=function($){return $&&$.type?$.type.role:""},g=i(h);if(g==="portal"){var _=React.Children.toArray(h.props.children);g=_.length?i(_[0]):""}var j=["area","axis","bar","boxplot","candlestick","errorbar","group","histogram","line","pie","scatter","stack","voronoi"];return includes_1(j,g)}function _toConsumableArray$7(h){return _arrayWithoutHoles$7(h)||_iterableToArray$7(h)||_unsupportedIterableToArray$9(h)||_nonIterableSpread$7()}function _nonIterableSpread$7(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _unsupportedIterableToArray$9(h,i){if(h){if(typeof h=="string")return _arrayLikeToArray$9(h,i);var g=Object.prototype.toString.call(h).slice(8,-1);if(g==="Object"&&h.constructor&&(g=h.constructor.name),g==="Map"||g==="Set")return Array.from(h);if(g==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(g))return _arrayLikeToArray$9(h,i)}}function _iterableToArray$7(h){if(typeof Symbol<"u"&&h[Symbol.iterator]!=null||h["@@iterator"]!=null)return Array.from(h)}function _arrayWithoutHoles$7(h){if(Array.isArray(h))return _arrayLikeToArray$9(h)}function _arrayLikeToArray$9(h,i){(i==null||i>h.length)&&(i=h.length);for(var g=0,_=new Array(i);g<i;g++)_[g]=h[g];return _}function getAxis(h){var i=h.dependentAxis;return i?"y":"x"}function findAxisComponents(h,i){i=i||identity_1;var g=function(_){return _.reduce(function(j,$){return $.type&&$.type.role==="axis"&&i($)?j.concat($):$.props&&$.props.children?j.concat(g(React.Children.toArray($.props.children))):j},[])};return g(h)}function getAxisComponent(h,i){var g=function(_){var j=_.type.getAxis(_.props);return j===i};return findAxisComponents(h,g)[0]}function getAxisComponentsWithParent(h,i){var g=function(j){return i==="dependent"?j.props.dependentAxis:!j.props.dependentAxis},_=function(j){return j.reduce(function($,_n){if(_n.type&&_n.type.role==="axis"&&g(_n))return $.concat(_n);if(_n.props&&_n.props.children){var _i=_(React.Children.toArray(_n.props.children));return _i.length>0?$.concat(_n):$}return $},[])};return _(h)}function getOrigin(h){var i=function(g){var _=Math.min.apply(Math,_toConsumableArray$7(g)),j=Math.max.apply(Math,_toConsumableArray$7(g));return j<0?j:Math.max(0,_)};return{x:containsDates(h.x)?new Date(Math.min.apply(Math,_toConsumableArray$7(h.x))):i(h.x),y:containsDates(h.y)?new Date(Math.min.apply(Math,_toConsumableArray$7(h.y))):i(h.y)}}function getOriginSign(h,i){var g=function(){return h<=0&&Math.max.apply(Math,_toConsumableArray$7(i))<=0?"negative":"positive"};return containsDates(i)?"positive":g()}function isVertical(h){var i=h.orientation||(h.dependentAxis?"left":"bottom"),g={top:!1,bottom:!1,left:!0,right:!0};return g[i]}function stringTicks(h){return h.tickValues!==void 0&&containsStrings(h.tickValues)}function getDefaultTickFormat(h){var i=h.tickValues,g=getAxis(h),_=h.stringMap&&h.stringMap[g],j=i&&!containsDates(i)?function(ga){return ga}:void 0;if(!_)return stringTicks(h)?function(ga,ba){return i[ba]}:j;var $=_&&invert_1(_),_n=orderBy_1(values_1(_),function(ga){return ga}),_i=_n.map(function(ga){return $[ga]}),_s=[""].concat(_toConsumableArray$7(_i),[""]);return function(ga){return _s[ga]}}function getStringTicks(h){var i=getAxis(h),g=h.stringMap&&h.stringMap[i],_=Array.isArray(h.categories)?h.categories:h.categories&&h.categories[i],j=_&&containsOnlyStrings(_)?_.map(function(_n){return g[_n]}):void 0,$=g&&values_1(g);return j&&j.length!==0?j:$}function getTickArray(h){var i=h.tickValues,g=h.tickFormat,_=getAxis(h),j=h.stringMap&&h.stringMap[_],$=function(){if(!(!g||!Array.isArray(g)))return containsStrings(g)?g.map(function(ga,ba){return ba}):g},_n=i;j&&(_n=getStringTicks(h)),i&&containsStrings(i)&&(_n=j?i.map(function(ga){return j[ga]}):range_1(1,i.length+1));var _i=_n?uniq_1(_n):$(),_s=function(ga){var ba=[],xa=h.domain&&h.domain[_]||h.domain;if(ga)return ga.forEach(function(El,Tl){Array.isArray(xa)?El>=getMinValue(xa)&&El<=getMaxValue(xa)&&ba.push({value:El,index:Tl}):ba.push({value:El,index:Tl})}),ba};return Array.isArray(_i)&&_i.length?_s(_i):void 0}function getTickFormat(h,i){var g=h.tickFormat,_=getAxis(h),j=h.stringMap&&h.stringMap[_];if(g){if(g&&Array.isArray(g)){var _i=getTickArray(h),_s=_i==null?void 0:_i.map(function(xa){return xa.index}),ga=g.filter(function(xa,El){return _s==null?void 0:_s.includes(El)});return function(xa,El){return ga[El]}}else if(g&&isFunction_1(g)){var ba=function(xa,El,Tl){var Sl=invert_1(j),Il=Tl.map(function(Cl){return Sl[Cl]});return h.tickFormat(Sl[xa],El,Il)};return j?ba:g}}else{var $=getDefaultTickFormat(h),_n=i.tickFormat&&isFunction_1(i.tickFormat)?i.tickFormat():function(xa){return xa};return $||_n}return function(xa){return xa}}function downsampleTicks(h,i){if(!i||!Array.isArray(h)||h.length<=i)return h;var g=Math.floor(h.length/i);return h.filter(function(_,j){return j%g===0})}function getTicks(h,i){var g=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,_=h.tickCount,j=getTickArray(h),$=j?j.map(function(xa){return xa.value}):void 0;if($)return downsampleTicks($,_);if(i.ticks&&isFunction_1(i.ticks)){var _n=_||5,_i=i.ticks(_n),_s=Array.isArray(_i)&&_i.length?_i:i.domain(),ga=downsampleTicks(_s,_);if(g){var ba=includes_1(ga,0)?without_1(ga,0):ga;return ba.length?ba:ga}return ga}return i.domain()}function getDomainFromData(h,i){var g=h.polar,_=h.startAngle,j=_===void 0?0:_,$=h.endAngle,_n=$===void 0?360:$,_i=getTickArray(h),_s=_i?_i.map(function(Ul){return Ul.value}):void 0;if(Array.isArray(_s)){var ga=getMinFromProps(h,i),ba=getMaxFromProps(h,i),xa=stringTicks(h),El=_s.map(function(Ul){return Number(Ul)}),Tl=xa?1:getMinValue(El),Sl=xa?_s.length:getMaxValue(El),Il=ga!==void 0?ga:Tl,Cl=ba!==void 0?ba:Sl,Nl=getDomainFromMinMax(Il,Cl),Dl=g&&i==="x"&&Math.abs(j-_n)===360?getSymmetricDomain(Nl,El):Nl;return isVertical(h)&&!g&&Dl.reverse(),Dl}}function getDomain$2(h,i){var g=getAxis(h);if(!(i&&i!==g))return createDomainFunction(getDomainFromData)(h,g)}function getAxisValue(h,i){if(h.axisValue){var g=i==="x"?"y":"x",_=isObject_1(h.scale)&&isFunction_1(h.scale[g])?h.scale[g]:void 0;if(_){var j=i==="x"?"y":"x",$=isObject_1(h.stringMap)&&h.stringMap[j],_n=$&&typeof h.axisValue=="string"?$[h.axisValue]:h.axisValue;return _(_n)}}}function modifyProps(h,i){if(!isObject_1(h.theme))return modifyProps$1(h,i,"axis");var g="axis";if(h.dependentAxis&&h.theme.dependentAxis?g="dependentAxis":!h.dependentAxis&&h.theme.independentAxis&&(g="independentAxis"),g==="axis")return modifyProps$1(h,i,"axis");var _=defaults_1({},h.theme[g],h.theme.axis),j=assign_1({},h.theme,{axis:_});return modifyProps$1(assign_1({},h,{theme:j}),i,"axis")}function continuousTransitions(){return{onLoad:{duration:2e3},onExit:{duration:500},onEnter:{duration:500}}}function continuousPolarTransitions(){return{onLoad:{duration:2e3,before:function(){return{_y:0,_y1:0,_y0:0}},after:function(h){return{_y:h._y,_y1:h._y1,_y0:h._y0}}},onExit:{duration:500,before:function(h,i,g){var _=function(j){var $=i===0?g[i+1]:g[i-1];return $[j]};return{_x:_("_x"),_y:_("_y"),_y0:_("_y0")}}},onEnter:{duration:500,before:function(h,i,g){var _=function(j){var $=i===0?g[i+1]:g[i-1];return $[j]};return{_x:_("_x"),_y:_("_y"),_y0:_("_y0")}},after:function(h){return{_x:h._x,_y:h._y,_y1:h._y1,_y0:h._y0}}}}}function usePreviousProps(h){var i=React.useRef();return React.useEffect(function(){i.current=h}),i.current}var baseEach$1=_baseEach;function baseSome$1(h,i){var g;return baseEach$1(h,function(_,j,$){return g=i(_,j,$),!g}),!!g}var _baseSome=baseSome$1,arraySome=_arraySome,baseIteratee$2=_baseIteratee,baseSome=_baseSome,isArray$1=isArray_1,isIterateeCall=_isIterateeCall;function some(h,i,g){var _=isArray$1(h)?arraySome:baseSome;return g&&isIterateeCall(h,i,g)&&(i=void 0),_(h,baseIteratee$2(i))}var some_1=some;function ownKeys$b(h,i){var g=Object.keys(h);if(Object.getOwnPropertySymbols){var _=Object.getOwnPropertySymbols(h);i&&(_=_.filter(function(j){return Object.getOwnPropertyDescriptor(h,j).enumerable})),g.push.apply(g,_)}return g}function _objectSpread$b(h){for(var i=1;i<arguments.length;i++){var g=arguments[i]!=null?arguments[i]:{};i%2?ownKeys$b(Object(g),!0).forEach(function(_){_defineProperty$c(h,_,g[_])}):Object.getOwnPropertyDescriptors?Object.defineProperties(h,Object.getOwnPropertyDescriptors(g)):ownKeys$b(Object(g)).forEach(function(_){Object.defineProperty(h,_,Object.getOwnPropertyDescriptor(g,_))})}return h}function _defineProperty$c(h,i,g){return i in h?Object.defineProperty(h,i,{value:g,enumerable:!0,configurable:!0,writable:!0}):h[i]=g,h}function _slicedToArray$2(h,i){return _arrayWithHoles$2(h)||_iterableToArrayLimit$2(h,i)||_unsupportedIterableToArray$8(h,i)||_nonIterableRest$2()}function _nonIterableRest$2(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _unsupportedIterableToArray$8(h,i){if(h){if(typeof h=="string")return _arrayLikeToArray$8(h,i);var g=Object.prototype.toString.call(h).slice(8,-1);if(g==="Object"&&h.constructor&&(g=h.constructor.name),g==="Map"||g==="Set")return Array.from(h);if(g==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(g))return _arrayLikeToArray$8(h,i)}}function _arrayLikeToArray$8(h,i){(i==null||i>h.length)&&(i=h.length);for(var g=0,_=new Array(i);g<i;g++)_[g]=h[g];return _}function _iterableToArrayLimit$2(h,i){var g=h==null?null:typeof Symbol<"u"&&h[Symbol.iterator]||h["@@iterator"];if(g!=null){var _=[],j=!0,$=!1,_n,_i;try{for(g=g.call(h);!(j=(_n=g.next()).done)&&(_.push(_n.value),!(i&&_.length===i));j=!0);}catch(_s){$=!0,_i=_s}finally{try{!j&&g.return!=null&&g.return()}finally{if($)throw _i}}return _}}function _arrayWithHoles$2(h){if(Array.isArray(h))return h}var INITIAL_STATE={nodesShouldLoad:!1,nodesDoneLoad:!1,animating:!0},useAnimationState=function(){var h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:INITIAL_STATE,i=React.useState(h),g=_slicedToArray$2(i,2),_=g[0],j=g[1],$=React.useCallback(function(ga){j(function(ba){return _objectSpread$b(_objectSpread$b({},ba),ga)})},[j]),_n=React.useCallback(function(ga,ba,xa){if(!(ga!=null&&ga.animate))return ba.props.animate;var El=function(){var Nl=_&&_.childrenTransitions;return Nl=isArrayOfArrays(Nl)?Nl[xa]:Nl,defaults_1({childrenTransitions:Nl},_)},Tl=ga.animate&&ga.animate.getTransitions,Sl=El(),Il=ga.animate&&ga.animate.parentState||Sl;if(!Tl){var Cl=getTransitionPropsFactory(ga,Sl,function(Nl){return $(Nl)});Tl=function(Nl){return Cl(Nl,xa)}}return defaults_1({getTransitions:Tl,parentState:Il},ga.animate,ba.props.animate)},[_,$]),_i=React.useCallback(function(ga,ba){if(ga!=null&&ga.animate)if(ga.animate.parentState){var xa=ga.animate.parentState.nodesWillExit,El=xa?ga:null,Tl=defaults_1({oldProps:El,nextProps:ba},ga.animate.parentState);$(Tl)}else{var Sl=React.Children.toArray(ga.children),Il=React.Children.toArray(ba.children),Cl=function(_p){var Ip=function(Up){return Up.type&&Up.type.continuous};return Array.isArray(_p)?some_1(_p,Ip):Ip(_p)},Nl=!ga.polar&&some_1(Sl,function(_p){return Cl(_p)||_p.props.children&&Cl(_p.props.children)}),Dl=getInitialTransitionState(Sl,Il),Ul=Dl.nodesWillExit,Kl=Dl.nodesWillEnter,Jl=Dl.childrenTransitions,Ep=Dl.nodesShouldEnter;$({nodesWillExit:Ul,nodesWillEnter:Kl,nodesShouldEnter:Ep,childrenTransitions:isArrayOfArrays(Jl)?Jl[0]:Jl,oldProps:Ul?ga:void 0,nextProps:ba,continuous:Nl})}},[$]),_s=React.useCallback(function(ga){return _&&_.nodesWillExit&&_.oldProps||ga},[_]);return{state:_,setState:$,getAnimationProps:_n,setAnimationState:_i,getProps:_s}};function constant(h){return function(){return h}}const abs=Math.abs,atan2=Math.atan2,cos=Math.cos,max=Math.max,min=Math.min,sin=Math.sin,sqrt=Math.sqrt,epsilon$1=1e-12,pi$1=Math.PI,halfPi=pi$1/2,tau$1=2*pi$1;function acos(h){return h>1?0:h<-1?pi$1:Math.acos(h)}function asin(h){return h>=1?halfPi:h<=-1?-halfPi:Math.asin(h)}const pi=Math.PI,tau=2*pi,epsilon=1e-6,tauEpsilon=tau-epsilon;function append(h){this._+=h[0];for(let i=1,g=h.length;i<g;++i)this._+=arguments[i]+h[i]}function appendRound(h){let i=Math.floor(h);if(!(i>=0))throw new Error(`invalid digits: ${h}`);if(i>15)return append;const g=10**i;return function(_){this._+=_[0];for(let j=1,$=_.length;j<$;++j)this._+=Math.round(arguments[j]*g)/g+_[j]}}class Path{constructor(i){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=i==null?append:appendRound(i)}moveTo(i,g){this._append`M${this._x0=this._x1=+i},${this._y0=this._y1=+g}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(i,g){this._append`L${this._x1=+i},${this._y1=+g}`}quadraticCurveTo(i,g,_,j){this._append`Q${+i},${+g},${this._x1=+_},${this._y1=+j}`}bezierCurveTo(i,g,_,j,$,_n){this._append`C${+i},${+g},${+_},${+j},${this._x1=+$},${this._y1=+_n}`}arcTo(i,g,_,j,$){if(i=+i,g=+g,_=+_,j=+j,$=+$,$<0)throw new Error(`negative radius: ${$}`);let _n=this._x1,_i=this._y1,_s=_-i,ga=j-g,ba=_n-i,xa=_i-g,El=ba*ba+xa*xa;if(this._x1===null)this._append`M${this._x1=i},${this._y1=g}`;else if(El>epsilon)if(!(Math.abs(xa*_s-ga*ba)>epsilon)||!$)this._append`L${this._x1=i},${this._y1=g}`;else{let Tl=_-_n,Sl=j-_i,Il=_s*_s+ga*ga,Cl=Tl*Tl+Sl*Sl,Nl=Math.sqrt(Il),Dl=Math.sqrt(El),Ul=$*Math.tan((pi-Math.acos((Il+El-Cl)/(2*Nl*Dl)))/2),Kl=Ul/Dl,Jl=Ul/Nl;Math.abs(Kl-1)>epsilon&&this._append`L${i+Kl*ba},${g+Kl*xa}`,this._append`A${$},${$},0,0,${+(xa*Tl>ba*Sl)},${this._x1=i+Jl*_s},${this._y1=g+Jl*ga}`}}arc(i,g,_,j,$,_n){if(i=+i,g=+g,_=+_,_n=!!_n,_<0)throw new Error(`negative radius: ${_}`);let _i=_*Math.cos(j),_s=_*Math.sin(j),ga=i+_i,ba=g+_s,xa=1^_n,El=_n?j-$:$-j;this._x1===null?this._append`M${ga},${ba}`:(Math.abs(this._x1-ga)>epsilon||Math.abs(this._y1-ba)>epsilon)&&this._append`L${ga},${ba}`,_&&(El<0&&(El=El%tau+tau),El>tauEpsilon?this._append`A${_},${_},0,1,${xa},${i-_i},${g-_s}A${_},${_},0,1,${xa},${this._x1=ga},${this._y1=ba}`:El>epsilon&&this._append`A${_},${_},0,${+(El>=pi)},${xa},${this._x1=i+_*Math.cos($)},${this._y1=g+_*Math.sin($)}`)}rect(i,g,_,j){this._append`M${this._x0=this._x1=+i},${this._y0=this._y1=+g}h${_=+_}v${+j}h${-_}Z`}toString(){return this._}}function withPath(h){let i=3;return h.digits=function(g){if(!arguments.length)return i;if(g==null)i=null;else{const _=Math.floor(g);if(!(_>=0))throw new RangeError(`invalid digits: ${g}`);i=_}return h},()=>new Path(i)}function arcInnerRadius(h){return h.innerRadius}function arcOuterRadius(h){return h.outerRadius}function arcStartAngle(h){return h.startAngle}function arcEndAngle(h){return h.endAngle}function arcPadAngle(h){return h&&h.padAngle}function intersect(h,i,g,_,j,$,_n,_i){var _s=g-h,ga=_-i,ba=_n-j,xa=_i-$,El=xa*_s-ba*ga;if(!(El*El<epsilon$1))return El=(ba*(i-$)-xa*(h-j))/El,[h+El*_s,i+El*ga]}function cornerTangents(h,i,g,_,j,$,_n){var _i=h-g,_s=i-_,ga=(_n?$:-$)/sqrt(_i*_i+_s*_s),ba=ga*_s,xa=-ga*_i,El=h+ba,Tl=i+xa,Sl=g+ba,Il=_+xa,Cl=(El+Sl)/2,Nl=(Tl+Il)/2,Dl=Sl-El,Ul=Il-Tl,Kl=Dl*Dl+Ul*Ul,Jl=j-$,Ep=El*Il-Sl*Tl,_p=(Ul<0?-1:1)*sqrt(max(0,Jl*Jl*Kl-Ep*Ep)),Ip=(Ep*Ul-Dl*_p)/Kl,Up=(-Ep*Dl-Ul*_p)/Kl,yp=(Ep*Ul+Dl*_p)/Kl,Ap=(-Ep*Dl+Ul*_p)/Kl,Cp=Ip-Cl,Mp=Up-Nl,wp=yp-Cl,Np=Ap-Nl;return Cp*Cp+Mp*Mp>wp*wp+Np*Np&&(Ip=yp,Up=Ap),{cx:Ip,cy:Up,x01:-ba,y01:-xa,x11:Ip*(j/Jl-1),y11:Up*(j/Jl-1)}}function arc(){var h=arcInnerRadius,i=arcOuterRadius,g=constant(0),_=null,j=arcStartAngle,$=arcEndAngle,_n=arcPadAngle,_i=null,_s=withPath(ga);function ga(){var ba,xa,El=+h.apply(this,arguments),Tl=+i.apply(this,arguments),Sl=j.apply(this,arguments)-halfPi,Il=$.apply(this,arguments)-halfPi,Cl=abs(Il-Sl),Nl=Il>Sl;if(_i||(_i=ba=_s()),Tl<El&&(xa=Tl,Tl=El,El=xa),!(Tl>epsilon$1))_i.moveTo(0,0);else if(Cl>tau$1-epsilon$1)_i.moveTo(Tl*cos(Sl),Tl*sin(Sl)),_i.arc(0,0,Tl,Sl,Il,!Nl),El>epsilon$1&&(_i.moveTo(El*cos(Il),El*sin(Il)),_i.arc(0,0,El,Il,Sl,Nl));else{var Dl=Sl,Ul=Il,Kl=Sl,Jl=Il,Ep=Cl,_p=Cl,Ip=_n.apply(this,arguments)/2,Up=Ip>epsilon$1&&(_?+_.apply(this,arguments):sqrt(El*El+Tl*Tl)),yp=min(abs(Tl-El)/2,+g.apply(this,arguments)),Ap=yp,Cp=yp,Mp,wp;if(Up>epsilon$1){var Np=asin(Up/El*sin(Ip)),Fp=asin(Up/Tl*sin(Ip));(Ep-=Np*2)>epsilon$1?(Np*=Nl?1:-1,Kl+=Np,Jl-=Np):(Ep=0,Kl=Jl=(Sl+Il)/2),(_p-=Fp*2)>epsilon$1?(Fp*=Nl?1:-1,Dl+=Fp,Ul-=Fp):(_p=0,Dl=Ul=(Sl+Il)/2)}var Hp=Tl*cos(Dl),xp=Tl*sin(Dl),Gp=El*cos(Jl),$p=El*sin(Jl);if(yp>epsilon$1){var c0=Tl*cos(Ul),n0=Tl*sin(Ul),C0=El*cos(Kl),Op=El*sin(Kl),Q0;if(Cl<pi$1)if(Q0=intersect(Hp,xp,C0,Op,c0,n0,Gp,$p)){var dy=Hp-Q0[0],Yy=xp-Q0[1],J_=c0-Q0[0],R0=n0-Q0[1],ry=1/sin(acos((dy*J_+Yy*R0)/(sqrt(dy*dy+Yy*Yy)*sqrt(J_*J_+R0*R0)))/2),q0=sqrt(Q0[0]*Q0[0]+Q0[1]*Q0[1]);Ap=min(yp,(El-q0)/(ry-1)),Cp=min(yp,(Tl-q0)/(ry+1))}else Ap=Cp=0}_p>epsilon$1?Cp>epsilon$1?(Mp=cornerTangents(C0,Op,Hp,xp,Tl,Cp,Nl),wp=cornerTangents(c0,n0,Gp,$p,Tl,Cp,Nl),_i.moveTo(Mp.cx+Mp.x01,Mp.cy+Mp.y01),Cp<yp?_i.arc(Mp.cx,Mp.cy,Cp,atan2(Mp.y01,Mp.x01),atan2(wp.y01,wp.x01),!Nl):(_i.arc(Mp.cx,Mp.cy,Cp,atan2(Mp.y01,Mp.x01),atan2(Mp.y11,Mp.x11),!Nl),_i.arc(0,0,Tl,atan2(Mp.cy+Mp.y11,Mp.cx+Mp.x11),atan2(wp.cy+wp.y11,wp.cx+wp.x11),!Nl),_i.arc(wp.cx,wp.cy,Cp,atan2(wp.y11,wp.x11),atan2(wp.y01,wp.x01),!Nl))):(_i.moveTo(Hp,xp),_i.arc(0,0,Tl,Dl,Ul,!Nl)):_i.moveTo(Hp,xp),!(El>epsilon$1)||!(Ep>epsilon$1)?_i.lineTo(Gp,$p):Ap>epsilon$1?(Mp=cornerTangents(Gp,$p,c0,n0,El,-Ap,Nl),wp=cornerTangents(Hp,xp,C0,Op,El,-Ap,Nl),_i.lineTo(Mp.cx+Mp.x01,Mp.cy+Mp.y01),Ap<yp?_i.arc(Mp.cx,Mp.cy,Ap,atan2(Mp.y01,Mp.x01),atan2(wp.y01,wp.x01),!Nl):(_i.arc(Mp.cx,Mp.cy,Ap,atan2(Mp.y01,Mp.x01),atan2(Mp.y11,Mp.x11),!Nl),_i.arc(0,0,El,atan2(Mp.cy+Mp.y11,Mp.cx+Mp.x11),atan2(wp.cy+wp.y11,wp.cx+wp.x11),Nl),_i.arc(wp.cx,wp.cy,Ap,atan2(wp.y11,wp.x11),atan2(wp.y01,wp.x01),!Nl))):_i.arc(0,0,El,Jl,Kl,Nl)}if(_i.closePath(),ba)return _i=null,ba+""||null}return ga.centroid=function(){var ba=(+h.apply(this,arguments)+ +i.apply(this,arguments))/2,xa=(+j.apply(this,arguments)+ +$.apply(this,arguments))/2-pi$1/2;return[cos(xa)*ba,sin(xa)*ba]},ga.innerRadius=function(ba){return arguments.length?(h=typeof ba=="function"?ba:constant(+ba),ga):h},ga.outerRadius=function(ba){return arguments.length?(i=typeof ba=="function"?ba:constant(+ba),ga):i},ga.cornerRadius=function(ba){return arguments.length?(g=typeof ba=="function"?ba:constant(+ba),ga):g},ga.padRadius=function(ba){return arguments.length?(_=ba==null?null:typeof ba=="function"?ba:constant(+ba),ga):_},ga.startAngle=function(ba){return arguments.length?(j=typeof ba=="function"?ba:constant(+ba),ga):j},ga.endAngle=function(ba){return arguments.length?($=typeof ba=="function"?ba:constant(+ba),ga):$},ga.padAngle=function(ba){return arguments.length?(_n=typeof ba=="function"?ba:constant(+ba),ga):_n},ga.context=function(ba){return arguments.length?(_i=ba??null,ga):_i},ga}var slice=Array.prototype.slice;function array(h){return typeof h=="object"&&"length"in h?h:Array.from(h)}function Linear(h){this._context=h}Linear.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(h,i){switch(h=+h,i=+i,this._point){case 0:this._point=1,this._line?this._context.lineTo(h,i):this._context.moveTo(h,i);break;case 1:this._point=2;default:this._context.lineTo(h,i);break}}};function curveLinear(h){return new Linear(h)}function x(h){return h[0]}function y(h){return h[1]}function line(h,i){var g=constant(!0),_=null,j=curveLinear,$=null,_n=withPath(_i);h=typeof h=="function"?h:h===void 0?x:constant(h),i=typeof i=="function"?i:i===void 0?y:constant(i);function _i(_s){var ga,ba=(_s=array(_s)).length,xa,El=!1,Tl;for(_==null&&($=j(Tl=_n())),ga=0;ga<=ba;++ga)!(ga<ba&&g(xa=_s[ga],ga,_s))===El&&((El=!El)?$.lineStart():$.lineEnd()),El&&$.point(+h(xa,ga,_s),+i(xa,ga,_s));if(Tl)return $=null,Tl+""||null}return _i.x=function(_s){return arguments.length?(h=typeof _s=="function"?_s:constant(+_s),_i):h},_i.y=function(_s){return arguments.length?(i=typeof _s=="function"?_s:constant(+_s),_i):i},_i.defined=function(_s){return arguments.length?(g=typeof _s=="function"?_s:constant(!!_s),_i):g},_i.curve=function(_s){return arguments.length?(j=_s,_!=null&&($=j(_)),_i):j},_i.context=function(_s){return arguments.length?(_s==null?_=$=null:$=j(_=_s),_i):_},_i}function area(h,i,g){var _=null,j=constant(!0),$=null,_n=curveLinear,_i=null,_s=withPath(ga);h=typeof h=="function"?h:h===void 0?x:constant(+h),i=typeof i=="function"?i:constant(i===void 0?0:+i),g=typeof g=="function"?g:g===void 0?y:constant(+g);function ga(xa){var El,Tl,Sl,Il=(xa=array(xa)).length,Cl,Nl=!1,Dl,Ul=new Array(Il),Kl=new Array(Il);for($==null&&(_i=_n(Dl=_s())),El=0;El<=Il;++El){if(!(El<Il&&j(Cl=xa[El],El,xa))===Nl)if(Nl=!Nl)Tl=El,_i.areaStart(),_i.lineStart();else{for(_i.lineEnd(),_i.lineStart(),Sl=El-1;Sl>=Tl;--Sl)_i.point(Ul[Sl],Kl[Sl]);_i.lineEnd(),_i.areaEnd()}Nl&&(Ul[El]=+h(Cl,El,xa),Kl[El]=+i(Cl,El,xa),_i.point(_?+_(Cl,El,xa):Ul[El],g?+g(Cl,El,xa):Kl[El]))}if(Dl)return _i=null,Dl+""||null}function ba(){return line().defined(j).curve(_n).context($)}return ga.x=function(xa){return arguments.length?(h=typeof xa=="function"?xa:constant(+xa),_=null,ga):h},ga.x0=function(xa){return arguments.length?(h=typeof xa=="function"?xa:constant(+xa),ga):h},ga.x1=function(xa){return arguments.length?(_=xa==null?null:typeof xa=="function"?xa:constant(+xa),ga):_},ga.y=function(xa){return arguments.length?(i=typeof xa=="function"?xa:constant(+xa),g=null,ga):i},ga.y0=function(xa){return arguments.length?(i=typeof xa=="function"?xa:constant(+xa),ga):i},ga.y1=function(xa){return arguments.length?(g=xa==null?null:typeof xa=="function"?xa:constant(+xa),ga):g},ga.lineX0=ga.lineY0=function(){return ba().x(h).y(i)},ga.lineY1=function(){return ba().x(h).y(g)},ga.lineX1=function(){return ba().x(_).y(i)},ga.defined=function(xa){return arguments.length?(j=typeof xa=="function"?xa:constant(!!xa),ga):j},ga.curve=function(xa){return arguments.length?(_n=xa,$!=null&&(_i=_n($)),ga):_n},ga.context=function(xa){return arguments.length?(xa==null?$=_i=null:_i=_n($=xa),ga):$},ga}function descending$1(h,i){return i<h?-1:i>h?1:i>=h?0:NaN}function identity(h){return h}function pie(){var h=identity,i=descending$1,g=null,_=constant(0),j=constant(tau$1),$=constant(0);function _n(_i){var _s,ga=(_i=array(_i)).length,ba,xa,El=0,Tl=new Array(ga),Sl=new Array(ga),Il=+_.apply(this,arguments),Cl=Math.min(tau$1,Math.max(-tau$1,j.apply(this,arguments)-Il)),Nl,Dl=Math.min(Math.abs(Cl)/ga,$.apply(this,arguments)),Ul=Dl*(Cl<0?-1:1),Kl;for(_s=0;_s<ga;++_s)(Kl=Sl[Tl[_s]=_s]=+h(_i[_s],_s,_i))>0&&(El+=Kl);for(i!=null?Tl.sort(function(Jl,Ep){return i(Sl[Jl],Sl[Ep])}):g!=null&&Tl.sort(function(Jl,Ep){return g(_i[Jl],_i[Ep])}),_s=0,xa=El?(Cl-ga*Ul)/El:0;_s<ga;++_s,Il=Nl)ba=Tl[_s],Kl=Sl[ba],Nl=Il+(Kl>0?Kl*xa:0)+Ul,Sl[ba]={data:_i[ba],index:_s,value:Kl,startAngle:Il,endAngle:Nl,padAngle:Dl};return Sl}return _n.value=function(_i){return arguments.length?(h=typeof _i=="function"?_i:constant(+_i),_n):h},_n.sortValues=function(_i){return arguments.length?(i=_i,g=null,_n):i},_n.sort=function(_i){return arguments.length?(g=_i,i=null,_n):g},_n.startAngle=function(_i){return arguments.length?(_=typeof _i=="function"?_i:constant(+_i),_n):_},_n.endAngle=function(_i){return arguments.length?(j=typeof _i=="function"?_i:constant(+_i),_n):j},_n.padAngle=function(_i){return arguments.length?($=typeof _i=="function"?_i:constant(+_i),_n):$},_n}var curveRadialLinear=curveRadial(curveLinear);function Radial(h){this._curve=h}Radial.prototype={areaStart:function(){this._curve.areaStart()},areaEnd:function(){this._curve.areaEnd()},lineStart:function(){this._curve.lineStart()},lineEnd:function(){this._curve.lineEnd()},point:function(h,i){this._curve.point(i*Math.sin(h),i*-Math.cos(h))}};function curveRadial(h){function i(g){return new Radial(h(g))}return i._curve=h,i}function lineRadial(h){var i=h.curve;return h.angle=h.x,delete h.x,h.radius=h.y,delete h.y,h.curve=function(g){return arguments.length?i(curveRadial(g)):i()._curve},h}function lineRadial$1(){return lineRadial(line().curve(curveRadialLinear))}function areaRadial(){var h=area().curve(curveRadialLinear),i=h.curve,g=h.lineX0,_=h.lineX1,j=h.lineY0,$=h.lineY1;return h.angle=h.x,delete h.x,h.startAngle=h.x0,delete h.x0,h.endAngle=h.x1,delete h.x1,h.radius=h.y,delete h.y,h.innerRadius=h.y0,delete h.y0,h.outerRadius=h.y1,delete h.y1,h.lineStartAngle=function(){return lineRadial(g())},delete h.lineX0,h.lineEndAngle=function(){return lineRadial(_())},delete h.lineX1,h.lineInnerRadius=function(){return lineRadial(j())},delete h.lineY0,h.lineOuterRadius=function(){return lineRadial($())},delete h.lineY1,h.curve=function(_n){return arguments.length?i(curveRadial(_n)):i()._curve},h}function pointRadial(h,i){return[(i=+i)*Math.cos(h-=Math.PI/2),i*Math.sin(h)]}class Bump{constructor(i,g){this._context=i,this._x=g}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line}point(i,g){switch(i=+i,g=+g,this._point){case 0:{this._point=1,this._line?this._context.lineTo(i,g):this._context.moveTo(i,g);break}case 1:this._point=2;default:{this._x?this._context.bezierCurveTo(this._x0=(this._x0+i)/2,this._y0,this._x0,g,i,g):this._context.bezierCurveTo(this._x0,this._y0=(this._y0+g)/2,i,this._y0,i,g);break}}this._x0=i,this._y0=g}}class BumpRadial{constructor(i){this._context=i}lineStart(){this._point=0}lineEnd(){}point(i,g){if(i=+i,g=+g,this._point===0)this._point=1;else{const _=pointRadial(this._x0,this._y0),j=pointRadial(this._x0,this._y0=(this._y0+g)/2),$=pointRadial(i,this._y0),_n=pointRadial(i,g);this._context.moveTo(..._),this._context.bezierCurveTo(...j,...$,..._n)}this._x0=i,this._y0=g}}function bumpX(h){return new Bump(h,!0)}function bumpY(h){return new Bump(h,!1)}function bumpRadial(h){return new BumpRadial(h)}function linkSource(h){return h.source}function linkTarget(h){return h.target}function link(h){let i=linkSource,g=linkTarget,_=x,j=y,$=null,_n=null,_i=withPath(_s);function _s(){let ga;const ba=slice.call(arguments),xa=i.apply(this,ba),El=g.apply(this,ba);if($==null&&(_n=h(ga=_i())),_n.lineStart(),ba[0]=xa,_n.point(+_.apply(this,ba),+j.apply(this,ba)),ba[0]=El,_n.point(+_.apply(this,ba),+j.apply(this,ba)),_n.lineEnd(),ga)return _n=null,ga+""||null}return _s.source=function(ga){return arguments.length?(i=ga,_s):i},_s.target=function(ga){return arguments.length?(g=ga,_s):g},_s.x=function(ga){return arguments.length?(_=typeof ga=="function"?ga:constant(+ga),_s):_},_s.y=function(ga){return arguments.length?(j=typeof ga=="function"?ga:constant(+ga),_s):j},_s.context=function(ga){return arguments.length?(ga==null?$=_n=null:_n=h($=ga),_s):$},_s}function linkHorizontal(){return link(bumpX)}function linkVertical(){return link(bumpY)}function linkRadial(){const h=link(bumpRadial);return h.angle=h.x,delete h.x,h.radius=h.y,delete h.y,h}const sqrt3$2=sqrt(3),asterisk={draw(h,i){const g=sqrt(i+min(i/28,.75))*.59436,_=g/2,j=_*sqrt3$2;h.moveTo(0,g),h.lineTo(0,-g),h.moveTo(-j,-_),h.lineTo(j,_),h.moveTo(-j,_),h.lineTo(j,-_)}},circle$1={draw(h,i){const g=sqrt(i/pi$1);h.moveTo(g,0),h.arc(0,0,g,0,tau$1)}},cross={draw(h,i){const g=sqrt(i/5)/2;h.moveTo(-3*g,-g),h.lineTo(-g,-g),h.lineTo(-g,-3*g),h.lineTo(g,-3*g),h.lineTo(g,-g),h.lineTo(3*g,-g),h.lineTo(3*g,g),h.lineTo(g,g),h.lineTo(g,3*g),h.lineTo(-g,3*g),h.lineTo(-g,g),h.lineTo(-3*g,g),h.closePath()}},tan30=sqrt(1/3),tan30_2=tan30*2,diamond={draw(h,i){const g=sqrt(i/tan30_2),_=g*tan30;h.moveTo(0,-g),h.lineTo(_,0),h.lineTo(0,g),h.lineTo(-_,0),h.closePath()}},diamond2={draw(h,i){const g=sqrt(i)*.62625;h.moveTo(0,-g),h.lineTo(g,0),h.lineTo(0,g),h.lineTo(-g,0),h.closePath()}},plus={draw(h,i){const g=sqrt(i-min(i/7,2))*.87559;h.moveTo(-g,0),h.lineTo(g,0),h.moveTo(0,g),h.lineTo(0,-g)}},square={draw(h,i){const g=sqrt(i),_=-g/2;h.rect(_,_,g,g)}},square2={draw(h,i){const g=sqrt(i)*.4431;h.moveTo(g,g),h.lineTo(g,-g),h.lineTo(-g,-g),h.lineTo(-g,g),h.closePath()}},ka=.8908130915292852,kr=sin(pi$1/10)/sin(7*pi$1/10),kx=sin(tau$1/10)*kr,ky=-cos(tau$1/10)*kr,star={draw(h,i){const g=sqrt(i*ka),_=kx*g,j=ky*g;h.moveTo(0,-g),h.lineTo(_,j);for(let $=1;$<5;++$){const _n=tau$1*$/5,_i=cos(_n),_s=sin(_n);h.lineTo(_s*g,-_i*g),h.lineTo(_i*_-_s*j,_s*_+_i*j)}h.closePath()}},sqrt3$1=sqrt(3),triangle={draw(h,i){const g=-sqrt(i/(sqrt3$1*3));h.moveTo(0,g*2),h.lineTo(-sqrt3$1*g,-g),h.lineTo(sqrt3$1*g,-g),h.closePath()}},sqrt3=sqrt(3),triangle2={draw(h,i){const g=sqrt(i)*.6824,_=g/2,j=g*sqrt3/2;h.moveTo(0,-g),h.lineTo(j,_),h.lineTo(-j,_),h.closePath()}},c=-.5,s=sqrt(3)/2,k=1/sqrt(12),a=(k/2+1)*3,wye={draw(h,i){const g=sqrt(i/a),_=g/2,j=g*k,$=_,_n=g*k+g,_i=-$,_s=_n;h.moveTo(_,j),h.lineTo($,_n),h.lineTo(_i,_s),h.lineTo(c*_-s*j,s*_+c*j),h.lineTo(c*$-s*_n,s*$+c*_n),h.lineTo(c*_i-s*_s,s*_i+c*_s),h.lineTo(c*_+s*j,c*j-s*_),h.lineTo(c*$+s*_n,c*_n-s*$),h.lineTo(c*_i+s*_s,c*_s-s*_i),h.closePath()}},times={draw(h,i){const g=sqrt(i-min(i/6,1.7))*.6189;h.moveTo(-g,-g),h.lineTo(g,g),h.moveTo(-g,g),h.lineTo(g,-g)}},symbolsFill=[circle$1,cross,diamond,square,star,triangle,wye],symbolsStroke=[circle$1,plus,times,triangle2,asterisk,square2,diamond2];function Symbol$1(h,i){let g=null,_=withPath(j);h=typeof h=="function"?h:constant(h||circle$1),i=typeof i=="function"?i:constant(i===void 0?64:+i);function j(){let $;if(g||(g=$=_()),h.apply(this,arguments).draw(g,+i.apply(this,arguments)),$)return g=null,$+""||null}return j.type=function($){return arguments.length?(h=typeof $=="function"?$:constant($),j):h},j.size=function($){return arguments.length?(i=typeof $=="function"?$:constant(+$),j):i},j.context=function($){return arguments.length?(g=$??null,j):g},j}function noop(){}function point$4(h,i,g){h._context.bezierCurveTo((2*h._x0+h._x1)/3,(2*h._y0+h._y1)/3,(h._x0+2*h._x1)/3,(h._y0+2*h._y1)/3,(h._x0+4*h._x1+i)/6,(h._y0+4*h._y1+g)/6)}function Basis(h){this._context=h}Basis.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:point$4(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(h,i){switch(h=+h,i=+i,this._point){case 0:this._point=1,this._line?this._context.lineTo(h,i):this._context.moveTo(h,i);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:point$4(this,h,i);break}this._x0=this._x1,this._x1=h,this._y0=this._y1,this._y1=i}};function basis(h){return new Basis(h)}function BasisClosed(h){this._context=h}BasisClosed.prototype={areaStart:noop,areaEnd:noop,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x2,this._y2),this._context.closePath();break}case 2:{this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break}case 3:{this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4);break}}},point:function(h,i){switch(h=+h,i=+i,this._point){case 0:this._point=1,this._x2=h,this._y2=i;break;case 1:this._point=2,this._x3=h,this._y3=i;break;case 2:this._point=3,this._x4=h,this._y4=i,this._context.moveTo((this._x0+4*this._x1+h)/6,(this._y0+4*this._y1+i)/6);break;default:point$4(this,h,i);break}this._x0=this._x1,this._x1=h,this._y0=this._y1,this._y1=i}};function basisClosed(h){return new BasisClosed(h)}function BasisOpen(h){this._context=h}BasisOpen.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(h,i){switch(h=+h,i=+i,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var g=(this._x0+4*this._x1+h)/6,_=(this._y0+4*this._y1+i)/6;this._line?this._context.lineTo(g,_):this._context.moveTo(g,_);break;case 3:this._point=4;default:point$4(this,h,i);break}this._x0=this._x1,this._x1=h,this._y0=this._y1,this._y1=i}};function basisOpen(h){return new BasisOpen(h)}function Bundle(h,i){this._basis=new Basis(h),this._beta=i}Bundle.prototype={lineStart:function(){this._x=[],this._y=[],this._basis.lineStart()},lineEnd:function(){var h=this._x,i=this._y,g=h.length-1;if(g>0)for(var _=h[0],j=i[0],$=h[g]-_,_n=i[g]-j,_i=-1,_s;++_i<=g;)_s=_i/g,this._basis.point(this._beta*h[_i]+(1-this._beta)*(_+_s*$),this._beta*i[_i]+(1-this._beta)*(j+_s*_n));this._x=this._y=null,this._basis.lineEnd()},point:function(h,i){this._x.push(+h),this._y.push(+i)}};const bundle=function h(i){function g(_){return i===1?new Basis(_):new Bundle(_,i)}return g.beta=function(_){return h(+_)},g}(.85);function point$3(h,i,g){h._context.bezierCurveTo(h._x1+h._k*(h._x2-h._x0),h._y1+h._k*(h._y2-h._y0),h._x2+h._k*(h._x1-i),h._y2+h._k*(h._y1-g),h._x2,h._y2)}function Cardinal(h,i){this._context=h,this._k=(1-i)/6}Cardinal.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:point$3(this,this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(h,i){switch(h=+h,i=+i,this._point){case 0:this._point=1,this._line?this._context.lineTo(h,i):this._context.moveTo(h,i);break;case 1:this._point=2,this._x1=h,this._y1=i;break;case 2:this._point=3;default:point$3(this,h,i);break}this._x0=this._x1,this._x1=this._x2,this._x2=h,this._y0=this._y1,this._y1=this._y2,this._y2=i}};const cardinal=function h(i){function g(_){return new Cardinal(_,i)}return g.tension=function(_){return h(+_)},g}(0);function CardinalClosed(h,i){this._context=h,this._k=(1-i)/6}CardinalClosed.prototype={areaStart:noop,areaEnd:noop,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x3,this._y3),this._context.closePath();break}case 2:{this._context.lineTo(this._x3,this._y3),this._context.closePath();break}case 3:{this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5);break}}},point:function(h,i){switch(h=+h,i=+i,this._point){case 0:this._point=1,this._x3=h,this._y3=i;break;case 1:this._point=2,this._context.moveTo(this._x4=h,this._y4=i);break;case 2:this._point=3,this._x5=h,this._y5=i;break;default:point$3(this,h,i);break}this._x0=this._x1,this._x1=this._x2,this._x2=h,this._y0=this._y1,this._y1=this._y2,this._y2=i}};const cardinalClosed=function h(i){function g(_){return new CardinalClosed(_,i)}return g.tension=function(_){return h(+_)},g}(0);function CardinalOpen(h,i){this._context=h,this._k=(1-i)/6}CardinalOpen.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(h,i){switch(h=+h,i=+i,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:point$3(this,h,i);break}this._x0=this._x1,this._x1=this._x2,this._x2=h,this._y0=this._y1,this._y1=this._y2,this._y2=i}};const cardinalOpen=function h(i){function g(_){return new CardinalOpen(_,i)}return g.tension=function(_){return h(+_)},g}(0);function point$2(h,i,g){var _=h._x1,j=h._y1,$=h._x2,_n=h._y2;if(h._l01_a>epsilon$1){var _i=2*h._l01_2a+3*h._l01_a*h._l12_a+h._l12_2a,_s=3*h._l01_a*(h._l01_a+h._l12_a);_=(_*_i-h._x0*h._l12_2a+h._x2*h._l01_2a)/_s,j=(j*_i-h._y0*h._l12_2a+h._y2*h._l01_2a)/_s}if(h._l23_a>epsilon$1){var ga=2*h._l23_2a+3*h._l23_a*h._l12_a+h._l12_2a,ba=3*h._l23_a*(h._l23_a+h._l12_a);$=($*ga+h._x1*h._l23_2a-i*h._l12_2a)/ba,_n=(_n*ga+h._y1*h._l23_2a-g*h._l12_2a)/ba}h._context.bezierCurveTo(_,j,$,_n,h._x2,h._y2)}function CatmullRom(h,i){this._context=h,this._alpha=i}CatmullRom.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x2,this._y2);break;case 3:this.point(this._x2,this._y2);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(h,i){if(h=+h,i=+i,this._point){var g=this._x2-h,_=this._y2-i;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(g*g+_*_,this._alpha))}switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(h,i):this._context.moveTo(h,i);break;case 1:this._point=2;break;case 2:this._point=3;default:point$2(this,h,i);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=h,this._y0=this._y1,this._y1=this._y2,this._y2=i}};const catmullRom=function h(i){function g(_){return i?new CatmullRom(_,i):new Cardinal(_,0)}return g.alpha=function(_){return h(+_)},g}(.5);function CatmullRomClosed(h,i){this._context=h,this._alpha=i}CatmullRomClosed.prototype={areaStart:noop,areaEnd:noop,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._x5=this._y0=this._y1=this._y2=this._y3=this._y4=this._y5=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x3,this._y3),this._context.closePath();break}case 2:{this._context.lineTo(this._x3,this._y3),this._context.closePath();break}case 3:{this.point(this._x3,this._y3),this.point(this._x4,this._y4),this.point(this._x5,this._y5);break}}},point:function(h,i){if(h=+h,i=+i,this._point){var g=this._x2-h,_=this._y2-i;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(g*g+_*_,this._alpha))}switch(this._point){case 0:this._point=1,this._x3=h,this._y3=i;break;case 1:this._point=2,this._context.moveTo(this._x4=h,this._y4=i);break;case 2:this._point=3,this._x5=h,this._y5=i;break;default:point$2(this,h,i);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=h,this._y0=this._y1,this._y1=this._y2,this._y2=i}};const catmullRomClosed=function h(i){function g(_){return i?new CatmullRomClosed(_,i):new CardinalClosed(_,0)}return g.alpha=function(_){return h(+_)},g}(.5);function CatmullRomOpen(h,i){this._context=h,this._alpha=i}CatmullRomOpen.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._x2=this._y0=this._y1=this._y2=NaN,this._l01_a=this._l12_a=this._l23_a=this._l01_2a=this._l12_2a=this._l23_2a=this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(h,i){if(h=+h,i=+i,this._point){var g=this._x2-h,_=this._y2-i;this._l23_a=Math.sqrt(this._l23_2a=Math.pow(g*g+_*_,this._alpha))}switch(this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3,this._line?this._context.lineTo(this._x2,this._y2):this._context.moveTo(this._x2,this._y2);break;case 3:this._point=4;default:point$2(this,h,i);break}this._l01_a=this._l12_a,this._l12_a=this._l23_a,this._l01_2a=this._l12_2a,this._l12_2a=this._l23_2a,this._x0=this._x1,this._x1=this._x2,this._x2=h,this._y0=this._y1,this._y1=this._y2,this._y2=i}};const catmullRomOpen=function h(i){function g(_){return i?new CatmullRomOpen(_,i):new CardinalOpen(_,0)}return g.alpha=function(_){return h(+_)},g}(.5);function LinearClosed(h){this._context=h}LinearClosed.prototype={areaStart:noop,areaEnd:noop,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(h,i){h=+h,i=+i,this._point?this._context.lineTo(h,i):(this._point=1,this._context.moveTo(h,i))}};function linearClosed(h){return new LinearClosed(h)}function sign(h){return h<0?-1:1}function slope3(h,i,g){var _=h._x1-h._x0,j=i-h._x1,$=(h._y1-h._y0)/(_||j<0&&-0),_n=(g-h._y1)/(j||_<0&&-0),_i=($*j+_n*_)/(_+j);return(sign($)+sign(_n))*Math.min(Math.abs($),Math.abs(_n),.5*Math.abs(_i))||0}function slope2(h,i){var g=h._x1-h._x0;return g?(3*(h._y1-h._y0)/g-i)/2:i}function point$1(h,i,g){var _=h._x0,j=h._y0,$=h._x1,_n=h._y1,_i=($-_)/3;h._context.bezierCurveTo(_+_i,j+_i*i,$-_i,_n-_i*g,$,_n)}function MonotoneX(h){this._context=h}MonotoneX.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:point$1(this,this._t0,slope2(this,this._t0));break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(h,i){var g=NaN;if(h=+h,i=+i,!(h===this._x1&&i===this._y1)){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(h,i):this._context.moveTo(h,i);break;case 1:this._point=2;break;case 2:this._point=3,point$1(this,slope2(this,g=slope3(this,h,i)),g);break;default:point$1(this,this._t0,g=slope3(this,h,i));break}this._x0=this._x1,this._x1=h,this._y0=this._y1,this._y1=i,this._t0=g}}};function MonotoneY(h){this._context=new ReflectContext(h)}(MonotoneY.prototype=Object.create(MonotoneX.prototype)).point=function(h,i){MonotoneX.prototype.point.call(this,i,h)};function ReflectContext(h){this._context=h}ReflectContext.prototype={moveTo:function(h,i){this._context.moveTo(i,h)},closePath:function(){this._context.closePath()},lineTo:function(h,i){this._context.lineTo(i,h)},bezierCurveTo:function(h,i,g,_,j,$){this._context.bezierCurveTo(i,h,_,g,$,j)}};function monotoneX(h){return new MonotoneX(h)}function monotoneY(h){return new MonotoneY(h)}function Natural(h){this._context=h}Natural.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var h=this._x,i=this._y,g=h.length;if(g)if(this._line?this._context.lineTo(h[0],i[0]):this._context.moveTo(h[0],i[0]),g===2)this._context.lineTo(h[1],i[1]);else for(var _=controlPoints(h),j=controlPoints(i),$=0,_n=1;_n<g;++$,++_n)this._context.bezierCurveTo(_[0][$],j[0][$],_[1][$],j[1][$],h[_n],i[_n]);(this._line||this._line!==0&&g===1)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(h,i){this._x.push(+h),this._y.push(+i)}};function controlPoints(h){var i,g=h.length-1,_,j=new Array(g),$=new Array(g),_n=new Array(g);for(j[0]=0,$[0]=2,_n[0]=h[0]+2*h[1],i=1;i<g-1;++i)j[i]=1,$[i]=4,_n[i]=4*h[i]+2*h[i+1];for(j[g-1]=2,$[g-1]=7,_n[g-1]=8*h[g-1]+h[g],i=1;i<g;++i)_=j[i]/$[i-1],$[i]-=_,_n[i]-=_*_n[i-1];for(j[g-1]=_n[g-1]/$[g-1],i=g-2;i>=0;--i)j[i]=(_n[i]-j[i+1])/$[i];for($[g-1]=(h[g]+j[g-1])/2,i=0;i<g-1;++i)$[i]=2*h[i+1]-j[i+1];return[j,$]}function natural(h){return new Natural(h)}function Step(h,i){this._context=h,this._t=i}Step.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&this._point===2&&this._context.lineTo(this._x,this._y),(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(h,i){switch(h=+h,i=+i,this._point){case 0:this._point=1,this._line?this._context.lineTo(h,i):this._context.moveTo(h,i);break;case 1:this._point=2;default:{if(this._t<=0)this._context.lineTo(this._x,i),this._context.lineTo(h,i);else{var g=this._x*(1-this._t)+h*this._t;this._context.lineTo(g,this._y),this._context.lineTo(g,i)}break}}this._x=h,this._y=i}};function step(h){return new Step(h,.5)}function stepBefore(h){return new Step(h,0)}function stepAfter(h){return new Step(h,1)}function none$1(h,i){if((_n=h.length)>1)for(var g=1,_,j,$=h[i[0]],_n,_i=$.length;g<_n;++g)for(j=$,$=h[i[g]],_=0;_<_i;++_)$[_][1]+=$[_][0]=isNaN(j[_][1])?j[_][0]:j[_][1]}function none(h){for(var i=h.length,g=new Array(i);--i>=0;)g[i]=i;return g}function stackValue(h,i){return h[i]}function stackSeries(h){const i=[];return i.key=h,i}function stack(){var h=constant([]),i=none,g=none$1,_=stackValue;function j($){var _n=Array.from(h.apply(this,arguments),stackSeries),_i,_s=_n.length,ga=-1,ba;for(const xa of $)for(_i=0,++ga;_i<_s;++_i)(_n[_i][ga]=[0,+_(xa,_n[_i].key,ga,$)]).data=xa;for(_i=0,ba=array(i(_n));_i<_s;++_i)_n[ba[_i]].index=_i;return g(_n,ba),_n}return j.keys=function($){return arguments.length?(h=typeof $=="function"?$:constant(Array.from($)),j):h},j.value=function($){return arguments.length?(_=typeof $=="function"?$:constant(+$),j):_},j.order=function($){return arguments.length?(i=$==null?none:typeof $=="function"?$:constant(Array.from($)),j):i},j.offset=function($){return arguments.length?(g=$??none$1,j):g},j}function expand(h,i){if((_=h.length)>0){for(var g,_,j=0,$=h[0].length,_n;j<$;++j){for(_n=g=0;g<_;++g)_n+=h[g][j][1]||0;if(_n)for(g=0;g<_;++g)h[g][j][1]/=_n}none$1(h,i)}}function diverging(h,i){if((_s=h.length)>0)for(var g,_=0,j,$,_n,_i,_s,ga=h[i[0]].length;_<ga;++_)for(_n=_i=0,g=0;g<_s;++g)($=(j=h[i[g]][_])[1]-j[0])>0?(j[0]=_n,j[1]=_n+=$):$<0?(j[1]=_i,j[0]=_i+=$):(j[0]=0,j[1]=$)}function silhouette(h,i){if((j=h.length)>0){for(var g=0,_=h[i[0]],j,$=_.length;g<$;++g){for(var _n=0,_i=0;_n<j;++_n)_i+=h[_n][g][1]||0;_[g][1]+=_[g][0]=-_i/2}none$1(h,i)}}function wiggle(h,i){if(!(!((_n=h.length)>0)||!(($=(j=h[i[0]]).length)>0))){for(var g=0,_=1,j,$,_n;_<$;++_){for(var _i=0,_s=0,ga=0;_i<_n;++_i){for(var ba=h[i[_i]],xa=ba[_][1]||0,El=ba[_-1][1]||0,Tl=(xa-El)/2,Sl=0;Sl<_i;++Sl){var Il=h[i[Sl]],Cl=Il[_][1]||0,Nl=Il[_-1][1]||0;Tl+=Cl-Nl}_s+=xa,ga+=Tl*xa}j[_-1][1]+=j[_-1][0]=g,_s&&(g-=ga/_s)}j[_-1][1]+=j[_-1][0]=g,none$1(h,i)}}function appearance(h){var i=h.map(peak);return none(h).sort(function(g,_){return i[g]-i[_]})}function peak(h){for(var i=-1,g=0,_=h.length,j,$=-1/0;++i<_;)(j=+h[i][1])>$&&($=j,g=i);return g}function ascending(h){var i=h.map(sum);return none(h).sort(function(g,_){return i[g]-i[_]})}function sum(h){for(var i=0,g=-1,_=h.length,j;++g<_;)(j=+h[g][1])&&(i+=j);return i}function descending(h){return ascending(h).reverse()}function insideOut(h){var i=h.length,g,_,j=h.map(sum),$=appearance(h),_n=0,_i=0,_s=[],ga=[];for(g=0;g<i;++g)_=$[g],_n<_i?(_n+=j[_],_s.push(_)):(_i+=j[_],ga.push(_));return ga.reverse().concat(_s)}function reverse(h){return none(h).reverse()}const d3Shape=Object.freeze(Object.defineProperty({__proto__:null,arc,area,areaRadial,curveBasis:basis,curveBasisClosed:basisClosed,curveBasisOpen:basisOpen,curveBumpX:bumpX,curveBumpY:bumpY,curveBundle:bundle,curveCardinal:cardinal,curveCardinalClosed:cardinalClosed,curveCardinalOpen:cardinalOpen,curveCatmullRom:catmullRom,curveCatmullRomClosed:catmullRomClosed,curveCatmullRomOpen:catmullRomOpen,curveLinear,curveLinearClosed:linearClosed,curveMonotoneX:monotoneX,curveMonotoneY:monotoneY,curveNatural:natural,curveStep:step,curveStepAfter:stepAfter,curveStepBefore:stepBefore,line,lineRadial:lineRadial$1,link,linkHorizontal,linkRadial,linkVertical,pie,pointRadial,radialArea:areaRadial,radialLine:lineRadial$1,stack,stackOffsetDiverging:diverging,stackOffsetExpand:expand,stackOffsetNone:none$1,stackOffsetSilhouette:silhouette,stackOffsetWiggle:wiggle,stackOrderAppearance:appearance,stackOrderAscending:ascending,stackOrderDescending:descending,stackOrderInsideOut:insideOut,stackOrderNone:none,stackOrderReverse:reverse,symbol:Symbol$1,symbolAsterisk:asterisk,symbolCircle:circle$1,symbolCross:cross,symbolDiamond:diamond,symbolDiamond2:diamond2,symbolPlus:plus,symbolSquare:square,symbolSquare2:square2,symbolStar:star,symbolTimes:times,symbolTriangle:triangle,symbolTriangle2:triangle2,symbolWye:wye,symbolX:times,symbols:symbolsFill,symbolsFill,symbolsStroke},Symbol.toStringTag,{value:"Module"}));var defined=function(h){var i=h._y1!==void 0?h._y1:h._y;return i!=null&&h._y0!==null},getXAccessor=function(h){return function(i){return h.x(i._x1!==void 0?i._x1:i._x)}},getYAccessor=function(h){return function(i){return h.y(i._y1!==void 0?i._y1:i._y)}},getAngleAccessor=function(h){return function(i){var g=h.x(i._x1!==void 0?i._x1:i._x);return-1*g+Math.PI/2}},toNewName=function(h){var i=function(g){return g&&g[0].toUpperCase()+g.slice(1)};return"curve".concat(i(h))},toNewNameClosed=function(h){return"".concat(toNewName(h),"Closed")},getInterpolationFunction=function(h){var i=h.interpolation;if(typeof i=="function")return i;if(typeof i=="string"){var g=h.polar,_=h.openCurve,j=_===void 0?!g:_,$=j?toNewName(i):toNewNameClosed(i);return d3Shape[$]}return curveLinear},getLineFunction=function(h){var i=h.polar,g=h.scale,_=h.horizontal;return i?lineRadial$1().defined(defined).curve(getInterpolationFunction(h)).angle(getAngleAccessor(g)).radius(getYAccessor(g)):line().defined(defined).curve(getInterpolationFunction(h)).x(_?getYAccessor(g):getXAccessor(g)).y(_?getXAccessor(g):getYAccessor(g))},baseIteratee$1=_baseIteratee,baseUniq=_baseUniq;function uniqBy(h,i){return h&&h.length?baseUniq(h,baseIteratee$1(i)):[]}var uniqBy_1=uniqBy;function arrayAggregator$1(h,i,g,_){for(var j=-1,$=h==null?0:h.length;++j<$;){var _n=h[j];i(_,_n,g(_n),h)}return _}var _arrayAggregator=arrayAggregator$1,baseEach=_baseEach;function baseAggregator$1(h,i,g,_){return baseEach(h,function(j,$,_n){i(_,j,g(j),_n)}),_}var _baseAggregator=baseAggregator$1,arrayAggregator=_arrayAggregator,baseAggregator=_baseAggregator,baseIteratee=_baseIteratee,isArray=isArray_1;function createAggregator$1(h,i){return function(g,_){var j=isArray(g)?arrayAggregator:baseAggregator,$=i?i():{};return j(g,h,baseIteratee(_),$)}}var _createAggregator=createAggregator$1,baseAssignValue=_baseAssignValue,createAggregator=_createAggregator,objectProto=Object.prototype,hasOwnProperty=objectProto.hasOwnProperty,groupBy=createAggregator(function(h,i,g){hasOwnProperty.call(h,g)?h[g].push(i):baseAssignValue(h,g,[i])}),groupBy_1=groupBy;function _toConsumableArray$6(h){return _arrayWithoutHoles$6(h)||_iterableToArray$6(h)||_unsupportedIterableToArray$7(h)||_nonIterableSpread$6()}function _nonIterableSpread$6(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _unsupportedIterableToArray$7(h,i){if(h){if(typeof h=="string")return _arrayLikeToArray$7(h,i);var g=Object.prototype.toString.call(h).slice(8,-1);if(g==="Object"&&h.constructor&&(g=h.constructor.name),g==="Map"||g==="Set")return Array.from(h);if(g==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(g))return _arrayLikeToArray$7(h,i)}}function _iterableToArray$6(h){if(typeof Symbol<"u"&&h[Symbol.iterator]!=null||h["@@iterator"]!=null)return Array.from(h)}function _arrayWithoutHoles$6(h){if(Array.isArray(h))return _arrayLikeToArray$7(h)}function _arrayLikeToArray$7(h,i){(i==null||i>h.length)&&(i=h.length);for(var g=0,_=new Array(i);g<i;g++)_[g]=h[g];return _}function ownKeys$a(h,i){var g=Object.keys(h);if(Object.getOwnPropertySymbols){var _=Object.getOwnPropertySymbols(h);i&&(_=_.filter(function(j){return Object.getOwnPropertyDescriptor(h,j).enumerable})),g.push.apply(g,_)}return g}function _objectSpread$a(h){for(var i=1;i<arguments.length;i++){var g=arguments[i]!=null?arguments[i]:{};i%2?ownKeys$a(Object(g),!0).forEach(function(_){_defineProperty$b(h,_,g[_])}):Object.getOwnPropertyDescriptors?Object.defineProperties(h,Object.getOwnPropertyDescriptors(g)):ownKeys$a(Object(g)).forEach(function(_){Object.defineProperty(h,_,Object.getOwnPropertyDescriptor(g,_))})}return h}function _defineProperty$b(h,i,g){return i in h?Object.defineProperty(h,i,{value:g,enumerable:!0,configurable:!0,writable:!0}):h[i]=g,h}function addBinsToParentPropsIfHistogram(h){var i=h.children,g=h.props,_=h.childComponents,j=h.parentProps,$=i.some(function(ba){return ba.type&&ba.type.role==="histogram"}),_n=$&&i.length&&i.every(function(ba){return ba.type&&ba.type.role==="histogram"});if(!_n)return j;var _i=g.bins||_[0].props.bins;if(!Array.isArray(_i)){var _s=i.reduce(function(ba,xa){var El=createAccessor(xa.props.x||"x");return ba.concat(xa.props.data.map(function(Tl){return{x:El(Tl)}}))},[]),ga=i[0].type.getFormattedData;_i=ga({data:_s,bins:_i}).reduce(function(ba,xa,El){var Tl=xa.x0,Sl=xa.x1;return El===0?ba.concat([Tl,Sl]):ba.concat(Sl)},[])}return _objectSpread$a(_objectSpread$a({},j),{},{bins:_i})}function getDataFromChildren(h,i){var g=h.polar,_=h.startAngle,j=h.endAngle,$=h.categories,_n=h.minDomain,_i=h.maxDomain,_s={polar:g,startAngle:_,endAngle:j,categories:$,minDomain:_n,maxDomain:_i},ga=0,ba=i?i.slice(0):React.Children.toArray(h.children);_s=addBinsToParentPropsIfHistogram({children:ba,props:h,childComponents:i,parentProps:_s});var xa=function(Cl,Nl,Dl){var Ul=assign_1({},Cl.props,_s),Kl;if(isDataComponent(Cl))Cl.type&&isFunction_1(Cl.type.getData)?(Cl=Dl?React.cloneElement(Cl,Dl.props):Cl,Kl=Cl.type.getData(Ul)):Kl=getData(Ul);else return null;return ga+=1,Kl.map(function(Jl,Ep){return assign_1({_stack:ga,_group:Ep},Jl)})},El=ba.filter(function(Cl){return Cl.type&&Cl.type.role==="stack"}).length,Tl=function(Cl,Nl){return Cl.concat(uniqBy_1(Nl,"_group"))},Sl=reduceChildren(ba,xa,h,[],Tl),Il=El?"_group":"_stack";return values_1(groupBy_1(Sl,Il))}function getWidth(h,i,g){var _=h.datasets,j=h.horizontal,$=j?getRange$1(h,"y"):getRange$1(h,"x"),_n=Math.abs($[1]-$[0]);g=g!==void 0?g:Array.isArray(_[0])&&_[0].length||1,i=i||_.length;var _i=i*g,_s=.5;return Math.round(_s*_n/_i)}function getDefaultDomainPadding(h,i,g){if(!(h.polar||i!=="x")){var _=g.filter(function(El){return El.type&&El.type.role&&El.type.role==="group"});if(!(_.length<1)){var j=_[0].props,$=j.offset,_n=j.children;if($){var _i=Array.isArray(_n)&&_n[0];if(_i){var _s=_i.props.barWidth,ga=_i.props.data&&_i.props.data.length||1;if(_i&&_i.type.role==="stack"){var ba=_i.props.children&&_i.props.children[0];if(!ba)return;_s=ba.props.barWidth,ga=_i.props.children.length}var xa=_s||getWidth(h,_n.length,ga);return{x:xa*_n.length/2+($-xa*((_n.length-1)/2))}}}}}}function getDomainFromChildren(h,i,g){var _=g?g.slice(0):React.Children.toArray(h.children),j=h.data?getData(h):void 0,$=h.polar,_n=h.startAngle,_i=h.endAngle,_s=h.categories,ga=h.minDomain,ba=h.maxDomain,xa=h.horizontal,El={horizontal:xa,polar:$,startAngle:_n,endAngle:_i,minDomain:ga,maxDomain:ba,categories:_s},Tl=j?assign_1(El,{data:j}):El,Sl=function(Dl){var Ul=assign_1({},Dl.props,Tl);if(isDomainComponent(Dl)){if(Dl.type&&isFunction_1(Dl.type.getDomain))return Dl.props&&Dl.type.getDomain(Ul,i)}else return null;return getDomain$3(Ul,i)},Il=reduceChildren(_,Sl,h),Cl=Il.length===0?0:getMinValue(Il),Nl=Il.length===0?1:getMaxValue(Il);return[Cl,Nl]}function getDomain$1(h,i,g){g=g||React.Children.toArray(h.children);var _=getDomainFromProps(h,i),j=getDefaultDomainPadding(h,i,g),$;if(_)$=_;else{var _n=getMinFromProps(h,i),_i=getMaxFromProps(h,i),_s=(h.data||h.y)&&getData(h),ga=_s?getDomainFromData$1(h,i,_s):[],ba=getDomainFromChildren(h,i,g),xa=_n||getMinValue([].concat(_toConsumableArray$6(ga),_toConsumableArray$6(ba))),El=_i||getMaxValue([].concat(_toConsumableArray$6(ga),_toConsumableArray$6(ba)));$=getDomainFromMinMax(xa,El)}return formatDomain($,assign_1({domainPadding:j},h),i)}function getScale$2(h,i,g){if(h.data)return getBaseScale(h,i);var _=g?g.slice(0):React.Children.toArray(h.children),j=function(_n){var _i=assign_1({},_n.props,{horizontal:h.horizontal});return getScaleType(_i,i)},$=uniq_1(reduceChildren(_,j,h));return $.length>1?getScaleFromName("linear"):getScaleFromName($[0])}function getAllEvents(h){var i=["groupComponent","containerComponent","labelComponent"],g=getComponentEvents(h,i),_=h.events;return Array.isArray(g)&&(_=Array.isArray(h.events)?g.concat.apply(g,_toConsumableArray$6(h.events)):g),_||[]}function getColor(h,i,g){var _=h.style,j=h.colorScale,$=h.color;if(_&&_.data&&_.data.fill)return _.data.fill;if(j=i.props&&i.props.colorScale?i.props.colorScale:j,$=i.props&&i.props.color?i.props.color:$,!(!j&&!$)){var _n=Array.isArray(j)?j:getColorScale$1(j);return $||_n[g%_n.length]}}function getStyle$1(h,i,g){var _=h&&h[g]&&h[g].style?h[g].style:{};return getStyles$4(i,_)}function getChildStyle(h,i,g){var _=g.style,j=g.role,$=h.props.style||{};if(Array.isArray($))return $;var _n=h.type&&h.type.role,_i=_n==="stack"?void 0:getColor(g,h,i),_s=_n==="line"?{fill:"none",stroke:_i}:{fill:_i},ga=j==="stack"?{}:{width:getWidth(g)},ba=defaults_1({},$.data,assign_1({},ga,_.data,_s)),xa=defaults_1({},$.labels,_.labels);return{parent:_.parent,data:ba,labels:xa}}function getStringsFromCategories(h,i){var g=function(_){var j=_.props||{};if(!isDomainComponent(_)||!j.categories)return null;var $=j.categories&&!Array.isArray(j.categories)?j.categories[i]:j.props.categories,_n=$&&$.filter(function(_i){return typeof _i=="string"});return _n?removeUndefined(_n):[]};return reduceChildren(h.slice(0),g)}function getStringsFromData(h){var i=function(j){var $=j.props||{},_n;if(isDataComponent(j))j.type&&isFunction_1(j.type.getData)?_n=j.type.getData($):_n=getData($);else return null;return _n.map(function(_i){return{x:_i.xName,y:_i.yName}})},g={x:[],y:[]},_=function(j,$){var _n=Array.isArray($)?$.map(function(_s){return _s.x}).filter(Boolean):$.x,_i=Array.isArray($)?$.map(function(_s){return _s.y}).filter(Boolean):$.y;return{x:_n!==void 0?j.x.concat(_n):j.x,y:_i!==void 0?j.y.concat(_i):j.y}};return reduceChildren(h.slice(0),i,{},g,_)}function getCategoryAndAxisStringsFromChildren(h,i,g){var _=isPlainObject_1(h.categories)?h.categories[i]:h.categories,j=getAxisComponent(g,i),$=j?getStringsFromAxes(j.props,i):[],_n=_||getStringsFromCategories(g,i);return uniq_1(flatten_1([].concat(_toConsumableArray$6(_n),_toConsumableArray$6($))))}function getStringsFromChildren(h,i){i=i||React.Children.toArray(h.children);var g=getCategoryAndAxisStringsFromChildren(h,"x",i),_=getCategoryAndAxisStringsFromChildren(h,"y",i),j=getStringsFromData(i);return{x:uniq_1(flatten_1([].concat(_toConsumableArray$6(g),_toConsumableArray$6(j.x)))),y:uniq_1(flatten_1([].concat(_toConsumableArray$6(_),_toConsumableArray$6(j.y))))}}function getCategories(h,i,g){var _=h.categories&&!Array.isArray(h.categories)?h.categories.x:h.categories,j=h.categories&&!Array.isArray(h.categories)?h.categories.y:h.categories,$=!_||!j,_n=$?g||getStringsFromChildren(h,i):{},_i=_||_n.x,_s=j||_n.y;return{x:_i.length>0?_i:void 0,y:_s.length>0?_s:void 0}}function _toConsumableArray$5(h){return _arrayWithoutHoles$5(h)||_iterableToArray$5(h)||_unsupportedIterableToArray$6(h)||_nonIterableSpread$5()}function _nonIterableSpread$5(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _unsupportedIterableToArray$6(h,i){if(h){if(typeof h=="string")return _arrayLikeToArray$6(h,i);var g=Object.prototype.toString.call(h).slice(8,-1);if(g==="Object"&&h.constructor&&(g=h.constructor.name),g==="Map"||g==="Set")return Array.from(h);if(g==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(g))return _arrayLikeToArray$6(h,i)}}function _iterableToArray$5(h){if(typeof Symbol<"u"&&h[Symbol.iterator]!=null||h["@@iterator"]!=null)return Array.from(h)}function _arrayWithoutHoles$5(h){if(Array.isArray(h))return _arrayLikeToArray$6(h)}function _arrayLikeToArray$6(h,i){(i==null||i>h.length)&&(i=h.length);for(var g=0,_=new Array(i);g<i;g++)_[g]=h[g];return _}function _defineProperty$a(h,i,g){return i in h?Object.defineProperty(h,i,{value:g,enumerable:!0,configurable:!0,writable:!0}):h[i]=g,h}var orientationSign={top:-1,left:-1,right:1,bottom:1},exists=function(h){return h!=null},getCurrentAxis=function(h,i){var g=h.orientation,_=h.horizontal;if(g){var j={top:"x",bottom:"x",left:"y",right:"y"};return j[g]}var $=i==="x"?"y":"x";return _?$:i},getScale$1=function(h){var i=getAxis(h),g=getCurrentAxis(h,i),_=getBaseScale(h,i),j=h.domain&&h.domain[i],$=j||getDomain$2(h)||_.domain();return _.range(getRange$1(h,g)),_.domain($),_},getStyleObject$1=function(h){var i=h.theme,g=h.dependentAxis,_=i&&i.axis&&i.axis.style,j=g?"dependentAxis":"independentAxis",$=i&&i[j]&&i[j].style,_n=function(){var _i=["axis","axisLabel","grid","parent","tickLabels","ticks"];return _i.reduce(function(_s,ga){return _s[ga]=defaults_1({},$[ga],_[ga]),_s},{})};return _&&$?_n():$||_},getStyles$2=function(h,i){var g=h.style||{};i=i||{};var _={height:"100%",width:"100%"};return{parent:defaults_1(g.parent,i.parent,_),axis:defaults_1({},g.axis,i.axis),axisLabel:defaults_1({},g.axisLabel,i.axisLabel),grid:defaults_1({},g.grid,i.grid),ticks:defaults_1({},g.ticks,i.ticks),tickLabels:defaults_1({},g.tickLabels,i.tickLabels)}},getTickProps$1=function(h,i,g){var _=h.position,j=h.transform;return{x1:j.x,y1:j.y,x2:j.x+_.x2,y2:j.y+_.y2,style:i,datum:g}},getTickLabelProps$1=function(h,i,g,_,j){var $=h.position,_n=h.transform;return{style:i,x:_n.x+$.x,y:_n.y+$.y,verticalAnchor:g.verticalAnchor,textAnchor:g.textAnchor,angle:i.angle,text:j,datum:_}},getGridProps$1=function(h,i,g){var _=h.edge,j=h.transform;return{x1:j.x,y1:j.y,x2:_.x+j.x,y2:_.y+j.y,style:i,datum:g}},getAxisProps$2=function(h,i,g){var _=i.style,j=i.padding,$=i.isVertical,_n=h.width,_i=h.height;return{style:_.axis,x1:$?g.x:j.left+g.x,x2:$?g.x:_n-j.right+g.x,y1:$?j.top+g.y:g.y,y2:$?_i-j.bottom+g.y:g.y}},getEvaluatedStyles$1=function(h,i){return{tickStyle:evaluateStyle(h.ticks,i),labelStyle:evaluateStyle(h.tickLabels,i),gridStyle:evaluateStyle(h.grid,i)}},getAxisLabelProps$1=function(h,i,g){var _=i.style,j=i.orientation,$=i.padding,_n=i.labelPadding,_i=i.isVertical,_s=orientationSign[j],ga=$.left+$.right,ba=$.top+$.bottom,xa=_s<0?"end":"start",El=_.axisLabel,Tl=_i?-90:0,Sl=_i?g.x+_s*_n:(h.width-ga)/2+$.left+g.x,Il=_i?(h.height-ba)/2+$.top+g.y:_s*_n+g.y;return{x:Sl,y:Il,verticalAnchor:El.verticalAnchor||xa,textAnchor:El.textAnchor||"middle",angle:El.angle===void 0?Tl:El.angle,style:El,text:h.label}},getAnchors=function(h,i){var g={top:"end",left:"end",right:"start",bottom:"start"},_=g[h];return{textAnchor:i?_:"middle",verticalAnchor:i?"middle":_}},getLabelPadding=function(h,i){var g=i.axisLabel||{};if(g.padding!==void 0&&g.padding!==null)return g.padding;var _=isVertical(h),j=g.fontSize||14;return h.label?j*(_?2.3:1.6):0},getDefaultOrientations=function(h,i,g){var _=i||"positive",j={positive:{x:"bottom",y:"left"},negative:{x:"top",y:"right"}},$={positive:{x:"left",y:"bottom"},negative:{x:"right",y:"top"}};return g?$[_][h]:j[_][h]},getStandaloneOffset=function(h,i){var g=i.style,_=i.scale,j=i.orientation,$=i.padding,_n=i.axis,_i=i.ticks,_s=i.stringTicks,ga=i.isVertical,ba=i.labelPadding,xa=h.polar,El=h.horizontal,Tl={scale:_defineProperty$a({},_n,_),polar:xa,horizontal:El,ticks:_i,stringTicks:_s},Sl=j==="right"?$.right:$.left,Il=j==="top"?$.top:$.bottom,Cl=h.offsetX!==null&&h.offsetX!==void 0?h.offsetX:Sl,Nl=h.offsetY!==null&&h.offsetY!==void 0?h.offsetY:Il,Dl=g.axisLabel.fontSize||14,Ul=_i.map(function(Ip,Up){var yp=_s?h.tickValues[Ip-1]:Ip,Ap=evaluateStyle(g.ticks,assign_1({},Tl,{tick:yp,index:Up}));return Ap.size||0}),Kl=Dl+2*Math.max.apply(Math,_toConsumableArray$5(Ul))+ba,Jl=1.2*Dl,Ep=ga?Kl:Jl,_p=ga?Jl:Kl;return{x:Cl??Ep,y:Nl??_p}},getOffset=function(h,i){var g=i.scale,_=i.origin,j=i.orientation,$=i.orientations,_n=i.domain,_i=i.padding,_s=_i.top,ga=_i.bottom,ba=_i.left,xa=_i.right,El={x:j==="bottom"||j==="top"?j:$.x,y:j==="left"||j==="right"?j:$.y},Tl={x:El.y==="left"?ba:xa,y:El.x==="bottom"?ga:_s},Sl={x:El.y==="left"?0:h.width,y:El.x==="bottom"?h.height:0},Il={x:_.x===_n.x[0]||_.x===_n.x[1]?0:g.x(_.x),y:_.y===_n.y[0]||_.y===_n.y[1]?0:g.y(_.y)},Cl=Il.x?Math.abs(Sl.x-Il.x):Tl.x,Nl=Il.y?Math.abs(Sl.y-Il.y):Tl.y,Dl=exists(h.offsetX)?h.offsetX:Cl,Ul=exists(h.offsetY)?h.offsetY:Nl;return{x:Dl,y:Ul}},getHorizontalOffset=function(h,i){var g=i.scale,_=i.origin,j=i.orientation,$=i.orientations,_n=i.domain,_i=i.padding,_s=_i.top,ga=_i.bottom,ba=_i.left,xa=_i.right,El={y:j==="bottom"||j==="top"?j:$.x,x:j==="left"||j==="right"?j:$.y},Tl={x:El.y==="bottom"?ga:_s,y:El.x==="left"?ba:xa},Sl={y:El.x==="left"?0:h.width,x:El.y==="bottom"?h.height:0},Il={x:_.x===_n.x[0]||_.x===_n.x[1]?0:g.x(_.x),y:_.y===_n.y[0]||_.y===_n.y[1]?0:g.y(_.y)},Cl=Il.x?Math.abs(Sl.x-Il.x):Tl.x,Nl=Il.y?Math.abs(Sl.y-Il.y):Tl.y,Dl=exists(h.offsetX)?h.offsetX:Nl,Ul=exists(h.offsetY)?h.offsetY:Cl;return{x:Dl,y:Ul}},getTransform=function(h,i,g){var _=i.orientation,j=i.axis,$=getAxisValue(h,j);return{top:{x:0,y:$!==void 0?$:g.y},bottom:{x:0,y:$!==void 0?$:h.height-g.y},left:{x:$!==void 0?$:g.x,y:0},right:{x:$!==void 0?$:h.width-g.x,y:0}}[_]},getTickPosition=function(h,i,g){var _=h.tickStyle,j=h.labelStyle,$=_.size||0,_n=_.padding||0,_i=j.padding||0,_s=$+_n+_i,ga=orientationSign[i];return{x:g?ga*_s:0,x2:g?ga*$:0,y:g?0:ga*_s,y2:g?0:ga*$}},getTickTransform=function(h,i,g){return{x:g?i.x:h+i.x,y:g?h+i.y:i.y}},getGridEdge=function(h,i){var g=i.orientation,_=i.padding,j=i.isVertical,$=-orientationSign[g],_n=j?$*(h.width-(_.left+_.right)):0,_i=j?0:$*(h.height-(_.top+_.bottom));return{x:_n,y:_i}},getGridOffset=function(h,i){var g=h.padding,_=h.orientation,j=h.crossAxis,$=_==="right"?g.right:g.left,_n=_==="top"?g.top:g.bottom;return{x:j?i.x-$:0,y:j?i.y-_n:0}},getLayoutProps=function(h,i){var g;return i.domain.x&&i.domain.y?g=h.horizontal?getHorizontalOffset(h,i):getOffset(h,i):g=getStandaloneOffset(h,i),{globalTransform:getTransform(h,i,g),gridOffset:getGridOffset(i,g),gridEdge:getGridEdge(h,i)}},getOrientation=function(h){if(h.orientation)return h.orientation;var i={dependent:h.horizontal?"bottom":"left",independent:h.horizontal?"left":"bottom"};return h.dependentAxis?i.dependent:i.independent},getCalculatedValues$3=function(h){var i=getStyleObject$1(h),g=getStyles$2(h,i),_=getPadding$1(h),j=getLabelPadding(h,g),$=stringTicks(h)?h.tickValues:void 0,_n=getAxis(h),_i=getDomain$2(h),_s=getScale$1(h),ga=_n==="x"?_i:void 0,ba=_n==="y"?_i:void 0,xa=_n==="x"?_s:void 0,El=_n==="y"?_s:void 0,Tl=!(h.crossAxis===!1||h.standalone===!0),Sl=getTicks(h,_s,Tl),Il=getTickFormat(h,_s),Cl={x:getRange$1(h,"x"),y:getRange$1(h,"y")},Nl={x:h.domain&&h.domain.x?h.domain.x:ga,y:h.domain&&h.domain.y?h.domain.y:ba},Dl={x:h.domain&&h.domain.x?getBaseScale(h,"x").domain(h.domain.x).range(h.horizontal?Cl.y:Cl.x):xa,y:h.domain&&h.domain.y?getBaseScale(h,"y").domain(h.domain.y).range(h.horizontal?Cl.x:Cl.y):El},Ul=Nl.x&&Nl.y?getOrigin(Nl):void 0,Kl=Ul?{x:getOriginSign(Ul.x,Nl.x),y:getOriginSign(Ul.y,Nl.y)}:void 0,Jl=Kl?{x:getDefaultOrientations("x",Kl.y,h.horizontal),y:getDefaultOrientations("y",Kl.x,h.horizontal)}:void 0,Ep=Jl?h.orientation||Jl[_n]:getOrientation(h),_p=isVertical(Object.assign({},h,{orientation:Ep})),Ip=getAnchors(Ep,_p);return{anchors:Ip,axis:_n,crossAxis:Tl,domain:Nl,isVertical:_p,labelPadding:j,orientation:Ep,orientations:Jl,origin:Ul,padding:_,scale:Dl,stringTicks:$,style:g,tickFormat:Il,ticks:Sl}},getBaseProps$3=function(h,i){h=modifyProps(h,i);var g=getCalculatedValues$3(h),_=g.axis,j=g.style,$=g.orientation,_n=g.isVertical,_i=g.scale,_s=g.ticks,ga=g.tickFormat,ba=g.anchors,xa=g.domain,El=g.stringTicks,Tl=_==="x"?"y":"x",Sl=h,Il=Sl.width,Cl=Sl.height,Nl=Sl.standalone,Dl=Sl.theme,Ul=Sl.polar,Kl=Sl.padding,Jl=Sl.horizontal,Ep=getLayoutProps(h,g),_p=Ep.globalTransform,Ip=Ep.gridOffset,Up=Ep.gridEdge,yp={scale:_defineProperty$a({},_,_i[_]),polar:Ul,horizontal:Jl,ticks:_s,stringTicks:El},Ap=getAxisProps$2(h,g,_p),Cp=getAxisLabelProps$1(h,g,_p),Mp={parent:assign_1({style:j.parent,ticks:_s,standalone:Nl,theme:Dl,width:Il,height:Cl,padding:Kl,domain:xa},yp)},wp={dimension:Tl,range:_defineProperty$a({},Tl,getRange$1(h,Tl)),scale:h.scale&&h.scale[Tl]?_defineProperty$a({},Tl,h.scale[Tl]):void 0};return _s.reduce(function(Np,Fp,Hp){var xp,Gp,$p,c0=El?El[Hp]:Fp,n0=ga(Fp,Hp,_s),C0=getEvaluatedStyles$1(j,assign_1({},yp,{tick:c0,tickValue:Fp,index:Hp,text:n0})),Op={position:getTickPosition(C0,$,_n),transform:getTickTransform((xp=_i[_])===null||xp===void 0?void 0:xp.call(_i,Fp),_p,_n)},Q0={edge:Up,transform:{x:_n?-Ip.x+_p.x:((Gp=_i[_])===null||Gp===void 0?void 0:Gp.call(_i,Fp))+_p.x,y:_n?(($p=_i[_])===null||$p===void 0?void 0:$p.call(_i,Fp))+_p.y:Ip.y+_p.y}};return Np[Hp]={axis:assign_1({dimension:_},yp,Ap),axisLabel:assign_1({},yp,Cp),ticks:assign_1({},yp,getTickProps$1(Op,C0.tickStyle,Fp)),tickLabels:assign_1({},yp,getTickLabelProps$1(Op,C0.labelStyle,ba,Fp,n0)),grid:assign_1({},yp,wp,getGridProps$1(Q0,C0.gridStyle,Fp))},Np},Mp)};function ownKeys$9(h,i){var g=Object.keys(h);if(Object.getOwnPropertySymbols){var _=Object.getOwnPropertySymbols(h);i&&(_=_.filter(function(j){return Object.getOwnPropertyDescriptor(h,j).enumerable})),g.push.apply(g,_)}return g}function _objectSpread$9(h){for(var i=1;i<arguments.length;i++){var g=arguments[i]!=null?arguments[i]:{};i%2?ownKeys$9(Object(g),!0).forEach(function(_){_defineProperty$9(h,_,g[_])}):Object.getOwnPropertyDescriptors?Object.defineProperties(h,Object.getOwnPropertyDescriptors(g)):ownKeys$9(Object(g)).forEach(function(_){Object.defineProperty(h,_,Object.getOwnPropertyDescriptor(g,_))})}return h}function _defineProperty$9(h,i,g){return i in h?Object.defineProperty(h,i,{value:g,enumerable:!0,configurable:!0,writable:!0}):h[i]=g,h}function _toConsumableArray$4(h){return _arrayWithoutHoles$4(h)||_iterableToArray$4(h)||_unsupportedIterableToArray$5(h)||_nonIterableSpread$4()}function _nonIterableSpread$4(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _unsupportedIterableToArray$5(h,i){if(h){if(typeof h=="string")return _arrayLikeToArray$5(h,i);var g=Object.prototype.toString.call(h).slice(8,-1);if(g==="Object"&&h.constructor&&(g=h.constructor.name),g==="Map"||g==="Set")return Array.from(h);if(g==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(g))return _arrayLikeToArray$5(h,i)}}function _iterableToArray$4(h){if(typeof Symbol<"u"&&h[Symbol.iterator]!=null||h["@@iterator"]!=null)return Array.from(h)}function _arrayWithoutHoles$4(h){if(Array.isArray(h))return _arrayLikeToArray$5(h)}function _arrayLikeToArray$5(h,i){(i==null||i>h.length)&&(i=h.length);for(var g=0,_=new Array(i);g<i;g++)_[g]=h[g];return _}function _classCallCheck$4(h,i){if(!(h instanceof i))throw new TypeError("Cannot call a class as a function")}function _defineProperties$4(h,i){for(var g=0;g<i.length;g++){var _=i[g];_.enumerable=_.enumerable||!1,_.configurable=!0,"value"in _&&(_.writable=!0),Object.defineProperty(h,_.key,_)}}function _createClass$4(h,i,g){return i&&_defineProperties$4(h.prototype,i),g&&_defineProperties$4(h,g),Object.defineProperty(h,"prototype",{writable:!1}),h}function _inherits$4(h,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");h.prototype=Object.create(i&&i.prototype,{constructor:{value:h,writable:!0,configurable:!0}}),Object.defineProperty(h,"prototype",{writable:!1}),i&&_setPrototypeOf$4(h,i)}function _setPrototypeOf$4(h,i){return _setPrototypeOf$4=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(_,j){return _.__proto__=j,_},_setPrototypeOf$4(h,i)}function _createSuper$4(h){var i=_isNativeReflectConstruct$4();return function(){var _=_getPrototypeOf$4(h),j;if(i){var $=_getPrototypeOf$4(this).constructor;j=Reflect.construct(_,arguments,$)}else j=_.apply(this,arguments);return _possibleConstructorReturn$4(this,j)}}function _possibleConstructorReturn$4(h,i){if(i&&(typeof i=="object"||typeof i=="function"))return i;if(i!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$4(h)}function _assertThisInitialized$4(h){if(h===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return h}function _isNativeReflectConstruct$4(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function _getPrototypeOf$4(h){return _getPrototypeOf$4=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(g){return g.__proto__||Object.getPrototypeOf(g)},_getPrototypeOf$4(h)}var fallbackProps$7={width:450,height:300,padding:50},options$2={components:[{name:"axis",index:0},{name:"axisLabel",index:0},{name:"grid"},{name:"parent",index:"parent"},{name:"ticks"},{name:"tickLabels"}]},VictoryAxisBase=function(h){_inherits$4(g,h);var i=_createSuper$4(g);function g(){return _classCallCheck$4(this,g),i.apply(this,arguments)}return _createClass$4(g,[{key:"renderLine",value:function(j){var $=j.axisComponent,_n=this.getComponentProps($,"axis",0);return React.cloneElement($,_n)}},{key:"renderLabel",value:function(j){var $=j.axisLabelComponent,_n=j.label;if(!_n)return null;var _i=this.getComponentProps($,"axisLabel",0);return React.cloneElement($,_i)}},{key:"renderGridAndTicks",value:function(j){var $=this,_n=j.tickComponent,_i=j.tickLabelComponent,_s=j.gridComponent,ga=j.name,ba=function(xa){var El=xa.style,Tl=El===void 0?{}:El,Sl=xa.events,Il=Sl===void 0?{}:Sl,Cl=Tl.stroke!=="transparent"&&Tl.stroke!=="none"&&Tl.strokeWidth!==0;return Cl||!isEmpty_1(Il)};return this.dataKeys.map(function(xa,El){var Tl=$.getComponentProps(_n,"ticks",El),Sl=React.cloneElement(_n,Tl),Il=ba(Sl.props)?Sl:void 0,Cl=$.getComponentProps(_s,"grid",El),Nl=React.cloneElement(_s,Cl),Dl=ba(Nl.props)?Nl:void 0,Ul=$.getComponentProps(_i,"tickLabels",El),Kl=React.cloneElement(_i,Ul),Jl=[Dl,Il,Kl].filter(Boolean);return React.cloneElement(j.groupComponent,{key:"".concat(ga,"-tick-group-").concat(xa)},Jl)})}},{key:"fixLabelOverlap",value:function(j,$){var _n=isVertical($),_i=_n?$.height:$.width,_s=function(Cl){return Cl.type&&Cl.type.role==="label"},ga=j.map(function(Cl){return Cl.props.children}).reduce(function(Cl,Nl){return Cl.concat(Nl)},[]).filter(_s).map(function(Cl){return Cl.props}),ba=function(Cl){return typeof Cl=="object"?assign_1({},{top:0,right:0,bottom:0,left:0},Cl):{top:Cl,right:Cl,bottom:Cl,left:Cl}},xa=ga.reduce(function(Cl,Nl){var Dl=ba(Nl.style.padding),Ul=approximateTextSize(Nl.text,{angle:Nl.angle,fontSize:Nl.style.fontSize,letterSpacing:Nl.style.letterSpacing,fontFamily:Nl.style.fontFamily});return Cl+(_n?Ul.height+Dl.top+Dl.bottom:Ul.width+Dl.right+Dl.left)},0),El=Math.floor(_i*j.length/xa),Tl=Math.ceil(j.length/El)||1,Sl=function(Cl){return Cl.props.children.filter(_s).reduce(function(Nl,Dl){return(_n?Dl.props.y:Dl.props.x)||0},0)},Il=j.sort(function(Cl,Nl){return _n?Sl(Nl)-Sl(Cl):Sl(Cl)-Sl(Nl)});return Il.filter(function(Cl,Nl){return Nl%Tl===0})}},{key:"shouldAnimate",value:function(){return!!this.props.animate}},{key:"render",value:function(){var j=VictoryAxis.animationWhitelist,$=modifyProps(this.props,fallbackProps$7),_n=getSafeUserProps(this.props);if(this.shouldAnimate())return this.animateComponent($,j);var _i=this.renderGridAndTicks($),_s=$.fixLabelOverlap?this.fixLabelOverlap(_i,$):_i,ga=[this.renderLine($),this.renderLabel($)].concat(_toConsumableArray$4(_s)),ba=React.cloneElement($.containerComponent,_n);return $.standalone?this.renderContainer(ba,ga):React.cloneElement($.groupComponent,_n,ga)}}]),g}(React.Component);VictoryAxisBase.animationWhitelist=["style","domain","range","tickCount","tickValues","offsetX","offsetY","padding","width","height"];VictoryAxisBase.displayName="VictoryAxis";VictoryAxisBase.role="axis";VictoryAxisBase.defaultTransitions={onExit:{duration:500},onEnter:{duration:500}};VictoryAxisBase.propTypes=_objectSpread$9(_objectSpread$9({},CommonProps.baseProps),{},{axisComponent:propTypesExports.element,axisLabelComponent:propTypesExports.element,axisValue:propTypesExports.oneOfType([propTypesExports.number,propTypesExports.string,propTypesExports.object]),categories:propTypesExports.oneOfType([propTypesExports.arrayOf(propTypesExports.string),propTypesExports.shape({x:propTypesExports.arrayOf(propTypesExports.string),y:propTypesExports.arrayOf(propTypesExports.string)})]),crossAxis:propTypesExports.bool,dependentAxis:propTypesExports.bool,events:propTypesExports.arrayOf(propTypesExports.shape({target:propTypesExports.oneOf(["axis","axisLabel","grid","ticks","tickLabels"]),eventKey:propTypesExports.oneOfType([propTypesExports.array,allOfType([integer,nonNegative]),propTypesExports.string]),eventHandlers:propTypesExports.object})),fixLabelOverlap:propTypesExports.bool,gridComponent:propTypesExports.element,groupComponent:propTypesExports.element,invertAxis:propTypesExports.bool,label:propTypesExports.any,offsetX:propTypesExports.number,offsetY:propTypesExports.number,orientation:propTypesExports.oneOf(["top","bottom","left","right"]),origin:propTypesExports.shape({x:propTypesExports.number,y:propTypesExports.number}),stringMap:propTypesExports.object,style:propTypesExports.shape({parent:propTypesExports.object,axis:propTypesExports.object,axisLabel:propTypesExports.object,grid:propTypesExports.object,ticks:propTypesExports.object,tickLabels:propTypesExports.object}),tickComponent:propTypesExports.element,tickCount:allOfType([integer,greaterThanZero]),tickFormat:propTypesExports.oneOfType([propTypesExports.func,homogeneousArray]),tickLabelComponent:propTypesExports.element,tickValues:homogeneousArray});VictoryAxisBase.defaultProps={axisComponent:React.createElement(LineSegment,null),axisLabelComponent:React.createElement(VictoryLabel,null),tickLabelComponent:React.createElement(VictoryLabel,null),tickComponent:React.createElement(LineSegment,null),gridComponent:React.createElement(LineSegment,null),standalone:!0,theme:VictoryTheme.grayscale,containerComponent:React.createElement(VictoryContainer,null),groupComponent:React.createElement("g",{role:"presentation"}),fixLabelOverlap:!1};VictoryAxisBase.getDomain=getDomain$2;VictoryAxisBase.getAxis=getAxis;VictoryAxisBase.getStyles=function(h){return getStyles$2(h)};VictoryAxisBase.getBaseProps=function(h){return getBaseProps$3(h,fallbackProps$7)};VictoryAxisBase.expectedComponents=["axisComponent","axisLabelComponent","groupComponent","containerComponent","tickComponent","tickLabelComponent","gridComponent"];var VictoryAxis=addEvents(VictoryAxisBase,options$2),getBarPosition=function(h,i){var g=function($){var _n=getType(h.scale[$])==="log"?1/Number.MAX_SAFE_INTEGER:0,_i=_n,_s=getMinValue(h.domain[$]),ga=getMaxValue(h.domain[$]);return _s<0&&ga<=0?_i=ga:_s>=0&&ga>0&&(_i=_s),i["_".concat($)]instanceof Date?new Date(_i):_i},_=i._y0!==void 0?i._y0:g("y"),j=i._x0!==void 0?i._x0:g("x");return scalePoint(h,assign_1({},i,{_y0:_,_x0:j}))},getCalculatedValues$2=function(h){var i=h.polar,g=getDefaultStyles(h,"bar"),_=h.disableInlineStyles?{}:getStyles$4(h.style,g),j=h.range||{x:getRange$1(h,"x"),y:getRange$1(h,"y")},$={x:getDomainWithZero(h,"x"),y:getDomainWithZero(h,"y")},_n={x:getBaseScale(h,"x").domain($.x).range(h.horizontal?j.y:j.x),y:getBaseScale(h,"y").domain($.y).range(h.horizontal?j.x:j.y)},_i=i?h.origin||getPolarOrigin(h):void 0,_s=getData(h);return _s=formatDataFromDomain(_s,$,0),{style:_,data:_s,scale:_n,domain:$,origin:_i}},getBaseProps$2=function(h,i){var g=modifyProps$1(h,i,"bar");h=assign_1({},g,getCalculatedValues$2(g));var _=h,j=_.alignment,$=_.barRatio,_n=_.cornerRadius,_i=_.data,_s=_.disableInlineStyles,ga=_.domain,ba=_.events,xa=_.height,El=_.horizontal,Tl=_.origin,Sl=_.padding,Il=_.polar,Cl=_.scale,Nl=_.sharedEvents,Dl=_.standalone,Ul=_.style,Kl=_.theme,Jl=_.width,Ep=_.labels,_p=_.name,Ip=_.barWidth,Up=_.getPath,yp={parent:{horizontal:El,domain:ga,scale:Cl,width:Jl,height:xa,data:_i,standalone:Dl,name:_p,theme:Kl,polar:Il,origin:Tl,padding:Sl,style:Ul.parent}};return _i.reduce(function(Ap,Cp,Mp){var wp=isNil_1(Cp.eventKey)?Mp:Cp.eventKey,Np=getBarPosition(h,Cp),Fp=Np.x,Hp=Np.y,xp=Np.y0,Gp=Np.x0,$p={alignment:j,barRatio:$,barWidth:Ip,cornerRadius:_n,data:_i,datum:Cp,disableInlineStyles:_s,getPath:Up,horizontal:El,index:Mp,polar:Il,origin:Tl,scale:Cl,style:Ul.data,width:Jl,height:xa,x:Fp,y:Hp,y0:xp,x0:Gp};Ap[wp]={data:$p};var c0=getText(h,Cp,Mp);return(c0!=null||Ep&&(ba||Nl))&&(Ap[wp].labels=getProps(h,Mp)),Ap},yp)},getBarWidth=function(h,i){var g=i.scale,_=i.data,j=i.defaultBarWidth,$=i.style;if(h)return evaluateProp(h,i);if($.width)return $.width;var _n=g.x.range(),_i=Math.abs(_n[1]-_n[0]),_s=_.length+2,ga=i.barRatio||.5,ba=ga*(_.length<2?j:_i/_s);return Math.max(1,ba)},getCornerRadiusFromObject=function(h,i){var g={topLeft:0,topRight:0,bottomLeft:0,bottomRight:0},_=function(j,$){isNil_1(h[j])?isNil_1(h[$])||(g[j]=evaluateProp(h[$],i)):g[j]=evaluateProp(h[j],i)};return _("topLeft","top"),_("topRight","top"),_("bottomLeft","bottom"),_("bottomRight","bottom"),g},getCornerRadius=function(h,i){var g={topLeft:0,topRight:0,bottomLeft:0,bottomRight:0};return h?isPlainObject_1(h)?getCornerRadiusFromObject(h,i):(g.topLeft=evaluateProp(h,i),g.topRight=evaluateProp(h,i),g):g},getStyle=function(){var h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=arguments.length>1?arguments[1]:void 0;if(i.disableInlineStyles)return{};var g=h.fill||"black",_={fill:"black",stroke:g};return evaluateStyle(assign_1(_,h),i)},point=function(h,i){return{x:h,y:i,distance:function(g){return Math.sqrt(Math.pow(this.x-g.x,2)+Math.pow(this.y-g.y,2))},add:function(g){return point(this.x+g.x,this.y+g.y)},subtract:function(g){return point(this.x-g.x,this.y-g.y)},scalarMult:function(g){return point(this.x*g,this.y*g)},scalarDivide:function(g){if(g===0)throw new Error("Division by 0 error");return point(this.x/g,this.y/g)},equals:function(g){return this.x===g.x&&this.y===g.y}}},circle=function(h,i){return{center:h,radius:i,hasIntersection:function(g){var _=this.center,j=g.center,$=this.radius,_n=g.radius,_i=_.distance(j);return!(_i>$+_n||_i<Math.abs($-_n))},equals:function(g){var _=this.center,j=g.center,$=this.radius,_n=g.radius;return $===_n&&_.equals(j)},intersection:function(g){var _=this.center,j=g.center,$=this.radius,_n=g.radius,_i=_.distance(j);if(!this.hasIntersection(g)||this.equals(g))return[];var _s=(Math.pow($,2)-Math.pow(_n,2)+Math.pow(_i,2))/(2*_i),ga=Math.sqrt(Math.pow($,2)-Math.pow(_s,2)),ba=_.add(j.subtract(_).scalarMult(_s).scalarDivide(_i)),xa=_.x,El=_.y,Tl=j.x,Sl=j.y,Il=ba.x,Cl=ba.y,Nl=[point(Il-ga*(Sl-El)/_i,Cl+ga*(Tl-xa)/_i),point(Il+ga*(Sl-El)/_i,Cl-ga*(Tl-xa)/_i)];return Nl.sort(function(Dl,Ul){return Dl.x-Ul.x}),Nl},solveX:function(g){var _=Math.sqrt(Math.pow(this.radius,2)-Math.pow(g-this.center.y,2));return[this.center.x-_,this.center.x+_]},solveY:function(g){var _=Math.sqrt(Math.pow(this.radius,2)-Math.pow(g-this.center.x,2));return[this.center.y-_,this.center.y+_]}}};function ownKeys$8(h,i){var g=Object.keys(h);if(Object.getOwnPropertySymbols){var _=Object.getOwnPropertySymbols(h);i&&(_=_.filter(function(j){return Object.getOwnPropertyDescriptor(h,j).enumerable})),g.push.apply(g,_)}return g}function _objectSpread$8(h){for(var i=1;i<arguments.length;i++){var g=arguments[i]!=null?arguments[i]:{};i%2?ownKeys$8(Object(g),!0).forEach(function(_){_defineProperty$8(h,_,g[_])}):Object.getOwnPropertyDescriptors?Object.defineProperties(h,Object.getOwnPropertyDescriptors(g)):ownKeys$8(Object(g)).forEach(function(_){Object.defineProperty(h,_,Object.getOwnPropertyDescriptor(g,_))})}return h}function _defineProperty$8(h,i,g){return i in h?Object.defineProperty(h,i,{value:g,enumerable:!0,configurable:!0,writable:!0}):h[i]=g,h}function _toConsumableArray$3(h){return _arrayWithoutHoles$3(h)||_iterableToArray$3(h)||_unsupportedIterableToArray$4(h)||_nonIterableSpread$3()}function _nonIterableSpread$3(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _unsupportedIterableToArray$4(h,i){if(h){if(typeof h=="string")return _arrayLikeToArray$4(h,i);var g=Object.prototype.toString.call(h).slice(8,-1);if(g==="Object"&&h.constructor&&(g=h.constructor.name),g==="Map"||g==="Set")return Array.from(h);if(g==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(g))return _arrayLikeToArray$4(h,i)}}function _iterableToArray$3(h){if(typeof Symbol<"u"&&h[Symbol.iterator]!=null||h["@@iterator"]!=null)return Array.from(h)}function _arrayWithoutHoles$3(h){if(Array.isArray(h))return _arrayLikeToArray$4(h)}function _arrayLikeToArray$4(h,i){(i==null||i>h.length)&&(i=h.length);for(var g=0,_=new Array(i);g<i;g++)_[g]=h[g];return _}var getPosition$1=function(h,i){var g=h.x,_=h.x0,j=h.y,$=h.y0,_n=h.horizontal,_i=h.alignment||"middle",_s=_i==="middle"?i/2:i,ga=_n?-1:1;return _n?{x0:_,x1:g,y0:_i==="start"?j:j-ga*_s,y1:_i==="end"?j:j+ga*_s}:{x0:_i==="start"?g:g-ga*_s,x1:_i==="end"?g:g+ga*_s,y0:$,y1:j}},getAngle=function(h,i){var g=h.data,_=h.scale,j=g[i]._x1===void 0?"_x":"_x1";return _.x(g[i][j])},getAngularWidth=function(h,i){var g=h.scale,_=g.y.range(),j=Math.max.apply(Math,_toConsumableArray$3(_)),$=Math.abs(g.x.range()[1]-g.x.range()[0]);return i/(2*Math.PI*j)*$},transformAngle=function(h){return-1*h+Math.PI/2},getCustomBarPath=function(h,i){var g=h.getPath,_=_objectSpread$8(_objectSpread$8({},h),getPosition$1(h,i));return g(_)},getStartAngle=function(h,i){var g=h.data,_=h.scale,j=h.alignment,$=getAngle(h,i),_n=Math.abs(_.x.range()[1]-_.x.range()[0]),_i=i===0?getAngle(h,g.length-1)-Math.PI*2:getAngle(h,i-1);return i===0&&_n<2*Math.PI?_.x.range()[0]:j==="start"||j==="end"?j==="start"?_i:$:($+_i)/2},getEndAngle=function(h,i){var g=h.data,_=h.scale,j=h.alignment,$=getAngle(h,i),_n=Math.abs(_.x.range()[1]-_.x.range()[0]),_i=_.x.range()[1]===2*Math.PI?getAngle(h,0)+Math.PI*2:_.x.range()[1],_s=i===g.length-1?getAngle(h,0)+Math.PI*2:getAngle(h,i+1);return i===g.length-1&&_n<2*Math.PI?_i:j==="start"||j==="end"?j==="start"?$:_s:($+_s)/2},mapPointsToPath=function(h,i,g){var _="".concat(i.topLeft," ").concat(i.topLeft," ").concat(g),j="".concat(i.topRight," ").concat(i.topRight," ").concat(g),$="".concat(i.bottomLeft," ").concat(i.bottomLeft," ").concat(g),_n="".concat(i.bottomRight," ").concat(i.bottomRight," ").concat(g),_i=["M","A ".concat($,","),"L","A ".concat(_,","),"L","A ".concat(j,","),"L","A ".concat(_n,",")],_s=_i.reduce(function(ga,ba,xa){return ga+="".concat(ba," ").concat(h[xa].x,", ").concat(h[xa].y,` 
`),ga},"");return"".concat(_s," z")},getVerticalBarPoints=function(h,i,g){var _=h.x0,j=h.x1,$=h.y0,_n=h.y1,_i=function(_s){var ga=_s==="Left",ba=ga?1:-1,xa=ga?_:j,El={x:xa+ba*g["bottom".concat(_s)],y:$},Tl={x:xa,y:$-i*g["bottom".concat(_s)]},Sl={x:xa,y:_n+i*g["top".concat(_s)]},Il={x:xa+ba*g["top".concat(_s)],y:_n},Cl=i===1?$-g["bottom".concat(_s)]<_n+g["top".concat(_s)]:$+g["bottom".concat(_s)]>_n-g["top".concat(_s)];if(Cl){var Nl=point(xa+ba*g["top".concat(_s)],_n+i*g["top".concat(_s)]),Dl=circle(Nl,g["top".concat(_s)]),Ul=point(xa+ba*g["bottom".concat(_s)],$-i*g["bottom".concat(_s)]),Kl=circle(Ul,g["bottom".concat(_s)]),Jl=Dl.intersection(Kl),Ep=Jl.length>0;if(Ep){var _p=Jl[ga?0:1];Tl={x:_p.x,y:_p.y},Sl={x:_p.x,y:_p.y}}else{var Ip=g["top".concat(_s)]>g["bottom".concat(_s)];if(Ip){var Up=Dl.solveX($)[ga?0:1];El={x:Up,y:$},Tl={x:Up,y:$},Sl={x:Up,y:$}}else{var yp=Kl.solveX(_n)[ga?0:1];Tl={x:yp,y:_n},Sl={x:yp,y:_n},Il={x:yp,y:_n}}}}var Ap=[El,Tl,Sl,Il];return ga?Ap:Ap.reverse()};return _i("Left").concat(_i("Right"))},getHorizontalBarPoints=function(h,i,g){var _=h.y0,j=h.y1,$=h.x0<h.x1?h.x0:h.x1,_n=h.x0<h.x1?h.x1:h.x0,_i=function(ba){var xa=ba==="top",El=xa?-1:1,Tl=xa?j:_,Sl={x:$,y:Tl-El*g["".concat(ba,"Left")]},Il={x:$+g["".concat(ba,"Left")],y:Tl},Cl={x:_n-g["".concat(ba,"Right")],y:Tl},Nl={x:_n,y:Tl-El*g["".concat(ba,"Right")]},Dl=Il.x>Cl.x;if(Dl){var Ul=point($+g["".concat(ba,"Left")],Tl-El*g["".concat(ba,"Left")]),Kl=circle(Ul,g["".concat(ba,"Left")]),Jl=point(_n-g["".concat(ba,"Right")],Tl-El*g["".concat(ba,"Right")]),Ep=circle(Jl,g["".concat(ba,"Right")]),_p=Kl.intersection(Ep),Ip=_p.length>0;if(Ip){var Up=_p[i>0?1:0];Il={x:Up.x,y:Up.y},Cl={x:Up.x,y:Up.y}}else{var yp=g["".concat(ba,"Right")]>g["".concat(ba,"Left")];if(yp){var Ap=Ep.solveY($)[xa?0:1];Sl={x:$,y:Ap},Il={x:$,y:Ap},Cl={x:$,y:Ap}}else{var Cp=Kl.solveY(_n)[xa?0:1];Nl={x:_n,y:Cp},Cl={x:_n,y:Cp},Il={x:_n,y:Cp}}}}return[Sl,Il,Cl,Nl]},_s=_i("top"),ga=_i("bottom");return[ga[1],ga[0]].concat(_toConsumableArray$3(_s),[ga[3],ga[2]])},getVerticalBarPath=function(h,i,g){var _=getPosition$1(h,i),j=_.y0>_.y1?1:-1,$=j>0?"0 0 1":"0 0 0",_n=getVerticalBarPoints(_,j,g);return mapPointsToPath(_n,g,$)},getHorizontalBarPath=function(h,i,g){var _=getPosition$1(h,i),j=_.x0<_.x1?1:-1,$="0 0 1",_n={topRight:j>0?g.topLeft:g.bottomLeft,bottomRight:j>0?g.topRight:g.bottomRight,bottomLeft:j>0?g.bottomRight:g.topRight,topLeft:j>0?g.bottomLeft:g.topLeft},_i=getHorizontalBarPoints(_,j,_n);return mapPointsToPath(_i,_n,$)},getVerticalPolarBarPath=function(h,i){var g=h.datum,_=h.scale,j=h.index,$=h.alignment,_n=h.style,_i=_.y(g._y0||0),_s=_.y(g._y1!==void 0?g._y1:g._y),ga=_.x(g._x1!==void 0?g._x1:g._x),ba,xa;if(_n.width){var El=getAngularWidth(h,_n.width),Tl=$==="middle"?El/2:El;ba=$==="start"?ga:ga-Tl,xa=$==="end"?ga:ga+Tl}else ba=getStartAngle(h,j),xa=getEndAngle(h,j);var Sl=function(Ep){var _p=arc().innerRadius(_i).outerRadius(_s).startAngle(transformAngle(ba)).endAngle(transformAngle(xa)).cornerRadius(i[Ep]);return _p()},Il=function(Ep){var _p=Sl("".concat(Ep,"Right")),Ip=_p.match(/[A-Z]/g),Up=_p.split(/[A-Z]/).slice(1),yp=Ip.indexOf("L"),Ap=Sl("".concat(Ep,"Left")),Cp=Ap.match(/[A-Z]/g),Mp=Ap.split(/[A-Z]/).slice(1),wp=Cp.indexOf("L");return{rightMoves:Ip,rightCoords:Up,rightMiddle:yp,leftMoves:Cp,leftCoords:Mp,leftMiddle:wp}},Cl=function(){var Ep=i.topRight,_p=i.topLeft,Ip=_s*Math.abs(xa-ba),Up=Il("top"),yp=Up.rightMoves,Ap=Up.rightCoords,Cp=Up.rightMiddle,Mp=Up.leftMoves,wp=Up.leftCoords,Np=Up.leftMiddle,Fp,Hp;if(Ep===_p||Ip<2*Ep+2*_p)Fp=Ep>_p?yp:Mp,Hp=Ep>_p?Ap:wp;else{var xp=function(dy){return dy<3},Gp=_p>Ep&&xp(Cp)?1:2,$p;if(Ep>_p){var c0=xp(Cp)?Np:Np-2;$p=xp(Np)?Np-1:c0}else{var n0=xp(Np)?1:2;$p=xp(Cp)?n0:Np-2}Fp=[].concat(_toConsumableArray$3(yp.slice(0,Gp)),_toConsumableArray$3(Mp.slice($p))),Hp=[].concat(_toConsumableArray$3(Ap.slice(0,Gp)),_toConsumableArray$3(wp.slice($p)))}var C0=Fp.indexOf("L"),Op=Fp.slice(0,C0),Q0=Hp.slice(0,C0);return Op.map(function(dy,Yy){return{command:dy,coords:Q0[Yy].split(",")}})},Nl=function(){var Ep=i.bottomRight,_p=i.bottomLeft,Ip=_i*Math.abs(xa-ba),Up=Il("bottom"),yp=Up.rightMoves,Ap=Up.rightCoords,Cp=Up.rightMiddle,Mp=Up.leftMoves,wp=Up.leftCoords,Np=Up.leftMiddle,Fp,Hp;if(Ep===_p||Ip<2*Ep+2*_p)Fp=Ep>_p?yp:Mp,Hp=Ep>_p?Ap:wp;else{var xp=function(Op,Q0){return Op.length-Q0<4},Gp=Ep>_p?xp(yp,Cp):xp(Mp,Np),$p=Gp?-1:-3;Fp=[].concat(_toConsumableArray$3(Mp.slice(0,Np+2)),_toConsumableArray$3(yp.slice($p))),Hp=[].concat(_toConsumableArray$3(wp.slice(0,Np+2)),_toConsumableArray$3(Ap.slice($p)))}var c0=Fp.indexOf("L"),n0=Fp.slice(c0,-1),C0=Hp.slice(c0,-1);return n0.map(function(Op,Q0){return{command:Op,coords:C0[Q0].split(",")}})},Dl=Cl(),Ul=Nl(),Kl=[].concat(_toConsumableArray$3(Dl),_toConsumableArray$3(Ul)),Jl=Kl.reduce(function(Ep,_p){return Ep+="".concat(_p.command," ").concat(_p.coords.join()),Ep},"");return"".concat(Jl," z")},getBarPath=function(h,i,g){return h.getPath?getCustomBarPath(h,i):h.horizontal?getHorizontalBarPath(h,i,g):getVerticalBarPath(h,i,g)},getPolarBarPath=function(h,i){return getVerticalPolarBarPath(h,i)};function ownKeys$7(h,i){var g=Object.keys(h);if(Object.getOwnPropertySymbols){var _=Object.getOwnPropertySymbols(h);i&&(_=_.filter(function(j){return Object.getOwnPropertyDescriptor(h,j).enumerable})),g.push.apply(g,_)}return g}function _objectSpread$7(h){for(var i=1;i<arguments.length;i++){var g=arguments[i]!=null?arguments[i]:{};i%2?ownKeys$7(Object(g),!0).forEach(function(_){_defineProperty$7(h,_,g[_])}):Object.getOwnPropertyDescriptors?Object.defineProperties(h,Object.getOwnPropertyDescriptors(g)):ownKeys$7(Object(g)).forEach(function(_){Object.defineProperty(h,_,Object.getOwnPropertyDescriptor(g,_))})}return h}function _defineProperty$7(h,i,g){return i in h?Object.defineProperty(h,i,{value:g,enumerable:!0,configurable:!0,writable:!0}):h[i]=g,h}var evaluateProps$1=function(h){var i=getStyle(h.style,h),g=getBarWidth(h.barWidth,assign_1({},h,{style:i})),_=getCornerRadius(h.cornerRadius,assign_1({},h,{style:i,barWidth:g})),j=evaluateProp(h.ariaLabel,h),$=evaluateProp(h.desc,h),_n=evaluateProp(h.id,h),_i=evaluateProp(h.tabIndex,h);return assign_1({},h,{ariaLabel:j,style:i,barWidth:g,cornerRadius:_,desc:$,id:_n,tabIndex:_i})},Bar=function(h){h=evaluateProps$1(h);var i=h,g=i.polar,_=i.origin,j=i.style,$=i.barWidth,_n=i.cornerRadius,_i=g?getPolarBarPath(h,_n):getBarPath(h,$,_n),_s=g&&_?"translate(".concat(_.x,", ").concat(_.y,")"):void 0;return React.cloneElement(h.pathComponent,_objectSpread$7(_objectSpread$7({},h.events),{},{"aria-label":h.ariaLabel,style:j,d:_i,className:h.className,clipPath:h.clipPath,desc:h.desc,index:h.index,role:h.role,shapeRendering:h.shapeRendering,transform:h.transform||_s,tabIndex:h.tabIndex}))};Bar.propTypes=_objectSpread$7(_objectSpread$7({},CommonProps.primitiveProps),{},{alignment:propTypesExports.oneOf(["start","middle","end"]),barRatio:propTypesExports.number,barWidth:propTypesExports.oneOfType([propTypesExports.number,propTypesExports.func]),cornerRadius:propTypesExports.oneOfType([propTypesExports.number,propTypesExports.func,propTypesExports.shape({top:propTypesExports.oneOfType([propTypesExports.number,propTypesExports.func]),topLeft:propTypesExports.oneOfType([propTypesExports.number,propTypesExports.func]),topRight:propTypesExports.oneOfType([propTypesExports.number,propTypesExports.func]),bottom:propTypesExports.oneOfType([propTypesExports.number,propTypesExports.func]),bottomLeft:propTypesExports.oneOfType([propTypesExports.number,propTypesExports.func]),bottomRight:propTypesExports.oneOfType([propTypesExports.number,propTypesExports.func])})]),datum:propTypesExports.object,getPath:propTypesExports.func,horizontal:propTypesExports.bool,pathComponent:propTypesExports.element,width:propTypesExports.number,x:propTypesExports.number,y:propTypesExports.number,y0:propTypesExports.number});Bar.defaultProps={defaultBarWidth:8,pathComponent:React.createElement(Path$1,null),role:"presentation",shapeRendering:"auto"};const Bar$1=Bar;function ownKeys$6(h,i){var g=Object.keys(h);if(Object.getOwnPropertySymbols){var _=Object.getOwnPropertySymbols(h);i&&(_=_.filter(function(j){return Object.getOwnPropertyDescriptor(h,j).enumerable})),g.push.apply(g,_)}return g}function _objectSpread$6(h){for(var i=1;i<arguments.length;i++){var g=arguments[i]!=null?arguments[i]:{};i%2?ownKeys$6(Object(g),!0).forEach(function(_){_defineProperty$6(h,_,g[_])}):Object.getOwnPropertyDescriptors?Object.defineProperties(h,Object.getOwnPropertyDescriptors(g)):ownKeys$6(Object(g)).forEach(function(_){Object.defineProperty(h,_,Object.getOwnPropertyDescriptor(g,_))})}return h}function _defineProperty$6(h,i,g){return i in h?Object.defineProperty(h,i,{value:g,enumerable:!0,configurable:!0,writable:!0}):h[i]=g,h}function _classCallCheck$3(h,i){if(!(h instanceof i))throw new TypeError("Cannot call a class as a function")}function _defineProperties$3(h,i){for(var g=0;g<i.length;g++){var _=i[g];_.enumerable=_.enumerable||!1,_.configurable=!0,"value"in _&&(_.writable=!0),Object.defineProperty(h,_.key,_)}}function _createClass$3(h,i,g){return i&&_defineProperties$3(h.prototype,i),g&&_defineProperties$3(h,g),Object.defineProperty(h,"prototype",{writable:!1}),h}function _inherits$3(h,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");h.prototype=Object.create(i&&i.prototype,{constructor:{value:h,writable:!0,configurable:!0}}),Object.defineProperty(h,"prototype",{writable:!1}),i&&_setPrototypeOf$3(h,i)}function _setPrototypeOf$3(h,i){return _setPrototypeOf$3=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(_,j){return _.__proto__=j,_},_setPrototypeOf$3(h,i)}function _createSuper$3(h){var i=_isNativeReflectConstruct$3();return function(){var _=_getPrototypeOf$3(h),j;if(i){var $=_getPrototypeOf$3(this).constructor;j=Reflect.construct(_,arguments,$)}else j=_.apply(this,arguments);return _possibleConstructorReturn$3(this,j)}}function _possibleConstructorReturn$3(h,i){if(i&&(typeof i=="object"||typeof i=="function"))return i;if(i!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$3(h)}function _assertThisInitialized$3(h){if(h===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return h}function _isNativeReflectConstruct$3(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function _getPrototypeOf$3(h){return _getPrototypeOf$3=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(g){return g.__proto__||Object.getPrototypeOf(g)},_getPrototypeOf$3(h)}var fallbackProps$6={width:450,height:300,padding:50},defaultData=[{x:1,y:1},{x:2,y:2},{x:3,y:3},{x:4,y:4}],VictoryBar=function(h){_inherits$3(g,h);var i=_createSuper$3(g);function g(){return _classCallCheck$3(this,g),i.apply(this,arguments)}return _createClass$3(g,[{key:"shouldAnimate",value:function(){return!!this.props.animate}},{key:"render",value:function(){var j=g.animationWhitelist,$=g.role,_n=modifyProps$1(this.props,fallbackProps$6,$);if(this.shouldAnimate())return this.animateComponent(_n,j);var _i=this.renderData(_n),_s=_n.standalone?this.renderContainer(_n.containerComponent,_i):_i;return withSafeUserProps(_s,_n)}}]),g}(React.Component);VictoryBar.animationWhitelist=["data","domain","height","padding","style","width"];VictoryBar.displayName="VictoryBar";VictoryBar.role="bar";VictoryBar.defaultTransitions={onLoad:{duration:2e3,before:function(){return{_y:0,_y1:0,_y0:0}},after:function(h){return{_y:h._y,_y1:h._y1,_y0:h._y0}}},onExit:{duration:500,before:function(){return{_y:0,yOffset:0}}},onEnter:{duration:500,before:function(){return{_y:0,_y1:0,_y0:0}},after:function(h){return{_y:h._y,_y1:h._y1,_y0:h._y0}}}};VictoryBar.propTypes=_objectSpread$6(_objectSpread$6(_objectSpread$6({},CommonProps.baseProps),CommonProps.dataProps),{},{alignment:propTypesExports.oneOf(["start","middle","end"]),barRatio:propTypesExports.number,barWidth:propTypesExports.oneOfType([propTypesExports.number,propTypesExports.func]),cornerRadius:propTypesExports.oneOfType([propTypesExports.number,propTypesExports.func,propTypesExports.shape({top:propTypesExports.oneOfType([propTypesExports.number,propTypesExports.func]),topLeft:propTypesExports.oneOfType([propTypesExports.number,propTypesExports.func]),topRight:propTypesExports.oneOfType([propTypesExports.number,propTypesExports.func]),bottom:propTypesExports.oneOfType([propTypesExports.number,propTypesExports.func]),bottomLeft:propTypesExports.oneOfType([propTypesExports.number,propTypesExports.func]),bottomRight:propTypesExports.oneOfType([propTypesExports.number,propTypesExports.func])})]),getPath:propTypesExports.func,horizontal:propTypesExports.bool});VictoryBar.defaultProps={containerComponent:React.createElement(VictoryContainer,null),data:defaultData,dataComponent:React.createElement(Bar$1,null),groupComponent:React.createElement("g",{role:"presentation"}),labelComponent:React.createElement(VictoryLabel,null),samples:50,sortOrder:"ascending",standalone:!0,theme:VictoryTheme.grayscale};VictoryBar.getDomain=getDomainWithZero;VictoryBar.getData=getData;VictoryBar.getBaseProps=function(h){return getBaseProps$2(h,fallbackProps$6)};VictoryBar.expectedComponents=["dataComponent","labelComponent","groupComponent","containerComponent"];const VictoryBar$1=addEvents(VictoryBar);function fromPairs(h){for(var i=-1,g=h==null?0:h.length,_={};++i<g;){var j=h[i];_[j[0]]=j[1]}return _}var fromPairs_1=fromPairs,stringifyExports={},stringify$1={get exports(){return stringifyExports},set exports(h){stringifyExports=h}};(function(h,i){i=h.exports=g,i.getSerialize=_;function g(j,$,_n,_i){return JSON.stringify(j,_($,_i),_n)}function _(j,$){var _n=[],_i=[];return $==null&&($=function(_s,ga){return _n[0]===ga?"[Circular ~]":"[Circular ~."+_i.slice(0,_n.indexOf(ga)).join(".")+"]"}),function(_s,ga){if(_n.length>0){var ba=_n.indexOf(this);~ba?_n.splice(ba+1):_n.push(this),~ba?_i.splice(ba,1/0,_s):_i.push(_s),~_n.indexOf(ga)&&(ga=$.call(this,_s,ga))}else _n.push(ga);return j==null?ga:j.call(this,_s,ga)}}})(stringify$1,stringifyExports);const stringify=stringifyExports;function _slicedToArray$1(h,i){return _arrayWithHoles$1(h)||_iterableToArrayLimit$1(h,i)||_unsupportedIterableToArray$3(h,i)||_nonIterableRest$1()}function _nonIterableRest$1(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _iterableToArrayLimit$1(h,i){var g=h==null?null:typeof Symbol<"u"&&h[Symbol.iterator]||h["@@iterator"];if(g!=null){var _=[],j=!0,$=!1,_n,_i;try{for(g=g.call(h);!(j=(_n=g.next()).done)&&(_.push(_n.value),!(i&&_.length===i));j=!0);}catch(_s){$=!0,_i=_s}finally{try{!j&&g.return!=null&&g.return()}finally{if($)throw _i}}return _}}function _arrayWithHoles$1(h){if(Array.isArray(h))return h}function _toConsumableArray$2(h){return _arrayWithoutHoles$2(h)||_iterableToArray$2(h)||_unsupportedIterableToArray$3(h)||_nonIterableSpread$2()}function _nonIterableSpread$2(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _unsupportedIterableToArray$3(h,i){if(h){if(typeof h=="string")return _arrayLikeToArray$3(h,i);var g=Object.prototype.toString.call(h).slice(8,-1);if(g==="Object"&&h.constructor&&(g=h.constructor.name),g==="Map"||g==="Set")return Array.from(h);if(g==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(g))return _arrayLikeToArray$3(h,i)}}function _iterableToArray$2(h){if(typeof Symbol<"u"&&h[Symbol.iterator]!=null||h["@@iterator"]!=null)return Array.from(h)}function _arrayWithoutHoles$2(h){if(Array.isArray(h))return _arrayLikeToArray$3(h)}function _arrayLikeToArray$3(h,i){(i==null||i>h.length)&&(i=h.length);for(var g=0,_=new Array(i);g<i;g++)_[g]=h[g];return _}function _classCallCheck$2(h,i){if(!(h instanceof i))throw new TypeError("Cannot call a class as a function")}function _defineProperties$2(h,i){for(var g=0;g<i.length;g++){var _=i[g];_.enumerable=_.enumerable||!1,_.configurable=!0,"value"in _&&(_.writable=!0),Object.defineProperty(h,_.key,_)}}function _createClass$2(h,i,g){return i&&_defineProperties$2(h.prototype,i),g&&_defineProperties$2(h,g),Object.defineProperty(h,"prototype",{writable:!1}),h}function _inherits$2(h,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");h.prototype=Object.create(i&&i.prototype,{constructor:{value:h,writable:!0,configurable:!0}}),Object.defineProperty(h,"prototype",{writable:!1}),i&&_setPrototypeOf$2(h,i)}function _setPrototypeOf$2(h,i){return _setPrototypeOf$2=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(_,j){return _.__proto__=j,_},_setPrototypeOf$2(h,i)}function _createSuper$2(h){var i=_isNativeReflectConstruct$2();return function(){var _=_getPrototypeOf$2(h),j;if(i){var $=_getPrototypeOf$2(this).constructor;j=Reflect.construct(_,arguments,$)}else j=_.apply(this,arguments);return _possibleConstructorReturn$2(this,j)}}function _possibleConstructorReturn$2(h,i){if(i&&(typeof i=="object"||typeof i=="function"))return i;if(i!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$2(h)}function _assertThisInitialized$2(h){if(h===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return h}function _isNativeReflectConstruct$2(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function _getPrototypeOf$2(h){return _getPrototypeOf$2=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(g){return g.__proto__||Object.getPrototypeOf(g)},_getPrototypeOf$2(h)}var VictorySharedEvents=function(h){_inherits$2(g,h);var i=_createSuper$2(g);function g(_){var j;return _classCallCheck$2(this,g),j=i.call(this,_),j.state=j.state||{},j.getScopedEvents=getScopedEvents.bind(_assertThisInitialized$2(j)),j.getEventState=getEventState.bind(_assertThisInitialized$2(j)),j.baseProps=j.getBaseProps(_),j.sharedEventsCache={},j.globalEvents={},j.prevGlobalEventKeys=[],j.boundGlobalEvents={},j}return _createClass$2(g,[{key:"shouldComponentUpdate",value:function(j){if(!reactFastCompare(this.props,j)){this.baseProps=this.getBaseProps(j);var $=this.getExternalMutations(j,this.baseProps);this.applyExternalMutations(j,$)}return!0}},{key:"componentDidMount",value:function(){var j=this,$=keys_1(this.globalEvents);$.forEach(function(_n){return j.addGlobalListener(_n)}),this.prevGlobalEventKeys=$}},{key:"componentDidUpdate",value:function(){var j=this,$=keys_1(this.globalEvents),_n=difference_1(this.prevGlobalEventKeys,$);_n.forEach(function(_s){return j.removeGlobalListener(_s)});var _i=difference_1($,this.prevGlobalEventKeys);_i.forEach(function(_s){return j.addGlobalListener(_s)}),this.prevGlobalEventKeys=$}},{key:"componentWillUnmount",value:function(){var j=this;this.prevGlobalEventKeys.forEach(function($){return j.removeGlobalListener($)})}},{key:"addGlobalListener",value:function(j){var $=this,_n=function(_i){var _s=$.globalEvents[j];return _s&&_s(emulateReactEvent(_i))};this.boundGlobalEvents[j]=_n,window.addEventListener(getGlobalEventNameFromKey(j),_n)}},{key:"removeGlobalListener",value:function(j){window.removeEventListener(getGlobalEventNameFromKey(j),this.boundGlobalEvents[j])}},{key:"getAllEvents",value:function(j){var $=["container","groupComponent"],_n=getComponentEvents(j,$);return Array.isArray(_n)?Array.isArray(j.events)?_n.concat.apply(_n,_toConsumableArray$2(j.events)):_n:j.events}},{key:"applyExternalMutations",value:function(j,$){if(!isEmpty_1($)){var _n=j.externalEventMutations.reduce(function(_s,ga){return _s=isFunction_1(ga.callback)?_s.concat(ga.callback):_s,_s},[]),_i=_n.length?function(){_n.forEach(function(_s){return _s()})}:void 0;this.setState($,_i)}}},{key:"getExternalMutations",value:function(j,$){return isEmpty_1(j.externalEventMutations)?void 0:getExternalMutationsWithChildren(j.externalEventMutations,$,this.state,keys_1($))}},{key:"cacheSharedEvents",value:function(j,$,_n){this.sharedEventsCache[j]=[$,_n]}},{key:"getCachedSharedEvents",value:function(j,$){var _n=this.sharedEventsCache[j]||[],_i=_slicedToArray$1(_n,2),_s=_i[0],ga=_i[1];if(_s&&reactFastCompare($,ga))return _s}},{key:"getBaseProps",value:function(j){var $=j.container,_n=React.Children.toArray(this.props.children),_i=this.getBasePropsFromChildren(_n),_s=$?$.props:{};return assign_1({},_i,{parent:_s})}},{key:"getBasePropsFromChildren",value:function(j){var $=function(_i,_s){if(_i.type&&isFunction_1(_i.type.getBaseProps)){var ga=_i.props&&_i.type.getBaseProps(_i.props);return ga?[[_s,ga]]:null}return null},_n=reduceChildren(j,$);return fromPairs_1(_n)}},{key:"getNewChildren",value:function(j,$){var _n=this,_i=j.events,_s=j.eventKey,ga=function(El,Tl){return El.reduce(function(Sl,Il,Cl){if(Il.props.children){var Nl=React.Children.toArray(Il.props.children),Dl=Tl.slice(Cl,Cl+Nl.length),Ul=React.cloneElement(Il,Il.props,ga(Nl,Dl));return Sl.concat(Ul)}else if(Tl[Cl]!=="parent"&&Il.type&&isFunction_1(Il.type.getBaseProps)){var Kl=Il.props.name||Tl[Cl],Jl=Array.isArray(_i)&&_i.filter(function(Ip){return Ip.target==="parent"?!1:Array.isArray(Ip.childName)?Ip.childName.indexOf(Kl)>-1:Ip.childName===Kl||Ip.childName==="all"}),Ep=[Kl,$,Jl,stringify(_n.state[Kl])],_p=_n.getCachedSharedEvents(Kl,Ep)||{events:Jl,getEvents:function(Ip,Up){return _n.getScopedEvents(Ip,Up,Kl,$)},getEventState:function(Ip,Up){return _n.getEventState(Ip,Up,Kl)}};return _n.cacheSharedEvents(Kl,_p,Ep),Sl.concat(React.cloneElement(Il,assign_1({key:"events-".concat(Kl),sharedEvents:_p,eventKey:_s,name:Kl},Il.props)))}return Sl.concat(Il)},[])},ba=keys_1($),xa=React.Children.toArray(j.children);return ga(xa,ba)}},{key:"getContainer",value:function(j,$,_n){var _i=this,_s=this.getNewChildren(j,$),ga=Array.isArray(_n)&&_n.filter(function(Ul){return Ul.target==="parent"}),ba=ga.length>0?{events:ga,getEvents:function(Ul,Kl){return _i.getScopedEvents(Ul,Kl,null,$)},getEventState:this.getEventState}:null,xa=j.container||j.groupComponent,El=xa.type&&xa.type.role,Tl=xa.props||{},Sl=getEvents.bind(this),Il=ba&&Sl({sharedEvents:ba},"parent"),Cl=defaults_1({},this.getEventState("parent","parent"),Tl,$.parent,{children:_s}),Nl=defaults_1({},getPartialEvents(Il,"parent",Cl),Tl.events);this.globalEvents=getGlobalEvents(Nl);var Dl=omitGlobalEvents(Nl);return El==="container"?React.cloneElement(xa,assign_1({},Cl,{events:Dl})):React.cloneElement(xa,Dl,_s)}},{key:"render",value:function(){var j=this.getAllEvents(this.props);return j?this.getContainer(this.props,this.baseProps,j):React.cloneElement(this.props.container,{children:this.props.children})}}]),g}(React.Component);VictorySharedEvents.displayName="VictorySharedEvents";VictorySharedEvents.role="shared-event-wrapper";VictorySharedEvents.propTypes={children:propTypesExports.oneOfType([propTypesExports.arrayOf(propTypesExports.node),propTypesExports.node]),container:propTypesExports.node,eventKey:propTypesExports.oneOfType([propTypesExports.array,propTypesExports.func,allOfType([integer,nonNegative]),propTypesExports.string]),events:propTypesExports.arrayOf(propTypesExports.shape({childName:propTypesExports.oneOfType([propTypesExports.string,propTypesExports.array]),eventHandlers:propTypesExports.object,eventKey:propTypesExports.oneOfType([propTypesExports.array,propTypesExports.func,allOfType([integer,nonNegative]),propTypesExports.string]),target:propTypesExports.string})),externalEventMutations:propTypesExports.arrayOf(propTypesExports.shape({callback:propTypesExports.func,childName:propTypesExports.oneOfType([propTypesExports.string,propTypesExports.array]),eventKey:propTypesExports.oneOfType([propTypesExports.array,allOfType([integer,nonNegative]),propTypesExports.string]),mutation:propTypesExports.func,target:propTypesExports.oneOfType([propTypesExports.string,propTypesExports.array])})),groupComponent:propTypesExports.node};VictorySharedEvents.defaultProps={groupComponent:React.createElement("g",null)};VictorySharedEvents.contextType=TimerContext$1;var getPosition=function(h,i,g){return g==="x"?h*Math.cos(i):-h*Math.sin(i)},getAxisType=function(h){var i=h.dependentAxis?"radial":"angular",g=i==="angular"?"radial":"angular";return h.horizontal?g:i},filterTicks=function(h,i){var g=function(_){return i(_)%(2*Math.PI)};return uniqBy_1(h,g)},getEvaluatedStyles=function(h,i){return{tickStyle:evaluateStyle(h.ticks,i),labelStyle:evaluateStyle(h.tickLabels,i),gridStyle:evaluateStyle(h.grid,i)}},getStyleObject=function(h){var i=h.theme,g=i===void 0?{}:i,_=h.dependentAxis,j=g.polarAxis&&g.polarAxis.style||g.axis&&g.axis.style,$=_?"polarDependentAxis":"polarIndependentAxis",_n=_?"dependentAxis":"independentAxis",_i=g[$]&&g[$].style||g[_n]&&g[_n].style,_s=function(){var ga=["axis","axisLabel","grid","parent","tickLabels","ticks"];return ga.reduce(function(ba,xa){return ba[xa]=defaults_1({},_i[xa],j[xa]),ba},{})};return j&&_i?_s():_i||j},getRadius=function(h){var i=getPadding$1(h),g=i.left,_=i.right,j=i.top,$=i.bottom,_n=h.width,_i=h.height;return Math.min(_n-g-_,_i-j-$)/2},getRange=function(h,i){if(h.range&&h.range[i])return h.range[i];if(h.range&&Array.isArray(h.range))return h.range;var g=getAxisType(h);if(g==="angular"){var _=degreesToRadians(h.startAngle),j=degreesToRadians(h.endAngle);return[_,j]}var $=getRadius(h);return[h.innerRadius||0,$]},getScale=function(h){var i=getAxis(h),g=getBaseScale(h,i),_=getDomain$2(h,i)||g.domain(),j=getRange(h,i);return g.range(j),g.domain(_),g},getStyles$1=function(h,i){if(h.disableInlineStyles)return{};var g=h.style||{};i=i||{};var _={height:"auto",width:"100%"};return{parent:defaults_1(_,g.parent,i.parent),axis:defaults_1({},g.axis,i.axis),axisLabel:defaults_1({},g.axisLabel,i.axisLabel),grid:defaults_1({},g.grid,i.grid),ticks:defaults_1({},g.ticks,i.ticks),tickLabels:defaults_1({},g.tickLabels,i.tickLabels)}},getAxisAngle=function(h){var i=h.axisAngle,g=h.startAngle,_=h.dependentAxis,j=getAxis(h),$=getAxisValue(h,j);return $===void 0||!_?i===void 0?g:i:radiansToDegrees($)},getTickProps=function(h,i,g,_){var j=i.axisType,$=i.radius,_n=i.scale,_i=i.style,_s=i.stringTicks,ga=i.ticks,ba=i.tickFormat,xa=i.origin,El=ba(g,_,ga),Tl=_s?_s[_]:g,Sl=getEvaluatedStyles(_i,{tick:Tl,tickValue:g,index:_,ticks:ga,stringTicks:_s,radius:$,scale:_n,axisType:j,text:El}),Il=Sl.tickStyle,Cl=j==="radial"?getAxisAngle(h):void 0,Nl=Il.padding||Il.size||0,Dl=degreesToRadians(90-Cl),Ul=j==="angular"?_n(g):degreesToRadians(-1*Cl),Kl=j==="angular"?$:_n(g);return j==="angular"?{index:_,datum:Tl,style:Il,x1:getPosition(Kl,Ul,"x")+xa.x,y1:getPosition(Kl,Ul,"y")+xa.y,x2:getPosition(Kl+Nl,Ul,"x")+xa.x,y2:getPosition(Kl+Nl,Ul,"y")+xa.y}:{index:_,datum:Tl,style:Il,x1:Kl*Math.cos(Ul)+Math.cos(Dl)*Nl+xa.x,x2:Kl*Math.cos(Ul)-Math.cos(Dl)*Nl+xa.x,y1:Kl*Math.sin(Ul)+Math.sin(Dl)*Nl+xa.y,y2:Kl*Math.sin(Ul)-Math.sin(Dl)*Nl+xa.y}},getTickLabelProps=function(h,i,g,_){var j=i.axisType,$=i.radius,_n=i.tickFormat,_i=i.style,_s=i.scale,ga=i.ticks,ba=i.stringTicks,xa=i.origin,El=_n(g,_,ga),Tl=ba?ba[_]:g,Sl=getEvaluatedStyles(_i,{text:El,tick:Tl,tickValue:g,index:_,ticks:ga,stringTicks:ba,radius:$,scale:_s,axisType:j}),Il=Sl.labelStyle,Cl=h.tickLabelComponent,Nl=Cl.props&&Cl.props.labelPlacement?Cl.props.labelPlacement:h.labelPlacement,Dl=Il.padding||0,Ul=0,Kl=j==="radial"?getAxisAngle(h):void 0,Jl=j==="angular"?radiansToDegrees(_s(g)):Kl+Ul,Ep=Il.angle===void 0?getPolarAngle(assign_1({},h,{labelPlacement:Nl}),Jl):Il.angle,_p=j==="angular"?$+Dl:_s(g),Ip=Il.textAnchor||getPolarTextAnchor(assign_1({},h,{labelPlacement:Nl}),Jl);return{index:_,datum:Tl,style:Il,angle:Ep,textAnchor:Ip,text:El,x:_p*Math.cos(degreesToRadians(Jl))+xa.x,y:-_p*Math.sin(degreesToRadians(Jl))+xa.y}},getGridProps=function(h,i,g,_){var j=i.axisType,$=i.radius,_n=i.style,_i=i.scale,_s=i.stringTicks,ga=i.ticks,ba=i.tickFormat,xa=i.origin,El=ba(g,_,ga),Tl=h.startAngle,Sl=h.endAngle,Il=h.innerRadius,Cl=Il===void 0?0:Il,Nl=_s?_s[_]:g,Dl=getEvaluatedStyles(_n,{tick:Nl,tickValue:g,index:_,ticks:ga,stringTicks:_s,radius:$,scale:_i,axisType:j,text:El}),Ul=Dl.gridStyle,Kl=_i(g);return j==="angular"?{index:_,datum:Nl,style:Ul,x1:getPosition($,Kl,"x")+xa.x,y1:getPosition($,Kl,"y")+xa.y,x2:getPosition(Cl,Kl,"x")+xa.x,y2:getPosition(Cl,Kl,"y")+xa.y}:{style:Ul,index:_,datum:Nl,cx:xa.x,cy:xa.y,r:_i(g),startAngle:Tl,endAngle:Sl}},getAxisLabelProps=function(h,i){var g=i.axisType,_=i.radius,j=i.style;i.scale;var $=i.origin,_n=h.axisLabelComponent;if(g!=="radial")return{};var _i=_n.props&&_n.props.labelPlacement?_n.props.labelPlacement:h.labelPlacement,_s=j&&j.axisLabel||{},ga=g==="radial"?getAxisAngle(h):void 0,ba=_s.angle===void 0?getPolarAngle(assign_1({},h,{labelPlacement:_i}),ga):_s.angle,xa=_+(_s.padding||0),El=_s.textAnchor||getPolarTextAnchor(assign_1({},h,{labelPlacement:_i}),ga),Tl=_s.verticalAnchor||getPolarVerticalAnchor(assign_1({},h,{labelPlacement:_i}),ga);return{style:_s,angle:ba,textAnchor:El,verticalAnchor:Tl,text:h.label,x:getPosition(xa,degreesToRadians(ga),"x")+$.x,y:getPosition(xa,degreesToRadians(ga),"y")+$.y}},getAxisProps$1=function(h,i){var g=i.style,_=i.axisType,j=i.radius;i.scale;var $=i.origin,_n=h.startAngle,_i=h.endAngle,_s=h.innerRadius,ga=_s===void 0?0:_s,ba=_==="radial"?degreesToRadians(getAxisAngle(h)):void 0;return _==="radial"?{style:g.axis,x1:getPosition(ga,ba,"x")+$.x,x2:getPosition(j,ba,"x")+$.x,y1:getPosition(ga,ba,"y")+$.y,y2:getPosition(j,ba,"y")+$.y}:{style:g.axis,cx:$.x,cy:$.y,r:j,startAngle:_n,endAngle:_i}},getCalculatedValues$1=function(h){h=assign_1({polar:!0},h);var i=getStyleObject(h),g=getStyles$1(h,i),_=getPadding$1(h),j=getAxis(h),$=getAxisType(h),_n=stringTicks(h)?h.tickValues:void 0,_i=getDomain$2(h,j),_s=getRange(h,j),ga=getScale(h),ba=getTicks(h,ga),xa=$==="angular"?filterTicks(ba,ga):ba,El=getTickFormat(h,ga),Tl=getRadius(h),Sl=getPolarOrigin(h);return{axis:j,style:g,padding:_,stringTicks:_n,axisType:$,scale:ga,ticks:xa,tickFormat:El,domain:_i,range:_s,radius:Tl,origin:Sl}},getBaseProps$1=function(h,i){h=modifyProps(h,i);var g=getCalculatedValues$1(h),_=g.style,j=g.scale,$=g.ticks,_n=g.domain,_i=h,_s=_i.width,ga=_i.height,ba=_i.standalone,xa=_i.theme,El=_i.name,Tl=getAxisProps$1(h,g),Sl=getAxisLabelProps(h,g),Il={parent:{style:_.parent,ticks:$,scale:j,width:_s,height:ga,domain:_n,standalone:ba,theme:xa,name:El}};return $.reduce(function(Cl,Nl,Dl){return Cl[Dl]={axis:Tl,axisLabel:Sl,ticks:getTickProps(h,g,Nl,Dl),tickLabels:getTickLabelProps(h,g,Nl,Dl),grid:getGridProps(h,g,Nl,Dl)},Cl},Il)};function ownKeys$5(h,i){var g=Object.keys(h);if(Object.getOwnPropertySymbols){var _=Object.getOwnPropertySymbols(h);i&&(_=_.filter(function(j){return Object.getOwnPropertyDescriptor(h,j).enumerable})),g.push.apply(g,_)}return g}function _objectSpread$5(h){for(var i=1;i<arguments.length;i++){var g=arguments[i]!=null?arguments[i]:{};i%2?ownKeys$5(Object(g),!0).forEach(function(_){_defineProperty$5(h,_,g[_])}):Object.getOwnPropertyDescriptors?Object.defineProperties(h,Object.getOwnPropertyDescriptors(g)):ownKeys$5(Object(g)).forEach(function(_){Object.defineProperty(h,_,Object.getOwnPropertyDescriptor(g,_))})}return h}function _defineProperty$5(h,i,g){return i in h?Object.defineProperty(h,i,{value:g,enumerable:!0,configurable:!0,writable:!0}):h[i]=g,h}function _toConsumableArray$1(h){return _arrayWithoutHoles$1(h)||_iterableToArray$1(h)||_unsupportedIterableToArray$2(h)||_nonIterableSpread$1()}function _nonIterableSpread$1(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _unsupportedIterableToArray$2(h,i){if(h){if(typeof h=="string")return _arrayLikeToArray$2(h,i);var g=Object.prototype.toString.call(h).slice(8,-1);if(g==="Object"&&h.constructor&&(g=h.constructor.name),g==="Map"||g==="Set")return Array.from(h);if(g==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(g))return _arrayLikeToArray$2(h,i)}}function _iterableToArray$1(h){if(typeof Symbol<"u"&&h[Symbol.iterator]!=null||h["@@iterator"]!=null)return Array.from(h)}function _arrayWithoutHoles$1(h){if(Array.isArray(h))return _arrayLikeToArray$2(h)}function _arrayLikeToArray$2(h,i){(i==null||i>h.length)&&(i=h.length);for(var g=0,_=new Array(i);g<i;g++)_[g]=h[g];return _}function _classCallCheck$1(h,i){if(!(h instanceof i))throw new TypeError("Cannot call a class as a function")}function _defineProperties$1(h,i){for(var g=0;g<i.length;g++){var _=i[g];_.enumerable=_.enumerable||!1,_.configurable=!0,"value"in _&&(_.writable=!0),Object.defineProperty(h,_.key,_)}}function _createClass$1(h,i,g){return i&&_defineProperties$1(h.prototype,i),g&&_defineProperties$1(h,g),Object.defineProperty(h,"prototype",{writable:!1}),h}function _inherits$1(h,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");h.prototype=Object.create(i&&i.prototype,{constructor:{value:h,writable:!0,configurable:!0}}),Object.defineProperty(h,"prototype",{writable:!1}),i&&_setPrototypeOf$1(h,i)}function _setPrototypeOf$1(h,i){return _setPrototypeOf$1=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(_,j){return _.__proto__=j,_},_setPrototypeOf$1(h,i)}function _createSuper$1(h){var i=_isNativeReflectConstruct$1();return function(){var _=_getPrototypeOf$1(h),j;if(i){var $=_getPrototypeOf$1(this).constructor;j=Reflect.construct(_,arguments,$)}else j=_.apply(this,arguments);return _possibleConstructorReturn$1(this,j)}}function _possibleConstructorReturn$1(h,i){if(i&&(typeof i=="object"||typeof i=="function"))return i;if(i!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized$1(h)}function _assertThisInitialized$1(h){if(h===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return h}function _isNativeReflectConstruct$1(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function _getPrototypeOf$1(h){return _getPrototypeOf$1=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(g){return g.__proto__||Object.getPrototypeOf(g)},_getPrototypeOf$1(h)}var fallbackProps$5={width:450,height:300,padding:50},options$1={components:[{name:"axis",index:0},{name:"axisLabel",index:0},{name:"grid"},{name:"parent",index:"parent"},{name:"ticks"},{name:"tickLabels"}]},VictoryPolarAxis=function(h){_inherits$1(g,h);var i=_createSuper$1(g);function g(){return _classCallCheck$1(this,g),i.apply(this,arguments)}return _createClass$1(g,[{key:"renderAxisLine",value:function(j){var $=j.dependentAxis,_n=$?j.axisComponent:j.circularAxisComponent,_i=this.getComponentProps(_n,"axis",0);return React.cloneElement(_n,_i)}},{key:"renderLabel",value:function(j){var $=j.axisLabelComponent,_n=j.dependentAxis,_i=j.label;if(!_i||!_n)return null;var _s=this.getComponentProps($,"axisLabel",0);return React.cloneElement($,_s)}},{key:"renderAxis",value:function(j){var $=this,_n=j.tickComponent,_i=j.tickLabelComponent,_s=j.name,ga=function(Dl){var Ul=Dl.style,Kl=Ul===void 0?{}:Ul,Jl=Dl.events,Ep=Jl===void 0?{}:Jl,_p=Kl.stroke!=="transparent"&&Kl.stroke!=="none"&&Kl.strokeWidth!==0;return _p||!isEmpty_1(Ep)},ba=j.dependentAxis?"radial":"angular",xa=ba==="radial"?j.circularGridComponent:j.gridComponent,El=this.dataKeys.map(function(Dl,Ul){var Kl=assign_1({key:"".concat(_s,"-tick-").concat(Dl)},$.getComponentProps(_n,"ticks",Ul)),Jl=React.cloneElement(_n,Kl);return ga(Jl.props)?Jl:void 0}).filter(Boolean),Tl=this.dataKeys.map(function(Dl,Ul){var Kl=assign_1({key:"".concat(_s,"-grid-").concat(Dl)},$.getComponentProps(xa,"grid",Ul)),Jl=React.cloneElement(xa,Kl);return ga(Jl.props)?Jl:void 0}).filter(Boolean),Sl=this.dataKeys.map(function(Dl,Ul){var Kl=assign_1({key:"".concat(_s,"-tick-").concat(Dl)},$.getComponentProps(_i,"tickLabels",Ul));return React.cloneElement(_i,Kl)}),Il=this.renderAxisLine(j),Cl=this.renderLabel(j),Nl=[Il,Cl].concat(_toConsumableArray$1(El),_toConsumableArray$1(Tl),_toConsumableArray$1(Sl));return this.renderGroup(j,Nl)}},{key:"renderGroup",value:function(j,$){var _n=j.groupComponent;return React.cloneElement(_n,{},$)}},{key:"shouldAnimate",value:function(){return!!this.props.animate}},{key:"render",value:function(){var j=g.animationWhitelist,$=modifyProps(this.props,fallbackProps$5);if(this.shouldAnimate())return this.animateComponent($,j);var _n=this.renderAxis($);return $.standalone?this.renderContainer($.containerComponent,_n):_n}}]),g}(React.Component);VictoryPolarAxis.animationWhitelist=["style","domain","range","tickCount","tickValues","padding","width","height"];VictoryPolarAxis.displayName="VictoryAxis";VictoryPolarAxis.role="axis";VictoryPolarAxis.defaultTransitions={onExit:{duration:500},onEnter:{duration:500}};VictoryPolarAxis.propTypes=_objectSpread$5(_objectSpread$5({},CommonProps.baseProps),{},{axisAngle:propTypesExports.number,axisComponent:propTypesExports.element,axisLabelComponent:propTypesExports.element,axisValue:propTypesExports.oneOfType([propTypesExports.number,propTypesExports.string,propTypesExports.object]),categories:propTypesExports.oneOfType([propTypesExports.arrayOf(propTypesExports.string),propTypesExports.shape({x:propTypesExports.arrayOf(propTypesExports.string),y:propTypesExports.arrayOf(propTypesExports.string)})]),circularAxisComponent:propTypesExports.element,circularGridComponent:propTypesExports.element,containerComponent:propTypesExports.element,dependentAxis:propTypesExports.bool,disableInlineStyles:propTypesExports.bool,endAngle:propTypesExports.number,events:propTypesExports.arrayOf(propTypesExports.shape({target:propTypesExports.oneOf(["axis","axisLabel","grid","ticks","tickLabels"]),eventKey:propTypesExports.oneOfType([propTypesExports.array,allOfType([integer,nonNegative]),propTypesExports.string]),eventHandlers:propTypesExports.object})),gridComponent:propTypesExports.element,innerRadius:nonNegative,labelPlacement:propTypesExports.oneOf(["parallel","perpendicular","vertical"]),startAngle:propTypesExports.number,stringMap:propTypesExports.object,style:propTypesExports.shape({parent:propTypesExports.object,axis:propTypesExports.object,axisLabel:propTypesExports.object,grid:propTypesExports.object,ticks:propTypesExports.object,tickLabels:propTypesExports.object}),tickComponent:propTypesExports.element,tickCount:allOfType([integer,greaterThanZero]),tickFormat:propTypesExports.oneOfType([propTypesExports.func,homogeneousArray]),tickLabelComponent:propTypesExports.element,tickValues:homogeneousArray});VictoryPolarAxis.defaultProps={axisComponent:React.createElement(LineSegment,null),axisLabelComponent:React.createElement(VictoryLabel,null),circularAxisComponent:React.createElement(Arc,null),circularGridComponent:React.createElement(Arc,null),containerComponent:React.createElement(VictoryContainer,null),endAngle:360,gridComponent:React.createElement(LineSegment,null),groupComponent:React.createElement("g",{role:"presentation"}),labelPlacement:"parallel",startAngle:0,standalone:!0,theme:VictoryTheme.grayscale,tickComponent:React.createElement(LineSegment,null),tickLabelComponent:React.createElement(VictoryLabel,null)};VictoryPolarAxis.getDomain=getDomain$2;VictoryPolarAxis.getAxis=getAxis;VictoryPolarAxis.getScale=getScale;VictoryPolarAxis.getStyles=function(h){return getStyles$1(h,fallbackProps$5.style)};VictoryPolarAxis.getBaseProps=function(h){return getBaseProps$1(h,fallbackProps$5)};VictoryPolarAxis.expectedComponents=["axisComponent","circularAxisComponent","groupComponent","containerComponent","tickComponent","tickLabelComponent","gridComponent","circularGridComponent"];const VictoryPolarAxis$1=addEvents(VictoryPolarAxis,options$1);function _toConsumableArray(h){return _arrayWithoutHoles(h)||_iterableToArray(h)||_unsupportedIterableToArray$1(h)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _unsupportedIterableToArray$1(h,i){if(h){if(typeof h=="string")return _arrayLikeToArray$1(h,i);var g=Object.prototype.toString.call(h).slice(8,-1);if(g==="Object"&&h.constructor&&(g=h.constructor.name),g==="Map"||g==="Set")return Array.from(h);if(g==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(g))return _arrayLikeToArray$1(h,i)}}function _iterableToArray(h){if(typeof Symbol<"u"&&h[Symbol.iterator]!=null||h["@@iterator"]!=null)return Array.from(h)}function _arrayWithoutHoles(h){if(Array.isArray(h))return _arrayLikeToArray$1(h)}function _arrayLikeToArray$1(h,i){(i==null||i>h.length)&&(i=h.length);for(var g=0,_=new Array(i);g<i;g++)_[g]=h[g];return _}var fallbackProps$4={width:450,height:300,padding:50};function getAxisProps(h,i,g){var _=g.domain,j=g.scale,$=g.stringMap,_n=g.categories,_i=g.horizontal;return{stringMap:$,horizontal:_i,categories:_n,startAngle:i.startAngle,endAngle:i.endAngle,innerRadius:i.innerRadius,domain:_,scale:j}}function getBackgroundWithProps(h,i){var g=h.backgroundComponent,_=h.polar?i.range.y[1]:i.range.y[0]-i.range.y[1],j=i.range.x[1]-i.range.x[0],$=h.horizontal?i.scale.y.range()[0]:i.scale.x.range()[0],_n=h.horizontal?i.scale.x.range()[1]:i.scale.y.range()[1],_i=h.polar?i.origin.x:$,_s=h.polar?i.origin.y:_n,ga=h.name||"chart",ba={height:_,polar:h.polar,scale:i.scale,style:h.style.background,x:_i,y:_s,key:"".concat(ga,"-background"),width:j};return React.cloneElement(g,defaults_1({},g.props,ba))}function getChildProps$1(h,i,g){var _=findAxisComponents([h]);if(_.length>0)return getAxisProps(_[0],i,g);var j=g.categories,$=g.domain,_n=g.range,_i=g.scale,_s=g.stringMap,ga=g.horizontal;return{categories:j,domain:$,range:_n,scale:_i,stringMap:_s,horizontal:ga}}function getStyles(h){var i=h.style&&h.style.parent;return{parent:defaults_1({},i,{height:"100%",width:"100%",userSelect:"none"})}}function getCalculatedProps$1(h,i){var g=getStyles(h);h=modifyProps$1(h,fallbackProps$4,"chart");var _=h,j=_.horizontal,$=_.polar,_n=getStringsFromChildren(h,i),_i=getCategories(h,i,_n),_s=createStringMap(h,i,_n),ga={x:getDomain(assign_1({},h,{categories:_i}),"x",i),y:getDomain(assign_1({},h,{categories:_i}),"y",i)},ba={x:getRange$1(h,"x"),y:getRange$1(h,"y")},xa={x:getScaleFromProps(h,"x")||getScale$2(h,"x"),y:getScaleFromProps(h,"y")||getScale$2(h,"y")},El={x:xa.x.domain(ga.x).range(j?ba.y:ba.x),y:xa.y.domain(ga.y).range(j?ba.x:ba.y)},Tl=$?getPolarOrigin(h):getOrigin(ga),Sl=getPadding$1(h);return{categories:_i,domain:ga,range:ba,horizontal:j,scale:El,stringMap:_s,style:g,origin:Tl,padding:Sl}}function getChildren$1(h,i,g){i=i||getChildComponents(h),g=g||getCalculatedProps$1(h,i);var _=g.style.parent,j=h.height,$=h.polar,_n=h.theme,_i=h.width,_s=g,ga=_s.origin,ba=_s.horizontal,xa=h.name||"chart";return i.map(function(El,Tl){var Sl=El.type&&El.type.role,Il=Array.isArray(El.props.style)?El.props.style:defaults_1({},El.props.style,{parent:_}),Cl=getChildProps$1(El,h,g),Nl=El.props.name||"".concat(xa,"-").concat(Sl,"-").concat(Tl),Dl=defaults_1({horizontal:ba,height:j,polar:$,theme:_n,width:_i,style:Il,name:Nl,origin:$?ga:void 0,padding:g.padding,key:"".concat(Nl,"-key-").concat(Tl),standalone:!1},Cl);return React.cloneElement(El,Dl)})}var getChildComponents=function(h,i){var g=React.Children.toArray(h.children),_=_toConsumableArray(g);if(g.length===0)_.push(i.independent,i.dependent);else{var j={dependent:getAxisComponentsWithParent(g,"dependent"),independent:getAxisComponentsWithParent(g,"independent")};j.dependent.length===0&&j.independent.length===0&&(_=h.prependDefaultAxes?[i.independent,i.dependent].concat(_):_.concat([i.independent,i.dependent]))}return _},getDomain=function(h,i,g){g=g||React.Children.toArray(h.children);var _=getDomain$1(h,i,g),j=getAxisComponent(g,i),$=j&&j.props&&j.props.invertAxis;return $?_.concat().reverse():_},createStringMap=function(h,i,g){var _=!g.x||g.x.length===0?null:g.x.reduce(function($,_n,_i){return $[_n]=_i+1,$},{}),j=!g.y||g.y.length===0?null:g.y.reduce(function($,_n,_i){return $[_n]=_i+1,$},{});return{x:_,y:j}};function ownKeys$4(h,i){var g=Object.keys(h);if(Object.getOwnPropertySymbols){var _=Object.getOwnPropertySymbols(h);i&&(_=_.filter(function(j){return Object.getOwnPropertyDescriptor(h,j).enumerable})),g.push.apply(g,_)}return g}function _objectSpread$4(h){for(var i=1;i<arguments.length;i++){var g=arguments[i]!=null?arguments[i]:{};i%2?ownKeys$4(Object(g),!0).forEach(function(_){_defineProperty$4(h,_,g[_])}):Object.getOwnPropertyDescriptors?Object.defineProperties(h,Object.getOwnPropertyDescriptors(g)):ownKeys$4(Object(g)).forEach(function(_){Object.defineProperty(h,_,Object.getOwnPropertyDescriptor(g,_))})}return h}function _defineProperty$4(h,i,g){return i in h?Object.defineProperty(h,i,{value:g,enumerable:!0,configurable:!0,writable:!0}):h[i]=g,h}var fallbackProps$3={width:450,height:300,padding:50},VictoryChartImpl=function(h){var i="chart",g=useAnimationState(),_=g.getAnimationProps,j=g.setAnimationState,$=g.getProps,_n=$(h),_i=modifyProps$1(_n,fallbackProps$3,i),_s=_i.desc,ga=_i.eventKey,ba=_i.containerComponent,xa=_i.standalone,El=_i.groupComponent,Tl=_i.externalEventMutations,Sl=_i.width,Il=_i.height,Cl=_i.theme,Nl=_i.polar,Dl=_i.name,Ul=_i.title,Kl=_n.polar?_i.defaultPolarAxes:_i.defaultAxes,Jl=React.useMemo(function(){return getChildComponents(_i,Kl)},[_i,Kl]),Ep=React.useMemo(function(){return getCalculatedProps$1(_i,Jl)},[_i,Jl]),_p=Ep.domain,Ip=Ep.scale,Up=Ep.style,yp=Ep.origin,Ap=Ep.horizontal,Cp=React.useMemo(function(){var Hp=getChildren$1(_n,Jl,Ep),xp=Hp.map(function($p,c0){var n0=assign_1({animate:_(_n,$p,c0)},$p.props);return React.cloneElement($p,n0)});if(_n.style&&_n.style.background){var Gp=getBackgroundWithProps(_n,Ep);xp.unshift(Gp)}return xp},[_,Jl,_n,Ep]),Mp=React.useMemo(function(){return xa?{desc:_s,domain:_p,width:Sl,height:Il,horizontal:Ap,name:Dl,origin:Nl?yp:void 0,polar:Nl,theme:Cl,title:Ul,scale:Ip,standalone:xa,style:Up.parent}:{}},[_s,_p,Il,Ap,Dl,yp,Nl,Ip,xa,Up,Ul,Cl,Sl]),wp=React.useMemo(function(){if(xa){var Hp=defaults_1({},ba.props,Mp,getSafeUserProps(h));return React.cloneElement(ba,Hp)}return El},[El,xa,ba,Mp,h]),Np=React.useMemo(function(){return getAllEvents(_n)},[_n]),Fp=usePreviousProps(h);return React.useEffect(function(){return function(){h.animate&&j(Fp,h)}},[j,Fp,h]),isEmpty_1(Np)?React.cloneElement(wp,wp.props,Cp):React.createElement(VictorySharedEvents,{container:wp,eventKey:ga,events:Np,externalEventMutations:Tl},Cp)};VictoryChartImpl.propTypes=_objectSpread$4(_objectSpread$4({},CommonProps.baseProps),{},{backgroundComponent:propTypesExports.element,children:propTypesExports.oneOfType([propTypesExports.arrayOf(propTypesExports.node),propTypesExports.node]),defaultAxes:propTypesExports.shape({independent:propTypesExports.element,dependent:propTypesExports.element}),defaultPolarAxes:propTypesExports.shape({independent:propTypesExports.element,dependent:propTypesExports.element}),endAngle:propTypesExports.number,innerRadius:nonNegative,prependDefaultAxes:propTypesExports.bool,startAngle:propTypesExports.number});VictoryChartImpl.defaultProps={backgroundComponent:React.createElement(Background,null),containerComponent:React.createElement(VictoryContainer,null),defaultAxes:{independent:React.createElement(VictoryAxis,null),dependent:React.createElement(VictoryAxis,{dependentAxis:!0})},defaultPolarAxes:{independent:React.createElement(VictoryPolarAxis$1,null),dependent:React.createElement(VictoryPolarAxis$1,{dependentAxis:!0})},groupComponent:React.createElement("g",null),standalone:!0,theme:VictoryTheme.grayscale};var VictoryChart=React.memo(VictoryChartImpl,reactFastCompare);VictoryChart.displayName="VictoryChart";VictoryChart.expectedComponents=["groupComponent","containerComponent"];var getCalculatedValues=function(h){var i=getData(h);i.length<2&&(i=[]);var g={x:getRange$1(h,"x"),y:getRange$1(h,"y")},_={x:getDomain$3(h,"x"),y:getDomain$3(h,"y")},j={x:getBaseScale(h,"x").domain(_.x).range(h.horizontal?g.y:g.x),y:getBaseScale(h,"y").domain(_.y).range(h.horizontal?g.x:g.y)},$=h.polar?h.origin||getPolarOrigin(h):void 0,_n=getDefaultStyles(h,"line"),_i=getStyles$4(h.style,_n);return{domain:_,data:i,scale:j,style:_i,origin:$}},getBaseProps=function(h,i){var g=modifyProps$1(h,i,"line");h=assign_1({},g,getCalculatedValues(g));var _=h,j=_.data,$=_.domain,_n=_.events,_i=_.groupComponent,_s=_.height,ga=_.horizontal,ba=_.interpolation,xa=_.origin,El=_.padding,Tl=_.polar,Sl=_.scale,Il=_.sharedEvents,Cl=_.standalone,Nl=_.style,Dl=_.theme,Ul=_.width,Kl=_.labels,Jl=_.name,Ep=_.disableInlineStyles,_p={parent:{style:Nl.parent,scale:Sl,data:j,height:_s,width:Ul,name:Jl,domain:$,standalone:Cl,polar:Tl,origin:xa,padding:El,horizontal:ga},all:{data:{horizontal:ga,polar:Tl,origin:xa,scale:Sl,data:j,interpolation:ba,groupComponent:_i,style:Ep?{}:Nl.data,theme:Dl,disableInlineStyles:Ep}}};return j.reduce(function(Ip,Up,yp){var Ap=getText(h,Up,yp);if(Ap!=null||Kl&&(_n||Il)){var Cp=isNil_1(Up.eventKey)?yp:Up.eventKey;Ip[Cp]={labels:getProps(h,yp)}}return Ip},_p)};function ownKeys$3(h,i){var g=Object.keys(h);if(Object.getOwnPropertySymbols){var _=Object.getOwnPropertySymbols(h);i&&(_=_.filter(function(j){return Object.getOwnPropertyDescriptor(h,j).enumerable})),g.push.apply(g,_)}return g}function _objectSpread$3(h){for(var i=1;i<arguments.length;i++){var g=arguments[i]!=null?arguments[i]:{};i%2?ownKeys$3(Object(g),!0).forEach(function(_){_defineProperty$3(h,_,g[_])}):Object.getOwnPropertyDescriptors?Object.defineProperties(h,Object.getOwnPropertyDescriptors(g)):ownKeys$3(Object(g)).forEach(function(_){Object.defineProperty(h,_,Object.getOwnPropertyDescriptor(g,_))})}return h}function _defineProperty$3(h,i,g){return i in h?Object.defineProperty(h,i,{value:g,enumerable:!0,configurable:!0,writable:!0}):h[i]=g,h}var evaluateProps=function(h){var i=evaluateProp(h.ariaLabel,h),g=evaluateProp(h.id,h),_=evaluateStyle(assign_1({fill:"none",stroke:"black",pointerEvents:"stroke"},h.style),h),j=evaluateProp(h.tabIndex,h);return assign_1({},h,{ariaLabel:i,id:g,style:_,tabIndex:j})},Curve=function(h){h=evaluateProps(h);var i=getSafeUserProps(h),g=h,_=g.polar,j=g.origin,$=getLineFunction(h),_n=_&&j?"translate(".concat(j.x,", ").concat(j.y,")"):void 0,_i=$(h.data);return React.cloneElement(h.pathComponent,_objectSpread$3(_objectSpread$3(_objectSpread$3({},h.events),i),{},{"aria-label":h.ariaLabel,d:_i,style:h.style,transform:h.transform||_n,className:h.className,role:h.role,shapeRendering:h.shapeRendering,clipPath:h.clipPath,tabIndex:h.tabIndex}))};Curve.propTypes=_objectSpread$3(_objectSpread$3({},CommonProps.primitiveProps),{},{interpolation:propTypesExports.oneOfType([propTypesExports.string,propTypesExports.func]),openCurve:propTypesExports.bool,origin:propTypesExports.shape({x:propTypesExports.number.isRequired,y:propTypesExports.number.isRequired}),pathComponent:propTypesExports.element,polar:propTypesExports.bool});Curve.defaultProps={pathComponent:React.createElement(Path$1,null),role:"presentation",shapeRendering:"auto"};function ownKeys$2(h,i){var g=Object.keys(h);if(Object.getOwnPropertySymbols){var _=Object.getOwnPropertySymbols(h);i&&(_=_.filter(function(j){return Object.getOwnPropertyDescriptor(h,j).enumerable})),g.push.apply(g,_)}return g}function _objectSpread$2(h){for(var i=1;i<arguments.length;i++){var g=arguments[i]!=null?arguments[i]:{};i%2?ownKeys$2(Object(g),!0).forEach(function(_){_defineProperty$2(h,_,g[_])}):Object.getOwnPropertyDescriptors?Object.defineProperties(h,Object.getOwnPropertyDescriptors(g)):ownKeys$2(Object(g)).forEach(function(_){Object.defineProperty(h,_,Object.getOwnPropertyDescriptor(g,_))})}return h}function _defineProperty$2(h,i,g){return i in h?Object.defineProperty(h,i,{value:g,enumerable:!0,configurable:!0,writable:!0}):h[i]=g,h}function _classCallCheck(h,i){if(!(h instanceof i))throw new TypeError("Cannot call a class as a function")}function _defineProperties(h,i){for(var g=0;g<i.length;g++){var _=i[g];_.enumerable=_.enumerable||!1,_.configurable=!0,"value"in _&&(_.writable=!0),Object.defineProperty(h,_.key,_)}}function _createClass(h,i,g){return i&&_defineProperties(h.prototype,i),g&&_defineProperties(h,g),Object.defineProperty(h,"prototype",{writable:!1}),h}function _inherits(h,i){if(typeof i!="function"&&i!==null)throw new TypeError("Super expression must either be null or a function");h.prototype=Object.create(i&&i.prototype,{constructor:{value:h,writable:!0,configurable:!0}}),Object.defineProperty(h,"prototype",{writable:!1}),i&&_setPrototypeOf(h,i)}function _setPrototypeOf(h,i){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(_,j){return _.__proto__=j,_},_setPrototypeOf(h,i)}function _createSuper(h){var i=_isNativeReflectConstruct();return function(){var _=_getPrototypeOf(h),j;if(i){var $=_getPrototypeOf(this).constructor;j=Reflect.construct(_,arguments,$)}else j=_.apply(this,arguments);return _possibleConstructorReturn(this,j)}}function _possibleConstructorReturn(h,i){if(i&&(typeof i=="object"||typeof i=="function"))return i;if(i!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(h)}function _assertThisInitialized(h){if(h===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return h}function _isNativeReflectConstruct(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function _getPrototypeOf(h){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(g){return g.__proto__||Object.getPrototypeOf(g)},_getPrototypeOf(h)}var fallbackProps$2={width:450,height:300,padding:50,interpolation:"linear"},options={components:[{name:"parent",index:"parent"},{name:"data",index:"all"},{name:"labels"}]},VictoryLineBase=function(h){_inherits(g,h);var i=_createSuper(g);function g(_){return _classCallCheck(this,g),i.call(this,_)}return _createClass(g,[{key:"shouldAnimate",value:function(){return!!this.props.animate}},{key:"render",value:function(){var j=g.animationWhitelist,$=g.role,_n=modifyProps$1(this.props,fallbackProps$2,$);if(this.shouldAnimate())return this.animateComponent(_n,j);var _i=this.renderContinuousData(_n),_s=_n.standalone?this.renderContainer(_n.containerComponent,_i):_i;return withSafeUserProps(_s,_n)}}]),g}(React.Component);VictoryLineBase.animationWhitelist=["data","domain","height","padding","samples","style","width"];VictoryLineBase.displayName="VictoryLine";VictoryLineBase.role="line";VictoryLineBase.defaultTransitions=continuousTransitions();VictoryLineBase.defaultPolarTransitions=continuousPolarTransitions();VictoryLineBase.continuous=!0;VictoryLineBase.propTypes=_objectSpread$2(_objectSpread$2(_objectSpread$2({},CommonProps.baseProps),CommonProps.dataProps),{},{interpolation:propTypesExports.oneOfType([propTypesExports.oneOf(["basis","bundle","cardinal","catmullRom","linear","monotoneX","monotoneY","natural","step","stepAfter","stepBefore"]),propTypesExports.func]),label:deprecated(propTypesExports.string)});VictoryLineBase.defaultProps={containerComponent:React.createElement(VictoryContainer,null),dataComponent:React.createElement(Curve,null),labelComponent:React.createElement(VictoryLabel,{renderInPortal:!0}),groupComponent:React.createElement(VictoryClipContainer,null),samples:50,sortKey:"x",sortOrder:"ascending",standalone:!0,theme:VictoryTheme.grayscale};VictoryLineBase.getDomain=getDomain$3;VictoryLineBase.getData=getData;VictoryLineBase.getBaseProps=function(h){return getBaseProps(h,fallbackProps$2)};VictoryLineBase.expectedComponents=["dataComponent","labelComponent","groupComponent","containerComponent"];var VictoryLine=addEvents(VictoryLineBase,options);function _slicedToArray(h,i){return _arrayWithHoles(h)||_iterableToArrayLimit(h,i)||_unsupportedIterableToArray(h,i)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _unsupportedIterableToArray(h,i){if(h){if(typeof h=="string")return _arrayLikeToArray(h,i);var g=Object.prototype.toString.call(h).slice(8,-1);if(g==="Object"&&h.constructor&&(g=h.constructor.name),g==="Map"||g==="Set")return Array.from(h);if(g==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(g))return _arrayLikeToArray(h,i)}}function _arrayLikeToArray(h,i){(i==null||i>h.length)&&(i=h.length);for(var g=0,_=new Array(i);g<i;g++)_[g]=h[g];return _}function _iterableToArrayLimit(h,i){var g=h==null?null:typeof Symbol<"u"&&h[Symbol.iterator]||h["@@iterator"];if(g!=null){var _=[],j=!0,$=!1,_n,_i;try{for(g=g.call(h);!(j=(_n=g.next()).done)&&(_.push(_n.value),!(i&&_.length===i));j=!0);}catch(_s){$=!0,_i=_s}finally{try{!j&&g.return!=null&&g.return()}finally{if($)throw _i}}return _}}function _arrayWithHoles(h){if(Array.isArray(h))return h}function ownKeys$1(h,i){var g=Object.keys(h);if(Object.getOwnPropertySymbols){var _=Object.getOwnPropertySymbols(h);i&&(_=_.filter(function(j){return Object.getOwnPropertyDescriptor(h,j).enumerable})),g.push.apply(g,_)}return g}function _objectSpread$1(h){for(var i=1;i<arguments.length;i++){var g=arguments[i]!=null?arguments[i]:{};i%2?ownKeys$1(Object(g),!0).forEach(function(_){_defineProperty$1(h,_,g[_])}):Object.getOwnPropertyDescriptors?Object.defineProperties(h,Object.getOwnPropertyDescriptors(g)):ownKeys$1(Object(g)).forEach(function(_){Object.defineProperty(h,_,Object.getOwnPropertyDescriptor(g,_))})}return h}function _defineProperty$1(h,i,g){return i in h?Object.defineProperty(h,i,{value:g,enumerable:!0,configurable:!0,writable:!0}):h[i]=g,h}var fallbackProps$1={width:450,height:300,padding:50};function fillData(h,i){var g=h.fillInMissingData,_=i.reduce(function(_n,_i){return _i.forEach(function(_s){_n[_s._x instanceof Date?_s._x.getTime():_s._x]=!0}),_n},{}),j=keys_1(_).map(function(_n){return Number(_n)}),$=orderBy_1(j);return i.map(function(_n){var _i=0,_s=_n[0]&&_n[0]._x instanceof Date,ga=$.map(function(ba,xa){ba=Number(ba);var El=_n[xa-_i];if(El){var Tl=_s?El._x.getTime():El._x;if(Tl===ba)return El;_i++;var Sl=g?0:null;return ba=_s?new Date(ba):ba,{x:ba,y:Sl,_x:ba,_y:Sl}}var Il=g?0:null;return ba=_s?new Date(ba):ba,{x:ba,y:Il,_x:ba,_y:Il}});return ga})}function getY0(h,i,g){if(h.y0)return h.y0;var _=h._y,j=h._group,$=g[0].map(function(ga){return ga.y0}),_n=g.slice(0,i),_i=_n.reduce(function(ga,ba){return ga.concat(ba.filter(function(xa){return h._x instanceof Date?xa._x.getTime()===h._x.getTime():xa._x===h._x}).map(function(xa){return xa._y||0}))},[]),_s=_i.length&&_i.reduce(function(ga,ba){var xa=_<0&&ba<0||_>=0&&ba>=0;return xa?Number(ba)+ga:ga},$[j]||0);return _i.some(function(ga){return ga instanceof Date})?new Date(_s):_s}function addLayoutData(h,i,g){var _=h.xOffset||0;return i[g].map(function(j){var $=getY0(j,g,i)||0;return assign_1({},j,{_y0:j._y instanceof Date?$?new Date($):j._y:$,_y1:j._y===null?null:j._y instanceof Date?new Date(Number(j._y)+Number($)):j._y+$,_x1:j._x===null?null:j._x instanceof Date?new Date(Number(j._x)+Number(_)):j._x+_})})}function stackData(h,i){var g=getDataFromChildren(h,i),_=g.map(function($){return $.filter(function(_n){return _n._x!==null&&_n._y!==null})}),j=fillData(h,_);return j.map(function($,_n){return addLayoutData(h,j,_n)})}function getCalculatedProps(h,i){i=i||React.Children.toArray(h.children);var g="stack";h=modifyProps$1(h,fallbackProps$1,g);var _=getStyle$1(h.theme,h.style,g),j=h.categories||getCategories(h,i),$=h.datasets||stackData(h,i),_n=i.map(function(Sl,Il){return React.cloneElement(Sl,{data:$[Il]})}),_i={x:getDomain$1(assign_1({},h,{categories:j}),"x",_n),y:getDomain$1(assign_1({},h,{categories:j}),"y",_n)},_s=h.range||{x:getRange$1(h,"x"),y:getRange$1(h,"y")},ga={x:getScaleFromProps(h,"x")||getScale$2(h,"x"),y:getScaleFromProps(h,"y")||getScale$2(h,"y")},ba={x:ga.x.domain(_i.x).range(h.horizontal?_s.y:_s.x),y:ga.y.domain(_i.y).range(h.horizontal?_s.x:_s.y)},xa=h,El=xa.colorScale,Tl=xa.horizontal;return{datasets:$,categories:j,range:_s,domain:_i,horizontal:Tl,scale:ba,style:_,colorScale:El,role:g}}var withoutSharedEvents=function(h){var i=h.children,g=React.Children.toArray(i).map(function(_){var j=_;return _objectSpread$1(_objectSpread$1({},j),{},{props:omit(j.props,["sharedEvents"])})});return h.children=g,h};function useMemoizedProps(h){var i=withoutSharedEvents(h),g=React.useState(i),_=_slicedToArray(g,2),j=_[0],$=_[1];return React.useEffect(function(){reactFastCompare(i,j)||$(i)},[j,$,i]),React.useMemo(function(){return getCalculatedProps(j,j.children)},[j])}function getLabels(h,i,g){if(h.labels)return i.length===g+1?h.labels:void 0}function getChildProps(h,i){var g=i.categories,_=i.domain,j=i.range,$=i.scale,_n=i.horizontal;return{height:h.height,width:h.width,padding:getPadding$1(h),standalone:!1,theme:h.theme,categories:g,domain:_,range:j,scale:$,horizontal:_n}}function getColorScale(h,i){var g=i.type&&i.type.role,_=i.props.colorScale||h.colorScale;if(!(g!=="group"&&g!=="stack"))return h.theme?_||h.theme.props.colorScale:_}function getChildren(h,i,g){h=modifyProps$1(h,fallbackProps$1,"stack"),i=i||React.Children.toArray(h.children),g=g||getCalculatedProps(h,i);var _=g,j=_.datasets,$=getChildProps(h,g),_n=h.name||"stack";return i.map(function(_i,_s){var ga=_i.type&&_i.type.role,ba=j[_s],xa=getChildStyle(_i,_s,g),El=h.labels?getLabels(h,j,_s):_i.props.labels,Tl=_i.props.name||"".concat(_n,"-").concat(ga,"-").concat(_s);return React.cloneElement(_i,assign_1({key:"".concat(Tl,"-key-").concat(_s),labels:El,name:Tl,domainPadding:_i.props.domainPadding||h.domainPadding,theme:h.theme,labelComponent:h.labelComponent||_i.props.labelComponent,style:xa,colorScale:getColorScale(h,_i),data:ba,polar:h.polar},$))})}function ownKeys(h,i){var g=Object.keys(h);if(Object.getOwnPropertySymbols){var _=Object.getOwnPropertySymbols(h);i&&(_=_.filter(function(j){return Object.getOwnPropertyDescriptor(h,j).enumerable})),g.push.apply(g,_)}return g}function _objectSpread(h){for(var i=1;i<arguments.length;i++){var g=arguments[i]!=null?arguments[i]:{};i%2?ownKeys(Object(g),!0).forEach(function(_){_defineProperty(h,_,g[_])}):Object.getOwnPropertyDescriptors?Object.defineProperties(h,Object.getOwnPropertyDescriptors(g)):ownKeys(Object(g)).forEach(function(_){Object.defineProperty(h,_,Object.getOwnPropertyDescriptor(g,_))})}return h}function _defineProperty(h,i,g){return i in h?Object.defineProperty(h,i,{value:g,enumerable:!0,configurable:!0,writable:!0}):h[i]=g,h}var fallbackProps={width:450,height:300,padding:50},VictoryStackBase=function(h){var i=VictoryStack.role,g=useAnimationState(),_=g.setAnimationState,j=g.getAnimationProps,$=g.getProps,_n=$(h),_i=modifyProps$1(_n,fallbackProps,i),_s=_i.eventKey,ga=_i.containerComponent,ba=_i.standalone,xa=_i.groupComponent,El=_i.externalEventMutations,Tl=_i.width,Sl=_i.height,Il=_i.theme,Cl=_i.polar,Nl=_i.horizontal,Dl=_i.name,Ul=React.Children.toArray(_i.children),Kl=useMemoizedProps(_i),Jl=Kl.domain,Ep=Kl.scale,_p=Kl.style,Ip=React.useMemo(function(){var wp=getChildren(_n,Ul,Kl),Np=wp.map(function(Fp,Hp){var xp=assign_1({animate:j(_n,Fp,Hp)},Fp.props);return React.cloneElement(Fp,xp)});return Np.reverse()},[_n,Ul,Kl,j]),Up=React.useMemo(function(){return ba?{domain:Jl,scale:Ep,width:Tl,height:Sl,standalone:ba,theme:Il,style:_p.parent,horizontal:Nl,polar:Cl,name:Dl}:{}},[ba,Jl,Ep,Tl,Sl,Il,_p,Nl,Cl,Dl]),yp=React.useMemo(function(){return getSafeUserProps(h)},[h]),Ap=React.useMemo(function(){if(ba){var wp=defaults_1({},ga.props,Up,yp);return React.cloneElement(ga,wp)}return React.cloneElement(xa,yp)},[xa,ba,ga,Up,yp]),Cp=React.useMemo(function(){return getAllEvents(_n)},[_n]),Mp=usePreviousProps(h);return React.useEffect(function(){return function(){h.animate&&_(Mp,h)}},[_,Mp,h]),isEmpty_1(Cp)?React.cloneElement(Ap,Ap.props,Ip):React.createElement(VictorySharedEvents,{container:Ap,eventKey:_s,events:Cp,externalEventMutations:El},Ip)};VictoryStackBase.propTypes=_objectSpread(_objectSpread({},CommonProps.baseProps),{},{bins:propTypesExports.oneOfType([propTypesExports.arrayOf(propTypesExports.oneOfType([nonNegative,propTypesExports.instanceOf(Date)])),nonNegative]),categories:propTypesExports.oneOfType([propTypesExports.arrayOf(propTypesExports.string),propTypesExports.shape({x:propTypesExports.arrayOf(propTypesExports.string),y:propTypesExports.arrayOf(propTypesExports.string)})]),children:propTypesExports.oneOfType([propTypesExports.arrayOf(propTypesExports.node),propTypesExports.node]),colorScale:propTypesExports.oneOfType([propTypesExports.arrayOf(propTypesExports.string),propTypesExports.oneOf(["grayscale","qualitative","heatmap","warm","cool","red","green","blue"])]),fillInMissingData:propTypesExports.bool,horizontal:propTypesExports.bool,labelComponent:propTypesExports.element,labels:propTypesExports.oneOfType([propTypesExports.func,propTypesExports.array]),style:propTypesExports.shape({parent:propTypesExports.object,data:propTypesExports.object,labels:propTypesExports.object}),xOffset:propTypesExports.number});VictoryStackBase.defaultProps={containerComponent:React.createElement(VictoryContainer,null),groupComponent:React.createElement("g",null),standalone:!0,theme:VictoryTheme.grayscale,fillInMissingData:!0};var componentConfig={role:"stack",expectedComponents:["groupComponent","containerComponent","labelComponent"],getChildren},VictoryStack=Object.assign(React.memo(VictoryStackBase,reactFastCompare),componentConfig);VictoryStack.displayName="VictoryStack";const Analytics=()=>{const h=[{label:"Video 1",watchtime:200,views:500,likes:300,comments:150},{label:"Video 2",watchtime:350,views:750,likes:400,comments:200},{label:"Video 3",watchtime:150,views:400,likes:200,comments:100},{label:"Video 4",watchtime:400,views:900,likes:450,comments:300},{label:"Video 5",watchtime:250,views:600,likes:350,comments:200}];return useNavigate(),jsxs(Fragment$1,{children:[jsx(Header,{}),jsxs("div",{className:"w3-container",children:[jsxs("h4",{className:"w3-center",children:["Watchtime Analytics for:  Course 4 ","(Workplace Health and Safety)"]}),jsxs("div",{className:"w3-row-padding w3-margin-top",children:[jsx("div",{className:"w3-third",children:jsxs("div",{className:"w3-card",children:[jsx("h2",{className:"w3-container w3-blue w3-center",children:"Watchtime Distribution"}),jsx("div",{className:"w3-container",children:jsx(VictoryBar$1,{data:h,x:"label",y:"watchtime",style:{data:{fill:"#8884d8"}},height:200})})]})}),jsx("div",{className:"w3-third",children:jsxs("div",{className:"w3-card",children:[jsx("h2",{className:"w3-container w3-blue w3-center",children:"Views per Video"}),jsx("div",{className:"w3-container",children:jsx(VictoryBar$1,{data:h,x:"label",y:"views",style:{data:{fill:"#8884d8"}},height:200})})]})}),jsx("div",{className:"w3-third",children:jsxs("div",{className:"w3-card",children:[jsx("h2",{className:"w3-container w3-blue w3-center",children:"Likes vs. Comments"}),jsx("div",{className:"w3-container",children:jsxs(VictoryStack,{height:200,children:[jsx(VictoryBar$1,{data:h,x:"label",y:"likes",style:{data:{fill:"#8884d8"}}}),jsx(VictoryBar$1,{data:h,x:"label",y:"comments",style:{data:{fill:"#ff8a65"}}})]})})]})})]}),jsxs("div",{className:"w3-card w3-half w3-margin-top",children:[jsx("h2",{className:"w3-container w3-blue w3-center",children:"Watchtime vs. Views"}),jsx("div",{className:"w3-container",children:jsxs(VictoryChart,{height:200,children:[jsx(VictoryAxis,{tickFormat:()=>"",style:{tickLabels:{fontSize:10,padding:5}}}),jsx(VictoryAxis,{dependentAxis:!0}),jsx(VictoryBar$1,{data:h,x:"label",y:"watchtime",style:{data:{fill:"#8884d8"}}}),jsx(VictoryLine,{data:h,x:"label",y:"views",style:{data:{stroke:"#ff8a65"}}})]})})]}),jsxs("div",{className:"w3-card  w3-half w3-margin-top",children:[jsx("h2",{className:"w3-container w3-blue w3-center",children:"Watchtime vs. Views"}),jsx("div",{className:"w3-container",children:jsxs(VictoryChart,{height:200,children:[jsx(VictoryAxis,{tickFormat:()=>"",style:{tickLabels:{fontSize:10,padding:5}}}),jsx(VictoryAxis,{dependentAxis:!0}),jsx(VictoryBar$1,{data:h,x:"label",y:"watchtime",style:{data:{fill:"#8884d8"}}}),jsx(VictoryLine,{data:h,x:"label",y:"views",style:{data:{stroke:"#ff8a65"}}})]})})]})]})]})};function App(){return jsx(BrowserRouter,{children:jsxs(Routes,{children:[jsx(Route,{path:"/auth",element:jsx(AuthPage,{})}),jsxs(Route,{element:jsx(AuthGuard,{}),children:[jsx(Route,{path:"/stream/:channelCode",element:jsx(Call,{})}),jsx(Route,{path:"/prejoin/:channelCode",element:jsx(Prejoin,{})}),jsx(Route,{path:"/player/:videoName",element:jsx(Player,{})}),jsx(Route,{path:"/join",element:jsx(Join,{})}),jsx(Route,{path:"/courses",element:jsx(Courses,{})}),jsx(Route,{path:"/analytics",element:jsx(Analytics,{})})]}),jsx(Route,{path:"*",element:jsx(NotFound,{})})]})})}client.createRoot(document.getElementById("root")).render(jsx(React.StrictMode,{children:jsx(App,{})}));
